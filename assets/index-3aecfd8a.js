(function(){const V=document.createElement("link").relList;if(V&&V.supports&&V.supports("modulepreload"))return;for(const Je of document.querySelectorAll('link[rel="modulepreload"]'))qe(Je);new MutationObserver(Je=>{for(const Ke of Je)if(Ke.type==="childList")for(const He of Ke.addedNodes)He.tagName==="LINK"&&He.rel==="modulepreload"&&qe(He)}).observe(document,{childList:!0,subtree:!0});function p(Je){const Ke={};return Je.integrity&&(Ke.integrity=Je.integrity),Je.referrerPolicy&&(Ke.referrerPolicy=Je.referrerPolicy),Je.crossOrigin==="use-credentials"?Ke.credentials="include":Je.crossOrigin==="anonymous"?Ke.credentials="omit":Ke.credentials="same-origin",Ke}function qe(Je){if(Je.ep)return;Je.ep=!0;const Ke=p(Je);fetch(Je.href,Ke)}})();/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={109:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),V.Z=Je},356:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:rgba(0,0,0,0);border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",""]),V.Z=Je},44:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),V.Z=Je},27:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,'#assetManagerLoadingScreen{z-index:300;position:absolute;bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:rgba(0,0,0,0);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: 0.8;--b-background: #ffffff}#assetManagerLoadingScreen::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:bold}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem;padding:1rem}.loadingScreenLogoElement{margin-bottom:.5rem;max-width:80%}.loadingScreenLogoElement img{min-height:3rem;max-height:5rem;max-width:100%}.loadingScreenLogoImage{width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoElement{min-height:0;display:none}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',""]),V.Z=Je},798:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;color:#fff;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),V.Z=Je},729:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,'.button-bar{background:var(--tp-base-background-color);width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:500;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:var(--tp-input-foreground-color, #cccccc);transition:color .25s}.button-bar-button:hover{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected-box{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:var(--tp-container-background-color-active, #413762)}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:var(--tp-container-foreground-color, #cccccc);transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem;aspect-ratio:1}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px;flex-wrap:nowrap !important;overflow-x:scroll;pointer-events:auto;max-width:100%;align-content:center;justify-content:flex-start;align-items:center;box-sizing:border-box}.mode-buttons-container::-webkit-scrollbar{display:none}.mode-buttons-container{-ms-overflow-style:none;scrollbar-width:none}.mode-button{font-weight:500}#webgi-logo{background-image:url("https://static.webgi.xyz/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:7.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem;color:var(--tp-container-foreground-color, #dddddd)}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.9rem !important;color:var(--tp-container-foreground-color, #dddddd) !important}#tweakpaneUiContainer{margin-top:4.5rem}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{transition:background-color .5s ease;background-color:#d1d4e7}body.tpTheme-blue{background-color:#d1d4e7}body.tpTheme-white{background-color:#dcdcdc}body.tpTheme-black{background-color:#48495d}',""]),V.Z=Je},898:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,':root{--tp-blade-unit-size: 26px;--tp-font-family: "Inter";--tp-element-border-radius: 0.25rem}:root{--tp-base-background-color: #0e0e0e;--tp-container-background-color: rgba(32, 32, 32, 0.2);--tp-container-background-color-hover: rgba(32, 32, 32, 0.3);--tp-container-background-color-active: rgba(50, 50, 50, 0.8);--tp-container-background-color-focus: rgba(50, 50, 50, 1.0);--tp-container-foreground-color: hsla(0, 0%, 90%, 0.90);--tp-label-foreground-color: hsla(0, 0%, 85%, 0.90)}:root .tpTheme-blue{--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 36%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED}:root .tpTheme-white{--tp-base-background-color: hsla(230, 5%, 90%, 1.00);--tp-base-shadow-color: hsla(0, 0%, 0%, 0.10);--tp-button-background-color: hsla(230, 7%, 85%, 1.00);--tp-button-background-color-active: hsla(230, 7%, 70%, 1.00);--tp-button-background-color-focus: hsla(230, 7%, 75%, 1.00);--tp-button-background-color-hover: hsla(230, 7%, 80%, 1.00);--tp-button-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-container-background-color: hsla(230, 15%, 80%, 0.10);--tp-container-background-color-active: hsla(230, 15%, 70%, 0.32);--tp-container-background-color-focus: hsla(230, 15%, 70%, 0.28);--tp-container-background-color-hover: hsla(230, 15%, 70%, 0.24);--tp-container-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-groove-foreground-color: hsla(230, 15%, 20%, 0.10);--tp-input-background-color: hsla(230, 15%, 30%, 0.10);--tp-input-background-color-active: hsla(230, 15%, 50%, 0.22);--tp-input-background-color-focus: hsla(230, 15%, 50%, 0.18);--tp-input-background-color-hover: hsla(230, 15%, 50%, 0.14);--tp-input-foreground-color: hsla(230, 10%, 20%, 1.00);--tp-label-foreground-color: hsla(230, 10%, 10%, 1.00);--tp-monitor-background-color: hsla(230, 15%, 30%, 0.10);--tp-monitor-foreground-color: hsla(230, 10%, 30%, 0.50)}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.9rem !important;transition:background-color .5s ease}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.7rem !important}.tp-lblv_l{font-size:.75rem !important;font-weight:500 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.75rem !important;font-weight:500 !important}.tp-fldv_t{font-weight:500 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:var(--tp-container-foreground-color, #eeeeee);font-size:.9rem;border:none}.tp-sldv_k::after{background-color:var(--tp-input-foreground-color, hsl(230, 7%, 75%))}.tp-btnv_b{height:calc(var(--tp-blade-unit-size)*1.15)}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{font-weight:500 !important}.tp-rotv{font-size:13px !important}',""]),V.Z=Je},513:function(St,V,p){var qe=p(352),Je=p.n(qe)()(function(Ke){return Ke[1]});Je.push([St.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),V.Z=Je},476:function(St){var V;V=function(){return function(p){var qe={};function Je(Ke){if(qe[Ke])return qe[Ke].exports;var He=qe[Ke]={i:Ke,l:!1,exports:{}};return p[Ke].call(He.exports,He,He.exports,Je),He.l=!0,He.exports}return Je.m=p,Je.c=qe,Je.i=function(Ke){return Ke},Je.d=function(Ke,He,ft){Je.o(Ke,He)||Object.defineProperty(Ke,He,{configurable:!1,enumerable:!0,get:ft})},Je.n=function(Ke){var He=Ke&&Ke.__esModule?function(){return Ke.default}:function(){return Ke};return Je.d(He,"a",He),He},Je.o=function(Ke,He){return Object.prototype.hasOwnProperty.call(Ke,He)},Je.p="",Je(Je.s=5)}([function(p,qe,Je){Object.defineProperty(qe,"__esModule",{value:!0});var Ke={convertToObject:function(He){var ft=He.substring(He.indexOf("{")+1).trim().slice(0,-1),Xe={};return ft.split(";").map(function(st){if(st=st.trim()){var mt=st.split(":");Xe[mt[0].trim()]=mt[1].trim()}}),Xe},getFromSheets:function(He){var ft=document.styleSheets;for(var Xe in ft){var st=null;try{st=ft[Xe].rules||ft[Xe].cssRules}catch{}if(st){for(var mt in st)if(st[mt].selectorText&&st[mt].selectorText.split(",").indexOf(He)!=-1)return st[mt].cssText?Ke.convertToObject(st[mt].cssText):Ke.convertToObject(st[mt].style.cssText)}}return{}},getPropertyDefault:function(He){return He=="timing-function"?"ease":He=="iteration-count"?1:He=="direction"?"normal":He=="fill-mode"?"none":null}};qe.default=Ke},function(p,qe,Je){Object.defineProperty(qe,"__esModule",{value:!0});var Ke={generateId:function(){for(var He="",ft="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Xe=0;Xe<8;++Xe)He+=ft.charAt(Math.floor(Math.random()*ft.length));return He},frameToString:function(He){var ft="";for(var Xe in He)ft+=Xe+":"+He[Xe]+";";return ft},convertTimeToMs:function(He){if(!He)return 0;if(typeof He=="number")return He;var ft=parseFloat(He);return He.indexOf("ms")!=-1?ft:1e3*ft},prefixes:["","-webkit-","-moz-","-o-"]};qe.default=Ke},function(p,qe,Je){Object.defineProperty(qe,"__esModule",{value:!0});var Ke,He=(Ke=Je(0))&&Ke.__esModule?Ke:{default:Ke};qe.default=function ft(Xe,st){if(function(at,Ie){if(!(at instanceof Ie))throw new TypeError("Cannot call a class as a function")}(this,ft),this.styles=typeof Xe=="string"?He.default.getFromSheets(Xe):Xe,typeof st=="string"){var mt=He.default.getFromSheets(st);for(var bt in this.options={},mt)this.options[bt.replace("animation-","")]=mt[bt]}else this.options=typeof st=="number"?{duration:st}:st}},function(p,qe,Je){Object.defineProperty(qe,"__esModule",{value:!0});var Ke=function(){function bt(at,Ie){for(var et=0;et<Ie.length;et++){var Ce=Ie[et];Ce.enumerable=Ce.enumerable||!1,Ce.configurable=!0,"value"in Ce&&(Ce.writable=!0),Object.defineProperty(at,Ce.key,Ce)}}return function(at,Ie,et){return Ie&&bt(at.prototype,Ie),et&&bt(at,et),at}}(),He=st(Je(4)),ft=st(Je(1)),Xe=st(Je(0));function st(bt){return bt&&bt.__esModule?bt:{default:bt}}var mt=function(){function bt(at,Ie,et,Ce){if(function(Ue,At){if(!(Ue instanceof At))throw new TypeError("Cannot call a class as a function")}(this,bt),at.constructor===Array?this.doms=at:this.doms=[at],Ie.constructor===Array?this.frames=Ie:this.frames=[Ie],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},et!=null&&et!=null)if(typeof et=="boolean")this.options.instant=et;else if(typeof et=="number")this.options.count=et,typeof Ce=="boolean"&&(this.options.instant=Ce);else for(var ht in et)ht=="pauseAt"&&et.pauseAt.constructor!==Array?this.options[ht]=[et[ht]]:this.options[ht]=et[ht];for(var Ze in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=ft.default.prefixes:this.prefixes=[""],at)this.countRemainder[Ze]=this.options.count-1;this.options.instant&&this.play()}return Ke(bt,[{key:"play",value:function(){var at=this;for(var Ie in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(Ce){at.promiseResolve=Ce})),this.doms){var et=this.makeAnimation(this.doms[Ie]);this.animations[Ie]=et.names,this.styleDoms[Ie]=et.styleDom,this.superSets[Ie]=this.makeSuperSet(this.doms[Ie],this.animations[Ie]),this.playAnimation(this.doms[Ie],this.superSets[Ie]),this.eventHandler[Ie]=this.handleAnimationEnd.bind(this,Ie),this.doms[Ie].addEventListener("animationend",this.eventHandler[Ie])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(at){if(!at){for(var Ie in this.doms)this.clear(Ie);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var et=this.styleDoms[at];for(var Ce in et&&et.parentNode&&et.parentNode.removeChild(et),this.superSets[at])for(var ht in this.prefixes)this.doms[at].style[this.prefixes[ht]+"animation-"+Ce]=null;for(var Ze in this.prefixes)this.doms[at].style[this.prefixes[Ze]+"animation-play-state"]=null;this.doms[at].removeEventListener("animationend",this.eventHandler[at]),this.countRemainder[at]=this.options.count-1}},{key:"replay",value:function(at){var Ie=this.doms[at],et=Ie.cloneNode(!0);Ie.parentNode.replaceChild(et,Ie),this.doms[at].removeEventListener("animationend",this.eventHandler[at]),this.doms[at]=et,this.doms[at].addEventListener("animationend",this.eventHandler[at])}},{key:"pause",value:function(){for(var at in this.doms)this.pauseDom(this.doms[at])}},{key:"resume",value:function(){for(var at in this.doms)this.resumeDom(this.doms[at])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(at,Ie){var et=Ie.animationName,Ce=et.substring(et.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(Ce))&&this.pauseDom(this.doms[at]),Ce==this.frames.length&&(this.countRemainder[at]==-1?this.replay(at):this.countRemainder[at]>0?(this.countRemainder[at]--,this.replay(at)):(this.options.applyOnEnd&&this.applyOnEnd(at),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(at){for(var Ie in this.prefixes)at.style[this.prefixes[Ie]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(at){for(var Ie in this.prefixes)at.style[this.prefixes[Ie]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(at){var Ie=this.newFrames[this.frames.length];for(var et in Ie)this.doms[at].style[et]=Ie[et]}},{key:"makeAnimation",value:function(at){var Ie={},et=[],Ce={};for(var ht in this.frames)for(var Ze in et.push(this.frames[ht].styles),et[ht])Ce[Ze]=!0;var Ue=window.getComputedStyle(at);for(var At in Ce)Ie[At]=Ue[At];et.unshift(Ie);for(var Bt=[et[0]],Be=1;Be<et.length;++Be){var Qe=JSON.parse(JSON.stringify(Bt[Be-1]));for(var Z in et[Be])Qe[Z]=et[Be][Z];Bt.push(Qe)}return this.newFrames=Bt,He.default.make(Bt,this.prefixes)}},{key:"makeSuperSet",value:function(at,Ie){var et=0,Ce={};for(var ht in this.frames)for(var Ze in this.frames[ht].options)Ce[Ze]="";Ce.name="",Ce.duration="",Ce.delay="";for(var Ue=0;Ue<this.frames.length;++Ue){if(Ue)for(var At in Ce)Ce[At]+=",";var Bt=ft.default.convertTimeToMs(this.frames[Ue].options.duration),Be=ft.default.convertTimeToMs(this.frames[Ue].options.delay);for(var Qe in Ue<this.options.startFrom&&(Bt=0,Be=0),Ce.name+=Ie[Ue],Ce.duration+=Bt+"ms",Ce.delay+=et+Be+"ms",Ce)Qe!="name"&&Qe!="duration"&&Qe!="delay"&&(Ce[Qe]+=this.frames[Ue].options[Qe]?this.frames[Ue].options[Qe]:Xe.default.getPropertyDefault(Qe));var Z=this.frames[Ue].options["iteration-count"];et+=Bt*parseInt(Z||1)+Be}return Ce}},{key:"playAnimation",value:function(at,Ie){for(var et in Ie)for(var Ce in this.prefixes)at.style[this.prefixes[Ce]+"animation-"+et]=Ie[et];this.options.pauseAt.includes(0)&&this.pauseDom(at)}}]),bt}();qe.default=mt},function(p,qe,Je){Object.defineProperty(qe,"__esModule",{value:!0});var Ke,He=(Ke=Je(1))&&Ke.__esModule?Ke:{default:Ke},ft={make:function(Xe,st){for(var mt=[],bt="",at="atr-"+He.default.generateId(),Ie=document.createElement("style"),et=0;et<Xe.length-1;++et)mt.push(at+"-"+(et+1)),bt+=ft.makeFromTwoFrames(Xe[et],Xe[et+1],mt[et],st);return Ie.innerHTML=bt,Ie.class="foo",document.getElementsByTagName("head")[0].appendChild(Ie),{names:mt,styleDom:Ie}},makeFromTwoFrames:function(Xe,st,mt,bt){var at="";for(var Ie in bt)at+="@"+bt[Ie]+"keyframes "+mt+" {",at+="0%",at+="{"+He.default.frameToString(Xe)+"}",at+="100%",at+="{"+He.default.frameToString(st)+"}",at+="}";return at}};qe.default=ft},function(p,qe,Je){Object.defineProperty(qe,"__esModule",{value:!0}),qe.Queue=qe.Frame=void 0;var Ke=ft(Je(2)),He=ft(Je(3));function ft(Xe){return Xe&&Xe.__esModule?Xe:{default:Xe}}qe.Frame=Ke.default,qe.Queue=He.default}])},St.exports=V()},352:function(St){St.exports=function(V){var p=[];return p.toString=function(){return this.map(function(qe){var Je=V(qe);return qe[2]?"@media ".concat(qe[2]," {").concat(Je,"}"):Je}).join("")},p.i=function(qe,Je,Ke){typeof qe=="string"&&(qe=[[null,qe,""]]);var He={};if(Ke)for(var ft=0;ft<this.length;ft++){var Xe=this[ft][0];Xe!=null&&(He[Xe]=!0)}for(var st=0;st<qe.length;st++){var mt=[].concat(qe[st]);Ke&&He[mt[0]]||(Je&&(mt[2]?mt[2]="".concat(Je," and ").concat(mt[2]):mt[2]=Je),p.push(mt))}},p}},388:function(St){St.exports=function V(p,qe,Je){function Ke(Xe,st){if(!qe[Xe]){if(!p[Xe]){if(He)return He(Xe,!0);throw new Error("Cannot find module '"+Xe+"'")}var mt=qe[Xe]={exports:{}};p[Xe][0].call(mt.exports,function(bt){return Ke(p[Xe][1][bt]||bt)},mt,mt.exports,V,p,qe,Je)}return qe[Xe].exports}for(var He=void 0,ft=0;ft<Je.length;ft++)Ke(Je[ft]);return Ke}({1:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){var Ie=V("crypto");function et(Be,Qe){return function(Z,$){var ae;if((ae=$.algorithm!=="passthrough"?Ie.createHash($.algorithm):new Bt).write===void 0&&(ae.write=ae.update,ae.end=ae.update),At($,ae).dispatch(Z),ae.update||ae.end(""),ae.digest)return ae.digest($.encoding==="buffer"?void 0:$.encoding);var Le=ae.read();return $.encoding!=="buffer"?Le.toString($.encoding):Le}(Be,Qe=Ze(Be,Qe))}(qe=p.exports=et).sha1=function(Be){return et(Be)},qe.keys=function(Be){return et(Be,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},qe.MD5=function(Be){return et(Be,{algorithm:"md5",encoding:"hex"})},qe.keysMD5=function(Be){return et(Be,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var Ce=Ie.getHashes?Ie.getHashes().slice():["sha1","md5"];Ce.push("passthrough");var ht=["buffer","hex","binary","base64"];function Ze(Be,Qe){Qe=Qe||{};var Z={};if(Z.algorithm=Qe.algorithm||"sha1",Z.encoding=Qe.encoding||"hex",Z.excludeValues=!!Qe.excludeValues,Z.algorithm=Z.algorithm.toLowerCase(),Z.encoding=Z.encoding.toLowerCase(),Z.ignoreUnknown=Qe.ignoreUnknown===!0,Z.respectType=Qe.respectType!==!1,Z.respectFunctionNames=Qe.respectFunctionNames!==!1,Z.respectFunctionProperties=Qe.respectFunctionProperties!==!1,Z.unorderedArrays=Qe.unorderedArrays===!0,Z.unorderedSets=Qe.unorderedSets!==!1,Z.unorderedObjects=Qe.unorderedObjects!==!1,Z.replacer=Qe.replacer||void 0,Z.excludeKeys=Qe.excludeKeys||void 0,Be===void 0)throw new Error("Object argument required.");for(var $=0;$<Ce.length;++$)Ce[$].toLowerCase()===Z.algorithm.toLowerCase()&&(Z.algorithm=Ce[$]);if(Ce.indexOf(Z.algorithm)===-1)throw new Error('Algorithm "'+Z.algorithm+'"  not supported. supported values: '+Ce.join(", "));if(ht.indexOf(Z.encoding)===-1&&Z.algorithm!=="passthrough")throw new Error('Encoding "'+Z.encoding+'"  not supported. supported values: '+ht.join(", "));return Z}function Ue(Be){if(typeof Be=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(Be))!=null}function At(Be,Qe,Z){function $(ae){return Qe.update?Qe.update(ae,"utf8"):Qe.write(ae,"utf8")}return Z=Z||[],{dispatch:function(ae){return Be.replacer&&(ae=Be.replacer(ae)),this["_"+(ae===null?"null":typeof ae)](ae)},_object:function(ae){var Le,J=Object.prototype.toString.call(ae),te=/\[object (.*)\]/i.exec(J);if(te=(te=te?te[1]:"unknown:["+J+"]").toLowerCase(),0<=(Le=Z.indexOf(ae)))return this.dispatch("[CIRCULAR:"+Le+"]");if(Z.push(ae),He!==void 0&&He.isBuffer&&He.isBuffer(ae))return $("buffer:"),$(ae);if(te==="object"||te==="function"||te==="asyncfunction"){var ce=Object.keys(ae);Be.unorderedObjects&&(ce=ce.sort()),Be.respectType===!1||Ue(ae)||ce.splice(0,0,"prototype","__proto__","constructor"),Be.excludeKeys&&(ce=ce.filter(function(je){return!Be.excludeKeys(je)})),$("object:"+ce.length+":");var pe=this;return ce.forEach(function(je){pe.dispatch(je),$(":"),Be.excludeValues||pe.dispatch(ae[je]),$(",")})}if(!this["_"+te]){if(Be.ignoreUnknown)return $("["+te+"]");throw new Error('Unknown object type "'+te+'"')}this["_"+te](ae)},_array:function(ae,Le){Le=Le!==void 0?Le:Be.unorderedArrays!==!1;var J=this;if($("array:"+ae.length+":"),!Le||ae.length<=1)return ae.forEach(function(pe){return J.dispatch(pe)});var te=[],ce=ae.map(function(pe){var je=new Bt,ct=Z.slice();return At(Be,je,ct).dispatch(pe),te=te.concat(ct.slice(Z.length)),je.read().toString()});return Z=Z.concat(te),ce.sort(),this._array(ce,!1)},_date:function(ae){return $("date:"+ae.toJSON())},_symbol:function(ae){return $("symbol:"+ae.toString())},_error:function(ae){return $("error:"+ae.toString())},_boolean:function(ae){return $("bool:"+ae.toString())},_string:function(ae){$("string:"+ae.length+":"),$(ae.toString())},_function:function(ae){$("fn:"),Ue(ae)?this.dispatch("[native]"):this.dispatch(ae.toString()),Be.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(ae.name)),Be.respectFunctionProperties&&this._object(ae)},_number:function(ae){return $("number:"+ae.toString())},_xml:function(ae){return $("xml:"+ae.toString())},_null:function(){return $("Null")},_undefined:function(){return $("Undefined")},_regexp:function(ae){return $("regex:"+ae.toString())},_uint8array:function(ae){return $("uint8array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint8clampedarray:function(ae){return $("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(ae))},_int8array:function(ae){return $("uint8array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint16array:function(ae){return $("uint16array:"),this.dispatch(Array.prototype.slice.call(ae))},_int16array:function(ae){return $("uint16array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint32array:function(ae){return $("uint32array:"),this.dispatch(Array.prototype.slice.call(ae))},_int32array:function(ae){return $("uint32array:"),this.dispatch(Array.prototype.slice.call(ae))},_float32array:function(ae){return $("float32array:"),this.dispatch(Array.prototype.slice.call(ae))},_float64array:function(ae){return $("float64array:"),this.dispatch(Array.prototype.slice.call(ae))},_arraybuffer:function(ae){return $("arraybuffer:"),this.dispatch(new Uint8Array(ae))},_url:function(ae){return $("url:"+ae.toString())},_map:function(ae){$("map:");var Le=Array.from(ae);return this._array(Le,Be.unorderedSets!==!1)},_set:function(ae){$("set:");var Le=Array.from(ae);return this._array(Le,Be.unorderedSets!==!1)},_file:function(ae){return $("file:"),this.dispatch([ae.name,ae.size,ae.type,ae.lastModfied])},_blob:function(){if(Be.ignoreUnknown)return $("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return $("domwindow")},_bigint:function(ae){return $("bigint:"+ae.toString())},_process:function(){return $("process")},_timer:function(){return $("timer")},_pipe:function(){return $("pipe")},_tcp:function(){return $("tcp")},_udp:function(){return $("udp")},_tty:function(){return $("tty")},_statwatcher:function(){return $("statwatcher")},_securecontext:function(){return $("securecontext")},_connection:function(){return $("connection")},_zlib:function(){return $("zlib")},_context:function(){return $("context")},_nodescript:function(){return $("nodescript")},_httpparser:function(){return $("httpparser")},_dataview:function(){return $("dataview")},_signal:function(){return $("signal")},_fsevent:function(){return $("fsevent")},_tlswrap:function(){return $("tlswrap")}}}function Bt(){return{buf:"",write:function(Be){this.buf+=Be},end:function(Be){this.buf+=Be},read:function(){return this.buf}}}qe.writeToStream=function(Be,Qe,Z){return Z===void 0&&(Z=Qe,Qe={}),At(Qe=Ze(Be,Qe),Z).dispatch(Be)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){(function(Ie){var et=typeof Uint8Array<"u"?Uint8Array:Array,Ce="+".charCodeAt(0),ht="/".charCodeAt(0),Ze="0".charCodeAt(0),Ue="a".charCodeAt(0),At="A".charCodeAt(0),Bt="-".charCodeAt(0),Be="_".charCodeAt(0);function Qe(Z){var $=Z.charCodeAt(0);return $===Ce||$===Bt?62:$===ht||$===Be?63:$<Ze?-1:$<Ze+10?$-Ze+26+26:$<At+26?$-At:$<Ue+26?$-Ue+26:void 0}Ie.toByteArray=function(Z){var $,ae;if(0<Z.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Le=Z.length,J=Z.charAt(Le-2)==="="?2:Z.charAt(Le-1)==="="?1:0,te=new et(3*Z.length/4-J),ce=0<J?Z.length-4:Z.length,pe=0;function je(ct){te[pe++]=ct}for($=0;$<ce;$+=4,0)je((16711680&(ae=Qe(Z.charAt($))<<18|Qe(Z.charAt($+1))<<12|Qe(Z.charAt($+2))<<6|Qe(Z.charAt($+3))))>>16),je((65280&ae)>>8),je(255&ae);return J==2?je(255&(ae=Qe(Z.charAt($))<<2|Qe(Z.charAt($+1))>>4)):J==1&&(je((ae=Qe(Z.charAt($))<<10|Qe(Z.charAt($+1))<<4|Qe(Z.charAt($+2))>>2)>>8&255),je(255&ae)),te},Ie.fromByteArray=function(Z){var $,ae,Le,J,te=Z.length%3,ce="";function pe(je){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(je)}for($=0,Le=Z.length-te;$<Le;$+=3)ce+=pe((J=ae=(Z[$]<<16)+(Z[$+1]<<8)+Z[$+2])>>18&63)+pe(J>>12&63)+pe(J>>6&63)+pe(63&J);switch(te){case 1:ce+=pe((ae=Z[Z.length-1])>>2),ce+=pe(ae<<4&63),ce+="==";break;case 2:ce+=pe((ae=(Z[Z.length-2]<<8)+Z[Z.length-1])>>10),ce+=pe(ae>>4&63),ce+=pe(ae<<2&63),ce+="="}return ce}})(qe===void 0?this.base64js={}:qe)}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(V,p,qe){(function(Je,Ke,Ce,ft,Xe,st,mt,bt,at){var Ie=V("base64-js"),et=V("ieee754");function Ce(se,Me,Ne){if(!(this instanceof Ce))return new Ce(se,Me,Ne);var Vt,Kt,fn,ri,In,Qi=typeof se;if(Me==="base64"&&Qi=="string")for(se=(Vt=se).trim?Vt.trim():Vt.replace(/^\s+|\s+$/g,"");se.length%4!=0;)se+="=";if(Qi=="number")Kt=pe(se);else if(Qi=="string")Kt=Ce.byteLength(se,Me);else{if(Qi!="object")throw new Error("First argument needs to be a number, array or string.");Kt=pe(se.length)}if(Ce._useTypedArrays?fn=Ce._augment(new Uint8Array(Kt)):((fn=this).length=Kt,fn._isBuffer=!0),Ce._useTypedArrays&&typeof se.byteLength=="number")fn._set(se);else if(je(In=se)||Ce.isBuffer(In)||In&&typeof In=="object"&&typeof In.length=="number")for(ri=0;ri<Kt;ri++)Ce.isBuffer(se)?fn[ri]=se.readUInt8(ri):fn[ri]=se[ri];else if(Qi=="string")fn.write(se,0,Me);else if(Qi=="number"&&!Ce._useTypedArrays&&!Ne)for(ri=0;ri<Kt;ri++)fn[ri]=0;return fn}function ht(se,Me,Ne,Vt){Vt||(Fe(typeof Ne=="boolean","missing or invalid endian"),Fe(Me!=null,"missing offset"),Fe(Me+1<se.length,"Trying to read beyond buffer length"));var Kt,fn=se.length;if(!(fn<=Me))return Ne?(Kt=se[Me],Me+1<fn&&(Kt|=se[Me+1]<<8)):(Kt=se[Me]<<8,Me+1<fn&&(Kt|=se[Me+1])),Kt}function Ze(se,Me,Ne,Vt){Vt||(Fe(typeof Ne=="boolean","missing or invalid endian"),Fe(Me!=null,"missing offset"),Fe(Me+3<se.length,"Trying to read beyond buffer length"));var Kt,fn=se.length;if(!(fn<=Me))return Ne?(Me+2<fn&&(Kt=se[Me+2]<<16),Me+1<fn&&(Kt|=se[Me+1]<<8),Kt|=se[Me],Me+3<fn&&(Kt+=se[Me+3]<<24>>>0)):(Me+1<fn&&(Kt=se[Me+1]<<16),Me+2<fn&&(Kt|=se[Me+2]<<8),Me+3<fn&&(Kt|=se[Me+3]),Kt+=se[Me]<<24>>>0),Kt}function Ue(se,Me,Ne,Vt){if(Vt||(Fe(typeof Ne=="boolean","missing or invalid endian"),Fe(Me!=null,"missing offset"),Fe(Me+1<se.length,"Trying to read beyond buffer length")),!(se.length<=Me)){var Kt=ht(se,Me,Ne,!0);return 32768&Kt?-1*(65535-Kt+1):Kt}}function At(se,Me,Ne,Vt){if(Vt||(Fe(typeof Ne=="boolean","missing or invalid endian"),Fe(Me!=null,"missing offset"),Fe(Me+3<se.length,"Trying to read beyond buffer length")),!(se.length<=Me)){var Kt=Ze(se,Me,Ne,!0);return 2147483648&Kt?-1*(4294967295-Kt+1):Kt}}function Bt(se,Me,Ne,Vt){return Vt||(Fe(typeof Ne=="boolean","missing or invalid endian"),Fe(Me+3<se.length,"Trying to read beyond buffer length")),et.read(se,Me,Ne,23,4)}function Be(se,Me,Ne,Vt){return Vt||(Fe(typeof Ne=="boolean","missing or invalid endian"),Fe(Me+7<se.length,"Trying to read beyond buffer length")),et.read(se,Me,Ne,52,8)}function Qe(se,Me,Ne,Vt,Kt){Kt||(Fe(Me!=null,"missing value"),Fe(typeof Vt=="boolean","missing or invalid endian"),Fe(Ne!=null,"missing offset"),Fe(Ne+1<se.length,"trying to write beyond buffer length"),Tt(Me,65535));var fn=se.length;if(!(fn<=Ne))for(var ri=0,In=Math.min(fn-Ne,2);ri<In;ri++)se[Ne+ri]=(Me&255<<8*(Vt?ri:1-ri))>>>8*(Vt?ri:1-ri)}function Z(se,Me,Ne,Vt,Kt){Kt||(Fe(Me!=null,"missing value"),Fe(typeof Vt=="boolean","missing or invalid endian"),Fe(Ne!=null,"missing offset"),Fe(Ne+3<se.length,"trying to write beyond buffer length"),Tt(Me,4294967295));var fn=se.length;if(!(fn<=Ne))for(var ri=0,In=Math.min(fn-Ne,4);ri<In;ri++)se[Ne+ri]=Me>>>8*(Vt?ri:3-ri)&255}function $(se,Me,Ne,Vt,Kt){Kt||(Fe(Me!=null,"missing value"),Fe(typeof Vt=="boolean","missing or invalid endian"),Fe(Ne!=null,"missing offset"),Fe(Ne+1<se.length,"Trying to write beyond buffer length"),Ct(Me,32767,-32768)),se.length<=Ne||Qe(se,0<=Me?Me:65535+Me+1,Ne,Vt,Kt)}function ae(se,Me,Ne,Vt,Kt){Kt||(Fe(Me!=null,"missing value"),Fe(typeof Vt=="boolean","missing or invalid endian"),Fe(Ne!=null,"missing offset"),Fe(Ne+3<se.length,"Trying to write beyond buffer length"),Ct(Me,2147483647,-2147483648)),se.length<=Ne||Z(se,0<=Me?Me:4294967295+Me+1,Ne,Vt,Kt)}function Le(se,Me,Ne,Vt,Kt){Kt||(Fe(Me!=null,"missing value"),Fe(typeof Vt=="boolean","missing or invalid endian"),Fe(Ne!=null,"missing offset"),Fe(Ne+3<se.length,"Trying to write beyond buffer length"),Ft(Me,34028234663852886e22,-34028234663852886e22)),se.length<=Ne||et.write(se,Me,Ne,Vt,23,4)}function J(se,Me,Ne,Vt,Kt){Kt||(Fe(Me!=null,"missing value"),Fe(typeof Vt=="boolean","missing or invalid endian"),Fe(Ne!=null,"missing offset"),Fe(Ne+7<se.length,"Trying to write beyond buffer length"),Ft(Me,17976931348623157e292,-17976931348623157e292)),se.length<=Ne||et.write(se,Me,Ne,Vt,52,8)}qe.Buffer=Ce,qe.SlowBuffer=Ce,qe.INSPECT_MAX_BYTES=50,Ce.poolSize=8192,Ce._useTypedArrays=function(){try{var se=new ArrayBuffer(0),Me=new Uint8Array(se);return Me.foo=function(){return 42},Me.foo()===42&&typeof Me.subarray=="function"}catch{return!1}}(),Ce.isEncoding=function(se){switch(String(se).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Ce.isBuffer=function(se){return!(se==null||!se._isBuffer)},Ce.byteLength=function(se,Me){var Ne;switch(se+="",Me||"utf8"){case"hex":Ne=se.length/2;break;case"utf8":case"utf-8":Ne=wt(se).length;break;case"ascii":case"binary":case"raw":Ne=se.length;break;case"base64":Ne=_t(se).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Ne=2*se.length;break;default:throw new Error("Unknown encoding")}return Ne},Ce.concat=function(se,Me){if(Fe(je(se),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),se.length===0)return new Ce(0);if(se.length===1)return se[0];if(typeof Me!="number")for(Kt=Me=0;Kt<se.length;Kt++)Me+=se[Kt].length;for(var Ne=new Ce(Me),Vt=0,Kt=0;Kt<se.length;Kt++){var fn=se[Kt];fn.copy(Ne,Vt),Vt+=fn.length}return Ne},Ce.prototype.write=function(se,Me,Ne,Vt){var Kt;isFinite(Me)?isFinite(Ne)||(Vt=Ne,Ne=void 0):(Kt=Vt,Vt=Me,Me=Ne,Ne=Kt),Me=Number(Me)||0;var fn,ri,In,Qi,qi,Ki,qr,dr=this.length-Me;switch((!Ne||dr<(Ne=Number(Ne)))&&(Ne=dr),Vt=String(Vt||"utf8").toLowerCase()){case"hex":fn=function(ar,Ko,Za,gr){Za=Number(Za)||0;var Ae=ar.length-Za;(!gr||Ae<(gr=Number(gr)))&&(gr=Ae);var Ji=Ko.length;Fe(Ji%2==0,"Invalid hex string"),Ji/2<gr&&(gr=Ji/2);for(var Er=0;Er<gr;Er++){var gs=parseInt(Ko.substr(2*Er,2),16);Fe(!isNaN(gs),"Invalid hex string"),ar[Za+Er]=gs}return Ce._charsWritten=2*Er,Er}(this,se,Me,Ne);break;case"utf8":case"utf-8":qi=se,Ki=Me,qr=Ne,fn=Ce._charsWritten=Dt(wt(qi),this,Ki,qr);break;case"ascii":case"binary":fn=function(ar,Ko,Za,gr){return Ce._charsWritten=Dt(function(Ae){for(var Ji=[],Er=0;Er<Ae.length;Er++)Ji.push(255&Ae.charCodeAt(Er));return Ji}(Ko),ar,Za,gr)}(this,se,Me,Ne);break;case"base64":ri=se,In=Me,Qi=Ne,fn=Ce._charsWritten=Dt(_t(ri),this,In,Qi);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":fn=function(ar,Ko,Za,gr){return Ce._charsWritten=Dt(function(Ae){for(var Ji,Er,gs,xi=[],Di=0;Di<Ae.length;Di++)Er=(Ji=Ae.charCodeAt(Di))>>8,gs=Ji%256,xi.push(gs),xi.push(Er);return xi}(Ko),ar,Za,gr)}(this,se,Me,Ne);break;default:throw new Error("Unknown encoding")}return fn},Ce.prototype.toString=function(se,Me,Ne){var Vt,Kt,fn,ri,In=this;if(se=String(se||"utf8").toLowerCase(),Me=Number(Me)||0,(Ne=Ne!==void 0?Number(Ne):Ne=In.length)===Me)return"";switch(se){case"hex":Vt=function(Qi,qi,Ki){var qr=Qi.length;(!qi||qi<0)&&(qi=0),(!Ki||Ki<0||qr<Ki)&&(Ki=qr);for(var dr="",ar=qi;ar<Ki;ar++)dr+=ct(Qi[ar]);return dr}(In,Me,Ne);break;case"utf8":case"utf-8":Vt=function(Qi,qi,Ki){var qr="",dr="";Ki=Math.min(Qi.length,Ki);for(var ar=qi;ar<Ki;ar++)Qi[ar]<=127?(qr+=$e(dr)+String.fromCharCode(Qi[ar]),dr=""):dr+="%"+Qi[ar].toString(16);return qr+$e(dr)}(In,Me,Ne);break;case"ascii":case"binary":Vt=function(Qi,qi,Ki){var qr="";Ki=Math.min(Qi.length,Ki);for(var dr=qi;dr<Ki;dr++)qr+=String.fromCharCode(Qi[dr]);return qr}(In,Me,Ne);break;case"base64":Kt=In,ri=Ne,Vt=(fn=Me)===0&&ri===Kt.length?Ie.fromByteArray(Kt):Ie.fromByteArray(Kt.slice(fn,ri));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Vt=function(Qi,qi,Ki){for(var qr=Qi.slice(qi,Ki),dr="",ar=0;ar<qr.length;ar+=2)dr+=String.fromCharCode(qr[ar]+256*qr[ar+1]);return dr}(In,Me,Ne);break;default:throw new Error("Unknown encoding")}return Vt},Ce.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Ce.prototype.copy=function(se,Me,Ne,Vt){if(Ne=Ne||0,Vt||Vt===0||(Vt=this.length),Me=Me||0,Vt!==Ne&&se.length!==0&&this.length!==0){Fe(Ne<=Vt,"sourceEnd < sourceStart"),Fe(0<=Me&&Me<se.length,"targetStart out of bounds"),Fe(0<=Ne&&Ne<this.length,"sourceStart out of bounds"),Fe(0<=Vt&&Vt<=this.length,"sourceEnd out of bounds"),Vt>this.length&&(Vt=this.length),se.length-Me<Vt-Ne&&(Vt=se.length-Me+Ne);var Kt=Vt-Ne;if(Kt<100||!Ce._useTypedArrays)for(var fn=0;fn<Kt;fn++)se[fn+Me]=this[fn+Ne];else se._set(this.subarray(Ne,Ne+Kt),Me)}},Ce.prototype.slice=function(se,Me){var Ne=this.length;if(se=ce(se,Ne,0),Me=ce(Me,Ne,Ne),Ce._useTypedArrays)return Ce._augment(this.subarray(se,Me));for(var Vt=Me-se,Kt=new Ce(Vt,void 0,!0),fn=0;fn<Vt;fn++)Kt[fn]=this[fn+se];return Kt},Ce.prototype.get=function(se){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(se)},Ce.prototype.set=function(se,Me){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(se,Me)},Ce.prototype.readUInt8=function(se,Me){if(Me||(Fe(se!=null,"missing offset"),Fe(se<this.length,"Trying to read beyond buffer length")),!(se>=this.length))return this[se]},Ce.prototype.readUInt16LE=function(se,Me){return ht(this,se,!0,Me)},Ce.prototype.readUInt16BE=function(se,Me){return ht(this,se,!1,Me)},Ce.prototype.readUInt32LE=function(se,Me){return Ze(this,se,!0,Me)},Ce.prototype.readUInt32BE=function(se,Me){return Ze(this,se,!1,Me)},Ce.prototype.readInt8=function(se,Me){if(Me||(Fe(se!=null,"missing offset"),Fe(se<this.length,"Trying to read beyond buffer length")),!(se>=this.length))return 128&this[se]?-1*(255-this[se]+1):this[se]},Ce.prototype.readInt16LE=function(se,Me){return Ue(this,se,!0,Me)},Ce.prototype.readInt16BE=function(se,Me){return Ue(this,se,!1,Me)},Ce.prototype.readInt32LE=function(se,Me){return At(this,se,!0,Me)},Ce.prototype.readInt32BE=function(se,Me){return At(this,se,!1,Me)},Ce.prototype.readFloatLE=function(se,Me){return Bt(this,se,!0,Me)},Ce.prototype.readFloatBE=function(se,Me){return Bt(this,se,!1,Me)},Ce.prototype.readDoubleLE=function(se,Me){return Be(this,se,!0,Me)},Ce.prototype.readDoubleBE=function(se,Me){return Be(this,se,!1,Me)},Ce.prototype.writeUInt8=function(se,Me,Ne){Ne||(Fe(se!=null,"missing value"),Fe(Me!=null,"missing offset"),Fe(Me<this.length,"trying to write beyond buffer length"),Tt(se,255)),Me>=this.length||(this[Me]=se)},Ce.prototype.writeUInt16LE=function(se,Me,Ne){Qe(this,se,Me,!0,Ne)},Ce.prototype.writeUInt16BE=function(se,Me,Ne){Qe(this,se,Me,!1,Ne)},Ce.prototype.writeUInt32LE=function(se,Me,Ne){Z(this,se,Me,!0,Ne)},Ce.prototype.writeUInt32BE=function(se,Me,Ne){Z(this,se,Me,!1,Ne)},Ce.prototype.writeInt8=function(se,Me,Ne){Ne||(Fe(se!=null,"missing value"),Fe(Me!=null,"missing offset"),Fe(Me<this.length,"Trying to write beyond buffer length"),Ct(se,127,-128)),Me>=this.length||(0<=se?this.writeUInt8(se,Me,Ne):this.writeUInt8(255+se+1,Me,Ne))},Ce.prototype.writeInt16LE=function(se,Me,Ne){$(this,se,Me,!0,Ne)},Ce.prototype.writeInt16BE=function(se,Me,Ne){$(this,se,Me,!1,Ne)},Ce.prototype.writeInt32LE=function(se,Me,Ne){ae(this,se,Me,!0,Ne)},Ce.prototype.writeInt32BE=function(se,Me,Ne){ae(this,se,Me,!1,Ne)},Ce.prototype.writeFloatLE=function(se,Me,Ne){Le(this,se,Me,!0,Ne)},Ce.prototype.writeFloatBE=function(se,Me,Ne){Le(this,se,Me,!1,Ne)},Ce.prototype.writeDoubleLE=function(se,Me,Ne){J(this,se,Me,!0,Ne)},Ce.prototype.writeDoubleBE=function(se,Me,Ne){J(this,se,Me,!1,Ne)},Ce.prototype.fill=function(se,Me,Ne){if(se=se||0,Me=Me||0,Ne=Ne||this.length,typeof se=="string"&&(se=se.charCodeAt(0)),Fe(typeof se=="number"&&!isNaN(se),"value is not a number"),Fe(Me<=Ne,"end < start"),Ne!==Me&&this.length!==0){Fe(0<=Me&&Me<this.length,"start out of bounds"),Fe(0<=Ne&&Ne<=this.length,"end out of bounds");for(var Vt=Me;Vt<Ne;Vt++)this[Vt]=se}},Ce.prototype.inspect=function(){for(var se=[],Me=this.length,Ne=0;Ne<Me;Ne++)if(se[Ne]=ct(this[Ne]),Ne===qe.INSPECT_MAX_BYTES){se[Ne+1]="...";break}return"<Buffer "+se.join(" ")+">"},Ce.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(Ce._useTypedArrays)return new Ce(this).buffer;for(var se=new Uint8Array(this.length),Me=0,Ne=se.length;Me<Ne;Me+=1)se[Me]=this[Me];return se.buffer};var te=Ce.prototype;function ce(se,Me,Ne){return typeof se!="number"?Ne:Me<=(se=~~se)?Me:0<=se||0<=(se+=Me)?se:0}function pe(se){return(se=~~Math.ceil(+se))<0?0:se}function je(se){return(Array.isArray||function(Me){return Object.prototype.toString.call(Me)==="[object Array]"})(se)}function ct(se){return se<16?"0"+se.toString(16):se.toString(16)}function wt(se){for(var Me=[],Ne=0;Ne<se.length;Ne++){var Vt=se.charCodeAt(Ne);if(Vt<=127)Me.push(se.charCodeAt(Ne));else{var Kt=Ne;55296<=Vt&&Vt<=57343&&Ne++;for(var fn=encodeURIComponent(se.slice(Kt,Ne+1)).substr(1).split("%"),ri=0;ri<fn.length;ri++)Me.push(parseInt(fn[ri],16))}}return Me}function _t(se){return Ie.toByteArray(se)}function Dt(se,Me,Ne,Vt){for(var Kt=0;Kt<Vt&&!(Kt+Ne>=Me.length||Kt>=se.length);Kt++)Me[Kt+Ne]=se[Kt];return Kt}function $e(se){try{return decodeURIComponent(se)}catch{return String.fromCharCode(65533)}}function Tt(se,Me){Fe(typeof se=="number","cannot write a non-number as a number"),Fe(0<=se,"specified a negative value for writing an unsigned value"),Fe(se<=Me,"value is larger than maximum value for type"),Fe(Math.floor(se)===se,"value has a fractional component")}function Ct(se,Me,Ne){Fe(typeof se=="number","cannot write a non-number as a number"),Fe(se<=Me,"value larger than maximum allowed value"),Fe(Ne<=se,"value smaller than minimum allowed value"),Fe(Math.floor(se)===se,"value has a fractional component")}function Ft(se,Me,Ne){Fe(typeof se=="number","cannot write a non-number as a number"),Fe(se<=Me,"value larger than maximum allowed value"),Fe(Ne<=se,"value smaller than minimum allowed value")}function Fe(se,Me){if(!se)throw new Error(Me||"Failed assertion")}Ce._augment=function(se){return se._isBuffer=!0,se._get=se.get,se._set=se.set,se.get=te.get,se.set=te.set,se.write=te.write,se.toString=te.toString,se.toLocaleString=te.toString,se.toJSON=te.toJSON,se.copy=te.copy,se.slice=te.slice,se.readUInt8=te.readUInt8,se.readUInt16LE=te.readUInt16LE,se.readUInt16BE=te.readUInt16BE,se.readUInt32LE=te.readUInt32LE,se.readUInt32BE=te.readUInt32BE,se.readInt8=te.readInt8,se.readInt16LE=te.readInt16LE,se.readInt16BE=te.readInt16BE,se.readInt32LE=te.readInt32LE,se.readInt32BE=te.readInt32BE,se.readFloatLE=te.readFloatLE,se.readFloatBE=te.readFloatBE,se.readDoubleLE=te.readDoubleLE,se.readDoubleBE=te.readDoubleBE,se.writeUInt8=te.writeUInt8,se.writeUInt16LE=te.writeUInt16LE,se.writeUInt16BE=te.writeUInt16BE,se.writeUInt32LE=te.writeUInt32LE,se.writeUInt32BE=te.writeUInt32BE,se.writeInt8=te.writeInt8,se.writeInt16LE=te.writeInt16LE,se.writeInt16BE=te.writeInt16BE,se.writeInt32LE=te.writeInt32LE,se.writeInt32BE=te.writeInt32BE,se.writeFloatLE=te.writeFloatLE,se.writeFloatBE=te.writeFloatBE,se.writeDoubleLE=te.writeDoubleLE,se.writeDoubleBE=te.writeDoubleBE,se.fill=te.fill,se.inspect=te.inspect,se.toArrayBuffer=te.toArrayBuffer,se}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){He=V("buffer").Buffer;var Ie=new He(4);Ie.fill(0),p.exports={hash:function(et,Ce,ht,Ze){return He.isBuffer(et)||(et=new He(et)),function(Ue,At,Bt){for(var Be=new He(At),Qe=Bt?Be.writeInt32BE:Be.writeInt32LE,Z=0;Z<Ue.length;Z++)Qe.call(Be,Ue[Z],4*Z,!0);return Be}(Ce(function(Ue,At){var Bt;Ue.length%4!=0&&(Bt=Ue.length+(4-Ue.length%4),Ue=He.concat([Ue,Ie],Bt));for(var Be=[],Qe=At?Ue.readInt32BE:Ue.readInt32LE,Z=0;Z<Ue.length;Z+=4)Be.push(Qe.call(Ue,Z));return Be}(et,Ze),8*et.length),ht,Ze)}}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){He=V("buffer").Buffer;var Ie=V("./sha"),et=V("./sha256"),Ce=V("./rng"),ht={sha1:Ie,sha256:et,md5:V("./md5")},Ze=64,Ue=new He(Ze);function At(Be,Qe){var Z=ht[Be=Be||"sha1"],$=[];return Z||Bt("algorithm:",Be,"is not yet supported"),{update:function(ae){return He.isBuffer(ae)||(ae=new He(ae)),$.push(ae),ae.length,this},digest:function(ae){var Le=He.concat($),J=Qe?function(te,ce,pe){He.isBuffer(ce)||(ce=new He(ce)),He.isBuffer(pe)||(pe=new He(pe)),ce.length>Ze?ce=te(ce):ce.length<Ze&&(ce=He.concat([ce,Ue],Ze));for(var je=new He(Ze),ct=new He(Ze),wt=0;wt<Ze;wt++)je[wt]=54^ce[wt],ct[wt]=92^ce[wt];var _t=te(He.concat([je,pe]));return te(He.concat([ct,_t]))}(Z,Qe,Le):Z(Le);return $=null,ae?J.toString(ae):J}}}function Bt(){var Be=[].slice.call(arguments).join(" ");throw new Error([Be,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Ue.fill(0),qe.createHash=function(Be){return At(Be)},qe.createHmac=At,qe.randomBytes=function(Be,Qe){if(!Qe||!Qe.call)return new He(Ce(Be));try{Qe.call(this,void 0,new He(Ce(Be)))}catch(Z){Qe(Z)}},function(Be,Qe){for(var Z in Be)Qe(Be[Z])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(Be){qe[Be]=function(){Bt("sorry,",Be,"is not implemented yet")}})}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){var Ie=V("./helpers");function et(Be,Qe){Be[Qe>>5]|=128<<Qe%32,Be[14+(Qe+64>>>9<<4)]=Qe;for(var Z=1732584193,$=-271733879,ae=-1732584194,Le=271733878,J=0;J<Be.length;J+=16){var te=Z,ce=$,pe=ae,je=Le;Z=ht(Z,$,ae,Le,Be[J+0],7,-680876936),Le=ht(Le,Z,$,ae,Be[J+1],12,-389564586),ae=ht(ae,Le,Z,$,Be[J+2],17,606105819),$=ht($,ae,Le,Z,Be[J+3],22,-1044525330),Z=ht(Z,$,ae,Le,Be[J+4],7,-176418897),Le=ht(Le,Z,$,ae,Be[J+5],12,1200080426),ae=ht(ae,Le,Z,$,Be[J+6],17,-1473231341),$=ht($,ae,Le,Z,Be[J+7],22,-45705983),Z=ht(Z,$,ae,Le,Be[J+8],7,1770035416),Le=ht(Le,Z,$,ae,Be[J+9],12,-1958414417),ae=ht(ae,Le,Z,$,Be[J+10],17,-42063),$=ht($,ae,Le,Z,Be[J+11],22,-1990404162),Z=ht(Z,$,ae,Le,Be[J+12],7,1804603682),Le=ht(Le,Z,$,ae,Be[J+13],12,-40341101),ae=ht(ae,Le,Z,$,Be[J+14],17,-1502002290),Z=Ze(Z,$=ht($,ae,Le,Z,Be[J+15],22,1236535329),ae,Le,Be[J+1],5,-165796510),Le=Ze(Le,Z,$,ae,Be[J+6],9,-1069501632),ae=Ze(ae,Le,Z,$,Be[J+11],14,643717713),$=Ze($,ae,Le,Z,Be[J+0],20,-373897302),Z=Ze(Z,$,ae,Le,Be[J+5],5,-701558691),Le=Ze(Le,Z,$,ae,Be[J+10],9,38016083),ae=Ze(ae,Le,Z,$,Be[J+15],14,-660478335),$=Ze($,ae,Le,Z,Be[J+4],20,-405537848),Z=Ze(Z,$,ae,Le,Be[J+9],5,568446438),Le=Ze(Le,Z,$,ae,Be[J+14],9,-1019803690),ae=Ze(ae,Le,Z,$,Be[J+3],14,-187363961),$=Ze($,ae,Le,Z,Be[J+8],20,1163531501),Z=Ze(Z,$,ae,Le,Be[J+13],5,-1444681467),Le=Ze(Le,Z,$,ae,Be[J+2],9,-51403784),ae=Ze(ae,Le,Z,$,Be[J+7],14,1735328473),Z=Ue(Z,$=Ze($,ae,Le,Z,Be[J+12],20,-1926607734),ae,Le,Be[J+5],4,-378558),Le=Ue(Le,Z,$,ae,Be[J+8],11,-2022574463),ae=Ue(ae,Le,Z,$,Be[J+11],16,1839030562),$=Ue($,ae,Le,Z,Be[J+14],23,-35309556),Z=Ue(Z,$,ae,Le,Be[J+1],4,-1530992060),Le=Ue(Le,Z,$,ae,Be[J+4],11,1272893353),ae=Ue(ae,Le,Z,$,Be[J+7],16,-155497632),$=Ue($,ae,Le,Z,Be[J+10],23,-1094730640),Z=Ue(Z,$,ae,Le,Be[J+13],4,681279174),Le=Ue(Le,Z,$,ae,Be[J+0],11,-358537222),ae=Ue(ae,Le,Z,$,Be[J+3],16,-722521979),$=Ue($,ae,Le,Z,Be[J+6],23,76029189),Z=Ue(Z,$,ae,Le,Be[J+9],4,-640364487),Le=Ue(Le,Z,$,ae,Be[J+12],11,-421815835),ae=Ue(ae,Le,Z,$,Be[J+15],16,530742520),Z=At(Z,$=Ue($,ae,Le,Z,Be[J+2],23,-995338651),ae,Le,Be[J+0],6,-198630844),Le=At(Le,Z,$,ae,Be[J+7],10,1126891415),ae=At(ae,Le,Z,$,Be[J+14],15,-1416354905),$=At($,ae,Le,Z,Be[J+5],21,-57434055),Z=At(Z,$,ae,Le,Be[J+12],6,1700485571),Le=At(Le,Z,$,ae,Be[J+3],10,-1894986606),ae=At(ae,Le,Z,$,Be[J+10],15,-1051523),$=At($,ae,Le,Z,Be[J+1],21,-2054922799),Z=At(Z,$,ae,Le,Be[J+8],6,1873313359),Le=At(Le,Z,$,ae,Be[J+15],10,-30611744),ae=At(ae,Le,Z,$,Be[J+6],15,-1560198380),$=At($,ae,Le,Z,Be[J+13],21,1309151649),Z=At(Z,$,ae,Le,Be[J+4],6,-145523070),Le=At(Le,Z,$,ae,Be[J+11],10,-1120210379),ae=At(ae,Le,Z,$,Be[J+2],15,718787259),$=At($,ae,Le,Z,Be[J+9],21,-343485551),Z=Bt(Z,te),$=Bt($,ce),ae=Bt(ae,pe),Le=Bt(Le,je)}return Array(Z,$,ae,Le)}function Ce(Be,Qe,Z,$,ae,Le){return Bt((J=Bt(Bt(Qe,Be),Bt($,Le)))<<(te=ae)|J>>>32-te,Z);var J,te}function ht(Be,Qe,Z,$,ae,Le,J){return Ce(Qe&Z|~Qe&$,Be,Qe,ae,Le,J)}function Ze(Be,Qe,Z,$,ae,Le,J){return Ce(Qe&$|Z&~$,Be,Qe,ae,Le,J)}function Ue(Be,Qe,Z,$,ae,Le,J){return Ce(Qe^Z^$,Be,Qe,ae,Le,J)}function At(Be,Qe,Z,$,ae,Le,J){return Ce(Z^(Qe|~$),Be,Qe,ae,Le,J)}function Bt(Be,Qe){var Z=(65535&Be)+(65535&Qe);return(Be>>16)+(Qe>>16)+(Z>>16)<<16|65535&Z}p.exports=function(Be){return Ie.hash(Be,et,16)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){var Ie;Ie=function(et){for(var Ce,ht=new Array(et),Ze=0;Ze<et;Ze++)!(3&Ze)&&(Ce=4294967296*Math.random()),ht[Ze]=Ce>>>((3&Ze)<<3)&255;return ht},p.exports=Ie}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){var Ie=V("./helpers");function et(Ze,Ue){Ze[Ue>>5]|=128<<24-Ue%32,Ze[15+(Ue+64>>9<<4)]=Ue;for(var At,Bt,Be,Qe,Z,$=Array(80),ae=1732584193,Le=-271733879,J=-1732584194,te=271733878,ce=-1009589776,pe=0;pe<Ze.length;pe+=16){for(var je=ae,ct=Le,wt=J,_t=te,Dt=ce,$e=0;$e<80;$e++){$[$e]=$e<16?Ze[pe+$e]:ht($[$e-3]^$[$e-8]^$[$e-14]^$[$e-16],1);var Tt=Ce(Ce(ht(ae,5),(Be=Le,Qe=J,Z=te,(Bt=$e)<20?Be&Qe|~Be&Z:!(Bt<40)&&Bt<60?Be&Qe|Be&Z|Qe&Z:Be^Qe^Z)),Ce(Ce(ce,$[$e]),(At=$e)<20?1518500249:At<40?1859775393:At<60?-1894007588:-899497514));ce=te,te=J,J=ht(Le,30),Le=ae,ae=Tt}ae=Ce(ae,je),Le=Ce(Le,ct),J=Ce(J,wt),te=Ce(te,_t),ce=Ce(ce,Dt)}return Array(ae,Le,J,te,ce)}function Ce(Ze,Ue){var At=(65535&Ze)+(65535&Ue);return(Ze>>16)+(Ue>>16)+(At>>16)<<16|65535&At}function ht(Ze,Ue){return Ze<<Ue|Ze>>>32-Ue}p.exports=function(Ze){return Ie.hash(Ze,et,20,!0)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){function Ie(Ze,Ue){var At=(65535&Ze)+(65535&Ue);return(Ze>>16)+(Ue>>16)+(At>>16)<<16|65535&At}function et(Ze,Ue){return Ze>>>Ue|Ze<<32-Ue}function Ce(Ze,Ue){var At,Bt,Be,Qe,Z,$,ae,Le,J,te,ce=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),pe=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),je=new Array(64);Ze[Ue>>5]|=128<<24-Ue%32,Ze[15+(Ue+64>>9<<4)]=Ue;for(var ct,wt,_t,Dt,$e,Tt,Ct,Ft,Fe=0;Fe<Ze.length;Fe+=16){At=pe[0],Bt=pe[1],Be=pe[2],Qe=pe[3],Z=pe[4],$=pe[5],ae=pe[6],Le=pe[7];for(var se=0;se<64;se++)je[se]=se<16?Ze[se+Fe]:Ie(Ie(Ie(et(Ft=je[se-2],17)^et(Ft,19)^Ft>>>10,je[se-7]),et(Ct=je[se-15],7)^et(Ct,18)^Ct>>>3),je[se-16]),J=Ie(Ie(Ie(Ie(Le,et(Tt=Z,6)^et(Tt,11)^et(Tt,25)),($e=Z)&$^~$e&ae),ce[se]),je[se]),te=Ie(et(Dt=At,2)^et(Dt,13)^et(Dt,22),(ct=At)&(wt=Bt)^ct&(_t=Be)^wt&_t),Le=ae,ae=$,$=Z,Z=Ie(Qe,J),Qe=Be,Be=Bt,Bt=At,At=Ie(J,te);pe[0]=Ie(At,pe[0]),pe[1]=Ie(Bt,pe[1]),pe[2]=Ie(Be,pe[2]),pe[3]=Ie(Qe,pe[3]),pe[4]=Ie(Z,pe[4]),pe[5]=Ie($,pe[5]),pe[6]=Ie(ae,pe[6]),pe[7]=Ie(Le,pe[7])}return pe}var ht=V("./helpers");p.exports=function(Ze){return ht.hash(Ze,Ce,32,!0)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){function Ie(){}(Je=p.exports={}).nextTick=function(){var et=typeof window<"u"&&window.setImmediate,Ce=typeof window<"u"&&window.postMessage&&window.addEventListener;if(et)return function(Ze){return window.setImmediate(Ze)};if(Ce){var ht=[];return window.addEventListener("message",function(Ze){var Ue=Ze.source;Ue!==window&&Ue!==null||Ze.data!=="process-tick"||(Ze.stopPropagation(),0<ht.length&&ht.shift()())},!0),function(Ze){ht.push(Ze),window.postMessage("process-tick","*")}}return function(Ze){setTimeout(Ze,0)}}(),Je.title="browser",Je.browser=!0,Je.env={},Je.argv=[],Je.on=Ie,Je.addListener=Ie,Je.once=Ie,Je.off=Ie,Je.removeListener=Ie,Je.removeAllListeners=Ie,Je.emit=Ie,Je.binding=function(et){throw new Error("process.binding is not supported")},Je.cwd=function(){return"/"},Je.chdir=function(et){throw new Error("process.chdir is not supported")}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(V,p,qe){(function(Je,Ke,He,ft,Xe,st,mt,bt,at){qe.read=function(Ie,et,Ce,ht,Ze){var Ue,At,Bt=8*Ze-ht-1,Be=(1<<Bt)-1,Qe=Be>>1,Z=-7,$=Ce?Ze-1:0,ae=Ce?-1:1,Le=Ie[et+$];for($+=ae,Ue=Le&(1<<-Z)-1,Le>>=-Z,Z+=Bt;0<Z;Ue=256*Ue+Ie[et+$],$+=ae,Z-=8);for(At=Ue&(1<<-Z)-1,Ue>>=-Z,Z+=ht;0<Z;At=256*At+Ie[et+$],$+=ae,Z-=8);if(Ue===0)Ue=1-Qe;else{if(Ue===Be)return At?NaN:1/0*(Le?-1:1);At+=Math.pow(2,ht),Ue-=Qe}return(Le?-1:1)*At*Math.pow(2,Ue-ht)},qe.write=function(Ie,et,Ce,ht,Ze,Ue){var At,Bt,Be,Qe=8*Ue-Ze-1,Z=(1<<Qe)-1,$=Z>>1,ae=Ze===23?Math.pow(2,-24)-Math.pow(2,-77):0,Le=ht?0:Ue-1,J=ht?1:-1,te=et<0||et===0&&1/et<0?1:0;for(et=Math.abs(et),isNaN(et)||et===1/0?(Bt=isNaN(et)?1:0,At=Z):(At=Math.floor(Math.log(et)/Math.LN2),et*(Be=Math.pow(2,-At))<1&&(At--,Be*=2),2<=(et+=1<=At+$?ae/Be:ae*Math.pow(2,1-$))*Be&&(At++,Be/=2),Z<=At+$?(Bt=0,At=Z):1<=At+$?(Bt=(et*Be-1)*Math.pow(2,Ze),At+=$):(Bt=et*Math.pow(2,$-1)*Math.pow(2,Ze),At=0));8<=Ze;Ie[Ce+Le]=255&Bt,Le+=J,Bt/=256,Ze-=8);for(At=At<<Ze|Bt,Qe+=Ze;0<Qe;Ie[Ce+Le]=255&At,Le+=J,At/=256,Qe-=8);Ie[Ce+Le-J]|=128*te}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(St){var V=function(){function p(Ce){return mt(Ce,bt(st(at(Ce.length),Ce),1/Ce.length))}function qe(Ce){return st(Ie(Ce),Ce)}function Je(Ce,ht){return bt(Ce,ht?1/(Ce.length-1):1/Ce.length)}function Ke(Ce){var ht=function(Ue){var At,Bt=Math.pow(2,-52),Be=1e-64/Bt,Qe=0,Z=0,$=0,ae=0,Le=0,J=et(Ue),te=J.length,ce=J[0].length;if(te<ce)throw"Need more rows than columns";var pe=new Array(ce),je=new Array(ce);for(Z=0;Z<ce;Z++)pe[Z]=je[Z]=0;var ct=function Vt(Kt,fn,ri){ri===void 0&&(ri=0);var In,Qi=Kt[ri],qi=Array(Qi);if(ri===Kt.length-1){for(In=Qi-2;In>=0;In-=2)qi[In+1]=fn,qi[In]=fn;return In===-1&&(qi[0]=fn),qi}for(In=Qi-1;In>=0;In--)qi[In]=Vt(Kt,fn,ri+1);return qi}([ce,ce],0);function wt(Vt,Kt){return(Vt=Math.abs(Vt))>(Kt=Math.abs(Kt))?Vt*Math.sqrt(1+Kt*Kt/Vt/Vt):Kt==0?Vt:Kt*Math.sqrt(1+Vt*Vt/Kt/Kt)}var _t=0,Dt=0,$e=0,Tt=0,Ct=0,Ft=0,Fe=0;for(Z=0;Z<ce;Z++){for(pe[Z]=Dt,Fe=0,Le=Z+1,$=Z;$<te;$++)Fe+=J[$][Z]*J[$][Z];if(Fe<=Be)Dt=0;else for(_t=J[Z][Z],Dt=Math.sqrt(Fe),_t>=0&&(Dt=-Dt),$e=_t*Dt-Fe,J[Z][Z]=_t-Dt,$=Le;$<ce;$++){for(Fe=0,ae=Z;ae<te;ae++)Fe+=J[ae][Z]*J[ae][$];for(_t=Fe/$e,ae=Z;ae<te;ae++)J[ae][$]+=_t*J[ae][Z]}for(je[Z]=Dt,Fe=0,$=Le;$<ce;$++)Fe+=J[Z][$]*J[Z][$];if(Fe<=Be)Dt=0;else{for(_t=J[Z][Z+1],Dt=Math.sqrt(Fe),_t>=0&&(Dt=-Dt),$e=_t*Dt-Fe,J[Z][Z+1]=_t-Dt,$=Le;$<ce;$++)pe[$]=J[Z][$]/$e;for($=Le;$<te;$++){for(Fe=0,ae=Le;ae<ce;ae++)Fe+=J[$][ae]*J[Z][ae];for(ae=Le;ae<ce;ae++)J[$][ae]+=Fe*pe[ae]}}(Ct=Math.abs(je[Z])+Math.abs(pe[Z]))>Tt&&(Tt=Ct)}for(Z=ce-1;Z!=-1;Z+=-1){if(Dt!=0){for($e=Dt*J[Z][Z+1],$=Le;$<ce;$++)ct[$][Z]=J[Z][$]/$e;for($=Le;$<ce;$++){for(Fe=0,ae=Le;ae<ce;ae++)Fe+=J[Z][ae]*ct[ae][$];for(ae=Le;ae<ce;ae++)ct[ae][$]+=Fe*ct[ae][Z]}}for($=Le;$<ce;$++)ct[Z][$]=0,ct[$][Z]=0;ct[Z][Z]=1,Dt=pe[Z],Le=Z}for(Z=ce-1;Z!=-1;Z+=-1){for(Le=Z+1,Dt=je[Z],$=Le;$<ce;$++)J[Z][$]=0;if(Dt!=0){for($e=J[Z][Z]*Dt,$=Le;$<ce;$++){for(Fe=0,ae=Le;ae<te;ae++)Fe+=J[ae][Z]*J[ae][$];for(_t=Fe/$e,ae=Z;ae<te;ae++)J[ae][$]+=_t*J[ae][Z]}for($=Z;$<te;$++)J[$][Z]=J[$][Z]/Dt}else for($=Z;$<te;$++)J[$][Z]=0;J[Z][Z]+=1}for(Bt*=Tt,ae=ce-1;ae!=-1;ae+=-1)for(var se=0;se<50;se++){var Me=!1;for(Le=ae;Le!=-1;Le+=-1){if(Math.abs(pe[Le])<=Bt){Me=!0;break}if(Math.abs(je[Le-1])<=Bt)break}if(!Me){Qe=0,Fe=1;var Ne=Le-1;for(Z=Le;Z<ae+1&&(_t=Fe*pe[Z],pe[Z]=Qe*pe[Z],!(Math.abs(_t)<=Bt));Z++)for($e=wt(_t,Dt=je[Z]),je[Z]=$e,Qe=Dt/$e,Fe=-_t/$e,$=0;$<te;$++)Ct=J[$][Ne],Ft=J[$][Z],J[$][Ne]=Ct*Qe+Ft*Fe,J[$][Z]=-Ct*Fe+Ft*Qe}if(Ft=je[ae],Le==ae){if(Ft<0)for(je[ae]=-Ft,$=0;$<ce;$++)ct[$][ae]=-ct[$][ae];break}if(se>=49)throw"Error: no convergence.";for(Tt=je[Le],Dt=wt(_t=(((Ct=je[ae-1])-Ft)*(Ct+Ft)+((Dt=pe[ae-1])-($e=pe[ae]))*(Dt+$e))/(2*$e*Ct),1),_t=_t<0?((Tt-Ft)*(Tt+Ft)+$e*(Ct/(_t-Dt)-$e))/Tt:((Tt-Ft)*(Tt+Ft)+$e*(Ct/(_t+Dt)-$e))/Tt,Qe=1,Fe=1,Z=Le+1;Z<ae+1;Z++){for(Dt=pe[Z],Ct=je[Z],$e=Fe*Dt,Dt*=Qe,Ft=wt(_t,$e),pe[Z-1]=Ft,_t=Tt*(Qe=_t/Ft)+Dt*(Fe=$e/Ft),Dt=-Tt*Fe+Dt*Qe,$e=Ct*Fe,Ct*=Qe,$=0;$<ce;$++)Tt=ct[$][Z-1],Ft=ct[$][Z],ct[$][Z-1]=Tt*Qe+Ft*Fe,ct[$][Z]=-Tt*Fe+Ft*Qe;for(Ft=wt(_t,$e),je[Z-1]=Ft,_t=(Qe=_t/Ft)*Dt+(Fe=$e/Ft)*Ct,Tt=-Fe*Dt+Qe*Ct,$=0;$<te;$++)Ct=J[$][Z-1],Ft=J[$][Z],J[$][Z-1]=Ct*Qe+Ft*Fe,J[$][Z]=-Ct*Fe+Ft*Qe}pe[Le]=0,pe[ae]=_t,je[ae]=Tt}for(Z=0;Z<je.length;Z++)je[Z]<Bt&&(je[Z]=0);for(Z=0;Z<ce;Z++)for($=Z-1;$>=0;$--)if(je[$]<je[Z]){for(Qe=je[$],je[$]=je[Z],je[Z]=Qe,ae=0;ae<J.length;ae++)At=J[ae][Z],J[ae][Z]=J[ae][$],J[ae][$]=At;for(ae=0;ae<ct.length;ae++)At=ct[ae][Z],ct[ae][Z]=ct[ae][$],ct[ae][$]=At;Z=$}return{U:J,S:je,V:ct}}(Ce);console.log(ht);var Ze=ht.U;return ht.S.map(function(Ue,At){var Bt={};return Bt.eigenvalue=Ue,Bt.vector=Ze.map(function(Be,Qe){return-1*Be[At]}),Bt})}function He(Ce,...ht){var Ze=ht.map(function(Bt){return Bt.vector}),Ue=st(Ze,Ie(p(Ce))),At=bt(st(at(Ce.length),Ce),-1/Ce.length);return{adjustedData:Ue,formattedAdjustedData:Xe(Ue,2),avgData:At,selectedVectors:Ze}}function ft(Ce){return Ke(Je(qe(p(Ce)),!1))}function Xe(Ce,ht){var Ze=Math.pow(10,ht||2);return Ce.map(function(Ue,At){return Ue.map(function(Bt){return Math.round(Bt*Ze)/Ze})})}function st(Ce,ht){if(!(Ce[0]&&ht[0]&&Ce.length&&ht.length))throw new Error("Both A and B should be matrices");if(ht.length!==Ce[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var Ze=[],Ue=0;Ue<Ce.length;Ue++){Ze[Ue]=[];for(var At=0;At<ht[0].length;At++)for(var Bt=0;Bt<Ce[0].length;Bt++)Ze[Ue][At]=Ze[Ue][At]?Ze[Ue][At]+Ce[Ue][Bt]*ht[Bt][At]:Ce[Ue][Bt]*ht[Bt][At]}return Ze}function mt(Ce,ht){if(Ce.length!==ht.length||Ce[0].length!==ht[0].length)throw new Error("Both A and B should have the same dimensions");for(var Ze=[],Ue=0;Ue<Ce.length;Ue++){Ze[Ue]=[];for(var At=0;At<ht[0].length;At++)Ze[Ue][At]=Ce[Ue][At]-ht[Ue][At]}return Ze}function bt(Ce,ht){for(var Ze=[],Ue=0;Ue<Ce.length;Ue++){Ze[Ue]=[];for(var At=0;At<Ce[0].length;At++)Ze[Ue][At]=Ce[Ue][At]*ht}return Ze}function at(Ce){for(var ht=[],Ze=0;Ze<Ce;Ze++){ht[Ze]=[];for(var Ue=0;Ue<Ce;Ue++)ht[Ze][Ue]=1}return ht}function Ie(Ce){return et(Ce)[0].map(function(ht,Ze){return Ce.map(function(Ue){return Ue[Ze]})})}function et(Ce){var ht=JSON.stringify(Ce);return JSON.parse(ht)}return{computeDeviationScores:qe,computeDeviationMatrix:p,computeSVD:Ke,computePercentageExplained:function(Ce,...ht){var Ze=Ce.map(function(Ue){return Ue.eigenvalue}).reduce(function(Ue,At){return Ue+At});return ht.map(function(Ue){return Ue.eigenvalue}).reduce(function(Ue,At){return Ue+At})/Ze},computeOriginalData:function(Ce,ht,Ze){var Ue=mt(Ie(st(Ie(ht),Ce)),Ze);return{originalData:Ue,formattedOriginalData:Xe(Ue,2)}},computeVarianceCovariance:Je,computeAdjustedData:He,getEigenVectors:ft,analyseTopResult:function(Ce){var ht=ft(Ce).sort(function(Ze,Ue){return Ue.eigenvalue-Ze.eigenvalue});return console.log("Sorted Vectors",ht),He(Ce,ht[0].vector)},transpose:Ie,multiply:st,clone:et,scale:bt}}();St.exports=V},701:function(St){var V=[];function p(Ke){for(var He=-1,ft=0;ft<V.length;ft++)if(V[ft].identifier===Ke){He=ft;break}return He}function qe(Ke,He){for(var ft={},Xe=[],st=0;st<Ke.length;st++){var mt=Ke[st],bt=He.base?mt[0]+He.base:mt[0],at=ft[bt]||0,Ie="".concat(bt," ").concat(at);ft[bt]=at+1;var et=p(Ie),Ce={css:mt[1],media:mt[2],sourceMap:mt[3],supports:mt[4],layer:mt[5]};if(et!==-1)V[et].references++,V[et].updater(Ce);else{var ht=Je(Ce,He);He.byIndex=st,V.splice(st,0,{identifier:Ie,updater:ht,references:1})}Xe.push(Ie)}return Xe}function Je(Ke,He){var ft=He.domAPI(He);return ft.update(Ke),function(Xe){if(Xe){if(Xe.css===Ke.css&&Xe.media===Ke.media&&Xe.sourceMap===Ke.sourceMap&&Xe.supports===Ke.supports&&Xe.layer===Ke.layer)return;ft.update(Ke=Xe)}else ft.remove()}}St.exports=function(Ke,He){var ft=qe(Ke=Ke||[],He=He||{});return function(Xe){Xe=Xe||[];for(var st=0;st<ft.length;st++){var mt=p(ft[st]);V[mt].references--}for(var bt=qe(Xe,He),at=0;at<ft.length;at++){var Ie=p(ft[at]);V[Ie].references===0&&(V[Ie].updater(),V.splice(Ie,1))}ft=bt}}},182:function(St){St.exports=function(V){var p=document.createElement("style");return V.setAttributes(p,V.attributes),V.insert(p,V.options),p}},850:function(St,V,p){St.exports=function(qe){var Je=p.nc;Je&&qe.setAttribute("nonce",Je)}},236:function(St){St.exports=function(V){var p=V.insertStyleElement(V);return{update:function(qe){(function(Je,Ke,He){var ft="";He.supports&&(ft+="@supports (".concat(He.supports,") {")),He.media&&(ft+="@media ".concat(He.media," {"));var Xe=He.layer!==void 0;Xe&&(ft+="@layer".concat(He.layer.length>0?" ".concat(He.layer):""," {")),ft+=He.css,Xe&&(ft+="}"),He.media&&(ft+="}"),He.supports&&(ft+="}");var st=He.sourceMap;st&&typeof btoa<"u"&&(ft+=`
/`,ft+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(st))))," *"),ft+="/"),Ke.styleTagTransform(ft,Je,Ke.options)})(p,V,qe)},remove:function(){(function(qe){if(qe.parentNode===null)return!1;qe.parentNode.removeChild(qe)})(p)}}}},213:function(St){St.exports=function(V,p){if(p.styleSheet)p.styleSheet.cssText=V;else{for(;p.firstChild;)p.removeChild(p.firstChild);p.appendChild(document.createTextNode(V))}}},1:function(St){St.exports=function(){var V={820:function(Ke,He,ft){var Xe=ft(537),st=ft.n(Xe),mt=ft(645),bt=ft.n(mt)()(st());bt.push([Ke.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),He.Z=bt},645:function(Ke){Ke.exports=function(He){var ft=[];return ft.toString=function(){return this.map(function(Xe){var st="",mt=Xe[5]!==void 0;return Xe[4]&&(st+="@supports (".concat(Xe[4],") {")),Xe[2]&&(st+="@media ".concat(Xe[2]," {")),mt&&(st+="@layer".concat(Xe[5].length>0?" ".concat(Xe[5]):""," {")),st+=He(Xe),mt&&(st+="}"),Xe[2]&&(st+="}"),Xe[4]&&(st+="}"),st}).join("")},ft.i=function(Xe,st,mt,bt,at){typeof Xe=="string"&&(Xe=[[null,Xe,void 0]]);var Ie={};if(mt)for(var et=0;et<this.length;et++){var Ce=this[et][0];Ce!=null&&(Ie[Ce]=!0)}for(var ht=0;ht<Xe.length;ht++){var Ze=[].concat(Xe[ht]);mt&&Ie[Ze[0]]||(at!==void 0&&(Ze[5]===void 0||(Ze[1]="@layer".concat(Ze[5].length>0?" ".concat(Ze[5]):""," {").concat(Ze[1],"}")),Ze[5]=at),st&&(Ze[2]&&(Ze[1]="@media ".concat(Ze[2]," {").concat(Ze[1],"}")),Ze[2]=st),bt&&(Ze[4]?(Ze[1]="@supports (".concat(Ze[4],") {").concat(Ze[1],"}"),Ze[4]=bt):Ze[4]="".concat(bt)),ft.push(Ze))}},ft}},537:function(Ke){Ke.exports=function(He){var ft=He[1],Xe=He[3];if(!Xe)return ft;if(typeof btoa=="function"){var st=btoa(unescape(encodeURIComponent(JSON.stringify(Xe)))),mt="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(st),bt="/*# ".concat(mt," */"),at=Xe.sources.map(function(Ie){return"/*# sourceURL=".concat(Xe.sourceRoot||"").concat(Ie," */")});return[ft].concat(at).concat([bt]).join(`
`)}return[ft].join(`
`)}},379:function(Ke){var He=[];function ft(mt){for(var bt=-1,at=0;at<He.length;at++)if(He[at].identifier===mt){bt=at;break}return bt}function Xe(mt,bt){for(var at={},Ie=[],et=0;et<mt.length;et++){var Ce=mt[et],ht=bt.base?Ce[0]+bt.base:Ce[0],Ze=at[ht]||0,Ue="".concat(ht," ").concat(Ze);at[ht]=Ze+1;var At=ft(Ue),Bt={css:Ce[1],media:Ce[2],sourceMap:Ce[3],supports:Ce[4],layer:Ce[5]};if(At!==-1)He[At].references++,He[At].updater(Bt);else{var Be=st(Bt,bt);bt.byIndex=et,He.splice(et,0,{identifier:Ue,updater:Be,references:1})}Ie.push(Ue)}return Ie}function st(mt,bt){var at=bt.domAPI(bt);return at.update(mt),function(Ie){if(Ie){if(Ie.css===mt.css&&Ie.media===mt.media&&Ie.sourceMap===mt.sourceMap&&Ie.supports===mt.supports&&Ie.layer===mt.layer)return;at.update(mt=Ie)}else at.remove()}}Ke.exports=function(mt,bt){var at=Xe(mt=mt||[],bt=bt||{});return function(Ie){Ie=Ie||[];for(var et=0;et<at.length;et++){var Ce=ft(at[et]);He[Ce].references--}for(var ht=Xe(Ie,bt),Ze=0;Ze<at.length;Ze++){var Ue=ft(at[Ze]);He[Ue].references===0&&(He[Ue].updater(),He.splice(Ue,1))}at=ht}}},216:function(Ke){Ke.exports=function(He){var ft=document.createElement("style");return He.setAttributes(ft,He.attributes),He.insert(ft,He.options),ft}},636:function(Ke,He,ft){Ke.exports=function(Xe){var st=ft.nc;st&&Xe.setAttribute("nonce",st)}},795:function(Ke){Ke.exports=function(He){var ft=He.insertStyleElement(He);return{update:function(Xe){(function(st,mt,bt){var at="";bt.supports&&(at+="@supports (".concat(bt.supports,") {")),bt.media&&(at+="@media ".concat(bt.media," {"));var Ie=bt.layer!==void 0;Ie&&(at+="@layer".concat(bt.layer.length>0?" ".concat(bt.layer):""," {")),at+=bt.css,Ie&&(at+="}"),bt.media&&(at+="}"),bt.supports&&(at+="}");var et=bt.sourceMap;et&&typeof btoa<"u"&&(at+=`
/`,at+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(et))))," *"),at+="/"),mt.styleTagTransform(at,st,mt.options)})(ft,He,Xe)},remove:function(){(function(Xe){if(Xe.parentNode===null)return!1;Xe.parentNode.removeChild(Xe)})(ft)}}}},589:function(Ke){Ke.exports=function(He,ft){if(ft.styleSheet)ft.styleSheet.cssText=He;else{for(;ft.firstChild;)ft.removeChild(ft.firstChild);ft.appendChild(document.createTextNode(He))}}}},p={};function qe(Ke){var He=p[Ke];if(He!==void 0)return He.exports;var ft=p[Ke]={id:Ke,exports:{}};return V[Ke](ft,ft.exports,qe),ft.exports}qe.n=function(Ke){var He=Ke&&Ke.__esModule?function(){return Ke.default}:function(){return Ke};return qe.d(He,{a:He}),He},qe.d=function(Ke,He){for(var ft in He)qe.o(He,ft)&&!qe.o(Ke,ft)&&Object.defineProperty(Ke,ft,{enumerable:!0,get:He[ft]})},qe.o=function(Ke,He){return Object.prototype.hasOwnProperty.call(Ke,He)},qe.nc=void 0;var Je={};return function(){qe.d(Je,{default:function(){return je}});var Ke=qe(379),He=qe.n(Ke),ft=qe(795),Xe=qe.n(ft),st=qe(636),mt=qe.n(st),bt=qe(216),at=qe.n(bt),Ie=qe(589),et=qe.n(Ie),Ce=qe(820),ht={};Ce.Z&&Ce.Z.locals&&(ht.locals=Ce.Z.locals);var Ze,Ue=0,At={};At.styleTagTransform=et(),At.setAttributes=mt(),At.insert=function(ct,wt){(wt.target||document.head).appendChild(ct)},At.domAPI=Xe(),At.insertStyleElement=at(),ht.use=function(ct){return At.options=ct||{},Ue++||(Ze=He()(Ce.Z,At)),ht},ht.unuse=function(){Ue>0&&!--Ue&&(Ze(),Ze=null)};var Bt=ht;function Be(ct,wt){return function(_t){if(Array.isArray(_t))return _t}(ct)||function(_t,Dt){var $e=_t==null?null:typeof Symbol<"u"&&_t[Symbol.iterator]||_t["@@iterator"];if($e!=null){var Tt,Ct,Ft=[],Fe=!0,se=!1;try{for($e=$e.call(_t);!(Fe=(Tt=$e.next()).done)&&(Ft.push(Tt.value),!Dt||Ft.length!==Dt);Fe=!0);}catch(Me){se=!0,Ct=Me}finally{try{Fe||$e.return==null||$e.return()}finally{if(se)throw Ct}}return Ft}}(ct,wt)||function(_t,Dt){if(_t){if(typeof _t=="string")return Qe(_t,Dt);var $e=Object.prototype.toString.call(_t).slice(8,-1);return $e==="Object"&&_t.constructor&&($e=_t.constructor.name),$e==="Map"||$e==="Set"?Array.from(_t):$e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($e)?Qe(_t,Dt):void 0}}(ct,wt)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Qe(ct,wt){(wt==null||wt>ct.length)&&(wt=ct.length);for(var _t=0,Dt=new Array(wt);_t<wt;_t++)Dt[_t]=ct[_t];return Dt}function Z(ct,wt){var _t=Object.keys(ct);if(Object.getOwnPropertySymbols){var Dt=Object.getOwnPropertySymbols(ct);wt&&(Dt=Dt.filter(function($e){return Object.getOwnPropertyDescriptor(ct,$e).enumerable})),_t.push.apply(_t,Dt)}return _t}function $(ct){for(var wt=1;wt<arguments.length;wt++){var _t=arguments[wt]!=null?arguments[wt]:{};wt%2?Z(Object(_t),!0).forEach(function(Dt){ae(ct,Dt,_t[Dt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ct,Object.getOwnPropertyDescriptors(_t)):Z(Object(_t)).forEach(function(Dt){Object.defineProperty(ct,Dt,Object.getOwnPropertyDescriptor(_t,Dt))})}return ct}function ae(ct,wt,_t){return wt in ct?Object.defineProperty(ct,wt,{value:_t,enumerable:!0,configurable:!0,writable:!0}):ct[wt]=_t,ct}function Le(ct,wt){for(var _t=0;_t<wt.length;_t++){var Dt=wt[_t];Dt.enumerable=Dt.enumerable||!1,Dt.configurable=!0,"value"in Dt&&(Dt.writable=!0),Object.defineProperty(ct,Dt.key,Dt)}}function J(ct){var wt={};return ct.reduce(function(_t,Dt){return wt[Dt]||(wt[Dt]=!0,_t.push(Dt)),_t},[])}function te(ct,wt){requestAnimationFrame(function(){wt.enter(),requestAnimationFrame(function(){wt.active(),setTimeout(function(){wt.leave()},ct)})})}function ce(ct,wt){try{var _t=ct.liElementsById[wt.parent.id];_t.classList.contains("treejs-node__close")||_t.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(wt,"parent")&&ce(ct,wt.parent)}function pe(ct,wt){var _t=ct.liElementsById[wt.id];_t.classList.contains("treejs-node__close")&&_t.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(wt,"children")&&wt.children.forEach(function(Dt){return pe(ct,Dt)})}var je=function(){function ct($e,Tt){(function(Ct,Ft){if(!(Ct instanceof Ft))throw new TypeError("Cannot call a class as a function")})(this,ct),Bt.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=$e,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},Tt),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(Ct){this.setValues(J(Ct))}},disables:{get:function(){return this.getDisables()},set:function(Ct){this.setDisables(J(Ct))}},selectedNodes:{get:function(){var Ct=[],Ft=this.nodesById;return Object.keys(Ft).forEach(function(Fe){if(Object.prototype.hasOwnProperty.call(Ft,Fe)&&(Ft[Fe].status===1||Ft[Fe].status===2)){var se=$({},Ft[Fe]);delete se.parent,delete se.children,Ct.push(se)}}),Ct}},disabledNodes:{get:function(){var Ct=[],Ft=this.nodesById;return Object.keys(Ft).forEach(function(Fe){if(Object.prototype.hasOwnProperty.call(Ft,Fe)&&Ft[Fe].disabled){var se=$({},Ft[Fe]);delete se.parent,Ct.push(se)}}),Ct}}}),this.init(this.options.data)}var wt,_t,Dt;return wt=ct,Dt=[{key:"onSwitcherClick",value:function($e){var Tt=$e.parentNode,Ct=Tt.lastChild,Ft=Ct.scrollHeight;Tt.classList.contains("treejs-node__close")?te(150,{enter:function(){Ct.style.height=0,Ct.style.opacity=0},active:function(){Ct.style.height="".concat(Ft,"px"),Ct.style.opacity=1},leave:function(){Ct.style.height="",Ct.style.opacity="",Tt.classList.remove("treejs-node__close")}}):te(150,{enter:function(){Ct.style.height="".concat(Ft,"px"),Ct.style.opacity=1},active:function(){Ct.style.height=0,Ct.style.opacity=0},leave:function(){Ct.style.height="",Ct.style.opacity="",Tt.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function($e){var Tt,Ct=(Tt=$e,JSON.parse(JSON.stringify(Tt))),Ft={},Fe={},se=[],Me=[];return function Ne(Vt,Kt){Vt.forEach(function(fn){Ft[fn.id]=fn,fn.checked&&se.push(fn.id),fn.disabled&&Me.push(fn.id),Kt&&(fn.parent=Kt),fn.children&&fn.children.length?Ne(fn.children,fn):Fe[fn.id]=fn})}(Ct),{treeNodes:Ct,nodesById:Ft,leafNodesById:Fe,defaultValues:se,defaultDisables:Me}}},{key:"createRootEle",value:function(){var $e=document.createElement("div");return $e.classList.add("treejs"),$e}},{key:"createUlEle",value:function(){var $e=document.createElement("ul");return $e.classList.add("treejs-nodes"),$e}},{key:"createLiEle",value:function($e,Tt){var Ct=document.createElement("li");if(Ct.classList.add("treejs-node"),Tt&&Ct.classList.add("treejs-node__close"),$e.children&&$e.children.length){var Ft=document.createElement("span");Ft.classList.add("treejs-switcher"),Ct.appendChild(Ft)}else Ct.classList.add("treejs-placeholder");var Fe=document.createElement("span");Fe.classList.add("treejs-checkbox"),Ct.appendChild(Fe);var se=document.createElement("span");se.classList.add("treejs-label");var Me=document.createTextNode($e.text);return se.appendChild(Me),Ct.appendChild(se),Ct.nodeId=$e.id,Ct}}],(_t=[{key:"init",value:function($e){var Tt=ct.parseTreeData($e),Ct=Tt.treeNodes,Ft=Tt.nodesById,Fe=Tt.leafNodesById,se=Tt.defaultValues,Me=Tt.defaultDisables;this.treeNodes=Ct,this.nodesById=Ft,this.leafNodesById=Fe,this.render(this.treeNodes);var Ne=this.options,Vt=Ne.values,Kt=Ne.disables,fn=Ne.loaded;Vt&&Vt.length?this.setValues(Vt):se&&se.length&&this.setValues(se),Kt&&Kt.length?this.setDisables(Kt):Me&&Me.length&&this.setDisables(Me),typeof fn=="function"&&fn.call(this)}},{key:"render",value:function($e){var Tt=ct.createRootEle();Tt.appendChild(this.buildTree($e,0)),this.bindEvent(Tt);var Ct=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Ft){for(;Ft.firstChild;)Ft.removeChild(Ft.firstChild)})(Ct),Ct.appendChild(Tt)}},{key:"buildTree",value:function($e,Tt){var Ct=this,Ft=ct.createUlEle();return $e&&$e.length&&$e.forEach(function(Fe){var se=ct.createLiEle(Fe,Tt===Ct.options.closeDepth-1);Ct.liElementsById[Fe.id]=se;var Me=null;Fe.children&&Fe.children.length&&(Me=Ct.buildTree(Fe.children,Tt+1)),Me&&se.appendChild(Me),Ft.appendChild(se)}),Ft}},{key:"bindEvent",value:function($e){var Tt=this;$e.addEventListener("click",function(Ct){var Ft=Ct.target;Ft.nodeName==="SPAN"&&Ft.classList.contains("treejs-checkbox")?Tt.onItemClick(Ft.parentNode.nodeId):Ft.nodeName==="SPAN"&&Ft.classList.contains("treejs-label")?Tt.onItemLabelClick(Ft.parentNode.nodeId):Ft.nodeName==="LI"&&Ft.classList.contains("treejs-node")?Tt.onItemClick(Ft.nodeId):Ft.nodeName==="SPAN"&&Ft.classList.contains("treejs-switcher")&&ct.onSwitcherClick(Ft)},!1)}},{key:"onItemClick",value:function($e){var Tt=this.nodesById[$e],Ct=this.options.onChange;Tt.disabled||(this.setValue($e),this.updateLiElements()),Ct&&Ct.call(this)}},{key:"onItemLabelClick",value:function($e){var Tt=this.options.onItemLabelClick;Tt&&Tt.call(this,$e)}},{key:"setValue",value:function($e){var Tt=this.nodesById[$e];if(Tt){var Ct=Tt.status,Ft=Ct===1||Ct===2?0:2;Tt.status=Ft,this.markWillUpdateNode(Tt),this.walkUp(Tt,"status"),this.walkDown(Tt,"status")}}},{key:"getValues",value:function(){var $e=this,Tt=[];return Object.keys(this.leafNodesById).forEach(function(Ct){Object.prototype.hasOwnProperty.call($e.leafNodesById,Ct)&&($e.leafNodesById[Ct].status!==1&&$e.leafNodesById[Ct].status!==2||Tt.push(Ct))}),Tt}},{key:"setValues",value:function($e){var Tt=this;this.emptyNodesCheckStatus(),$e.forEach(function(Ft){Tt.setValue(Ft)}),this.updateLiElements();var Ct=this.options.onChange;Ct&&Ct.call(this)}},{key:"setDisable",value:function($e){var Tt=this.nodesById[$e];Tt&&(Tt.disabled||(Tt.disabled=!0,this.markWillUpdateNode(Tt),this.walkUp(Tt,"disabled"),this.walkDown(Tt,"disabled")))}},{key:"getDisables",value:function(){var $e=this,Tt=[];return Object.keys(this.leafNodesById).forEach(function(Ct){Object.prototype.hasOwnProperty.call($e.leafNodesById,Ct)&&$e.leafNodesById[Ct].disabled&&Tt.push(Ct)}),Tt}},{key:"setDisables",value:function($e){var Tt=this;this.emptyNodesDisable(),$e.forEach(function(Ct){Tt.setDisable(Ct)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function($e){$e.disabled||($e.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function($e){$e.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function($e,Tt){var Ct=Be(Tt,2),Ft=Ct[0],Fe=Ct[1];return Fe.status!==1&&Fe.status!==2||($e[Ft]=Fe),$e},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function($e,Tt){var Ct=Be(Tt,2),Ft=Ct[0],Fe=Ct[1];return Fe.disabled&&($e[Ft]=Fe),$e},{})}},{key:"updateLiElements",value:function(){var $e=this;Object.values(this.willUpdateNodesById).forEach(function(Tt){$e.updateLiElement(Tt)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function($e){this.willUpdateNodesById[$e.id]=$e}},{key:"walkUp",value:function($e,Tt){var Ct=$e.parent;if(Ct){if(Tt==="status"){var Ft,Fe=Ct.children.reduce(function(Me,Ne){return Number.isNaN(Ne.status)?Me:Me+Ne.status},0);if(Ft=Fe?Fe===2*Ct.children.length?2:1:0,Ct.status===Ft)return;Ct.status=Ft}else{var se=Ct.children.reduce(function(Me,Ne){return Me&&Ne.disabled},!0);if(Ct.disabled===se)return;Ct.disabled=se}this.markWillUpdateNode(Ct),this.walkUp(Ct,Tt)}}},{key:"walkDown",value:function($e,Tt){var Ct=this;$e.children&&$e.children.length&&$e.children.forEach(function(Ft){Tt==="status"&&Ft.disabled||(Ft[Tt]=$e[Tt],Ct.markWillUpdateNode(Ft),Ct.walkDown(Ft,Tt))})}},{key:"updateLiElement",value:function($e){var Tt=this.liElementsById[$e.id].classList;switch($e.status){case 0:Tt.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:Tt.remove("treejs-node__checked"),Tt.add("treejs-node__halfchecked");break;case 2:Tt.remove("treejs-node__halfchecked"),Tt.add("treejs-node__checked")}switch($e.disabled){case!0:Tt.contains("treejs-node__disabled")||Tt.add("treejs-node__disabled");break;case!1:Tt.contains("treejs-node__disabled")&&Tt.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var $e=this;Object.keys(this.leafNodesById).forEach(function(Tt){var Ct=$e.leafNodesById[Tt];ce($e,Ct)})}},{key:"expandAll",value:function(){pe(this,this.treeNodes[0])}}])&&Le(wt.prototype,_t),Dt&&Le(wt,Dt),Object.defineProperty(wt,"prototype",{writable:!1}),ct}()}(),Je.default}()},8:function(St,V){(function(p){class qe{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(te,ce){const pe=this._eventListeners;pe[te]===void 0&&(pe[te]=[]),pe[te].includes(ce)||pe[te].push(ce)}hasEventListener(te,ce){const pe=this._eventListeners;return pe[te]!==void 0&&pe[te].includes(ce)}removeEventListener(te,ce){const pe=this._eventListeners[te];if(pe!==void 0){const je=pe.indexOf(ce);je!==-1&&pe.splice(je,1)}}dispatchEvent(te){const ce=this._eventListeners[te.type];if(ce!==void 0){te.target=this;const pe=ce.slice(0);for(let je=0,ct=pe.length;je<ct;je++)pe[je].call(this,te)}}}function Je(){return(typeof performance>"u"?Date:performance).now()}class Ke{constructor(te=Ke.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(te)}setDecayTime(te){this.naturalFrequency=1/Math.max(Ke.MIN_DECAY_MILLISECONDS,te)}update(te,ce,pe,je){const ct=2e-4*this.naturalFrequency;if(te==null||je===0||te===ce&&this.velocity===0)return ce;if(pe<0)return te;const wt=te-ce,_t=this.velocity+this.naturalFrequency*wt,Dt=wt+pe*_t,$e=Math.exp(-this.naturalFrequency*pe),Tt=(_t-this.naturalFrequency*Dt)*$e,Ct=-this.naturalFrequency*(Tt+_t*$e);return Math.abs(Tt)<ct*Math.abs(je)&&Ct*wt>=0?(this.velocity=0,ce):(this.velocity=Tt,ce+Dt*$e)}}async function He(J){return new Promise((te,ce)=>{const pe=new Image;pe.onload=()=>te(pe),pe.onerror=ce,pe.crossOrigin="anonymous",pe.decoding="sync",pe.src=J})}function ft(J,te=document.head){const ce=document.createElement("style");return ce.type="text/css",ce.innerText=J,te==null||te.appendChild(ce),ce}Ke.SETTLING_TIME=1e4,Ke.MIN_DECAY_MILLISECONDS=.001,Ke.DECAY_MILLISECONDS=50;const Xe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function st(J){return J.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function mt(J,te,ce){return J.replace(new RegExp(st(te),"g"),ce)}const bt=(J,...te)=>String.raw({raw:J},...te),at=(J,...te)=>{let ce=String.raw({raw:J},...te);return ce=mt(ce,"%","%25"),ce=mt(ce,"> <","><"),ce=mt(ce,"; }",";}"),ce=mt(ce,"<","%3c"),ce=mt(ce,">","%3e"),ce=mt(ce,'"',"'"),ce=mt(ce,"#","%23"),ce=mt(ce,"{","%7b"),ce=mt(ce,"}","%7d"),ce=mt(ce,"|","%7c"),ce=mt(ce,"^","%5e"),ce=mt(ce,"`","%60"),ce=mt(ce,"@","%40"),ce=mt(ce,"&","&amp;"),ce=mt(ce,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+ce};function Ie(J,te){const ce=window.URL.createObjectURL(J),pe=document.createElement("a");pe.style.display="none",pe.href=ce,pe.download=te,document.body.appendChild(pe),pe.click(),setTimeout(()=>{document.body.removeChild(pe),window.URL.revokeObjectURL(ce)},1e3)}async function et(J){return new Promise((te,ce)=>{const pe=new FileReader;pe.onload=je=>te(pe.result),pe.onerror=je=>ce(pe.error),pe.onabort=je=>ce(new Error("Read aborted")),pe.readAsDataURL(J)})}function Ce(J,te){let ce;do ce=Object.getOwnPropertyDescriptor(J,te);while(!ce&&(J=Object.getPrototypeOf(J)));return ce}function ht(J,te,ce=!0,pe=!1){const je=Ce(J,te);return!!(je!=null&&je.set)||ce&&(je==null?void 0:je.writable)!==!1&&(je==null?void 0:je.get)===void 0||pe&&!je}function Ze(J,te,ce,pe=!0,je=!1){return!(!J||!ht(J,te,pe,je)||(J[te]=ce,0))}function Ue(J,te){for(let ce=J.length-1;ce>=0;ce--)if(te(J[ce]))return ce;return-1}const At={priority:1/0,serialize:(J,te)=>Object.fromEntries(Object.entries(J).map(([ce,pe])=>[ce,Bt.Serialize(pe,te,!1)])),deserialize:(J,te,ce)=>Object.assign(te||{},Object.fromEntries(Object.entries(J).map(([pe,je])=>[pe,Bt.Deserialize(je,te==null?void 0:te[pe],ce,!1)]))),isType:J=>(J.constructor||Object)===Object};class Bt{static GetSerializer(te){return Bt.Serializers.find(ce=>ce.isType(te))}static RegisterSerializer(...te){var ce;for(const pe of te){const je=(ce=pe.priority)!==null&&ce!==void 0?ce:1e10,ct=Ue(Bt.Serializers,wt=>wt.priority!==void 0&&wt.priority<je);ct>=0?Bt.Serializers.splice(ct+1,0,pe):Bt.Serializers.push(pe)}}static UnregisterSerializer(...te){for(const ce of te){const pe=Bt.Serializers.indexOf(ce);pe>=0&&Bt.Serializers.splice(pe,1)}}static Serialize(te,ce,pe=!1){var je,ct;if(typeof te=="function")return;if(!pe){const Dt=Bt.GetSerializer(te);if(Dt)return Dt.serialize(te,ce);if(typeof te.toJSON=="function"){const $e=te.toJSON(ce);return te.serializableClassId&&$e&&($e.serializableClassId=te.serializableClassId),$e}}let wt=(je=te.constructor)!==null&&je!==void 0?je:Object;const _t={};for(;wt&&wt!==Object;){const Dt=(ct=Bt.TypeMap.get(wt))!==null&&ct!==void 0?ct:[];for(const[$e,Tt]of Dt)_t[$e]=Bt.Serialize(te[Tt],ce,!1);wt=Object.getPrototypeOf(wt)}return te.serializableClassId&&(_t.serializableClassId=te.serializableClassId),_t}static Deserialize(te,ce,pe,je=!1){var ct,wt;if(te===void 0||ce===te)return ce;if(te&&typeof te=="object"&&(te.constructor||Object)===Object&&te.resource&&typeof te.resource=="string"&&te.uuid){const Dt=pe==null?void 0:pe[te.resource];if(!Dt)return console.warn(`Resource ${te.resource} not found`),ce;if(typeof(te=Dt[te.uuid])=="object"&&(te.__useCount=te.__useCount?te.__useCount+1:1),te||console.warn(`Resource ${te.resource} with uuid ${te.uuid} not found`),ce===te)return ce;if(te&&typeof te=="object"){if((te.constructor||Object)!==Object)return ce&&console.warn("replacing object",ce,"with deserialized object from meta",te),te;console.error("Deserialize; meta should only have class instances, not js objects",te,ce,pe)}}if(te&&typeof te=="object"&&(te.constructor||Object)!==Object&&!Array.isArray(te)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",te,"source",ce,te.constructor,te.constructor!==Object),te&&typeof te=="object")if(!te.serializableClassId||ce&&ce.serializableClassId===te.serializableClassId)(te.constructor||Object)!==Object||ce?Array.isArray(te)&&!ce&&(ce=[]):ce={};else{const Dt=Bt.SerializableClasses.get(te.serializableClassId);Dt&&(ce=Dt.DataInConstructor?new Dt(te):new Dt)}if(typeof ce=="function")return console.error("cannot deserialize over function",ce,te),ce;if(!je){const Dt=Bt.GetSerializer(te);if(Dt&&Dt!==At)return Dt.deserialize(te,ce,pe)}if(!te||ce==null||typeof ce!="object")return te;if(!je&&typeof(ce==null?void 0:ce.fromJSON)=="function")return ce.fromJSON(te,pe),ce;let _t=(ct=ce.constructor)!==null&&ct!==void 0?ct:Object;if(_t===Object)return At.deserialize(te,ce,pe);for(;_t&&_t!==Object;){const Dt=(wt=Bt.TypeMap.get(_t))!==null&&wt!==void 0?wt:[];for(const[$e,Tt]of Dt){const Ct=ce[Tt],Ft=Bt.Deserialize(te[$e],Ct,pe,!1);Ft!==Ct&&Ze(ce,Tt,Ft,!0)}_t=Object.getPrototypeOf(_t)}return ce}}function Be(J,te="param"){if(!J)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(ce,pe)=>{Object.defineProperty(ce,pe,{get(){return this[`_oc_${pe}`]},set(je){var ct;const wt=this[`_oc_${pe}`];if(wt===je)return;this[`_oc_${pe}`]=je;const _t=te==="param"?[pe,je,wt]:te==="object"?[{key:pe,value:je,oldValue:wt}]:"";if(typeof J=="string")(ct=this[J])===null||ct===void 0||ct.call(this,..._t);else if(typeof J=="function"){let Dt=!1;if(J.name){let $e=this;for(;$e;){if($e[J.name]===J){J.call(this,..._t),Dt=!0;break}$e=Object.getPrototypeOf($e)}}Dt||(J.name&&this[J.name].name===`bound ${J.name}`?this[J.name](..._t):J(..._t))}}})}}function Qe(J,{backgroundColor:te="",scale:ce=1,width:pe=512,height:je=512}){const ct=document.createElement("canvas"),wt=ct.getContext("2d"),_t=ce,Dt=pe,$e=je;return ct.width=Dt*_t,ct.height=$e*_t,ct.style.width=`${Dt}`,ct.style.height=`${$e}`,(te==null?void 0:te.length)>0&&(wt.fillStyle=te,wt.fillRect(0,0,ct.width,ct.height)),wt.drawImage(J,0,0,ct.width,ct.height),ct}Bt.TypeMap=new Map,Bt.SerializableClasses=new Map,Bt.Serializers=[{priority:0,isType:J=>Array.isArray(J),serialize:(J,te)=>J.map(ce=>Bt.Serialize(ce,te,!1)),deserialize:(J,te,ce)=>{const pe=J.length;Array.isArray(te)||(te=[]);for(let je=0;je<pe;je++){const ct=J[je],wt=te.length>je?Bt.Deserialize(ct,te[je],ce,!1):Bt.Deserialize(ct,void 0,ce,!1);te.length<=je?te.push(wt):te[je]=wt}return te}},{priority:0,isType:J=>!J||typeof J!="object",serialize:J=>{if(J&&typeof J=="number"){if(J===1/0)return"Infinity";if(J===-1/0)return"-Infinity";if(isNaN(J))return"NaN"}return J},deserialize:(J,te)=>{if(typeof te=="number"){if(J==="Infinity")return 1/0;if(J==="-Infinity")return-1/0;if(J==="NaN")return NaN;if(typeof J=="number"||!J)return J}return J}},At];const Z=async(J,te)=>Qe(await He(J),te),$=async(J,te)=>await Z(J,te).then(ce=>ce.toDataURL("image/png")),ae=async J=>et(await(await fetch(J)).blob());function Le(J,te,{width:ce,height:pe},je=!0){const ct=`
<svg viewBox="0 0 ${ce} ${pe}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${te}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${J}
        </div>
    </foreignObject>
</svg>
    `;return je?at(ct):ct}p.Damper=Ke,p.LinearToSRGB=function(J){return J<.0031308?12.92*J:1.055*Math.pow(J,.41666)-.055},p.PointerDragHelper=class extends qe{constructor(){super(...arguments),this._onPointerDown=J=>{if(J.button!==0||!this._element)return;this._pointerUp=void 0;const te=J.clientX/this._element.clientWidth*2-1,ce=-J.clientY/this._element.clientHeight*2+1,pe=Je();this._pointerDown={x:te,y:ce,time:pe},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=J=>{if(!this._pointerDown||!this._pointer||!this._element)return;const te=J.clientX/this._element.clientWidth*2-1,ce=-J.clientY/this._element.clientHeight*2+1,pe=Je();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:te-this._pointerDown.x,y:ce-this._pointerDown.y,time:pe-this._pointerDown.time},delta:{x:te-this._pointer.x,y:ce-this._pointer.y,time:pe-this._pointer.time}}),this._pointer={x:te,y:ce,time:Je()},J.buttons%2==0&&this._onPointerUp(J)},this._onPointerUp=J=>{if(J.button!==0||!this._pointerDown||!this._element)return;const te=J.clientX/this._element.clientWidth*2-1,ce=-J.clientY/this._element.clientHeight*2+1,pe=Je();this._pointerUp={x:te,y:ce,time:pe},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(J){this._element!==J&&(this._element&&this._removeElement(),this._element=J,this._element&&this._addElement())}_removeElement(){var J,te,ce,pe,je;(J=this._element)===null||J===void 0||J.removeEventListener("pointerdown",this._onPointerDown),(te=this._element)===null||te===void 0||te.removeEventListener("pointermove",this._onPointerMove),(ce=this._element)===null||ce===void 0||ce.removeEventListener("pointerup",this._onPointerUp),(pe=this._element)===null||pe===void 0||pe.removeEventListener("pointercancel",this._onPointerUp),(je=this._element)===null||je===void 0||je.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var J,te,ce,pe,je;(J=this._element)===null||J===void 0||J.addEventListener("pointerdown",this._onPointerDown),(te=this._element)===null||te===void 0||te.addEventListener("pointermove",this._onPointerMove),(ce=this._element)===null||ce===void 0||ce.addEventListener("pointerup",this._onPointerUp),(pe=this._element)===null||pe===void 0||pe.addEventListener("pointercancel",this._onPointerUp),(je=this._element)===null||je===void 0||je.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},p.SRGBToLinear=function(J){return J<.04045?.0773993808*J:Math.pow(.9478672986*J+.0521327014,2.4)},p.Serialization=Bt,p.SimpleEventDispatcher=qe,p.TYPED_ARRAYS=Xe,p.absMax=function(J,te){return Math.abs(J)>Math.abs(te)?J:te},p.aesGcmDecrypt=async function(J,te){const ce=typeof te=="string"?new TextEncoder().encode(te):te,pe=await crypto.subtle.digest("SHA-256",ce),je=J.slice(0,12),ct={name:"AES-GCM",iv:typeof je=="string"?new Uint8Array(Array.from(je).map($e=>$e.charCodeAt(0))):je},wt=await crypto.subtle.importKey("raw",pe,ct,!1,["decrypt"]),_t=J.slice(12),Dt=typeof _t=="string"?new Uint8Array(Array.from(_t).map($e=>$e.charCodeAt(0))):_t;try{const $e=await crypto.subtle.decrypt(ct,wt,Dt);return typeof J=="string"?new TextDecoder().decode($e):new Uint8Array($e)}catch{throw new Error("Decrypt failed")}},p.aesGcmEncrypt=async function(J,te,ce){const pe=typeof te=="string"?new TextEncoder().encode(te):te,je=await crypto.subtle.digest("SHA-256",pe),ct=crypto.getRandomValues(new Uint8Array(12)),wt=Array.from(ct).map(Ne=>String.fromCharCode(Ne)).join(""),_t={name:"AES-GCM",iv:ct},Dt=await crypto.subtle.importKey("raw",je,_t,!1,["encrypt"]),$e=typeof J=="string"?new TextEncoder().encode(J):J,Tt=await crypto.subtle.encrypt(_t,Dt,$e),Ct=new Uint8Array(Tt),Ft=Array.from(Ct),Fe=Ft.map(Ne=>String.fromCharCode(Ne)).join(""),se=ce?typeof ce=="string"?ce:new TextDecoder().decode(ce):"",Me=ce?typeof ce=="string"?new TextEncoder().encode(ce):Array.from(ce):[];return typeof J=="string"?se+wt+Fe:new Uint8Array([...Me,...ct,...Ft])},p.arrayBufferToBase64=function(J){if(!window)return console.warn("window is required"),"";let te="";const ce=new Uint8Array(J),pe=ce.byteLength;for(let je=0;je<pe;je++)te+=String.fromCharCode(ce[je]);return window.btoa(te)},p.base64ToArrayBuffer=function(J){if(!window)return console.warn("window is required"),new Uint8Array(0);const te=window.atob(J),ce=te.length,pe=new Uint8Array(ce);for(let je=0;je<ce;je++)pe[je]=te.charCodeAt(je);return pe.buffer},p.blobToDataURL=et,p.canvasFlipY=function(J){const te=document.createElement("canvas");te.width=J.width,te.height=J.height;const ce=te.getContext("2d");if(!ce)throw new Error("Unable to get 2d context");return ce.translate(0,J.height),ce.scale(1,-1),ce.drawImage(J,0,0),te},p.clearBit=function(J,te){return J&~(1<<te)},p.colorToDataUrl=function(J,te=1,ce=1){const pe=document.createElement("canvas");pe.width=te,pe.height=ce;const je=pe.getContext("2d");je.fillStyle="#"+J,je.fillRect(0,0,te,ce);const ct=pe.toDataURL();return pe.remove(),ct},p.copyProps=function(J,te,ce){for(const pe of ce){const je=J[pe];je!==void 0&&Ze(te,pe,je,!0)}return te},p.createCanvasElement=function(){const J=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return J.style.display="block",J},p.createDiv=function({innerHTML:J="",id:te,classList:ce,addToBody:pe=!0,elementTag:je="div"}){const ct=document.createElement(je);return te&&(ct.id=te),ct.innerHTML=J,ce&&ct.classList.add(...ce),pe&&document.body.appendChild(ct),ct},p.createImage=He,p.createScriptFromURL=async function(J,te=document.head){return new Promise((ce,pe)=>{const je=document.createElement("script");je.setAttribute("src",J),je.addEventListener("load",()=>ce(je)),je.addEventListener("error",pe),te.appendChild(je)})},p.createStyles=ft,p.css=bt,p.deepAccessObject=function(J,te,ce=!1){for(typeof J=="string"&&(J=J.split("."));J.length>0;){if(!te)return;const pe=J.splice(0,1)[0];if(!(pe.length<1)){if(!(pe in te)){if(ce)throw new Error("invalid access, check "+pe+" in "+te);return}te=te[pe]}}return te},p.downloadBlob=Ie,p.downloadFile=function(J,te){return Ie(J,te??J.name)},p.embedUrlRefs=async function(J,te=ae){const ce=J.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(ce)for(const pe of ce){const je=await te(pe);J=J.replace(pe,je)}return J},p.escapeRegExp=st,p.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(J=>J[0]):window.chooseFileSystemEntries()},p.getFilenameFromPath=function(J){return J.substring(J.lastIndexOf("/")+1)},p.getKeyByValue=function(J,te){return Object.keys(J).find(ce=>J[ce]===te)},p.getNewFileHandle=function(){if("showSaveFilePicker"in window){const J={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(J)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},p.getOrCall=function(J,...te){return typeof J=="function"&&(J=J(...te)),J},p.getPropertyDescriptor=Ce,p.getTypedArray=function(J,te){return new Xe[J](te)},p.getUrlQueryParam=function(J,te=null){var ce;return(ce=new URL(window.location.href).searchParams.get(J))!==null&&ce!==void 0?ce:te},p.glsl=(J,...te)=>String.raw({raw:J},...te),p.html=(J,...te)=>String.raw({raw:J},...te),p.htmlToCanvas=async function(J,te,ce){const pe=Le(J,te,ce);return await Z(pe,ce)},p.htmlToPng=async function(J,te,ce){const pe=Le(J,te,ce);return await $(pe,ce)},p.htmlToSvg=Le,p.imageBitmapToBase64=function(J,te=8192,ce=!1){var pe;if(!J.width||!J.height)return"";const je=document.createElement("canvas");je.width=Math.min(te,J.width),je.height=Math.floor(1+je.width*J.height/J.width);const ct=J instanceof ImageBitmap,wt=ct&&ce&&Math.abs(je.width-J.width)<.5?je.getContext("bitmaprenderer"):void 0;wt?wt.transferFromImageBitmap(J):(pe=je.getContext("2d"))===null||pe===void 0||pe.drawImage(J,0,0,je.width,je.height);const _t=je.toDataURL("image/png");return je.remove(),ct&&ce&&J.close(),_t},p.imageDataToCanvas=function(J){const te=document.createElement("canvas");return te.width=J.width,te.height=J.height,te.getContext("2d").putImageData(J,0,0),te},p.imageToCanvas=Qe,p.imageUrlToImageData=async function(J){return new Promise((te,ce)=>{const pe=new Image;pe.addEventListener("load",()=>{const je=document.createElement("canvas");je.width=pe.width,je.height=pe.height;const ct=je.getContext("2d");if(!ct)return void ce(new Error("Could not get 2d context"));ct.drawImage(pe,0,0,je.width,je.height);const wt=ct.getImageData(0,0,je.width,je.height);te(wt),je.remove(),pe.remove()},!1),pe.addEventListener("error",je=>{pe.remove(),ce(je)},!1),pe.src=J})},p.includesAll=function(J,te){for(const ce of te)if(!J.includes(ce))return!1;return!0},p.isPropertyWritable=ht,p.isWebpExportSupported=function(){const J=document.createElement("canvas");return!(!J.getContext||!J.getContext("2d"))&&J.toDataURL("image/webp").startsWith("data:image/webp")},p.longestCommonPrefix=function(J){return J.sort(),J[0].split("").map((te,ce)=>J[J.length-1][ce]===te?te:"\0").join("").split("\0").at(0)||""},p.makeColorSvg=J=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${J}'/%3E%3C/svg%3E%0A`,p.makeColorSvgCircle=J=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${J}'/%3E%3C/svg%3E%0A`,p.makeTextSvg=J=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${J}%3C/text%3E%3C/svg%3E%0A`,p.mobileAndTabletCheck=function(){let J=!1;var te;return te=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(te)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(te.substr(0,4)))&&(J=!0),J},p.now=Je,p.objectHasOwn=function(J,te){return Object.hasOwn?Object.hasOwn(J,te):J.hasOwnProperty(te)},p.onChange=Be,p.onChange2=function(J,te="void"){if(!J)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Be(J,te)},p.onChange3=function(J,te="object"){if(!J)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Be(J,te)},p.parseFileExtension=function(J){var te;if(!J||J===""||J.match(/__MACOSX\/.*\._/))return"";const ce=(te=(J=J.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&te!==void 0?te:"",pe=ce.lastIndexOf(".");return ce===""||pe<1?"":ce.slice(pe+1)},p.pathJoin=function(J,te="/"){return J.join(te)},p.prettyScrollbar=function(J=document.head){return ft(bt`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,J)},p.readFile=function(J){return J.text?J.text():function(te){return new Promise(ce=>{const pe=new FileReader;pe.addEventListener("loadend",je=>{const ct=je.srcElement.result;ce(ct)}),pe.readAsText(te)})}(J)},p.remoteWorkerURL=function(J,te){const ce=(te?`var Module = { locateFile: function(s) { return "${te}"; } }; 
`:"")+`importScripts( "${J}" );`;return URL.createObjectURL(new Blob([ce],{type:"text/javascript"}))},p.replaceAll=mt,p.safeSetProperty=Ze,p.serializable=function(J){return te=>(te=class extends te{constructor(){super(...arguments),this.serializableClassId=J}},Bt.SerializableClasses.set(J,te),te)},p.serialize=function(J){return(te,ce)=>{const pe=te.constructor;if(pe===Object)throw new Error("All properties in an object are serialized by default");Bt.TypeMap.has(pe)||Bt.TypeMap.set(pe,[]),Bt.TypeMap.get(pe).push([J||ce,ce])}},p.setUrlQueryParam=function(J,te,ce=!1){const pe=new URLSearchParams(location.search);te==null?pe.has(J)&&pe.delete(J):pe.set(J,te),ce?window.location.search=pe.toString():window.history.replaceState({},"","?"+pe.toString())},p.svgToCanvas=Z,p.svgToPng=$,p.svgUrl=at,p.timeout=async function(J){return new Promise(te=>setTimeout(te,Math.max(0,J)))},p.toTitleCase=function(J){return J.replace(/\w\S*/g,function(te){return te.charAt(0).toUpperCase()+te.substr(1).toLowerCase()})},p.updateBit=function(J,te,ce){return J&~(1<<te)|(ce?1:0)<<te},p.uploadFile=async function(J=!1,te=!1,ce){const pe=document.createElement("input");pe.type="file",pe.multiple=J,pe.accept=ce||"*",pe.webkitdirectory=te,pe.style.display="none",document.body.appendChild(pe),pe.click();const je=await new Promise(ct=>{pe.onchange=wt=>{ct(Array.from(pe.files||[]))}});return document.body.removeChild(pe),je},p.verifyPermission=async function(J,te){const ce={};return te&&(ce.writable=!0,ce.mode="readwrite"),await J.queryPermission(ce)==="granted"||await J.requestPermission(ce)==="granted"},p.writeFile=async function(J,te){if(J.createWriter){const pe=await J.createWriter();return await pe.write(0,te),void await pe.close()}const ce=await J.createWritable();await ce.write(te),await ce.close()}})(V)},819:function(St,V){(function(p){const qe="tp";function Je(Qe){return Z=>$=>{if(!Z&&$===void 0)return{succeeded:!1,value:void 0};if(Z&&$===void 0)return{succeeded:!0,value:void 0};const ae=Qe($);return ae!==void 0?{succeeded:!0,value:ae}:{succeeded:!1,value:void 0}}}function Ke(Qe){return{custom:Z=>Je(Z)(Qe),boolean:Je(Z=>typeof Z=="boolean"?Z:void 0)(Qe),number:Je(Z=>typeof Z=="number"?Z:void 0)(Qe),string:Je(Z=>typeof Z=="string"?Z:void 0)(Qe),function:Je(Z=>typeof Z=="function"?Z:void 0)(Qe),constant:Z=>Je($=>$===Z?Z:void 0)(Qe),raw:Je(Z=>Z)(Qe),object:Z=>Je($=>{if((ae=$)!==null&&typeof ae=="object")return function(Le,J){return Object.keys(J).reduce((te,ce)=>{if(te===void 0)return;const pe=(0,J[ce])(Le[ce]);return pe.succeeded?Object.assign(Object.assign({},te),{[ce]:pe.value}):void 0},{})}($,Z);var ae})(Qe),array:Z=>Je($=>{if(Array.isArray($))return ae=Z,$.reduce((Le,J)=>{if(Le===void 0)return;const te=ae(J);return te.succeeded&&te.value!==void 0?[...Le,te.value]:void 0},[]);var ae})(Qe)}}const He={optional:Ke(!0),required:Ke(!1)};function ft(Qe){return Z=>Z.toFixed(Math.max(Math.min(Qe,20),0))}function Xe(Qe){return[Qe[0],Qe[1],Qe[2]]}function st(Qe){return Z=>function($,ae){const Le=ft(ae==="float"?2:0);return`rgb(${Xe($.getComponents("rgb",ae)).map(J=>Le(J)).join(", ")})`}(Z,Qe)}function mt(Qe){return Z=>function($,ae){const Le=ft(2),J=ft(ae==="float"?2:0);return`rgba(${$.getComponents("rgb",ae).map((te,ce)=>(ce===3?Le:J)(te)).join(", ")})`}(Z,Qe)}function bt(Qe){return Z=>function($,ae){const Le=ft(ae==="float"?2:0),J=["r","g","b"];return`{${Xe($.getComponents("rgb",ae)).map((te,ce)=>`${J[ce]}: ${Le(te)}`).join(", ")}}`}(Z,Qe)}function at(Qe){return Z=>function($,ae){const Le=ft(2),J=ft(ae==="float"?2:0),te=["r","g","b","a"];return`{${$.getComponents("rgb",ae).map((ce,pe)=>`${te[pe]}: ${(pe===3?Le:J)(ce)}`).join(", ")}}`}(Z,Qe)}function Ie(Qe,Z,$,ae){return new($||($=Promise))(function(Le,J){function te(je){try{pe(ae.next(je))}catch(ct){J(ct)}}function ce(je){try{pe(ae.throw(je))}catch(ct){J(ct)}}function pe(je){var ct;je.done?Le(je.value):(ct=je.value,ct instanceof $?ct:new $(function(wt){wt(ct)})).then(te,ce)}pe((ae=ae.apply(Qe,Z||[])).next())})}function et(Qe){return Ie(this,void 0,void 0,function*(){const Z=new Image;return Z.crossOrigin="anonymous",new Promise(($,ae)=>{Z.src=Qe,Z.onload=()=>{$(Z)},Z.onerror=ae})})}["int","float"].reduce((Qe,Z)=>[...Qe,{format:{alpha:!1,mode:"rgb",notation:"func",type:Z},stringifier:st(Z)},{format:{alpha:!0,mode:"rgb",notation:"func",type:Z},stringifier:mt(Z)},{format:{alpha:!1,mode:"rgb",notation:"object",type:Z},stringifier:bt(Z)},{format:{alpha:!0,mode:"rgb",notation:"object",type:Z},stringifier:at(Z)}],[]);const Ce=(ht="img",(Qe,Z)=>[qe,"-",ht,"v",Qe?`_${Qe}`:"",Z?`-${Z}`:""].join(""));var ht;class Ze{constructor(Z,$){this.element=Z.createElement("div"),this.element.classList.add(Ce()),$.viewProps.bindClassModifiers(this.element),this.input=Z.createElement("input"),this.input.classList.add(Ce("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",$.extensions.join(",")),this.image_=Z.createElement("img"),this.image_.classList.add(Ce("image")),this.image_.classList.add(Ce(`image_${$.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=ae=>{$.clickCallback?$.clickCallback(ae,this.input):this.input.click()},this.element.classList.add(Ce("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Z){this.image_.src=Z}changeDraggingState(Z){const $=this.element;Z?$==null||$.classList.add(Ce("area_dragging")):$==null||$.classList.remove(Ce("area_dragging"))}}let Ue=null;class At{constructor(Z,$){this.value=$.value,this.viewProps=$.viewProps,this.view=new Ze(Z,{viewProps:this.viewProps,extensions:$.extensions,imageFit:$.imageFit,clickCallback:$.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Z){const $=(Z==null?void 0:Z.target).files;if(!$||!$.length)return;const ae=$[0];this.setValue(ae)}onDrop(Z){return Ie(this,void 0,void 0,function*(){Z.preventDefault();try{const{dataTransfer:$}=Z,ae=$==null?void 0:$.files[0];if(ae)this.setValue(ae);else{const Le=$==null?void 0:$.getData("url");if(!Le)throw new Error("No url");this.setValue(Le)}}catch($){console.error("Could not parse the dropped image",$)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Z){Z.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Z){return Ie(this,void 0,void 0,function*(){Z instanceof HTMLImageElement?this.updateImage(Z.src):typeof Z!="string"&&Z?yield this.setValue(Z):(Z!=="placeholder"&&Z||(Z=(yield this.handlePlaceholderImage()).src),this.updateImage(Z))})}updateImage(Z){this.view.changeImage(Z)}setValue(Z){return Ie(this,void 0,void 0,function*(){if(Z instanceof HTMLImageElement)this.value.setRawValue(Z);else if(Z instanceof File){const $=URL.createObjectURL(Z)+"#"+Z.name;Z.src=$;const ae=yield et($).catch(()=>{});this.value.setRawValue(ae||Z)}else Z?this.value.setRawValue(yield et(Z)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return Ie(this,void 0,void 0,function*(){return Ue||(Ue=yield function(){const Z=document.createElement("canvas");Z.width=320,Z.height=50;const $=Z.getContext("2d");return $.fillStyle="#00000004",$.fillRect(0,0,Z.width,Z.height),$.fillStyle="#eee",$.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',$.textAlign="center",$.textBaseline="middle",$.fillText("No image",.5*Z.width,.5*Z.height),new Promise(ae=>{Z.toBlob(Le=>{const J=new Image;J.src=URL.createObjectURL(Le),J.isPlaceholder=!0,J.onload=()=>{ae(J)}})})}()),Ue})}}const Bt=[".jpg",".png",".gif"],Be={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(Qe,Z){if(!(Qe instanceof HTMLImageElement||typeof Qe=="string"))return null;const $=He,ae=function(Le,J){const te=He.required.object(J)(Le);return te.succeeded?te.value:void 0}(Z,{view:$.required.constant("input-image"),acceptUrl:$.optional.boolean,clickCallback:$.optional.function,imageFit:$.optional.custom(Le=>Le==="contain"||Le==="cover"?Le:void 0),extensions:$.optional.array($.required.string)});return ae?{initialValue:Qe,params:ae}:null},binding:{reader(Qe){return Z=>Z.src!==void 0?Z.src===""?"placeholder":Z.src:Z},writer(Qe){return(Z,$)=>{Z.write($)}}},controller(Qe){var Z,$;return new At(Qe.document,{value:Qe.value,imageFit:(Z=Qe.params.imageFit)!==null&&Z!==void 0?Z:"cover",clickCallback:Qe.params.clickCallback,viewProps:Qe.viewProps,extensions:($=Qe.params.extensions)!==null&&$!==void 0?$:Bt})}};p.plugin=Be,Object.defineProperty(p,"__esModule",{value:!0})})(V)},665:function(St,V){(function(p){class qe{constructor(y){this.controller_=y}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(y){this.controller_.viewProps.set("disabled",y)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(y){this.controller_.viewProps.set("hidden",y)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class Je{constructor(y){this.target=y}}class Ke extends Je{constructor(y,S,U,Y){super(y),this.value=S,this.presetKey=U,this.last=Y==null||Y}}class He extends Je{constructor(y,S,U){super(y),this.value=S,this.presetKey=U}}class ft extends Je{constructor(y,S){super(y),this.expanded=S}}class Xe extends Je{constructor(y,S){super(y),this.index=S}}function st(B){return B==null}function mt(B,y){if(B.length!==y.length)return!1;for(let S=0;S<B.length;S++)if(B[S]!==y[S])return!1;return!0}function bt(B,y){let S=B;do{const U=Object.getOwnPropertyDescriptor(S,y);if(U&&(U.set!==void 0||U.writable===!0))return!0;S=Object.getPrototypeOf(S)}while(S!==null);return!1}const at={alreadydisposed:()=>"View has been already disposed",invalidparams:B=>`Invalid parameters for '${B.name}'`,nomatchingcontroller:B=>`No matching controller for '${B.key}'`,nomatchingview:B=>`No matching view for '${JSON.stringify(B.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:B=>`Property '${B.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class Ie{static alreadyDisposed(){return new Ie({type:"alreadydisposed"})}static notBindable(){return new Ie({type:"notbindable"})}static propertyNotFound(y){return new Ie({type:"propertynotfound",context:{name:y}})}static shouldNeverHappen(){return new Ie({type:"shouldneverhappen"})}constructor(y){var S;this.message=(S=at[y.type](y.context))!==null&&S!==void 0?S:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=y.type}}class et{constructor(y,S,U){this.obj_=y,this.key_=S,this.presetKey_=U??S}static isBindable(y){return y!==null&&typeof y=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(y){this.obj_[this.key_]=y}writeProperty(y,S){const U=this.read();if(!et.isBindable(U))throw Ie.notBindable();if(!(y in U))throw Ie.propertyNotFound(y);U[y]=S}}class Ce extends qe{get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get title(){var y;return(y=this.controller_.valueController.props.get("title"))!==null&&y!==void 0?y:""}set title(y){this.controller_.valueController.props.set("title",y)}on(y,S){const U=S.bind(this);return this.controller_.valueController.emitter.on(y,()=>{U(new Je(this))}),this}}class ht{constructor(){this.observers_={}}on(y,S){let U=this.observers_[y];return U||(U=this.observers_[y]=[]),U.push({handler:S}),this}off(y,S){const U=this.observers_[y];return U&&(this.observers_[y]=U.filter(Y=>Y.handler!==S)),this}emit(y,S){const U=this.observers_[y];U&&U.forEach(Y=>{Y.handler(S)})}}const Ze="tp";function Ue(B){return(y,S)=>[Ze,"-",B,"v",y?`_${y}`:"",S?`-${S}`:""].join("")}function At(B){return B.rawValue}function Bt(B,y){var S,U;B.emitter.on("change",(S=At,U=y,Y=>U(S(Y)))),y(B.rawValue)}function Be(B,y,S){Bt(B.value(y),S)}function Qe(B,y){return S=>{(function(U,Y,ye){ye?U.classList.add(Y):U.classList.remove(Y)})(B,y,S)}}function Z(B,y){Bt(B,S=>{y.textContent=S??""})}const $=Ue("btn");class ae{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add($()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("button");U.classList.add($("b")),S.viewProps.bindDisabled(U),this.element.appendChild(U),this.buttonElement=U;const Y=y.createElement("div");Y.classList.add($("t")),Z(S.props.value("title"),Y),this.buttonElement.appendChild(Y)}}class Le{constructor(y,S){this.emitter=new ht,this.onClick_=this.onClick_.bind(this),this.props=S.props,this.viewProps=S.viewProps,this.view=new ae(y,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class J{constructor(y,S){var U;this.constraint_=S==null?void 0:S.constraint,this.equals_=(U=S==null?void 0:S.equals)!==null&&U!==void 0?U:(Y,ye)=>Y===ye,this.emitter=new ht,this.rawValue_=y}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(y){this.setRawValue(y,{forceEmit:!1,last:!0})}setRawValue(y,S){const U=S??{forceEmit:!1,last:!0},Y=this.constraint_?this.constraint_.constrain(y):y,ye=this.rawValue_;(!this.equals_(ye,Y)||U.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Y,this.emitter.emit("change",{options:U,previousRawValue:ye,rawValue:Y,sender:this}))}}class te{constructor(y){this.emitter=new ht,this.value_=y}get rawValue(){return this.value_}set rawValue(y){this.setRawValue(y,{forceEmit:!1,last:!0})}setRawValue(y,S){const U=S??{forceEmit:!1,last:!0},Y=this.value_;(Y!==y||U.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=y,this.emitter.emit("change",{options:U,previousRawValue:Y,rawValue:this.value_,sender:this}))}}function ce(B,y){const S=y==null?void 0:y.constraint,U=y==null?void 0:y.equals;return S||U?new J(B,y):new te(B)}class pe{constructor(y){this.emitter=new ht,this.valMap_=y;for(const S in this.valMap_)this.valMap_[S].emitter.on("change",()=>{this.emitter.emit("change",{key:S,sender:this})})}static createCore(y){return Object.keys(y).reduce((S,U)=>Object.assign(S,{[U]:ce(y[U])}),{})}static fromObject(y){const S=this.createCore(y);return new pe(S)}get(y){return this.valMap_[y].rawValue}set(y,S){this.valMap_[y].rawValue=S}value(y){return this.valMap_[y]}}function je(B){return y=>S=>{if(!y&&S===void 0)return{succeeded:!1,value:void 0};if(y&&S===void 0)return{succeeded:!0,value:void 0};const U=B(S);return U!==void 0?{succeeded:!0,value:U}:{succeeded:!1,value:void 0}}}function ct(B){return{custom:y=>je(y)(B),boolean:je(y=>typeof y=="boolean"?y:void 0)(B),number:je(y=>typeof y=="number"?y:void 0)(B),string:je(y=>typeof y=="string"?y:void 0)(B),function:je(y=>typeof y=="function"?y:void 0)(B),constant:y=>je(S=>S===y?y:void 0)(B),raw:je(y=>y)(B),object:y=>je(S=>{if((U=S)!==null&&typeof U=="object")return function(Y,ye){return Object.keys(ye).reduce((xe,dt)=>{if(xe===void 0)return;const Jt=(0,ye[dt])(Y[dt]);return Jt.succeeded?Object.assign(Object.assign({},xe),{[dt]:Jt.value}):void 0},{})}(S,y);var U})(B),array:y=>je(S=>{if(Array.isArray(S))return U=y,S.reduce((Y,ye)=>{if(Y===void 0)return;const xe=U(ye);return xe.succeeded&&xe.value!==void 0?[...Y,xe.value]:void 0},[]);var U})(B)}}const wt={optional:ct(!0),required:ct(!1)};function _t(B,y){const S=wt.required.object(y)(B);return S.succeeded?S.value:void 0}function Dt(B){console.warn([`Missing '${B.key}' of ${B.target} in ${B.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class $e{constructor(y){this.value_=y}static create(y){return[new $e(y),(S,U)=>{y.setRawValue(S,U)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Tt=Ue("");function Ct(B,y){return Qe(B,Tt(void 0,y))}class Ft extends pe{constructor(y){var S;super(y),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=$e.create(ce(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(S=this.get("parent"))===null||S===void 0||S.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(y){var S,U,Y;const ye=y??{};return new Ft(pe.createCore({disabled:(S=ye.disabled)!==null&&S!==void 0&&S,disposed:!1,hidden:(U=ye.hidden)!==null&&U!==void 0&&U,parent:(Y=ye.parent)!==null&&Y!==void 0?Y:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(y){Bt(this.globalDisabled_,Ct(y,"disabled")),Be(this,"hidden",Ct(y,"hidden"))}bindDisabled(y){Bt(this.globalDisabled_,S=>{y.disabled=S})}bindTabIndex(y){Bt(this.globalDisabled_,S=>{y.tabIndex=S?-1:0})}handleDispose(y){this.value("disposed").emitter.on("change",S=>{S&&y()})}getGlobalDisabled_(){const y=this.get("parent");return!!y&&y.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(y){var S;const U=y.previousRawValue;U==null||U.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(S=this.get("parent"))===null||S===void 0||S.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Fe=Ue(""),se={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Me{constructor(y){this.parent_=null,this.blade=y.blade,this.view=y.view,this.viewProps=y.viewProps;const S=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(U=>{S.classList.remove(Fe(void 0,se[U]))}),this.blade.get("positions").forEach(U=>{S.classList.add(Fe(void 0,se[U]))})}),this.viewProps.handleDispose(()=>{(function(U){U&&U.parentElement&&U.parentElement.removeChild(U)})(S)})}get parent(){return this.parent_}set parent(y){this.parent_=y,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):Dt({key:"parent",target:Ft.name,place:"BladeController.parent"})}}const Ne="http://www.w3.org/2000/svg";function Vt(B){B.offsetHeight}function Kt(B){return B.ontouchstart!==void 0}function fn(){return globalThis.document}const ri={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function In(B,y){const S=B.createElementNS(Ne,"svg");return S.innerHTML=ri[y],S}function Qi(B,y,S){B.insertBefore(y,B.children[S])}function qi(B){B.parentElement&&B.parentElement.removeChild(B)}function Ki(B){for(;B.children.length>0;)B.removeChild(B.children[0])}function qr(B){return B.relatedTarget?B.relatedTarget:"explicitOriginalTarget"in B?B.explicitOriginalTarget:null}const dr=Ue("lbl");class ar{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(dr()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(dr("l")),Be(S.props,"label",ye=>{st(ye)?this.element.classList.add(dr(void 0,"nol")):(this.element.classList.remove(dr(void 0,"nol")),function(xe){for(;xe.childNodes.length>0;)xe.removeChild(xe.childNodes[0])}(U),U.appendChild(function(xe,dt){const Jt=xe.createDocumentFragment();return dt.split(`
`).map(bn=>xe.createTextNode(bn)).forEach((bn,oi)=>{oi>0&&Jt.appendChild(xe.createElement("br")),Jt.appendChild(bn)}),Jt}(y,ye)))}),this.element.appendChild(U),this.labelElement=U;const Y=y.createElement("div");Y.classList.add(dr("v")),this.element.appendChild(Y),this.valueElement=Y}}class Ko extends Me{constructor(y,S){const U=S.valueController.viewProps;super(Object.assign(Object.assign({},S),{view:new ar(y,{props:S.props,viewProps:U}),viewProps:U})),this.props=S.props,this.valueController=S.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Za={id:"button",type:"blade",accept(B){const y=wt,S=_t(B,{title:y.required.string,view:y.required.constant("button"),label:y.optional.string});return S?{params:S}:null},controller(B){return new Ko(B.document,{blade:B.blade,props:pe.fromObject({label:B.params.label}),valueController:new Le(B.document,{props:pe.fromObject({title:B.params.title}),viewProps:B.viewProps})})},api(B){return B.controller instanceof Ko&&B.controller.valueController instanceof Le?new Ce(B.controller):null}};class gr extends Me{constructor(y){super(y),this.value=y.value}}function Ae(){return new pe({positions:ce([],{equals:mt})})}class Ji extends pe{constructor(y){super(y)}static create(y){const S={completed:!0,expanded:y,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},U=pe.createCore(S);return new Ji(U)}get styleExpanded(){var y;return(y=this.get("temporaryExpanded"))!==null&&y!==void 0?y:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const y=this.get("expandedHeight");return this.get("shouldFixHeight")&&!st(y)?`${y}px`:"auto"}bindExpandedClass(y,S){const U=()=>{this.styleExpanded?y.classList.add(S):y.classList.remove(S)};Be(this,"expanded",U),Be(this,"temporaryExpanded",U)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Er(B,y){y.style.height=B.styleHeight}function gs(B,y){B.value("expanded").emitter.on("beforechange",()=>{if(B.set("completed",!1),st(B.get("expandedHeight"))){const S=function(U,Y){let ye=0;return function(xe,dt){const Jt=xe.style.transition;xe.style.transition="none",dt(),xe.style.transition=Jt}(Y,()=>{U.set("expandedHeight",null),U.set("temporaryExpanded",!0),Vt(Y),ye=Y.clientHeight,U.set("temporaryExpanded",null),Vt(Y)}),ye}(B,y);S>0&&B.set("expandedHeight",S)}B.set("shouldFixHeight",!0),Vt(y)}),B.emitter.on("change",()=>{Er(B,y)}),Er(B,y),y.addEventListener("transitionend",S=>{S.propertyName==="height"&&B.cleanUpTransition()})}class xi extends qe{constructor(y,S){super(y),this.rackApi_=S}}class Di{constructor(y){this.emitter=new ht,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=y}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(y){for(const S of this.allItems())if(y(S))return S;return null}includes(y){return this.cache_.has(y)}add(y,S){if(this.includes(y))throw Ie.shouldNeverHappen();const U=S!==void 0?S:this.items_.length;this.items_.splice(U,0,y),this.cache_.add(y);const Y=this.extract_(y);Y&&(Y.emitter.on("add",this.onSubListAdd_),Y.emitter.on("remove",this.onSubListRemove_),Y.allItems().forEach(ye=>{this.cache_.add(ye)})),this.emitter.emit("add",{index:U,item:y,root:this,target:this})}remove(y){const S=this.items_.indexOf(y);if(S<0)return;this.items_.splice(S,1),this.cache_.delete(y);const U=this.extract_(y);U&&(U.emitter.off("add",this.onSubListAdd_),U.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:S,item:y,root:this,target:this})}onSubListAdd_(y){this.cache_.add(y.item),this.emitter.emit("add",{index:y.index,item:y.item,root:this,target:y.target})}onSubListRemove_(y){this.cache_.delete(y.item),this.emitter.emit("remove",{index:y.index,item:y.item,root:this,target:y.target})}}class vs extends qe{constructor(y){super(y),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new ht,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(y){const S=y.sender.target.read();this.emitter_.emit("change",{event:new Ke(this,S,this.controller_.binding.target.presetKey,y.options.last)})}}class _s extends Ko{constructor(y,S){super(y,S),this.binding=S.binding}}class vr extends qe{constructor(y){super(y),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new ht,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(y){const S=y.sender.target.read();this.emitter_.emit("update",{event:new He(this,S,this.controller_.binding.target.presetKey)})}}class Jo extends Ko{constructor(y,S){super(y,S),this.binding=S.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function th(B){return B instanceof _r?B.apiSet_:B instanceof xi?B.rackApi_.apiSet_:null}function Al(B,y){const S=B.find(U=>U.controller_===y);if(!S)throw Ie.shouldNeverHappen();return S}function bd(B,y,S){if(!et.isBindable(B))throw Ie.notBindable();return new et(B,y,S)}class _r extends qe{constructor(y,S){super(y),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new ht,this.apiSet_=new Di(th),this.pool_=S;const U=this.controller_.rack;U.emitter.on("add",this.onRackAdd_),U.emitter.on("remove",this.onRackRemove_),U.emitter.on("inputchange",this.onRackInputChange_),U.emitter.on("monitorupdate",this.onRackMonitorUpdate_),U.children.forEach(Y=>{this.setUpApi_(Y)})}get children(){return this.controller_.rack.children.map(y=>Al(this.apiSet_,y))}addInput(y,S,U){const Y=U??{},ye=this.controller_.view.element.ownerDocument,xe=this.pool_.createInput(ye,bd(y,S,Y.presetKey),Y),dt=new vs(xe);return this.add(dt,Y.index)}addMonitor(y,S,U){const Y=U??{},ye=this.controller_.view.element.ownerDocument,xe=this.pool_.createMonitor(ye,bd(y,S),Y),dt=new vr(xe);return this.add(dt,Y.index)}addFolder(y){return function(S,U){return S.addBlade(Object.assign(Object.assign({},U),{view:"folder"}))}(this,y)}addButton(y){return function(S,U){return S.addBlade(Object.assign(Object.assign({},U),{view:"button"}))}(this,y)}addSeparator(y){return function(S,U){const Y=U??{};return S.addBlade(Object.assign(Object.assign({},Y),{view:"separator"}))}(this,y)}addTab(y){return function(S,U){return S.addBlade(Object.assign(Object.assign({},U),{view:"tab"}))}(this,y)}add(y,S){this.controller_.rack.add(y.controller_,S);const U=this.apiSet_.find(Y=>Y.controller_===y.controller_);return U&&this.apiSet_.remove(U),this.apiSet_.add(y),y}remove(y){this.controller_.rack.remove(y.controller_)}addBlade(y){const S=this.controller_.view.element.ownerDocument,U=this.pool_.createBlade(S,y),Y=this.pool_.createBladeApi(U);return this.add(Y,y.index)}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}setUpApi_(y){this.apiSet_.find(S=>S.controller_===y)||this.apiSet_.add(this.pool_.createBladeApi(y))}onRackAdd_(y){this.setUpApi_(y.bladeController)}onRackRemove_(y){if(y.isRoot){const S=Al(this.apiSet_,y.bladeController);this.apiSet_.remove(S)}}onRackInputChange_(y){const S=y.bladeController;if(S instanceof _s){const U=Al(this.apiSet_,S),Y=S.binding;this.emitter_.emit("change",{event:new Ke(U,Y.target.read(),Y.target.presetKey,y.options.last)})}else if(S instanceof gr){const U=Al(this.apiSet_,S);this.emitter_.emit("change",{event:new Ke(U,S.value.rawValue,void 0,y.options.last)})}}onRackMonitorUpdate_(y){if(!(y.bladeController instanceof Jo))throw Ie.shouldNeverHappen();const S=Al(this.apiSet_,y.bladeController),U=y.bladeController.binding;this.emitter_.emit("update",{event:new He(S,U.target.read(),U.target.presetKey)})}}class nh extends xi{constructor(y,S){super(y,new _r(y.rackController,S)),this.emitter_=new ht,this.controller_.foldable.value("expanded").emitter.on("change",U=>{this.emitter_.emit("fold",{event:new ft(this,U.sender.rawValue)})}),this.rackApi_.on("change",U=>{this.emitter_.emit("change",{event:U})}),this.rackApi_.on("update",U=>{this.emitter_.emit("update",{event:U})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(y){this.controller_.foldable.set("expanded",y)}get title(){return this.controller_.props.get("title")}set title(y){this.controller_.props.set("title",y)}get children(){return this.rackApi_.children}addInput(y,S,U){return this.rackApi_.addInput(y,S,U)}addMonitor(y,S,U){return this.rackApi_.addMonitor(y,S,U)}addFolder(y){return this.rackApi_.addFolder(y)}addButton(y){return this.rackApi_.addButton(y)}addSeparator(y){return this.rackApi_.addSeparator(y)}addTab(y){return this.rackApi_.addTab(y)}add(y,S){return this.rackApi_.add(y,S)}remove(y){this.rackApi_.remove(y)}addBlade(y){return this.rackApi_.addBlade(y)}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}}class Ra extends Me{constructor(y){super({blade:y.blade,view:y.view,viewProps:y.rackController.viewProps}),this.rackController=y.rackController}}class bl{constructor(y,S){const U=Ue(S.viewName);this.element=y.createElement("div"),this.element.classList.add(U()),S.viewProps.bindClassModifiers(this.element)}}function Wp(B){return B instanceof ys?B.rack:B instanceof Ra?B.rackController.rack:null}function ec(B){const y=Wp(B);return y?y.bcSet_:null}class qp{constructor(y){var S,U;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new ht,this.blade_=(S=y.blade)!==null&&S!==void 0?S:null,(U=this.blade_)===null||U===void 0||U.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=y.viewProps,this.bcSet_=new Di(ec),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(y,S){var U;(U=y.parent)===null||U===void 0||U.remove(y),bt(y,"parent")?y.parent=this:(y.parent_=this,Dt({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(y,S)}remove(y){bt(y,"parent")?y.parent=null:(y.parent_=null,Dt({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(y)}find(y){return this.bcSet_.allItems().filter(S=>S instanceof y)}onSetAdd_(y){this.updatePositions_();const S=y.target===y.root;if(this.emitter.emit("add",{bladeController:y.item,index:y.index,isRoot:S,sender:this}),!S)return;const U=y.item;if(U.viewProps.emitter.on("change",this.onChildViewPropsChange_),U.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),U.viewProps.handleDispose(this.onChildDispose_),U instanceof _s)U.binding.emitter.on("change",this.onChildInputChange_);else if(U instanceof Jo)U.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(U instanceof gr)U.value.emitter.on("change",this.onChildValueChange_);else{const Y=Wp(U);if(Y){const ye=Y.emitter;ye.on("layout",this.onDescendantLayout_),ye.on("inputchange",this.onDescendantInputChange_),ye.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(y){this.updatePositions_();const S=y.target===y.root;if(this.emitter.emit("remove",{bladeController:y.item,isRoot:S,sender:this}),!S)return;const U=y.item;if(U instanceof _s)U.binding.emitter.off("change",this.onChildInputChange_);else if(U instanceof Jo)U.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(U instanceof gr)U.value.emitter.off("change",this.onChildValueChange_);else{const Y=Wp(U);if(Y){const ye=Y.emitter;ye.off("layout",this.onDescendantLayout_),ye.off("inputchange",this.onDescendantInputChange_),ye.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const y=this.bcSet_.items.filter(Y=>!Y.viewProps.get("hidden")),S=y[0],U=y[y.length-1];this.bcSet_.items.forEach(Y=>{const ye=[];Y===S&&(ye.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||ye.push("veryfirst")),Y===U&&(ye.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||ye.push("verylast")),Y.blade.set("positions",ye)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(y){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(y=>y.viewProps.get("disposed")).forEach(y=>{this.bcSet_.remove(y)})}onChildInputChange_(y){const S=function(U,Y){for(let ye=0;ye<U.length;ye++){const xe=U[ye];if(xe instanceof _s&&xe.binding===Y)return xe}return null}(this.find(_s),y.sender);if(!S)throw Ie.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:S,options:y.options,sender:this})}onChildMonitorUpdate_(y){const S=function(U,Y){for(let ye=0;ye<U.length;ye++){const xe=U[ye];if(xe instanceof Jo&&xe.binding===Y)return xe}return null}(this.find(Jo),y.sender);if(!S)throw Ie.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:S,sender:this})}onChildValueChange_(y){const S=function(U,Y){for(let ye=0;ye<U.length;ye++){const xe=U[ye];if(xe instanceof gr&&xe.value===Y)return xe}return null}(this.find(gr),y.sender);if(!S)throw Ie.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:S,options:y.options,sender:this})}onDescendantLayout_(y){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(y){this.emitter.emit("inputchange",{bladeController:y.bladeController,options:y.options,sender:this})}onDescendantMonitorUpdate_(y){this.emitter.emit("monitorupdate",{bladeController:y.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ys extends Me{constructor(y,S){super(Object.assign(Object.assign({},S),{view:new bl(y,{viewName:"brk",viewProps:S.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const U=new qp({blade:S.root?void 0:S.blade,viewProps:S.viewProps});U.emitter.on("add",this.onRackAdd_),U.emitter.on("remove",this.onRackRemove_),this.rack=U,this.viewProps.handleDispose(()=>{for(let Y=this.rack.children.length-1;Y>=0;Y--)this.rack.children[Y].viewProps.set("disposed",!0)})}onRackAdd_(y){y.isRoot&&Qi(this.view.element,y.bladeController.view.element,y.index)}onRackRemove_(y){y.isRoot&&qi(y.bladeController.view.element)}}const ih=Ue("cnt");class Rv{constructor(y,S){var U;this.className_=Ue((U=S.viewName)!==null&&U!==void 0?U:"fld"),this.element=y.createElement("div"),this.element.classList.add(this.className_(),ih()),S.viewProps.bindClassModifiers(this.element),this.foldable_=S.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Be(this.foldable_,"completed",Qe(this.element,this.className_(void 0,"cpl")));const Y=y.createElement("button");Y.classList.add(this.className_("b")),Be(S.props,"title",bn=>{st(bn)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),S.viewProps.bindDisabled(Y),this.element.appendChild(Y),this.buttonElement=Y;const ye=y.createElement("div");ye.classList.add(this.className_("i")),this.element.appendChild(ye);const xe=y.createElement("div");xe.classList.add(this.className_("t")),Z(S.props.value("title"),xe),this.buttonElement.appendChild(xe),this.titleElement=xe;const dt=y.createElement("div");dt.classList.add(this.className_("m")),this.buttonElement.appendChild(dt);const Jt=S.containerElement;Jt.classList.add(this.className_("c")),this.element.appendChild(Jt),this.containerElement=Jt}}class wl extends Ra{constructor(y,S){var U;const Y=Ji.create((U=S.expanded)===null||U===void 0||U),ye=new ys(y,{blade:S.blade,root:S.root,viewProps:S.viewProps});super(Object.assign(Object.assign({},S),{rackController:ye,view:new Rv(y,{containerElement:ye.view.element,foldable:Y,props:S.props,viewName:S.root?"rot":void 0,viewProps:S.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=S.props,this.foldable=Y,gs(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const tc={id:"folder",type:"blade",accept(B){const y=wt,S=_t(B,{title:y.required.string,view:y.required.constant("folder"),expanded:y.optional.boolean});return S?{params:S}:null},controller(B){return new wl(B.document,{blade:B.blade,expanded:B.params.expanded,props:pe.fromObject({title:B.params.title}),viewProps:B.viewProps})},api(B){return B.controller instanceof wl?new nh(B.controller,B.pool):null}};class pr extends gr{constructor(y,S){const U=S.valueController.viewProps;super(Object.assign(Object.assign({},S),{value:S.valueController.value,view:new ar(y,{props:S.props,viewProps:U}),viewProps:U})),this.props=S.props,this.valueController=S.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class wd extends qe{}const vm=Ue("spr");class ns{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(vm()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("hr");U.classList.add(vm("r")),this.element.appendChild(U)}}class rh extends Me{constructor(y,S){super(Object.assign(Object.assign({},S),{view:new ns(y,{viewProps:S.viewProps})}))}}const Sr={id:"separator",type:"blade",accept(B){const y=_t(B,{view:wt.required.constant("separator")});return y?{params:y}:null},controller(B){return new rh(B.document,{blade:B.blade,viewProps:B.viewProps})},api(B){return B.controller instanceof rh?new wd(B.controller):null}},Gt=Ue("tbi");class nc{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(Gt()),S.viewProps.bindClassModifiers(this.element),Be(S.props,"selected",ye=>{ye?this.element.classList.add(Gt(void 0,"sel")):this.element.classList.remove(Gt(void 0,"sel"))});const U=y.createElement("button");U.classList.add(Gt("b")),S.viewProps.bindDisabled(U),this.element.appendChild(U),this.buttonElement=U;const Y=y.createElement("div");Y.classList.add(Gt("t")),Z(S.props.value("title"),Y),this.buttonElement.appendChild(Y),this.titleElement=Y}}class cn{constructor(y,S){this.emitter=new ht,this.onClick_=this.onClick_.bind(this),this.props=S.props,this.viewProps=S.viewProps,this.view=new nc(y,{props:S.props,viewProps:S.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class As{constructor(y,S){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new cn(y,{props:S.itemProps,viewProps:Ft.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new ys(y,{blade:Ae(),viewProps:Ft.create()}),this.props=S.props,Be(this.props,"selected",U=>{this.itemController.props.set("selected",U),this.contentController.viewProps.set("hidden",!U)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Uo{constructor(y,S){this.controller_=y,this.rackApi_=S}get title(){var y;return(y=this.controller_.itemController.props.get("title"))!==null&&y!==void 0?y:""}set title(y){this.controller_.itemController.props.set("title",y)}get selected(){return this.controller_.props.get("selected")}set selected(y){this.controller_.props.set("selected",y)}get children(){return this.rackApi_.children}addButton(y){return this.rackApi_.addButton(y)}addFolder(y){return this.rackApi_.addFolder(y)}addSeparator(y){return this.rackApi_.addSeparator(y)}addTab(y){return this.rackApi_.addTab(y)}add(y,S){this.rackApi_.add(y,S)}remove(y){this.rackApi_.remove(y)}addInput(y,S,U){return this.rackApi_.addInput(y,S,U)}addMonitor(y,S,U){return this.rackApi_.addMonitor(y,S,U)}addBlade(y){return this.rackApi_.addBlade(y)}}class Ai extends xi{constructor(y,S){super(y,new _r(y.rackController,S)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new ht,this.pageApiMap_=new Map,this.rackApi_.on("change",U=>{this.emitter_.emit("change",{event:U})}),this.rackApi_.on("update",U=>{this.emitter_.emit("update",{event:U})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(U=>{this.setUpPageApi_(U)})}get pages(){return this.controller_.pageSet.items.map(y=>{const S=this.pageApiMap_.get(y);if(!S)throw Ie.shouldNeverHappen();return S})}addPage(y){const S=this.controller_.view.element.ownerDocument,U=new As(S,{itemProps:pe.fromObject({selected:!1,title:y.title}),props:pe.fromObject({selected:!1})});this.controller_.add(U,y.index);const Y=this.pageApiMap_.get(U);if(!Y)throw Ie.shouldNeverHappen();return Y}removePage(y){this.controller_.remove(y)}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}setUpPageApi_(y){const S=this.rackApi_.apiSet_.find(Y=>Y.controller_===y.contentController);if(!S)throw Ie.shouldNeverHappen();const U=new Uo(y,S);this.pageApiMap_.set(y,U)}onPageAdd_(y){this.setUpPageApi_(y.item)}onPageRemove_(y){if(!this.pageApiMap_.get(y.item))throw Ie.shouldNeverHappen();this.pageApiMap_.delete(y.item)}onSelect_(y){this.emitter_.emit("select",{event:new Xe(this,y.rawValue)})}}class jn{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ce(!0),this.selectedIndex=ce(-1),this.items_=[]}add(y,S){const U=S??this.items_.length;this.items_.splice(U,0,y),y.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(y){const S=this.items_.indexOf(y);S<0||(this.items_.splice(S,1),y.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const y=this.items_.findIndex(S=>S.rawValue);y<0?(this.items_.forEach((S,U)=>{S.rawValue=U===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((S,U)=>{S.rawValue=U===y}),this.selectedIndex.rawValue=y),this.empty.rawValue=!1}onItemSelectedChange_(y){if(y.rawValue){const S=this.items_.findIndex(U=>U===y.sender);this.items_.forEach((U,Y)=>{U.rawValue=Y===S}),this.selectedIndex.rawValue=S}else this.keepSelection_()}}const Zo=Ue("tab");class sh{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(Zo(),ih()),S.viewProps.bindClassModifiers(this.element),Bt(S.empty,Qe(this.element,Zo(void 0,"nop")));const U=y.createElement("div");U.classList.add(Zo("t")),this.element.appendChild(U),this.itemsElement=U;const Y=y.createElement("div");Y.classList.add(Zo("i")),this.element.appendChild(Y);const ye=S.contentsElement;ye.classList.add(Zo("c")),this.element.appendChild(ye),this.contentsElement=ye}}class Da extends Ra{constructor(y,S){const U=new ys(y,{blade:S.blade,viewProps:S.viewProps}),Y=new jn;super({blade:S.blade,rackController:U,view:new sh(y,{contentsElement:U.view.element,empty:Y.empty,viewProps:S.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new Di(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=Y}get pageSet(){return this.pageSet_}add(y,S){this.pageSet_.add(y,S)}remove(y){this.pageSet_.remove(this.pageSet_.items[y])}onPageAdd_(y){const S=y.item;Qi(this.view.itemsElement,S.itemController.view.element,y.index),S.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(S.contentController,y.index),this.tab.add(S.props.value("selected"))}onPageRemove_(y){const S=y.item;qi(S.itemController.view.element),S.itemController.viewProps.set("parent",null),this.rackController.rack.remove(S.contentController),this.tab.remove(S.props.value("selected"))}}const Ba={id:"tab",type:"blade",accept(B){const y=wt,S=_t(B,{pages:y.required.array(y.required.object({title:y.required.string})),view:y.required.constant("tab")});return S&&S.pages.length!==0?{params:S}:null},controller(B){const y=new Da(B.document,{blade:B.blade,viewProps:B.viewProps});return B.params.pages.forEach(S=>{const U=new As(B.document,{itemProps:pe.fromObject({selected:!1,title:S.title}),props:pe.fromObject({selected:!1})});y.add(U)}),y},api(B){return B.controller instanceof Da?new Ai(B.controller,B.pool):null}};class Hn{constructor(){this.disabled=!1,this.emitter=new ht}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class su{constructor(y,S){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=y,this.emitter=new ht,this.interval_=S,this.setTimer_()}get disabled(){return this.disabled_}set disabled(y){this.disabled_=y,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const y=this.doc_.defaultView;y&&y.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const y=this.doc_.defaultView;y&&(this.timerId_=y.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class xd{constructor(y){this.onValueChange_=this.onValueChange_.bind(this),this.reader=y.reader,this.writer=y.writer,this.emitter=new ht,this.value=y.value,this.value.emitter.on("change",this.onValueChange_),this.target=y.target,this.read()}read(){const y=this.target.read();y!==void 0&&(this.value.rawValue=this.reader(y))}write_(y){this.writer(this.target,y)}onValueChange_(y){this.write_(y.rawValue),this.emitter.emit("change",{options:y.options,rawValue:y.rawValue,sender:this})}}function Ed(B,y){for(;B.length<y;)B.push(void 0)}function Sd(B){const y=[];return Ed(y,B),ce(y)}function Xp(B){const y=B.indexOf(void 0);return y<0?B:B.slice(0,y)}class _m{constructor(y){this.onTick_=this.onTick_.bind(this),this.reader_=y.reader,this.target=y.target,this.emitter=new ht,this.value=y.value,this.ticker=y.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const y=this.target.read();if(y===void 0)return;const S=this.value.rawValue,U=this.reader_(y);this.value.rawValue=function(Y,ye){const xe=[...Xp(Y),ye];return xe.length>Y.length?xe.splice(0,xe.length-Y.length):Ed(xe,Y.length),xe}(S,U),this.emitter.emit("update",{rawValue:U,sender:this})}onTick_(y){this.read()}}class Fi{constructor(y){this.constraints=y}constrain(y){return this.constraints.reduce((S,U)=>U.constrain(S),y)}}function Si(B,y){if(B instanceof y)return B;if(B instanceof Fi){const S=B.constraints.reduce((U,Y)=>U||(Y instanceof y?Y:null),null);if(S)return S}return null}class $o{constructor(y){this.values=pe.fromObject({max:y.max,min:y.min})}constrain(y){const S=this.values.get("max"),U=this.values.get("min");return Math.min(Math.max(y,U),S)}}class Ds{constructor(y){this.values=pe.fromObject({options:y})}get options(){return this.values.get("options")}constrain(y){const S=this.values.get("options");return S.length===0||S.filter(U=>U.value===y).length>0?y:S[0].value}}class xl{constructor(y){this.values=pe.fromObject({max:y.max,min:y.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(y){const S=this.values.get("max"),U=this.values.get("min");let Y=y;return st(U)||(Y=Math.max(Y,U)),st(S)||(Y=Math.min(Y,S)),Y}}class is{constructor(y,S=0){this.step=y,this.origin=S}constrain(y){const S=this.origin%this.step;return S+Math.round((y-S)/this.step)*this.step}}const Sn=Ue("lst");class rs{constructor(y,S){this.onValueChange_=this.onValueChange_.bind(this),this.props_=S.props,this.element=y.createElement("div"),this.element.classList.add(Sn()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("select");U.classList.add(Sn("s")),Be(this.props_,"options",ye=>{Ki(U),ye.forEach((xe,dt)=>{const Jt=y.createElement("option");Jt.dataset.index=String(dt),Jt.textContent=xe.text,Jt.value=String(xe.value),U.appendChild(Jt)})}),S.viewProps.bindDisabled(U),this.element.appendChild(U),this.selectElement=U;const Y=y.createElement("div");Y.classList.add(Sn("m")),Y.appendChild(In(y,"dropdown")),this.element.appendChild(Y),S.value.emitter.on("change",this.onValueChange_),this.value_=S.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Bc{constructor(y,S){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=S.props,this.value=S.value,this.viewProps=S.viewProps,this.view=new rs(y,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(y){const S=y.currentTarget.selectedOptions.item(0);if(!S)return;const U=Number(S.dataset.index);this.value.rawValue=this.props.get("options")[U].value}}const ic=Ue("pop");class Yp{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(ic()),S.viewProps.bindClassModifiers(this.element),Bt(S.shows,Qe(this.element,ic(void 0,"v")))}}class rc{constructor(y,S){this.shows=ce(!1),this.viewProps=S.viewProps,this.view=new Yp(y,{shows:this.shows,viewProps:this.viewProps})}}const Fr=Ue("txt");class ou{constructor(y,S){this.onChange_=this.onChange_.bind(this),this.element=y.createElement("div"),this.element.classList.add(Fr()),S.viewProps.bindClassModifiers(this.element),this.props_=S.props,this.props_.emitter.on("change",this.onChange_);const U=y.createElement("input");U.classList.add(Fr("i")),U.type="text",S.viewProps.bindDisabled(U),this.element.appendChild(U),this.inputElement=U,S.value.emitter.on("change",this.onChange_),this.value_=S.value,this.refresh()}refresh(){const y=this.props_.get("formatter");this.inputElement.value=y(this.value_.rawValue)}onChange_(){this.refresh()}}class au{constructor(y,S){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=S.parser,this.props=S.props,this.value=S.value,this.viewProps=S.viewProps,this.view=new ou(y,{props:S.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(y){const S=y.currentTarget.value,U=this.parser_(S);st(U)||(this.value.rawValue=U),this.view.refresh()}}function Kp(B){return B!=="false"&&!!B}function vo(B){return function(y){return String(y)}(B)}class En{constructor(y){this.text=y}evaluate(){return Number(this.text)}toString(){return this.text}}const sc={"**":(B,y)=>Math.pow(B,y),"*":(B,y)=>B*y,"/":(B,y)=>B/y,"%":(B,y)=>B%y,"+":(B,y)=>B+y,"-":(B,y)=>B-y,"<<":(B,y)=>B<<y,">>":(B,y)=>B>>y,">>>":(B,y)=>B>>>y,"&":(B,y)=>B&y,"^":(B,y)=>B^y,"|":(B,y)=>B|y};class ea{constructor(y,S,U){this.left=S,this.operator=y,this.right=U}evaluate(){const y=sc[this.operator];if(!y)throw new Error(`unexpected binary operator: '${this.operator}`);return y(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Jp={"+":B=>B,"-":B=>-B,"~":B=>~B};class Ii{constructor(y,S){this.operator=y,this.expression=S}evaluate(){const y=Jp[this.operator];if(!y)throw new Error(`unexpected unary operator: '${this.operator}`);return y(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Zp(B){return(y,S)=>{for(let U=0;U<B.length;U++){const Y=B[U](y,S);if(Y!=="")return Y}return""}}function lu(B,y){var S;const U=B.substr(y).match(/^\s+/);return(S=U&&U[0])!==null&&S!==void 0?S:""}function El(B,y){var S;const U=B.substr(y).match(/^[0-9]+/);return(S=U&&U[0])!==null&&S!==void 0?S:""}function Oc(B,y){const S=B.substr(y,1);if(y+=1,S.toLowerCase()!=="e")return"";const U=function(Y,ye){const xe=El(Y,ye);if(xe!=="")return xe;const dt=Y.substr(ye,1);if(dt!=="-"&&dt!=="+")return"";const Jt=El(Y,ye+=1);return Jt===""?"":dt+Jt}(B,y);return U===""?"":S+U}function Cd(B,y){const S=B.substr(y,1);if(S==="0")return S;const U=function(Y,ye){const xe=Y.substr(ye,1);return xe.match(/^[1-9]$/)?xe:""}(B,y);return y+=U.length,U===""?"":U+El(B,y)}const oc=Zp([function(B,y){const S=Cd(B,y);if(y+=S.length,S==="")return"";const U=B.substr(y,1);if(y+=U.length,U!==".")return"";const Y=El(B,y);return S+U+Y+Oc(B,y+=Y.length)},function(B,y){const S=B.substr(y,1);if(y+=S.length,S!==".")return"";const U=El(B,y);return y+=U.length,U===""?"":S+U+Oc(B,y)},function(B,y){const S=Cd(B,y);return y+=S.length,S===""?"":S+Oc(B,y)}]),ac=Zp([function(B,y){const S=B.substr(y,2);if(y+=S.length,S.toLowerCase()!=="0b")return"";const U=function(Y,ye){var xe;const dt=Y.substr(ye).match(/^[01]+/);return(xe=dt&&dt[0])!==null&&xe!==void 0?xe:""}(B,y);return U===""?"":S+U},function(B,y){const S=B.substr(y,2);if(y+=S.length,S.toLowerCase()!=="0o")return"";const U=function(Y,ye){var xe;const dt=Y.substr(ye).match(/^[0-7]+/);return(xe=dt&&dt[0])!==null&&xe!==void 0?xe:""}(B,y);return U===""?"":S+U},function(B,y){const S=B.substr(y,2);if(y+=S.length,S.toLowerCase()!=="0x")return"";const U=function(Y,ye){var xe;const dt=Y.substr(ye).match(/^[0-9a-f]+/i);return(xe=dt&&dt[0])!==null&&xe!==void 0?xe:""}(B,y);return U===""?"":S+U}]),cu=Zp([ac,oc]);function Hs(B,y){var S;return(S=function(U,Y){const ye=cu(U,Y);return Y+=ye.length,ye===""?null:{evaluable:new En(ye),cursor:Y}}(B,y))!==null&&S!==void 0?S:function(U,Y){const ye=U.substr(Y,1);if(Y+=ye.length,ye!=="(")return null;const xe=Td(U,Y);if(!xe)return null;Y=xe.cursor,Y+=lu(U,Y).length;const dt=U.substr(Y,1);return Y+=dt.length,dt!==")"?null:{evaluable:xe.evaluable,cursor:Y}}(B,y)}function Md(B,y,S){S+=lu(y,S).length;const U=B.filter(Y=>y.startsWith(Y,S))[0];return U?(S+=U.length,{cursor:S+=lu(y,S).length,operator:U}):null}const Sl=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((B,y)=>function(S,U){return(Y,ye)=>{const xe=S(Y,ye);if(!xe)return null;ye=xe.cursor;let dt=xe.evaluable;for(;;){const Jt=Md(U,Y,ye);if(!Jt)break;ye=Jt.cursor;const bn=S(Y,ye);if(!bn)return null;ye=bn.cursor,dt=new ea(Jt.operator,dt,bn.evaluable)}return dt?{cursor:ye,evaluable:dt}:null}}(B,y),function B(y,S){const U=Hs(y,S);if(U)return U;const Y=y.substr(S,1);if(S+=Y.length,Y!=="+"&&Y!=="-"&&Y!=="~")return null;const ye=B(y,S);return ye?{cursor:S=ye.cursor,evaluable:new Ii(Y,ye.evaluable)}:null});function Td(B,y){return y+=lu(B,y).length,Sl(B,y)}function $a(B){var y;const S=function(U){const Y=Td(U,0);return Y?Y.cursor+lu(U,Y.cursor).length!==U.length?null:Y.evaluable:null}(B);return(y=S==null?void 0:S.evaluate())!==null&&y!==void 0?y:null}function Id(B){if(typeof B=="number")return B;if(typeof B=="string"){const y=$a(B);if(!st(y))return y}return 0}function Cl(B){return String(B)}function bs(B){return y=>y.toFixed(Math.max(Math.min(B,20),0))}const Br=bs(0);function No(B){return Br(B)+"%"}function $p(B){return String(B)}function ta(B){return B}function Jn({primary:B,secondary:y,forward:S,backward:U}){let Y=!1;function ye(xe){Y||(Y=!0,xe(),Y=!1)}B.emitter.on("change",xe=>{ye(()=>{y.setRawValue(S(B,y),xe.options)})}),y.emitter.on("change",xe=>{ye(()=>{B.setRawValue(U(B,y),xe.options)}),ye(()=>{y.setRawValue(S(B,y),xe.options)})}),ye(()=>{y.setRawValue(S(B,y),{forceEmit:!1,last:!0})})}function fr(B,y){const S=B*(y.altKey?.1:1)*(y.shiftKey?10:1);return y.upKey?+S:y.downKey?-S:0}function Lc(B){return{altKey:B.altKey,downKey:B.key==="ArrowDown",shiftKey:B.shiftKey,upKey:B.key==="ArrowUp"}}function Wi(B){return{altKey:B.altKey,downKey:B.key==="ArrowLeft",shiftKey:B.shiftKey,upKey:B.key==="ArrowRight"}}function Dv(B){return function(y){return y==="ArrowUp"||y==="ArrowDown"}(B)||B==="ArrowLeft"||B==="ArrowRight"}function Bi(B,y){var S,U;const Y=y.ownerDocument.defaultView,ye=y.getBoundingClientRect();return{x:B.pageX-(((S=Y&&Y.scrollX)!==null&&S!==void 0?S:0)+ye.left),y:B.pageY-(((U=Y&&Y.scrollY)!==null&&U!==void 0?U:0)+ye.top)}}class uu{constructor(y){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=y,this.emitter=new ht,y.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),y.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),y.addEventListener("touchend",this.onTouchEnd_),y.addEventListener("mousedown",this.onMouseDown_)}computePosition_(y){const S=this.elem_.getBoundingClientRect();return{bounds:{width:S.width,height:S.height},point:y?{x:y.x,y:y.y}:null}}onMouseDown_(y){var S;y.preventDefault(),(S=y.currentTarget)===null||S===void 0||S.focus();const U=this.elem_.ownerDocument;U.addEventListener("mousemove",this.onDocumentMouseMove_),U.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:y.altKey,data:this.computePosition_(Bi(y,this.elem_)),sender:this,shiftKey:y.shiftKey})}onDocumentMouseMove_(y){this.emitter.emit("move",{altKey:y.altKey,data:this.computePosition_(Bi(y,this.elem_)),sender:this,shiftKey:y.shiftKey})}onDocumentMouseUp_(y){const S=this.elem_.ownerDocument;S.removeEventListener("mousemove",this.onDocumentMouseMove_),S.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:y.altKey,data:this.computePosition_(Bi(y,this.elem_)),sender:this,shiftKey:y.shiftKey})}onTouchStart_(y){y.preventDefault();const S=y.targetTouches.item(0),U=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:y.altKey,data:this.computePosition_(S?{x:S.clientX-U.left,y:S.clientY-U.top}:void 0),sender:this,shiftKey:y.shiftKey}),this.lastTouch_=S}onTouchMove_(y){const S=y.targetTouches.item(0),U=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:y.altKey,data:this.computePosition_(S?{x:S.clientX-U.left,y:S.clientY-U.top}:void 0),sender:this,shiftKey:y.shiftKey}),this.lastTouch_=S}onTouchEnd_(y){var S;const U=(S=y.targetTouches.item(0))!==null&&S!==void 0?S:this.lastTouch_,Y=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:y.altKey,data:this.computePosition_(U?{x:U.clientX-Y.left,y:U.clientY-Y.top}:void 0),sender:this,shiftKey:y.shiftKey})}}function Cr(B,y,S,U,Y){return U+(B-y)/(S-y)*(Y-U)}function Bv(B){return String(B.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ws(B,y,S){return Math.min(Math.max(B,y),S)}function Ov(B,y){return(B%y+y)%y}const Oa=Ue("txt");class S0{constructor(y,S){this.onChange_=this.onChange_.bind(this),this.props_=S.props,this.props_.emitter.on("change",this.onChange_),this.element=y.createElement("div"),this.element.classList.add(Oa(),Oa(void 0,"num")),S.arrayPosition&&this.element.classList.add(Oa(void 0,S.arrayPosition)),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("input");U.classList.add(Oa("i")),U.type="text",S.viewProps.bindDisabled(U),this.element.appendChild(U),this.inputElement=U,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=S.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Oa()),this.inputElement.classList.add(Oa("i"));const Y=y.createElement("div");Y.classList.add(Oa("k")),this.element.appendChild(Y),this.knobElement=Y;const ye=y.createElementNS(Ne,"svg");ye.classList.add(Oa("g")),this.knobElement.appendChild(ye);const xe=y.createElementNS(Ne,"path");xe.classList.add(Oa("gb")),ye.appendChild(xe),this.guideBodyElem_=xe;const dt=y.createElementNS(Ne,"path");dt.classList.add(Oa("gh")),ye.appendChild(dt),this.guideHeadElem_=dt;const Jt=y.createElement("div");Jt.classList.add(Ue("tt")()),this.knobElement.appendChild(Jt),this.tooltipElem_=Jt,S.value.emitter.on("change",this.onChange_),this.value=S.value,this.refresh()}onDraggingChange_(y){if(y.rawValue===null)return void this.element.classList.remove(Oa(void 0,"drg"));this.element.classList.add(Oa(void 0,"drg"));const S=y.rawValue/this.props_.get("draggingScale"),U=S+(S>0?-1:S<0?1:0),Y=ws(-U,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${U+Y},0 L${U},4 L${U+Y},8`,`M ${S},-1 L${S},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${S},4`);const ye=this.props_.get("formatter");this.tooltipElem_.textContent=ye(this.value.rawValue),this.tooltipElem_.style.left=`${S}px`}refresh(){const y=this.props_.get("formatter");this.inputElement.value=y(this.value.rawValue)}onChange_(){this.refresh()}}class Pd{constructor(y,S){var U;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=S.baseStep,this.parser_=S.parser,this.props=S.props,this.sliderProps_=(U=S.sliderProps)!==null&&U!==void 0?U:null,this.value=S.value,this.viewProps=S.viewProps,this.dragging_=ce(null),this.view=new S0(y,{arrayPosition:S.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Y=new uu(this.view.knobElement);Y.emitter.on("down",this.onPointerDown_),Y.emitter.on("move",this.onPointerMove_),Y.emitter.on("up",this.onPointerUp_)}constrainValue_(y){var S,U;const Y=(S=this.sliderProps_)===null||S===void 0?void 0:S.get("minValue"),ye=(U=this.sliderProps_)===null||U===void 0?void 0:U.get("maxValue");let xe=y;return Y!==void 0&&(xe=Math.max(xe,Y)),ye!==void 0&&(xe=Math.min(xe,ye)),xe}onInputChange_(y){const S=y.currentTarget.value,U=this.parser_(S);st(U)||(this.value.rawValue=this.constrainValue_(U)),this.view.refresh()}onInputKeyDown_(y){const S=fr(this.baseStep_,Lc(y));S!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+S),{forceEmit:!1,last:!1})}onInputKeyUp_(y){fr(this.baseStep_,Lc(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(y){if(!y.point)return null;const S=y.point.x-y.bounds.width/2;return this.constrainValue_(this.originRawValue_+S*this.props.get("draggingScale"))}onPointerMove_(y){const S=this.computeDraggingValue_(y.data);S!==null&&(this.value.setRawValue(S,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(y){const S=this.computeDraggingValue_(y.data);S!==null&&(this.value.setRawValue(S,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const ym=Ue("sld");class C0{constructor(y,S){this.onChange_=this.onChange_.bind(this),this.props_=S.props,this.props_.emitter.on("change",this.onChange_),this.element=y.createElement("div"),this.element.classList.add(ym()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(ym("t")),S.viewProps.bindTabIndex(U),this.element.appendChild(U),this.trackElement=U;const Y=y.createElement("div");Y.classList.add(ym("k")),this.trackElement.appendChild(Y),this.knobElement=Y,S.value.emitter.on("change",this.onChange_),this.value=S.value,this.update_()}update_(){const y=ws(Cr(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${y}%`}onChange_(){this.update_()}}class M0{constructor(y,S){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=S.baseStep,this.value=S.value,this.viewProps=S.viewProps,this.props=S.props,this.view=new C0(y,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new uu(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,S){y.point&&this.value.setRawValue(Cr(ws(y.point.x,0,y.bounds.width),0,y.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),S)}onPointerDownOrMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){const S=fr(this.baseStep_,Wi(y));S!==0&&this.value.setRawValue(this.value.rawValue+S,{forceEmit:!1,last:!1})}onKeyUp_(y){fr(this.baseStep_,Wi(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Am=Ue("sldtxt");class T0{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(Am());const U=y.createElement("div");U.classList.add(Am("s")),this.sliderView_=S.sliderView,U.appendChild(this.sliderView_.element),this.element.appendChild(U);const Y=y.createElement("div");Y.classList.add(Am("t")),this.textView_=S.textView,Y.appendChild(this.textView_.element),this.element.appendChild(Y)}}class ef{constructor(y,S){this.value=S.value,this.viewProps=S.viewProps,this.sliderC_=new M0(y,{baseStep:S.baseStep,props:S.sliderProps,value:S.value,viewProps:this.viewProps}),this.textC_=new Pd(y,{baseStep:S.baseStep,parser:S.parser,props:S.textProps,sliderProps:S.sliderProps,value:S.value,viewProps:S.viewProps}),this.view=new T0(y,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function lc(B,y){B.write(y)}function Rd(B){const y=wt;return Array.isArray(B)?y.required.array(y.required.object({text:y.required.string,value:y.required.raw}))(B).value:typeof B=="object"?y.required.raw(B).value:void 0}function bm(B){if(B==="inline"||B==="popup")return B}function kc(B){const y=wt;return y.required.object({max:y.optional.number,min:y.optional.number,step:y.optional.number})(B).value}function Lv(B){if(Array.isArray(B))return B;const y=[];return Object.keys(B).forEach(S=>{y.push({text:S,value:B[S]})}),y}function wm(B){return st(B)?null:new Ds(Lv(B))}function Dd(B,y){const S=B&&Si(B,is);return S?Bv(S.step):Math.max(Bv(y),2)}function oh(B){const y=function(S){const U=S?Si(S,is):null;return U?U.step:null}(B);return y??1}function ah(B,y){var S;const U=B&&Si(B,is),Y=Math.abs((S=U==null?void 0:U.step)!==null&&S!==void 0?S:y);return Y===0?.1:Math.pow(10,Math.floor(Math.log10(Y))-1)}const _o=Ue("ckb");class Uc{constructor(y,S){this.onValueChange_=this.onValueChange_.bind(this),this.element=y.createElement("div"),this.element.classList.add(_o()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("label");U.classList.add(_o("l")),this.element.appendChild(U);const Y=y.createElement("input");Y.classList.add(_o("i")),Y.type="checkbox",U.appendChild(Y),this.inputElement=Y,S.viewProps.bindDisabled(this.inputElement);const ye=y.createElement("div");ye.classList.add(_o("w")),U.appendChild(ye);const xe=In(y,"check");ye.appendChild(xe),S.value.emitter.on("change",this.onValueChange_),this.value=S.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Bd{constructor(y,S){this.onInputChange_=this.onInputChange_.bind(this),this.value=S.value,this.viewProps=S.viewProps,this.view=new Uc(y,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(y){const S=y.currentTarget;this.value.rawValue=S.checked}}const Ml={id:"input-bool",type:"input",accept:(B,y)=>{if(typeof B!="boolean")return null;const S=_t(y,{options:wt.optional.custom(Rd)});return S?{initialValue:B,params:S}:null},binding:{reader:B=>Kp,constraint:B=>function(y){const S=[],U=wm(y.options);return U&&S.push(U),new Fi(S)}(B.params),writer:B=>lc},controller:B=>{const y=B.document,S=B.value,U=B.constraint,Y=U&&Si(U,Ds);return Y?new Bc(y,{props:new pe({options:Y.values.value("options")}),value:S,viewProps:B.viewProps}):new Bd(y,{value:S,viewProps:B.viewProps})}},Mr=Ue("col");class tf{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(Mr()),S.foldable.bindExpandedClass(this.element,Mr(void 0,"expanded")),Be(S.foldable,"completed",Qe(this.element,Mr(void 0,"cpl")));const U=y.createElement("div");U.classList.add(Mr("h")),this.element.appendChild(U);const Y=y.createElement("div");Y.classList.add(Mr("s")),U.appendChild(Y),this.swatchElement=Y;const ye=y.createElement("div");if(ye.classList.add(Mr("t")),U.appendChild(ye),this.textElement=ye,S.pickerLayout==="inline"){const xe=y.createElement("div");xe.classList.add(Mr("p")),this.element.appendChild(xe),this.pickerElement=xe}else this.pickerElement=null}}function na(B,y,S){const U=Ov(B,360),Y=ws(y/100,0,1),ye=ws(S/100,0,1),xe=ye*Y,dt=xe*(1-Math.abs(U/60%2-1)),Jt=ye-xe;let bn,oi,yr;return[bn,oi,yr]=U>=0&&U<60?[xe,dt,0]:U>=60&&U<120?[dt,xe,0]:U>=120&&U<180?[0,xe,dt]:U>=180&&U<240?[0,dt,xe]:U>=240&&U<300?[dt,0,xe]:[xe,0,dt],[255*(bn+Jt),255*(oi+Jt),255*(yr+Jt)]}function La(B){return[B[0],B[1],B[2]]}function ss(B,y){return[B[0],B[1],B[2],y]}const $i={hsl:{hsl:(B,y,S)=>[B,y,S],hsv:function(B,y,S){const U=S+y*(100-Math.abs(2*S-100))/200;return[B,U!==0?y*(100-Math.abs(2*S-100))/U:0,S+y*(100-Math.abs(2*S-100))/200]},rgb:function(B,y,S){const U=(B%360+360)%360,Y=ws(y/100,0,1),ye=ws(S/100,0,1),xe=(1-Math.abs(2*ye-1))*Y,dt=xe*(1-Math.abs(U/60%2-1)),Jt=ye-xe/2;let bn,oi,yr;return[bn,oi,yr]=U>=0&&U<60?[xe,dt,0]:U>=60&&U<120?[dt,xe,0]:U>=120&&U<180?[0,xe,dt]:U>=180&&U<240?[0,dt,xe]:U>=240&&U<300?[dt,0,xe]:[xe,0,dt],[255*(bn+Jt),255*(oi+Jt),255*(yr+Jt)]}},hsv:{hsl:function(B,y,S){const U=100-Math.abs(S*(200-y)/100-100);return[B,U!==0?y*S/U:0,S*(200-y)/200]},hsv:(B,y,S)=>[B,y,S],rgb:na},rgb:{hsl:function(B,y,S){const U=ws(B/255,0,1),Y=ws(y/255,0,1),ye=ws(S/255,0,1),xe=Math.max(U,Y,ye),dt=Math.min(U,Y,ye),Jt=xe-dt;let bn=0,oi=0;const yr=(dt+xe)/2;return Jt!==0&&(oi=Jt/(1-Math.abs(xe+dt-1)),bn=U===xe?(Y-ye)/Jt:Y===xe?2+(ye-U)/Jt:4+(U-Y)/Jt,bn=bn/6+(bn<0?1:0)),[360*bn,100*oi,100*yr]},hsv:function(B,y,S){const U=ws(B/255,0,1),Y=ws(y/255,0,1),ye=ws(S/255,0,1),xe=Math.max(U,Y,ye),dt=xe-Math.min(U,Y,ye);let Jt;return Jt=dt===0?0:xe===U?((Y-ye)/dt%6+6)%6*60:xe===Y?60*((ye-U)/dt+2):60*((U-Y)/dt+4),[Jt,100*(xe===0?0:dt/xe),100*xe]},rgb:(B,y,S)=>[B,y,S]}};function lh(B,y){return[y==="float"?1:B==="rgb"?255:360,y==="float"?1:B==="rgb"?255:100,y==="float"?1:B==="rgb"?255:100]}function ch(B,y,S,U){const Y=lh(y,S),ye=lh(y,U);return B.map((xe,dt)=>xe/Y[dt]*ye[dt])}function hu(B,y){return typeof B=="object"&&!st(B)&&y in B&&typeof B[y]=="number"}class Pi{static black(y="int"){return new Pi([0,0,0],"rgb",y)}static fromObject(y,S="int"){const U="a"in y?[y.r,y.g,y.b,y.a]:[y.r,y.g,y.b];return new Pi(U,"rgb",S)}static toRgbaObject(y,S="int"){return y.toRgbaObject(S)}static isRgbColorObject(y){return hu(y,"r")&&hu(y,"g")&&hu(y,"b")}static isRgbaColorObject(y){return this.isRgbColorObject(y)&&hu(y,"a")}static isColorObject(y){return this.isRgbColorObject(y)}static equals(y,S){if(y.mode!==S.mode)return!1;const U=y.comps_,Y=S.comps_;for(let ye=0;ye<U.length;ye++)if(U[ye]!==Y[ye])return!1;return!0}constructor(y,S,U="int"){this.mode=S,this.type=U,this.comps_=function(Y,ye,xe){var dt;const Jt=lh(ye,xe);return[ye==="rgb"?ws(Y[0],0,Jt[0]):(bn=Y[0],oi=Jt[0],bn===oi?oi:Ov(bn,oi)),ws(Y[1],0,Jt[1]),ws(Y[2],0,Jt[2]),ws((dt=Y[3])!==null&&dt!==void 0?dt:1,0,1)];var bn,oi}(y,S,U)}getComponents(y,S="int"){return ss(function(U,Y,ye){const xe=ch(U,Y.mode,Y.type,"int");return ch($i[Y.mode][ye.mode](...xe),ye.mode,"int",ye.type)}(La(this.comps_),{mode:this.mode,type:this.type},{mode:y??this.mode,type:S}),this.comps_[3])}toRgbaObject(y="int"){const S=this.getComponents("rgb",y);return{r:S[0],g:S[1],b:S[2],a:S[3]}}}const cc=Ue("colp");class ia{constructor(y,S){this.alphaViews_=null,this.element=y.createElement("div"),this.element.classList.add(cc()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(cc("hsv"));const Y=y.createElement("div");Y.classList.add(cc("sv")),this.svPaletteView_=S.svPaletteView,Y.appendChild(this.svPaletteView_.element),U.appendChild(Y);const ye=y.createElement("div");ye.classList.add(cc("h")),this.hPaletteView_=S.hPaletteView,ye.appendChild(this.hPaletteView_.element),U.appendChild(ye),this.element.appendChild(U);const xe=y.createElement("div");if(xe.classList.add(cc("rgb")),this.textView_=S.textView,xe.appendChild(this.textView_.element),this.element.appendChild(xe),S.alphaViews){this.alphaViews_={palette:S.alphaViews.palette,text:S.alphaViews.text};const dt=y.createElement("div");dt.classList.add(cc("a"));const Jt=y.createElement("div");Jt.classList.add(cc("ap")),Jt.appendChild(this.alphaViews_.palette.element),dt.appendChild(Jt);const bn=y.createElement("div");bn.classList.add(cc("at")),bn.appendChild(this.alphaViews_.text.element),dt.appendChild(bn),this.element.appendChild(dt)}}get allFocusableElements(){const y=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(S=>S.inputElement)];return this.alphaViews_&&y.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),y}}function Mi(B){return B==="int"?"int":B==="float"?"float":void 0}function nf(B){const y=wt;return _t(B,{alpha:y.optional.boolean,color:y.optional.object({alpha:y.optional.boolean,type:y.optional.custom(Mi)}),expanded:y.optional.boolean,picker:y.optional.custom(bm)})}function Ht(B){return B?.1:1}function bi(B){var y;return(y=B.color)===null||y===void 0?void 0:y.type}function xs(B,y){const S=B.match(/^(.+)%$/);return Math.min(S?.01*parseFloat(S[1])*y:parseFloat(B),y)}const ra={deg:B=>B,grad:B=>360*B/400,rad:B=>360*B/(2*Math.PI),turn:B=>360*B};function xm(B){const y=B.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!y)return parseFloat(B);const S=parseFloat(y[1]),U=y[2];return ra[U](S)}function sa(B){const y=B.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const S=[xs(y[1],255),xs(y[2],255),xs(y[3],255)];return isNaN(S[0])||isNaN(S[1])||isNaN(S[2])?null:S}function ka(B){return y=>{const S=sa(y);return S?new Pi(S,"rgb",B):null}}function oa(B){const y=B.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const S=[xs(y[1],255),xs(y[2],255),xs(y[3],255),xs(y[4],1)];return isNaN(S[0])||isNaN(S[1])||isNaN(S[2])||isNaN(S[3])?null:S}function uh(B){return y=>{const S=oa(y);return S?new Pi(S,"rgb",B):null}}function du(B){const y=B.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const S=[xm(y[1]),xs(y[2],100),xs(y[3],100)];return isNaN(S[0])||isNaN(S[1])||isNaN(S[2])?null:S}function rf(B){return y=>{const S=du(y);return S?new Pi(S,"hsl",B):null}}function Em(B){const y=B.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const S=[xm(y[1]),xs(y[2],100),xs(y[3],100),xs(y[4],1)];return isNaN(S[0])||isNaN(S[1])||isNaN(S[2])||isNaN(S[3])?null:S}function Od(B){return y=>{const S=Em(y);return S?new Pi(S,"hsl",B):null}}function Ld(B){const y=B.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(y)return[parseInt(y[1]+y[1],16),parseInt(y[2]+y[2],16),parseInt(y[3]+y[3],16)];const S=B.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return S?[parseInt(S[1],16),parseInt(S[2],16),parseInt(S[3],16)]:null}function kd(B){const y=B.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(y)return[parseInt(y[1]+y[1],16),parseInt(y[2]+y[2],16),parseInt(y[3]+y[3],16),Cr(parseInt(y[4]+y[4],16),0,255,0,1)];const S=B.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return S?[parseInt(S[1],16),parseInt(S[2],16),parseInt(S[3],16),Cr(parseInt(S[4],16),0,255,0,1)]:null}function no(B){const y=B.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!y)return null;const S=[parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3])];return isNaN(S[0])||isNaN(S[1])||isNaN(S[2])?null:S}function pu(B){return y=>{const S=no(y);return S?new Pi(S,"rgb",B):null}}function sf(B){const y=B.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!y)return null;const S=[parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3]),parseFloat(y[4])];return isNaN(S[0])||isNaN(S[1])||isNaN(S[2])||isNaN(S[3])?null:S}function Nc(B){return y=>{const S=sf(y);return S?new Pi(S,"rgb",B):null}}const Sm=[{parser:Ld,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:kd,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:sa,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:oa,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:du,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Em,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:no,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:sf,result:{alpha:!0,mode:"rgb",notation:"object"}}];function of(B,y="int"){const S=function(U){return Sm.reduce((Y,{parser:ye,result:xe})=>Y||(ye(U)?xe:null),null)}(B);return S?S.notation==="hex"&&y!=="float"?Object.assign(Object.assign({},S),{type:"int"}):S.notation==="func"?Object.assign(Object.assign({},S),{type:y}):null:null}const Or={int:[function(B){const y=Ld(B);return y?new Pi(y,"rgb","int"):null},function(B){const y=kd(B);return y?new Pi(y,"rgb","int"):null},ka("int"),uh("int"),rf("int"),Od("int"),pu("int"),Nc("int")],float:[ka("float"),uh("float"),rf("float"),Od("float"),pu("float"),Nc("float")]};function ji(B){const y=Or[B];return S=>y.reduce((U,Y)=>U||Y(S),null)}function yo(B){const y=ws(Math.floor(B),0,255).toString(16);return y.length===1?`0${y}`:y}function fu(B,y="#"){return`${y}${La(B.getComponents("rgb")).map(yo).join("")}`}function Ud(B,y="#"){const S=B.getComponents("rgb");return`${y}${[S[0],S[1],S[2],255*S[3]].map(yo).join("")}`}function af(B,y){const S=bs(y==="float"?2:0);return`rgb(${La(B.getComponents("rgb",y)).map(U=>S(U)).join(", ")})`}function Cm(B){return y=>af(y,B)}function lf(B,y){const S=bs(2),U=bs(y==="float"?2:0);return`rgba(${B.getComponents("rgb",y).map((Y,ye)=>(ye===3?S:U)(Y)).join(", ")})`}function Ao(B){return y=>lf(y,B)}function fe(B,y){const S=bs(y==="float"?2:0),U=["r","g","b"];return`{${La(B.getComponents("rgb",y)).map((Y,ye)=>`${U[ye]}: ${S(Y)}`).join(", ")}}`}function os(B){return y=>fe(y,B)}function Tl(B,y){const S=bs(2),U=bs(y==="float"?2:0),Y=["r","g","b","a"];return`{${B.getComponents("rgb",y).map((ye,xe)=>`${Y[xe]}: ${(xe===3?S:U)(ye)}`).join(", ")}}`}function bo(B){return y=>Tl(y,B)}const Fo=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:fu},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ud},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(B){const y=[bs(0),No,No];return`hsl(${La(B.getComponents("hsl")).map((S,U)=>y[U](S)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(B){const y=[bs(0),No,No,bs(2)];return`hsla(${B.getComponents("hsl").map((S,U)=>y[U](S)).join(", ")})`}},...["int","float"].reduce((B,y)=>[...B,{format:{alpha:!1,mode:"rgb",notation:"func",type:y},stringifier:Cm(y)},{format:{alpha:!0,mode:"rgb",notation:"func",type:y},stringifier:Ao(y)},{format:{alpha:!1,mode:"rgb",notation:"object",type:y},stringifier:os(y)},{format:{alpha:!0,mode:"rgb",notation:"object",type:y},stringifier:bo(y)}],[])];function wo(B){return Fo.reduce((y,S)=>{return y||(U=S.format,Y=B,U.alpha===Y.alpha&&U.mode===Y.mode&&U.notation===Y.notation&&U.type===Y.type?S.stringifier:null);var U,Y},null)}const el=Ue("apl");class mu{constructor(y,S){this.onValueChange_=this.onValueChange_.bind(this),this.value=S.value,this.value.emitter.on("change",this.onValueChange_),this.element=y.createElement("div"),this.element.classList.add(el()),S.viewProps.bindClassModifiers(this.element),S.viewProps.bindTabIndex(this.element);const U=y.createElement("div");U.classList.add(el("b")),this.element.appendChild(U);const Y=y.createElement("div");Y.classList.add(el("c")),U.appendChild(Y),this.colorElem_=Y;const ye=y.createElement("div");ye.classList.add(el("m")),this.element.appendChild(ye),this.markerElem_=ye;const xe=y.createElement("div");xe.classList.add(el("p")),this.markerElem_.appendChild(xe),this.previewElem_=xe,this.update_()}update_(){const y=this.value.rawValue,S=y.getComponents("rgb"),U=new Pi([S[0],S[1],S[2],0],"rgb"),Y=new Pi([S[0],S[1],S[2],255],"rgb"),ye=["to right",lf(U),lf(Y)];this.colorElem_.style.background=`linear-gradient(${ye.join(",")})`,this.previewElem_.style.backgroundColor=lf(y);const xe=Cr(S[3],0,1,0,100);this.markerElem_.style.left=`${xe}%`}onValueChange_(){this.update_()}}class Fc{constructor(y,S){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=S.value,this.viewProps=S.viewProps,this.view=new mu(y,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new uu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,S){if(!y.point)return;const U=y.point.x/y.bounds.width,Y=this.value.rawValue,[ye,xe,dt]=Y.getComponents("hsv");this.value.setRawValue(new Pi([ye,xe,dt,U],"hsv"),S)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){const S=fr(Ht(!0),Wi(y));if(S===0)return;const U=this.value.rawValue,[Y,ye,xe,dt]=U.getComponents("hsv");this.value.setRawValue(new Pi([Y,ye,xe,dt+S],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(y){fr(Ht(!0),Wi(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const jo=Ue("coltxt");class uc{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(jo()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(jo("m")),this.modeElem_=function(xe){const dt=xe.createElement("select");return dt.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Jt,bn)=>{const oi=xe.createElement("option");return oi.textContent=bn.text,oi.value=bn.value,Jt.appendChild(oi),Jt},xe.createDocumentFragment())),dt}(y),this.modeElem_.classList.add(jo("ms")),U.appendChild(this.modeSelectElement),S.viewProps.bindDisabled(this.modeElem_);const Y=y.createElement("div");Y.classList.add(jo("mm")),Y.appendChild(In(y,"dropdown")),U.appendChild(Y),this.element.appendChild(U);const ye=y.createElement("div");ye.classList.add(jo("w")),this.element.appendChild(ye),this.textsElem_=ye,this.textViews_=S.textViews,this.applyTextViews_(),Bt(S.colorMode,xe=>{this.modeElem_.value=xe})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(y){this.textViews_=y,this.applyTextViews_()}applyTextViews_(){Ki(this.textsElem_);const y=this.element.ownerDocument;this.textViews_.forEach(S=>{const U=y.createElement("div");U.classList.add(jo("c")),U.appendChild(S.element),this.textsElem_.appendChild(U)})}}function hc(B,y,S){const U=lh(B,y)[S];return new $o({min:0,max:U})}function tl(B,y,S){return new Pd(B,{arrayPosition:S===0?"fst":S===2?"lst":"mid",baseStep:Ht(!1),parser:y.parser,props:pe.fromObject({draggingScale:y.colorType==="float"?.01:1,formatter:(U=y.colorType,bs(U==="float"?2:0))}),value:ce(0,{constraint:hc(y.colorMode,y.colorType,S)}),viewProps:y.viewProps});var U}class dc{constructor(y,S){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=S.colorType,this.parser_=S.parser,this.value=S.value,this.viewProps=S.viewProps,this.colorMode=ce(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(y),this.view=new uc(y,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(y){const S={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},U=[tl(y,S,0),tl(y,S,1),tl(y,S,2)];return U.forEach((Y,ye)=>{Jn({primary:this.value,secondary:Y.value,forward:xe=>xe.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[ye],backward:(xe,dt)=>{const Jt=this.colorMode.rawValue,bn=xe.rawValue.getComponents(Jt,this.colorType_);return bn[ye]=dt.rawValue,new Pi(ss(La(bn),bn[3]),Jt,this.colorType_)}})}),U}onModeSelectChange_(y){const S=y.currentTarget;this.colorMode.rawValue=S.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const er=Ue("hpl");class Il{constructor(y,S){this.onValueChange_=this.onValueChange_.bind(this),this.value=S.value,this.value.emitter.on("change",this.onValueChange_),this.element=y.createElement("div"),this.element.classList.add(er()),S.viewProps.bindClassModifiers(this.element),S.viewProps.bindTabIndex(this.element);const U=y.createElement("div");U.classList.add(er("c")),this.element.appendChild(U);const Y=y.createElement("div");Y.classList.add(er("m")),this.element.appendChild(Y),this.markerElem_=Y,this.update_()}update_(){const y=this.value.rawValue,[S]=y.getComponents("hsv");this.markerElem_.style.backgroundColor=af(new Pi([S,100,100],"hsv"));const U=Cr(S,0,360,0,100);this.markerElem_.style.left=`${U}%`}onValueChange_(){this.update_()}}class Bs{constructor(y,S){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=S.value,this.viewProps=S.viewProps,this.view=new Il(y,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new uu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,S){if(!y.point)return;const U=Cr(ws(y.point.x,0,y.bounds.width),0,y.bounds.width,0,360),Y=this.value.rawValue,[,ye,xe,dt]=Y.getComponents("hsv");this.value.setRawValue(new Pi([U,ye,xe,dt],"hsv"),S)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){const S=fr(Ht(!1),Wi(y));if(S===0)return;const U=this.value.rawValue,[Y,ye,xe,dt]=U.getComponents("hsv");this.value.setRawValue(new Pi([Y+S,ye,xe,dt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(y){fr(Ht(!1),Wi(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const aa=Ue("svp");class hh{constructor(y,S){this.onValueChange_=this.onValueChange_.bind(this),this.value=S.value,this.value.emitter.on("change",this.onValueChange_),this.element=y.createElement("div"),this.element.classList.add(aa()),S.viewProps.bindClassModifiers(this.element),S.viewProps.bindTabIndex(this.element);const U=y.createElement("canvas");U.height=64,U.width=64,U.classList.add(aa("c")),this.element.appendChild(U),this.canvasElement=U;const Y=y.createElement("div");Y.classList.add(aa("m")),this.element.appendChild(Y),this.markerElem_=Y,this.update_()}update_(){const y=function(bn){const oi=bn.ownerDocument.defaultView;return oi&&"document"in oi?bn.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!y)return;const S=this.value.rawValue.getComponents("hsv"),U=this.canvasElement.width,Y=this.canvasElement.height,ye=y.getImageData(0,0,U,Y),xe=ye.data;for(let bn=0;bn<Y;bn++)for(let oi=0;oi<U;oi++){const yr=Cr(oi,0,U,0,100),Xr=Cr(bn,0,Y,100,0),jr=na(S[0],yr,Xr),ma=4*(bn*U+oi);xe[ma]=jr[0],xe[ma+1]=jr[1],xe[ma+2]=jr[2],xe[ma+3]=255}y.putImageData(ye,0,0);const dt=Cr(S[1],0,100,0,100);this.markerElem_.style.left=`${dt}%`;const Jt=Cr(S[2],0,100,100,0);this.markerElem_.style.top=`${Jt}%`}onValueChange_(){this.update_()}}class dh{constructor(y,S){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=S.value,this.viewProps=S.viewProps,this.view=new hh(y,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new uu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,S){if(!y.point)return;const U=Cr(y.point.x,0,y.bounds.width,0,100),Y=Cr(y.point.y,0,y.bounds.height,100,0),[ye,,,xe]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Pi([ye,U,Y,xe],"hsv"),S)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){Dv(y.key)&&y.preventDefault();const[S,U,Y,ye]=this.value.rawValue.getComponents("hsv"),xe=Ht(!1),dt=fr(xe,Wi(y)),Jt=fr(xe,Lc(y));dt===0&&Jt===0||this.value.setRawValue(new Pi([S,U+dt,Y+Jt,ye],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(y){const S=Ht(!1),U=fr(S,Wi(y)),Y=fr(S,Lc(y));U===0&&Y===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class cf{constructor(y,S){this.value=S.value,this.viewProps=S.viewProps,this.hPaletteC_=new Bs(y,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new dh(y,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=S.supportsAlpha?{palette:new Fc(y,{value:this.value,viewProps:this.viewProps}),text:new Pd(y,{parser:$a,baseStep:.1,props:pe.fromObject({draggingScale:.01,formatter:bs(2)}),value:ce(0,{constraint:new $o({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Jn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:U=>U.rawValue.getComponents()[3],backward:(U,Y)=>{const ye=U.rawValue.getComponents();return ye[3]=Y.rawValue,new Pi(ye,U.rawValue.mode)}}),this.textC_=new dc(y,{colorType:S.colorType,parser:$a,value:this.value,viewProps:this.viewProps}),this.view=new ia(y,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:S.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const la=Ue("colsw");class Pl{constructor(y,S){this.onValueChange_=this.onValueChange_.bind(this),S.value.emitter.on("change",this.onValueChange_),this.value=S.value,this.element=y.createElement("div"),this.element.classList.add(la()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(la("sw")),this.element.appendChild(U),this.swatchElem_=U;const Y=y.createElement("button");Y.classList.add(la("b")),S.viewProps.bindDisabled(Y),this.element.appendChild(Y),this.buttonElement=Y,this.update_()}update_(){const y=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ud(y)}onValueChange_(){this.update_()}}class ph{constructor(y,S){this.value=S.value,this.viewProps=S.viewProps,this.view=new Pl(y,{value:this.value,viewProps:this.viewProps})}}class Qs{constructor(y,S){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=S.value,this.viewProps=S.viewProps,this.foldable_=Ji.create(S.expanded),this.swatchC_=new ph(y,{value:this.value,viewProps:this.viewProps});const U=this.swatchC_.view.buttonElement;U.addEventListener("blur",this.onButtonBlur_),U.addEventListener("click",this.onButtonClick_),this.textC_=new au(y,{parser:S.parser,props:pe.fromObject({formatter:S.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new tf(y,{foldable:this.foldable_,pickerLayout:S.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=S.pickerLayout==="popup"?new rc(y,{viewProps:this.viewProps}):null;const Y=new cf(y,{colorType:S.colorType,supportsAlpha:S.supportsAlpha,value:this.value,viewProps:this.viewProps});Y.view.allFocusableElements.forEach(ye=>{ye.addEventListener("blur",this.onPopupChildBlur_),ye.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Y,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Y.view.element),Jn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:ye=>ye.rawValue,backward:(ye,xe)=>xe.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(y){if(!this.popC_)return;const S=this.view.element,U=y.relatedTarget;U&&S.contains(U)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(y){if(!this.popC_)return;const S=this.popC_.view.element,U=qr(y);U&&S.contains(U)||U&&U===this.swatchC_.view.buttonElement&&!Kt(S.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(y){this.popC_?y.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&y.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function nl(B){return La(B.getComponents("rgb")).reduce((y,S)=>y<<8|255&Math.floor(S),0)}function gu(B){return B.getComponents("rgb").reduce((y,S,U)=>y<<8|255&Math.floor(U===3?255*S:S),0)>>>0}function xo(B){return typeof B!="number"?Pi.black():new Pi([(y=B)>>16&255,y>>8&255,255&y],"rgb");var y}function vu(B){return typeof B!="number"?Pi.black():new Pi([(y=B)>>24&255,y>>16&255,y>>8&255,Cr(255&y,0,255,0,1)],"rgb");var y}function io(B){var y;return!(!(B!=null&&B.alpha)&&!(!((y=B==null?void 0:B.color)===null||y===void 0)&&y.alpha))}function si(B){return B?y=>Ud(y,"0x"):y=>fu(y,"0x")}const pc={id:"input-color-number",type:"input",accept:(B,y)=>{if(typeof B!="number"||!function(U){return"color"in U||"view"in U&&U.view==="color"}(y))return null;const S=nf(y);return S?{initialValue:B,params:S}:null},binding:{reader:B=>io(B.params)?vu:xo,equals:Pi.equals,writer:B=>function(y){const S=y?gu:nl;return(U,Y)=>{lc(U,S(Y))}}(io(B.params))},controller:B=>{const y=io(B.params),S="expanded"in B.params?B.params.expanded:void 0,U="picker"in B.params?B.params.picker:void 0;return new Qs(B.document,{colorType:"int",expanded:S!=null&&S,formatter:si(y),parser:ji("int"),pickerLayout:U??"popup",supportsAlpha:y,value:B.value,viewProps:B.viewProps})}};function zo(B){return y=>function(S,U){return Pi.isColorObject(S)?Pi.fromObject(S,U):Pi.black(U)}(y,B)}function Mm(B,y){return S=>B?Tl(S,y):fe(S,y)}const fh={id:"input-color-object",type:"input",accept:(B,y)=>{if(!Pi.isColorObject(B))return null;const S=nf(y);return S?{initialValue:B,params:S}:null},binding:{reader:B=>zo(bi(B.params)),equals:Pi.equals,writer:B=>{return U=B.initialValue,y=Pi.isRgbaColorObject(U),S=bi(B.params),(Y,ye)=>{y?function(xe,dt,Jt){const bn=dt.toRgbaObject(Jt);xe.writeProperty("r",bn.r),xe.writeProperty("g",bn.g),xe.writeProperty("b",bn.b),xe.writeProperty("a",bn.a)}(Y,ye,S):function(xe,dt,Jt){const bn=dt.toRgbaObject(Jt);xe.writeProperty("r",bn.r),xe.writeProperty("g",bn.g),xe.writeProperty("b",bn.b)}(Y,ye,S)};var y,S,U}},controller:B=>{var y;const S=Pi.isRgbaColorObject(B.initialValue),U="expanded"in B.params?B.params.expanded:void 0,Y="picker"in B.params?B.params.picker:void 0,ye=(y=bi(B.params))!==null&&y!==void 0?y:"int";return new Qs(B.document,{colorType:ye,expanded:U!=null&&U,formatter:Mm(S,ye),parser:ji(ye),pickerLayout:Y??"popup",supportsAlpha:S,value:B.value,viewProps:B.viewProps})}},Ua={id:"input-color-string",type:"input",accept:(B,y)=>{if(typeof B!="string"||"view"in y&&y.view==="text")return null;const S=of(B,bi(y));if(!S||!wo(S))return null;const U=nf(y);return U?{initialValue:B,params:U}:null},binding:{reader:B=>{var y;return function(S){const U=Or[S];return Y=>{if(typeof Y!="string")return Pi.black(S);const ye=U.reduce((xe,dt)=>xe||dt(Y),null);return ye??Pi.black(S)}}((y=bi(B.params))!==null&&y!==void 0?y:"int")},equals:Pi.equals,writer:B=>{const y=of(B.initialValue,bi(B.params));if(!y)throw Ie.shouldNeverHappen();const S=function(U){const Y=wo(U);return Y?(ye,xe)=>{lc(ye,Y(xe))}:null}(y);if(!S)throw Ie.notBindable();return S}},controller:B=>{const y=of(B.initialValue,bi(B.params));if(!y)throw Ie.shouldNeverHappen();const S=wo(y);if(!S)throw Ie.shouldNeverHappen();const U="expanded"in B.params?B.params.expanded:void 0,Y="picker"in B.params?B.params.picker:void 0;return new Qs(B.document,{colorType:y.type,expanded:U!=null&&U,formatter:S,parser:ji(y.type),pickerLayout:Y??"popup",supportsAlpha:y.alpha,value:B.value,viewProps:B.viewProps})}};class ca{constructor(y){this.components=y.components,this.asm_=y.assembly}constrain(y){const S=this.asm_.toComponents(y).map((U,Y)=>{var ye,xe;return(xe=(ye=this.components[Y])===null||ye===void 0?void 0:ye.constrain(U))!==null&&xe!==void 0?xe:U});return this.asm_.fromComponents(S)}}const Eo=Ue("pndtxt");class Rl{constructor(y,S){this.textViews=S.textViews,this.element=y.createElement("div"),this.element.classList.add(Eo()),this.textViews.forEach(U=>{const Y=y.createElement("div");Y.classList.add(Eo("a")),Y.appendChild(U.element),this.element.appendChild(Y)})}}class Nd{constructor(y,S){this.value=S.value,this.viewProps=S.viewProps,this.acs_=S.axes.map((U,Y)=>function(ye,xe,dt){return new Pd(ye,{arrayPosition:dt===0?"fst":dt===xe.axes.length-1?"lst":"mid",baseStep:xe.axes[dt].baseStep,parser:xe.parser,props:xe.axes[dt].textProps,value:ce(0,{constraint:xe.axes[dt].constraint}),viewProps:xe.viewProps})}(y,S,Y)),this.acs_.forEach((U,Y)=>{Jn({primary:this.value,secondary:U.value,forward:ye=>S.assembly.toComponents(ye.rawValue)[Y],backward:(ye,xe)=>{const dt=S.assembly.toComponents(ye.rawValue);return dt[Y]=xe.rawValue,S.assembly.fromComponents(dt)}})}),this.view=new Rl(y,{textViews:this.acs_.map(U=>U.view)})}}function _u(B,y){return"step"in B&&!st(B.step)?new is(B.step,y):null}function Dl(B){return st(B.max)||st(B.min)?st(B.max)&&st(B.min)?null:new xl({max:B.max,min:B.min}):new $o({max:B.max,min:B.min})}const Tm={id:"input-number",type:"input",accept:(B,y)=>{if(typeof B!="number")return null;const S=wt,U=_t(y,{format:S.optional.function,max:S.optional.number,min:S.optional.number,options:S.optional.custom(Rd),step:S.optional.number});return U?{initialValue:B,params:U}:null},binding:{reader:B=>Id,constraint:B=>function(y,S){const U=[],Y=_u(y,S);Y&&U.push(Y);const ye=Dl(y);ye&&U.push(ye);const xe=wm(y.options);return xe&&U.push(xe),new Fi(U)}(B.params,B.initialValue),writer:B=>lc},controller:B=>{var y;const S=B.value,U=B.constraint,Y=U&&Si(U,Ds);if(Y)return new Bc(B.document,{props:new pe({options:Y.values.value("options")}),value:S,viewProps:B.viewProps});const ye=(y="format"in B.params?B.params.format:void 0)!==null&&y!==void 0?y:bs(Dd(U,S.rawValue)),xe=U&&Si(U,$o);return xe?new ef(B.document,{baseStep:oh(U),parser:$a,sliderProps:new pe({maxValue:xe.values.value("max"),minValue:xe.values.value("min")}),textProps:pe.fromObject({draggingScale:ah(U,S.rawValue),formatter:ye}),value:S,viewProps:B.viewProps}):new Pd(B.document,{baseStep:oh(U),parser:$a,props:pe.fromObject({draggingScale:ah(U,S.rawValue),formatter:ye}),value:S,viewProps:B.viewProps})}};class So{constructor(y=0,S=0){this.x=y,this.y=S}getComponents(){return[this.x,this.y]}static isObject(y){if(st(y))return!1;const S=y.x,U=y.y;return typeof S=="number"&&typeof U=="number"}static equals(y,S){return y.x===S.x&&y.y===S.y}toObject(){return{x:this.x,y:this.y}}}const il={toComponents:B=>B.getComponents(),fromComponents:B=>new So(...B)},Co=Ue("p2d");class yu{constructor(y,S){this.element=y.createElement("div"),this.element.classList.add(Co()),S.viewProps.bindClassModifiers(this.element),Bt(S.expanded,Qe(this.element,Co(void 0,"expanded")));const U=y.createElement("div");U.classList.add(Co("h")),this.element.appendChild(U);const Y=y.createElement("button");Y.classList.add(Co("b")),Y.appendChild(In(y,"p2dpad")),S.viewProps.bindDisabled(Y),U.appendChild(Y),this.buttonElement=Y;const ye=y.createElement("div");if(ye.classList.add(Co("t")),U.appendChild(ye),this.textElement=ye,S.pickerLayout==="inline"){const xe=y.createElement("div");xe.classList.add(Co("p")),this.element.appendChild(xe),this.pickerElement=xe}else this.pickerElement=null}}const ua=Ue("p2dp");class mh{constructor(y,S){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=S.invertsY,this.maxValue_=S.maxValue,this.element=y.createElement("div"),this.element.classList.add(ua()),S.layout==="popup"&&this.element.classList.add(ua(void 0,"p")),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(ua("p")),S.viewProps.bindTabIndex(U),this.element.appendChild(U),this.padElement=U;const Y=y.createElementNS(Ne,"svg");Y.classList.add(ua("g")),this.padElement.appendChild(Y),this.svgElem_=Y;const ye=y.createElementNS(Ne,"line");ye.classList.add(ua("ax")),ye.setAttributeNS(null,"x1","0"),ye.setAttributeNS(null,"y1","50%"),ye.setAttributeNS(null,"x2","100%"),ye.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(ye);const xe=y.createElementNS(Ne,"line");xe.classList.add(ua("ax")),xe.setAttributeNS(null,"x1","50%"),xe.setAttributeNS(null,"y1","0"),xe.setAttributeNS(null,"x2","50%"),xe.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(xe);const dt=y.createElementNS(Ne,"line");dt.classList.add(ua("l")),dt.setAttributeNS(null,"x1","50%"),dt.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(dt),this.lineElem_=dt;const Jt=y.createElement("div");Jt.classList.add(ua("m")),this.padElement.appendChild(Jt),this.markerElem_=Jt,S.value.emitter.on("change",this.onValueChange_),this.value=S.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[y,S]=this.value.rawValue.getComponents(),U=this.maxValue_,Y=Cr(y,-U,+U,0,100),ye=Cr(S,-U,+U,0,100),xe=this.invertsY_?100-ye:ye;this.lineElem_.setAttributeNS(null,"x2",`${Y}%`),this.lineElem_.setAttributeNS(null,"y2",`${xe}%`),this.markerElem_.style.left=`${Y}%`,this.markerElem_.style.top=`${xe}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Au(B,y,S){return[fr(y[0],Wi(B)),fr(y[1],Lc(B))*(S?1:-1)]}class Im{constructor(y,S){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=S.value,this.viewProps=S.viewProps,this.baseSteps_=S.baseSteps,this.maxValue_=S.maxValue,this.invertsY_=S.invertsY,this.view=new mh(y,{invertsY:this.invertsY_,layout:S.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new uu(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(y,S){if(!y.point)return;const U=this.maxValue_,Y=Cr(y.point.x,0,y.bounds.width,-U,+U),ye=Cr(this.invertsY_?y.bounds.height-y.point.y:y.point.y,0,y.bounds.height,-U,+U);this.value.setRawValue(new So(Y,ye),S)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onPadKeyDown_(y){Dv(y.key)&&y.preventDefault();const[S,U]=Au(y,this.baseSteps_,this.invertsY_);S===0&&U===0||this.value.setRawValue(new So(this.value.rawValue.x+S,this.value.rawValue.y+U),{forceEmit:!1,last:!1})}onPadKeyUp_(y){const[S,U]=Au(y,this.baseSteps_,this.invertsY_);S===0&&U===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Pm{constructor(y,S){var U,Y;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=S.value,this.viewProps=S.viewProps,this.foldable_=Ji.create(S.expanded),this.popC_=S.pickerLayout==="popup"?new rc(y,{viewProps:this.viewProps}):null;const ye=new Im(y,{baseSteps:[S.axes[0].baseStep,S.axes[1].baseStep],invertsY:S.invertsY,layout:S.pickerLayout,maxValue:S.maxValue,value:this.value,viewProps:this.viewProps});ye.view.allFocusableElements.forEach(xe=>{xe.addEventListener("blur",this.onPopupChildBlur_),xe.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=ye,this.textC_=new Nd(y,{assembly:il,axes:S.axes,parser:S.parser,value:this.value,viewProps:this.viewProps}),this.view=new yu(y,{expanded:this.foldable_.value("expanded"),pickerLayout:S.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(U=this.view.buttonElement)===null||U===void 0||U.addEventListener("blur",this.onPadButtonBlur_),(Y=this.view.buttonElement)===null||Y===void 0||Y.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Jn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:xe=>xe.rawValue,backward:(xe,dt)=>dt.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gs(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(y){if(!this.popC_)return;const S=this.view.element,U=y.relatedTarget;U&&S.contains(U)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(y){if(!this.popC_)return;const S=this.popC_.view.element,U=qr(y);U&&S.contains(U)||U&&U===this.view.buttonElement&&!Kt(S.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(y){this.popC_?y.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&y.key==="Escape"&&this.view.buttonElement.focus()}}class jc{constructor(y=0,S=0,U=0){this.x=y,this.y=S,this.z=U}getComponents(){return[this.x,this.y,this.z]}static isObject(y){if(st(y))return!1;const S=y.x,U=y.y,Y=y.z;return typeof S=="number"&&typeof U=="number"&&typeof Y=="number"}static equals(y,S){return y.x===S.x&&y.y===S.y&&y.z===S.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Rm={toComponents:B=>B.getComponents(),fromComponents:B=>new jc(...B)};function fc(B){return jc.isObject(B)?new jc(B.x,B.y,B.z):new jc}function zi(B,y){B.writeProperty("x",y.x),B.writeProperty("y",y.y),B.writeProperty("z",y.z)}function Os(B,y){return{baseStep:oh(y),constraint:y,textProps:pe.fromObject({draggingScale:ah(y,B),formatter:bs(Dd(y,B))})}}const as={id:"input-point3d",type:"input",accept:(B,y)=>{if(!jc.isObject(B))return null;const S=wt,U=_t(y,{x:S.optional.custom(kc),y:S.optional.custom(kc),z:S.optional.custom(kc)});return U?{initialValue:B,params:U}:null},binding:{reader:B=>fc,constraint:B=>{return y=B.params,S=B.initialValue,new ca({assembly:Rm,components:[rr("x"in y?y.x:void 0,S.x),rr("y"in y?y.y:void 0,S.y),rr("z"in y?y.z:void 0,S.z)]});var y,S},equals:jc.equals,writer:B=>zi},controller:B=>{const y=B.value,S=B.constraint;if(!(S instanceof ca))throw Ie.shouldNeverHappen();return new Nd(B.document,{assembly:Rm,axes:[Os(y.rawValue.x,S.components[0]),Os(y.rawValue.y,S.components[1]),Os(y.rawValue.z,S.components[2])],parser:$a,value:y,viewProps:B.viewProps})}};class ha{constructor(y=0,S=0,U=0,Y=0){this.x=y,this.y=S,this.z=U,this.w=Y}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(y){if(st(y))return!1;const S=y.x,U=y.y,Y=y.z,ye=y.w;return typeof S=="number"&&typeof U=="number"&&typeof Y=="number"&&typeof ye=="number"}static equals(y,S){return y.x===S.x&&y.y===S.y&&y.z===S.z&&y.w===S.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Tr={toComponents:B=>B.getComponents(),fromComponents:B=>new ha(...B)};function mr(B){return ha.isObject(B)?new ha(B.x,B.y,B.z,B.w):new ha}function zc(B,y){B.writeProperty("x",y.x),B.writeProperty("y",y.y),B.writeProperty("z",y.z),B.writeProperty("w",y.w)}const Zi={id:"input-point4d",type:"input",accept:(B,y)=>{if(!ha.isObject(B))return null;const S=wt,U=_t(y,{x:S.optional.custom(kc),y:S.optional.custom(kc),z:S.optional.custom(kc),w:S.optional.custom(kc)});return U?{initialValue:B,params:U}:null},binding:{reader:B=>mr,constraint:B=>{return y=B.params,S=B.initialValue,new ca({assembly:Tr,components:[rr("x"in y?y.x:void 0,S.x),rr("y"in y?y.y:void 0,S.y),rr("z"in y?y.z:void 0,S.z),rr("w"in y?y.w:void 0,S.w)]});var y,S},equals:ha.equals,writer:B=>zc},controller:B=>{const y=B.value,S=B.constraint;if(!(S instanceof ca))throw Ie.shouldNeverHappen();return new Nd(B.document,{assembly:Tr,axes:y.rawValue.getComponents().map((U,Y)=>{return ye=U,{baseStep:oh(xe=S.components[Y]),constraint:xe,textProps:pe.fromObject({draggingScale:ah(xe,ye),formatter:bs(Dd(xe,ye))})};var ye,xe}),parser:$a,value:y,viewProps:B.viewProps})}},Fd={id:"input-string",type:"input",accept:(B,y)=>{if(typeof B!="string")return null;const S=_t(y,{options:wt.optional.custom(Rd)});return S?{initialValue:B,params:S}:null},binding:{reader:B=>$p,constraint:B=>function(y){const S=[],U=wm(y.options);return U&&S.push(U),new Fi(S)}(B.params),writer:B=>lc},controller:B=>{const y=B.document,S=B.value,U=B.constraint,Y=U&&Si(U,Ds);return Y?new Bc(y,{props:new pe({options:Y.values.value("options")}),value:S,viewProps:B.viewProps}):new au(y,{parser:ye=>ye,props:pe.fromObject({formatter:ta}),value:S,viewProps:B.viewProps})}},mc={monitor:{defaultInterval:200,defaultLineCount:3}},jd=Ue("mll");class gh{constructor(y,S){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=S.formatter,this.element=y.createElement("div"),this.element.classList.add(jd()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("textarea");U.classList.add(jd("i")),U.style.height=`calc(var(--bld-us) * ${S.lineCount})`,U.readOnly=!0,S.viewProps.bindDisabled(U),this.element.appendChild(U),this.textareaElem_=U,S.value.emitter.on("change",this.onValueUpdate_),this.value=S.value,this.update_()}update_(){const y=this.textareaElem_,S=y.scrollTop===y.scrollHeight-y.clientHeight,U=[];this.value.rawValue.forEach(Y=>{Y!==void 0&&U.push(this.formatter_(Y))}),y.textContent=U.join(`
`),S&&(y.scrollTop=y.scrollHeight)}onValueUpdate_(){this.update_()}}class Ls{constructor(y,S){this.value=S.value,this.viewProps=S.viewProps,this.view=new gh(y,{formatter:S.formatter,lineCount:S.lineCount,value:this.value,viewProps:this.viewProps})}}const Dm=Ue("sgl");class ks{constructor(y,S){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=S.formatter,this.element=y.createElement("div"),this.element.classList.add(Dm()),S.viewProps.bindClassModifiers(this.element);const U=y.createElement("input");U.classList.add(Dm("i")),U.readOnly=!0,U.type="text",S.viewProps.bindDisabled(U),this.element.appendChild(U),this.inputElement=U,S.value.emitter.on("change",this.onValueUpdate_),this.value=S.value,this.update_()}update_(){const y=this.value.rawValue,S=y[y.length-1];this.inputElement.value=S!==void 0?this.formatter_(S):""}onValueUpdate_(){this.update_()}}class da{constructor(y,S){this.value=S.value,this.viewProps=S.viewProps,this.view=new ks(y,{formatter:S.formatter,value:this.value,viewProps:this.viewProps})}}const Bm={id:"monitor-bool",type:"monitor",accept:(B,y)=>{if(typeof B!="boolean")return null;const S=_t(y,{lineCount:wt.optional.number});return S?{initialValue:B,params:S}:null},binding:{reader:B=>Kp},controller:B=>{var y;return B.value.rawValue.length===1?new da(B.document,{formatter:vo,value:B.value,viewProps:B.viewProps}):new Ls(B.document,{formatter:vo,lineCount:(y=B.params.lineCount)!==null&&y!==void 0?y:mc.monitor.defaultLineCount,value:B.value,viewProps:B.viewProps})}},Es=Ue("grl");class Vc{constructor(y,S){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=y.createElement("div"),this.element.classList.add(Es()),S.viewProps.bindClassModifiers(this.element),this.formatter_=S.formatter,this.props_=S.props,this.cursor_=S.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const U=y.createElementNS(Ne,"svg");U.classList.add(Es("g")),U.style.height=`calc(var(--bld-us) * ${S.lineCount})`,this.element.appendChild(U),this.svgElem_=U;const Y=y.createElementNS(Ne,"polyline");this.svgElem_.appendChild(Y),this.lineElem_=Y;const ye=y.createElement("div");ye.classList.add(Es("t"),Ue("tt")()),this.element.appendChild(ye),this.tooltipElem_=ye,S.value.emitter.on("change",this.onValueUpdate_),this.value=S.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const y=this.svgElem_.getBoundingClientRect(),S=this.value.rawValue.length-1,U=this.props_.get("minValue"),Y=this.props_.get("maxValue"),ye=[];this.value.rawValue.forEach((oi,yr)=>{if(oi===void 0)return;const Xr=Cr(yr,0,S,0,y.width),jr=Cr(oi,U,Y,y.height,0);ye.push([Xr,jr].join(","))}),this.lineElem_.setAttributeNS(null,"points",ye.join(" "));const xe=this.tooltipElem_,dt=this.value.rawValue[this.cursor_.rawValue];if(dt===void 0)return void xe.classList.remove(Es("t","a"));const Jt=Cr(this.cursor_.rawValue,0,S,0,y.width),bn=Cr(dt,U,Y,y.height,0);xe.style.left=`${Jt}px`,xe.style.top=`${bn}px`,xe.textContent=`${this.formatter_(dt)}`,xe.classList.contains(Es("t","a"))||(xe.classList.add(Es("t","a"),Es("t","in")),Vt(xe),xe.classList.remove(Es("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ro{constructor(y,S){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=S.props,this.value=S.value,this.viewProps=S.viewProps,this.cursor_=ce(-1),this.view=new Vc(y,{cursor:this.cursor_,formatter:S.formatter,lineCount:S.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),Kt(y)){const U=new uu(this.view.element);U.emitter.on("down",this.onGraphPointerDown_),U.emitter.on("move",this.onGraphPointerMove_),U.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(y){const S=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Cr(y.offsetX,0,S.width,0,this.value.rawValue.length))}onGraphPointerDown_(y){this.onGraphPointerMove_(y)}onGraphPointerMove_(y){y.data.point?this.cursor_.rawValue=Math.floor(Cr(y.data.point.x,0,y.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function xn(B){return"format"in B&&!st(B.format)?B.format:bs(2)}function Ss(B){return"view"in B&&B.view==="graph"}const pa={id:"monitor-number",type:"monitor",accept:(B,y)=>{if(typeof B!="number")return null;const S=wt,U=_t(y,{format:S.optional.function,lineCount:S.optional.number,max:S.optional.number,min:S.optional.number,view:S.optional.string});return U?{initialValue:B,params:U}:null},binding:{defaultBufferSize:B=>Ss(B)?64:1,reader:B=>Id},controller:B=>Ss(B.params)?function(y){var S,U,Y;return new ro(y.document,{formatter:xn(y.params),lineCount:(S=y.params.lineCount)!==null&&S!==void 0?S:mc.monitor.defaultLineCount,props:pe.fromObject({maxValue:(U="max"in y.params?y.params.max:null)!==null&&U!==void 0?U:100,minValue:(Y="min"in y.params?y.params.min:null)!==null&&Y!==void 0?Y:0}),value:y.value,viewProps:y.viewProps})}(B):function(y){var S;return y.value.rawValue.length===1?new da(y.document,{formatter:xn(y.params),value:y.value,viewProps:y.viewProps}):new Ls(y.document,{formatter:xn(y.params),lineCount:(S=y.params.lineCount)!==null&&S!==void 0?S:mc.monitor.defaultLineCount,value:y.value,viewProps:y.viewProps})}(B)},Na={id:"monitor-string",type:"monitor",accept:(B,y)=>{if(typeof B!="string")return null;const S=wt,U=_t(y,{lineCount:S.optional.number,multiline:S.optional.boolean});return U?{initialValue:B,params:U}:null},binding:{reader:B=>$p},controller:B=>{var y;const S=B.value;return S.rawValue.length>1||"multiline"in B.params&&B.params.multiline?new Ls(B.document,{formatter:ta,lineCount:(y=B.params.lineCount)!==null&&y!==void 0?y:mc.monitor.defaultLineCount,value:S,viewProps:B.viewProps}):new da(B.document,{formatter:ta,value:S,viewProps:B.viewProps})}};function kv(B,y){return y===0?new Hn:new su(B,y??mc.monitor.defaultInterval)}class Mo{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(y){y.type==="blade"?this.pluginsMap_.blades.unshift(y):y.type==="input"?this.pluginsMap_.inputs.unshift(y):y.type==="monitor"&&this.pluginsMap_.monitors.unshift(y)}createInput(y,S,U){if(st(S.read()))throw new Ie({context:{key:S.key},type:"nomatchingcontroller"});const Y=this.pluginsMap_.inputs.reduce((ye,xe)=>ye??function(dt,Jt){const bn=dt.accept(Jt.target.read(),Jt.params);if(st(bn))return null;const oi=wt,yr={target:Jt.target,initialValue:bn.initialValue,params:bn.params},Xr=dt.binding.reader(yr),jr=dt.binding.constraint?dt.binding.constraint(yr):void 0,ma=ce(Xr(bn.initialValue),{constraint:jr,equals:dt.binding.equals}),rl=new xd({reader:Xr,target:Jt.target,value:ma,writer:dt.binding.writer(yr)}),_h=oi.optional.boolean(Jt.params.disabled).value,mf=oi.optional.boolean(Jt.params.hidden).value,Vd=dt.controller({constraint:jr,document:Jt.document,initialValue:bn.initialValue,params:bn.params,value:rl.value,viewProps:Ft.create({disabled:_h,hidden:mf})}),Gd=oi.optional.string(Jt.params.label).value;return new _s(Jt.document,{binding:rl,blade:Ae(),props:pe.fromObject({label:Gd??Jt.target.key}),valueController:Vd})}(xe,{document:y,target:S,params:U}),null);if(Y)return Y;throw new Ie({context:{key:S.key},type:"nomatchingcontroller"})}createMonitor(y,S,U){const Y=this.pluginsMap_.monitors.reduce((ye,xe)=>ye??function(dt,Jt){var bn,oi,yr;const Xr=wt,jr=dt.accept(Jt.target.read(),Jt.params);if(st(jr))return null;const ma={target:Jt.target,initialValue:jr.initialValue,params:jr.params},rl=dt.binding.reader(ma),_h=(oi=(bn=Xr.optional.number(Jt.params.bufferSize).value)!==null&&bn!==void 0?bn:dt.binding.defaultBufferSize&&dt.binding.defaultBufferSize(jr.params))!==null&&oi!==void 0?oi:1,mf=Xr.optional.number(Jt.params.interval).value,Vd=new _m({reader:rl,target:Jt.target,ticker:kv(Jt.document,mf),value:Sd(_h)}),Gd=Xr.optional.boolean(Jt.params.disabled).value,yh=Xr.optional.boolean(Jt.params.hidden).value,Hd=dt.controller({document:Jt.document,params:jr.params,value:Vd.value,viewProps:Ft.create({disabled:Gd,hidden:yh})}),Us=(yr=Xr.optional.string(Jt.params.label).value)!==null&&yr!==void 0?yr:Jt.target.key;return new Jo(Jt.document,{binding:Vd,blade:Ae(),props:pe.fromObject({label:Us}),valueController:Hd})}(xe,{document:y,params:U,target:S}),null);if(Y)return Y;throw new Ie({context:{key:S.key},type:"nomatchingcontroller"})}createBlade(y,S){const U=this.pluginsMap_.blades.reduce((Y,ye)=>Y??function(xe,dt){const Jt=xe.accept(dt.params);if(!Jt)return null;const bn=wt.optional.boolean(dt.params.disabled).value,oi=wt.optional.boolean(dt.params.hidden).value;return xe.controller({blade:Ae(),document:dt.document,params:Object.assign(Object.assign({},Jt.params),{disabled:bn,hidden:oi}),viewProps:Ft.create({disabled:bn,hidden:oi})})}(ye,{document:y,params:S}),null);if(!U)throw new Ie({type:"nomatchingview",context:{params:S}});return U}createBladeApi(y){if(y instanceof _s)return new vs(y);if(y instanceof Jo)return new vr(y);if(y instanceof ys)return new _r(y,this);const S=this.pluginsMap_.blades.reduce((U,Y)=>U??Y.api({controller:y,pool:this}),null);if(!S)throw Ie.shouldNeverHappen();return S}}function Gc(B){return So.isObject(B)?new So(B.x,B.y):new So}function uf(B,y){B.writeProperty("x",y.x),B.writeProperty("y",y.y)}function rr(B,y){if(!B)return;const S=[],U=_u(B,y);U&&S.push(U);const Y=Dl(B);return Y&&S.push(Y),new Fi(S)}function vh(B,y){const[S,U]=B?function(ye){const xe=Si(ye,$o);if(xe)return[xe.values.get("min"),xe.values.get("max")];const dt=Si(ye,xl);return dt?[dt.minValue,dt.maxValue]:[void 0,void 0]}(B):[];if(!st(S)||!st(U))return Math.max(Math.abs(S??0),Math.abs(U??0));const Y=oh(B);return Math.max(10*Math.abs(Y),10*Math.abs(y))}function tr(B,y){const S=y instanceof ca?y.components[0]:void 0,U=y instanceof ca?y.components[1]:void 0,Y=vh(S,B.x),ye=vh(U,B.y);return Math.max(Y,ye)}function hf(B,y){return{baseStep:oh(y),constraint:y,textProps:pe.fromObject({draggingScale:ah(y,B),formatter:bs(Dd(y,B))})}}function I0(B){if(!("y"in B))return!1;const y=B.y;return!!y&&"inverted"in y&&!!y.inverted}const P0={id:"input-point2d",type:"input",accept:(B,y)=>{if(!So.isObject(B))return null;const S=wt,U=_t(y,{expanded:S.optional.boolean,picker:S.optional.custom(bm),x:S.optional.custom(kc),y:S.optional.object({inverted:S.optional.boolean,max:S.optional.number,min:S.optional.number,step:S.optional.number})});return U?{initialValue:B,params:U}:null},binding:{reader:B=>Gc,constraint:B=>{return y=B.params,S=B.initialValue,new ca({assembly:il,components:[rr("x"in y?y.x:void 0,S.x),rr("y"in y?y.y:void 0,S.y)]});var y,S},equals:So.equals,writer:B=>uf},controller:B=>{const y=B.document,S=B.value,U=B.constraint;if(!(U instanceof ca))throw Ie.shouldNeverHappen();const Y="expanded"in B.params?B.params.expanded:void 0,ye="picker"in B.params?B.params.picker:void 0;return new Pm(y,{axes:[hf(S.rawValue.x,U.components[0]),hf(S.rawValue.y,U.components[1])],expanded:Y!=null&&Y,invertsY:I0(B.params),maxValue:tr(S.rawValue,U),parser:$a,pickerLayout:ye??"popup",value:S,viewProps:B.viewProps})}};class df extends qe{constructor(y){super(y),this.emitter_=new ht,this.controller_.valueController.value.emitter.on("change",S=>{this.emitter_.emit("change",{event:new Ke(this,S.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get options(){return this.controller_.valueController.props.get("options")}set options(y){this.controller_.valueController.props.set("options",y)}get value(){return this.controller_.valueController.value.rawValue}set value(y){this.controller_.valueController.value.rawValue=y}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}}class bu extends qe{constructor(y){super(y),this.emitter_=new ht,this.controller_.valueController.value.emitter.on("change",S=>{this.emitter_.emit("change",{event:new Ke(this,S.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(y){this.controller_.valueController.sliderController.props.set("maxValue",y)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(y){this.controller_.valueController.sliderController.props.set("minValue",y)}get value(){return this.controller_.valueController.value.rawValue}set value(y){this.controller_.valueController.value.rawValue=y}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}}class Om extends qe{constructor(y){super(y),this.emitter_=new ht,this.controller_.valueController.value.emitter.on("change",S=>{this.emitter_.emit("change",{event:new Ke(this,S.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(y){this.controller_.valueController.props.set("formatter",y)}get value(){return this.controller_.valueController.value.rawValue}set value(y){this.controller_.valueController.value.rawValue=y}on(y,S){const U=S.bind(this);return this.emitter_.on(y,Y=>{U(Y.event)}),this}}const pf={id:"list",type:"blade",accept(B){const y=wt,S=_t(B,{options:y.required.custom(Rd),value:y.required.raw,view:y.required.constant("list"),label:y.optional.string});return S?{params:S}:null},controller(B){const y=new Ds(Lv(B.params.options)),S=ce(B.params.value,{constraint:y}),U=new Bc(B.document,{props:new pe({options:y.values.value("options")}),value:S,viewProps:B.viewProps});return new pr(B.document,{blade:B.blade,props:pe.fromObject({label:B.params.label}),valueController:U})},api(B){return B.controller instanceof pr&&B.controller.valueController instanceof Bc?new df(B.controller):null}};class ff extends nh{constructor(y,S){super(y,S)}get element(){return this.controller_.view.element}importPreset(y){(function(S,U){S.forEach(Y=>{const ye=U[Y.target.presetKey];ye!==void 0&&Y.writer(Y.target,Y.reader(ye))})})(this.controller_.rackController.rack.find(_s).map(S=>S.binding),y),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(_s).map(y=>y.binding.target).reduce((y,S)=>Object.assign(y,{[S.presetKey]:S.read()}),{})}refresh(){this.controller_.rackController.rack.find(_s).forEach(y=>{y.binding.read()}),this.controller_.rackController.rack.find(Jo).forEach(y=>{y.binding.read()})}}class Pn extends wl{constructor(y,S){super(y,{expanded:S.expanded,blade:S.blade,props:S.props,root:!0,viewProps:S.viewProps})}}const R0={id:"slider",type:"blade",accept(B){const y=wt,S=_t(B,{max:y.required.number,min:y.required.number,view:y.required.constant("slider"),format:y.optional.function,label:y.optional.string,value:y.optional.number});return S?{params:S}:null},controller(B){var y,S;const U=(y=B.params.value)!==null&&y!==void 0?y:0,Y=new $o({max:B.params.max,min:B.params.min}),ye=new ef(B.document,{baseStep:1,parser:$a,sliderProps:new pe({maxValue:Y.values.value("max"),minValue:Y.values.value("min")}),textProps:pe.fromObject({draggingScale:ah(void 0,U),formatter:(S=B.params.format)!==null&&S!==void 0?S:Cl}),value:ce(U,{constraint:Y}),viewProps:B.viewProps});return new pr(B.document,{blade:B.blade,props:pe.fromObject({label:B.params.label}),valueController:ye})},api(B){return B.controller instanceof pr&&B.controller.valueController instanceof ef?new bu(B.controller):null}},D0={id:"text",type:"blade",accept(B){const y=wt,S=_t(B,{parse:y.required.function,value:y.required.raw,view:y.required.constant("text"),format:y.optional.function,label:y.optional.string});return S?{params:S}:null},controller(B){var y;const S=new au(B.document,{parser:B.params.parse,props:pe.fromObject({formatter:(y=B.params.format)!==null&&y!==void 0?y:U=>String(U)}),value:ce(B.params.value),viewProps:B.viewProps});return new pr(B.document,{blade:B.blade,props:pe.fromObject({label:B.params.label}),valueController:S})},api(B){return B.controller instanceof pr&&B.controller.valueController instanceof au?new Om(B.controller):null}};function fa(B,y,S){if(B.querySelector(`style[data-tp-style=${y}]`))return;const U=B.createElement("style");U.dataset.tpStyle=y,U.textContent=S,B.head.appendChild(U)}const zd=new class{constructor(B){const[y,S]=B.split("-"),U=y.split(".");this.major=parseInt(U[0],10),this.minor=parseInt(U[1],10),this.patch=parseInt(U[2],10),this.prerelease=S??null}toString(){const B=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[B,this.prerelease].join("-"):B}}("3.1.6");p.BladeApi=qe,p.ButtonApi=Ce,p.FolderApi=nh,p.InputBindingApi=vs,p.ListApi=df,p.MonitorBindingApi=vr,p.Pane=class extends ff{constructor(B){var y,S;const U=B??{},Y=(y=U.document)!==null&&y!==void 0?y:fn(),ye=function(){const xe=new Mo;return[P0,as,Zi,Fd,Tm,Ua,fh,pc,Ml,Bm,Na,pa,Za,tc,Sr,Ba].forEach(dt=>{xe.register(dt)}),xe}();super(new Pn(Y,{expanded:U.expanded,blade:Ae(),props:pe.fromObject({title:U.title}),viewProps:Ft.create()}),ye),this.pool_=ye,this.containerElem_=(S=U.container)!==null&&S!==void 0?S:function(xe){const dt=xe.createElement("div");return dt.classList.add(Ue("dfw")()),xe.body&&xe.body.appendChild(dt),dt}(Y),this.containerElem_.appendChild(this.element),this.doc_=Y,this.usesDefaultWrapper_=!U.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Ie.alreadyDisposed();return this.doc_}dispose(){const B=this.containerElem_;if(!B)throw Ie.alreadyDisposed();if(this.usesDefaultWrapper_){const y=B.parentElement;y&&y.removeChild(B)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(B){("plugin"in B?[B.plugin]:"plugins"in B?B.plugins:[]).forEach(y=>{this.pool_.register(y),this.embedPluginStyle_(y)})}embedPluginStyle_(B){B.css&&fa(this.document,`plugin-${B.id}`,B.css)}setUpDefaultPlugins_(){fa(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(B=>{this.embedPluginStyle_(B)}),this.registerPlugin({plugins:[R0,pf,Ba,D0]})}},p.SeparatorApi=wd,p.SliderApi=bu,p.TabApi=Ai,p.TabPageApi=Uo,p.TextApi=Om,p.TpChangeEvent=Ke,p.VERSION=zd,Object.defineProperty(p,"__esModule",{value:!0})})(V)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(St){super(St),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}transform(St,V){return St?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(St,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(St=!0,V=!1){return St&&super.preload(),V&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var St;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(St=eval(jsContent+`
DracoEncoderModule;`))==null?void 0:St()}),this.encoderPending}async initDecoder(){var St;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async V=>V.text()).then(V=>{const p=V.indexOf("/* worker */");if(p<1)throw new Error("unable to load decoder module");return V.substring(0,p-1)});return(St=eval(jsContent+`
DracoDecoderModule;`))==null?void 0:St()}async _loadLibrary(St,V){return DRACOLoader2.LibraryValueMap[St]?DRACOLoader2.LibraryValueMap[St]:DRACOLoader2.LibraryValueMap[St]=await super._loadLibrary(St,V)}static SetDecoderJsString(St){this.LibraryValueMap["draco_decoder.js"]=St}}DRACOLoader2.LibraryValueMap={}},988:function(St,V,p){p.d(V,{$TI:function(){return Gy},$V:function(){return Lg},$Vf:function(){return D_},$YQ:function(){return va},A5E:function(){return uf},AXT:function(){return hg},Aip:function(){return qf},B02:function(){return st},BFQ:function(){return Ba},BG$:function(){return rs},BKK:function(){return Vl},BVF:function(){return Fe},BVQ:function(){return mg},BbS:function(){return Dg},Bf4:function(){return gs},BtG:function(){return gc},CJI:function(){return Ls},CP7:function(){return Ha},CaW:function(){return Xp},CdI:function(){return dr},Cne:function(){return Ow},CtA:function(){return Zo},CtF:function(){return Nl},D1R:function(){return bl},D9w:function(){return Ai},DT1:function(){return Zy},Djp:function(){return Sn},DqL:function(){return sE},DvJ:function(){return wu},E2K:function(){return sh},EB7:function(){return ap},EJi:function(){return Lu},EoG:function(){return qr},F5T:function(){return ks},FDw:function(){return Wp},FE5:function(){return Ac},FIo:function(){return rw},FM8:function(){return Ht},FT0:function(){return by},FUD:function(){return ou},FvO:function(){return Wy},GG6:function(){return rc},GQ:function(){return mE},GUF:function(){return fr},GVz:function(){return Ud},GZb:function(){return zl},G_r:function(){return Wi},Gih:function(){return Fr},Gql:function(){return Uu},H$k:function(){return Du},HTd:function(){return th},HW6:function(){return B_},HdW:function(){return En},HgB:function(){return Dd},HkE:function(){return Ll},Hmr:function(){return Dy},Hw6:function(){return Nc},Hy8:function(){return $e},Hyl:function(){return cl},IEO:function(){return Ph},IFH:function(){return Hs},IKL:function(){return Yc},ILR:function(){return su},IOt:function(){return No},Ilk:function(){return xn},Ir4:function(){return wm},JOQ:function(){return bh},JQ4:function(){return wl},JUT:function(){return af},JWc:function(){return kc},KI_:function(){return Jn},Kgo:function(){return Of},KhW:function(){return je},Kj0:function(){return Us},Kz5:function(){return Rv},L5g:function(){return eA},L5s:function(){return mp},LBq:function(){return Qy},LSk:function(){return Uc},LY2:function(){return Ko},L_r:function(){return Bd},Lcc:function(){return tA},LgZ:function(){return _t},LsT:function(){return ih},Ltg:function(){return ji},Lun:function(){return $0},M5h:function(){return Qe},M6v:function(){return ri},M8C:function(){return nf},Mig:function(){return x_},MyG:function(){return S0},N$j:function(){return ig},N4l:function(){return Be},NDo:function(){return qi},NMF:function(){return Oc},NYV:function(){return Bc},Ns1:function(){return In},NwF:function(){return Gh},Ny0:function(){return ag},O7d:function(){return Ns},OAl:function(){return M0},OM3:function(){return R0},OTo:function(){return rh},OdW:function(){return rp},OoA:function(){return _s},Ox3:function(){return w_},PA7:function(){return $p},PMe:function(){return b_},Pa4:function(){return fe},PeU:function(){return He},Pnf:function(){return oc},PpQ:function(){return sf},QM0:function(){return Lv},QRU:function(){return aE},QZ1:function(){return bm},QmN:function(){return Ke},Qpg:function(){return dE},R2R:function(){return Vh},REq:function(){return _p},RNb:function(){return hf},ROQ:function(){return Jb},RSm:function(){return y_},Rki:function(){return fE},RlZ:function(){return Ft},RsA:function(){return Je},RvT:function(){return Am},S2y:function(){return Xe},S3k:function(){return Tg},S9g:function(){return Dl},SJI:function(){return Rg},SPe:function(){return o_},SUY:function(){return gw},Se2:function(){return se},Sm8:function(){return te},So8:function(){return mw},SvJ:function(){return Kp},Syv:function(){return El},T95:function(){return qp},TOt:function(){return kf},TUj:function(){return xw},TUv:function(){return ry},T_1:function(){return Yy},T_J:function(){return Ov},T__:function(){return Zb},T_f:function(){return Ec},TlE:function(){return tr},Tme:function(){return zi},Tn7:function(){return Eg},TyD:function(){return vr},U7:function(){return dy},USm:function(){return _u},UY4:function(){return Pf},UZH:function(){return qe},Uk6:function(){return Ou},UlW:function(){return Td},Uol:function(){return Pu},V1s:function(){return Lm},V4E:function(){return yp},VLJ:function(){return Ni},VYz:function(){return _w},Vdb:function(){return Tt},Vj0:function(){return ga},Vkp:function(){return bi},VzW:function(){return tc},W2J:function(){return lc},WMw:function(){return Bt},WTc:function(){return I0},WXh:function(){return Bu},Wbm:function(){return ae},WdD:function(){return hi},Wid:function(){return hp},Wjw:function(){return Wa},Wl3:function(){return et},Wpd:function(){return Ct},Wqd:function(){return fy},WwZ:function(){return Sl},Wzm:function(){return nE},XZw:function(){return Xf},Xaj:function(){return Z},Xcj:function(){return cE},XvJ:function(){return Fh},Y8D:function(){return Gt},YBo:function(){return Ys},YGz:function(){return ar},YKA:function(){return Zp},YLQ:function(){return Jo},YN5:function(){return Bw},YT8:function(){return cp},Ywn:function(){return Cm},Z6B:function(){return ah},ZAu:function(){return lo},ZQ6:function(){return h_},ZRs:function(){return Cr},ZTh:function(){return ea},ZZA:function(){return rE},Z_g:function(){return u_},Zp0:function(){return Pg},Zr5:function(){return Me},ZzF:function(){return bo},Zzh:function(){return Ew},_12:function(){return qd},_3:function(){return Wf},_AM:function(){return xd},_C8:function(){return Cg},_Li:function(){return Ce},_MY:function(){return mt},_YM:function(){return dp},_YX:function(){return uE},_am:function(){return O0},_fP:function(){return Ao},_iA:function(){return bt},_kC:function(){return Hh},_lf:function(){return ac},_sL:function(){return cu},a$l:function(){return Pn},aCh:function(){return ta},aH4:function(){return Al},aLr:function(){return la},aNw:function(){return ul},aVm:function(){return df},ad5:function(){return Dv},anP:function(){return vc},aq0:function(){return us},av9:function(){return jn},b5g:function(){return To},bBp:function(){return Aw},bGH:function(){return $},b_z:function(){return Bf},bdR:function(){return At},blk:function(){return ly},bnF:function(){return kh},brP:function(){return As},bsb:function(){return vo},c8b:function(){return ce},cBI:function(){return pE},cBK:function(){return ow},cJO:function(){return Ru},cLu:function(){return pr},cPb:function(){return so},cRx:function(){return nc},cU9:function(){return Mg},ce8:function(){return uu},cek:function(){return Iy},cum:function(){return ef},dSO:function(){return Er},dUE:function(){return zf},dYG:function(){return xy},dZ3:function(){return Za},dd2:function(){return yo},dj0:function(){return Rd},dpR:function(){return My},dwk:function(){return Ie},e62:function(){return ff},eD:function(){return Vt},eMJ:function(){return Oa},eaV:function(){return Sd},ehD:function(){return ht},ejS:function(){return qc},ekQ:function(){return Si},epp:function(){return no},fHI:function(){return Lh},fO1:function(){return uy},fQA:function(){return Iw},fQK:function(){return ty},fSK:function(){return Dt},fY$:function(){return Ae},fto:function(){return _m},g8_:function(){return xi},gH0:function(){return Sc},gSk:function(){return Md},g_z:function(){return pg},ghN:function(){return pe},gi4:function(){return is},gti:function(){return p_},hEm:function(){return Uo},hH6:function(){return wc},iAb:function(){return ys},iDF:function(){return _a},iKG:function(){return jm},iLg:function(){return ku},iMs:function(){return bw},iUV:function(){return Ui},iWC:function(){return ct},iWj:function(){return km},i_9:function(){return By},iiP:function(){return au},irR:function(){return vm},j4z:function(){return T0},j87:function(){return Om},jAl:function(){return Ii},jFi:function(){return Ue},jZA:function(){return Ds},jfJ:function(){return Bv},jwo:function(){return ym},jyi:function(){return Hb},jyz:function(){return sl},k0A:function(){return wd},k74:function(){return wt},kB5:function(){return kl},kFz:function(){return lf},kaV:function(){return A_},knz:function(){return Cl},kqm:function(){return Ny},ksN:function(){return Kt},l0P:function(){return Fi},l8J:function(){return oh},lCJ:function(){return pf},lDi:function(){return Ry},lGU:function(){return Jp},lLk:function(){return Fl},lRF:function(){return Z0},lRj:function(){return Ra},lb7:function(){return sp},lfu:function(){return zh},lk7:function(){return Gf},m7l:function(){return bc},mSO:function(){return Br},mTL:function(){return fw},mXe:function(){return d_},m_w:function(){return Jy},mzJ:function(){return Og},nls:function(){return Xs},ntZ:function(){return at},ntt:function(){return Lc},nvb:function(){return Dw},o8S:function(){return xg},oAp:function(){return Fv},oa8:function(){return Ff},oqc:function(){return ws},p3g:function(){return fu},p7y:function(){return Oh},pBf:function(){return Ml},pIN:function(){return Cd},pKu:function(){return Yp},pQR:function(){return Xc},ptH:function(){return $o},qhX:function(){return Qi},qkB:function(){return cn},qlB:function(){return bu},qyh:function(){return nh},rAo:function(){return P0},rBU:function(){return mn},rDY:function(){return B0},rOj:function(){return Le},r_:function(){return J},rnI:function(){return Id},rpg:function(){return Di},s4_:function(){return uw},sYA:function(){return xc},tEQ:function(){return sw},tGC:function(){return Pw},tJx:function(){return gE},tUh:function(){return Jr},tf:function(){return Fy},tm_:function(){return ft},trn:function(){return Ky},u37:function(){return C_},u7G:function(){return E_},u9r:function(){return Y},uEv:function(){return lu},uL9:function(){return Ki},uWy:function(){return vs},uXU:function(){return Pd},ub3:function(){return Ze},ujx:function(){return $y},v3W:function(){return Hn},v9Y:function(){return _o},vBJ:function(){return pa},vCF:function(){return Ne},vCx:function(){return Ed},vZf:function(){return bd},vmT:function(){return aw},vpT:function(){return Ih},vuL:function(){return sc},vxC:function(){return Ji},w$m:function(){return fn},wJv:function(){return ns},wem:function(){return _r},wk1:function(){return Sr},woe:function(){return Rf},wuA:function(){return Da},x12:function(){return Dh},x5V:function(){return Bi},xEZ:function(){return Or},xG9:function(){return kg},xJs:function(){return ic},xWb:function(){return zy},xeV:function(){return Cu},xfE:function(){return gr},xo$:function(){return jf},xoR:function(){return jh},xsS:function(){return tp},y$t:function(){return fg},y2t:function(){return xl},y8_:function(){return Rw},yC1:function(){return pp},yGw:function(){return si},ybr:function(){return n_},yj7:function(){return dg},ylh:function(){return Hy},yo9:function(){return t_},yt0:function(){return C0},ywz:function(){return ec},yxD:function(){return jl},z$h:function(){return $a},z81:function(){return bs},z8B:function(){return Tf},zHn:function(){return io},zbs:function(){return Ey},zf8:function(){return up}});const qe="152",Je={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Ke={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},He=0,ft=1,Xe=2,st=3,mt=0,bt=1,at=2,Ie=3,et=0,Ce=1,ht=2,Ze=2,Ue=0,At=1,Bt=2,Be=3,Qe=4,Z=5,$=100,ae=101,Le=102,J=103,te=104,ce=200,pe=201,je=202,ct=203,wt=204,_t=205,Dt=206,$e=207,Tt=208,Ct=209,Ft=210,Fe=0,se=1,Me=2,Ne=3,Vt=4,Kt=5,fn=6,ri=7,In=0,Qi=1,qi=2,Ki=0,qr=1,dr=2,ar=3,Ko=4,Za=5,gr=300,Ae=301,Ji=302,Er=303,gs=304,xi=306,Di=1e3,vs=1001,_s=1002,vr=1003,Jo=1004,th=1004,Al=1005,bd=1005,_r=1006,nh=1007,Ra=1007,bl=1008,Wp=1008,ec=1009,qp=1010,ys=1011,ih=1012,Rv=1013,wl=1014,tc=1015,pr=1016,wd=1017,vm=1018,ns=1020,rh=1021,Sr=1023,Gt=1024,nc=1025,cn=1026,As=1027,Uo=1028,Ai=1029,jn=1030,Zo=1031,sh=1033,Da=33776,Ba=33777,Hn=33778,su=33779,xd=35840,Ed=35841,Sd=35842,Xp=35843,_m=36196,Fi=37492,Si=37496,$o=37808,Ds=37809,xl=37810,is=37811,Sn=37812,rs=37813,Bc=37814,ic=37815,Yp=37816,rc=37817,Fr=37818,ou=37819,au=37820,Kp=37821,vo=36492,En=36283,sc=36284,ea=36285,Jp=36286,Ii=2200,Zp=2201,lu=2202,El=2300,Oc=2301,Cd=2302,oc=2400,ac=2401,cu=2402,Hs=2500,Md=2501,Sl=0,Td=1,$a=2,Id=3e3,Cl=3001,bs=3200,Br=3201,No=0,$p=1,ta="",Jn="srgb",fr="srgb-linear",Lc="display-p3",Wi="rgbm-16",Dv=0,Bi=7680,uu=7681,Cr=7682,Bv=7683,ws=34055,Ov=34056,Oa=5386,S0=512,Pd=513,ym=514,C0=515,M0=516,Am=517,T0=518,ef=519,lc=35044,Rd=35048,bm=35040,kc=35045,Lv=35049,wm=35041,Dd=35046,oh=35050,ah=35042,_o="100",Uc="300 es",Bd=1035;class Ml{addEventListener(r,l){this._listeners===void 0&&(this._listeners={});const h=this._listeners;h[r]===void 0&&(h[r]=[]),h[r].indexOf(l)===-1&&h[r].push(l)}hasEventListener(r,l){if(this._listeners===void 0)return!1;const h=this._listeners;return h[r]!==void 0&&h[r].indexOf(l)!==-1}removeEventListener(r,l){if(this._listeners===void 0)return;const h=this._listeners[r];if(h!==void 0){const f=h.indexOf(l);f!==-1&&h.splice(f,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const l=this._listeners[r.type];if(l!==void 0){r.target=this;const h=l.slice(0);for(let f=0,v=h.length;f<v;f++)h[f].call(this,r);r.target=null}}}const Mr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let tf=1234567;const na=Math.PI/180,La=180/Math.PI;function ss(){const A=4294967295*Math.random()|0,r=4294967295*Math.random()|0,l=4294967295*Math.random()|0,h=4294967295*Math.random()|0;return(Mr[255&A]+Mr[A>>8&255]+Mr[A>>16&255]+Mr[A>>24&255]+"-"+Mr[255&r]+Mr[r>>8&255]+"-"+Mr[r>>16&15|64]+Mr[r>>24&255]+"-"+Mr[63&l|128]+Mr[l>>8&255]+"-"+Mr[l>>16&255]+Mr[l>>24&255]+Mr[255&h]+Mr[h>>8&255]+Mr[h>>16&255]+Mr[h>>24&255]).toLowerCase()}function $i(A,r,l){return Math.max(r,Math.min(l,A))}function lh(A,r){return(A%r+r)%r}function ch(A,r,l){return(1-l)*A+l*r}function hu(A){return(A&A-1)==0&&A!==0}function Pi(A){return Math.pow(2,Math.ceil(Math.log(A)/Math.LN2))}function cc(A){return Math.pow(2,Math.floor(Math.log(A)/Math.LN2))}function ia(A,r){switch(r.constructor){case Float32Array:return A;case Uint16Array:return A/65535;case Uint8Array:return A/255;case Int16Array:return Math.max(A/32767,-1);case Int8Array:return Math.max(A/127,-1);default:throw new Error("Invalid component type.")}}function Mi(A,r){switch(r.constructor){case Float32Array:return A;case Uint16Array:return Math.round(65535*A);case Uint8Array:return Math.round(255*A);case Int16Array:return Math.round(32767*A);case Int8Array:return Math.round(127*A);default:throw new Error("Invalid component type.")}}const nf={DEG2RAD:na,RAD2DEG:La,generateUUID:ss,clamp:$i,euclideanModulo:lh,mapLinear:function(A,r,l,h,f){return h+(A-r)*(f-h)/(l-r)},inverseLerp:function(A,r,l){return A!==r?(l-A)/(r-A):0},lerp:ch,damp:function(A,r,l,h){return ch(A,r,1-Math.exp(-l*h))},pingpong:function(A,r=1){return r-Math.abs(lh(A,2*r)-r)},smoothstep:function(A,r,l){return A<=r?0:A>=l?1:(A=(A-r)/(l-r))*A*(3-2*A)},smootherstep:function(A,r,l){return A<=r?0:A>=l?1:(A=(A-r)/(l-r))*A*A*(A*(6*A-15)+10)},randInt:function(A,r){return A+Math.floor(Math.random()*(r-A+1))},randFloat:function(A,r){return A+Math.random()*(r-A)},randFloatSpread:function(A){return A*(.5-Math.random())},seededRandom:function(A){A!==void 0&&(tf=A);let r=tf+=1831565813;return r=Math.imul(r^r>>>15,1|r),r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296},degToRad:function(A){return A*na},radToDeg:function(A){return A*La},isPowerOfTwo:hu,ceilPowerOfTwo:Pi,floorPowerOfTwo:cc,setQuaternionFromProperEuler:function(A,r,l,h,f){const v=Math.cos,b=Math.sin,E=v(l/2),D=b(l/2),P=v((r+h)/2),O=b((r+h)/2),F=v((r-h)/2),N=b((r-h)/2),z=v((h-r)/2),G=b((h-r)/2);switch(f){case"XYX":A.set(E*O,D*F,D*N,E*P);break;case"YZY":A.set(D*N,E*O,D*F,E*P);break;case"ZXZ":A.set(D*F,D*N,E*O,E*P);break;case"XZX":A.set(E*O,D*G,D*z,E*P);break;case"YXY":A.set(D*z,E*O,D*G,E*P);break;case"ZYZ":A.set(D*G,D*z,E*O,E*P);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+f)}},normalize:Mi,denormalize:ia};class Ht{constructor(r=0,l=0){Ht.prototype.isVector2=!0,this.x=r,this.y=l}get width(){return this.x}set width(r){this.x=r}get height(){return this.y}set height(r){this.y=r}set(r,l){return this.x=r,this.y=l,this}setScalar(r){return this.x=r,this.y=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setComponent(r,l){switch(r){case 0:this.x=l;break;case 1:this.y=l;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y)}copy(r){return this.x=r.x,this.y=r.y,this}add(r){return this.x+=r.x,this.y+=r.y,this}addScalar(r){return this.x+=r,this.y+=r,this}addVectors(r,l){return this.x=r.x+l.x,this.y=r.y+l.y,this}addScaledVector(r,l){return this.x+=r.x*l,this.y+=r.y*l,this}sub(r){return this.x-=r.x,this.y-=r.y,this}subScalar(r){return this.x-=r,this.y-=r,this}subVectors(r,l){return this.x=r.x-l.x,this.y=r.y-l.y,this}multiply(r){return this.x*=r.x,this.y*=r.y,this}multiplyScalar(r){return this.x*=r,this.y*=r,this}divide(r){return this.x/=r.x,this.y/=r.y,this}divideScalar(r){return this.multiplyScalar(1/r)}applyMatrix3(r){const l=this.x,h=this.y,f=r.elements;return this.x=f[0]*l+f[3]*h+f[6],this.y=f[1]*l+f[4]*h+f[7],this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this}clamp(r,l){return this.x=Math.max(r.x,Math.min(l.x,this.x)),this.y=Math.max(r.y,Math.min(l.y,this.y)),this}clampScalar(r,l){return this.x=Math.max(r,Math.min(l,this.x)),this.y=Math.max(r,Math.min(l,this.y)),this}clampLength(r,l){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(r,Math.min(l,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(r){return this.x*r.x+this.y*r.y}cross(r){return this.x*r.y-this.y*r.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(r){const l=Math.sqrt(this.lengthSq()*r.lengthSq());if(l===0)return Math.PI/2;const h=this.dot(r)/l;return Math.acos($i(h,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const l=this.x-r.x,h=this.y-r.y;return l*l+h*h}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,l){return this.x+=(r.x-this.x)*l,this.y+=(r.y-this.y)*l,this}lerpVectors(r,l,h){return this.x=r.x+(l.x-r.x)*h,this.y=r.y+(l.y-r.y)*h,this}equals(r){return r.x===this.x&&r.y===this.y}fromArray(r,l=0){return this.x=r[l],this.y=r[l+1],this}toArray(r=[],l=0){return r[l]=this.x,r[l+1]=this.y,r}fromBufferAttribute(r,l){return this.x=r.getX(l),this.y=r.getY(l),this}rotateAround(r,l){const h=Math.cos(l),f=Math.sin(l),v=this.x-r.x,b=this.y-r.y;return this.x=v*h-b*f+r.x,this.y=v*f+b*h+r.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class bi{constructor(){bi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(r,l,h,f,v,b,E,D,P){const O=this.elements;return O[0]=r,O[1]=f,O[2]=E,O[3]=l,O[4]=v,O[5]=D,O[6]=h,O[7]=b,O[8]=P,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const l=this.elements,h=r.elements;return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=h[6],l[7]=h[7],l[8]=h[8],this}extractBasis(r,l,h){return r.setFromMatrix3Column(this,0),l.setFromMatrix3Column(this,1),h.setFromMatrix3Column(this,2),this}setFromMatrix4(r){const l=r.elements;return this.set(l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]),this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,l){const h=r.elements,f=l.elements,v=this.elements,b=h[0],E=h[3],D=h[6],P=h[1],O=h[4],F=h[7],N=h[2],z=h[5],G=h[8],W=f[0],Q=f[3],q=f[6],K=f[1],ne=f[4],be=f[7],ve=f[2],me=f[5],Pe=f[8];return v[0]=b*W+E*K+D*ve,v[3]=b*Q+E*ne+D*me,v[6]=b*q+E*be+D*Pe,v[1]=P*W+O*K+F*ve,v[4]=P*Q+O*ne+F*me,v[7]=P*q+O*be+F*Pe,v[2]=N*W+z*K+G*ve,v[5]=N*Q+z*ne+G*me,v[8]=N*q+z*be+G*Pe,this}multiplyScalar(r){const l=this.elements;return l[0]*=r,l[3]*=r,l[6]*=r,l[1]*=r,l[4]*=r,l[7]*=r,l[2]*=r,l[5]*=r,l[8]*=r,this}determinant(){const r=this.elements,l=r[0],h=r[1],f=r[2],v=r[3],b=r[4],E=r[5],D=r[6],P=r[7],O=r[8];return l*b*O-l*E*P-h*v*O+h*E*D+f*v*P-f*b*D}invert(){const r=this.elements,l=r[0],h=r[1],f=r[2],v=r[3],b=r[4],E=r[5],D=r[6],P=r[7],O=r[8],F=O*b-E*P,N=E*D-O*v,z=P*v-b*D,G=l*F+h*N+f*z;if(G===0)return this.set(0,0,0,0,0,0,0,0,0);const W=1/G;return r[0]=F*W,r[1]=(f*P-O*h)*W,r[2]=(E*h-f*b)*W,r[3]=N*W,r[4]=(O*l-f*D)*W,r[5]=(f*v-E*l)*W,r[6]=z*W,r[7]=(h*D-P*l)*W,r[8]=(b*l-h*v)*W,this}transpose(){let r;const l=this.elements;return r=l[1],l[1]=l[3],l[3]=r,r=l[2],l[2]=l[6],l[6]=r,r=l[5],l[5]=l[7],l[7]=r,this}getNormalMatrix(r){return this.setFromMatrix4(r).invert().transpose()}transposeIntoArray(r){const l=this.elements;return r[0]=l[0],r[1]=l[3],r[2]=l[6],r[3]=l[1],r[4]=l[4],r[5]=l[7],r[6]=l[2],r[7]=l[5],r[8]=l[8],this}setUvTransform(r,l,h,f,v,b,E){const D=Math.cos(v),P=Math.sin(v);return this.set(h*D,h*P,-h*(D*b+P*E)+b+r,-f*P,f*D,-f*(-P*b+D*E)+E+l,0,0,1),this}scale(r,l){return this.premultiply(xs.makeScale(r,l)),this}rotate(r){return this.premultiply(xs.makeRotation(-r)),this}translate(r,l){return this.premultiply(xs.makeTranslation(r,l)),this}makeTranslation(r,l){return this.set(1,0,r,0,1,l,0,0,1),this}makeRotation(r){const l=Math.cos(r),h=Math.sin(r);return this.set(l,-h,0,h,l,0,0,0,1),this}makeScale(r,l){return this.set(r,0,0,0,l,0,0,0,1),this}equals(r){const l=this.elements,h=r.elements;for(let f=0;f<9;f++)if(l[f]!==h[f])return!1;return!0}fromArray(r,l=0){for(let h=0;h<9;h++)this.elements[h]=r[h+l];return this}toArray(r=[],l=0){const h=this.elements;return r[l]=h[0],r[l+1]=h[1],r[l+2]=h[2],r[l+3]=h[3],r[l+4]=h[4],r[l+5]=h[5],r[l+6]=h[6],r[l+7]=h[7],r[l+8]=h[8],r}clone(){return new this.constructor().fromArray(this.elements)}}const xs=new bi;function ra(A){for(let r=A.length-1;r>=0;--r)if(A[r]>=65535)return!0;return!1}const xm={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function sa(A,r){return new xm[A](r)}function ka(A){return document.createElementNS("http://www.w3.org/1999/xhtml",A)}const oa={};function uh(A){A in oa||(oa[A]=!0,console.warn(A))}function du(A){return A<.04045?.0773993808*A:Math.pow(.9478672986*A+.0521327014,2.4)}function rf(A){return A<.0031308?12.92*A:1.055*Math.pow(A,.41666)-.055}const Em=new bi().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Od=new bi().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Ld={[fr]:A=>A,[Jn]:A=>A.convertSRGBToLinear(),[Lc]:function(A){return A.convertSRGBToLinear().applyMatrix3(Od)}},kd={[fr]:A=>A,[Jn]:A=>A.convertLinearToSRGB(),[Lc]:function(A){return A.applyMatrix3(Em).convertLinearToSRGB()}},no={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(A){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!A},get workingColorSpace(){return fr},set workingColorSpace(A){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(A,r,l){if(this.enabled===!1||r===l||!r||!l)return A;const h=Ld[r],f=kd[l];if(h===void 0||f===void 0)throw new Error(`Unsupported color space conversion, "${r}" to "${l}".`);return f(h(A))},fromWorkingColorSpace:function(A,r){return this.convert(A,this.workingColorSpace,r)},toWorkingColorSpace:function(A,r){return this.convert(A,r,this.workingColorSpace)}};let pu;class sf{static getDataURL(r,l=!1){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let h;if(r instanceof HTMLCanvasElement)h=r;else{pu===void 0&&(pu=ka("canvas")),pu.width=r.width,pu.height=r.height;const f=pu.getContext("2d");r instanceof ImageData?f.putImageData(r,0,0):f.drawImage(r,0,0,r.width,r.height),h=pu}return!l&&(h.width>2048||h.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),h.toDataURL("image/jpeg",.6)):h.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const l=ka("canvas");l.width=r.width,l.height=r.height;const h=l.getContext("2d");h.drawImage(r,0,0,r.width,r.height);const f=h.getImageData(0,0,r.width,r.height),v=f.data;for(let b=0;b<v.length;b++)v[b]=255*du(v[b]/255);return h.putImageData(f,0,0),l}if(r.data){const l=r.data.slice(0);for(let h=0;h<l.length;h++)l instanceof Uint8Array||l instanceof Uint8ClampedArray?l[h]=Math.floor(255*du(l[h]/255)):l[h]=du(l[h]);return{data:l,width:r.width,height:r.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}}class Nc{constructor(r=null){this.isSource=!0,this.uuid=ss(),this.data=r,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const l=r===void 0||typeof r=="string";if(!l&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const h={uuid:this.uuid,url:""},f=this.data;if(f!==null){let v;if(Array.isArray(f)){v=[];for(let b=0,E=f.length;b<E;b++)f[b].isDataTexture?v.push(Sm(f[b].image)):v.push(Sm(f[b]))}else v=Sm(f);h.url=v}return l||(r.images[this.uuid]=h),h}}function Sm(A){if(typeof HTMLImageElement<"u"&&A instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&A instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&A instanceof ImageBitmap)return sf.getDataURL(A);if(A.data){let r=[];try{r=Array.from(A.data)}catch(l){l.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(l),r=A.data}return{data:r,width:A.width,height:A.height,type:A.data.constructor.name}}return A.url!==void 0?A.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let of=0;class Or extends Ml{constructor(r=Or.DEFAULT_IMAGE,l=Or.DEFAULT_MAPPING,h=vs,f=vs,v=_r,b=bl,E=Sr,D=ec,P=Or.DEFAULT_ANISOTROPY,O=ta){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:of++}),this.uuid=ss(),this.name="",this.source=new Nc(r),this.mipmaps=[],this.mapping=l,this.channel=0,this.wrapS=h,this.wrapT=f,this.magFilter=v,this.minFilter=b,this.anisotropy=P,this.format=E,this.internalFormat=null,this.type=D,this.offset=new Ht(0,0),this.repeat=new Ht(1,1),this.center=new Ht(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof O=="string"?this.colorSpace=O:(uh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=O===Cl?Jn:ta),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(r=null){this.source.data=r}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(r){return this.name=r.name,this.source=r.source,this.mipmaps=r.mipmaps.slice(0),this.mapping=r.mapping,this.channel=r.channel,this.wrapS=r.wrapS,this.wrapT=r.wrapT,this.magFilter=r.magFilter,this.minFilter=r.minFilter,this.anisotropy=r.anisotropy,this.format=r.format,this.internalFormat=r.internalFormat,this.type=r.type,this.offset.copy(r.offset),this.repeat.copy(r.repeat),this.center.copy(r.center),this.rotation=r.rotation,this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrix.copy(r.matrix),this.generateMipmaps=r.generateMipmaps,this.premultiplyAlpha=r.premultiplyAlpha,this.flipY=r.flipY,this.unpackAlignment=r.unpackAlignment,this.colorSpace=r.colorSpace,this.userData=JSON.parse(JSON.stringify(r.userData)),this.needsUpdate=!0,this}toJSON(r){const l=r===void 0||typeof r=="string";if(!l&&r.textures&&r.textures[this.uuid]!==void 0)return r.textures[this.uuid];const h={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(r).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Jn?Cl:Id,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(h.userData=this.userData),l||(r.textures[this.uuid]=h),h}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(r){if(this.mapping!==gr)return r;if(r.applyMatrix3(this.matrix),r.x<0||r.x>1)switch(this.wrapS){case Di:r.x=r.x-Math.floor(r.x);break;case vs:r.x=r.x<0?0:1;break;case _s:Math.abs(Math.floor(r.x)%2)===1?r.x=Math.ceil(r.x)-r.x:r.x=r.x-Math.floor(r.x)}if(r.y<0||r.y>1)switch(this.wrapT){case Di:r.y=r.y-Math.floor(r.y);break;case vs:r.y=r.y<0?0:1;break;case _s:Math.abs(Math.floor(r.y)%2)===1?r.y=Math.ceil(r.y)-r.y:r.y=r.y-Math.floor(r.y)}return this.flipY&&(r.y=1-r.y),r}set needsUpdate(r){r===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return uh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Jn?Cl:Id}set encoding(r){uh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=r===Cl?Jn:ta}}Or.DEFAULT_IMAGE=null,Or.DEFAULT_MAPPING=gr,Or.DEFAULT_ANISOTROPY=1;class ji{constructor(r=0,l=0,h=0,f=1){ji.prototype.isVector4=!0,this.x=r,this.y=l,this.z=h,this.w=f}get width(){return this.z}set width(r){this.z=r}get height(){return this.w}set height(r){this.w=r}set(r,l,h,f){return this.x=r,this.y=l,this.z=h,this.w=f,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this.w=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setW(r){return this.w=r,this}setComponent(r,l){switch(r){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;case 3:this.w=l;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w!==void 0?r.w:1,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this.w+=r,this}addVectors(r,l){return this.x=r.x+l.x,this.y=r.y+l.y,this.z=r.z+l.z,this.w=r.w+l.w,this}addScaledVector(r,l){return this.x+=r.x*l,this.y+=r.y*l,this.z+=r.z*l,this.w+=r.w*l,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this.w-=r,this}subVectors(r,l){return this.x=r.x-l.x,this.y=r.y-l.y,this.z=r.z-l.z,this.w=r.w-l.w,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this.w*=r.w,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this}applyMatrix4(r){const l=this.x,h=this.y,f=this.z,v=this.w,b=r.elements;return this.x=b[0]*l+b[4]*h+b[8]*f+b[12]*v,this.y=b[1]*l+b[5]*h+b[9]*f+b[13]*v,this.z=b[2]*l+b[6]*h+b[10]*f+b[14]*v,this.w=b[3]*l+b[7]*h+b[11]*f+b[15]*v,this}divideScalar(r){return this.multiplyScalar(1/r)}setAxisAngleFromQuaternion(r){this.w=2*Math.acos(r.w);const l=Math.sqrt(1-r.w*r.w);return l<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=r.x/l,this.y=r.y/l,this.z=r.z/l),this}setAxisAngleFromRotationMatrix(r){let l,h,f,v;const D=r.elements,P=D[0],O=D[4],F=D[8],N=D[1],z=D[5],G=D[9],W=D[2],Q=D[6],q=D[10];if(Math.abs(O-N)<.01&&Math.abs(F-W)<.01&&Math.abs(G-Q)<.01){if(Math.abs(O+N)<.1&&Math.abs(F+W)<.1&&Math.abs(G+Q)<.1&&Math.abs(P+z+q-3)<.1)return this.set(1,0,0,0),this;l=Math.PI;const ne=(P+1)/2,be=(z+1)/2,ve=(q+1)/2,me=(O+N)/4,Pe=(F+W)/4,tt=(G+Q)/4;return ne>be&&ne>ve?ne<.01?(h=0,f=.707106781,v=.707106781):(h=Math.sqrt(ne),f=me/h,v=Pe/h):be>ve?be<.01?(h=.707106781,f=0,v=.707106781):(f=Math.sqrt(be),h=me/f,v=tt/f):ve<.01?(h=.707106781,f=.707106781,v=0):(v=Math.sqrt(ve),h=Pe/v,f=tt/v),this.set(h,f,v,l),this}let K=Math.sqrt((Q-G)*(Q-G)+(F-W)*(F-W)+(N-O)*(N-O));return Math.abs(K)<.001&&(K=1),this.x=(Q-G)/K,this.y=(F-W)/K,this.z=(N-O)/K,this.w=Math.acos((P+z+q-1)/2),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this.w=Math.min(this.w,r.w),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this.w=Math.max(this.w,r.w),this}clamp(r,l){return this.x=Math.max(r.x,Math.min(l.x,this.x)),this.y=Math.max(r.y,Math.min(l.y,this.y)),this.z=Math.max(r.z,Math.min(l.z,this.z)),this.w=Math.max(r.w,Math.min(l.w,this.w)),this}clampScalar(r,l){return this.x=Math.max(r,Math.min(l,this.x)),this.y=Math.max(r,Math.min(l,this.y)),this.z=Math.max(r,Math.min(l,this.z)),this.w=Math.max(r,Math.min(l,this.w)),this}clampLength(r,l){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(r,Math.min(l,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z+this.w*r.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,l){return this.x+=(r.x-this.x)*l,this.y+=(r.y-this.y)*l,this.z+=(r.z-this.z)*l,this.w+=(r.w-this.w)*l,this}lerpVectors(r,l,h){return this.x=r.x+(l.x-r.x)*h,this.y=r.y+(l.y-r.y)*h,this.z=r.z+(l.z-r.z)*h,this.w=r.w+(l.w-r.w)*h,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z&&r.w===this.w}fromArray(r,l=0){return this.x=r[l],this.y=r[l+1],this.z=r[l+2],this.w=r[l+3],this}toArray(r=[],l=0){return r[l]=this.x,r[l+1]=this.y,r[l+2]=this.z,r[l+3]=this.w,r}fromBufferAttribute(r,l){return this.x=r.getX(l),this.y=r.getY(l),this.z=r.getZ(l),this.w=r.getW(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class yo extends Ml{constructor(r=1,l=1,h={}){super(),this.isWebGLRenderTarget=!0,this.width=r,this.height=l,this.depth=1,this.scissor=new ji(0,0,r,l),this.scissorTest=!1,this.viewport=new ji(0,0,r,l);const f={width:r,height:l,depth:1};h.encoding!==void 0&&(uh("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),h.colorSpace=h.encoding===Cl?Jn:ta),this.texture=new Or(f,h.mapping,h.wrapS,h.wrapT,h.magFilter,h.minFilter,h.format,h.type,h.anisotropy,h.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=h.generateMipmaps!==void 0&&h.generateMipmaps,this.texture.internalFormat=h.internalFormat!==void 0?h.internalFormat:null,this.texture.minFilter=h.minFilter!==void 0?h.minFilter:_r,this.depthBuffer=h.depthBuffer===void 0||h.depthBuffer,this.stencilBuffer=h.stencilBuffer!==void 0&&h.stencilBuffer,this.depthTexture=h.depthTexture!==void 0?h.depthTexture:null,this.samples=h.samples!==void 0?h.samples:0}setSize(r,l,h=1){this.width===r&&this.height===l&&this.depth===h||(this.width=r,this.height=l,this.depth=h,this.texture.image.width=r,this.texture.image.height=l,this.texture.image.depth=h,this.dispose()),this.viewport.set(0,0,r,l),this.scissor.set(0,0,r,l)}clone(){return new this.constructor().copy(this)}copy(r){this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.texture=r.texture.clone(),this.texture.isRenderTargetTexture=!0;const l=Object.assign({},r.texture.image);return this.texture.source=new Nc(l),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fu extends Or{constructor(r=null,l=1,h=1,f=1){super(null),this.isDataArrayTexture=!0,this.image={data:r,width:l,height:h,depth:f},this.magFilter=vr,this.minFilter=vr,this.wrapR=vs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ud extends yo{constructor(r=1,l=1,h=1){super(r,l),this.isWebGLArrayRenderTarget=!0,this.depth=h,this.texture=new fu(null,r,l,h),this.texture.isRenderTargetTexture=!0}}class af extends Or{constructor(r=null,l=1,h=1,f=1){super(null),this.isData3DTexture=!0,this.image={data:r,width:l,height:h,depth:f},this.magFilter=vr,this.minFilter=vr,this.wrapR=vs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Cm extends yo{constructor(r=1,l=1,h=1){super(r,l),this.isWebGL3DRenderTarget=!0,this.depth=h,this.texture=new af(null,r,l,h),this.texture.isRenderTargetTexture=!0}}class lf extends yo{constructor(r=1,l=1,h=1,f={}){super(r,l,f),this.isWebGLMultipleRenderTargets=!0;const v=this.texture;this.texture=[];for(let b=0;b<h;b++)this.texture[b]=v.clone(),this.texture[b].isRenderTargetTexture=!0}setSize(r,l,h=1){if(this.width!==r||this.height!==l||this.depth!==h){this.width=r,this.height=l,this.depth=h;for(let f=0,v=this.texture.length;f<v;f++)this.texture[f].image.width=r,this.texture[f].image.height=l,this.texture[f].image.depth=h;this.dispose()}return this.viewport.set(0,0,r,l),this.scissor.set(0,0,r,l),this}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.texture.length=0;for(let l=0,h=r.texture.length;l<h;l++)this.texture[l]=r.texture[l].clone(),this.texture[l].isRenderTargetTexture=!0;return this}}class Ao{constructor(r=0,l=0,h=0,f=1){this.isQuaternion=!0,this._x=r,this._y=l,this._z=h,this._w=f}static slerpFlat(r,l,h,f,v,b,E){let D=h[f+0],P=h[f+1],O=h[f+2],F=h[f+3];const N=v[b+0],z=v[b+1],G=v[b+2],W=v[b+3];if(E===0)return r[l+0]=D,r[l+1]=P,r[l+2]=O,void(r[l+3]=F);if(E===1)return r[l+0]=N,r[l+1]=z,r[l+2]=G,void(r[l+3]=W);if(F!==W||D!==N||P!==z||O!==G){let Q=1-E;const q=D*N+P*z+O*G+F*W,K=q>=0?1:-1,ne=1-q*q;if(ne>Number.EPSILON){const ve=Math.sqrt(ne),me=Math.atan2(ve,q*K);Q=Math.sin(Q*me)/ve,E=Math.sin(E*me)/ve}const be=E*K;if(D=D*Q+N*be,P=P*Q+z*be,O=O*Q+G*be,F=F*Q+W*be,Q===1-E){const ve=1/Math.sqrt(D*D+P*P+O*O+F*F);D*=ve,P*=ve,O*=ve,F*=ve}}r[l]=D,r[l+1]=P,r[l+2]=O,r[l+3]=F}static multiplyQuaternionsFlat(r,l,h,f,v,b){const E=h[f],D=h[f+1],P=h[f+2],O=h[f+3],F=v[b],N=v[b+1],z=v[b+2],G=v[b+3];return r[l]=E*G+O*F+D*z-P*N,r[l+1]=D*G+O*N+P*F-E*z,r[l+2]=P*G+O*z+E*N-D*F,r[l+3]=O*G-E*F-D*N-P*z,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,l,h,f){return this._x=r,this._y=l,this._z=h,this._w=f,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,l){const h=r._x,f=r._y,v=r._z,b=r._order,E=Math.cos,D=Math.sin,P=E(h/2),O=E(f/2),F=E(v/2),N=D(h/2),z=D(f/2),G=D(v/2);switch(b){case"XYZ":this._x=N*O*F+P*z*G,this._y=P*z*F-N*O*G,this._z=P*O*G+N*z*F,this._w=P*O*F-N*z*G;break;case"YXZ":this._x=N*O*F+P*z*G,this._y=P*z*F-N*O*G,this._z=P*O*G-N*z*F,this._w=P*O*F+N*z*G;break;case"ZXY":this._x=N*O*F-P*z*G,this._y=P*z*F+N*O*G,this._z=P*O*G+N*z*F,this._w=P*O*F-N*z*G;break;case"ZYX":this._x=N*O*F-P*z*G,this._y=P*z*F+N*O*G,this._z=P*O*G-N*z*F,this._w=P*O*F+N*z*G;break;case"YZX":this._x=N*O*F+P*z*G,this._y=P*z*F+N*O*G,this._z=P*O*G-N*z*F,this._w=P*O*F-N*z*G;break;case"XZY":this._x=N*O*F-P*z*G,this._y=P*z*F-N*O*G,this._z=P*O*G+N*z*F,this._w=P*O*F+N*z*G;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+b)}return l!==!1&&this._onChangeCallback(),this}setFromAxisAngle(r,l){const h=l/2,f=Math.sin(h);return this._x=r.x*f,this._y=r.y*f,this._z=r.z*f,this._w=Math.cos(h),this._onChangeCallback(),this}setFromRotationMatrix(r){const l=r.elements,h=l[0],f=l[4],v=l[8],b=l[1],E=l[5],D=l[9],P=l[2],O=l[6],F=l[10],N=h+E+F;if(N>0){const z=.5/Math.sqrt(N+1);this._w=.25/z,this._x=(O-D)*z,this._y=(v-P)*z,this._z=(b-f)*z}else if(h>E&&h>F){const z=2*Math.sqrt(1+h-E-F);this._w=(O-D)/z,this._x=.25*z,this._y=(f+b)/z,this._z=(v+P)/z}else if(E>F){const z=2*Math.sqrt(1+E-h-F);this._w=(v-P)/z,this._x=(f+b)/z,this._y=.25*z,this._z=(D+O)/z}else{const z=2*Math.sqrt(1+F-h-E);this._w=(b-f)/z,this._x=(v+P)/z,this._y=(D+O)/z,this._z=.25*z}return this._onChangeCallback(),this}setFromUnitVectors(r,l){let h=r.dot(l)+1;return h<Number.EPSILON?(h=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=h):(this._x=0,this._y=-r.z,this._z=r.y,this._w=h)):(this._x=r.y*l.z-r.z*l.y,this._y=r.z*l.x-r.x*l.z,this._z=r.x*l.y-r.y*l.x,this._w=h),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs($i(this.dot(r),-1,1)))}rotateTowards(r,l){const h=this.angleTo(r);if(h===0)return this;const f=Math.min(1,l/h);return this.slerp(r,f),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,l){const h=r._x,f=r._y,v=r._z,b=r._w,E=l._x,D=l._y,P=l._z,O=l._w;return this._x=h*O+b*E+f*P-v*D,this._y=f*O+b*D+v*E-h*P,this._z=v*O+b*P+h*D-f*E,this._w=b*O-h*E-f*D-v*P,this._onChangeCallback(),this}slerp(r,l){if(l===0)return this;if(l===1)return this.copy(r);const h=this._x,f=this._y,v=this._z,b=this._w;let E=b*r._w+h*r._x+f*r._y+v*r._z;if(E<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,E=-E):this.copy(r),E>=1)return this._w=b,this._x=h,this._y=f,this._z=v,this;const D=1-E*E;if(D<=Number.EPSILON){const z=1-l;return this._w=z*b+l*this._w,this._x=z*h+l*this._x,this._y=z*f+l*this._y,this._z=z*v+l*this._z,this.normalize(),this._onChangeCallback(),this}const P=Math.sqrt(D),O=Math.atan2(P,E),F=Math.sin((1-l)*O)/P,N=Math.sin(l*O)/P;return this._w=b*F+this._w*N,this._x=h*F+this._x*N,this._y=f*F+this._y*N,this._z=v*F+this._z*N,this._onChangeCallback(),this}slerpQuaternions(r,l,h){return this.copy(r).slerp(l,h)}random(){const r=Math.random(),l=Math.sqrt(1-r),h=Math.sqrt(r),f=2*Math.PI*Math.random(),v=2*Math.PI*Math.random();return this.set(l*Math.cos(f),h*Math.sin(v),h*Math.cos(v),l*Math.sin(f))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,l=0){return this._x=r[l],this._y=r[l+1],this._z=r[l+2],this._w=r[l+3],this._onChangeCallback(),this}toArray(r=[],l=0){return r[l]=this._x,r[l+1]=this._y,r[l+2]=this._z,r[l+3]=this._w,r}fromBufferAttribute(r,l){return this._x=r.getX(l),this._y=r.getY(l),this._z=r.getZ(l),this._w=r.getW(l),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class fe{constructor(r=0,l=0,h=0){fe.prototype.isVector3=!0,this.x=r,this.y=l,this.z=h}set(r,l,h){return h===void 0&&(h=this.z),this.x=r,this.y=l,this.z=h,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setComponent(r,l){switch(r){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this}addVectors(r,l){return this.x=r.x+l.x,this.y=r.y+l.y,this.z=r.z+l.z,this}addScaledVector(r,l){return this.x+=r.x*l,this.y+=r.y*l,this.z+=r.z*l,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this}subVectors(r,l){return this.x=r.x-l.x,this.y=r.y-l.y,this.z=r.z-l.z,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}multiplyVectors(r,l){return this.x=r.x*l.x,this.y=r.y*l.y,this.z=r.z*l.z,this}applyEuler(r){return this.applyQuaternion(Tl.setFromEuler(r))}applyAxisAngle(r,l){return this.applyQuaternion(Tl.setFromAxisAngle(r,l))}applyMatrix3(r){const l=this.x,h=this.y,f=this.z,v=r.elements;return this.x=v[0]*l+v[3]*h+v[6]*f,this.y=v[1]*l+v[4]*h+v[7]*f,this.z=v[2]*l+v[5]*h+v[8]*f,this}applyNormalMatrix(r){return this.applyMatrix3(r).normalize()}applyMatrix4(r){const l=this.x,h=this.y,f=this.z,v=r.elements,b=1/(v[3]*l+v[7]*h+v[11]*f+v[15]);return this.x=(v[0]*l+v[4]*h+v[8]*f+v[12])*b,this.y=(v[1]*l+v[5]*h+v[9]*f+v[13])*b,this.z=(v[2]*l+v[6]*h+v[10]*f+v[14])*b,this}applyQuaternion(r){const l=this.x,h=this.y,f=this.z,v=r.x,b=r.y,E=r.z,D=r.w,P=D*l+b*f-E*h,O=D*h+E*l-v*f,F=D*f+v*h-b*l,N=-v*l-b*h-E*f;return this.x=P*D+N*-v+O*-E-F*-b,this.y=O*D+N*-b+F*-v-P*-E,this.z=F*D+N*-E+P*-b-O*-v,this}project(r){return this.applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix)}unproject(r){return this.applyMatrix4(r.projectionMatrixInverse).applyMatrix4(r.matrixWorld)}transformDirection(r){const l=this.x,h=this.y,f=this.z,v=r.elements;return this.x=v[0]*l+v[4]*h+v[8]*f,this.y=v[1]*l+v[5]*h+v[9]*f,this.z=v[2]*l+v[6]*h+v[10]*f,this.normalize()}divide(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this}divideScalar(r){return this.multiplyScalar(1/r)}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}clamp(r,l){return this.x=Math.max(r.x,Math.min(l.x,this.x)),this.y=Math.max(r.y,Math.min(l.y,this.y)),this.z=Math.max(r.z,Math.min(l.z,this.z)),this}clampScalar(r,l){return this.x=Math.max(r,Math.min(l,this.x)),this.y=Math.max(r,Math.min(l,this.y)),this.z=Math.max(r,Math.min(l,this.z)),this}clampLength(r,l){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(r,Math.min(l,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,l){return this.x+=(r.x-this.x)*l,this.y+=(r.y-this.y)*l,this.z+=(r.z-this.z)*l,this}lerpVectors(r,l,h){return this.x=r.x+(l.x-r.x)*h,this.y=r.y+(l.y-r.y)*h,this.z=r.z+(l.z-r.z)*h,this}cross(r){return this.crossVectors(this,r)}crossVectors(r,l){const h=r.x,f=r.y,v=r.z,b=l.x,E=l.y,D=l.z;return this.x=f*D-v*E,this.y=v*b-h*D,this.z=h*E-f*b,this}projectOnVector(r){const l=r.lengthSq();if(l===0)return this.set(0,0,0);const h=r.dot(this)/l;return this.copy(r).multiplyScalar(h)}projectOnPlane(r){return os.copy(this).projectOnVector(r),this.sub(os)}reflect(r){return this.sub(os.copy(r).multiplyScalar(2*this.dot(r)))}angleTo(r){const l=Math.sqrt(this.lengthSq()*r.lengthSq());if(l===0)return Math.PI/2;const h=this.dot(r)/l;return Math.acos($i(h,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const l=this.x-r.x,h=this.y-r.y,f=this.z-r.z;return l*l+h*h+f*f}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)+Math.abs(this.z-r.z)}setFromSpherical(r){return this.setFromSphericalCoords(r.radius,r.phi,r.theta)}setFromSphericalCoords(r,l,h){const f=Math.sin(l)*r;return this.x=f*Math.sin(h),this.y=Math.cos(l)*r,this.z=f*Math.cos(h),this}setFromCylindrical(r){return this.setFromCylindricalCoords(r.radius,r.theta,r.y)}setFromCylindricalCoords(r,l,h){return this.x=r*Math.sin(l),this.y=h,this.z=r*Math.cos(l),this}setFromMatrixPosition(r){const l=r.elements;return this.x=l[12],this.y=l[13],this.z=l[14],this}setFromMatrixScale(r){const l=this.setFromMatrixColumn(r,0).length(),h=this.setFromMatrixColumn(r,1).length(),f=this.setFromMatrixColumn(r,2).length();return this.x=l,this.y=h,this.z=f,this}setFromMatrixColumn(r,l){return this.fromArray(r.elements,4*l)}setFromMatrix3Column(r,l){return this.fromArray(r.elements,3*l)}setFromEuler(r){return this.x=r._x,this.y=r._y,this.z=r._z,this}setFromColor(r){return this.x=r.r,this.y=r.g,this.z=r.b,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z}fromArray(r,l=0){return this.x=r[l],this.y=r[l+1],this.z=r[l+2],this}toArray(r=[],l=0){return r[l]=this.x,r[l+1]=this.y,r[l+2]=this.z,r}fromBufferAttribute(r,l){return this.x=r.getX(l),this.y=r.getY(l),this.z=r.getZ(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const r=2*(Math.random()-.5),l=Math.random()*Math.PI*2,h=Math.sqrt(1-r**2);return this.x=h*Math.cos(l),this.y=h*Math.sin(l),this.z=r,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const os=new fe,Tl=new Ao;class bo{constructor(r=new fe(1/0,1/0,1/0),l=new fe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=l}set(r,l){return this.min.copy(r),this.max.copy(l),this}setFromArray(r){this.makeEmpty();for(let l=0,h=r.length;l<h;l+=3)this.expandByPoint(wo.fromArray(r,l));return this}setFromBufferAttribute(r){this.makeEmpty();for(let l=0,h=r.count;l<h;l++)this.expandByPoint(wo.fromBufferAttribute(r,l));return this}setFromPoints(r){this.makeEmpty();for(let l=0,h=r.length;l<h;l++)this.expandByPoint(r[l]);return this}setFromCenterAndSize(r,l){const h=wo.copy(l).multiplyScalar(.5);return this.min.copy(r).sub(h),this.max.copy(r).add(h),this}setFromObject(r,l=!1){return this.makeEmpty(),this.expandByObject(r,l)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,l=!1){if(r.updateWorldMatrix(!1,!1),r.boundingBox!==void 0)r.boundingBox===null&&r.computeBoundingBox(),el.copy(r.boundingBox),el.applyMatrix4(r.matrixWorld),this.union(el);else{const f=r.geometry;if(f!==void 0)if(l&&f.attributes!==void 0&&f.attributes.position!==void 0){const v=f.attributes.position;for(let b=0,E=v.count;b<E;b++)wo.fromBufferAttribute(v,b).applyMatrix4(r.matrixWorld),this.expandByPoint(wo)}else f.boundingBox===null&&f.computeBoundingBox(),el.copy(f.boundingBox),el.applyMatrix4(r.matrixWorld),this.union(el)}const h=r.children;for(let f=0,v=h.length;f<v;f++)this.expandByObject(h[f],l);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,l){return l.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,wo),wo.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let l,h;return r.normal.x>0?(l=r.normal.x*this.min.x,h=r.normal.x*this.max.x):(l=r.normal.x*this.max.x,h=r.normal.x*this.min.x),r.normal.y>0?(l+=r.normal.y*this.min.y,h+=r.normal.y*this.max.y):(l+=r.normal.y*this.max.y,h+=r.normal.y*this.min.y),r.normal.z>0?(l+=r.normal.z*this.min.z,h+=r.normal.z*this.max.z):(l+=r.normal.z*this.max.z,h+=r.normal.z*this.min.z),l<=-r.constant&&h>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(dc),er.subVectors(this.max,dc),mu.subVectors(r.a,dc),Fc.subVectors(r.b,dc),jo.subVectors(r.c,dc),uc.subVectors(Fc,mu),hc.subVectors(jo,Fc),tl.subVectors(mu,jo);let l=[0,-uc.z,uc.y,0,-hc.z,hc.y,0,-tl.z,tl.y,uc.z,0,-uc.x,hc.z,0,-hc.x,tl.z,0,-tl.x,-uc.y,uc.x,0,-hc.y,hc.x,0,-tl.y,tl.x,0];return!!aa(l,mu,Fc,jo,er)&&(l=[1,0,0,0,1,0,0,0,1],!!aa(l,mu,Fc,jo,er)&&(Il.crossVectors(uc,hc),l=[Il.x,Il.y,Il.z],aa(l,mu,Fc,jo,er)))}clampPoint(r,l){return l.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,wo).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=.5*this.getSize(wo).length()),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()||(Fo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),Fo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),Fo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),Fo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),Fo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),Fo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),Fo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),Fo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(Fo)),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}const Fo=[new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe],wo=new fe,el=new bo,mu=new fe,Fc=new fe,jo=new fe,uc=new fe,hc=new fe,tl=new fe,dc=new fe,er=new fe,Il=new fe,Bs=new fe;function aa(A,r,l,h,f){for(let v=0,b=A.length-3;v<=b;v+=3){Bs.fromArray(A,v);const E=f.x*Math.abs(Bs.x)+f.y*Math.abs(Bs.y)+f.z*Math.abs(Bs.z),D=r.dot(Bs),P=l.dot(Bs),O=h.dot(Bs);if(Math.max(-Math.max(D,P,O),Math.min(D,P,O))>E)return!1}return!0}const hh=new bo,dh=new fe,cf=new fe;class la{constructor(r=new fe,l=-1){this.center=r,this.radius=l}set(r,l){return this.center.copy(r),this.radius=l,this}setFromPoints(r,l){const h=this.center;l!==void 0?h.copy(l):hh.setFromPoints(r).getCenter(h);let f=0;for(let v=0,b=r.length;v<b;v++)f=Math.max(f,h.distanceToSquared(r[v]));return this.radius=Math.sqrt(f),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const l=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=l*l}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,l){const h=this.center.distanceToSquared(r);return l.copy(r),h>this.radius*this.radius&&(l.sub(this.center).normalize(),l.multiplyScalar(this.radius).add(this.center)),l}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;dh.subVectors(r,this.center);const l=dh.lengthSq();if(l>this.radius*this.radius){const h=Math.sqrt(l),f=.5*(h-this.radius);this.center.addScaledVector(dh,f/h),this.radius+=f}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(cf.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(dh.copy(r.center).add(cf)),this.expandByPoint(dh.copy(r.center).sub(cf))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Pl=new fe,ph=new fe,Qs=new fe,nl=new fe,gu=new fe,xo=new fe,vu=new fe;class io{constructor(r=new fe,l=new fe(0,0,-1)){this.origin=r,this.direction=l}set(r,l){return this.origin.copy(r),this.direction.copy(l),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,l){return l.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,Pl)),this}closestPointToPoint(r,l){l.subVectors(r,this.origin);const h=l.dot(this.direction);return h<0?l.copy(this.origin):l.copy(this.origin).addScaledVector(this.direction,h)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const l=Pl.subVectors(r,this.origin).dot(this.direction);return l<0?this.origin.distanceToSquared(r):(Pl.copy(this.origin).addScaledVector(this.direction,l),Pl.distanceToSquared(r))}distanceSqToSegment(r,l,h,f){ph.copy(r).add(l).multiplyScalar(.5),Qs.copy(l).sub(r).normalize(),nl.copy(this.origin).sub(ph);const v=.5*r.distanceTo(l),b=-this.direction.dot(Qs),E=nl.dot(this.direction),D=-nl.dot(Qs),P=nl.lengthSq(),O=Math.abs(1-b*b);let F,N,z,G;if(O>0)if(F=b*D-E,N=b*E-D,G=v*O,F>=0)if(N>=-G)if(N<=G){const W=1/O;F*=W,N*=W,z=F*(F+b*N+2*E)+N*(b*F+N+2*D)+P}else N=v,F=Math.max(0,-(b*N+E)),z=-F*F+N*(N+2*D)+P;else N=-v,F=Math.max(0,-(b*N+E)),z=-F*F+N*(N+2*D)+P;else N<=-G?(F=Math.max(0,-(-b*v+E)),N=F>0?-v:Math.min(Math.max(-v,-D),v),z=-F*F+N*(N+2*D)+P):N<=G?(F=0,N=Math.min(Math.max(-v,-D),v),z=N*(N+2*D)+P):(F=Math.max(0,-(b*v+E)),N=F>0?v:Math.min(Math.max(-v,-D),v),z=-F*F+N*(N+2*D)+P);else N=b>0?-v:v,F=Math.max(0,-(b*N+E)),z=-F*F+N*(N+2*D)+P;return h&&h.copy(this.origin).addScaledVector(this.direction,F),f&&f.copy(ph).addScaledVector(Qs,N),z}intersectSphere(r,l){Pl.subVectors(r.center,this.origin);const h=Pl.dot(this.direction),f=Pl.dot(Pl)-h*h,v=r.radius*r.radius;if(f>v)return null;const b=Math.sqrt(v-f),E=h-b,D=h+b;return D<0?null:E<0?this.at(D,l):this.at(E,l)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const l=r.normal.dot(this.direction);if(l===0)return r.distanceToPoint(this.origin)===0?0:null;const h=-(this.origin.dot(r.normal)+r.constant)/l;return h>=0?h:null}intersectPlane(r,l){const h=this.distanceToPlane(r);return h===null?null:this.at(h,l)}intersectsPlane(r){const l=r.distanceToPoint(this.origin);return l===0||r.normal.dot(this.direction)*l<0}intersectBox(r,l){let h,f,v,b,E,D;const P=1/this.direction.x,O=1/this.direction.y,F=1/this.direction.z,N=this.origin;return P>=0?(h=(r.min.x-N.x)*P,f=(r.max.x-N.x)*P):(h=(r.max.x-N.x)*P,f=(r.min.x-N.x)*P),O>=0?(v=(r.min.y-N.y)*O,b=(r.max.y-N.y)*O):(v=(r.max.y-N.y)*O,b=(r.min.y-N.y)*O),h>b||v>f?null:((v>h||isNaN(h))&&(h=v),(b<f||isNaN(f))&&(f=b),F>=0?(E=(r.min.z-N.z)*F,D=(r.max.z-N.z)*F):(E=(r.max.z-N.z)*F,D=(r.min.z-N.z)*F),h>D||E>f?null:((E>h||h!=h)&&(h=E),(D<f||f!=f)&&(f=D),f<0?null:this.at(h>=0?h:f,l)))}intersectsBox(r){return this.intersectBox(r,Pl)!==null}intersectTriangle(r,l,h,f,v){gu.subVectors(l,r),xo.subVectors(h,r),vu.crossVectors(gu,xo);let b,E=this.direction.dot(vu);if(E>0){if(f)return null;b=1}else{if(!(E<0))return null;b=-1,E=-E}nl.subVectors(this.origin,r);const D=b*this.direction.dot(xo.crossVectors(nl,xo));if(D<0)return null;const P=b*this.direction.dot(gu.cross(nl));if(P<0||D+P>E)return null;const O=-b*nl.dot(vu);return O<0?null:this.at(O/E,v)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class si{constructor(){si.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(r,l,h,f,v,b,E,D,P,O,F,N,z,G,W,Q){const q=this.elements;return q[0]=r,q[4]=l,q[8]=h,q[12]=f,q[1]=v,q[5]=b,q[9]=E,q[13]=D,q[2]=P,q[6]=O,q[10]=F,q[14]=N,q[3]=z,q[7]=G,q[11]=W,q[15]=Q,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new si().fromArray(this.elements)}copy(r){const l=this.elements,h=r.elements;return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=h[6],l[7]=h[7],l[8]=h[8],l[9]=h[9],l[10]=h[10],l[11]=h[11],l[12]=h[12],l[13]=h[13],l[14]=h[14],l[15]=h[15],this}copyPosition(r){const l=this.elements,h=r.elements;return l[12]=h[12],l[13]=h[13],l[14]=h[14],this}setFromMatrix3(r){const l=r.elements;return this.set(l[0],l[3],l[6],0,l[1],l[4],l[7],0,l[2],l[5],l[8],0,0,0,0,1),this}extractBasis(r,l,h){return r.setFromMatrixColumn(this,0),l.setFromMatrixColumn(this,1),h.setFromMatrixColumn(this,2),this}makeBasis(r,l,h){return this.set(r.x,l.x,h.x,0,r.y,l.y,h.y,0,r.z,l.z,h.z,0,0,0,0,1),this}extractRotation(r){const l=this.elements,h=r.elements,f=1/pc.setFromMatrixColumn(r,0).length(),v=1/pc.setFromMatrixColumn(r,1).length(),b=1/pc.setFromMatrixColumn(r,2).length();return l[0]=h[0]*f,l[1]=h[1]*f,l[2]=h[2]*f,l[3]=0,l[4]=h[4]*v,l[5]=h[5]*v,l[6]=h[6]*v,l[7]=0,l[8]=h[8]*b,l[9]=h[9]*b,l[10]=h[10]*b,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromEuler(r){const l=this.elements,h=r.x,f=r.y,v=r.z,b=Math.cos(h),E=Math.sin(h),D=Math.cos(f),P=Math.sin(f),O=Math.cos(v),F=Math.sin(v);if(r.order==="XYZ"){const N=b*O,z=b*F,G=E*O,W=E*F;l[0]=D*O,l[4]=-D*F,l[8]=P,l[1]=z+G*P,l[5]=N-W*P,l[9]=-E*D,l[2]=W-N*P,l[6]=G+z*P,l[10]=b*D}else if(r.order==="YXZ"){const N=D*O,z=D*F,G=P*O,W=P*F;l[0]=N+W*E,l[4]=G*E-z,l[8]=b*P,l[1]=b*F,l[5]=b*O,l[9]=-E,l[2]=z*E-G,l[6]=W+N*E,l[10]=b*D}else if(r.order==="ZXY"){const N=D*O,z=D*F,G=P*O,W=P*F;l[0]=N-W*E,l[4]=-b*F,l[8]=G+z*E,l[1]=z+G*E,l[5]=b*O,l[9]=W-N*E,l[2]=-b*P,l[6]=E,l[10]=b*D}else if(r.order==="ZYX"){const N=b*O,z=b*F,G=E*O,W=E*F;l[0]=D*O,l[4]=G*P-z,l[8]=N*P+W,l[1]=D*F,l[5]=W*P+N,l[9]=z*P-G,l[2]=-P,l[6]=E*D,l[10]=b*D}else if(r.order==="YZX"){const N=b*D,z=b*P,G=E*D,W=E*P;l[0]=D*O,l[4]=W-N*F,l[8]=G*F+z,l[1]=F,l[5]=b*O,l[9]=-E*O,l[2]=-P*O,l[6]=z*F+G,l[10]=N-W*F}else if(r.order==="XZY"){const N=b*D,z=b*P,G=E*D,W=E*P;l[0]=D*O,l[4]=-F,l[8]=P*O,l[1]=N*F+W,l[5]=b*O,l[9]=z*F-G,l[2]=G*F-z,l[6]=E*O,l[10]=W*F+N}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromQuaternion(r){return this.compose(Mm,r,fh)}lookAt(r,l,h){const f=this.elements;return Eo.subVectors(r,l),Eo.lengthSq()===0&&(Eo.z=1),Eo.normalize(),Ua.crossVectors(h,Eo),Ua.lengthSq()===0&&(Math.abs(h.z)===1?Eo.x+=1e-4:Eo.z+=1e-4,Eo.normalize(),Ua.crossVectors(h,Eo)),Ua.normalize(),ca.crossVectors(Eo,Ua),f[0]=Ua.x,f[4]=ca.x,f[8]=Eo.x,f[1]=Ua.y,f[5]=ca.y,f[9]=Eo.y,f[2]=Ua.z,f[6]=ca.z,f[10]=Eo.z,this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,l){const h=r.elements,f=l.elements,v=this.elements,b=h[0],E=h[4],D=h[8],P=h[12],O=h[1],F=h[5],N=h[9],z=h[13],G=h[2],W=h[6],Q=h[10],q=h[14],K=h[3],ne=h[7],be=h[11],ve=h[15],me=f[0],Pe=f[4],tt=f[8],Oe=f[12],pt=f[1],ke=f[5],Mt=f[9],Ot=f[13],tn=f[2],An=f[6],nn=f[10],Xt=f[14],dn=f[3],gn=f[7],xt=f[11],Wt=f[15];return v[0]=b*me+E*pt+D*tn+P*dn,v[4]=b*Pe+E*ke+D*An+P*gn,v[8]=b*tt+E*Mt+D*nn+P*xt,v[12]=b*Oe+E*Ot+D*Xt+P*Wt,v[1]=O*me+F*pt+N*tn+z*dn,v[5]=O*Pe+F*ke+N*An+z*gn,v[9]=O*tt+F*Mt+N*nn+z*xt,v[13]=O*Oe+F*Ot+N*Xt+z*Wt,v[2]=G*me+W*pt+Q*tn+q*dn,v[6]=G*Pe+W*ke+Q*An+q*gn,v[10]=G*tt+W*Mt+Q*nn+q*xt,v[14]=G*Oe+W*Ot+Q*Xt+q*Wt,v[3]=K*me+ne*pt+be*tn+ve*dn,v[7]=K*Pe+ne*ke+be*An+ve*gn,v[11]=K*tt+ne*Mt+be*nn+ve*xt,v[15]=K*Oe+ne*Ot+be*Xt+ve*Wt,this}multiplyScalar(r){const l=this.elements;return l[0]*=r,l[4]*=r,l[8]*=r,l[12]*=r,l[1]*=r,l[5]*=r,l[9]*=r,l[13]*=r,l[2]*=r,l[6]*=r,l[10]*=r,l[14]*=r,l[3]*=r,l[7]*=r,l[11]*=r,l[15]*=r,this}determinant(){const r=this.elements,l=r[0],h=r[4],f=r[8],v=r[12],b=r[1],E=r[5],D=r[9],P=r[13],O=r[2],F=r[6],N=r[10],z=r[14];return r[3]*(+v*D*F-f*P*F-v*E*N+h*P*N+f*E*z-h*D*z)+r[7]*(+l*D*z-l*P*N+v*b*N-f*b*z+f*P*O-v*D*O)+r[11]*(+l*P*F-l*E*z-v*b*F+h*b*z+v*E*O-h*P*O)+r[15]*(-f*E*O-l*D*F+l*E*N+f*b*F-h*b*N+h*D*O)}transpose(){const r=this.elements;let l;return l=r[1],r[1]=r[4],r[4]=l,l=r[2],r[2]=r[8],r[8]=l,l=r[6],r[6]=r[9],r[9]=l,l=r[3],r[3]=r[12],r[12]=l,l=r[7],r[7]=r[13],r[13]=l,l=r[11],r[11]=r[14],r[14]=l,this}setPosition(r,l,h){const f=this.elements;return r.isVector3?(f[12]=r.x,f[13]=r.y,f[14]=r.z):(f[12]=r,f[13]=l,f[14]=h),this}invert(){const r=this.elements,l=r[0],h=r[1],f=r[2],v=r[3],b=r[4],E=r[5],D=r[6],P=r[7],O=r[8],F=r[9],N=r[10],z=r[11],G=r[12],W=r[13],Q=r[14],q=r[15],K=F*Q*P-W*N*P+W*D*z-E*Q*z-F*D*q+E*N*q,ne=G*N*P-O*Q*P-G*D*z+b*Q*z+O*D*q-b*N*q,be=O*W*P-G*F*P+G*E*z-b*W*z-O*E*q+b*F*q,ve=G*F*D-O*W*D-G*E*N+b*W*N+O*E*Q-b*F*Q,me=l*K+h*ne+f*be+v*ve;if(me===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Pe=1/me;return r[0]=K*Pe,r[1]=(W*N*v-F*Q*v-W*f*z+h*Q*z+F*f*q-h*N*q)*Pe,r[2]=(E*Q*v-W*D*v+W*f*P-h*Q*P-E*f*q+h*D*q)*Pe,r[3]=(F*D*v-E*N*v-F*f*P+h*N*P+E*f*z-h*D*z)*Pe,r[4]=ne*Pe,r[5]=(O*Q*v-G*N*v+G*f*z-l*Q*z-O*f*q+l*N*q)*Pe,r[6]=(G*D*v-b*Q*v-G*f*P+l*Q*P+b*f*q-l*D*q)*Pe,r[7]=(b*N*v-O*D*v+O*f*P-l*N*P-b*f*z+l*D*z)*Pe,r[8]=be*Pe,r[9]=(G*F*v-O*W*v-G*h*z+l*W*z+O*h*q-l*F*q)*Pe,r[10]=(b*W*v-G*E*v+G*h*P-l*W*P-b*h*q+l*E*q)*Pe,r[11]=(O*E*v-b*F*v-O*h*P+l*F*P+b*h*z-l*E*z)*Pe,r[12]=ve*Pe,r[13]=(O*W*f-G*F*f+G*h*N-l*W*N-O*h*Q+l*F*Q)*Pe,r[14]=(G*E*f-b*W*f-G*h*D+l*W*D+b*h*Q-l*E*Q)*Pe,r[15]=(b*F*f-O*E*f+O*h*D-l*F*D-b*h*N+l*E*N)*Pe,this}scale(r){const l=this.elements,h=r.x,f=r.y,v=r.z;return l[0]*=h,l[4]*=f,l[8]*=v,l[1]*=h,l[5]*=f,l[9]*=v,l[2]*=h,l[6]*=f,l[10]*=v,l[3]*=h,l[7]*=f,l[11]*=v,this}getMaxScaleOnAxis(){const r=this.elements,l=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],h=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],f=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(l,h,f))}makeTranslation(r,l,h){return this.set(1,0,0,r,0,1,0,l,0,0,1,h,0,0,0,1),this}makeRotationX(r){const l=Math.cos(r),h=Math.sin(r);return this.set(1,0,0,0,0,l,-h,0,0,h,l,0,0,0,0,1),this}makeRotationY(r){const l=Math.cos(r),h=Math.sin(r);return this.set(l,0,h,0,0,1,0,0,-h,0,l,0,0,0,0,1),this}makeRotationZ(r){const l=Math.cos(r),h=Math.sin(r);return this.set(l,-h,0,0,h,l,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(r,l){const h=Math.cos(l),f=Math.sin(l),v=1-h,b=r.x,E=r.y,D=r.z,P=v*b,O=v*E;return this.set(P*b+h,P*E-f*D,P*D+f*E,0,P*E+f*D,O*E+h,O*D-f*b,0,P*D-f*E,O*D+f*b,v*D*D+h,0,0,0,0,1),this}makeScale(r,l,h){return this.set(r,0,0,0,0,l,0,0,0,0,h,0,0,0,0,1),this}makeShear(r,l,h,f,v,b){return this.set(1,h,v,0,r,1,b,0,l,f,1,0,0,0,0,1),this}compose(r,l,h){const f=this.elements,v=l._x,b=l._y,E=l._z,D=l._w,P=v+v,O=b+b,F=E+E,N=v*P,z=v*O,G=v*F,W=b*O,Q=b*F,q=E*F,K=D*P,ne=D*O,be=D*F,ve=h.x,me=h.y,Pe=h.z;return f[0]=(1-(W+q))*ve,f[1]=(z+be)*ve,f[2]=(G-ne)*ve,f[3]=0,f[4]=(z-be)*me,f[5]=(1-(N+q))*me,f[6]=(Q+K)*me,f[7]=0,f[8]=(G+ne)*Pe,f[9]=(Q-K)*Pe,f[10]=(1-(N+W))*Pe,f[11]=0,f[12]=r.x,f[13]=r.y,f[14]=r.z,f[15]=1,this}decompose(r,l,h){const f=this.elements;let v=pc.set(f[0],f[1],f[2]).length();const b=pc.set(f[4],f[5],f[6]).length(),E=pc.set(f[8],f[9],f[10]).length();this.determinant()<0&&(v=-v),r.x=f[12],r.y=f[13],r.z=f[14],zo.copy(this);const D=1/v,P=1/b,O=1/E;return zo.elements[0]*=D,zo.elements[1]*=D,zo.elements[2]*=D,zo.elements[4]*=P,zo.elements[5]*=P,zo.elements[6]*=P,zo.elements[8]*=O,zo.elements[9]*=O,zo.elements[10]*=O,l.setFromRotationMatrix(zo),h.x=v,h.y=b,h.z=E,this}makePerspective(r,l,h,f,v,b){const E=this.elements,D=2*v/(l-r),P=2*v/(h-f),O=(l+r)/(l-r),F=(h+f)/(h-f),N=-(b+v)/(b-v),z=-2*b*v/(b-v);return E[0]=D,E[4]=0,E[8]=O,E[12]=0,E[1]=0,E[5]=P,E[9]=F,E[13]=0,E[2]=0,E[6]=0,E[10]=N,E[14]=z,E[3]=0,E[7]=0,E[11]=-1,E[15]=0,this}makeOrthographic(r,l,h,f,v,b){const E=this.elements,D=1/(l-r),P=1/(h-f),O=1/(b-v),F=(l+r)*D,N=(h+f)*P,z=(b+v)*O;return E[0]=2*D,E[4]=0,E[8]=0,E[12]=-F,E[1]=0,E[5]=2*P,E[9]=0,E[13]=-N,E[2]=0,E[6]=0,E[10]=-2*O,E[14]=-z,E[3]=0,E[7]=0,E[11]=0,E[15]=1,this}equals(r){const l=this.elements,h=r.elements;for(let f=0;f<16;f++)if(l[f]!==h[f])return!1;return!0}fromArray(r,l=0){for(let h=0;h<16;h++)this.elements[h]=r[h+l];return this}toArray(r=[],l=0){const h=this.elements;return r[l]=h[0],r[l+1]=h[1],r[l+2]=h[2],r[l+3]=h[3],r[l+4]=h[4],r[l+5]=h[5],r[l+6]=h[6],r[l+7]=h[7],r[l+8]=h[8],r[l+9]=h[9],r[l+10]=h[10],r[l+11]=h[11],r[l+12]=h[12],r[l+13]=h[13],r[l+14]=h[14],r[l+15]=h[15],r}}const pc=new fe,zo=new si,Mm=new fe(0,0,0),fh=new fe(1,1,1),Ua=new fe,ca=new fe,Eo=new fe,Rl=new si,Nd=new Ao;class _u{constructor(r=0,l=0,h=0,f=_u.DEFAULT_ORDER){this.isEuler=!0,this._x=r,this._y=l,this._z=h,this._order=f}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get order(){return this._order}set order(r){this._order=r,this._onChangeCallback()}set(r,l,h,f=this._order){return this._x=r,this._y=l,this._z=h,this._order=f,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(r){return this._x=r._x,this._y=r._y,this._z=r._z,this._order=r._order,this._onChangeCallback(),this}setFromRotationMatrix(r,l=this._order,h=!0){const f=r.elements,v=f[0],b=f[4],E=f[8],D=f[1],P=f[5],O=f[9],F=f[2],N=f[6],z=f[10];switch(l){case"XYZ":this._y=Math.asin($i(E,-1,1)),Math.abs(E)<.9999999?(this._x=Math.atan2(-O,z),this._z=Math.atan2(-b,v)):(this._x=Math.atan2(N,P),this._z=0);break;case"YXZ":this._x=Math.asin(-$i(O,-1,1)),Math.abs(O)<.9999999?(this._y=Math.atan2(E,z),this._z=Math.atan2(D,P)):(this._y=Math.atan2(-F,v),this._z=0);break;case"ZXY":this._x=Math.asin($i(N,-1,1)),Math.abs(N)<.9999999?(this._y=Math.atan2(-F,z),this._z=Math.atan2(-b,P)):(this._y=0,this._z=Math.atan2(D,v));break;case"ZYX":this._y=Math.asin(-$i(F,-1,1)),Math.abs(F)<.9999999?(this._x=Math.atan2(N,z),this._z=Math.atan2(D,v)):(this._x=0,this._z=Math.atan2(-b,P));break;case"YZX":this._z=Math.asin($i(D,-1,1)),Math.abs(D)<.9999999?(this._x=Math.atan2(-O,P),this._y=Math.atan2(-F,v)):(this._x=0,this._y=Math.atan2(E,z));break;case"XZY":this._z=Math.asin(-$i(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(N,P),this._y=Math.atan2(E,v)):(this._x=Math.atan2(-O,z),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+l)}return this._order=l,h===!0&&this._onChangeCallback(),this}setFromQuaternion(r,l,h){return Rl.makeRotationFromQuaternion(r),this.setFromRotationMatrix(Rl,l,h)}setFromVector3(r,l=this._order){return this.set(r.x,r.y,r.z,l)}reorder(r){return Nd.setFromEuler(this),this.setFromQuaternion(Nd,r)}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._order===this._order}fromArray(r){return this._x=r[0],this._y=r[1],this._z=r[2],r[3]!==void 0&&(this._order=r[3]),this._onChangeCallback(),this}toArray(r=[],l=0){return r[l]=this._x,r[l+1]=this._y,r[l+2]=this._z,r[l+3]=this._order,r}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}_u.DEFAULT_ORDER="XYZ";class Dl{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!=0}isEnabled(r){return(this.mask&(1<<r|0))!=0}}let Tm=0;const So=new fe,il=new Ao,Co=new si,yu=new fe,ua=new fe,mh=new fe,Au=new Ao,Im=new fe(1,0,0),Pm=new fe(0,1,0),jc=new fe(0,0,1),Rm={type:"added"},fc={type:"removed"};class zi extends Ml{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Tm++}),this.uuid=ss(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=zi.DEFAULT_UP.clone();const r=new fe,l=new _u,h=new Ao,f=new fe(1,1,1);l._onChange(function(){h.setFromEuler(l,!1)}),h._onChange(function(){l.setFromQuaternion(h,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:l},quaternion:{configurable:!0,enumerable:!0,value:h},scale:{configurable:!0,enumerable:!0,value:f},modelViewMatrix:{value:new si},normalMatrix:{value:new bi}}),this.matrix=new si,this.matrixWorld=new si,this.matrixAutoUpdate=zi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Dl,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(r,l,h,f,v,b){this.dispatchEvent({type:"beforeRender",renderer:r,scene:l,camera:h,geometry:f,material:v,group:b})}onAfterRender(r,l,h,f,v,b){this.dispatchEvent({type:"afterRender",renderer:r,scene:l,camera:h,geometry:f,material:v,group:b})}applyMatrix4(r){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(r),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(r){return this.quaternion.premultiply(r),this}setRotationFromAxisAngle(r,l){this.quaternion.setFromAxisAngle(r,l)}setRotationFromEuler(r){this.quaternion.setFromEuler(r,!0)}setRotationFromMatrix(r){this.quaternion.setFromRotationMatrix(r)}setRotationFromQuaternion(r){this.quaternion.copy(r)}rotateOnAxis(r,l){return il.setFromAxisAngle(r,l),this.quaternion.multiply(il),this}rotateOnWorldAxis(r,l){return il.setFromAxisAngle(r,l),this.quaternion.premultiply(il),this}rotateX(r){return this.rotateOnAxis(Im,r)}rotateY(r){return this.rotateOnAxis(Pm,r)}rotateZ(r){return this.rotateOnAxis(jc,r)}translateOnAxis(r,l){return So.copy(r).applyQuaternion(this.quaternion),this.position.add(So.multiplyScalar(l)),this}translateX(r){return this.translateOnAxis(Im,r)}translateY(r){return this.translateOnAxis(Pm,r)}translateZ(r){return this.translateOnAxis(jc,r)}localToWorld(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4(this.matrixWorld)}worldToLocal(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4(Co.copy(this.matrixWorld).invert())}lookAt(r,l,h){r.isVector3?yu.copy(r):yu.set(r,l,h);const f=this.parent;this.updateWorldMatrix(!0,!1),ua.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Co.lookAt(ua,yu,this.up):Co.lookAt(yu,ua,this.up),this.quaternion.setFromRotationMatrix(Co),f&&(Co.extractRotation(f.matrixWorld),il.setFromRotationMatrix(Co),this.quaternion.premultiply(il.invert()))}add(r){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.add(arguments[l]);return this}return r===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",r),this):(r&&r.isObject3D?(r.parent!==null&&r.parent.remove(r),r.parent=this,this.children.push(r),r.dispatchEvent(Rm)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",r),this)}remove(r){if(arguments.length>1){for(let h=0;h<arguments.length;h++)this.remove(arguments[h]);return this}const l=this.children.indexOf(r);return l!==-1&&(r.parent=null,this.children.splice(l,1),r.dispatchEvent(fc)),this}removeFromParent(){const r=this.parent;return r!==null&&r.remove(this),this}clear(){for(let r=0;r<this.children.length;r++){const l=this.children[r];l.parent=null,l.dispatchEvent(fc)}return this.children.length=0,this}attach(r){return this.updateWorldMatrix(!0,!1),Co.copy(this.matrixWorld).invert(),r.parent!==null&&(r.parent.updateWorldMatrix(!0,!1),Co.multiply(r.parent.matrixWorld)),r.applyMatrix4(Co),this.add(r),r.updateWorldMatrix(!1,!0),this}getObjectById(r){return this.getObjectByProperty("id",r)}getObjectByName(r){return this.getObjectByProperty("name",r)}getObjectByProperty(r,l){if(this[r]===l)return this;for(let h=0,f=this.children.length;h<f;h++){const v=this.children[h].getObjectByProperty(r,l);if(v!==void 0)return v}}getObjectsByProperty(r,l){let h=[];this[r]===l&&h.push(this);for(let f=0,v=this.children.length;f<v;f++){const b=this.children[f].getObjectsByProperty(r,l);b.length>0&&(h=h.concat(b))}return h}getWorldPosition(r){return this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ua,r,mh),r}getWorldScale(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ua,Au,r),r}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return r.set(l[8],l[9],l[10]).normalize()}raycast(){}traverse(r){r(this);const l=this.children;for(let h=0,f=l.length;h<f;h++)l[h].traverse(r)}traverseVisible(r){if(this.visible===!1)return;r(this);const l=this.children;for(let h=0,f=l.length;h<f;h++)l[h].traverseVisible(r)}traverseAncestors(r){const l=this.parent;l!==null&&(r(l),l.traverseAncestors(r))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,r=!0);const l=this.children;for(let h=0,f=l.length;h<f;h++){const v=l[h];v.matrixWorldAutoUpdate!==!0&&r!==!0||v.updateMatrixWorld(r)}}updateWorldMatrix(r,l){const h=this.parent;if(r===!0&&h!==null&&h.matrixWorldAutoUpdate===!0&&h.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),l===!0){const f=this.children;for(let v=0,b=f.length;v<b;v++){const E=f[v];E.matrixWorldAutoUpdate===!0&&E.updateWorldMatrix(!1,!0)}}}toJSON(r){const l=r===void 0||typeof r=="string",h={};l&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},h.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const f={};function v(E,D){return E[D.uuid]===void 0&&(E[D.uuid]=D.toJSON(r)),D.uuid}if(f.uuid=this.uuid,f.type=this.type,this.name!==""&&(f.name=this.name),this.castShadow===!0&&(f.castShadow=!0),this.receiveShadow===!0&&(f.receiveShadow=!0),this.visible===!1&&(f.visible=!1),this.frustumCulled===!1&&(f.frustumCulled=!1),this.renderOrder!==0&&(f.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(f.userData=this.userData),f.layers=this.layers.mask,f.matrix=this.matrix.toArray(),f.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(f.matrixAutoUpdate=!1),this.isInstancedMesh&&(f.type="InstancedMesh",f.count=this.count,f.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(f.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?f.background=this.background.toJSON():this.background.isTexture&&(f.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(f.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){f.geometry=v(r.geometries,this.geometry);const E=this.geometry.parameters;if(E!==void 0&&E.shapes!==void 0){const D=E.shapes;if(Array.isArray(D))for(let P=0,O=D.length;P<O;P++){const F=D[P];v(r.shapes,F)}else v(r.shapes,D)}}if(this.isSkinnedMesh&&(f.bindMode=this.bindMode,f.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(v(r.skeletons,this.skeleton),f.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const E=[];for(let D=0,P=this.material.length;D<P;D++)E.push(v(r.materials,this.material[D]));f.material=E}else f.material=v(r.materials,this.material);if(this.children.length>0){f.children=[];for(let E=0;E<this.children.length;E++)f.children.push(this.children[E].toJSON(r).object)}if(this.animations.length>0){f.animations=[];for(let E=0;E<this.animations.length;E++){const D=this.animations[E];f.animations.push(v(r.animations,D))}}if(l){const E=b(r.geometries),D=b(r.materials),P=b(r.textures),O=b(r.images),F=b(r.shapes),N=b(r.skeletons),z=b(r.animations),G=b(r.nodes);E.length>0&&(h.geometries=E),D.length>0&&(h.materials=D),P.length>0&&(h.textures=P),O.length>0&&(h.images=O),F.length>0&&(h.shapes=F),N.length>0&&(h.skeletons=N),z.length>0&&(h.animations=z),G.length>0&&(h.nodes=G)}return h.object=f,h;function b(E){const D=[];for(const P in E){const O=E[P];delete O.metadata,D.push(O)}return D}}clone(r){return new this.constructor().copy(this,r)}copy(r,l=!0){this.name=r.name,this.up.copy(r.up),this.position.copy(r.position),this.rotation.order=r.rotation.order,this.quaternion.copy(r.quaternion),this.scale.copy(r.scale),this.matrix.copy(r.matrix),this.matrixWorld.copy(r.matrixWorld),this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrixWorldNeedsUpdate=r.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=r.matrixWorldAutoUpdate,this.layers.mask=r.layers.mask,this.visible=r.visible,this.castShadow=r.castShadow,this.receiveShadow=r.receiveShadow,this.frustumCulled=r.frustumCulled,this.renderOrder=r.renderOrder,this.animations=r.animations,this.userData={};for(const[h,f]of Object.entries(r.userData))this.userData[h]=!f||f&&(f.isTexture||f.isObject3D)?f:JSON.parse(JSON.stringify(f));if(l===!0)for(let h=0;h<r.children.length;h++){const f=r.children[h];this.add(f.clone())}return this}}zi.DEFAULT_UP=new fe(0,1,0),zi.DEFAULT_MATRIX_AUTO_UPDATE=!0,zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Os=new fe,as=new fe,ha=new fe,Tr=new fe,mr=new fe,zc=new fe,Zi=new fe,Fd=new fe,mc=new fe,jd=new fe;let gh=!1;class Ls{constructor(r=new fe,l=new fe,h=new fe){this.a=r,this.b=l,this.c=h}static getNormal(r,l,h,f){f.subVectors(h,l),Os.subVectors(r,l),f.cross(Os);const v=f.lengthSq();return v>0?f.multiplyScalar(1/Math.sqrt(v)):f.set(0,0,0)}static getBarycoord(r,l,h,f,v){Os.subVectors(f,l),as.subVectors(h,l),ha.subVectors(r,l);const b=Os.dot(Os),E=Os.dot(as),D=Os.dot(ha),P=as.dot(as),O=as.dot(ha),F=b*P-E*E;if(F===0)return v.set(-2,-1,-1);const N=1/F,z=(P*D-E*O)*N,G=(b*O-E*D)*N;return v.set(1-z-G,G,z)}static containsPoint(r,l,h,f){return this.getBarycoord(r,l,h,f,Tr),Tr.x>=0&&Tr.y>=0&&Tr.x+Tr.y<=1}static getUV(r,l,h,f,v,b,E,D){return gh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),gh=!0),this.getInterpolation(r,l,h,f,v,b,E,D)}static getInterpolation(r,l,h,f,v,b,E,D){return this.getBarycoord(r,l,h,f,Tr),D.setScalar(0),D.addScaledVector(v,Tr.x),D.addScaledVector(b,Tr.y),D.addScaledVector(E,Tr.z),D}static isFrontFacing(r,l,h,f){return Os.subVectors(h,l),as.subVectors(r,l),Os.cross(as).dot(f)<0}set(r,l,h){return this.a.copy(r),this.b.copy(l),this.c.copy(h),this}setFromPointsAndIndices(r,l,h,f){return this.a.copy(r[l]),this.b.copy(r[h]),this.c.copy(r[f]),this}setFromAttributeAndIndices(r,l,h,f){return this.a.fromBufferAttribute(r,l),this.b.fromBufferAttribute(r,h),this.c.fromBufferAttribute(r,f),this}clone(){return new this.constructor().copy(this)}copy(r){return this.a.copy(r.a),this.b.copy(r.b),this.c.copy(r.c),this}getArea(){return Os.subVectors(this.c,this.b),as.subVectors(this.a,this.b),.5*Os.cross(as).length()}getMidpoint(r){return r.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(r){return Ls.getNormal(this.a,this.b,this.c,r)}getPlane(r){return r.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(r,l){return Ls.getBarycoord(r,this.a,this.b,this.c,l)}getUV(r,l,h,f,v){return gh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),gh=!0),Ls.getInterpolation(r,this.a,this.b,this.c,l,h,f,v)}getInterpolation(r,l,h,f,v){return Ls.getInterpolation(r,this.a,this.b,this.c,l,h,f,v)}containsPoint(r){return Ls.containsPoint(r,this.a,this.b,this.c)}isFrontFacing(r){return Ls.isFrontFacing(this.a,this.b,this.c,r)}intersectsBox(r){return r.intersectsTriangle(this)}closestPointToPoint(r,l){const h=this.a,f=this.b,v=this.c;let b,E;mr.subVectors(f,h),zc.subVectors(v,h),Fd.subVectors(r,h);const D=mr.dot(Fd),P=zc.dot(Fd);if(D<=0&&P<=0)return l.copy(h);mc.subVectors(r,f);const O=mr.dot(mc),F=zc.dot(mc);if(O>=0&&F<=O)return l.copy(f);const N=D*F-O*P;if(N<=0&&D>=0&&O<=0)return b=D/(D-O),l.copy(h).addScaledVector(mr,b);jd.subVectors(r,v);const z=mr.dot(jd),G=zc.dot(jd);if(G>=0&&z<=G)return l.copy(v);const W=z*P-D*G;if(W<=0&&P>=0&&G<=0)return E=P/(P-G),l.copy(h).addScaledVector(zc,E);const Q=O*G-z*F;if(Q<=0&&F-O>=0&&z-G>=0)return Zi.subVectors(v,f),E=(F-O)/(F-O+(z-G)),l.copy(f).addScaledVector(Zi,E);const q=1/(Q+W+N);return b=W*q,E=N*q,l.copy(h).addScaledVector(mr,b).addScaledVector(zc,E)}equals(r){return r.a.equals(this.a)&&r.b.equals(this.b)&&r.c.equals(this.c)}}let Dm=0;class ks extends Ml{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Dm++}),this.uuid=ss(),this.name="",this.type="Material",this.blending=At,this.side=et,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=wt,this.blendDst=_t,this.blendEquation=$,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ne,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ef,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Bi,this.stencilZFail=Bi,this.stencilZPass=Bi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const l in r){const h=r[l];if(h===void 0){console.warn(`THREE.Material: parameter '${l}' has value of undefined.`);continue}const f=this[l];f!==void 0&&(f&&f.isColor?f.set(h):f&&f.isVector3&&h&&h.isVector3?f.copy(h):Array.isArray(h)&&f&&typeof f.fromArray=="function"?f.fromArray(h):this[l]=h)}}toJSON(r){const l=r===void 0||typeof r=="string";l&&(r={textures:{},images:{}});const h={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function f(v){const b=[];for(const E in v){const D=v[E];delete D.metadata,b.push(D)}return b}if(h.uuid=this.uuid,h.type=this.type,this.name!==""&&(h.name=this.name),this.color&&this.color.isColor&&(h.color=this.color.getHex()),this.roughness!==void 0&&(h.roughness=this.roughness),this.metalness!==void 0&&(h.metalness=this.metalness),this.sheen!==void 0&&(h.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(h.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(h.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(h.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(h.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(h.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(h.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(h.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(h.shininess=this.shininess),this.clearcoat!==void 0&&(h.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(h.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(h.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(h.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(h.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,h.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(h.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(h.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(h.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(h.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(h.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(h.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(h.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(h.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(h.lightMap=this.lightMap.toJSON(r).uuid,h.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(h.aoMap=this.aoMap.toJSON(r).uuid,h.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(h.bumpMap=this.bumpMap.toJSON(r).uuid,h.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(h.normalMap=this.normalMap.toJSON(r).uuid,h.normalMapType=this.normalMapType,h.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(h.displacementMap=this.displacementMap.toJSON(r).uuid,h.displacementScale=this.displacementScale,h.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(h.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(h.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(h.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(h.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(h.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(h.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(h.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(h.combine=this.combine)),this.envMapIntensity!==void 0&&(h.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(h.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(h.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(h.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(h.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(h.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(h.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(h.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(h.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(h.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(h.size=this.size),this.shadowSide!==null&&(h.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(h.sizeAttenuation=this.sizeAttenuation),this.blending!==At&&(h.blending=this.blending),this.side!==et&&(h.side=this.side),this.vertexColors&&(h.vertexColors=!0),this.opacity<1&&(h.opacity=this.opacity),this.transparent===!0&&(h.transparent=this.transparent),h.depthFunc=this.depthFunc,h.depthTest=this.depthTest,h.depthWrite=this.depthWrite,h.colorWrite=this.colorWrite,h.stencilWrite=this.stencilWrite,h.stencilWriteMask=this.stencilWriteMask,h.stencilFunc=this.stencilFunc,h.stencilRef=this.stencilRef,h.stencilFuncMask=this.stencilFuncMask,h.stencilFail=this.stencilFail,h.stencilZFail=this.stencilZFail,h.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(h.rotation=this.rotation),this.polygonOffset===!0&&(h.polygonOffset=!0),this.polygonOffsetFactor!==0&&(h.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(h.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(h.linewidth=this.linewidth),this.dashSize!==void 0&&(h.dashSize=this.dashSize),this.gapSize!==void 0&&(h.gapSize=this.gapSize),this.scale!==void 0&&(h.scale=this.scale),this.dithering===!0&&(h.dithering=!0),this.alphaTest>0&&(h.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(h.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(h.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(h.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(h.wireframe=this.wireframe),this.wireframeLinewidth>1&&(h.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(h.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(h.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(h.flatShading=this.flatShading),this.visible===!1&&(h.visible=!1),this.toneMapped===!1&&(h.toneMapped=!1),this.fog===!1&&(h.fog=!1),Object.keys(this.userData).length>0&&(h.userData=this.userData),l){const v=f(r.textures),b=f(r.images);v.length>0&&(h.textures=v),b.length>0&&(h.images=b)}return h}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const l=r.clippingPlanes;let h=null;if(l!==null){const f=l.length;h=new Array(f);for(let v=0;v!==f;++v)h[v]=l[v].clone()}return this.clippingPlanes=h,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=da({},r.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}}function da(A,r){if(!r)return A;for(const l of Object.keys(r)){if(l.startsWith("__")||typeof A[l]=="function"||typeof r[l]=="function")continue;const h=r[l],f=!h||h.isTexture||h.isObject3D||h.isMaterial;f||typeof r[l].clone!="function"?f||typeof r[l]!="object"&&!Array.isArray(r[l])?A[l]=r[l]:A[l]=da(Array.isArray(r[l])?[]:{},r[l]):A[l]=r[l].clone()}return A}const Bm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Es={h:0,s:0,l:0},Vc={h:0,s:0,l:0};function ro(A,r,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?A+6*(r-A)*l:l<.5?r:l<2/3?A+6*(r-A)*(2/3-l):A}class xn{constructor(r,l,h){return this.isColor=!0,this.r=1,this.g=1,this.b=1,l===void 0&&h===void 0?this.set(r):this.setRGB(r,l,h)}set(r){return r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r),this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,l=Jn){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(255&r)/255,no.toWorkingColorSpace(this,l),this}setRGB(r,l,h,f=no.workingColorSpace){return this.r=r,this.g=l,this.b=h,no.toWorkingColorSpace(this,f),this}setHSL(r,l,h,f=no.workingColorSpace){if(r=lh(r,1),l=$i(l,0,1),h=$i(h,0,1),l===0)this.r=this.g=this.b=h;else{const v=h<=.5?h*(1+l):h+l-h*l,b=2*h-v;this.r=ro(b,v,r+1/3),this.g=ro(b,v,r),this.b=ro(b,v,r-1/3)}return no.toWorkingColorSpace(this,f),this}setStyle(r,l=Jn){function h(v){v!==void 0&&parseFloat(v)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let f;if(f=/^(\w+)\(([^\)]*)\)/.exec(r)){let v;const b=f[1],E=f[2];switch(b){case"rgb":case"rgba":if(v=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E))return h(v[4]),this.setRGB(Math.min(255,parseInt(v[1],10))/255,Math.min(255,parseInt(v[2],10))/255,Math.min(255,parseInt(v[3],10))/255,l);if(v=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E))return h(v[4]),this.setRGB(Math.min(100,parseInt(v[1],10))/100,Math.min(100,parseInt(v[2],10))/100,Math.min(100,parseInt(v[3],10))/100,l);break;case"hsl":case"hsla":if(v=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E))return h(v[4]),this.setHSL(parseFloat(v[1])/360,parseFloat(v[2])/100,parseFloat(v[3])/100,l);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(f=/^\#([A-Fa-f\d]+)$/.exec(r)){const v=f[1],b=v.length;if(b===3)return this.setRGB(parseInt(v.charAt(0),16)/15,parseInt(v.charAt(1),16)/15,parseInt(v.charAt(2),16)/15,l);if(b===6)return this.setHex(parseInt(v,16),l);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,l);return this}setColorName(r,l=Jn){const h=Bm[r.toLowerCase()];return h!==void 0?this.setHex(h,l):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=du(r.r),this.g=du(r.g),this.b=du(r.b),this}copyLinearToSRGB(r){return this.r=rf(r.r),this.g=rf(r.g),this.b=rf(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=Jn){return no.fromWorkingColorSpace(Ss.copy(this),r),65536*Math.round($i(255*Ss.r,0,255))+256*Math.round($i(255*Ss.g,0,255))+Math.round($i(255*Ss.b,0,255))}getHexString(r=Jn){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,l=no.workingColorSpace){no.fromWorkingColorSpace(Ss.copy(this),l);const h=Ss.r,f=Ss.g,v=Ss.b,b=Math.max(h,f,v),E=Math.min(h,f,v);let D,P;const O=(E+b)/2;if(E===b)D=0,P=0;else{const F=b-E;switch(P=O<=.5?F/(b+E):F/(2-b-E),b){case h:D=(f-v)/F+(f<v?6:0);break;case f:D=(v-h)/F+2;break;case v:D=(h-f)/F+4}D/=6}return r.h=D,r.s=P,r.l=O,r}getRGB(r,l=no.workingColorSpace){return no.fromWorkingColorSpace(Ss.copy(this),l),r.r=Ss.r,r.g=Ss.g,r.b=Ss.b,r}getStyle(r=Jn){no.fromWorkingColorSpace(Ss.copy(this),r);const l=Ss.r,h=Ss.g,f=Ss.b;return r!==Jn?`color(${r} ${l.toFixed(3)} ${h.toFixed(3)} ${f.toFixed(3)})`:`rgb(${Math.round(255*l)},${Math.round(255*h)},${Math.round(255*f)})`}offsetHSL(r,l,h){return this.getHSL(Es),Es.h+=r,Es.s+=l,Es.l+=h,this.setHSL(Es.h,Es.s,Es.l),this}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,l){return this.r=r.r+l.r,this.g=r.g+l.g,this.b=r.b+l.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,l){return this.r+=(r.r-this.r)*l,this.g+=(r.g-this.g)*l,this.b+=(r.b-this.b)*l,this}lerpColors(r,l,h){return this.r=r.r+(l.r-r.r)*h,this.g=r.g+(l.g-r.g)*h,this.b=r.b+(l.b-r.b)*h,this}lerpHSL(r,l){this.getHSL(Es),r.getHSL(Vc);const h=ch(Es.h,Vc.h,l),f=ch(Es.s,Vc.s,l),v=ch(Es.l,Vc.l,l);return this.setHSL(h,f,v),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const l=this.r,h=this.g,f=this.b,v=r.elements;return this.r=v[0]*l+v[3]*h+v[6]*f,this.g=v[1]*l+v[4]*h+v[7]*f,this.b=v[2]*l+v[5]*h+v[8]*f,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,l=0){return this.r=r[l],this.g=r[l+1],this.b=r[l+2],this}toArray(r=[],l=0){return r[l]=this.r,r[l+1]=this.g,r[l+2]=this.b,r}fromBufferAttribute(r,l){return this.r=r.getX(l),this.g=r.getY(l),this.b=r.getZ(l),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ss=new xn;xn.NAMES=Bm;class pa extends ks{constructor(r){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=In,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}}const Na=kv();function kv(){const A=new ArrayBuffer(4),r=new Float32Array(A),l=new Uint32Array(A),h=new Uint32Array(512),f=new Uint32Array(512);for(let D=0;D<256;++D){const P=D-127;P<-27?(h[D]=0,h[256|D]=32768,f[D]=24,f[256|D]=24):P<-14?(h[D]=1024>>-P-14,h[256|D]=1024>>-P-14|32768,f[D]=-P-1,f[256|D]=-P-1):P<=15?(h[D]=P+15<<10,h[256|D]=P+15<<10|32768,f[D]=13,f[256|D]=13):P<128?(h[D]=31744,h[256|D]=64512,f[D]=24,f[256|D]=24):(h[D]=31744,h[256|D]=64512,f[D]=13,f[256|D]=13)}const v=new Uint32Array(2048),b=new Uint32Array(64),E=new Uint32Array(64);for(let D=1;D<1024;++D){let P=D<<13,O=0;for(;!(8388608&P);)P<<=1,O-=8388608;P&=-8388609,O+=947912704,v[D]=P|O}for(let D=1024;D<2048;++D)v[D]=939524096+(D-1024<<13);for(let D=1;D<31;++D)b[D]=D<<23;b[31]=1199570944,b[32]=2147483648;for(let D=33;D<63;++D)b[D]=2147483648+(D-32<<23);b[63]=3347054592;for(let D=1;D<64;++D)D!==32&&(E[D]=1024);return{floatView:r,uint32View:l,baseTable:h,shiftTable:f,mantissaTable:v,exponentTable:b,offsetTable:E}}function Mo(A){Math.abs(A)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),A=$i(A,-65504,65504),Na.floatView[0]=A;const r=Na.uint32View[0],l=r>>23&511;return Na.baseTable[l]+((8388607&r)>>Na.shiftTable[l])}function Gc(A){const r=A>>10;return Na.uint32View[0]=Na.mantissaTable[Na.offsetTable[r]+(1023&A)]+Na.exponentTable[r],Na.floatView[0]}const uf={toHalfFloat:Mo,fromHalfFloat:Gc},rr=new fe,vh=new Ht;class tr{constructor(r,l,h=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=l,this.count=r!==void 0?r.length/l:0,this.normalized=h,this.usage=lc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this}copyAt(r,l,h){r*=this.itemSize,h*=l.itemSize;for(let f=0,v=this.itemSize;f<v;f++)this.array[r+f]=l.array[h+f];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let l=0,h=this.count;l<h;l++)vh.fromBufferAttribute(this,l),vh.applyMatrix3(r),this.setXY(l,vh.x,vh.y);else if(this.itemSize===3)for(let l=0,h=this.count;l<h;l++)rr.fromBufferAttribute(this,l),rr.applyMatrix3(r),this.setXYZ(l,rr.x,rr.y,rr.z);return this}applyMatrix4(r){for(let l=0,h=this.count;l<h;l++)rr.fromBufferAttribute(this,l),rr.applyMatrix4(r),this.setXYZ(l,rr.x,rr.y,rr.z);return this}applyNormalMatrix(r){for(let l=0,h=this.count;l<h;l++)rr.fromBufferAttribute(this,l),rr.applyNormalMatrix(r),this.setXYZ(l,rr.x,rr.y,rr.z);return this}transformDirection(r){for(let l=0,h=this.count;l<h;l++)rr.fromBufferAttribute(this,l),rr.transformDirection(r),this.setXYZ(l,rr.x,rr.y,rr.z);return this}set(r,l=0){return this.array.set(r,l),this}getX(r){let l=this.array[r*this.itemSize];return this.normalized&&(l=ia(l,this.array)),l}setX(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize]=l,this}getY(r){let l=this.array[r*this.itemSize+1];return this.normalized&&(l=ia(l,this.array)),l}setY(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize+1]=l,this}getZ(r){let l=this.array[r*this.itemSize+2];return this.normalized&&(l=ia(l,this.array)),l}setZ(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize+2]=l,this}getW(r){let l=this.array[r*this.itemSize+3];return this.normalized&&(l=ia(l,this.array)),l}setW(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize+3]=l,this}setXY(r,l,h){return r*=this.itemSize,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array)),this.array[r+0]=l,this.array[r+1]=h,this}setXYZ(r,l,h,f){return r*=this.itemSize,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array),f=Mi(f,this.array)),this.array[r+0]=l,this.array[r+1]=h,this.array[r+2]=f,this}setXYZW(r,l,h,f,v){return r*=this.itemSize,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array),f=Mi(f,this.array),v=Mi(v,this.array)),this.array[r+0]=l,this.array[r+1]=h,this.array[r+2]=f,this.array[r+3]=v,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==lc&&(r.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(r.updateRange=this.updateRange),r}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class hf extends tr{constructor(r,l,h){super(new Int8Array(r),l,h)}}class I0 extends tr{constructor(r,l,h){super(new Uint8Array(r),l,h)}}class P0 extends tr{constructor(r,l,h){super(new Uint8ClampedArray(r),l,h)}}class df extends tr{constructor(r,l,h){super(new Int16Array(r),l,h)}}class bu extends tr{constructor(r,l,h){super(new Uint16Array(r),l,h)}}class Om extends tr{constructor(r,l,h){super(new Int32Array(r),l,h)}}class pf extends tr{constructor(r,l,h){super(new Uint32Array(r),l,h)}}class ff extends tr{constructor(r,l,h){super(new Uint16Array(r),l,h),this.isFloat16BufferAttribute=!0}getX(r){let l=Gc(this.array[r*this.itemSize]);return this.normalized&&(l=ia(l,this.array)),l}setX(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize]=Mo(l),this}getY(r){let l=Gc(this.array[r*this.itemSize+1]);return this.normalized&&(l=ia(l,this.array)),l}setY(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize+1]=Mo(l),this}getZ(r){let l=Gc(this.array[r*this.itemSize+2]);return this.normalized&&(l=ia(l,this.array)),l}setZ(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize+2]=Mo(l),this}getW(r){let l=Gc(this.array[r*this.itemSize+3]);return this.normalized&&(l=ia(l,this.array)),l}setW(r,l){return this.normalized&&(l=Mi(l,this.array)),this.array[r*this.itemSize+3]=Mo(l),this}setXY(r,l,h){return r*=this.itemSize,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array)),this.array[r+0]=Mo(l),this.array[r+1]=Mo(h),this}setXYZ(r,l,h,f){return r*=this.itemSize,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array),f=Mi(f,this.array)),this.array[r+0]=Mo(l),this.array[r+1]=Mo(h),this.array[r+2]=Mo(f),this}setXYZW(r,l,h,f,v){return r*=this.itemSize,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array),f=Mi(f,this.array),v=Mi(v,this.array)),this.array[r+0]=Mo(l),this.array[r+1]=Mo(h),this.array[r+2]=Mo(f),this.array[r+3]=Mo(v),this}}class Pn extends tr{constructor(r,l,h){super(new Float32Array(r),l,h)}}class R0 extends tr{constructor(r,l,h){super(new Float64Array(r),l,h)}}let D0=0;const fa=new si,zd=new zi,B=new fe,y=new bo,S=new bo,U=new fe;class Y extends Ml{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:D0++}),this.uuid=ss(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(r){return Array.isArray(r)?this.index=new(ra(r)?pf:bu)(r,1):this.index=r,this}getAttribute(r){return this.attributes[r]}setAttribute(r,l){return this.attributes[r]=l,this}deleteAttribute(r){return delete this.attributes[r],this}hasAttribute(r){return this.attributes[r]!==void 0}addGroup(r,l,h=0){this.groups.push({start:r,count:l,materialIndex:h})}clearGroups(){this.groups=[]}setDrawRange(r,l){this.drawRange.start=r,this.drawRange.count=l}applyMatrix4(r){const l=this.attributes.position;l!==void 0&&(l.applyMatrix4(r),l.needsUpdate=!0);const h=this.attributes.normal;if(h!==void 0){const v=new bi().getNormalMatrix(r);h.applyNormalMatrix(v),h.needsUpdate=!0}const f=this.attributes.tangent;return f!==void 0&&(f.transformDirection(r),f.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(r){return fa.makeRotationFromQuaternion(r),this.applyMatrix4(fa),this}rotateX(r){return fa.makeRotationX(r),this.applyMatrix4(fa),this}rotateY(r){return fa.makeRotationY(r),this.applyMatrix4(fa),this}rotateZ(r){return fa.makeRotationZ(r),this.applyMatrix4(fa),this}translate(r,l,h){return fa.makeTranslation(r,l,h),this.applyMatrix4(fa),this}scale(r,l,h){return fa.makeScale(r,l,h),this.applyMatrix4(fa),this}lookAt(r){return zd.lookAt(r),zd.updateMatrix(),this.applyMatrix4(zd.matrix),this}center(r=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(B).negate(),this.translate(B.x,B.y,B.z),r&&r.copy(B),this}setFromPoints(r){const l=[];for(let h=0,f=r.length;h<f;h++){const v=r[h];l.push(v.x,v.y,v.z||0)}return this.setAttribute("position",new Pn(l,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new bo);const r=this.attributes.position,l=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new fe(-1/0,-1/0,-1/0),new fe(1/0,1/0,1/0));if(r!==void 0){if(this.boundingBox.setFromBufferAttribute(r),l)for(let h=0,f=l.length;h<f;h++){const v=l[h];y.setFromBufferAttribute(v),this.morphTargetsRelative?(U.addVectors(this.boundingBox.min,y.min),this.boundingBox.expandByPoint(U),U.addVectors(this.boundingBox.max,y.max),this.boundingBox.expandByPoint(U)):(this.boundingBox.expandByPoint(y.min),this.boundingBox.expandByPoint(y.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new la);const r=this.attributes.position,l=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new fe,1/0);if(r){const h=this.boundingSphere.center;if(y.setFromBufferAttribute(r),l)for(let v=0,b=l.length;v<b;v++){const E=l[v];S.setFromBufferAttribute(E),this.morphTargetsRelative?(U.addVectors(y.min,S.min),y.expandByPoint(U),U.addVectors(y.max,S.max),y.expandByPoint(U)):(y.expandByPoint(S.min),y.expandByPoint(S.max))}y.getCenter(h);let f=0;for(let v=0,b=r.count;v<b;v++)U.fromBufferAttribute(r,v),f=Math.max(f,h.distanceToSquared(U));if(l)for(let v=0,b=l.length;v<b;v++){const E=l[v],D=this.morphTargetsRelative;for(let P=0,O=E.count;P<O;P++)U.fromBufferAttribute(E,P),D&&(B.fromBufferAttribute(r,P),U.add(B)),f=Math.max(f,h.distanceToSquared(U))}this.boundingSphere.radius=Math.sqrt(f),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const r=this.index,l=this.attributes;if(r===null||l.position===void 0||l.normal===void 0||l.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const h=r.array,f=l.position.array,v=l.normal.array,b=l.uv.array,E=f.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new tr(new Float32Array(4*E),4));const D=this.getAttribute("tangent").array,P=[],O=[];for(let pt=0;pt<E;pt++)P[pt]=new fe,O[pt]=new fe;const F=new fe,N=new fe,z=new fe,G=new Ht,W=new Ht,Q=new Ht,q=new fe,K=new fe;function ne(pt,ke,Mt){F.fromArray(f,3*pt),N.fromArray(f,3*ke),z.fromArray(f,3*Mt),G.fromArray(b,2*pt),W.fromArray(b,2*ke),Q.fromArray(b,2*Mt),N.sub(F),z.sub(F),W.sub(G),Q.sub(G);const Ot=1/(W.x*Q.y-Q.x*W.y);isFinite(Ot)&&(q.copy(N).multiplyScalar(Q.y).addScaledVector(z,-W.y).multiplyScalar(Ot),K.copy(z).multiplyScalar(W.x).addScaledVector(N,-Q.x).multiplyScalar(Ot),P[pt].add(q),P[ke].add(q),P[Mt].add(q),O[pt].add(K),O[ke].add(K),O[Mt].add(K))}let be=this.groups;be.length===0&&(be=[{start:0,count:h.length}]);for(let pt=0,ke=be.length;pt<ke;++pt){const Mt=be[pt],Ot=Mt.start;for(let tn=Ot,An=Ot+Mt.count;tn<An;tn+=3)ne(h[tn+0],h[tn+1],h[tn+2])}const ve=new fe,me=new fe,Pe=new fe,tt=new fe;function Oe(pt){Pe.fromArray(v,3*pt),tt.copy(Pe);const ke=P[pt];ve.copy(ke),ve.sub(Pe.multiplyScalar(Pe.dot(ke))).normalize(),me.crossVectors(tt,ke);const Mt=me.dot(O[pt])<0?-1:1;D[4*pt]=ve.x,D[4*pt+1]=ve.y,D[4*pt+2]=ve.z,D[4*pt+3]=Mt}for(let pt=0,ke=be.length;pt<ke;++pt){const Mt=be[pt],Ot=Mt.start;for(let tn=Ot,An=Ot+Mt.count;tn<An;tn+=3)Oe(h[tn+0]),Oe(h[tn+1]),Oe(h[tn+2])}}computeVertexNormals(){const r=this.index,l=this.getAttribute("position");if(l!==void 0){let h=this.getAttribute("normal");if(h===void 0)h=new tr(new Float32Array(3*l.count),3),this.setAttribute("normal",h);else for(let N=0,z=h.count;N<z;N++)h.setXYZ(N,0,0,0);const f=new fe,v=new fe,b=new fe,E=new fe,D=new fe,P=new fe,O=new fe,F=new fe;if(r)for(let N=0,z=r.count;N<z;N+=3){const G=r.getX(N+0),W=r.getX(N+1),Q=r.getX(N+2);f.fromBufferAttribute(l,G),v.fromBufferAttribute(l,W),b.fromBufferAttribute(l,Q),O.subVectors(b,v),F.subVectors(f,v),O.cross(F),E.fromBufferAttribute(h,G),D.fromBufferAttribute(h,W),P.fromBufferAttribute(h,Q),E.add(O),D.add(O),P.add(O),h.setXYZ(G,E.x,E.y,E.z),h.setXYZ(W,D.x,D.y,D.z),h.setXYZ(Q,P.x,P.y,P.z)}else for(let N=0,z=l.count;N<z;N+=3)f.fromBufferAttribute(l,N+0),v.fromBufferAttribute(l,N+1),b.fromBufferAttribute(l,N+2),O.subVectors(b,v),F.subVectors(f,v),O.cross(F),h.setXYZ(N+0,O.x,O.y,O.z),h.setXYZ(N+1,O.x,O.y,O.z),h.setXYZ(N+2,O.x,O.y,O.z);this.normalizeNormals(),h.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const r=this.attributes.normal;for(let l=0,h=r.count;l<h;l++)U.fromBufferAttribute(r,l),U.normalize(),r.setXYZ(l,U.x,U.y,U.z)}toNonIndexed(){function r(E,D){const P=E.array,O=E.itemSize,F=E.normalized,N=new P.constructor(D.length*O);let z=0,G=0;for(let W=0,Q=D.length;W<Q;W++){z=E.isInterleavedBufferAttribute?D[W]*E.data.stride+E.offset:D[W]*O;for(let q=0;q<O;q++)N[G++]=P[z++]}return new tr(N,O,F)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const l=new Y,h=this.index.array,f=this.attributes;for(const E in f){const D=r(f[E],h);l.setAttribute(E,D)}const v=this.morphAttributes;for(const E in v){const D=[],P=v[E];for(let O=0,F=P.length;O<F;O++){const N=r(P[O],h);D.push(N)}l.morphAttributes[E]=D}l.morphTargetsRelative=this.morphTargetsRelative;const b=this.groups;for(let E=0,D=b.length;E<D;E++){const P=b[E];l.addGroup(P.start,P.count,P.materialIndex)}return l}toJSON(){const r={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),Object.keys(this.userData).length>0&&(r.userData=this.userData),this.parameters!==void 0){const D=this.parameters;for(const P in D)D[P]!==void 0&&(r[P]=D[P]);return r}r.data={attributes:{}};const l=this.index;l!==null&&(r.data.index={type:l.array.constructor.name,array:Array.prototype.slice.call(l.array)});const h=this.attributes;for(const D in h){const P=h[D];r.data.attributes[D]=P.toJSON(r.data)}const f={};let v=!1;for(const D in this.morphAttributes){const P=this.morphAttributes[D],O=[];for(let F=0,N=P.length;F<N;F++){const z=P[F];O.push(z.toJSON(r.data))}O.length>0&&(f[D]=O,v=!0)}v&&(r.data.morphAttributes=f,r.data.morphTargetsRelative=this.morphTargetsRelative);const b=this.groups;b.length>0&&(r.data.groups=JSON.parse(JSON.stringify(b)));const E=this.boundingSphere;return E!==null&&(r.data.boundingSphere={center:E.center.toArray(),radius:E.radius}),r}clone(){return new this.constructor().copy(this)}copy(r){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const l={};this.name=r.name;const h=r.index;h!==null&&this.setIndex(h.clone(l));const f=r.attributes;for(const P in f){const O=f[P];this.setAttribute(P,O.clone(l))}const v=r.morphAttributes;for(const P in v){const O=[],F=v[P];for(let N=0,z=F.length;N<z;N++)O.push(F[N].clone(l));this.morphAttributes[P]=O}this.morphTargetsRelative=r.morphTargetsRelative;const b=r.groups;for(let P=0,O=b.length;P<O;P++){const F=b[P];this.addGroup(F.start,F.count,F.materialIndex)}const E=r.boundingBox;E!==null&&(this.boundingBox=E.clone());const D=r.boundingSphere;return D!==null&&(this.boundingSphere=D.clone()),this.drawRange.start=r.drawRange.start,this.drawRange.count=r.drawRange.count,this.userData=r.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ye=new si,xe=new io,dt=new la,Jt=new fe,bn=new fe,oi=new fe,yr=new fe,Xr=new fe,jr=new fe,ma=new Ht,rl=new Ht,_h=new Ht,mf=new fe,Vd=new fe,Gd=new fe,yh=new fe,Hd=new fe;class Us extends zi{constructor(r=new Y,l=new pa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=l,this.updateMorphTargets()}copy(r,l){return super.copy(r,l),r.isMesh?(r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=r.material,this.geometry=r.geometry,this):this}updateMorphTargets(){const r=this.geometry.morphAttributes,l=Object.keys(r);if(l.length>0){const h=r[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,v=h.length;f<v;f++){const b=h[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=f}}}}getVertexPosition(r,l){const h=this.geometry,f=h.attributes.position,v=h.morphAttributes.position,b=h.morphTargetsRelative;l.fromBufferAttribute(f,r);const E=this.morphTargetInfluences;if(v&&E){jr.set(0,0,0);for(let D=0,P=v.length;D<P;D++){const O=E[D],F=v[D];O!==0&&(Xr.fromBufferAttribute(F,r),b?jr.addScaledVector(Xr,O):jr.addScaledVector(Xr.sub(l),O))}l.add(jr)}return l}raycast(r,l){const h=this.geometry,f=this.material,v=this.matrixWorld;if(f!==void 0){if(h.boundingSphere===null&&h.computeBoundingSphere(),dt.copy(h.boundingSphere),dt.applyMatrix4(v),xe.copy(r.ray).recast(r.near),dt.containsPoint(xe.origin)===!1&&(xe.intersectSphere(dt,Jt)===null||xe.origin.distanceToSquared(Jt)>(r.far-r.near)**2))return;ye.copy(v).invert(),xe.copy(r.ray).applyMatrix4(ye),h.boundingBox!==null&&xe.intersectsBox(h.boundingBox)===!1||this._computeIntersections(r,l)}}_computeIntersections(r,l){let h;const f=this.geometry,v=this.material,b=f.index,E=f.attributes.position,D=f.attributes.uv,P=f.attributes.uv1,O=f.attributes.normal,F=f.groups,N=f.drawRange;if(b!==null)if(Array.isArray(v))for(let z=0,G=F.length;z<G;z++){const W=F[z],Q=v[W.materialIndex];for(let q=Math.max(W.start,N.start),K=Math.min(b.count,Math.min(W.start+W.count,N.start+N.count));q<K;q+=3){const ne=b.getX(q),be=b.getX(q+1),ve=b.getX(q+2);h=Uv(this,Q,r,xe,D,P,O,ne,be,ve),h&&(h.faceIndex=Math.floor(q/3),h.face.materialIndex=W.materialIndex,l.push(h))}}else for(let z=Math.max(0,N.start),G=Math.min(b.count,N.start+N.count);z<G;z+=3){const W=b.getX(z),Q=b.getX(z+1),q=b.getX(z+2);h=Uv(this,v,r,xe,D,P,O,W,Q,q),h&&(h.faceIndex=Math.floor(z/3),l.push(h))}else if(E!==void 0)if(Array.isArray(v))for(let z=0,G=F.length;z<G;z++){const W=F[z],Q=v[W.materialIndex];for(let q=Math.max(W.start,N.start),K=Math.min(E.count,Math.min(W.start+W.count,N.start+N.count));q<K;q+=3)h=Uv(this,Q,r,xe,D,P,O,q,q+1,q+2),h&&(h.faceIndex=Math.floor(q/3),h.face.materialIndex=W.materialIndex,l.push(h))}else for(let z=Math.max(0,N.start),G=Math.min(E.count,N.start+N.count);z<G;z+=3)h=Uv(this,v,r,xe,D,P,O,z,z+1,z+2),h&&(h.faceIndex=Math.floor(z/3),l.push(h))}}function Uv(A,r,l,h,f,v,b,E,D,P){A.getVertexPosition(E,bn),A.getVertexPosition(D,oi),A.getVertexPosition(P,yr);const O=function(F,N,z,G,W,Q,q,K){let ne;if(ne=N.side===Ce?G.intersectTriangle(q,Q,W,!0,K):G.intersectTriangle(W,Q,q,N.side===et,K),ne===null)return null;Hd.copy(K),Hd.applyMatrix4(F.matrixWorld);const be=z.ray.origin.distanceTo(Hd);return be<z.near||be>z.far?null:{distance:be,point:Hd.clone(),object:F}}(A,r,l,h,bn,oi,yr,yh);if(O){f&&(ma.fromBufferAttribute(f,E),rl.fromBufferAttribute(f,D),_h.fromBufferAttribute(f,P),O.uv=Ls.getInterpolation(yh,bn,oi,yr,ma,rl,_h,new Ht)),v&&(ma.fromBufferAttribute(v,E),rl.fromBufferAttribute(v,D),_h.fromBufferAttribute(v,P),O.uv1=Ls.getInterpolation(yh,bn,oi,yr,ma,rl,_h,new Ht),O.uv2=O.uv1),b&&(mf.fromBufferAttribute(b,E),Vd.fromBufferAttribute(b,D),Gd.fromBufferAttribute(b,P),O.normal=Ls.getInterpolation(yh,bn,oi,yr,mf,Vd,Gd,new fe),O.normal.dot(h.direction)>0&&O.normal.multiplyScalar(-1));const F={a:E,b:D,c:P,normal:new fe,materialIndex:0};Ls.getNormal(bn,oi,yr,F.normal),O.face=F}return O}class wu extends Y{constructor(r=1,l=1,h=1,f=1,v=1,b=1){super(),this.type="BoxGeometry",this.parameters={width:r,height:l,depth:h,widthSegments:f,heightSegments:v,depthSegments:b};const E=this;f=Math.floor(f),v=Math.floor(v),b=Math.floor(b);const D=[],P=[],O=[],F=[];let N=0,z=0;function G(W,Q,q,K,ne,be,ve,me,Pe,tt,Oe){const pt=be/Pe,ke=ve/tt,Mt=be/2,Ot=ve/2,tn=me/2,An=Pe+1,nn=tt+1;let Xt=0,dn=0;const gn=new fe;for(let xt=0;xt<nn;xt++){const Wt=xt*ke-Ot;for(let un=0;un<An;un++){const Zt=un*pt-Mt;gn[W]=Zt*K,gn[Q]=Wt*ne,gn[q]=tn,P.push(gn.x,gn.y,gn.z),gn[W]=0,gn[Q]=0,gn[q]=me>0?1:-1,O.push(gn.x,gn.y,gn.z),F.push(un/Pe),F.push(1-xt/tt),Xt+=1}}for(let xt=0;xt<tt;xt++)for(let Wt=0;Wt<Pe;Wt++){const un=N+Wt+An*xt,Zt=N+Wt+An*(xt+1),_n=N+(Wt+1)+An*(xt+1),ai=N+(Wt+1)+An*xt;D.push(un,Zt,ai),D.push(Zt,_n,ai),dn+=6}E.addGroup(z,dn,Oe),z+=dn,N+=Xt}G("z","y","x",-1,-1,h,l,r,b,v,0),G("z","y","x",1,-1,h,l,-r,b,v,1),G("x","z","y",1,1,r,h,l,f,b,2),G("x","z","y",1,-1,r,h,-l,f,b,3),G("x","y","z",1,-1,r,l,h,f,v,4),G("x","y","z",-1,-1,r,l,-h,f,v,5),this.setIndex(D),this.setAttribute("position",new Pn(P,3)),this.setAttribute("normal",new Pn(O,3)),this.setAttribute("uv",new Pn(F,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new wu(r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments)}}function Qd(A){const r={};for(const l in A){r[l]={};for(const h in A[l]){const f=A[l][h];f&&(f.isColor||f.isMatrix3||f.isMatrix4||f.isVector2||f.isVector3||f.isVector4||f.isTexture||f.isQuaternion)?f.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),r[l][h]=null):r[l][h]=f.clone():Array.isArray(f)?r[l][h]=f.slice():r[l][h]=f}}return r}function Ws(A){const r={};for(let l=0;l<A.length;l++){const h=Qd(A[l]);for(const f in h)r[f]=h[f]}return r}function Nv(A){return A.getRenderTarget()===null?A.outputColorSpace:fr}const B0={clone:Qd,merge:Ws};class sl extends ks{constructor(r){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&this.setValues(r)}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=Qd(r.uniforms),this.uniformsGroups=function(l){const h=[];for(let f=0;f<l.length;f++)h.push(l[f].clone());return h}(r.uniformsGroups),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.fog=r.fog,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const l=super.toJSON(r);l.glslVersion=this.glslVersion,l.uniforms={};for(const f in this.uniforms){const v=this.uniforms[f].value;v&&v.isTexture?l.uniforms[f]={type:"t",value:v.toJSON(r).uuid}:v&&v.isColor?l.uniforms[f]={type:"c",value:v.getHex()}:v&&v.isVector2?l.uniforms[f]={type:"v2",value:v.toArray()}:v&&v.isVector3?l.uniforms[f]={type:"v3",value:v.toArray()}:v&&v.isVector4?l.uniforms[f]={type:"v4",value:v.toArray()}:v&&v.isMatrix3?l.uniforms[f]={type:"m3",value:v.toArray()}:v&&v.isMatrix4?l.uniforms[f]={type:"m4",value:v.toArray()}:l.uniforms[f]={value:v}}Object.keys(this.defines).length>0&&(l.defines=this.defines),l.vertexShader=this.vertexShader,l.fragmentShader=this.fragmentShader,l.lights=this.lights,l.clipping=this.clipping;const h={};for(const f in this.extensions)this.extensions[f]===!0&&(h[f]=!0);return Object.keys(h).length>0&&(l.extensions=h),l}}class Lm extends zi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new si,this.projectionMatrix=new si,this.projectionMatrixInverse=new si}copy(r,l){return super.copy(r,l),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return r.set(-l[8],-l[9],-l[10]).normalize()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,l){super.updateWorldMatrix(r,l),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class so extends Lm{constructor(r=50,l=1,h=.1,f=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=h,this.far=f,this.focus=10,this.aspect=l,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,l){return super.copy(r,l),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const l=.5*this.getFilmHeight()/r;this.fov=2*La*Math.atan(l),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(.5*na*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return 2*La*Math.atan(Math.tan(.5*na*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(r,l,h,f,v,b){this.aspect=r/l,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=l,this.view.offsetX=h,this.view.offsetY=f,this.view.width=v,this.view.height=b,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let l=r*Math.tan(.5*na*this.fov)/this.zoom,h=2*l,f=this.aspect*h,v=-.5*f;const b=this.view;if(this.view!==null&&this.view.enabled){const D=b.fullWidth,P=b.fullHeight;v+=b.offsetX*f/D,l-=b.offsetY*h/P,f*=b.width/D,h*=b.height/P}const E=this.filmOffset;E!==0&&(v+=r*E/this.getFilmWidth()),this.projectionMatrix.makePerspective(v,v+f,l,l-h,r,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const l=super.toJSON(r);return l.object.fov=this.fov,l.object.zoom=this.zoom,l.object.near=this.near,l.object.far=this.far,l.object.focus=this.focus,l.object.aspect=this.aspect,this.view!==null&&(l.object.view=Object.assign({},this.view)),l.object.filmGauge=this.filmGauge,l.object.filmOffset=this.filmOffset,l}}const Qt=-90;class O0 extends zi{constructor(r,l,h){super(),this.type="CubeCamera",this.renderTarget=h;const f=new so(Qt,1,r,l);f.layers=this.layers,f.up.set(0,1,0),f.lookAt(1,0,0),this.add(f);const v=new so(Qt,1,r,l);v.layers=this.layers,v.up.set(0,1,0),v.lookAt(-1,0,0),this.add(v);const b=new so(Qt,1,r,l);b.layers=this.layers,b.up.set(0,0,-1),b.lookAt(0,1,0),this.add(b);const E=new so(Qt,1,r,l);E.layers=this.layers,E.up.set(0,0,1),E.lookAt(0,-1,0),this.add(E);const D=new so(Qt,1,r,l);D.layers=this.layers,D.up.set(0,1,0),D.lookAt(0,0,1),this.add(D);const P=new so(Qt,1,r,l);P.layers=this.layers,P.up.set(0,1,0),P.lookAt(0,0,-1),this.add(P)}update(r,l){this.parent===null&&this.updateMatrixWorld();const h=this.renderTarget,[f,v,b,E,D,P]=this.children,O=r.getRenderTarget(),F=r.toneMapping,N=r.xr.enabled;r.toneMapping=Ki,r.xr.enabled=!1;const z=h.texture.generateMipmaps;h.texture.generateMipmaps=!1,r.setRenderTarget(h,0),r.render(l,f),r.setRenderTarget(h,1),r.render(l,v),r.setRenderTarget(h,2),r.render(l,b),r.setRenderTarget(h,3),r.render(l,E),r.setRenderTarget(h,4),r.render(l,D),h.texture.generateMipmaps=z,r.setRenderTarget(h,5),r.render(l,P),r.setRenderTarget(O),r.toneMapping=F,r.xr.enabled=N,h.texture.needsPMREMUpdate=!0}}class gc extends Or{constructor(r,l,h,f,v,b,E,D,P,O){super(r=r!==void 0?r:[],l=l!==void 0?l:Ae,h,f,v,b,E,D,P,O),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(r){this.image=r}}class Fv extends yo{constructor(r=1,l={}){super(r,r,l),this.isWebGLCubeRenderTarget=!0;const h={width:r,height:r,depth:1},f=[h,h,h,h,h,h];l.encoding!==void 0&&(uh("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),l.colorSpace=l.encoding===Cl?Jn:ta),this.texture=new gc(f,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=l.generateMipmaps!==void 0&&l.generateMipmaps,this.texture.minFilter=l.minFilter!==void 0?l.minFilter:_r}fromEquirectangularTexture(r,l){this.texture.type=l.type,this.texture.colorSpace=l.colorSpace,this.texture.generateMipmaps=l.generateMipmaps,this.texture.minFilter=l.minFilter,this.texture.magFilter=l.magFilter;const h={tEquirect:{value:null}},f=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,v=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,b=new wu(5,5,5),E=new sl({name:"CubemapFromEquirect",uniforms:Qd(h),vertexShader:f,fragmentShader:v,side:Ce,blending:Ue});E.uniforms.tEquirect.value=l;const D=new Us(b,E),P=l.minFilter;return l.minFilter===bl&&(l.minFilter=_r),new O0(1,10,this).update(r,D),l.minFilter=P,D.geometry.dispose(),D.material.dispose(),this}clear(r,l,h,f){const v=r.getRenderTarget();for(let b=0;b<6;b++)r.setRenderTarget(this,b),r.clear(l,h,f);r.setRenderTarget(v)}}const Ah=new fe,ol=new fe,jv=new bi;class bh{constructor(r=new fe(1,0,0),l=0){this.isPlane=!0,this.normal=r,this.constant=l}set(r,l){return this.normal.copy(r),this.constant=l,this}setComponents(r,l,h,f){return this.normal.set(r,l,h),this.constant=f,this}setFromNormalAndCoplanarPoint(r,l){return this.normal.copy(r),this.constant=-l.dot(this.normal),this}setFromCoplanarPoints(r,l,h){const f=Ah.subVectors(h,l).cross(ol.subVectors(r,l)).normalize();return this.setFromNormalAndCoplanarPoint(f,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,l){return l.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,l){const h=r.delta(Ah),f=this.normal.dot(h);if(f===0)return this.distanceToPoint(r.start)===0?l.copy(r.start):null;const v=-(r.start.dot(this.normal)+this.constant)/f;return v<0||v>1?null:l.copy(r.start).addScaledVector(h,v)}intersectsLine(r){const l=this.distanceToPoint(r.start),h=this.distanceToPoint(r.end);return l<0&&h>0||h<0&&l>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,l){const h=l||jv.getNormalMatrix(r),f=this.coplanarPoint(Ah).applyMatrix4(r),v=this.normal.applyMatrix3(h).normalize();return this.constant=-f.dot(v),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Wd=new la,Fa=new fe;class km{constructor(r=new bh,l=new bh,h=new bh,f=new bh,v=new bh,b=new bh){this.planes=[r,l,h,f,v,b]}set(r,l,h,f,v,b){const E=this.planes;return E[0].copy(r),E[1].copy(l),E[2].copy(h),E[3].copy(f),E[4].copy(v),E[5].copy(b),this}copy(r){const l=this.planes;for(let h=0;h<6;h++)l[h].copy(r.planes[h]);return this}setFromProjectionMatrix(r){const l=this.planes,h=r.elements,f=h[0],v=h[1],b=h[2],E=h[3],D=h[4],P=h[5],O=h[6],F=h[7],N=h[8],z=h[9],G=h[10],W=h[11],Q=h[12],q=h[13],K=h[14],ne=h[15];return l[0].setComponents(E-f,F-D,W-N,ne-Q).normalize(),l[1].setComponents(E+f,F+D,W+N,ne+Q).normalize(),l[2].setComponents(E+v,F+P,W+z,ne+q).normalize(),l[3].setComponents(E-v,F-P,W-z,ne-q).normalize(),l[4].setComponents(E-b,F-O,W-G,ne-K).normalize(),l[5].setComponents(E+b,F+O,W+G,ne+K).normalize(),this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),Wd.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const l=r.geometry;l.boundingSphere===null&&l.computeBoundingSphere(),Wd.copy(l.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(Wd)}intersectsSprite(r){return Wd.center.set(0,0,0),Wd.radius=.7071067811865476,Wd.applyMatrix4(r.matrixWorld),this.intersectsSphere(Wd)}intersectsSphere(r){const l=this.planes,h=r.center,f=-r.radius;for(let v=0;v<6;v++)if(l[v].distanceToPoint(h)<f)return!1;return!0}intersectsBox(r){const l=this.planes;for(let h=0;h<6;h++){const f=l[h];if(Fa.x=f.normal.x>0?r.max.x:r.min.x,Fa.y=f.normal.y>0?r.max.y:r.min.y,Fa.z=f.normal.z>0?r.max.z:r.min.z,f.distanceToPoint(Fa)<0)return!1}return!0}containsPoint(r){const l=this.planes;for(let h=0;h<6;h++)if(l[h].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Hc(){let A=null,r=!1,l=null,h=null;function f(v,b){l(v,b),h=A.requestAnimationFrame(f)}return{start:function(){r!==!0&&l!==null&&(h=A.requestAnimationFrame(f),r=!0)},stop:function(){A.cancelAnimationFrame(h),r=!1},setAnimationLoop:function(v){l=v},setContext:function(v){A=v}}}function zv(A,r){const l=r.isWebGL2,h=new WeakMap;return{get:function(f){return f.isInterleavedBufferAttribute&&(f=f.data),h.get(f)},remove:function(f){f.isInterleavedBufferAttribute&&(f=f.data);const v=h.get(f);v&&(A.deleteBuffer(v.buffer),h.delete(f))},update:function(f,v){if(f.isGLBufferAttribute){const E=h.get(f);return void((!E||E.version<f.version)&&h.set(f,{buffer:f.buffer,type:f.type,bytesPerElement:f.elementSize,version:f.version}))}f.isInterleavedBufferAttribute&&(f=f.data);const b=h.get(f);b===void 0?h.set(f,function(E,D){const P=E.array,O=E.usage,F=A.createBuffer();let N;if(A.bindBuffer(D,F),A.bufferData(D,P,O),E.onUploadCallback(),P instanceof Float32Array)N=A.FLOAT;else if(P instanceof Uint16Array)if(E.isFloat16BufferAttribute){if(!l)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");N=A.HALF_FLOAT}else N=A.UNSIGNED_SHORT;else if(P instanceof Int16Array)N=A.SHORT;else if(P instanceof Uint32Array)N=A.UNSIGNED_INT;else if(P instanceof Int32Array)N=A.INT;else if(P instanceof Int8Array)N=A.BYTE;else if(P instanceof Uint8Array)N=A.UNSIGNED_BYTE;else{if(!(P instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+P);N=A.UNSIGNED_BYTE}return{buffer:F,type:N,bytesPerElement:P.BYTES_PER_ELEMENT,version:E.version}}(f,v)):b.version<f.version&&(function(E,D,P){const O=D.array,F=D.updateRange;A.bindBuffer(P,E),F.count===-1?A.bufferSubData(P,0,O):(l?A.bufferSubData(P,F.offset*O.BYTES_PER_ELEMENT,O,F.offset,F.count):A.bufferSubData(P,F.offset*O.BYTES_PER_ELEMENT,O.subarray(F.offset,F.offset+F.count)),F.count=-1),D.onUploadCallback()}(b.buffer,f,v),b.version=f.version)}}}class qd extends Y{constructor(r=1,l=1,h=1,f=1){super(),this.type="PlaneGeometry",this.parameters={width:r,height:l,widthSegments:h,heightSegments:f};const v=r/2,b=l/2,E=Math.floor(h),D=Math.floor(f),P=E+1,O=D+1,F=r/E,N=l/D,z=[],G=[],W=[],Q=[];for(let q=0;q<O;q++){const K=q*N-b;for(let ne=0;ne<P;ne++){const be=ne*F-v;G.push(be,-K,0),W.push(0,0,1),Q.push(ne/E),Q.push(1-q/D)}}for(let q=0;q<D;q++)for(let K=0;K<E;K++){const ne=K+P*q,be=K+P*(q+1),ve=K+1+P*(q+1),me=K+1+P*q;z.push(ne,be,me),z.push(be,ve,me)}this.setIndex(z),this.setAttribute("position",new Pn(G,3)),this.setAttribute("normal",new Pn(W,3)),this.setAttribute("uv",new Pn(Q,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new qd(r.width,r.height,r.widthSegments,r.heightSegments)}}const hi={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},mn={common:{diffuse:{value:new xn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new bi},alphaMap:{value:null},alphaMapTransform:{value:new bi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new bi}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new bi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new bi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new bi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new bi},normalScale:{value:new Ht(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new bi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new bi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new bi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new bi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new xn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new xn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new bi}},sprite:{diffuse:{value:new xn(16777215)},opacity:{value:1},center:{value:new Ht(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new bi},alphaMap:{value:null},alphaTest:{value:0}}},ga={basic:{uniforms:Ws([mn.common,mn.specularmap,mn.envmap,mn.aomap,mn.lightmap,mn.fog]),vertexShader:hi.meshbasic_vert,fragmentShader:hi.meshbasic_frag},lambert:{uniforms:Ws([mn.common,mn.specularmap,mn.envmap,mn.aomap,mn.lightmap,mn.emissivemap,mn.bumpmap,mn.normalmap,mn.displacementmap,mn.fog,mn.lights,{emissive:{value:new xn(0)}}]),vertexShader:hi.meshlambert_vert,fragmentShader:hi.meshlambert_frag},phong:{uniforms:Ws([mn.common,mn.specularmap,mn.envmap,mn.aomap,mn.lightmap,mn.emissivemap,mn.bumpmap,mn.normalmap,mn.displacementmap,mn.fog,mn.lights,{emissive:{value:new xn(0)},specular:{value:new xn(1118481)},shininess:{value:30}}]),vertexShader:hi.meshphong_vert,fragmentShader:hi.meshphong_frag},standard:{uniforms:Ws([mn.common,mn.envmap,mn.aomap,mn.lightmap,mn.emissivemap,mn.bumpmap,mn.normalmap,mn.displacementmap,mn.roughnessmap,mn.metalnessmap,mn.fog,mn.lights,{emissive:{value:new xn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:hi.meshphysical_vert,fragmentShader:hi.meshphysical_frag},toon:{uniforms:Ws([mn.common,mn.aomap,mn.lightmap,mn.emissivemap,mn.bumpmap,mn.normalmap,mn.displacementmap,mn.gradientmap,mn.fog,mn.lights,{emissive:{value:new xn(0)}}]),vertexShader:hi.meshtoon_vert,fragmentShader:hi.meshtoon_frag},matcap:{uniforms:Ws([mn.common,mn.bumpmap,mn.normalmap,mn.displacementmap,mn.fog,{matcap:{value:null}}]),vertexShader:hi.meshmatcap_vert,fragmentShader:hi.meshmatcap_frag},points:{uniforms:Ws([mn.points,mn.fog]),vertexShader:hi.points_vert,fragmentShader:hi.points_frag},dashed:{uniforms:Ws([mn.common,mn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:hi.linedashed_vert,fragmentShader:hi.linedashed_frag},depth:{uniforms:Ws([mn.common,mn.displacementmap]),vertexShader:hi.depth_vert,fragmentShader:hi.depth_frag},normal:{uniforms:Ws([mn.common,mn.bumpmap,mn.normalmap,mn.displacementmap,{opacity:{value:1}}]),vertexShader:hi.meshnormal_vert,fragmentShader:hi.meshnormal_frag},sprite:{uniforms:Ws([mn.sprite,mn.fog]),vertexShader:hi.sprite_vert,fragmentShader:hi.sprite_frag},background:{uniforms:{uvTransform:{value:new bi},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new xn(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:hi.background_vert,fragmentShader:hi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:hi.backgroundCube_vert,fragmentShader:hi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:hi.cube_vert,fragmentShader:hi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:hi.equirect_vert,fragmentShader:hi.equirect_frag},distanceRGBA:{uniforms:Ws([mn.common,mn.displacementmap,{referencePosition:{value:new fe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:hi.distanceRGBA_vert,fragmentShader:hi.distanceRGBA_frag},shadow:{uniforms:Ws([mn.lights,mn.fog,{color:{value:new xn(0)},opacity:{value:1}}]),vertexShader:hi.shadow_vert,fragmentShader:hi.shadow_frag}};ga.physical={uniforms:Ws([ga.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new bi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new bi},clearcoatNormalScale:{value:new Ht(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new bi},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new bi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new bi},sheen:{value:0},sheenColor:{value:new xn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new bi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new bi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new bi},transmissionSamplerSize:{value:new Ht},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new bi},attenuationDistance:{value:0},attenuationColor:{value:new xn(0)},specularColor:{value:new xn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new bi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new bi}}]),vertexShader:hi.meshphysical_vert,fragmentShader:hi.meshphysical_frag};const ja={r:0,b:0,g:0};function Um(A,r,l,h,f,v,b){const E=new xn(0);let D,P,O=v===!0?0:1,F=null,N=0,z=null;function G(W,Q){W.getRGB(ja,Nv(A)),h.buffers.color.setClear(ja.r,ja.g,ja.b,Q,b)}return{getClearColor:function(){return E},setClearColor:function(W,Q=1){E.set(W),O=Q,G(E,O)},getClearAlpha:function(){return O},setClearAlpha:function(W){O=W,G(E,O)},getPlaneMesh:function(){return D},getBoxMesh:function(){return P},getBoxMesh2:function(){return P===void 0&&(P=new Us(new wu(1,1,1),new sl({name:"BackgroundCubeMaterial",uniforms:Qd(ga.backgroundCube.uniforms),vertexShader:ga.backgroundCube.vertexShader,fragmentShader:ga.backgroundCube.fragmentShader,side:Ce,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),P.geometry.deleteAttribute("uv"),P.onBeforeRender=function(W,Q,q){this.matrixWorld.copyPosition(q.matrixWorld)},Object.defineProperty(P.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),f.update(P)),P},render:function(W,Q){let q=!1,K=Q.isScene===!0?Q.background:null;const ne=Q.isScene&&Q.backgroundColor!==void 0?Q.backgroundColor:null;switch(K==="environment"&&(K=Q.environment),K&&K.isTexture&&(K=(Q.backgroundBlurriness>0?l:r).get(K)),K===null?G(E,O):K&&K.isColor&&(G(K,1),q=!0),A.xr.getEnvironmentBlendMode()){case"opaque":q=!0;break;case"additive":h.buffers.color.setClear(0,0,0,1,b),q=!0;break;case"alpha-blend":h.buffers.color.setClear(0,0,0,0,b),q=!0}if((A.autoClear||q)&&A.clear(A.autoClearColor,A.autoClearDepth,A.autoClearStencil),K&&(K.isCubeTexture||K.mapping===xi))P===void 0&&(P=new Us(new wu(1,1,1),new sl({name:"BackgroundCubeMaterial",uniforms:Qd(ga.backgroundCube.uniforms),vertexShader:ga.backgroundCube.vertexShader,fragmentShader:ga.backgroundCube.fragmentShader,side:Ce,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),P.geometry.deleteAttribute("uv"),P.onBeforeRender=function(be,ve,me){this.matrixWorld.copyPosition(me.matrixWorld)},Object.defineProperty(P.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),f.update(P)),P.material.uniforms.envMap.value=K,P.material.uniforms.envMapRotation.value=K&&K.rotation||0,P.material.uniforms.envMapIntensity.value=K===Q.environment&&Q.envMapIntensity||1,P.material.uniforms.flipEnvMap.value=K.isCubeTexture&&K.isRenderTargetTexture===!1?-1:1,P.material.uniforms.backgroundBlurriness.value=Q.backgroundBlurriness,P.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,P.material.toneMapped=K.colorSpace!==Jn,F===K&&N===K.version&&z===A.toneMapping||(P.material.needsUpdate=!0,F=K,N=K.version,z=A.toneMapping),P.layers.enableAll(),W.unshift(P,P.geometry,P.material,0,0,null);else if(K&&K.isTexture||!K&&ne){D===void 0&&(D=new Us(new qd(2,2),new sl({name:"BackgroundMaterial",uniforms:Qd(ga.background.uniforms),vertexShader:ga.background.vertexShader,fragmentShader:ga.background.fragmentShader,side:et,depthTest:!1,depthWrite:!1,fog:!1})),D.geometry.deleteAttribute("normal"),Object.defineProperty(D.material,"map",{get:function(){return this.uniforms.t2D.value}}),f.update(D)),D.material.uniforms.backgroundColor.value.set(ne||16777215),D.material.uniforms.t2D.value=K,D.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,K?(D.material.toneMapped=K.colorSpace!==Jn,D.material.uniforms.flipX.value=K.userData.flipX||!1,D.material.uniforms.flipY.value=K.userData.flipY||!1,K.matrixAutoUpdate===!0&&K.updateMatrix(),D.material.uniforms.uvTransform.value.copy(K.matrix),D.material.defines.HAS_TEXTURE="1"):D.material.defines.HAS_TEXTURE&&delete D.material.defines.HAS_TEXTURE;const be=K?K.version:-1;F===K&&N===be&&z===A.toneMapping||(D.material.needsUpdate=!0,F=K,N=be,z=A.toneMapping),D.layers.enableAll(),W.unshift(D,D.geometry,D.material,0,0,null)}}}}function Vv(A,r,l,h){const f=A.getParameter(A.MAX_VERTEX_ATTRIBS),v=h.isWebGL2?null:r.get("OES_vertex_array_object"),b=h.isWebGL2||v!==null,E={},D=z(null);let P=D,O=!1;function F(ve){return h.isWebGL2?A.bindVertexArray(ve):v.bindVertexArrayOES(ve)}function N(ve){return h.isWebGL2?A.deleteVertexArray(ve):v.deleteVertexArrayOES(ve)}function z(ve){const me=[],Pe=[],tt=[];for(let Oe=0;Oe<f;Oe++)me[Oe]=0,Pe[Oe]=0,tt[Oe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:me,enabledAttributes:Pe,attributeDivisors:tt,object:ve,attributes:{},index:null}}function G(){const ve=P.newAttributes;for(let me=0,Pe=ve.length;me<Pe;me++)ve[me]=0}function W(ve){Q(ve,0)}function Q(ve,me){const Pe=P.newAttributes,tt=P.enabledAttributes,Oe=P.attributeDivisors;Pe[ve]=1,tt[ve]===0&&(A.enableVertexAttribArray(ve),tt[ve]=1),Oe[ve]!==me&&((h.isWebGL2?A:r.get("ANGLE_instanced_arrays"))[h.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ve,me),Oe[ve]=me)}function q(){const ve=P.newAttributes,me=P.enabledAttributes;for(let Pe=0,tt=me.length;Pe<tt;Pe++)me[Pe]!==ve[Pe]&&(A.disableVertexAttribArray(Pe),me[Pe]=0)}function K(ve,me,Pe,tt,Oe,pt){h.isWebGL2!==!0||Pe!==A.INT&&Pe!==A.UNSIGNED_INT?A.vertexAttribPointer(ve,me,Pe,tt,Oe,pt):A.vertexAttribIPointer(ve,me,Pe,Oe,pt)}function ne(){be(),O=!0,P!==D&&(P=D,F(P.object))}function be(){D.geometry=null,D.program=null,D.wireframe=!1}return{setup:function(ve,me,Pe,tt,Oe){let pt=!1;if(b){const ke=function(Mt,Ot,tn){const An=tn.wireframe===!0;let nn=E[Mt.id];nn===void 0&&(nn={},E[Mt.id]=nn);let Xt=nn[Ot.id];Xt===void 0&&(Xt={},nn[Ot.id]=Xt);let dn=Xt[An];return dn===void 0&&(dn=z(h.isWebGL2?A.createVertexArray():v.createVertexArrayOES()),Xt[An]=dn),dn}(tt,Pe,me);P!==ke&&(P=ke,F(P.object)),pt=function(Mt,Ot,tn,An){const nn=P.attributes,Xt=Ot.attributes;let dn=0;const gn=tn.getAttributes();for(const xt in gn)if(gn[xt].location>=0){const Wt=nn[xt];let un=Xt[xt];if(un===void 0&&(xt==="instanceMatrix"&&Mt.instanceMatrix&&(un=Mt.instanceMatrix),xt==="instanceColor"&&Mt.instanceColor&&(un=Mt.instanceColor)),Wt===void 0||Wt.attribute!==un||un&&Wt.data!==un.data)return!0;dn++}return P.attributesNum!==dn||P.index!==An}(ve,tt,Pe,Oe),pt&&function(Mt,Ot,tn,An){const nn={},Xt=Ot.attributes;let dn=0;const gn=tn.getAttributes();for(const xt in gn)if(gn[xt].location>=0){let Wt=Xt[xt];Wt===void 0&&(xt==="instanceMatrix"&&Mt.instanceMatrix&&(Wt=Mt.instanceMatrix),xt==="instanceColor"&&Mt.instanceColor&&(Wt=Mt.instanceColor));const un={};un.attribute=Wt,Wt&&Wt.data&&(un.data=Wt.data),nn[xt]=un,dn++}P.attributes=nn,P.attributesNum=dn,P.index=An}(ve,tt,Pe,Oe)}else{const ke=me.wireframe===!0;P.geometry===tt.id&&P.program===Pe.id&&P.wireframe===ke||(P.geometry=tt.id,P.program=Pe.id,P.wireframe=ke,pt=!0)}Oe!==null&&l.update(Oe,A.ELEMENT_ARRAY_BUFFER),(pt||O)&&(O=!1,function(ke,Mt,Ot,tn){if(h.isWebGL2===!1&&(ke.isInstancedMesh||tn.isInstancedBufferGeometry)&&r.get("ANGLE_instanced_arrays")===null)return;G();const An=tn.attributes,nn=Ot.getAttributes(),Xt=Mt.defaultAttributeValues;for(const dn in nn){const gn=nn[dn];if(gn.location>=0){let xt=An[dn];if(xt===void 0&&(dn==="instanceMatrix"&&ke.instanceMatrix&&(xt=ke.instanceMatrix),dn==="instanceColor"&&ke.instanceColor&&(xt=ke.instanceColor)),xt!==void 0){const Wt=xt.normalized,un=xt.itemSize,Zt=l.get(xt);if(Zt===void 0)continue;const _n=Zt.buffer,ai=Zt.type,De=Zt.bytesPerElement;if(xt.isInterleavedBufferAttribute){const we=xt.data,ot=we.stride,Ve=xt.offset;if(we.isInstancedInterleavedBuffer){for(let Re=0;Re<gn.locationSize;Re++)Q(gn.location+Re,we.meshPerAttribute);ke.isInstancedMesh!==!0&&tn._maxInstanceCount===void 0&&(tn._maxInstanceCount=we.meshPerAttribute*we.count)}else for(let Re=0;Re<gn.locationSize;Re++)W(gn.location+Re);A.bindBuffer(A.ARRAY_BUFFER,_n);for(let Re=0;Re<gn.locationSize;Re++)K(gn.location+Re,un/gn.locationSize,ai,Wt,ot*De,(Ve+un/gn.locationSize*Re)*De)}else{if(xt.isInstancedBufferAttribute){for(let we=0;we<gn.locationSize;we++)Q(gn.location+we,xt.meshPerAttribute);ke.isInstancedMesh!==!0&&tn._maxInstanceCount===void 0&&(tn._maxInstanceCount=xt.meshPerAttribute*xt.count)}else for(let we=0;we<gn.locationSize;we++)W(gn.location+we);A.bindBuffer(A.ARRAY_BUFFER,_n);for(let we=0;we<gn.locationSize;we++)K(gn.location+we,un/gn.locationSize,ai,Wt,un*De,un/gn.locationSize*we*De)}}else if(Xt!==void 0){const Wt=Xt[dn];if(Wt!==void 0)switch(Wt.length){case 2:A.vertexAttrib2fv(gn.location,Wt);break;case 3:A.vertexAttrib3fv(gn.location,Wt);break;case 4:A.vertexAttrib4fv(gn.location,Wt);break;default:A.vertexAttrib1fv(gn.location,Wt)}}}}q()}(ve,me,Pe,tt),Oe!==null&&A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,l.get(Oe).buffer))},reset:ne,resetDefaultState:be,dispose:function(){ne();for(const ve in E){const me=E[ve];for(const Pe in me){const tt=me[Pe];for(const Oe in tt)N(tt[Oe].object),delete tt[Oe];delete me[Pe]}delete E[ve]}},releaseStatesOfGeometry:function(ve){if(E[ve.id]===void 0)return;const me=E[ve.id];for(const Pe in me){const tt=me[Pe];for(const Oe in tt)N(tt[Oe].object),delete tt[Oe];delete me[Pe]}delete E[ve.id]},releaseStatesOfProgram:function(ve){for(const me in E){const Pe=E[me];if(Pe[ve.id]===void 0)continue;const tt=Pe[ve.id];for(const Oe in tt)N(tt[Oe].object),delete tt[Oe];delete Pe[ve.id]}},initAttributes:G,enableAttribute:W,disableUnusedAttributes:q}}function L0(A,r,l,h){const f=h.isWebGL2;let v;this.setMode=function(b){v=b},this.render=function(b,E){A.drawArrays(v,b,E),l.update(E,v,1)},this.renderInstances=function(b,E,D){if(D===0)return;let P,O;if(f)P=A,O="drawArraysInstanced";else if(P=r.get("ANGLE_instanced_arrays"),O="drawArraysInstancedANGLE",P===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");P[O](v,b,E,D),l.update(E,v,D)}}function gf(A,r,l){let h;function f(be){if(be==="highp"){if(A.getShaderPrecisionFormat(A.VERTEX_SHADER,A.HIGH_FLOAT).precision>0&&A.getShaderPrecisionFormat(A.FRAGMENT_SHADER,A.HIGH_FLOAT).precision>0)return"highp";be="mediump"}return be==="mediump"&&A.getShaderPrecisionFormat(A.VERTEX_SHADER,A.MEDIUM_FLOAT).precision>0&&A.getShaderPrecisionFormat(A.FRAGMENT_SHADER,A.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const v=typeof WebGL2RenderingContext<"u"&&A.constructor.name==="WebGL2RenderingContext";let b=l.precision!==void 0?l.precision:"highp";const E=f(b);E!==b&&(console.warn("THREE.WebGLRenderer:",b,"not supported, using",E,"instead."),b=E);const D=v||r.has("WEBGL_draw_buffers"),P=l.logarithmicDepthBuffer===!0,O=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS),F=A.getParameter(A.MAX_VERTEX_TEXTURE_IMAGE_UNITS),N=A.getParameter(A.MAX_TEXTURE_SIZE),z=A.getParameter(A.MAX_CUBE_MAP_TEXTURE_SIZE),G=A.getParameter(A.MAX_VERTEX_ATTRIBS),W=A.getParameter(A.MAX_VERTEX_UNIFORM_VECTORS),Q=A.getParameter(A.MAX_VARYING_VECTORS),q=A.getParameter(A.MAX_FRAGMENT_UNIFORM_VECTORS),K=F>0,ne=v||r.has("OES_texture_float");return{isWebGL2:v,drawBuffers:D,getMaxAnisotropy:function(){if(h!==void 0)return h;if(r.has("EXT_texture_filter_anisotropic")===!0){const be=r.get("EXT_texture_filter_anisotropic");h=A.getParameter(be.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else h=0;return h},getMaxPrecision:f,precision:b,logarithmicDepthBuffer:P,maxTextures:O,maxVertexTextures:F,maxTextureSize:N,maxCubemapSize:z,maxAttributes:G,maxVertexUniforms:W,maxVaryings:Q,maxFragmentUniforms:q,vertexTextures:K,floatFragmentTextures:ne,floatVertexTextures:K&&ne,maxSamples:v?A.getParameter(A.MAX_SAMPLES):0}}function Nm(A){const r=this;let l=null,h=0,f=!1,v=!1;const b=new bh,E=new bi,D={value:null,needsUpdate:!1};function P(O,F,N,z){const G=O!==null?O.length:0;let W=null;if(G!==0){if(W=D.value,z!==!0||W===null){const Q=N+4*G,q=F.matrixWorldInverse;E.getNormalMatrix(q),(W===null||W.length<Q)&&(W=new Float32Array(Q));for(let K=0,ne=N;K!==G;++K,ne+=4)b.copy(O[K]).applyMatrix4(q,E),b.normal.toArray(W,ne),W[ne+3]=b.constant}D.value=W,D.needsUpdate=!0}return r.numPlanes=G,r.numIntersection=0,W}this.uniform=D,this.numPlanes=0,this.numIntersection=0,this.init=function(O,F){const N=O.length!==0||F||h!==0||f;return f=F,h=O.length,N},this.beginShadows=function(){v=!0,P(null)},this.endShadows=function(){v=!1},this.setGlobalState=function(O,F){l=P(O,F,0)},this.setState=function(O,F,N){const z=O.clippingPlanes,G=O.clipIntersection,W=O.clipShadows,Q=A.get(O);if(!f||z===null||z.length===0||v&&!W)v?P(null):(D.value!==l&&(D.value=l,D.needsUpdate=h>0),r.numPlanes=h,r.numIntersection=0);else{const q=v?0:h,K=4*q;let ne=Q.clippingState||null;D.value=ne,ne=P(z,F,K,N);for(let be=0;be!==K;++be)ne[be]=l[be];Q.clippingState=ne,this.numIntersection=G?this.numPlanes:0,this.numPlanes+=q}}}function Fm(A){let r=new WeakMap;function l(f,v){return v===Er?f.mapping=Ae:v===gs&&(f.mapping=Ji),f}function h(f){const v=f.target;v.removeEventListener("dispose",h);const b=r.get(v);b!==void 0&&(r.delete(v),b.dispose())}return{get:function(f){if(f&&f.isTexture&&f.isRenderTargetTexture===!1){const v=f.mapping;if(v===Er||v===gs){if(r.has(f)){const b=r.get(f).texture;return b.rotation=f.rotation,l(b,f.mapping)}{const b=f.image;if(b&&b.height>0){const E=new Fv(b.height/2);return E.fromEquirectangularTexture(A,f),E.texture.rotation=f.rotation,r.set(f,E),f.addEventListener("dispose",h),l(E.texture,f.mapping)}return null}}}return f},dispose:function(){r=new WeakMap}}}class jm extends Lm{constructor(r=-1,l=1,h=1,f=-1,v=.1,b=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=l,this.top=h,this.bottom=f,this.near=v,this.far=b,this.updateProjectionMatrix()}copy(r,l){return super.copy(r,l),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,l,h,f,v,b){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=l,this.view.offsetX=h,this.view.offsetY=f,this.view.width=v,this.view.height=b,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),h=(this.right+this.left)/2,f=(this.top+this.bottom)/2;let v=h-r,b=h+r,E=f+l,D=f-l;if(this.view!==null&&this.view.enabled){const P=(this.right-this.left)/this.view.fullWidth/this.zoom,O=(this.top-this.bottom)/this.view.fullHeight/this.zoom;v+=P*this.view.offsetX,b=v+P*this.view.width,E-=O*this.view.offsetY,D=E-O*this.view.height}this.projectionMatrix.makeOrthographic(v,b,E,D,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const l=super.toJSON(r);return l.object.zoom=this.zoom,l.object.left=this.left,l.object.right=this.right,l.object.top=this.top,l.object.bottom=this.bottom,l.object.near=this.near,l.object.far=this.far,this.view!==null&&(l.object.view=Object.assign({},this.view)),l}}const zm=[.125,.215,.35,.446,.526,.582],Vo=20,al=new jm,vf=new xn;let Gv=null;const xu=(1+Math.sqrt(5))/2,Qc=1/xu,wh=[new fe(1,1,1),new fe(-1,1,1),new fe(1,1,-1),new fe(-1,1,-1),new fe(0,xu,Qc),new fe(0,xu,-Qc),new fe(Qc,0,xu),new fe(-Qc,0,xu),new fe(xu,Qc,0),new fe(-xu,Qc,0)];class vc{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,l=0,h=.1,f=100){Gv=this._renderer.getRenderTarget(),this._setSize(256);const v=this._allocateTargets();return v.depthBuffer=!0,this._sceneToCubeUV(r,h,f,v),l>0&&this._blur(v,0,0,l),this._applyPMREM(v),this._cleanup(v),v}fromEquirectangular(r,l=null){return this._fromTexture(r,l)}fromCubemap(r,l=null){return this._fromTexture(r,l)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=k0(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=za(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(Gv),r.scissorTest=!1,Vm(r,0,0,r.width,r.height)}_fromTexture(r,l){r.mapping===Ae||r.mapping===Ji?this._setSize(r.image.length===0?16:r.image[0].width||r.image[0].image.width):this._setSize(r.image.width/4),Gv=this._renderer.getRenderTarget();const h=l||this._allocateTargets();return this._textureToCubeUV(r,h),this._applyPMREM(h),this._cleanup(h),h}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),l=4*this._cubeSize,h={magFilter:_r,minFilter:_r,generateMipmaps:!1,type:pr,format:Sr,colorSpace:fr,depthBuffer:!1},f=Bl(r,l,h);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==r||this._pingPongRenderTarget.height!==l){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Bl(r,l,h);const{_lodMax:v}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(b){const E=[],D=[],P=[];let O=b;const F=b-4+1+zm.length;for(let N=0;N<F;N++){const z=Math.pow(2,O);D.push(z);let G=1/z;N>b-4?G=zm[N-b+4-1]:N===0&&(G=0),P.push(G);const W=1/(z-2),Q=-W,q=1+W,K=[Q,Q,q,Q,q,q,Q,Q,q,q,Q,q],ne=6,be=6,ve=3,me=2,Pe=1,tt=new Float32Array(ve*be*ne),Oe=new Float32Array(me*be*ne),pt=new Float32Array(Pe*be*ne);for(let Mt=0;Mt<ne;Mt++){const Ot=Mt%3*2/3-1,tn=Mt>2?0:-1,An=[Ot,tn,0,Ot+2/3,tn,0,Ot+2/3,tn+1,0,Ot,tn,0,Ot+2/3,tn+1,0,Ot,tn+1,0];tt.set(An,ve*be*Mt),Oe.set(K,me*be*Mt);const nn=[Mt,Mt,Mt,Mt,Mt,Mt];pt.set(nn,Pe*be*Mt)}const ke=new Y;ke.setAttribute("position",new tr(tt,ve)),ke.setAttribute("uv",new tr(Oe,me)),ke.setAttribute("faceIndex",new tr(pt,Pe)),E.push(ke),O>4&&O--}return{lodPlanes:E,sizeLods:D,sigmas:P}}(v)),this._blurMaterial=function(b,E,D){const P=new Float32Array(Vo),O=new fe(0,1,0);return new sl({name:"SphericalGaussianBlur",defines:{n:Vo,CUBEUV_TEXEL_WIDTH:1/E,CUBEUV_TEXEL_HEIGHT:1/D,CUBEUV_MAX_MIP:`${b}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:P},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:O}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ue,depthTest:!1,depthWrite:!1})}(v,r,l)}return f}_compileMaterial(r){const l=new Us(this._lodPlanes[0],r);this._renderer.compile(l,al)}_sceneToCubeUV(r,l,h,f){const v=new so(90,1,l,h),b=[1,-1,1,1,1,1],E=[1,1,1,-1,-1,-1],D=this._renderer,P=D.autoClear,O=D.toneMapping;D.getClearColor(vf),D.toneMapping=Ki,D.autoClear=!1;const F=new pa({name:"PMREM.Background",side:Ce,depthWrite:!1,depthTest:!1}),N=new Us(new wu,F);let z=!1;const G=r.background;G?G.isColor&&(F.color.copy(G),r.background=null,z=!0):(F.color.copy(vf),z=!0);for(let W=0;W<6;W++){const Q=W%3;Q===0?(v.up.set(0,b[W],0),v.lookAt(E[W],0,0)):Q===1?(v.up.set(0,0,b[W]),v.lookAt(0,E[W],0)):(v.up.set(0,b[W],0),v.lookAt(0,0,E[W]));const q=this._cubeSize;Vm(f,Q*q,W>2?q:0,q,q),D.setRenderTarget(f),z&&D.render(N,v),D.render(r,v)}N.geometry.dispose(),N.material.dispose(),D.toneMapping=O,D.autoClear=P,r.background=G}_textureToCubeUV(r,l){const h=this._renderer,f=r.mapping===Ae||r.mapping===Ji;f?(this._cubemapMaterial===null&&(this._cubemapMaterial=k0()),this._cubemapMaterial.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=za());const v=f?this._cubemapMaterial:this._equirectMaterial,b=new Us(this._lodPlanes[0],v);v.uniforms.envMap.value=r;const E=this._cubeSize;Vm(l,0,0,3*E,2*E),h.setRenderTarget(l),h.render(b,al)}_applyPMREM(r){const l=this._renderer,h=l.autoClear;l.autoClear=!1;for(let f=1;f<this._lodPlanes.length;f++){const v=Math.sqrt(this._sigmas[f]*this._sigmas[f]-this._sigmas[f-1]*this._sigmas[f-1]),b=wh[(f-1)%wh.length];this._blur(r,f-1,f,v,b)}l.autoClear=h}_blur(r,l,h,f,v){const b=this._pingPongRenderTarget;this._halfBlur(r,b,l,h,f,"latitudinal",v),this._halfBlur(b,r,h,h,f,"longitudinal",v)}_halfBlur(r,l,h,f,v,b,E){const D=this._renderer,P=this._blurMaterial;b!=="latitudinal"&&b!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const O=new Us(this._lodPlanes[f],P),F=P.uniforms,N=this._sizeLods[h]-1,z=isFinite(v)?Math.PI/(2*N):2*Math.PI/39,G=v/z,W=isFinite(v)?1+Math.floor(3*G):Vo;W>Vo&&console.warn(`sigmaRadians, ${v}, is too large and will clip, as it requested ${W} samples when the maximum is set to 20`);const Q=[];let q=0;for(let be=0;be<Vo;++be){const ve=be/G,me=Math.exp(-ve*ve/2);Q.push(me),be===0?q+=me:be<W&&(q+=2*me)}for(let be=0;be<Q.length;be++)Q[be]=Q[be]/q;F.envMap.value=r.texture,F.samples.value=W,F.weights.value=Q,F.latitudinal.value=b==="latitudinal",E&&(F.poleAxis.value=E);const{_lodMax:K}=this;F.dTheta.value=z,F.mipInt.value=K-h;const ne=this._sizeLods[f];Vm(l,3*ne*(f>K-4?f-K+4:0),4*(this._cubeSize-ne),3*ne,2*ne),D.setRenderTarget(l),D.render(O,al)}}function Bl(A,r,l){const h=new yo(A,r,l);return h.texture.mapping=xi,h.texture.name="PMREM.cubeUv",h.scissorTest=!0,h}function Vm(A,r,l,h,f){A.viewport.set(r,l,h,f),A.scissor.set(r,l,h,f)}function za(){return new sl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ue,depthTest:!1,depthWrite:!1})}function k0(){return new sl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ue,depthTest:!1,depthWrite:!1})}function _f(A){let r=new WeakMap,l=null;function h(f){const v=f.target;v.removeEventListener("dispose",h);const b=r.get(v);b!==void 0&&(r.delete(v),b.dispose())}return{get:function(f){if(f&&f.isTexture){const v=f.mapping,b=v===Er||v===gs,E=v===Ae||v===Ji;if(b||E){if(f.isRenderTargetTexture&&f.needsPMREMUpdate===!0){f.needsPMREMUpdate=!1;let D=r.get(f);return l===null&&(l=new vc(A)),D=b?l.fromEquirectangular(f,D):l.fromCubemap(f,D),r.set(f,D),D.texture}if(r.has(f))return r.get(f).texture;{const D=f.image;if(b&&D&&D.height>0||E&&D&&function(P){let O=0;for(let F=0;F<6;F++)P[F]!==void 0&&O++;return O===6}(D)){l===null&&(l=new vc(A));const P=b?l.fromEquirectangular(f):l.fromCubemap(f);return r.set(f,P),f.addEventListener("dispose",h),P.texture}return null}}}return f},dispose:function(){r=new WeakMap,l!==null&&(l.dispose(),l=null)}}}function _b(A){const r={};function l(h){if(r[h]!==void 0)return r[h];let f;switch(h){case"WEBGL_depth_texture":f=A.getExtension("WEBGL_depth_texture")||A.getExtension("MOZ_WEBGL_depth_texture")||A.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":f=A.getExtension("EXT_texture_filter_anisotropic")||A.getExtension("MOZ_EXT_texture_filter_anisotropic")||A.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":f=A.getExtension("WEBGL_compressed_texture_s3tc")||A.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||A.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":f=A.getExtension("WEBGL_compressed_texture_pvrtc")||A.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:f=A.getExtension(h)}return r[h]=f,f}return{has:function(h){return l(h)!==null},init:function(h){h.isWebGL2?l("EXT_color_buffer_float"):(l("WEBGL_depth_texture"),l("OES_texture_float"),l("OES_texture_half_float"),l("OES_texture_half_float_linear"),l("OES_standard_derivatives"),l("OES_element_index_uint"),l("OES_vertex_array_object"),l("ANGLE_instanced_arrays")),l("OES_texture_float_linear"),l("EXT_color_buffer_half_float"),l("WEBGL_multisampled_render_to_texture")},get:function(h){const f=l(h);return f===null&&console.warn("THREE.WebGLRenderer: "+h+" extension not supported."),f}}}function H1(A,r,l,h){const f={},v=new WeakMap;function b(D){const P=D.target;P.index!==null&&r.remove(P.index);for(const F in P.attributes)r.remove(P.attributes[F]);P.removeEventListener("dispose",b),delete f[P.id];const O=v.get(P);O&&(r.remove(O),v.delete(P)),h.releaseStatesOfGeometry(P),P.isInstancedBufferGeometry===!0&&delete P._maxInstanceCount,l.memory.geometries--}function E(D){const P=[],O=D.index,F=D.attributes.position;let N=0;if(O!==null){const W=O.array;N=O.version;for(let Q=0,q=W.length;Q<q;Q+=3){const K=W[Q+0],ne=W[Q+1],be=W[Q+2];P.push(K,ne,ne,be,be,K)}}else{const W=F.array;N=F.version;for(let Q=0,q=W.length/3-1;Q<q;Q+=3){const K=Q+0,ne=Q+1,be=Q+2;P.push(K,ne,ne,be,be,K)}}const z=new(ra(P)?pf:bu)(P,1);z.version=N;const G=v.get(D);G&&r.remove(G),v.set(D,z)}return{get:function(D,P){return f[P.id]===!0||(P.addEventListener("dispose",b),f[P.id]=!0,l.memory.geometries++),P},update:function(D){const P=D.attributes;for(const F in P)r.update(P[F],A.ARRAY_BUFFER);const O=D.morphAttributes;for(const F in O){const N=O[F];for(let z=0,G=N.length;z<G;z++)r.update(N[z],A.ARRAY_BUFFER)}},getWireframeAttribute:function(D){const P=v.get(D);if(P){const O=D.index;O!==null&&P.version<O.version&&E(D)}else E(D);return v.get(D)}}}function xh(A,r,l,h){const f=h.isWebGL2;let v,b,E;this.setMode=function(D){v=D},this.setIndex=function(D){b=D.type,E=D.bytesPerElement},this.render=function(D,P){A.drawElements(v,P,b,D*E),l.update(P,v,1)},this.renderInstances=function(D,P,O){if(O===0)return;let F,N;if(f)F=A,N="drawElementsInstanced";else if(F=r.get("ANGLE_instanced_arrays"),N="drawElementsInstancedANGLE",F===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");F[N](v,P,b,D*E,O),l.update(P,v,O)}}function U0(A){const r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(l,h,f){switch(r.calls++,h){case A.TRIANGLES:r.triangles+=f*(l/3);break;case A.LINES:r.lines+=f*(l/2);break;case A.LINE_STRIP:r.lines+=f*(l-1);break;case A.LINE_LOOP:r.lines+=f*l;break;case A.POINTS:r.points+=f*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",h)}}}}function yb(A,r){return A[0]-r[0]}function N0(A,r){return Math.abs(r[1])-Math.abs(A[1])}function oo(A,r,l){const h={},f=new Float32Array(8),v=new WeakMap,b=new ji,E=[];for(let D=0;D<8;D++)E[D]=[D,0];return{update:function(D,P,O){const F=D.morphTargetInfluences;if(r.isWebGL2===!0){const N=P.morphAttributes.position||P.morphAttributes.normal||P.morphAttributes.color,z=N!==void 0?N.length:0;let G=v.get(P);if(G===void 0||G.count!==z){G!==void 0&&G.texture.dispose();const q=P.morphAttributes.position!==void 0,K=P.morphAttributes.normal!==void 0,ne=P.morphAttributes.color!==void 0,be=P.morphAttributes.position||[],ve=P.morphAttributes.normal||[],me=P.morphAttributes.color||[];let Pe=0;q===!0&&(Pe=1),K===!0&&(Pe=2),ne===!0&&(Pe=3);let tt=P.attributes.position.count*Pe,Oe=1;tt>r.maxTextureSize&&(Oe=Math.ceil(tt/r.maxTextureSize),tt=r.maxTextureSize);const pt=new Float32Array(tt*Oe*4*z),ke=new fu(pt,tt,Oe,z);ke.type=tc,ke.needsUpdate=!0;const Mt=4*Pe;for(let Ot=0;Ot<z;Ot++){const tn=be[Ot],An=ve[Ot],nn=me[Ot],Xt=tt*Oe*4*Ot;for(let dn=0;dn<tn.count;dn++){const gn=dn*Mt;q===!0&&(b.fromBufferAttribute(tn,dn),pt[Xt+gn+0]=b.x,pt[Xt+gn+1]=b.y,pt[Xt+gn+2]=b.z,pt[Xt+gn+3]=0),K===!0&&(b.fromBufferAttribute(An,dn),pt[Xt+gn+4]=b.x,pt[Xt+gn+5]=b.y,pt[Xt+gn+6]=b.z,pt[Xt+gn+7]=0),ne===!0&&(b.fromBufferAttribute(nn,dn),pt[Xt+gn+8]=b.x,pt[Xt+gn+9]=b.y,pt[Xt+gn+10]=b.z,pt[Xt+gn+11]=nn.itemSize===4?b.w:1)}}G={count:z,texture:ke,size:new Ht(tt,Oe)},v.set(P,G),P.addEventListener("dispose",function Ot(){ke.dispose(),v.delete(P),P.removeEventListener("dispose",Ot)})}let W=0;for(let q=0;q<F.length;q++)W+=F[q];const Q=P.morphTargetsRelative?1:1-W;O.getUniforms().setValue(A,"morphTargetBaseInfluence",Q),O.getUniforms().setValue(A,"morphTargetInfluences",F),O.getUniforms().setValue(A,"morphTargetsTexture",G.texture,l),O.getUniforms().setValue(A,"morphTargetsTextureSize",G.size)}else{const N=F===void 0?0:F.length;let z=h[P.id];if(z===void 0||z.length!==N){z=[];for(let K=0;K<N;K++)z[K]=[K,0];h[P.id]=z}for(let K=0;K<N;K++){const ne=z[K];ne[0]=K,ne[1]=F[K]}z.sort(N0);for(let K=0;K<8;K++)K<N&&z[K][1]?(E[K][0]=z[K][0],E[K][1]=z[K][1]):(E[K][0]=Number.MAX_SAFE_INTEGER,E[K][1]=0);E.sort(yb);const G=P.morphAttributes.position,W=P.morphAttributes.normal;let Q=0;for(let K=0;K<8;K++){const ne=E[K],be=ne[0],ve=ne[1];be!==Number.MAX_SAFE_INTEGER&&ve?(G&&P.getAttribute("morphTarget"+K)!==G[be]&&P.setAttribute("morphTarget"+K,G[be]),W&&P.getAttribute("morphNormal"+K)!==W[be]&&P.setAttribute("morphNormal"+K,W[be]),f[K]=ve,Q+=ve):(G&&P.hasAttribute("morphTarget"+K)===!0&&P.deleteAttribute("morphTarget"+K),W&&P.hasAttribute("morphNormal"+K)===!0&&P.deleteAttribute("morphNormal"+K),f[K]=0)}const q=P.morphTargetsRelative?1:1-Q;O.getUniforms().setValue(A,"morphTargetBaseInfluence",q),O.getUniforms().setValue(A,"morphTargetInfluences",f)}}}}function _c(A,r,l,h){let f=new WeakMap;function v(b){const E=b.target;E.removeEventListener("dispose",v),l.remove(E.instanceMatrix),E.instanceColor!==null&&l.remove(E.instanceColor)}return{update:function(b){const E=h.render.frame,D=b.geometry,P=r.get(b,D);return f.get(P)!==E&&(r.update(P),f.set(P,E)),b.isInstancedMesh&&(b.hasEventListener("dispose",v)===!1&&b.addEventListener("dispose",v),l.update(b.instanceMatrix,A.ARRAY_BUFFER),b.instanceColor!==null&&l.update(b.instanceColor,A.ARRAY_BUFFER)),P},dispose:function(){f=new WeakMap}}}const Hv=new Or,Eu=new fu,F0=new af,Va=new gc,Qv=[],Ab=[],bb=new Float32Array(16),yf=new Float32Array(9),j0=new Float32Array(4);function Xd(A,r,l){const h=A[0];if(h<=0||h>0)return A;const f=r*l;let v=Qv[f];if(v===void 0&&(v=new Float32Array(f),Qv[f]=v),r!==0){h.toArray(v,0);for(let b=1,E=0;b!==r;++b)E+=l,A[b].toArray(v,E)}return v}function ls(A,r){if(A.length!==r.length)return!1;for(let l=0,h=A.length;l<h;l++)if(A[l]!==r[l])return!1;return!0}function Yr(A,r){for(let l=0,h=r.length;l<h;l++)A[l]=r[l]}function Gm(A,r){let l=Ab[r];l===void 0&&(l=new Int32Array(r),Ab[r]=l);for(let h=0;h!==r;++h)l[h]=A.allocateTextureUnit();return l}function Yd(A,r){const l=this.cache;l[0]!==r&&(A.uniform1f(this.addr,r),l[0]=r)}function Af(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y||(A.uniform2f(this.addr,r.x,r.y),l[0]=r.x,l[1]=r.y);else{if(ls(l,r))return;A.uniform2fv(this.addr,r),Yr(l,r)}}function Hm(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y&&l[2]===r.z||(A.uniform3f(this.addr,r.x,r.y,r.z),l[0]=r.x,l[1]=r.y,l[2]=r.z);else if(r.r!==void 0)l[0]===r.r&&l[1]===r.g&&l[2]===r.b||(A.uniform3f(this.addr,r.r,r.g,r.b),l[0]=r.r,l[1]=r.g,l[2]=r.b);else{if(ls(l,r))return;A.uniform3fv(this.addr,r),Yr(l,r)}}function Wv(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y&&l[2]===r.z&&l[3]===r.w||(A.uniform4f(this.addr,r.x,r.y,r.z,r.w),l[0]=r.x,l[1]=r.y,l[2]=r.z,l[3]=r.w);else{if(ls(l,r))return;A.uniform4fv(this.addr,r),Yr(l,r)}}function bf(A,r){const l=this.cache,h=r.elements;if(h===void 0){if(ls(l,r))return;A.uniformMatrix2fv(this.addr,!1,r),Yr(l,r)}else{if(ls(l,h))return;j0.set(h),A.uniformMatrix2fv(this.addr,!1,j0),Yr(l,h)}}function Qm(A,r){const l=this.cache,h=r.elements;if(h===void 0){if(ls(l,r))return;A.uniformMatrix3fv(this.addr,!1,r),Yr(l,r)}else{if(ls(l,h))return;yf.set(h),A.uniformMatrix3fv(this.addr,!1,yf),Yr(l,h)}}function wb(A,r){const l=this.cache,h=r.elements;if(h===void 0){if(ls(l,r))return;A.uniformMatrix4fv(this.addr,!1,r),Yr(l,r)}else{if(ls(l,h))return;bb.set(h),A.uniformMatrix4fv(this.addr,!1,bb),Yr(l,h)}}function xb(A,r){const l=this.cache;l[0]!==r&&(A.uniform1i(this.addr,r),l[0]=r)}function qv(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y||(A.uniform2i(this.addr,r.x,r.y),l[0]=r.x,l[1]=r.y);else{if(ls(l,r))return;A.uniform2iv(this.addr,r),Yr(l,r)}}function Kd(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y&&l[2]===r.z||(A.uniform3i(this.addr,r.x,r.y,r.z),l[0]=r.x,l[1]=r.y,l[2]=r.z);else{if(ls(l,r))return;A.uniform3iv(this.addr,r),Yr(l,r)}}function z0(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y&&l[2]===r.z&&l[3]===r.w||(A.uniform4i(this.addr,r.x,r.y,r.z,r.w),l[0]=r.x,l[1]=r.y,l[2]=r.z,l[3]=r.w);else{if(ls(l,r))return;A.uniform4iv(this.addr,r),Yr(l,r)}}function Su(A,r){const l=this.cache;l[0]!==r&&(A.uniform1ui(this.addr,r),l[0]=r)}function Eb(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y||(A.uniform2ui(this.addr,r.x,r.y),l[0]=r.x,l[1]=r.y);else{if(ls(l,r))return;A.uniform2uiv(this.addr,r),Yr(l,r)}}function Sb(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y&&l[2]===r.z||(A.uniform3ui(this.addr,r.x,r.y,r.z),l[0]=r.x,l[1]=r.y,l[2]=r.z);else{if(ls(l,r))return;A.uniform3uiv(this.addr,r),Yr(l,r)}}function V0(A,r){const l=this.cache;if(r.x!==void 0)l[0]===r.x&&l[1]===r.y&&l[2]===r.z&&l[3]===r.w||(A.uniform4ui(this.addr,r.x,r.y,r.z,r.w),l[0]=r.x,l[1]=r.y,l[2]=r.z,l[3]=r.w);else{if(ls(l,r))return;A.uniform4uiv(this.addr,r),Yr(l,r)}}function G0(A,r,l){const h=this.cache,f=l.allocateTextureUnit();h[0]!==f&&(A.uniform1i(this.addr,f),h[0]=f),l.setTexture2D(r||Hv,f)}function H0(A,r,l){const h=this.cache,f=l.allocateTextureUnit();h[0]!==f&&(A.uniform1i(this.addr,f),h[0]=f),l.setTexture3D(r||F0,f)}function Jd(A,r,l){const h=this.cache,f=l.allocateTextureUnit();h[0]!==f&&(A.uniform1i(this.addr,f),h[0]=f),l.setTextureCube(r||Va,f)}function Ga(A,r,l){const h=this.cache,f=l.allocateTextureUnit();h[0]!==f&&(A.uniform1i(this.addr,f),h[0]=f),l.setTexture2DArray(r||Eu,f)}function Eh(A,r){A.uniform1fv(this.addr,r)}function zr(A,r){const l=Xd(r,this.size,2);A.uniform2fv(this.addr,l)}function Cb(A,r){const l=Xd(r,this.size,3);A.uniform3fv(this.addr,l)}function Q0(A,r){const l=Xd(r,this.size,4);A.uniform4fv(this.addr,l)}function Mb(A,r){const l=Xd(r,this.size,4);A.uniformMatrix2fv(this.addr,!1,l)}function Tb(A,r){const l=Xd(r,this.size,9);A.uniformMatrix3fv(this.addr,!1,l)}function Ib(A,r){const l=Xd(r,this.size,16);A.uniformMatrix4fv(this.addr,!1,l)}function Q1(A,r){A.uniform1iv(this.addr,r)}function W1(A,r){A.uniform2iv(this.addr,r)}function q1(A,r){A.uniform3iv(this.addr,r)}function X1(A,r){A.uniform4iv(this.addr,r)}function Y1(A,r){A.uniform1uiv(this.addr,r)}function K1(A,r){A.uniform2uiv(this.addr,r)}function W0(A,r){A.uniform3uiv(this.addr,r)}function Xv(A,r){A.uniform4uiv(this.addr,r)}function Ar(A,r,l){const h=this.cache,f=r.length,v=Gm(l,f);ls(h,v)||(A.uniform1iv(this.addr,v),Yr(h,v));for(let b=0;b!==f;++b)l.setTexture2D(r[b]||Hv,v[b])}function Pb(A,r,l){const h=this.cache,f=r.length,v=Gm(l,f);ls(h,v)||(A.uniform1iv(this.addr,v),Yr(h,v));for(let b=0;b!==f;++b)l.setTexture3D(r[b]||F0,v[b])}function Rb(A,r,l){const h=this.cache,f=r.length,v=Gm(l,f);ls(h,v)||(A.uniform1iv(this.addr,v),Yr(h,v));for(let b=0;b!==f;++b)l.setTextureCube(r[b]||Va,v[b])}function Yv(A,r,l){const h=this.cache,f=r.length,v=Gm(l,f);ls(h,v)||(A.uniform1iv(this.addr,v),Yr(h,v));for(let b=0;b!==f;++b)l.setTexture2DArray(r[b]||Eu,v[b])}class Kv{constructor(r,l,h){this.id=r,this.addr=h,this.cache=[],this.setValue=function(f){switch(f){case 5126:return Yd;case 35664:return Af;case 35665:return Hm;case 35666:return Wv;case 35674:return bf;case 35675:return Qm;case 35676:return wb;case 5124:case 35670:return xb;case 35667:case 35671:return qv;case 35668:case 35672:return Kd;case 35669:case 35673:return z0;case 5125:return Su;case 36294:return Eb;case 36295:return Sb;case 36296:return V0;case 35678:case 36198:case 36298:case 36306:case 35682:return G0;case 35679:case 36299:case 36307:return H0;case 35680:case 36300:case 36308:case 36293:return Jd;case 36289:case 36303:case 36311:case 36292:return Ga}}(l.type)}}class Wc{constructor(r,l,h){this.id=r,this.addr=h,this.cache=[],this.size=l.size,this.setValue=function(f){switch(f){case 5126:return Eh;case 35664:return zr;case 35665:return Cb;case 35666:return Q0;case 35674:return Mb;case 35675:return Tb;case 35676:return Ib;case 5124:case 35670:return Q1;case 35667:case 35671:return W1;case 35668:case 35672:return q1;case 35669:case 35673:return X1;case 5125:return Y1;case 36294:return K1;case 36295:return W0;case 36296:return Xv;case 35678:case 36198:case 36298:case 36306:case 35682:return Ar;case 35679:case 36299:case 36307:return Pb;case 35680:case 36300:case 36308:case 36293:return Rb;case 36289:case 36303:case 36311:case 36292:return Yv}}(l.type)}}class Db{constructor(r){this.id=r,this.seq=[],this.map={}}setValue(r,l,h){const f=this.seq;for(let v=0,b=f.length;v!==b;++v){const E=f[v];E.setValue(r,l[E.id],h)}}}const Zd=/(\w+)(\])?(\[|\.)?/g;function Sh(A,r){A.seq.push(r),A.map[r.id]=r}function Wm(A,r,l){const h=A.name,f=h.length;for(Zd.lastIndex=0;;){const v=Zd.exec(h),b=Zd.lastIndex;let E=v[1];const D=v[2]==="]",P=v[3];if(D&&(E|=0),P===void 0||P==="["&&b+2===f){Sh(l,P===void 0?new Kv(E,A,r):new Wc(E,A,r));break}{let O=l.map[E];O===void 0&&(O=new Db(E),Sh(l,O)),l=O}}}class $d{constructor(r,l){this.seq=[],this.map={};const h=r.getProgramParameter(l,r.ACTIVE_UNIFORMS);for(let f=0;f<h;++f){const v=r.getActiveUniform(l,f);Wm(v,r.getUniformLocation(l,v.name),this)}}setValue(r,l,h,f){const v=this.map[l];v!==void 0&&v.setValue(r,h,f)}setOptional(r,l,h){const f=l[h];f!==void 0&&this.setValue(r,h,f)}static upload(r,l,h,f){for(let v=0,b=l.length;v!==b;++v){const E=l[v],D=h[E.id];D.needsUpdate!==!1&&E.setValue(r,D.value,f)}}static seqWithValue(r,l){const h=[];for(let f=0,v=r.length;f!==v;++f){const b=r[f];b.id in l&&h.push(b)}return h}}function wf(A,r,l){const h=A.createShader(r);return A.shaderSource(h,l),A.compileShader(h),h}let qm=0;function Bb(A){switch(A){case ta:case fr:return["Linear","( value )"];case Jn:return["sRGB","( value )"];case Wi:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",A),["Linear","( value )"]}}function Ob(A,r,l){const h=A.getShaderParameter(r,A.COMPILE_STATUS),f=A.getShaderInfoLog(r).trim();if(h&&f==="")return"";const v=/ERROR: 0:(\d+)/.exec(f);if(v){const b=parseInt(v[1]);return l.toUpperCase()+`

`+f+`

`+function(E,D){const P=E.split(`
`),O=[],F=Math.max(D-6,0),N=Math.min(D+6,P.length);for(let z=F;z<N;z++){const G=z+1;O.push(`${G===D?">":" "} ${G}: ${P[z]}`)}return O.join(`
`)}(A.getShaderSource(r),b)}return f}function Lb(A,r){const l=Bb(r);return"vec4 "+A+"( vec4 value ) { return "+l[0]+"ToLinear"+l[1]+"; }"}function kb(A,r){const l=Bb(r);return"vec4 "+A+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"}function Ti(A,r){let l;switch(r){case qr:l="Linear";break;case dr:l="Reinhard";break;case ar:l="OptimizedCineon";break;case Ko:l="ACESFilmic";break;case Za:l="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",r),l="Linear"}return"vec3 "+A+"( vec3 color ) { return "+l+"ToneMapping( color ); }"}function ep(A){return A!==""}function Xm(A,r){const l=r.numSpotLightShadows+r.numSpotLightMaps-r.numSpotLightShadowsWithMaps;return A.replace(/NUM_DIR_LIGHTS/g,r.numDirLights).replace(/NUM_SPOT_LIGHTS/g,r.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,r.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,l).replace(/NUM_RECT_AREA_LIGHTS/g,r.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,r.numPointLights).replace(/NUM_HEMI_LIGHTS/g,r.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,r.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,r.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,r.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,r.numPointLightShadows)}function Go(A,r){return A.replace(/NUM_CLIPPING_PLANES/g,r.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,r.numClippingPlanes-r.numClipIntersection)}const J1=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jv(A){return A.replace(J1,Ch)}function Ch(A,r){const l=hi[r];if(l===void 0)throw new Error("Can not resolve #include <"+r+">");return Jv(l)}const ao=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sr(A){return A.replace(ao,Z1)}function Z1(A,r,l,h){let f="";for(let v=parseInt(r);v<parseInt(l);v++)f+=h.replace(/\[\s*i\s*\]/g,"[ "+v+" ]").replace(/UNROLLED_LOOP_INDEX/g,v);return f}function Ub(A){let r="precision "+A.precision+` float;
precision `+A.precision+" int;";return A.precision==="highp"?r+=`
#define HIGH_PRECISION`:A.precision==="mediump"?r+=`
#define MEDIUM_PRECISION`:A.precision==="lowp"&&(r+=`
#define LOW_PRECISION`),r}function Ym(A,r,l,h){const f=A.getContext(),v=l.defines;let b=l.vertexShader,E=l.fragmentShader;const D=function(Oe){let pt="SHADOWMAP_TYPE_BASIC";return Oe.shadowMapType===bt?pt="SHADOWMAP_TYPE_PCF":Oe.shadowMapType===at?pt="SHADOWMAP_TYPE_PCF_SOFT":Oe.shadowMapType===Ie&&(pt="SHADOWMAP_TYPE_VSM"),pt}(l),P=function(Oe){let pt="ENVMAP_TYPE_CUBE";if(Oe.envMap)switch(Oe.envMapMode){case Ae:case Ji:pt="ENVMAP_TYPE_CUBE";break;case xi:pt="ENVMAP_TYPE_CUBE_UV"}return pt}(l),O=function(Oe){let pt="ENVMAP_MODE_REFLECTION";return Oe.envMap&&Oe.envMapMode===Ji&&(pt="ENVMAP_MODE_REFRACTION"),pt}(l),F=function(Oe){let pt="ENVMAP_BLENDING_NONE";if(Oe.envMap)switch(Oe.combine){case In:pt="ENVMAP_BLENDING_MULTIPLY";break;case Qi:pt="ENVMAP_BLENDING_MIX";break;case qi:pt="ENVMAP_BLENDING_ADD"}return pt}(l),N=function(Oe){const pt=Oe.envMapCubeUVHeight;if(pt===null)return null;const ke=Math.log2(pt)-2,Mt=1/pt;return{texelWidth:1/(3*Math.max(Math.pow(2,ke),112)),texelHeight:Mt,maxMip:ke}}(l),z=l.isWebGL2?"":function(Oe){return[Oe.extensionDerivatives||Oe.envMapCubeUVHeight||Oe.bumpMap||Oe.normalMapTangentSpace||Oe.clearcoatNormalMap||Oe.flatShading||Oe.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Oe.extensionFragDepth||Oe.logarithmicDepthBuffer)&&Oe.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Oe.extensionDrawBuffers&&Oe.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Oe.extensionShaderTextureLOD||Oe.envMap||Oe.transmission)&&Oe.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ep).join(`
`)}(l),G=function(Oe){const pt=[];for(const ke in Oe){const Mt=Oe[ke];Mt!==!1&&pt.push("#define "+ke+" "+Mt)}return pt.join(`
`)}(v),W=f.createProgram();let Q,q,K=l.glslVersion?"#version "+l.glslVersion+`
`:"";l.isRawShaderMaterial?(Q=[G].filter(ep).join(`
`),Q.length>0&&(Q+=`
`),q=[z,G].filter(ep).join(`
`),q.length>0&&(q+=`
`)):(Q=[Ub(l),"#define SHADER_NAME "+l.shaderName,G,l.instancing?"#define USE_INSTANCING":"",l.instancingColor?"#define USE_INSTANCING_COLOR":"",l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+O:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",l.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",l.displacementMap?"#define USE_DISPLACEMENTMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",l.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",l.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",l.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",l.mapUv?"#define MAP_UV "+l.mapUv:"",l.alphaMapUv?"#define ALPHAMAP_UV "+l.alphaMapUv:"",l.lightMapUv?"#define LIGHTMAP_UV "+l.lightMapUv:"",l.aoMapUv?"#define AOMAP_UV "+l.aoMapUv:"",l.emissiveMapUv?"#define EMISSIVEMAP_UV "+l.emissiveMapUv:"",l.bumpMapUv?"#define BUMPMAP_UV "+l.bumpMapUv:"",l.normalMapUv?"#define NORMALMAP_UV "+l.normalMapUv:"",l.displacementMapUv?"#define DISPLACEMENTMAP_UV "+l.displacementMapUv:"",l.metalnessMapUv?"#define METALNESSMAP_UV "+l.metalnessMapUv:"",l.roughnessMapUv?"#define ROUGHNESSMAP_UV "+l.roughnessMapUv:"",l.clearcoatMapUv?"#define CLEARCOATMAP_UV "+l.clearcoatMapUv:"",l.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+l.clearcoatNormalMapUv:"",l.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+l.clearcoatRoughnessMapUv:"",l.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+l.iridescenceMapUv:"",l.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+l.iridescenceThicknessMapUv:"",l.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+l.sheenColorMapUv:"",l.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+l.sheenRoughnessMapUv:"",l.specularMapUv?"#define SPECULARMAP_UV "+l.specularMapUv:"",l.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+l.specularColorMapUv:"",l.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+l.specularIntensityMapUv:"",l.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+l.transmissionMapUv:"",l.thicknessMapUv?"#define THICKNESSMAP_UV "+l.thicknessMapUv:"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUv1s?"#define USE_UV1":"",l.vertexUv2s?"#define USE_UV2":"",l.vertexUv3s?"#define USE_UV3":"",l.pointsUvs?"#define USE_POINTS_UV":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&l.flatShading===!1?"#define USE_MORPHNORMALS":"",l.morphColors&&l.isWebGL2?"#define USE_MORPHCOLORS":"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+l.morphTextureStride:"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_COUNT "+l.morphTargetsCount:"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+D:"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ep).join(`
`),q=[z,Ub(l),"#define SHADER_NAME "+l.shaderName,G,l.instancing?"#define USE_INSTANCING":"",l.instancingColor?"#define USE_INSTANCING_COLOR":"",l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.matcap?"#define USE_MATCAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+P:"",l.envMap?"#define "+O:"",l.envMap?"#define "+F:"",N?"#define CUBEUV_TEXEL_WIDTH "+N.texelWidth:"",N?"#define CUBEUV_TEXEL_HEIGHT "+N.texelHeight:"",N?"#define CUBEUV_MAX_MIP "+N.maxMip+".0":"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",l.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.clearcoat?"#define USE_CLEARCOAT":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.iridescence?"#define USE_IRIDESCENCE":"",l.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",l.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",l.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.alphaTest?"#define USE_ALPHATEST":"",l.sheen?"#define USE_SHEEN":"",l.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",l.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors||l.instancingColor?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUv1s?"#define USE_UV1":"",l.vertexUv2s?"#define USE_UV2":"",l.vertexUv3s?"#define USE_UV3":"",l.pointsUvs?"#define USE_POINTS_UV":"",l.gradientMap?"#define USE_GRADIENTMAP":"",l.flatShading?"#define FLAT_SHADED":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+D:"",l.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",l.useLegacyLights?"#define LEGACY_LIGHTS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",l.toneMapping!==Ki?"#define TONE_MAPPING":"",l.toneMapping!==Ki?hi.tonemapping_pars_fragment:"",l.toneMapping!==Ki?Ti("toneMapping",l.toneMapping):"",l.dithering?"#define DITHERING":"",l.opaque?"#define OPAQUE":"",hi.encodings_pars_fragment,kb("linearToOutputTexel",l.outputColorSpace),l.transmissionSamplerMapEncoding?Lb("transmissionSamplerMapTexelToLinear",l.transmissionSamplerMapEncoding):"",l.useDepthPacking?"#define DEPTH_PACKING "+l.depthPacking:"",`
`].filter(ep).join(`
`)),b=Jv(b),b=Xm(b,l),b=Go(b,l),E=Jv(E),E=Xm(E,l),E=Go(E,l),b=sr(b),E=sr(E),l.isWebGL2&&l.isRawShaderMaterial!==!0&&(K=`#version 300 es
`,Q=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Q,q=["#define varying in",l.glslVersion===Uc?"":"layout(location = 0) out highp vec4 pc_fragColor;",l.glslVersion===Uc?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+q);const ne=K+Q+b,be=K+q+E,ve=wf(f,f.VERTEX_SHADER,ne),me=wf(f,f.FRAGMENT_SHADER,be);if(f.attachShader(W,ve),f.attachShader(W,me),l.index0AttributeName!==void 0?f.bindAttribLocation(W,0,l.index0AttributeName):l.morphTargets===!0&&f.bindAttribLocation(W,0,"position"),f.linkProgram(W),A.debug.checkShaderErrors){const Oe=f.getProgramInfoLog(W).trim(),pt=f.getShaderInfoLog(ve).trim(),ke=f.getShaderInfoLog(me).trim();let Mt=!0,Ot=!0;if(f.getProgramParameter(W,f.LINK_STATUS)===!1)if(Mt=!1,typeof A.debug.onShaderError=="function")A.debug.onShaderError(f,W,ve,me);else{const tn=Ob(f,ve,"vertex"),An=Ob(f,me,"fragment");console.error("THREE.WebGLProgram: Shader Error "+f.getError()+" - VALIDATE_STATUS "+f.getProgramParameter(W,f.VALIDATE_STATUS)+`

Program Info Log: `+Oe+`
`+tn+`
`+An)}else Oe!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Oe):pt!==""&&ke!==""||(Ot=!1);Ot&&(this.diagnostics={runnable:Mt,programLog:Oe,vertexShader:{log:pt,prefix:Q},fragmentShader:{log:ke,prefix:q}})}let Pe,tt;return f.deleteShader(ve),f.deleteShader(me),this.getUniforms=function(){return Pe===void 0&&(Pe=new $d(f,W)),Pe},this.getAttributes=function(){return tt===void 0&&(tt=function(Oe,pt){const ke={},Mt=Oe.getProgramParameter(pt,Oe.ACTIVE_ATTRIBUTES);for(let Ot=0;Ot<Mt;Ot++){const tn=Oe.getActiveAttrib(pt,Ot),An=tn.name;let nn=1;tn.type===Oe.FLOAT_MAT2&&(nn=2),tn.type===Oe.FLOAT_MAT3&&(nn=3),tn.type===Oe.FLOAT_MAT4&&(nn=4),ke[An]={type:tn.type,location:Oe.getAttribLocation(pt,An),locationSize:nn}}return ke}(f,W)),tt},this.destroy=function(){h.releaseStatesOfProgram(this),f.deleteProgram(W),this.program=void 0},this.name=l.shaderName,this.id=qm++,this.cacheKey=r,this.usedTimes=1,this.program=W,this.vertexShader=ve,this.fragmentShader=me,this}let q0=0;class Zv{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(r){const l=r.vertexShader,h=r.fragmentShader,f=this._getShaderStage(l),v=this._getShaderStage(h),b=this._getShaderCacheForMaterial(r);return b.has(f)===!1&&(b.add(f),f.usedTimes++),b.has(v)===!1&&(b.add(v),v.usedTimes++),this}remove(r){const l=this.materialCache.get(r);for(const h of l)h.usedTimes--,h.usedTimes===0&&this.shaderCache.delete(h.code);return this.materialCache.delete(r),this}getVertexShaderID(r){return this._getShaderStage(r.vertexShader).id}getFragmentShaderID(r){return this._getShaderStage(r.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(r){const l=this.materialCache;let h=l.get(r);return h===void 0&&(h=new Set,l.set(r,h)),h}_getShaderStage(r){const l=this.shaderCache;let h=l.get(r);return h===void 0&&(h=new $v(r),l.set(r,h)),h}}class $v{constructor(r){this.id=q0++,this.code=r,this.usedTimes=0}}function Ol(A,r,l,h,f,v,b){const E=new Dl,D=new Zv,P=[],O=f.isWebGL2,F=f.logarithmicDepthBuffer,N=f.vertexTextures;let z=f.precision;const G={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function W(Q){return Q===1?"uv1":Q===2?"uv2":Q===3?"uv3":"uv"}return{getParameters:function(Q,q,K,ne,be){const ve=ne.fog,me=be.geometry,Pe=Q.isMeshStandardMaterial?ne.environment:null,tt=(Q.isMeshStandardMaterial?l:r).get(Q.envMap||Pe),Oe=tt&&tt.mapping===xi?tt.image.height:null,pt=G[Q.type];Q.precision!==null&&(z=f.getMaxPrecision(Q.precision),z!==Q.precision&&console.warn("THREE.WebGLProgram.getParameters:",Q.precision,"not supported, using",z,"instead."));const ke=me.morphAttributes.position||me.morphAttributes.normal||me.morphAttributes.color,Mt=ke!==void 0?ke.length:0;let Ot,tn,An,nn,Xt=0;if(me.morphAttributes.position!==void 0&&(Xt=1),me.morphAttributes.normal!==void 0&&(Xt=2),me.morphAttributes.color!==void 0&&(Xt=3),pt){const zg=ga[pt];Ot=zg.vertexShader,tn=zg.fragmentShader}else Ot=Q.vertexShader,tn=Q.fragmentShader,D.update(Q),An=D.getVertexShaderID(Q),nn=D.getFragmentShaderID(Q);const dn=A.getRenderTarget(),gn=A.userData&&A.userData.transmissionRenderTarget,xt=dn?Array.isArray(dn.texture)?dn.texture[0]:dn.texture:null,Wt=be.isInstancedMesh===!0,un=!!Q.map,Zt=!!Q.matcap,_n=!!tt,ai=!!Q.aoMap,De=!!Q.lightMap,we=!!Q.bumpMap,ot=!!Q.normalMap,Ve=!!Q.displacementMap,Re=!!Q.emissiveMap,it=!!Q.metalnessMap,de=!!Q.roughnessMap,Ge=Q.clearcoat>0,ze=Q.iridescence>0,Ut=Q.sheen>0,Lt=Q.transmission>0,qt=Ge&&!!Q.clearcoatMap,vn=Ge&&!!Q.clearcoatNormalMap,Tn=Ge&&!!Q.clearcoatRoughnessMap,ei=ze&&!!Q.iridescenceMap,Cn=ze&&!!Q.iridescenceThicknessMap,mi=Ut&&!!Q.sheenColorMap,li=Ut&&!!Q.sheenRoughnessMap,Qn=!!Q.specularMap,cr=!!Q.specularColorMap,Po=!!Q.specularIntensityMap,ci=Lt&&!!Q.transmissionMap,Xi=Lt&&!!Q.thicknessMap,Vi=!!Q.gradientMap,Fu=!!Q.alphaMap,It=Q.alphaTest>0,Xh=!!Q.extensions,Fg=!!me.attributes.uv1,Wo=!!me.attributes.uv2,jg=!!me.attributes.uv3;return{isWebGL2:O,shaderID:pt,shaderName:Q.type,vertexShader:Ot,fragmentShader:tn,defines:Q.defines,customVertexShaderID:An,customFragmentShaderID:nn,isRawShaderMaterial:Q.isRawShaderMaterial===!0,glslVersion:Q.glslVersion,precision:z,instancing:Wt,instancingColor:Wt&&be.instanceColor!==null,supportsVertexTextures:N,outputColorSpace:dn===null?A.outputColorSpace:dn.isXRRenderTarget===!0||xt.colorSpace&&xt.colorSpace!==Jn?xt.colorSpace:fr,map:un,matcap:Zt,envMap:_n,envMapMode:_n&&tt.mapping,envMapCubeUVHeight:Oe,aoMap:ai,lightMap:De,bumpMap:we,normalMap:ot,displacementMap:N&&Ve,emissiveMap:Re,normalMapObjectSpace:ot&&Q.normalMapType===$p,normalMapTangentSpace:ot&&Q.normalMapType===No,metalnessMap:it,roughnessMap:de,clearcoat:Ge,clearcoatMap:qt,clearcoatNormalMap:vn,clearcoatRoughnessMap:Tn,iridescence:ze,iridescenceMap:ei,iridescenceThicknessMap:Cn,sheen:Ut,sheenColorMap:mi,sheenRoughnessMap:li,specularMap:Qn,specularColorMap:cr,specularIntensityMap:Po,transmission:Lt,transmissionMap:ci,thicknessMap:Xi,transmissionSamplerMapEncoding:gn&&gn.texture.colorSpace||fr,gradientMap:Vi,opaque:Q.transparent===!1&&Q.blending===At&&!(Q.transmission>0),alphaMap:Fu,alphaTest:It,combine:Q.combine,mapUv:un&&W(Q.map.channel),aoMapUv:ai&&W(Q.aoMap.channel),lightMapUv:De&&W(Q.lightMap.channel),bumpMapUv:we&&W(Q.bumpMap.channel),normalMapUv:ot&&W(Q.normalMap.channel),displacementMapUv:Ve&&W(Q.displacementMap.channel),emissiveMapUv:Re&&W(Q.emissiveMap.channel),metalnessMapUv:it&&W(Q.metalnessMap.channel),roughnessMapUv:de&&W(Q.roughnessMap.channel),clearcoatMapUv:qt&&W(Q.clearcoatMap.channel),clearcoatNormalMapUv:vn&&W(Q.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Tn&&W(Q.clearcoatRoughnessMap.channel),iridescenceMapUv:ei&&W(Q.iridescenceMap.channel),iridescenceThicknessMapUv:Cn&&W(Q.iridescenceThicknessMap.channel),sheenColorMapUv:mi&&W(Q.sheenColorMap.channel),sheenRoughnessMapUv:li&&W(Q.sheenRoughnessMap.channel),specularMapUv:Qn&&W(Q.specularMap.channel),specularColorMapUv:cr&&W(Q.specularColorMap.channel),specularIntensityMapUv:Po&&W(Q.specularIntensityMap.channel),transmissionMapUv:ci&&W(Q.transmissionMap.channel),thicknessMapUv:Xi&&W(Q.thicknessMap.channel),alphaMapUv:Fu&&W(Q.alphaMap.channel),vertexTangents:ot&&!!me.attributes.tangent,vertexColors:Q.vertexColors,vertexAlphas:Q.vertexColors===!0&&!!me.attributes.color&&me.attributes.color.itemSize===4,vertexUv1s:Fg,vertexUv2s:Wo,vertexUv3s:jg,pointsUvs:be.isPoints===!0&&!!me.attributes.uv&&(un||Fu),fog:!!ve,useFog:Q.fog===!0,fogExp2:ve&&ve.isFogExp2,flatShading:Q.flatShading===!0,sizeAttenuation:Q.sizeAttenuation===!0,logarithmicDepthBuffer:F,skinning:be.isSkinnedMesh===!0,morphTargets:me.morphAttributes.position!==void 0,morphNormals:me.morphAttributes.normal!==void 0,morphColors:me.morphAttributes.color!==void 0,morphTargetsCount:Mt,morphTextureStride:Xt,numDirLights:q.directional.length,numPointLights:q.point.length,numSpotLights:q.spot.length,numSpotLightMaps:q.spotLightMap.length,numRectAreaLights:q.rectArea.length,numHemiLights:q.hemi.length,numDirLightShadows:q.directionalShadowMap.length,numPointLightShadows:q.pointShadowMap.length,numSpotLightShadows:q.spotShadowMap.length,numSpotLightShadowsWithMaps:q.numSpotLightShadowsWithMaps,numClippingPlanes:b.numPlanes,numClipIntersection:b.numIntersection,dithering:Q.dithering,shadowMapEnabled:A.shadowMap.enabled&&K.length>0,shadowMapType:A.shadowMap.type,toneMapping:Q.toneMapped?A.toneMapping:Ki,useLegacyLights:A.useLegacyLights,premultipliedAlpha:Q.premultipliedAlpha,doubleSided:Q.side===ht,flipSided:Q.side===Ce,useDepthPacking:Q.depthPacking>=0,depthPacking:Q.depthPacking||0,index0AttributeName:Q.index0AttributeName,extensionDerivatives:Xh&&Q.extensions.derivatives===!0,extensionFragDepth:Xh&&Q.extensions.fragDepth===!0,extensionDrawBuffers:Xh&&Q.extensions.drawBuffers===!0,extensionShaderTextureLOD:Xh&&Q.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:O||h.has("EXT_frag_depth"),rendererExtensionDrawBuffers:O||h.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:O||h.has("EXT_shader_texture_lod"),customProgramCacheKey:Q.customProgramCacheKey()}},getProgramCacheKey:function(Q){const q=[];if(Q.shaderID?q.push(Q.shaderID):(q.push(Q.customVertexShaderID),q.push(Q.customFragmentShaderID)),Q.defines!==void 0)for(const K in Q.defines)q.push(K),q.push(Q.defines[K]);return Q.isRawShaderMaterial===!1&&(function(K,ne){K.push(ne.precision),K.push(ne.outputColorSpace),K.push(ne.envMapMode),K.push(ne.envMapCubeUVHeight),K.push(ne.mapUv),K.push(ne.alphaMapUv),K.push(ne.lightMapUv),K.push(ne.aoMapUv),K.push(ne.bumpMapUv),K.push(ne.normalMapUv),K.push(ne.displacementMapUv),K.push(ne.emissiveMapUv),K.push(ne.metalnessMapUv),K.push(ne.roughnessMapUv),K.push(ne.clearcoatMapUv),K.push(ne.clearcoatNormalMapUv),K.push(ne.clearcoatRoughnessMapUv),K.push(ne.iridescenceMapUv),K.push(ne.iridescenceThicknessMapUv),K.push(ne.sheenColorMapUv),K.push(ne.sheenRoughnessMapUv),K.push(ne.specularMapUv),K.push(ne.specularColorMapUv),K.push(ne.specularIntensityMapUv),K.push(ne.transmissionMapUv),K.push(ne.thicknessMapUv),K.push(ne.combine),K.push(ne.fogExp2),K.push(ne.sizeAttenuation),K.push(ne.morphTargetsCount),K.push(ne.morphAttributeCount),K.push(ne.numDirLights),K.push(ne.numPointLights),K.push(ne.numSpotLights),K.push(ne.numSpotLightMaps),K.push(ne.numHemiLights),K.push(ne.numRectAreaLights),K.push(ne.numDirLightShadows),K.push(ne.numPointLightShadows),K.push(ne.numSpotLightShadows),K.push(ne.numSpotLightShadowsWithMaps),K.push(ne.shadowMapType),K.push(ne.toneMapping),K.push(ne.numClippingPlanes),K.push(ne.numClipIntersection),K.push(ne.depthPacking)}(q,Q),function(K,ne){E.disableAll(),ne.isWebGL2&&E.enable(0),ne.supportsVertexTextures&&E.enable(1),ne.instancing&&E.enable(2),ne.instancingColor&&E.enable(3),ne.matcap&&E.enable(4),ne.envMap&&E.enable(5),ne.normalMapObjectSpace&&E.enable(6),ne.normalMapTangentSpace&&E.enable(7),ne.clearcoat&&E.enable(8),ne.iridescence&&E.enable(9),ne.alphaTest&&E.enable(10),ne.vertexColors&&E.enable(11),ne.vertexAlphas&&E.enable(12),ne.vertexUv1s&&E.enable(13),ne.vertexUv2s&&E.enable(14),ne.vertexUv3s&&E.enable(15),ne.vertexTangents&&E.enable(16),K.push(E.mask),E.disableAll(),ne.fog&&E.enable(0),ne.useFog&&E.enable(1),ne.flatShading&&E.enable(2),ne.logarithmicDepthBuffer&&E.enable(3),ne.skinning&&E.enable(4),ne.morphTargets&&E.enable(5),ne.morphNormals&&E.enable(6),ne.morphColors&&E.enable(7),ne.premultipliedAlpha&&E.enable(8),ne.shadowMapEnabled&&E.enable(9),ne.useLegacyLights&&E.enable(10),ne.doubleSided&&E.enable(11),ne.flipSided&&E.enable(12),ne.useDepthPacking&&E.enable(13),ne.dithering&&E.enable(14),ne.transmission&&E.enable(15),ne.sheen&&E.enable(16),ne.opaque&&E.enable(17),ne.pointsUvs&&E.enable(18),K.push(E.mask)}(q,Q),q.push(A.outputColorSpace)),q.push(Q.customProgramCacheKey),q.join()},getUniforms:function(Q){const q=G[Q.type];let K;if(q){const ne=ga[q];K=B0.clone(ne.uniforms)}else K=Q.uniforms;return K},acquireProgram:function(Q,q){let K;for(let ne=0,be=P.length;ne<be;ne++){const ve=P[ne];if(ve.cacheKey===q){K=ve,++K.usedTimes;break}}return K===void 0&&(K=new Ym(A,q,Q,v),P.push(K)),K},releaseProgram:function(Q){if(--Q.usedTimes==0){const q=P.indexOf(Q);P[q]=P[P.length-1],P.pop(),Q.destroy()}},releaseShaderCache:function(Q){D.remove(Q)},programs:P,dispose:function(){D.dispose()}}}function ll(){let A=new WeakMap;return{get:function(r){let l=A.get(r);return l===void 0&&(l={},A.set(r,l)),l},remove:function(r){A.delete(r)},update:function(r,l,h){A.get(r)[l]=h},dispose:function(){A=new WeakMap}}}function Km(A,r){return A.groupOrder!==r.groupOrder?A.groupOrder-r.groupOrder:A.renderOrder!==r.renderOrder?A.renderOrder-r.renderOrder:A.material.id!==r.material.id?A.material.id-r.material.id:A.z!==r.z?A.z-r.z:A.id-r.id}function e_(A,r){return A.groupOrder!==r.groupOrder?A.groupOrder-r.groupOrder:A.renderOrder!==r.renderOrder?A.renderOrder-r.renderOrder:A.z!==r.z?r.z-A.z:A.id-r.id}function Nb(){const A=[];let r=0;const l=[],h=[],f=[];function v(b,E,D,P,O,F){let N=A[r];return N===void 0?(N={id:b.id,object:b,geometry:E,material:D,groupOrder:P,renderOrder:b.renderOrder,z:O,group:F},A[r]=N):(N.id=b.id,N.object=b,N.geometry=E,N.material=D,N.groupOrder=P,N.renderOrder=b.renderOrder,N.z=O,N.group=F),r++,N}return{opaque:l,transmissive:h,transparent:f,init:function(){r=0,l.length=0,h.length=0,f.length=0},push:function(b,E,D,P,O,F){const N=v(b,E,D,P,O,F);D.transmission>0?h.push(N):D.transparent===!0?f.push(N):l.push(N)},unshift:function(b,E,D,P,O,F){const N=v(b,E,D,P,O,F);D.transmission>0?h.unshift(N):D.transparent===!0?f.unshift(N):l.unshift(N)},finish:function(){for(let b=r,E=A.length;b<E;b++){const D=A[b];if(D.id===null)break;D.id=null,D.object=null,D.geometry=null,D.material=null,D.group=null}},sort:function(b,E){l.length>1&&l.sort(b||Km),h.length>1&&h.sort(E||e_),f.length>1&&f.sort(E||e_)}}}function Mh(){let A=new WeakMap;return{get:function(r,l){const h=A.get(r);let f;return h===void 0?(f=new Nb,A.set(r,[f])):l>=h.length?(f=new Nb,h.push(f)):f=h[l],f},dispose:function(){A=new WeakMap}}}function X0(){const A={};return{get:function(r){if(A[r.id]!==void 0)return A[r.id];let l;switch(r.type){case"DirectionalLight":l={direction:new fe,color:new xn};break;case"SpotLight":l={position:new fe,direction:new fe,color:new xn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":l={position:new fe,color:new xn,distance:0,decay:0};break;case"HemisphereLight":l={direction:new fe,skyColor:new xn,groundColor:new xn};break;case"RectAreaLight":l={color:new xn,position:new fe,halfWidth:new fe,halfHeight:new fe}}return A[r.id]=l,l}}}let Y0=0;function K0(A,r){return(r.castShadow?2:0)-(A.castShadow?2:0)+(r.map?1:0)-(A.map?1:0)}function J0(A,r){const l=new X0,h=function(){const D={};return{get:function(P){if(D[P.id]!==void 0)return D[P.id];let O;switch(P.type){case"DirectionalLight":case"SpotLight":O={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ht};break;case"PointLight":O={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ht,shadowCameraNear:1,shadowCameraFar:1e3}}return D[P.id]=O,O}}}(),f={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let D=0;D<9;D++)f.probe.push(new fe);const v=new fe,b=new si,E=new si;return{setup:function(D,P){let O=0,F=0,N=0;for(let Oe=0;Oe<9;Oe++)f.probe[Oe].set(0,0,0);let z=0,G=0,W=0,Q=0,q=0,K=0,ne=0,be=0,ve=0,me=0;D.sort(K0);const Pe=P===!0?Math.PI:1;for(let Oe=0,pt=D.length;Oe<pt;Oe++){const ke=D[Oe],Mt=ke.color,Ot=ke.intensity,tn=ke.distance,An=ke.shadow&&ke.shadow.map?ke.shadow.map.texture:null;if(ke.isAmbientLight)O+=Mt.r*Ot*Pe,F+=Mt.g*Ot*Pe,N+=Mt.b*Ot*Pe;else if(ke.isLightProbe)for(let nn=0;nn<9;nn++)f.probe[nn].addScaledVector(ke.sh.coefficients[nn],Ot);else if(ke.isDirectionalLight){const nn=l.get(ke);if(nn.color.copy(ke.color).multiplyScalar(ke.intensity*Pe),ke.castShadow){const Xt=ke.shadow,dn=h.get(ke);dn.shadowBias=Xt.bias,dn.shadowNormalBias=Xt.normalBias,dn.shadowRadius=Xt.radius,dn.shadowMapSize=Xt.mapSize,f.directionalShadow[z]=dn,f.directionalShadowMap[z]=An,f.directionalShadowMatrix[z]=ke.shadow.matrix,K++}f.directional[z]=nn,z++}else if(ke.isSpotLight){const nn=l.get(ke);nn.position.setFromMatrixPosition(ke.matrixWorld),nn.color.copy(Mt).multiplyScalar(Ot*Pe),nn.distance=tn,nn.coneCos=Math.cos(ke.angle),nn.penumbraCos=Math.cos(ke.angle*(1-ke.penumbra)),nn.decay=ke.decay,f.spot[W]=nn;const Xt=ke.shadow;if(ke.map&&(f.spotLightMap[ve]=ke.map,ve++,Xt.updateMatrices(ke),ke.castShadow&&me++),f.spotLightMatrix[W]=Xt.matrix,ke.castShadow){const dn=h.get(ke);dn.shadowBias=Xt.bias,dn.shadowNormalBias=Xt.normalBias,dn.shadowRadius=Xt.radius,dn.shadowMapSize=Xt.mapSize,f.spotShadow[W]=dn,f.spotShadowMap[W]=An,be++}W++}else if(ke.isRectAreaLight){const nn=l.get(ke);nn.color.copy(Mt).multiplyScalar(Ot),nn.halfWidth.set(.5*ke.width,0,0),nn.halfHeight.set(0,.5*ke.height,0),f.rectArea[Q]=nn,Q++}else if(ke.isPointLight){const nn=l.get(ke);if(nn.color.copy(ke.color).multiplyScalar(ke.intensity*Pe),nn.distance=ke.distance,nn.decay=ke.decay,ke.castShadow){const Xt=ke.shadow,dn=h.get(ke);dn.shadowBias=Xt.bias,dn.shadowNormalBias=Xt.normalBias,dn.shadowRadius=Xt.radius,dn.shadowMapSize=Xt.mapSize,dn.shadowCameraNear=Xt.camera.near,dn.shadowCameraFar=Xt.camera.far,f.pointShadow[G]=dn,f.pointShadowMap[G]=An,f.pointShadowMatrix[G]=ke.shadow.matrix,ne++}f.point[G]=nn,G++}else if(ke.isHemisphereLight){const nn=l.get(ke);nn.skyColor.copy(ke.color).multiplyScalar(Ot*Pe),nn.groundColor.copy(ke.groundColor).multiplyScalar(Ot*Pe),f.hemi[q]=nn,q++}}Q>0&&(r.isWebGL2||A.has("OES_texture_float_linear")===!0?(f.rectAreaLTC1=mn.LTC_FLOAT_1,f.rectAreaLTC2=mn.LTC_FLOAT_2):A.has("OES_texture_half_float_linear")===!0?(f.rectAreaLTC1=mn.LTC_HALF_1,f.rectAreaLTC2=mn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),f.ambient[0]=O,f.ambient[1]=F,f.ambient[2]=N;const tt=f.hash;tt.directionalLength===z&&tt.pointLength===G&&tt.spotLength===W&&tt.rectAreaLength===Q&&tt.hemiLength===q&&tt.numDirectionalShadows===K&&tt.numPointShadows===ne&&tt.numSpotShadows===be&&tt.numSpotMaps===ve||(f.directional.length=z,f.spot.length=W,f.rectArea.length=Q,f.point.length=G,f.hemi.length=q,f.directionalShadow.length=K,f.directionalShadowMap.length=K,f.pointShadow.length=ne,f.pointShadowMap.length=ne,f.spotShadow.length=be,f.spotShadowMap.length=be,f.directionalShadowMatrix.length=K,f.pointShadowMatrix.length=ne,f.spotLightMatrix.length=be+ve-me,f.spotLightMap.length=ve,f.numSpotLightShadowsWithMaps=me,tt.directionalLength=z,tt.pointLength=G,tt.spotLength=W,tt.rectAreaLength=Q,tt.hemiLength=q,tt.numDirectionalShadows=K,tt.numPointShadows=ne,tt.numSpotShadows=be,tt.numSpotMaps=ve,f.version=Y0++)},setupView:function(D,P){let O=0,F=0,N=0,z=0,G=0;const W=P.matrixWorldInverse;for(let Q=0,q=D.length;Q<q;Q++){const K=D[Q];if(K.isDirectionalLight){const ne=f.directional[O];ne.direction.setFromMatrixPosition(K.matrixWorld),v.setFromMatrixPosition(K.target.matrixWorld),ne.direction.sub(v),ne.direction.transformDirection(W),O++}else if(K.isSpotLight){const ne=f.spot[N];ne.position.setFromMatrixPosition(K.matrixWorld),ne.position.applyMatrix4(W),ne.direction.setFromMatrixPosition(K.matrixWorld),v.setFromMatrixPosition(K.target.matrixWorld),ne.direction.sub(v),ne.direction.transformDirection(W),N++}else if(K.isRectAreaLight){const ne=f.rectArea[z];ne.position.setFromMatrixPosition(K.matrixWorld),ne.position.applyMatrix4(W),E.identity(),b.copy(K.matrixWorld),b.premultiply(W),E.extractRotation(b),ne.halfWidth.set(.5*K.width,0,0),ne.halfHeight.set(0,.5*K.height,0),ne.halfWidth.applyMatrix4(E),ne.halfHeight.applyMatrix4(E),z++}else if(K.isPointLight){const ne=f.point[F];ne.position.setFromMatrixPosition(K.matrixWorld),ne.position.applyMatrix4(W),F++}else if(K.isHemisphereLight){const ne=f.hemi[G];ne.direction.setFromMatrixPosition(K.matrixWorld),ne.direction.transformDirection(W),G++}}},state:f}}function Fb(A,r){const l=new J0(A,r),h=[],f=[];return{init:function(){h.length=0,f.length=0},state:{lightsArray:h,shadowsArray:f,lights:l},setupLights:function(v){l.setup(h,v)},setupLightsView:function(v){l.setupView(h,v)},pushLight:function(v){h.push(v)},pushShadow:function(v){f.push(v)}}}function $1(A,r){let l=new WeakMap;return{get:function(h,f=0){const v=l.get(h);let b;return v===void 0?(b=new Fb(A,r),l.set(h,[b])):f>=v.length?(b=new Fb(A,r),v.push(b)):b=v[f],b},dispose:function(){l=new WeakMap}}}class Z0 extends ks{constructor(r){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=bs,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(r)}copy(r){return super.copy(r),this.depthPacking=r.depthPacking,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this}}class $0 extends ks{constructor(r){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(r)}copy(r){return super.copy(r),this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this}}const jb=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Jm=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function zb(A,r,l){let h=new km;const f=new Ht,v=new Ht,b=new ji,E=new Z0({depthPacking:Br}),D=new $0,P={},O=l.maxTextureSize,F={[et]:Ce,[Ce]:et,[ht]:ht},N=new sl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ht},radius:{value:4}},vertexShader:jb,fragmentShader:Jm}),z=N.clone();z.defines.HORIZONTAL_PASS=1;const G=new Y;G.setAttribute("position",new tr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const W=new Us(G,N),Q=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=bt;let q=this.type;function K(ve,me){const Pe=r.update(W);N.defines.VSM_SAMPLES!==ve.blurSamples&&(N.defines.VSM_SAMPLES=ve.blurSamples,z.defines.VSM_SAMPLES=ve.blurSamples,N.needsUpdate=!0,z.needsUpdate=!0),ve.mapPass===null&&(ve.mapPass=new yo(f.x,f.y)),N.uniforms.shadow_pass.value=ve.map.texture,N.uniforms.resolution.value=ve.mapSize,N.uniforms.radius.value=ve.radius,A.setRenderTarget(ve.mapPass),A.clear(),A.renderBufferDirect(me,null,Pe,N,W,null),z.uniforms.shadow_pass.value=ve.mapPass.texture,z.uniforms.resolution.value=ve.mapSize,z.uniforms.radius.value=ve.radius,A.setRenderTarget(ve.map),A.clear(),A.renderBufferDirect(me,null,Pe,z,W,null)}function ne(ve,me,Pe,tt){let Oe=null;const pt=Pe.isPointLight===!0?ve.customDistanceMaterial:ve.customDepthMaterial;if(pt!==void 0)Oe=pt;else if(Oe=Pe.isPointLight===!0?D:E,A.localClippingEnabled&&me.clipShadows===!0&&Array.isArray(me.clippingPlanes)&&me.clippingPlanes.length!==0||me.displacementMap&&me.displacementScale!==0||me.alphaMap&&me.alphaTest>0||me.map&&me.alphaTest>0){const ke=Oe.uuid,Mt=me.uuid;let Ot=P[ke];Ot===void 0&&(Ot={},P[ke]=Ot);let tn=Ot[Mt];tn===void 0&&(tn=Oe.clone(),Ot[Mt]=tn),Oe=tn}return Oe.visible=me.visible,Oe.wireframe=me.wireframe,Oe.side=tt===Ie?me.shadowSide!==null?me.shadowSide:me.side:me.shadowSide!==null?me.shadowSide:F[me.side],Oe.alphaMap=me.alphaMap,Oe.alphaTest=me.alphaTest,Oe.map=me.map,Oe.clipShadows=me.clipShadows,Oe.clippingPlanes=me.clippingPlanes,Oe.clipIntersection=me.clipIntersection,Oe.displacementMap=me.displacementMap,Oe.displacementScale=me.displacementScale,Oe.displacementBias=me.displacementBias,Oe.wireframeLinewidth=me.wireframeLinewidth,Oe.linewidth=me.linewidth,Pe.isPointLight===!0&&Oe.isMeshDistanceMaterial===!0&&(A.properties.get(Oe).light=Pe),Oe}function be(ve,me,Pe,tt,Oe){if(ve.visible===!1)return;if(ve.layers.test(me.layers)&&(ve.isMesh||ve.isLine||ve.isPoints)&&(ve.castShadow||ve.receiveShadow&&Oe===Ie)&&(!ve.frustumCulled||h.intersectsObject(ve))){ve.modelViewMatrix.multiplyMatrices(Pe.matrixWorldInverse,ve.matrixWorld);const ke=r.update(ve),Mt=ve.material;if(Array.isArray(Mt)){const Ot=ke.groups;for(let tn=0,An=Ot.length;tn<An;tn++){const nn=Ot[tn],Xt=Mt[nn.materialIndex];if(Xt&&Xt.visible){const dn=ne(ve,Xt,tt,Oe);A.renderBufferDirect(Pe,null,ke,dn,ve,nn)}}}else if(Mt.visible){const Ot=ne(ve,Mt,tt,Oe);A.renderBufferDirect(Pe,null,ke,Ot,ve,null)}}const pt=ve.children;for(let ke=0,Mt=pt.length;ke<Mt;ke++)be(pt[ke],me,Pe,tt,Oe)}this.render=function(ve,me,Pe){if(Q.enabled===!1||Q.autoUpdate===!1&&Q.needsUpdate===!1||ve.length===0)return;const tt=A.getRenderTarget(),Oe=A.getActiveCubeFace(),pt=A.getActiveMipmapLevel(),ke=A.state;ke.setBlending(Ue),ke.buffers.color.setClear(1,1,1,1),ke.buffers.depth.setTest(!0),ke.setScissorTest(!1);const Mt=q!==Ie&&this.type===Ie,Ot=q===Ie&&this.type!==Ie;for(let tn=0,An=ve.length;tn<An;tn++){const nn=ve[tn],Xt=nn.shadow;if(Xt===void 0){console.warn("THREE.WebGLShadowMap:",nn,"has no shadow.");continue}if(Xt.autoUpdate===!1&&Xt.needsUpdate===!1)continue;f.copy(Xt.mapSize);const dn=Xt.getFrameExtents();if(f.multiply(dn),v.copy(Xt.mapSize),(f.x>O||f.y>O)&&(f.x>O&&(v.x=Math.floor(O/dn.x),f.x=v.x*dn.x,Xt.mapSize.x=v.x),f.y>O&&(v.y=Math.floor(O/dn.y),f.y=v.y*dn.y,Xt.mapSize.y=v.y)),Xt.map===null||Mt===!0||Ot===!0){const xt=this.type!==Ie?{minFilter:vr,magFilter:vr}:{};Xt.map!==null&&Xt.map.dispose(),Xt.map=new yo(f.x,f.y,xt),Xt.map.texture.name=nn.name+".shadowMap",Xt.camera.updateProjectionMatrix()}A.setRenderTarget(Xt.map),A.clear();const gn=Xt.getViewportCount();for(let xt=0;xt<gn;xt++){const Wt=Xt.getViewport(xt);b.set(v.x*Wt.x,v.y*Wt.y,v.x*Wt.z,v.y*Wt.w),ke.viewport(b),Xt.updateMatrices(nn,xt),h=Xt.getFrustum(),be(me,Pe,Xt.camera,nn,this.type)}Xt.isPointLightShadow!==!0&&this.type===Ie&&K(Xt,Pe),Xt.needsUpdate=!1}q=this.type,Q.needsUpdate=!1,A.setRenderTarget(tt,Oe,pt)}}function ey(A,r,l){const h=l.isWebGL2,f=new function(){let de=!1;const Ge=new ji;let ze=null;const Ut=new ji(0,0,0,0);return{setMask:function(Lt){ze===Lt||de||(A.colorMask(Lt,Lt,Lt,Lt),ze=Lt)},setLocked:function(Lt){de=Lt},setClear:function(Lt,qt,vn,Tn,ei){ei===!0&&(Lt*=Tn,qt*=Tn,vn*=Tn),Ge.set(Lt,qt,vn,Tn),Ut.equals(Ge)===!1&&(A.clearColor(Lt,qt,vn,Tn),Ut.copy(Ge))},reset:function(){de=!1,ze=null,Ut.set(-1,0,0,0)}}},v=new function(){let de=!1,Ge=null,ze=null,Ut=null;return{setTest:function(Lt){Lt?_n(A.DEPTH_TEST):ai(A.DEPTH_TEST)},setMask:function(Lt){Ge===Lt||de||(A.depthMask(Lt),Ge=Lt)},setFunc:function(Lt){if(ze!==Lt){switch(Lt){case Fe:A.depthFunc(A.NEVER);break;case se:A.depthFunc(A.ALWAYS);break;case Me:A.depthFunc(A.LESS);break;case Ne:A.depthFunc(A.LEQUAL);break;case Vt:A.depthFunc(A.EQUAL);break;case Kt:A.depthFunc(A.GEQUAL);break;case fn:A.depthFunc(A.GREATER);break;case ri:A.depthFunc(A.NOTEQUAL);break;default:A.depthFunc(A.LEQUAL)}ze=Lt}},setLocked:function(Lt){de=Lt},setClear:function(Lt){Ut!==Lt&&(A.clearDepth(Lt),Ut=Lt)},reset:function(){de=!1,Ge=null,ze=null,Ut=null}}},b=new function(){let de=!1,Ge=null,ze=null,Ut=null,Lt=null,qt=null,vn=null,Tn=null,ei=null;return{setTest:function(Cn){de||(Cn?_n(A.STENCIL_TEST):ai(A.STENCIL_TEST))},setMask:function(Cn){Ge===Cn||de||(A.stencilMask(Cn),Ge=Cn)},setFunc:function(Cn,mi,li){ze===Cn&&Ut===mi&&Lt===li||(A.stencilFunc(Cn,mi,li),ze=Cn,Ut=mi,Lt=li)},setOp:function(Cn,mi,li){qt===Cn&&vn===mi&&Tn===li||(A.stencilOp(Cn,mi,li),qt=Cn,vn=mi,Tn=li)},setLocked:function(Cn){de=Cn},setClear:function(Cn){ei!==Cn&&(A.clearStencil(Cn),ei=Cn)},reset:function(){de=!1,Ge=null,ze=null,Ut=null,Lt=null,qt=null,vn=null,Tn=null,ei=null}}},E=new WeakMap,D=new WeakMap;let P={},O={},F=new WeakMap,N=[],z=null,G=!1,W=null,Q=null,q=null,K=null,ne=null,be=null,ve=null,me=!1,Pe=null,tt=null,Oe=null,pt=null,ke=null;const Mt=A.getParameter(A.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ot=!1,tn=0;const An=A.getParameter(A.VERSION);An.indexOf("WebGL")!==-1?(tn=parseFloat(/^WebGL (\d)/.exec(An)[1]),Ot=tn>=1):An.indexOf("OpenGL ES")!==-1&&(tn=parseFloat(/^OpenGL ES (\d)/.exec(An)[1]),Ot=tn>=2);let nn=null,Xt={};const dn=A.getParameter(A.SCISSOR_BOX),gn=A.getParameter(A.VIEWPORT),xt=new ji().fromArray(dn),Wt=new ji().fromArray(gn);function un(de,Ge,ze,Ut){const Lt=new Uint8Array(4),qt=A.createTexture();A.bindTexture(de,qt),A.texParameteri(de,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(de,A.TEXTURE_MAG_FILTER,A.NEAREST);for(let vn=0;vn<ze;vn++)!h||de!==A.TEXTURE_3D&&de!==A.TEXTURE_2D_ARRAY?A.texImage2D(Ge+vn,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,Lt):A.texImage3D(Ge,0,A.RGBA,1,1,Ut,0,A.RGBA,A.UNSIGNED_BYTE,Lt);return qt}const Zt={};function _n(de){P[de]!==!0&&(A.enable(de),P[de]=!0)}function ai(de){P[de]!==!1&&(A.disable(de),P[de]=!1)}Zt[A.TEXTURE_2D]=un(A.TEXTURE_2D,A.TEXTURE_2D,1),Zt[A.TEXTURE_CUBE_MAP]=un(A.TEXTURE_CUBE_MAP,A.TEXTURE_CUBE_MAP_POSITIVE_X,6),h&&(Zt[A.TEXTURE_2D_ARRAY]=un(A.TEXTURE_2D_ARRAY,A.TEXTURE_2D_ARRAY,1,1),Zt[A.TEXTURE_3D]=un(A.TEXTURE_3D,A.TEXTURE_3D,1,1)),f.setClear(0,0,0,1),v.setClear(1),b.setClear(0),_n(A.DEPTH_TEST),v.setFunc(Ne),Ve(!1),Re(ft),_n(A.CULL_FACE),ot(Ue);const De={[$]:A.FUNC_ADD,[ae]:A.FUNC_SUBTRACT,[Le]:A.FUNC_REVERSE_SUBTRACT};if(h)De[J]=A.MIN,De[te]=A.MAX;else{const de=r.get("EXT_blend_minmax");de!==null&&(De[J]=de.MIN_EXT,De[te]=de.MAX_EXT)}const we={[ce]:A.ZERO,[pe]:A.ONE,[je]:A.SRC_COLOR,[wt]:A.SRC_ALPHA,[Ft]:A.SRC_ALPHA_SATURATE,[Tt]:A.DST_COLOR,[Dt]:A.DST_ALPHA,[ct]:A.ONE_MINUS_SRC_COLOR,[_t]:A.ONE_MINUS_SRC_ALPHA,[Ct]:A.ONE_MINUS_DST_COLOR,[$e]:A.ONE_MINUS_DST_ALPHA};function ot(de,Ge,ze,Ut,Lt,qt,vn,Tn){if(de!==Ue){if(G===!1&&(_n(A.BLEND),G=!0),de===Z)Lt=Lt||Ge,qt=qt||ze,vn=vn||Ut,Ge===Q&&Lt===ne||(A.blendEquationSeparate(De[Ge],De[Lt]),Q=Ge,ne=Lt),ze===q&&Ut===K&&qt===be&&vn===ve||(A.blendFuncSeparate(we[ze],we[Ut],we[qt],we[vn]),q=ze,K=Ut,be=qt,ve=vn),W=de,me=!1;else if(de!==W||Tn!==me){if(Q===$&&ne===$||(A.blendEquation(A.FUNC_ADD),Q=$,ne=$),Tn)switch(de){case At:A.blendFuncSeparate(A.ONE,A.ONE_MINUS_SRC_ALPHA,A.ONE,A.ONE_MINUS_SRC_ALPHA);break;case Bt:A.blendFunc(A.ONE,A.ONE);break;case Be:A.blendFuncSeparate(A.ZERO,A.ONE_MINUS_SRC_COLOR,A.ZERO,A.ONE);break;case Qe:A.blendFuncSeparate(A.ZERO,A.SRC_COLOR,A.ZERO,A.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",de)}else switch(de){case At:A.blendFuncSeparate(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA,A.ONE,A.ONE_MINUS_SRC_ALPHA);break;case Bt:A.blendFunc(A.SRC_ALPHA,A.ONE);break;case Be:A.blendFuncSeparate(A.ZERO,A.ONE_MINUS_SRC_COLOR,A.ZERO,A.ONE);break;case Qe:A.blendFunc(A.ZERO,A.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",de)}q=null,K=null,be=null,ve=null,W=de,me=Tn}}else G===!0&&(ai(A.BLEND),G=!1)}function Ve(de){Pe!==de&&(de?A.frontFace(A.CW):A.frontFace(A.CCW),Pe=de)}function Re(de){de!==He?(_n(A.CULL_FACE),de!==tt&&(de===ft?A.cullFace(A.BACK):de===Xe?A.cullFace(A.FRONT):A.cullFace(A.FRONT_AND_BACK))):ai(A.CULL_FACE),tt=de}function it(de,Ge,ze){de?(_n(A.POLYGON_OFFSET_FILL),pt===Ge&&ke===ze||(A.polygonOffset(Ge,ze),pt=Ge,ke=ze)):ai(A.POLYGON_OFFSET_FILL)}return{buffers:{color:f,depth:v,stencil:b},enable:_n,disable:ai,bindFramebuffer:function(de,Ge){return O[de]!==Ge&&(A.bindFramebuffer(de,Ge),O[de]=Ge,h&&(de===A.DRAW_FRAMEBUFFER&&(O[A.FRAMEBUFFER]=Ge),de===A.FRAMEBUFFER&&(O[A.DRAW_FRAMEBUFFER]=Ge)),!0)},drawBuffers:function(de,Ge){let ze=N,Ut=!1;if(de)if(ze=F.get(Ge),ze===void 0&&(ze=[],F.set(Ge,ze)),de.isWebGLMultipleRenderTargets){const Lt=de.texture;if(ze.length!==Lt.length||ze[0]!==A.COLOR_ATTACHMENT0){for(let qt=0,vn=Lt.length;qt<vn;qt++)ze[qt]=A.COLOR_ATTACHMENT0+qt;ze.length=Lt.length,Ut=!0}}else ze[0]!==A.COLOR_ATTACHMENT0&&(ze[0]=A.COLOR_ATTACHMENT0,Ut=!0);else ze[0]!==A.BACK&&(ze[0]=A.BACK,Ut=!0);Ut&&(l.isWebGL2?A.drawBuffers(ze):r.get("WEBGL_draw_buffers").drawBuffersWEBGL(ze))},useProgram:function(de){return z!==de&&(A.useProgram(de),z=de,!0)},setBlending:ot,setMaterial:function(de,Ge){de.side===ht?ai(A.CULL_FACE):_n(A.CULL_FACE);let ze=de.side===Ce;Ge&&(ze=!ze),Ve(ze),de.blending===At&&de.transparent===!1?ot(Ue):ot(de.blending,de.blendEquation,de.blendSrc,de.blendDst,de.blendEquationAlpha,de.blendSrcAlpha,de.blendDstAlpha,de.premultipliedAlpha),v.setFunc(de.depthFunc),v.setTest(de.depthTest),v.setMask(de.depthWrite),f.setMask(de.colorWrite);const Ut=de.stencilWrite;b.setTest(Ut),Ut&&(b.setMask(de.stencilWriteMask),b.setFunc(de.stencilFunc,de.stencilRef,de.stencilFuncMask),b.setOp(de.stencilFail,de.stencilZFail,de.stencilZPass)),it(de.polygonOffset,de.polygonOffsetFactor,de.polygonOffsetUnits),de.alphaToCoverage===!0?_n(A.SAMPLE_ALPHA_TO_COVERAGE):ai(A.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ve,setCullFace:Re,setLineWidth:function(de){de!==Oe&&(Ot&&A.lineWidth(de),Oe=de)},setPolygonOffset:it,setScissorTest:function(de){de?_n(A.SCISSOR_TEST):ai(A.SCISSOR_TEST)},activeTexture:function(de){de===void 0&&(de=A.TEXTURE0+Mt-1),nn!==de&&(A.activeTexture(de),nn=de)},bindTexture:function(de,Ge,ze){ze===void 0&&(ze=nn===null?A.TEXTURE0+Mt-1:nn);let Ut=Xt[ze];Ut===void 0&&(Ut={type:void 0,texture:void 0},Xt[ze]=Ut),Ut.type===de&&Ut.texture===Ge||(nn!==ze&&(A.activeTexture(ze),nn=ze),A.bindTexture(de,Ge||Zt[de]),Ut.type=de,Ut.texture=Ge)},unbindTexture:function(){const de=Xt[nn];de!==void 0&&de.type!==void 0&&(A.bindTexture(de.type,null),de.type=void 0,de.texture=void 0)},compressedTexImage2D:function(){try{A.compressedTexImage2D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},compressedTexImage3D:function(){try{A.compressedTexImage3D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},texImage2D:function(){try{A.texImage2D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},texImage3D:function(){try{A.texImage3D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},updateUBOMapping:function(de,Ge){let ze=D.get(Ge);ze===void 0&&(ze=new WeakMap,D.set(Ge,ze));let Ut=ze.get(de);Ut===void 0&&(Ut=A.getUniformBlockIndex(Ge,de.name),ze.set(de,Ut))},uniformBlockBinding:function(de,Ge){const ze=D.get(Ge).get(de);E.get(Ge)!==ze&&(A.uniformBlockBinding(Ge,ze,de.__bindingPointIndex),E.set(Ge,ze))},texStorage2D:function(){try{A.texStorage2D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},texStorage3D:function(){try{A.texStorage3D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},texSubImage2D:function(){try{A.texSubImage2D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},texSubImage3D:function(){try{A.texSubImage3D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},compressedTexSubImage2D:function(){try{A.compressedTexSubImage2D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},compressedTexSubImage3D:function(){try{A.compressedTexSubImage3D.apply(A,arguments)}catch(de){console.error("THREE.WebGLState:",de)}},scissor:function(de){xt.equals(de)===!1&&(A.scissor(de.x,de.y,de.z,de.w),xt.copy(de))},viewport:function(de){Wt.equals(de)===!1&&(A.viewport(de.x,de.y,de.z,de.w),Wt.copy(de))},reset:function(){A.disable(A.BLEND),A.disable(A.CULL_FACE),A.disable(A.DEPTH_TEST),A.disable(A.POLYGON_OFFSET_FILL),A.disable(A.SCISSOR_TEST),A.disable(A.STENCIL_TEST),A.disable(A.SAMPLE_ALPHA_TO_COVERAGE),A.blendEquation(A.FUNC_ADD),A.blendFunc(A.ONE,A.ZERO),A.blendFuncSeparate(A.ONE,A.ZERO,A.ONE,A.ZERO),A.colorMask(!0,!0,!0,!0),A.clearColor(0,0,0,0),A.depthMask(!0),A.depthFunc(A.LESS),A.clearDepth(1),A.stencilMask(4294967295),A.stencilFunc(A.ALWAYS,0,4294967295),A.stencilOp(A.KEEP,A.KEEP,A.KEEP),A.clearStencil(0),A.cullFace(A.BACK),A.frontFace(A.CCW),A.polygonOffset(0,0),A.activeTexture(A.TEXTURE0),A.bindFramebuffer(A.FRAMEBUFFER,null),h===!0&&(A.bindFramebuffer(A.DRAW_FRAMEBUFFER,null),A.bindFramebuffer(A.READ_FRAMEBUFFER,null)),A.useProgram(null),A.lineWidth(1),A.scissor(0,0,A.canvas.width,A.canvas.height),A.viewport(0,0,A.canvas.width,A.canvas.height),P={},nn=null,Xt={},O={},F=new WeakMap,N=[],z=null,G=!1,W=null,Q=null,q=null,K=null,ne=null,be=null,ve=null,me=!1,Pe=null,tt=null,Oe=null,pt=null,ke=null,xt.set(0,0,A.canvas.width,A.canvas.height),Wt.set(0,0,A.canvas.width,A.canvas.height),f.reset(),v.reset(),b.reset()}}}function Th(A,r,l,h,f,v,b){const E=f.isWebGL2,D=f.maxTextures,P=f.maxCubemapSize,O=f.maxTextureSize,F=f.maxSamples,N=r.has("WEBGL_multisampled_render_to_texture")?r.get("WEBGL_multisampled_render_to_texture"):null,z=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),G=new WeakMap;let W;const Q=new WeakMap;let q=!1;try{q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function K(De,we){return q?new OffscreenCanvas(De,we):ka("canvas")}function ne(De,we,ot,Ve){let Re=1;if((De.width>Ve||De.height>Ve)&&(Re=Ve/Math.max(De.width,De.height)),Re<1||we===!0){if(typeof HTMLImageElement<"u"&&De instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&De instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&De instanceof ImageBitmap){const it=we?cc:Math.floor,de=it(Re*De.width),Ge=it(Re*De.height);W===void 0&&(W=K(de,Ge));const ze=ot?K(de,Ge):W;return ze.width=de,ze.height=Ge,ze.getContext("2d").drawImage(De,0,0,de,Ge),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+De.width+"x"+De.height+") to ("+de+"x"+Ge+")."),ze}return"data"in De&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+De.width+"x"+De.height+")."),De}return De}function be(De){return hu(De.width)&&hu(De.height)}function ve(De,we){return De.generateMipmaps&&we&&De.minFilter!==vr&&De.minFilter!==_r}function me(De){A.generateMipmap(De)}function Pe(De,we,ot,Ve,Re=!1){if(E===!1)return we;if(De!==null){if(A[De]!==void 0)return A[De];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+De+"'")}let it=we;return we===A.RED&&(ot===A.FLOAT&&(it=A.R32F),ot===A.HALF_FLOAT&&(it=A.R16F),ot===A.UNSIGNED_BYTE&&(it=A.R8)),we===A.RG&&(ot===A.FLOAT&&(it=A.RG32F),ot===A.HALF_FLOAT&&(it=A.RG16F),ot===A.UNSIGNED_BYTE&&(it=A.RG8)),we===A.RGBA&&(ot===A.FLOAT&&(it=A.RGBA32F),ot===A.HALF_FLOAT&&(it=A.RGBA16F),ot===A.UNSIGNED_BYTE&&(it=Ve===Jn&&Re===!1?A.SRGB8_ALPHA8:A.RGBA8),ot===A.UNSIGNED_SHORT_4_4_4_4&&(it=A.RGBA4),ot===A.UNSIGNED_SHORT_5_5_5_1&&(it=A.RGB5_A1)),it!==A.R16F&&it!==A.R32F&&it!==A.RG16F&&it!==A.RG32F&&it!==A.RGBA16F&&it!==A.RGBA32F||r.get("EXT_color_buffer_float"),it}function tt(De,we,ot){return ve(De,ot)===!0||De.isFramebufferTexture&&De.minFilter!==vr&&De.minFilter!==_r?Math.log2(Math.max(we.width,we.height))+1:De.mipmaps!==void 0&&De.mipmaps.length>0?De.mipmaps.length:De.isCompressedTexture&&Array.isArray(De.image)?we.mipmaps.length:1}function Oe(De){return De===vr||De===Jo||De===Al?A.NEAREST:A.LINEAR}function pt(De){const we=De.target;we.removeEventListener("dispose",pt),function(ot){const Ve=h.get(ot);if(Ve.__webglInit===void 0)return;const Re=ot.source,it=Q.get(Re);if(it){const de=it[Ve.__cacheKey];de.usedTimes--,de.usedTimes===0&&Mt(ot),Object.keys(it).length===0&&Q.delete(Re)}h.remove(ot)}(we),we.isVideoTexture&&G.delete(we)}function ke(De){const we=De.target;we.removeEventListener("dispose",ke),function(ot){const Ve=ot.texture,Re=h.get(ot),it=h.get(Ve);if(it.__webglTexture!==void 0&&(A.deleteTexture(it.__webglTexture),b.memory.textures--),ot.depthTexture&&ot.depthTexture.dispose(),ot.isWebGLCubeRenderTarget)for(let de=0;de<6;de++)A.deleteFramebuffer(Re.__webglFramebuffer[de]),Re.__webglDepthbuffer&&A.deleteRenderbuffer(Re.__webglDepthbuffer[de]);else{if(A.deleteFramebuffer(Re.__webglFramebuffer),Re.__webglDepthbuffer&&A.deleteRenderbuffer(Re.__webglDepthbuffer),Re.__webglMultisampledFramebuffer&&A.deleteFramebuffer(Re.__webglMultisampledFramebuffer),Re.__webglColorRenderbuffer)for(let de=0;de<Re.__webglColorRenderbuffer.length;de++)Re.__webglColorRenderbuffer[de]&&A.deleteRenderbuffer(Re.__webglColorRenderbuffer[de]);Re.__webglDepthRenderbuffer&&A.deleteRenderbuffer(Re.__webglDepthRenderbuffer)}if(ot.isWebGLMultipleRenderTargets)for(let de=0,Ge=Ve.length;de<Ge;de++){const ze=h.get(Ve[de]);ze.__webglTexture&&(A.deleteTexture(ze.__webglTexture),b.memory.textures--),h.remove(Ve[de])}h.remove(Ve),h.remove(ot)}(we)}function Mt(De){const we=h.get(De);A.deleteTexture(we.__webglTexture);const ot=De.source;delete Q.get(ot)[we.__cacheKey],b.memory.textures--}let Ot=0;function tn(De,we){const ot=h.get(De);if(De.isVideoTexture&&function(Ve){const Re=b.render.frame;G.get(Ve)!==Re&&(G.set(Ve,Re),Ve.update())}(De),De.isRenderTargetTexture===!1&&De.version>0&&ot.__version!==De.version){const Ve=De.image;if(Ve===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Ve.complete!==!1)return void gn(ot,De,we);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}l.bindTexture(A.TEXTURE_2D,ot.__webglTexture,A.TEXTURE0+we)}const An={[Di]:A.REPEAT,[vs]:A.CLAMP_TO_EDGE,[_s]:A.MIRRORED_REPEAT},nn={[vr]:A.NEAREST,[Jo]:A.NEAREST_MIPMAP_NEAREST,[Al]:A.NEAREST_MIPMAP_LINEAR,[_r]:A.LINEAR,[nh]:A.LINEAR_MIPMAP_NEAREST,[bl]:A.LINEAR_MIPMAP_LINEAR};function Xt(De,we,ot){if(ot?(A.texParameteri(De,A.TEXTURE_WRAP_S,An[we.wrapS]),A.texParameteri(De,A.TEXTURE_WRAP_T,An[we.wrapT]),De!==A.TEXTURE_3D&&De!==A.TEXTURE_2D_ARRAY||A.texParameteri(De,A.TEXTURE_WRAP_R,An[we.wrapR]),A.texParameteri(De,A.TEXTURE_MAG_FILTER,nn[we.magFilter]),A.texParameteri(De,A.TEXTURE_MIN_FILTER,nn[we.minFilter])):(A.texParameteri(De,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(De,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),De!==A.TEXTURE_3D&&De!==A.TEXTURE_2D_ARRAY||A.texParameteri(De,A.TEXTURE_WRAP_R,A.CLAMP_TO_EDGE),we.wrapS===vs&&we.wrapT===vs||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),A.texParameteri(De,A.TEXTURE_MAG_FILTER,Oe(we.magFilter)),A.texParameteri(De,A.TEXTURE_MIN_FILTER,Oe(we.minFilter)),we.minFilter!==vr&&we.minFilter!==_r&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),r.has("EXT_texture_filter_anisotropic")===!0){const Ve=r.get("EXT_texture_filter_anisotropic");if(we.magFilter===vr||we.minFilter!==Al&&we.minFilter!==bl||we.type===tc&&r.has("OES_texture_float_linear")===!1||E===!1&&we.type===pr&&r.has("OES_texture_half_float_linear")===!1)return;(we.anisotropy>1||h.get(we).__currentAnisotropy)&&(A.texParameterf(De,Ve.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(we.anisotropy,f.getMaxAnisotropy())),h.get(we).__currentAnisotropy=we.anisotropy)}}function dn(De,we){let ot=!1;De.__webglInit===void 0&&(De.__webglInit=!0,we.addEventListener("dispose",pt));const Ve=we.source;let Re=Q.get(Ve);Re===void 0&&(Re={},Q.set(Ve,Re));const it=function(de){const Ge=[];return Ge.push(de.wrapS),Ge.push(de.wrapT),Ge.push(de.wrapR||0),Ge.push(de.magFilter),Ge.push(de.minFilter),Ge.push(de.anisotropy),Ge.push(de.internalFormat),Ge.push(de.format),Ge.push(de.type),Ge.push(de.generateMipmaps),Ge.push(de.premultiplyAlpha),Ge.push(de.flipY),Ge.push(de.unpackAlignment),Ge.push(de.colorSpace),Ge.join()}(we);if(it!==De.__cacheKey){Re[it]===void 0&&(Re[it]={texture:A.createTexture(),usedTimes:0},b.memory.textures++,ot=!0),Re[it].usedTimes++;const de=Re[De.__cacheKey];de!==void 0&&(Re[De.__cacheKey].usedTimes--,de.usedTimes===0&&Mt(we)),De.__cacheKey=it,De.__webglTexture=Re[it].texture}return ot}function gn(De,we,ot){let Ve=A.TEXTURE_2D;(we.isDataArrayTexture||we.isCompressedArrayTexture)&&(Ve=A.TEXTURE_2D_ARRAY),we.isData3DTexture&&(Ve=A.TEXTURE_3D);const Re=dn(De,we),it=we.source;l.bindTexture(Ve,De.__webglTexture,A.TEXTURE0+ot);const de=h.get(it);if(it.version!==de.__version||Re===!0){l.activeTexture(A.TEXTURE0+ot),A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,we.flipY),A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,we.premultiplyAlpha),A.pixelStorei(A.UNPACK_ALIGNMENT,we.unpackAlignment),A.pixelStorei(A.UNPACK_COLORSPACE_CONVERSION_WEBGL,A.NONE);const Ge=function(Qn){return!E&&(Qn.wrapS!==vs||Qn.wrapT!==vs||Qn.minFilter!==vr&&Qn.minFilter!==_r)}(we)&&be(we.image)===!1;let ze=ne(we.image,Ge,!1,O);ze=ai(we,ze);const Ut=be(ze)||E,Lt=v.convert(we.format,we.colorSpace);let qt,vn=v.convert(we.type),Tn=Pe(we.internalFormat,Lt,vn,we.colorSpace);Xt(Ve,we,Ut);const ei=we.mipmaps,Cn=E&&we.isVideoTexture!==!0,mi=de.__version===void 0||Re===!0,li=tt(we,ze,Ut);if(we.isDepthTexture)Tn=A.DEPTH_COMPONENT,E?Tn=we.type===tc?A.DEPTH_COMPONENT32F:we.type===wl?A.DEPTH_COMPONENT24:we.type===ns?A.DEPTH24_STENCIL8:A.DEPTH_COMPONENT16:we.type===tc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),we.format===cn&&Tn===A.DEPTH_COMPONENT&&we.type!==ih&&we.type!==wl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),we.type=wl,vn=v.convert(we.type)),we.format===As&&Tn===A.DEPTH_COMPONENT&&(Tn=A.DEPTH_STENCIL,we.type!==ns&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),we.type=ns,vn=v.convert(we.type))),mi&&(Cn?l.texStorage2D(A.TEXTURE_2D,1,Tn,ze.width,ze.height):l.texImage2D(A.TEXTURE_2D,0,Tn,ze.width,ze.height,0,Lt,vn,null));else if(we.isDataTexture)if(ei.length>0&&Ut){Cn&&mi&&l.texStorage2D(A.TEXTURE_2D,li,Tn,ei[0].width,ei[0].height);for(let Qn=0,cr=ei.length;Qn<cr;Qn++)qt=ei[Qn],Cn?l.texSubImage2D(A.TEXTURE_2D,Qn,0,0,qt.width,qt.height,Lt,vn,qt.data):l.texImage2D(A.TEXTURE_2D,Qn,Tn,qt.width,qt.height,0,Lt,vn,qt.data);we.generateMipmaps=!1}else Cn?(mi&&l.texStorage2D(A.TEXTURE_2D,li,Tn,ze.width,ze.height),l.texSubImage2D(A.TEXTURE_2D,0,0,0,ze.width,ze.height,Lt,vn,ze.data)):l.texImage2D(A.TEXTURE_2D,0,Tn,ze.width,ze.height,0,Lt,vn,ze.data);else if(we.isCompressedTexture)if(we.isCompressedArrayTexture){Cn&&mi&&l.texStorage3D(A.TEXTURE_2D_ARRAY,li,Tn,ei[0].width,ei[0].height,ze.depth);for(let Qn=0,cr=ei.length;Qn<cr;Qn++)qt=ei[Qn],we.format!==Sr?Lt!==null?Cn?l.compressedTexSubImage3D(A.TEXTURE_2D_ARRAY,Qn,0,0,0,qt.width,qt.height,ze.depth,Lt,qt.data,0,0):l.compressedTexImage3D(A.TEXTURE_2D_ARRAY,Qn,Tn,qt.width,qt.height,ze.depth,0,qt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Cn?l.texSubImage3D(A.TEXTURE_2D_ARRAY,Qn,0,0,0,qt.width,qt.height,ze.depth,Lt,vn,qt.data):l.texImage3D(A.TEXTURE_2D_ARRAY,Qn,Tn,qt.width,qt.height,ze.depth,0,Lt,vn,qt.data)}else{Cn&&mi&&l.texStorage2D(A.TEXTURE_2D,li,Tn,ei[0].width,ei[0].height);for(let Qn=0,cr=ei.length;Qn<cr;Qn++)qt=ei[Qn],we.format!==Sr?Lt!==null?Cn?l.compressedTexSubImage2D(A.TEXTURE_2D,Qn,0,0,qt.width,qt.height,Lt,qt.data):l.compressedTexImage2D(A.TEXTURE_2D,Qn,Tn,qt.width,qt.height,0,qt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Cn?l.texSubImage2D(A.TEXTURE_2D,Qn,0,0,qt.width,qt.height,Lt,vn,qt.data):l.texImage2D(A.TEXTURE_2D,Qn,Tn,qt.width,qt.height,0,Lt,vn,qt.data)}else if(we.isDataArrayTexture)Cn?(mi&&l.texStorage3D(A.TEXTURE_2D_ARRAY,li,Tn,ze.width,ze.height,ze.depth),l.texSubImage3D(A.TEXTURE_2D_ARRAY,0,0,0,0,ze.width,ze.height,ze.depth,Lt,vn,ze.data)):l.texImage3D(A.TEXTURE_2D_ARRAY,0,Tn,ze.width,ze.height,ze.depth,0,Lt,vn,ze.data);else if(we.isData3DTexture)Cn?(mi&&l.texStorage3D(A.TEXTURE_3D,li,Tn,ze.width,ze.height,ze.depth),l.texSubImage3D(A.TEXTURE_3D,0,0,0,0,ze.width,ze.height,ze.depth,Lt,vn,ze.data)):l.texImage3D(A.TEXTURE_3D,0,Tn,ze.width,ze.height,ze.depth,0,Lt,vn,ze.data);else if(we.isFramebufferTexture){if(mi)if(Cn)l.texStorage2D(A.TEXTURE_2D,li,Tn,ze.width,ze.height);else{let Qn=ze.width,cr=ze.height;for(let Po=0;Po<li;Po++)l.texImage2D(A.TEXTURE_2D,Po,Tn,Qn,cr,0,Lt,vn,null),Qn>>=1,cr>>=1}}else if(ei.length>0&&Ut){Cn&&mi&&l.texStorage2D(A.TEXTURE_2D,li,Tn,ei[0].width,ei[0].height);for(let Qn=0,cr=ei.length;Qn<cr;Qn++)qt=ei[Qn],Cn?l.texSubImage2D(A.TEXTURE_2D,Qn,0,0,Lt,vn,qt):l.texImage2D(A.TEXTURE_2D,Qn,Tn,Lt,vn,qt);we.generateMipmaps=!1}else Cn?(mi&&l.texStorage2D(A.TEXTURE_2D,li,Tn,ze.width,ze.height),l.texSubImage2D(A.TEXTURE_2D,0,0,0,Lt,vn,ze)):l.texImage2D(A.TEXTURE_2D,0,Tn,Lt,vn,ze);ve(we,Ut)&&me(Ve),de.__version=it.version,we.onUpdate&&we.onUpdate(we)}De.__version=we.version}function xt(De,we,ot,Ve,Re){const it=v.convert(ot.format,ot.colorSpace),de=v.convert(ot.type),Ge=Pe(ot.internalFormat,it,de,ot.colorSpace);h.get(we).__hasExternalTextures||(Re===A.TEXTURE_3D||Re===A.TEXTURE_2D_ARRAY?l.texImage3D(Re,0,Ge,we.width,we.height,we.depth,0,it,de,null):l.texImage2D(Re,0,Ge,we.width,we.height,0,it,de,null)),l.bindFramebuffer(A.FRAMEBUFFER,De),_n(we)?N.framebufferTexture2DMultisampleEXT(A.FRAMEBUFFER,Ve,Re,h.get(ot).__webglTexture,0,Zt(we)):(Re===A.TEXTURE_2D||Re>=A.TEXTURE_CUBE_MAP_POSITIVE_X&&Re<=A.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&A.framebufferTexture2D(A.FRAMEBUFFER,Ve,Re,h.get(ot).__webglTexture,0),l.bindFramebuffer(A.FRAMEBUFFER,null)}function Wt(De,we,ot){if(A.bindRenderbuffer(A.RENDERBUFFER,De),we.depthBuffer&&!we.stencilBuffer){let Ve=A.DEPTH_COMPONENT16;if(ot||_n(we)){const Re=we.depthTexture;Re&&Re.isDepthTexture&&(Re.type===tc?Ve=A.DEPTH_COMPONENT32F:Re.type===wl&&(Ve=A.DEPTH_COMPONENT24));const it=Zt(we);_n(we)?N.renderbufferStorageMultisampleEXT(A.RENDERBUFFER,it,Ve,we.width,we.height):A.renderbufferStorageMultisample(A.RENDERBUFFER,it,Ve,we.width,we.height)}else A.renderbufferStorage(A.RENDERBUFFER,Ve,we.width,we.height);A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,De)}else if(we.depthBuffer&&we.stencilBuffer){const Ve=Zt(we);ot&&_n(we)===!1?A.renderbufferStorageMultisample(A.RENDERBUFFER,Ve,A.DEPTH24_STENCIL8,we.width,we.height):_n(we)?N.renderbufferStorageMultisampleEXT(A.RENDERBUFFER,Ve,A.DEPTH24_STENCIL8,we.width,we.height):A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_STENCIL,we.width,we.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,De)}else{const Ve=we.isWebGLMultipleRenderTargets===!0?we.texture:[we.texture];for(let Re=0;Re<Ve.length;Re++){const it=Ve[Re],de=v.convert(it.format,it.colorSpace),Ge=v.convert(it.type),ze=Pe(it.internalFormat,de,Ge,it.colorSpace),Ut=Zt(we);ot&&_n(we)===!1?A.renderbufferStorageMultisample(A.RENDERBUFFER,Ut,ze,we.width,we.height):_n(we)?N.renderbufferStorageMultisampleEXT(A.RENDERBUFFER,Ut,ze,we.width,we.height):A.renderbufferStorage(A.RENDERBUFFER,ze,we.width,we.height)}}A.bindRenderbuffer(A.RENDERBUFFER,null)}function un(De){const we=h.get(De),ot=De.isWebGLCubeRenderTarget===!0;if(De.depthTexture&&!we.__autoAllocateDepthBuffer){if(ot)throw new Error("target.depthTexture not supported in Cube render targets");(function(Ve,Re){if(Re&&Re.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(l.bindFramebuffer(A.FRAMEBUFFER,Ve),!Re.depthTexture||!Re.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");h.get(Re.depthTexture).__webglTexture&&Re.depthTexture.image.width===Re.width&&Re.depthTexture.image.height===Re.height||(Re.depthTexture.image.width=Re.width,Re.depthTexture.image.height=Re.height,Re.depthTexture.needsUpdate=!0),tn(Re.depthTexture,0);const it=h.get(Re.depthTexture).__webglTexture,de=Zt(Re);if(Re.depthTexture.format===cn)_n(Re)?N.framebufferTexture2DMultisampleEXT(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.TEXTURE_2D,it,0,de):A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.TEXTURE_2D,it,0);else{if(Re.depthTexture.format!==As)throw new Error("Unknown depthTexture format");_n(Re)?N.framebufferTexture2DMultisampleEXT(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.TEXTURE_2D,it,0,de):A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.TEXTURE_2D,it,0)}})(we.__webglFramebuffer,De)}else if(ot){we.__webglDepthbuffer=[];for(let Ve=0;Ve<6;Ve++)l.bindFramebuffer(A.FRAMEBUFFER,we.__webglFramebuffer[Ve]),we.__webglDepthbuffer[Ve]=A.createRenderbuffer(),Wt(we.__webglDepthbuffer[Ve],De,!1)}else l.bindFramebuffer(A.FRAMEBUFFER,we.__webglFramebuffer),we.__webglDepthbuffer=A.createRenderbuffer(),Wt(we.__webglDepthbuffer,De,!1);l.bindFramebuffer(A.FRAMEBUFFER,null)}function Zt(De){return Math.min(F,De.samples)}function _n(De){const we=h.get(De);return E&&De.samples>0&&r.has("WEBGL_multisampled_render_to_texture")===!0&&we.__useRenderToTexture!==!1}function ai(De,we){const ot=De.colorSpace,Ve=De.format,Re=De.type;return De.isCompressedTexture===!0||De.format===Bd||ot!==fr&&ot!==ta&&(ot===Jn?E===!1?r.has("EXT_sRGB")===!0&&Ve===Sr?(De.format=Bd,De.minFilter=_r,De.generateMipmaps=!1):we=sf.sRGBToLinear(we):Ve===Sr&&Re===ec||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):ot===Wi||console.error("THREE.WebGLTextures: Unsupported texture color space:",ot)),we}this.allocateTextureUnit=function(){const De=Ot;return De>=D&&console.warn("THREE.WebGLTextures: Trying to use "+De+" texture units while this GPU supports only "+D),Ot+=1,De},this.resetTextureUnits=function(){Ot=0},this.setTexture2D=tn,this.setTexture2DArray=function(De,we){const ot=h.get(De);De.version>0&&ot.__version!==De.version?gn(ot,De,we):l.bindTexture(A.TEXTURE_2D_ARRAY,ot.__webglTexture,A.TEXTURE0+we)},this.setTexture3D=function(De,we){const ot=h.get(De);De.version>0&&ot.__version!==De.version?gn(ot,De,we):l.bindTexture(A.TEXTURE_3D,ot.__webglTexture,A.TEXTURE0+we)},this.setTextureCube=function(De,we){const ot=h.get(De);De.version>0&&ot.__version!==De.version?function(Ve,Re,it){if(Re.image.length!==6)return;const de=dn(Ve,Re),Ge=Re.source;l.bindTexture(A.TEXTURE_CUBE_MAP,Ve.__webglTexture,A.TEXTURE0+it);const ze=h.get(Ge);if(Ge.version!==ze.__version||de===!0){l.activeTexture(A.TEXTURE0+it),A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,Re.flipY),A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Re.premultiplyAlpha),A.pixelStorei(A.UNPACK_ALIGNMENT,Re.unpackAlignment),A.pixelStorei(A.UNPACK_COLORSPACE_CONVERSION_WEBGL,A.NONE);const Ut=Re.isCompressedTexture||Re.image[0].isCompressedTexture,Lt=Re.image[0]&&Re.image[0].isDataTexture,qt=[];for(let ci=0;ci<6;ci++)qt[ci]=Ut||Lt?Lt?Re.image[ci].image:Re.image[ci]:ne(Re.image[ci],!1,!0,P),qt[ci]=ai(Re,qt[ci]);const vn=qt[0],Tn=be(vn)||E,ei=v.convert(Re.format,Re.colorSpace),Cn=v.convert(Re.type),mi=Pe(Re.internalFormat,ei,Cn,Re.colorSpace),li=E&&Re.isVideoTexture!==!0,Qn=ze.__version===void 0||de===!0;let cr,Po=tt(Re,vn,Tn);if(Xt(A.TEXTURE_CUBE_MAP,Re,Tn),Ut){li&&Qn&&l.texStorage2D(A.TEXTURE_CUBE_MAP,Po,mi,vn.width,vn.height);for(let ci=0;ci<6;ci++){cr=qt[ci].mipmaps;for(let Xi=0;Xi<cr.length;Xi++){const Vi=cr[Xi];Re.format!==Sr?ei!==null?li?l.compressedTexSubImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi,0,0,Vi.width,Vi.height,ei,Vi.data):l.compressedTexImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi,mi,Vi.width,Vi.height,0,Vi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):li?l.texSubImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi,0,0,Vi.width,Vi.height,ei,Cn,Vi.data):l.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi,mi,Vi.width,Vi.height,0,ei,Cn,Vi.data)}}}else{cr=Re.mipmaps,li&&Qn&&(cr.length>0&&Po++,l.texStorage2D(A.TEXTURE_CUBE_MAP,Po,mi,qt[0].width,qt[0].height));for(let ci=0;ci<6;ci++)if(Lt){li?l.texSubImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,0,0,0,qt[ci].width,qt[ci].height,ei,Cn,qt[ci].data):l.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,0,mi,qt[ci].width,qt[ci].height,0,ei,Cn,qt[ci].data);for(let Xi=0;Xi<cr.length;Xi++){const Vi=cr[Xi].image[ci].image;li?l.texSubImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi+1,0,0,Vi.width,Vi.height,ei,Cn,Vi.data):l.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi+1,mi,Vi.width,Vi.height,0,ei,Cn,Vi.data)}}else{li?l.texSubImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,0,0,0,ei,Cn,qt[ci]):l.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,0,mi,ei,Cn,qt[ci]);for(let Xi=0;Xi<cr.length;Xi++){const Vi=cr[Xi];li?l.texSubImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi+1,0,0,ei,Cn,Vi.image[ci]):l.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+ci,Xi+1,mi,ei,Cn,Vi.image[ci])}}}ve(Re,Tn)&&me(A.TEXTURE_CUBE_MAP),ze.__version=Ge.version,Re.onUpdate&&Re.onUpdate(Re)}Ve.__version=Re.version}(ot,De,we):l.bindTexture(A.TEXTURE_CUBE_MAP,ot.__webglTexture,A.TEXTURE0+we)},this.rebindTextures=function(De,we,ot){const Ve=h.get(De);we!==void 0&&xt(Ve.__webglFramebuffer,De,De.texture,A.COLOR_ATTACHMENT0,A.TEXTURE_2D),ot!==void 0&&un(De)},this.setupRenderTarget=function(De){const we=De.texture,ot=h.get(De),Ve=h.get(we);De.addEventListener("dispose",ke),De.isWebGLMultipleRenderTargets!==!0&&(Ve.__webglTexture===void 0&&(Ve.__webglTexture=A.createTexture()),Ve.__version=we.version,b.memory.textures++);const Re=De.isWebGLCubeRenderTarget===!0,it=De.isWebGLMultipleRenderTargets===!0,de=be(De)||E;if(Re){ot.__webglFramebuffer=[];for(let Ge=0;Ge<6;Ge++)ot.__webglFramebuffer[Ge]=A.createFramebuffer()}else{if(ot.__webglFramebuffer=A.createFramebuffer(),it)if(f.drawBuffers){const Ge=De.texture;for(let ze=0,Ut=Ge.length;ze<Ut;ze++){const Lt=h.get(Ge[ze]);Lt.__webglTexture===void 0&&(Lt.__webglTexture=A.createTexture(),b.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(E&&De.samples>0&&_n(De)===!1){const Ge=it?we:[we];ot.__webglMultisampledFramebuffer=A.createFramebuffer(),ot.__webglColorRenderbuffer=[],l.bindFramebuffer(A.FRAMEBUFFER,ot.__webglMultisampledFramebuffer);for(let ze=0;ze<Ge.length;ze++){const Ut=Ge[ze];ot.__webglColorRenderbuffer[ze]=A.createRenderbuffer(),A.bindRenderbuffer(A.RENDERBUFFER,ot.__webglColorRenderbuffer[ze]);const Lt=v.convert(Ut.format,Ut.colorSpace),qt=v.convert(Ut.type),vn=Pe(Ut.internalFormat,Lt,qt,Ut.colorSpace,De.isXRRenderTarget===!0),Tn=Zt(De);A.renderbufferStorageMultisample(A.RENDERBUFFER,Tn,vn,De.width,De.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0+ze,A.RENDERBUFFER,ot.__webglColorRenderbuffer[ze])}A.bindRenderbuffer(A.RENDERBUFFER,null),De.depthBuffer&&(ot.__webglDepthRenderbuffer=A.createRenderbuffer(),Wt(ot.__webglDepthRenderbuffer,De,!0)),l.bindFramebuffer(A.FRAMEBUFFER,null)}}if(Re){l.bindTexture(A.TEXTURE_CUBE_MAP,Ve.__webglTexture),Xt(A.TEXTURE_CUBE_MAP,we,de);for(let Ge=0;Ge<6;Ge++)xt(ot.__webglFramebuffer[Ge],De,we,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+Ge);ve(we,de)&&me(A.TEXTURE_CUBE_MAP),l.unbindTexture()}else if(it){const Ge=De.texture;for(let ze=0,Ut=Ge.length;ze<Ut;ze++){const Lt=Ge[ze],qt=h.get(Lt);l.bindTexture(A.TEXTURE_2D,qt.__webglTexture),Xt(A.TEXTURE_2D,Lt,de),xt(ot.__webglFramebuffer,De,Lt,A.COLOR_ATTACHMENT0+ze,A.TEXTURE_2D),ve(Lt,de)&&me(A.TEXTURE_2D)}l.unbindTexture()}else{let Ge=A.TEXTURE_2D;(De.isWebGL3DRenderTarget||De.isWebGLArrayRenderTarget)&&(E?Ge=De.isWebGL3DRenderTarget?A.TEXTURE_3D:A.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),l.bindTexture(Ge,Ve.__webglTexture),Xt(Ge,we,de),xt(ot.__webglFramebuffer,De,we,A.COLOR_ATTACHMENT0,Ge),ve(we,de)&&me(Ge),l.unbindTexture()}De.depthBuffer&&un(De)},this.updateRenderTargetMipmap=function(De){const we=be(De)||E,ot=De.isWebGLMultipleRenderTargets===!0?De.texture:[De.texture],Ve=De.isWebGLCubeRenderTarget?A.TEXTURE_CUBE_MAP:A.TEXTURE_2D;for(let Re=0,it=ot.length;Re<it;Re++){const de=ot[Re],Ge=h.get(de),ze=Ge.__webglTexture;Ge.__version!==de.version&&(l.bindTexture(Ve,ze),Xt(Ve,de,we),l.unbindTexture(),Ge.__version=de.version),ve(de,we)&&(l.bindTexture(Ve,ze),me(Ve),l.unbindTexture())}},this.updateMultisampleRenderTarget=function(De){if(E&&De.samples>0&&_n(De)===!1){const we=De.isWebGLMultipleRenderTargets?De.texture:[De.texture],ot=De.width,Ve=De.height;let Re=A.COLOR_BUFFER_BIT;const it=[],de=De.stencilBuffer?A.DEPTH_STENCIL_ATTACHMENT:A.DEPTH_ATTACHMENT,Ge=h.get(De),ze=De.isWebGLMultipleRenderTargets===!0;if(ze)for(let Ut=0;Ut<we.length;Ut++)l.bindFramebuffer(A.FRAMEBUFFER,Ge.__webglMultisampledFramebuffer),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0+Ut,A.RENDERBUFFER,null),l.bindFramebuffer(A.FRAMEBUFFER,Ge.__webglFramebuffer),A.framebufferTexture2D(A.DRAW_FRAMEBUFFER,A.COLOR_ATTACHMENT0+Ut,A.TEXTURE_2D,null,0);l.bindFramebuffer(A.READ_FRAMEBUFFER,Ge.__webglMultisampledFramebuffer),l.bindFramebuffer(A.DRAW_FRAMEBUFFER,Ge.__webglFramebuffer);for(let Ut=0;Ut<we.length;Ut++){it.push(A.COLOR_ATTACHMENT0+Ut),De.depthBuffer&&it.push(de);const Lt=Ge.__ignoreDepthValues!==void 0&&Ge.__ignoreDepthValues;if(Lt===!1&&(De.depthBuffer&&(Re|=A.DEPTH_BUFFER_BIT),De.stencilBuffer&&(Re|=A.STENCIL_BUFFER_BIT)),ze&&A.framebufferRenderbuffer(A.READ_FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.RENDERBUFFER,Ge.__webglColorRenderbuffer[Ut]),Lt===!0&&(A.invalidateFramebuffer(A.READ_FRAMEBUFFER,[de]),A.invalidateFramebuffer(A.DRAW_FRAMEBUFFER,[de])),ze){const qt=h.get(we[Ut]).__webglTexture;A.framebufferTexture2D(A.DRAW_FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,qt,0)}A.blitFramebuffer(0,0,ot,Ve,0,0,ot,Ve,Re,A.NEAREST),z&&A.invalidateFramebuffer(A.READ_FRAMEBUFFER,it)}if(l.bindFramebuffer(A.READ_FRAMEBUFFER,null),l.bindFramebuffer(A.DRAW_FRAMEBUFFER,null),ze)for(let Ut=0;Ut<we.length;Ut++){l.bindFramebuffer(A.FRAMEBUFFER,Ge.__webglMultisampledFramebuffer),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0+Ut,A.RENDERBUFFER,Ge.__webglColorRenderbuffer[Ut]);const Lt=h.get(we[Ut]).__webglTexture;l.bindFramebuffer(A.FRAMEBUFFER,Ge.__webglFramebuffer),A.framebufferTexture2D(A.DRAW_FRAMEBUFFER,A.COLOR_ATTACHMENT0+Ut,A.TEXTURE_2D,Lt,0)}l.bindFramebuffer(A.DRAW_FRAMEBUFFER,Ge.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=un,this.setupFrameBufferTexture=xt,this.useMultisampledRTT=_n}function ty(A,r,l){const h=l.isWebGL2;return{convert:function(f,v=ta){let b;if(f===ec)return A.UNSIGNED_BYTE;if(f===wd)return A.UNSIGNED_SHORT_4_4_4_4;if(f===vm)return A.UNSIGNED_SHORT_5_5_5_1;if(f===qp)return A.BYTE;if(f===ys)return A.SHORT;if(f===ih)return A.UNSIGNED_SHORT;if(f===Rv)return A.INT;if(f===wl)return A.UNSIGNED_INT;if(f===tc)return A.FLOAT;if(f===pr)return h?A.HALF_FLOAT:(b=r.get("OES_texture_half_float"),b!==null?b.HALF_FLOAT_OES:null);if(f===rh)return A.ALPHA;if(f===Sr)return A.RGBA;if(f===Gt)return A.LUMINANCE;if(f===nc)return A.LUMINANCE_ALPHA;if(f===cn)return A.DEPTH_COMPONENT;if(f===As)return A.DEPTH_STENCIL;if(f===Bd)return b=r.get("EXT_sRGB"),b!==null?b.SRGB_ALPHA_EXT:null;if(f===Uo)return A.RED;if(f===Ai)return A.RED_INTEGER;if(f===jn)return A.RG;if(f===Zo)return A.RG_INTEGER;if(f===sh)return A.RGBA_INTEGER;if(f===Da||f===Ba||f===Hn||f===su)if(v===Jn){if(b=r.get("WEBGL_compressed_texture_s3tc_srgb"),b===null)return null;if(f===Da)return b.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(f===Ba)return b.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(f===Hn)return b.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(f===su)return b.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(b=r.get("WEBGL_compressed_texture_s3tc"),b===null)return null;if(f===Da)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(f===Ba)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(f===Hn)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(f===su)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(f===xd||f===Ed||f===Sd||f===Xp){if(b=r.get("WEBGL_compressed_texture_pvrtc"),b===null)return null;if(f===xd)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(f===Ed)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(f===Sd)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(f===Xp)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(f===_m)return b=r.get("WEBGL_compressed_texture_etc1"),b!==null?b.COMPRESSED_RGB_ETC1_WEBGL:null;if(f===Fi||f===Si){if(b=r.get("WEBGL_compressed_texture_etc"),b===null)return null;if(f===Fi)return v===Jn?b.COMPRESSED_SRGB8_ETC2:b.COMPRESSED_RGB8_ETC2;if(f===Si)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:b.COMPRESSED_RGBA8_ETC2_EAC}if(f===$o||f===Ds||f===xl||f===is||f===Sn||f===rs||f===Bc||f===ic||f===Yp||f===rc||f===Fr||f===ou||f===au||f===Kp){if(b=r.get("WEBGL_compressed_texture_astc"),b===null)return null;if(f===$o)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:b.COMPRESSED_RGBA_ASTC_4x4_KHR;if(f===Ds)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:b.COMPRESSED_RGBA_ASTC_5x4_KHR;if(f===xl)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:b.COMPRESSED_RGBA_ASTC_5x5_KHR;if(f===is)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:b.COMPRESSED_RGBA_ASTC_6x5_KHR;if(f===Sn)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:b.COMPRESSED_RGBA_ASTC_6x6_KHR;if(f===rs)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:b.COMPRESSED_RGBA_ASTC_8x5_KHR;if(f===Bc)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:b.COMPRESSED_RGBA_ASTC_8x6_KHR;if(f===ic)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:b.COMPRESSED_RGBA_ASTC_8x8_KHR;if(f===Yp)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:b.COMPRESSED_RGBA_ASTC_10x5_KHR;if(f===rc)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:b.COMPRESSED_RGBA_ASTC_10x6_KHR;if(f===Fr)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:b.COMPRESSED_RGBA_ASTC_10x8_KHR;if(f===ou)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:b.COMPRESSED_RGBA_ASTC_10x10_KHR;if(f===au)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:b.COMPRESSED_RGBA_ASTC_12x10_KHR;if(f===Kp)return v===Jn?b.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:b.COMPRESSED_RGBA_ASTC_12x12_KHR}if(f===vo){if(b=r.get("EXT_texture_compression_bptc"),b===null)return null;if(f===vo)return v===Jn?b.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:b.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(f===En||f===sc||f===ea||f===Jp){if(b=r.get("EXT_texture_compression_rgtc"),b===null)return null;if(f===vo)return b.COMPRESSED_RED_RGTC1_EXT;if(f===sc)return b.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(f===ea)return b.COMPRESSED_RED_GREEN_RGTC2_EXT;if(f===Jp)return b.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return f===ns?h?A.UNSIGNED_INT_24_8:(b=r.get("WEBGL_depth_texture"),b!==null?b.UNSIGNED_INT_24_8_WEBGL:null):A[f]!==void 0?A[f]:null}}}class Ll extends so{constructor(r=[]){super(),this.isArrayCamera=!0,this.cameras=r}}class lo extends zi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Zm={type:"move"};class $m{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new lo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new lo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new fe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new fe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new lo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new fe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new fe),this._grip}dispatchEvent(r){return this._targetRay!==null&&this._targetRay.dispatchEvent(r),this._grip!==null&&this._grip.dispatchEvent(r),this._hand!==null&&this._hand.dispatchEvent(r),this}connect(r){if(r&&r.hand){const l=this._hand;if(l)for(const h of r.hand.values())this._getHandJoint(l,h)}return this.dispatchEvent({type:"connected",data:r}),this}disconnect(r){return this.dispatchEvent({type:"disconnected",data:r}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(r,l,h){let f=null,v=null,b=null;const E=this._targetRay,D=this._grip,P=this._hand;if(r&&l.session.visibilityState!=="visible-blurred"){if(P&&r.hand){b=!0;for(const W of r.hand.values()){const Q=l.getJointPose(W,h),q=this._getHandJoint(P,W);Q!==null&&(q.matrix.fromArray(Q.transform.matrix),q.matrix.decompose(q.position,q.rotation,q.scale),q.matrixWorldNeedsUpdate=!0,q.jointRadius=Q.radius),q.visible=Q!==null}const O=P.joints["index-finger-tip"],F=P.joints["thumb-tip"],N=O.position.distanceTo(F.position),z=.02,G=.005;P.inputState.pinching&&N>z+G?(P.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:r.handedness,target:this})):!P.inputState.pinching&&N<=z-G&&(P.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:r.handedness,target:this}))}else D!==null&&r.gripSpace&&(v=l.getPose(r.gripSpace,h),v!==null&&(D.matrix.fromArray(v.transform.matrix),D.matrix.decompose(D.position,D.rotation,D.scale),D.matrixWorldNeedsUpdate=!0,v.linearVelocity?(D.hasLinearVelocity=!0,D.linearVelocity.copy(v.linearVelocity)):D.hasLinearVelocity=!1,v.angularVelocity?(D.hasAngularVelocity=!0,D.angularVelocity.copy(v.angularVelocity)):D.hasAngularVelocity=!1));E!==null&&(f=l.getPose(r.targetRaySpace,h),f===null&&v!==null&&(f=v),f!==null&&(E.matrix.fromArray(f.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),E.matrixWorldNeedsUpdate=!0,f.linearVelocity?(E.hasLinearVelocity=!0,E.linearVelocity.copy(f.linearVelocity)):E.hasLinearVelocity=!1,f.angularVelocity?(E.hasAngularVelocity=!0,E.angularVelocity.copy(f.angularVelocity)):E.hasAngularVelocity=!1,this.dispatchEvent(Zm)))}return E!==null&&(E.visible=f!==null),D!==null&&(D.visible=v!==null),P!==null&&(P.visible=b!==null),this}_getHandJoint(r,l){if(r.joints[l.jointName]===void 0){const h=new lo;h.matrixAutoUpdate=!1,h.visible=!1,r.joints[l.jointName]=h,r.add(h)}return r.joints[l.jointName]}}class va extends Or{constructor(r,l,h,f,v,b,E,D,P,O){if((O=O!==void 0?O:cn)!==cn&&O!==As)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");h===void 0&&O===cn&&(h=wl),h===void 0&&O===As&&(h=ns),super(null,f,v,b,E,D,O,h,P),this.isDepthTexture=!0,this.image={width:r,height:l},this.magFilter=E!==void 0?E:vr,this.minFilter=D!==void 0?D:vr,this.flipY=!1,this.generateMipmaps=!1}}class eE extends Ml{constructor(r,l){super();const h=this;let f=null,v=1,b=null,E="local-floor",D=1,P=null,O=null,F=null,N=null,z=null,G=null;const W=l.getContextAttributes();let Q=null,q=null;const K=[],ne=[],be=new Set,ve=new Map,me=new so;me.layers.enable(1),me.viewport=new ji;const Pe=new so;Pe.layers.enable(2),Pe.viewport=new ji;const tt=[me,Pe],Oe=new Ll;Oe.layers.enable(1),Oe.layers.enable(2);let pt=null,ke=null;function Mt(xt){const Wt=ne.indexOf(xt.inputSource);if(Wt===-1)return;const un=K[Wt];un!==void 0&&(un.update(xt.inputSource,xt.frame,P||b),un.dispatchEvent({type:xt.type,data:xt.inputSource}))}function Ot(){f.removeEventListener("select",Mt),f.removeEventListener("selectstart",Mt),f.removeEventListener("selectend",Mt),f.removeEventListener("squeeze",Mt),f.removeEventListener("squeezestart",Mt),f.removeEventListener("squeezeend",Mt),f.removeEventListener("end",Ot),f.removeEventListener("inputsourceschange",tn);for(let xt=0;xt<K.length;xt++){const Wt=ne[xt];Wt!==null&&(ne[xt]=null,K[xt].disconnect(Wt))}pt=null,ke=null,r.setRenderTarget(Q),z=null,N=null,F=null,f=null,q=null,gn.stop(),h.isPresenting=!1,h.dispatchEvent({type:"sessionend"})}function tn(xt){for(let Wt=0;Wt<xt.removed.length;Wt++){const un=xt.removed[Wt],Zt=ne.indexOf(un);Zt>=0&&(ne[Zt]=null,K[Zt].disconnect(un))}for(let Wt=0;Wt<xt.added.length;Wt++){const un=xt.added[Wt];let Zt=ne.indexOf(un);if(Zt===-1){for(let ai=0;ai<K.length;ai++){if(ai>=ne.length){ne.push(un),Zt=ai;break}if(ne[ai]===null){ne[ai]=un,Zt=ai;break}}if(Zt===-1)break}const _n=K[Zt];_n&&_n.connect(un)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(xt){let Wt=K[xt];return Wt===void 0&&(Wt=new $m,K[xt]=Wt),Wt.getTargetRaySpace()},this.getControllerGrip=function(xt){let Wt=K[xt];return Wt===void 0&&(Wt=new $m,K[xt]=Wt),Wt.getGripSpace()},this.getHand=function(xt){let Wt=K[xt];return Wt===void 0&&(Wt=new $m,K[xt]=Wt),Wt.getHandSpace()},this.setFramebufferScaleFactor=function(xt){v=xt,h.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(xt){E=xt,h.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return P||b},this.setReferenceSpace=function(xt){P=xt},this.getBaseLayer=function(){return N!==null?N:z},this.getBinding=function(){return F},this.getFrame=function(){return G},this.getSession=function(){return f},this.setSession=async function(xt){if(f=xt,f!==null){if(Q=r.getRenderTarget(),f.addEventListener("select",Mt),f.addEventListener("selectstart",Mt),f.addEventListener("selectend",Mt),f.addEventListener("squeeze",Mt),f.addEventListener("squeezestart",Mt),f.addEventListener("squeezeend",Mt),f.addEventListener("end",Ot),f.addEventListener("inputsourceschange",tn),W.xrCompatible!==!0&&await l.makeXRCompatible(),f.renderState.layers===void 0||r.capabilities.isWebGL2===!1){const Wt={antialias:f.renderState.layers!==void 0||W.antialias,alpha:!0,depth:W.depth,stencil:W.stencil,framebufferScaleFactor:v};z=new XRWebGLLayer(f,l,Wt),f.updateRenderState({baseLayer:z}),q=new yo(z.framebufferWidth,z.framebufferHeight,{format:Sr,type:ec,colorSpace:r.outputColorSpace,stencilBuffer:W.stencil})}else{let Wt=null,un=null,Zt=null;W.depth&&(Zt=W.stencil?l.DEPTH24_STENCIL8:l.DEPTH_COMPONENT24,Wt=W.stencil?As:cn,un=W.stencil?ns:wl);const _n={colorFormat:l.RGBA8,depthFormat:Zt,scaleFactor:v};F=new XRWebGLBinding(f,l),N=F.createProjectionLayer(_n),f.updateRenderState({layers:[N]}),q=new yo(N.textureWidth,N.textureHeight,{format:Sr,type:ec,depthTexture:new va(N.textureWidth,N.textureHeight,un,void 0,void 0,void 0,void 0,void 0,void 0,Wt),stencilBuffer:W.stencil,colorSpace:r.outputColorSpace,samples:W.antialias?4:0}),r.properties.get(q).__ignoreDepthValues=N.ignoreDepthValues}q.isXRRenderTarget=!0,this.setFoveation(D),P=null,b=await f.requestReferenceSpace(E),gn.setContext(f),gn.start(),h.isPresenting=!0,h.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(f!==null)return f.environmentBlendMode};const An=new fe,nn=new fe;function Xt(xt,Wt){Wt===null?xt.matrixWorld.copy(xt.matrix):xt.matrixWorld.multiplyMatrices(Wt.matrixWorld,xt.matrix),xt.matrixWorldInverse.copy(xt.matrixWorld).invert()}this.updateCamera=function(xt){if(f===null)return;Oe.near=Pe.near=me.near=xt.near,Oe.far=Pe.far=me.far=xt.far,pt===Oe.near&&ke===Oe.far||(f.updateRenderState({depthNear:Oe.near,depthFar:Oe.far}),pt=Oe.near,ke=Oe.far);const Wt=xt.parent,un=Oe.cameras;Xt(Oe,Wt);for(let Zt=0;Zt<un.length;Zt++)Xt(un[Zt],Wt);un.length===2?function(Zt,_n,ai){An.setFromMatrixPosition(_n.matrixWorld),nn.setFromMatrixPosition(ai.matrixWorld);const De=An.distanceTo(nn),we=_n.projectionMatrix.elements,ot=ai.projectionMatrix.elements,Ve=we[14]/(we[10]-1),Re=we[14]/(we[10]+1),it=(we[9]+1)/we[5],de=(we[9]-1)/we[5],Ge=(we[8]-1)/we[0],ze=(ot[8]+1)/ot[0],Ut=Ve*Ge,Lt=Ve*ze,qt=De/(-Ge+ze),vn=qt*-Ge;_n.matrixWorld.decompose(Zt.position,Zt.quaternion,Zt.scale),Zt.translateX(vn),Zt.translateZ(qt),Zt.matrixWorld.compose(Zt.position,Zt.quaternion,Zt.scale),Zt.matrixWorldInverse.copy(Zt.matrixWorld).invert();const Tn=Ve+qt,ei=Re+qt,Cn=Ut-vn,mi=Lt+(De-vn),li=it*Re/ei*Tn,Qn=de*Re/ei*Tn;Zt.projectionMatrix.makePerspective(Cn,mi,li,Qn,Tn,ei),Zt.projectionMatrixInverse.copy(Zt.projectionMatrix).invert()}(Oe,me,Pe):Oe.projectionMatrix.copy(me.projectionMatrix),function(Zt,_n,ai){ai===null?Zt.matrix.copy(_n.matrixWorld):(Zt.matrix.copy(ai.matrixWorld),Zt.matrix.invert(),Zt.matrix.multiply(_n.matrixWorld)),Zt.matrix.decompose(Zt.position,Zt.quaternion,Zt.scale),Zt.updateMatrixWorld(!0);const De=Zt.children;for(let we=0,ot=De.length;we<ot;we++)De[we].updateMatrixWorld(!0);Zt.projectionMatrix.copy(_n.projectionMatrix),Zt.projectionMatrixInverse.copy(_n.projectionMatrixInverse),Zt.isPerspectiveCamera&&(Zt.fov=2*La*Math.atan(1/Zt.projectionMatrix.elements[5]),Zt.zoom=1)}(xt,Oe,Wt)},this.getCamera=function(){return Oe},this.getFoveation=function(){if(N!==null||z!==null)return D},this.setFoveation=function(xt){D=xt,N!==null&&(N.fixedFoveation=xt),z!==null&&z.fixedFoveation!==void 0&&(z.fixedFoveation=xt)},this.getPlanes=function(){return be};let dn=null;this.onPreAnimationFrameCallback=null;const gn=new Hc;gn.setAnimationLoop(function(xt,Wt){if(h.onPreAnimationFrameCallback&&h.onPreAnimationFrameCallback(xt,Wt),O=Wt.getViewerPose(P||b),G=Wt,O!==null){const un=O.views;z!==null&&(r.setRenderTargetFramebuffer(q,z.framebuffer),r.setRenderTarget(q));let Zt=!1;un.length!==Oe.cameras.length&&(Oe.cameras.length=0,Zt=!0);for(let _n=0;_n<un.length;_n++){const ai=un[_n];let De=null;if(z!==null)De=z.getViewport(ai);else{const ot=F.getViewSubImage(N,ai);De=ot.viewport,_n===0&&(r.setRenderTargetTextures(q,ot.colorTexture,N.ignoreDepthValues?void 0:ot.depthStencilTexture),r.setRenderTarget(q))}let we=tt[_n];we===void 0&&(we=new so,we.layers.enable(_n),we.viewport=new ji,tt[_n]=we),we.matrix.fromArray(ai.transform.matrix),we.matrix.decompose(we.position,we.quaternion,we.scale),we.projectionMatrix.fromArray(ai.projectionMatrix),we.projectionMatrixInverse.copy(we.projectionMatrix).invert(),we.viewport.set(De.x,De.y,De.width,De.height),_n===0&&(Oe.matrix.copy(we.matrix),Oe.matrix.decompose(Oe.position,Oe.quaternion,Oe.scale)),Zt===!0&&Oe.cameras.push(we)}}for(let un=0;un<K.length;un++){const Zt=ne[un],_n=K[un];Zt!==null&&_n!==void 0&&_n.update(Zt,Wt,P||b)}if(dn&&dn(xt,Wt),Wt.detectedPlanes){h.dispatchEvent({type:"planesdetected",data:Wt.detectedPlanes});let un=null;for(const Zt of be)Wt.detectedPlanes.has(Zt)||(un===null&&(un=[]),un.push(Zt));if(un!==null)for(const Zt of un)be.delete(Zt),ve.delete(Zt),h.dispatchEvent({type:"planeremoved",data:Zt});for(const Zt of Wt.detectedPlanes)if(be.has(Zt)){const _n=ve.get(Zt);Zt.lastChangedTime>_n&&(ve.set(Zt,Zt.lastChangedTime),h.dispatchEvent({type:"planechanged",data:Zt}))}else be.add(Zt),ve.set(Zt,Wt.lastChangedTime),h.dispatchEvent({type:"planeadded",data:Zt})}G=null}),this.setAnimationLoop=function(xt){dn=xt},this.dispose=function(){}}}function tE(A,r){function l(f,v){f.matrixAutoUpdate===!0&&f.updateMatrix(),v.value.copy(f.matrix)}function h(f,v){f.opacity.value=v.opacity,v.color&&f.diffuse.value.copy(v.color),v.emissive&&f.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(f.map.value=v.map,l(v.map,f.mapTransform)),v.alphaMap&&(f.alphaMap.value=v.alphaMap,l(v.alphaMap,f.alphaMapTransform)),v.bumpMap&&(f.bumpMap.value=v.bumpMap,l(v.bumpMap,f.bumpMapTransform),f.bumpScale.value=v.bumpScale,v.side===Ce&&(f.bumpScale.value*=-1)),v.normalMap&&(f.normalMap.value=v.normalMap,l(v.normalMap,f.normalMapTransform),f.normalScale.value.copy(v.normalScale),v.side===Ce&&f.normalScale.value.negate()),v.displacementMap&&(f.displacementMap.value=v.displacementMap,l(v.displacementMap,f.displacementMapTransform),f.displacementScale.value=v.displacementScale,f.displacementBias.value=v.displacementBias),v.emissiveMap&&(f.emissiveMap.value=v.emissiveMap,l(v.emissiveMap,f.emissiveMapTransform)),v.specularMap&&(f.specularMap.value=v.specularMap,l(v.specularMap,f.specularMapTransform)),v.alphaTest>0&&(f.alphaTest.value=v.alphaTest);const b=r.get(v).envMap;if(b){f.envMap.value=b;const E=r.get(v).environment||b;f.envMapRotation.value=E?E.rotation:0,f.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,f.reflectivity.value=v.reflectivity,f.ior.value=v.ior,f.refractionRatio.value=v.refractionRatio}if(v.lightMap){f.lightMap.value=v.lightMap;const E=A.useLegacyLights===!0?Math.PI:1;f.lightMapIntensity.value=v.lightMapIntensity*E,l(v.lightMap,f.lightMapTransform)}v.aoMap&&(f.aoMap.value=v.aoMap,f.aoMapIntensity.value=v.aoMapIntensity,l(v.aoMap,f.aoMapTransform))}return{refreshTransformUniform:l,refreshFogUniforms:function(f,v){v.color.getRGB(f.fogColor.value,Nv(A)),v.isFog?(f.fogNear.value=v.near,f.fogFar.value=v.far):v.isFogExp2&&(f.fogDensity.value=v.density)},refreshMaterialUniforms:function(f,v,b,E,D){v.isMeshBasicMaterial||v.isMeshLambertMaterial?h(f,v):v.isMeshToonMaterial?(h(f,v),function(P,O){O.gradientMap&&(P.gradientMap.value=O.gradientMap)}(f,v)):v.isMeshPhongMaterial?(h(f,v),function(P,O){P.specular.value.copy(O.specular),P.shininess.value=Math.max(O.shininess,1e-4)}(f,v)):v.isMeshStandardMaterial?(h(f,v),function(P,O){P.metalness.value=O.metalness,O.metalnessMap&&(P.metalnessMap.value=O.metalnessMap,l(O.metalnessMap,P.metalnessMapTransform)),P.roughness.value=O.roughness,O.roughnessMap&&(P.roughnessMap.value=O.roughnessMap,l(O.roughnessMap,P.roughnessMapTransform)),r.get(O).envMap&&(P.envMapIntensity.value=O.envMapIntensity)}(f,v),v.isMeshPhysicalMaterial&&function(P,O,F){P.ior.value=O.ior,O.sheen>0&&(P.sheenColor.value.copy(O.sheenColor).multiplyScalar(O.sheen),P.sheenRoughness.value=O.sheenRoughness,O.sheenColorMap&&(P.sheenColorMap.value=O.sheenColorMap,l(O.sheenColorMap,P.sheenColorMapTransform)),O.sheenRoughnessMap&&(P.sheenRoughnessMap.value=O.sheenRoughnessMap,l(O.sheenRoughnessMap,P.sheenRoughnessMapTransform))),O.clearcoat>0&&(P.clearcoat.value=O.clearcoat,P.clearcoatRoughness.value=O.clearcoatRoughness,O.clearcoatMap&&(P.clearcoatMap.value=O.clearcoatMap,l(O.clearcoatMap,P.clearcoatMapTransform)),O.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=O.clearcoatRoughnessMap,l(O.clearcoatRoughnessMap,P.clearcoatRoughnessMapTransform)),O.clearcoatNormalMap&&(P.clearcoatNormalMap.value=O.clearcoatNormalMap,l(O.clearcoatNormalMap,P.clearcoatNormalMapTransform),P.clearcoatNormalScale.value.copy(O.clearcoatNormalScale),O.side===Ce&&P.clearcoatNormalScale.value.negate())),O.iridescence>0&&(P.iridescence.value=O.iridescence,P.iridescenceIOR.value=O.iridescenceIOR,P.iridescenceThicknessMinimum.value=O.iridescenceThicknessRange[0],P.iridescenceThicknessMaximum.value=O.iridescenceThicknessRange[1],O.iridescenceMap&&(P.iridescenceMap.value=O.iridescenceMap,l(O.iridescenceMap,P.iridescenceMapTransform)),O.iridescenceThicknessMap&&(P.iridescenceThicknessMap.value=O.iridescenceThicknessMap,l(O.iridescenceThicknessMap,P.iridescenceThicknessMapTransform))),O.transmission>0&&(P.transmission.value=O.transmission,P.transmissionSamplerMap.value=F.texture,P.transmissionSamplerSize.value.set(F.width,F.height),O.transmissionMap&&(P.transmissionMap.value=O.transmissionMap,l(O.transmissionMap,P.transmissionMapTransform)),P.thickness.value=O.thickness,O.thicknessMap&&(P.thicknessMap.value=O.thicknessMap,l(O.thicknessMap,P.thicknessMapTransform)),P.attenuationDistance.value=O.attenuationDistance,P.attenuationColor.value.copy(O.attenuationColor)),P.specularIntensity.value=O.specularIntensity,P.specularColor.value.copy(O.specularColor),O.specularColorMap&&(P.specularColorMap.value=O.specularColorMap,l(O.specularColorMap,P.specularColorMapTransform)),O.specularIntensityMap&&(P.specularIntensityMap.value=O.specularIntensityMap,l(O.specularIntensityMap,P.specularIntensityMapTransform))}(f,v,D)):v.isMeshMatcapMaterial?(h(f,v),function(P,O){O.matcap&&(P.matcap.value=O.matcap)}(f,v)):v.isMeshDepthMaterial?h(f,v):v.isMeshDistanceMaterial?(h(f,v),function(P,O){const F=r.get(O).light;P.referencePosition.value.setFromMatrixPosition(F.matrixWorld),P.nearDistance.value=F.shadow.camera.near,P.farDistance.value=F.shadow.camera.far}(f,v)):v.isMeshNormalMaterial?h(f,v):v.isLineBasicMaterial?(function(P,O){P.diffuse.value.copy(O.color),P.opacity.value=O.opacity,O.map&&(P.map.value=O.map,l(O.map,P.mapTransform))}(f,v),v.isLineDashedMaterial&&function(P,O){P.dashSize.value=O.dashSize,P.totalSize.value=O.dashSize+O.gapSize,P.scale.value=O.scale}(f,v)):v.isPointsMaterial?function(P,O,F,N){P.diffuse.value.copy(O.color),P.opacity.value=O.opacity,P.size.value=O.size*F,P.scale.value=.5*N,O.map&&(P.map.value=O.map,l(O.map,P.uvTransform)),O.alphaMap&&(P.alphaMap.value=O.alphaMap),O.alphaTest>0&&(P.alphaTest.value=O.alphaTest)}(f,v,b,E):v.isSpriteMaterial?function(P,O){P.diffuse.value.copy(O.color),P.opacity.value=O.opacity,P.rotation.value=O.rotation,O.map&&(P.map.value=O.map,l(O.map,P.mapTransform)),O.alphaMap&&(P.alphaMap.value=O.alphaMap),O.alphaTest>0&&(P.alphaTest.value=O.alphaTest)}(f,v):v.isShadowMaterial?(f.color.value.copy(v.color),f.opacity.value=v.opacity):v.isShaderMaterial&&(v.transmission!==void 0&&(f.transmission&&(f.transmission.value=v.transmission),f.transmissionSamplerMap&&D&&(f.transmissionSamplerMap.value=D?D.texture:null),f.transmissionSamplerSize&&D&&f.transmissionSamplerSize.value.set(D.width,D.height)),v.uniformsNeedUpdate=!1)}}}function ny(A,r,l,h){let f={},v={},b=[];const E=l.isWebGL2?A.getParameter(A.MAX_UNIFORM_BUFFER_BINDINGS):0;function D(F,N,z){const G=F.value;if(z[N]===void 0){if(typeof G=="number")z[N]=G;else{const W=Array.isArray(G)?G:[G],Q=[];for(let q=0;q<W.length;q++)Q.push(W[q].clone());z[N]=Q}return!0}if(typeof G=="number"){if(z[N]!==G)return z[N]=G,!0}else{const W=Array.isArray(z[N])?z[N]:[z[N]],Q=Array.isArray(G)?G:[G];for(let q=0;q<W.length;q++){const K=W[q];if(K.equals(Q[q])===!1)return K.copy(Q[q]),!0}}return!1}function P(F){const N={boundary:0,storage:0};return typeof F=="number"?(N.boundary=4,N.storage=4):F.isVector2?(N.boundary=8,N.storage=8):F.isVector3||F.isColor?(N.boundary=16,N.storage=12):F.isVector4?(N.boundary=16,N.storage=16):F.isMatrix3?(N.boundary=48,N.storage=48):F.isMatrix4?(N.boundary=64,N.storage=64):F.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",F),N}function O(F){const N=F.target;N.removeEventListener("dispose",O);const z=b.indexOf(N.__bindingPointIndex);b.splice(z,1),A.deleteBuffer(f[N.id]),delete f[N.id],delete v[N.id]}return{bind:function(F,N){const z=N.program;h.uniformBlockBinding(F,z)},update:function(F,N){let z=f[F.id];z===void 0&&(function(Q){const q=Q.uniforms;let K=0,ne=0;for(let be=0,ve=q.length;be<ve;be++){const me=q[be],Pe={boundary:0,storage:0},tt=Array.isArray(me.value)?me.value:[me.value];for(let Oe=0,pt=tt.length;Oe<pt;Oe++){const ke=P(tt[Oe]);Pe.boundary+=ke.boundary,Pe.storage+=ke.storage}me.__data=new Float32Array(Pe.storage/Float32Array.BYTES_PER_ELEMENT),me.__offset=K,be>0&&(ne=K%16,ne!==0&&16-ne-Pe.boundary<0&&(K+=16-ne,me.__offset=K)),K+=Pe.storage}ne=K%16,ne>0&&(K+=16-ne),Q.__size=K,Q.__cache={}}(F),z=function(Q){const q=function(){for(let ve=0;ve<E;ve++)if(b.indexOf(ve)===-1)return b.push(ve),ve;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Q.__bindingPointIndex=q;const K=A.createBuffer(),ne=Q.__size,be=Q.usage;return A.bindBuffer(A.UNIFORM_BUFFER,K),A.bufferData(A.UNIFORM_BUFFER,ne,be),A.bindBuffer(A.UNIFORM_BUFFER,null),A.bindBufferBase(A.UNIFORM_BUFFER,q,K),K}(F),f[F.id]=z,F.addEventListener("dispose",O));const G=N.program;h.updateUBOMapping(F,G);const W=r.render.frame;v[F.id]!==W&&(function(Q){const q=f[Q.id],K=Q.uniforms,ne=Q.__cache;A.bindBuffer(A.UNIFORM_BUFFER,q);for(let be=0,ve=K.length;be<ve;be++){const me=K[be];if(D(me,be,ne)===!0){const Pe=me.__offset,tt=Array.isArray(me.value)?me.value:[me.value];let Oe=0;for(let pt=0;pt<tt.length;pt++){const ke=tt[pt],Mt=P(ke);typeof ke=="number"?(me.__data[0]=ke,A.bufferSubData(A.UNIFORM_BUFFER,Pe+Oe,me.__data)):ke.isMatrix3?(me.__data[0]=ke.elements[0],me.__data[1]=ke.elements[1],me.__data[2]=ke.elements[2],me.__data[3]=ke.elements[0],me.__data[4]=ke.elements[3],me.__data[5]=ke.elements[4],me.__data[6]=ke.elements[5],me.__data[7]=ke.elements[0],me.__data[8]=ke.elements[6],me.__data[9]=ke.elements[7],me.__data[10]=ke.elements[8],me.__data[11]=ke.elements[0]):(ke.toArray(me.__data,Oe),Oe+=Mt.storage/Float32Array.BYTES_PER_ELEMENT)}A.bufferSubData(A.UNIFORM_BUFFER,Pe,me.__data)}}A.bindBuffer(A.UNIFORM_BUFFER,null)}(F),v[F.id]=W)},dispose:function(){for(const F in f)A.deleteBuffer(f[F]);b=[],f={},v={}}}}function Vb(){const A=ka("canvas");return A.style.display="block",A}class Ha{constructor(r={}){const{canvas:l=Vb(),context:h=null,depth:f=!0,stencil:v=!0,alpha:b=!1,antialias:E=!1,premultipliedAlpha:D=!0,preserveDrawingBuffer:P=!1,powerPreference:O="default",failIfMajorPerformanceCaveat:F=!1}=r;let N;this.isWebGLRenderer=!0,N=h!==null?h.getContextAttributes().alpha:b;let z=null,G=null;const W=[],Q=[];this.domElement=l,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Jn,this.useLegacyLights=!0,this.toneMapping=Ki,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const q=this;let K=!1,ne=0,be=0,ve=null,me=-1,Pe=null;const tt=new ji,Oe=new ji;let pt=null,ke=l.width,Mt=l.height,Ot=1,tn=null,An=null;const nn=new ji(0,0,ke,Mt),Xt=new ji(0,0,ke,Mt);let dn=!1;const gn=new km;let xt=!1,Wt=!1,un=null;const Zt=new si,_n=new fe,ai={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function De(){return ve===null?Ot:1}let we,ot,Ve,Re,it,de,Ge,ze,Ut,Lt,qt,vn,Tn,ei,Cn,mi,li,Qn,cr,Po,ci,Xi,Vi,Fu,It=h;function Xh(Te,Rt){for(let Nt=0;Nt<Te.length;Nt++){const jt=Te[Nt],rn=l.getContext(jt,Rt);if(rn!==null)return rn}return null}try{const Te={alpha:!0,depth:f,stencil:v,antialias:E,premultipliedAlpha:D,preserveDrawingBuffer:P,powerPreference:O,failIfMajorPerformanceCaveat:F};if("setAttribute"in l&&l.setAttribute("data-engine",`three.js r${qe}`),l.addEventListener("webglcontextlost",jg,!1),l.addEventListener("webglcontextrestored",zg,!1),l.addEventListener("webglcontextcreationerror",nA,!1),It===null){const Rt=["webgl2","webgl","experimental-webgl"];if(q.isWebGL1Renderer===!0&&Rt.shift(),It=Xh(Rt,Te),It===null)throw Xh(Rt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}It.getShaderPrecisionFormat===void 0&&(It.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Te){throw console.error("THREE.WebGLRenderer: "+Te.message),Te}function Fg(){we=new _b(It),ot=new gf(It,we,r),we.init(ot),Xi=new ty(It,we,ot),Ve=new ey(It,we,ot),Re=new U0(It),it=new ll,de=new Th(It,we,Ve,it,ot,Xi,Re),Ge=new Fm(q),ze=new _f(q),Ut=new zv(It,ot),Vi=new Vv(It,we,Ut,ot),Lt=new H1(It,Ut,Re,Vi),qt=new _c(It,Lt,Ut,Re),cr=new oo(It,ot,de),mi=new Nm(it),vn=new Ol(q,Ge,ze,we,ot,Vi,mi),Tn=new tE(q,it),ei=new Mh,Cn=new $1(we,ot),Qn=new Um(q,Ge,ze,Ve,qt,N,D),li=new zb(q,qt,ot),Fu=new ny(It,Re,ot,Ve),Po=new L0(It,we,Re,ot),ci=new xh(It,we,Re,ot),Re.programs=vn.programs,q.capabilities=ot,q.extensions=we,q.properties=it,q.renderLists=ei,q.shadowMap=li,q.state=Ve,q.info=Re,q.background=Qn,q.cubemaps=Ge,q.cubeuvmaps=ze,q.materials=Tn}Fg();const Wo=new eE(q,It);function jg(Te){Te.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),K=!0,q.onContextLost(Te)}function zg(){console.log("THREE.WebGLRenderer: Context Restored."),K=!1;const Te=q.info?q.info.autoReset:void 0,Rt=li.enabled,Nt=li.autoUpdate,jt=li.needsUpdate,rn=li.type;Fg(),q.info&&Te!==void 0&&(q.info.autoReset=Te),li.enabled=Rt,li.autoUpdate=Nt,li.needsUpdate=jt,li.type=rn,q.onContextRestore&&q.onContextRestore(),console.log("restored")}function nA(Te){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Te.statusMessage),q.onContextCreationError(Te)}function Lw(Te){const Rt=Te.target;Rt.removeEventListener("dispose",Lw),function(Nt){(function(jt){const rn=it.get(jt).programs;rn!==void 0&&(rn.forEach(function(On){vn.releaseProgram(On)}),jt.isShaderMaterial&&vn.releaseShaderCache(jt))})(Nt),it.remove(Nt)}(Rt)}this.xr=Wo,this.getContext=function(){return It},this.getContextAttributes=function(){return It.getContextAttributes()},this.forceContextLoss=function(){const Te=we.get("WEBGL_lose_context");Te&&Te.loseContext()},this.forceContextRestore=function(){const Te=we.get("WEBGL_lose_context");Te&&Te.restoreContext()},this.getPixelRatio=function(){return Ot},this.setPixelRatio=function(Te){Te!==void 0&&(Ot=Te,this.setSize(ke,Mt,!1))},this.getSize=function(Te){return Te.set(ke,Mt)},this.setSize=function(Te,Rt,Nt=!0){Wo.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(ke=Te,Mt=Rt,l.width=Math.floor(Te*Ot),l.height=Math.floor(Rt*Ot),Nt===!0&&(l.style.width=Te+"px",l.style.height=Rt+"px"),this.setViewport(0,0,Te,Rt))},this.getDrawingBufferSize=function(Te){return Te.set(ke*Ot,Mt*Ot).floor()},this.setDrawingBufferSize=function(Te,Rt,Nt){ke=Te,Mt=Rt,Ot=Nt,l.width=Math.floor(Te*Nt),l.height=Math.floor(Rt*Nt),this.setViewport(0,0,Te,Rt)},this.getCurrentViewport=function(Te){return Te.copy(tt)},this.getViewport=function(Te){return Te.copy(nn)},this.setViewport=function(Te,Rt,Nt,jt){Te.isVector4?nn.set(Te.x,Te.y,Te.z,Te.w):nn.set(Te,Rt,Nt,jt),Ve.viewport(tt.copy(nn).multiplyScalar(Ot).floor())},this.getScissor=function(Te){return Te.copy(Xt)},this.setScissor=function(Te,Rt,Nt,jt){Te.isVector4?Xt.set(Te.x,Te.y,Te.z,Te.w):Xt.set(Te,Rt,Nt,jt),Ve.scissor(Oe.copy(Xt).multiplyScalar(Ot).floor())},this.getScissorTest=function(){return dn},this.setScissorTest=function(Te){Ve.setScissorTest(dn=Te)},this.setOpaqueSort=function(Te){tn=Te},this.setTransparentSort=function(Te){An=Te},this.getClearColor=function(Te){return Te.copy(Qn.getClearColor())},this.setClearColor=function(){Qn.setClearColor.apply(Qn,arguments)},this.getClearAlpha=function(){return Qn.getClearAlpha()},this.setClearAlpha=function(){Qn.setClearAlpha.apply(Qn,arguments)},this.clear=function(Te=!0,Rt=!0,Nt=!0){let jt=0;Te&&(jt|=It.COLOR_BUFFER_BIT),Rt&&(jt|=It.DEPTH_BUFFER_BIT),Nt&&(jt|=It.STENCIL_BUFFER_BIT),It.clear(jt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){l.removeEventListener("webglcontextlost",jg,!1),l.removeEventListener("webglcontextrestored",zg,!1),l.removeEventListener("webglcontextcreationerror",nA,!1),ei.dispose(),Cn.dispose(),it.dispose(),Ge.dispose(),ze.dispose(),qt.dispose(),Vi.dispose(),Fu.dispose(),vn.dispose(),Wo.dispose(),Wo.removeEventListener("sessionstart",iA),Wo.removeEventListener("sessionend",Yh),un&&(un.dispose(),un=null),Kh.stop()},this.renderBufferDirect=function(Te,Rt,Nt,jt,rn,On){Rt===null&&(Rt=ai);const Gi=rn.isMesh&&rn.matrixWorld.determinant()<0,di=function(Ms,ju,Ts,pi,Is){ju.isScene!==!0&&(ju=ai),de.resetTextureUnits();const Gg=ju.fog,kw=pi.isMeshStandardMaterial?ju.environment:null,vE=ve===null?q.outputColorSpace:ve.isXRRenderTarget===!0||ve.texture.colorSpace&&ve.texture.colorSpace!==Jn?ve.texture.colorSpace:fr,Ap=(pi.isMeshStandardMaterial?ze:Ge).get(pi.envMap||kw),oA=pi.vertexColors===!0&&!!Ts.attributes.color&&Ts.attributes.color.itemSize===4,_E=!!pi.normalMap&&!!Ts.attributes.tangent,Kf=!!Ts.morphAttributes.position,yE=!!Ts.morphAttributes.normal,AE=!!Ts.morphAttributes.color,zu=pi.toneMapped?q.toneMapping:Ki,Ks=Ts.morphAttributes.position||Ts.morphAttributes.normal||Ts.morphAttributes.color,Vu=Ks!==void 0?Ks.length:0,ur=it.get(pi),Jh=G.state.lights;if(xt===!0&&(Wt===!0||Ms!==Pe)){const Ea=Ms===Pe&&pi.id===me;mi.setState(pi,Ms,Ea)}let Gl=!1;pi.version===ur.__version?ur.needsLights&&ur.lightsStateVersion!==Jh.state.version||ur.outputColorSpace!==vE||Is.isInstancedMesh&&ur.instancing===!1?Gl=!0:Is.isInstancedMesh||ur.instancing!==!0?Is.isSkinnedMesh&&ur.skinning===!1?Gl=!0:Is.isSkinnedMesh||ur.skinning!==!0?ur.envMap!==Ap||pi.fog===!0&&ur.fog!==Gg?Gl=!0:ur.numClippingPlanes===void 0||ur.numClippingPlanes===mi.numPlanes&&ur.numIntersection===mi.numIntersection?(ur.vertexAlphas!==oA||ur.vertexTangents!==_E||ur.morphTargets!==Kf||ur.morphNormals!==yE||ur.morphColors!==AE||ur.toneMapping!==zu||ot.isWebGL2===!0&&ur.morphTargetsCount!==Vu)&&(Gl=!0):Gl=!0:Gl=!0:Gl=!0:(Gl=!0,ur.__version=pi.version);let qo=ur.currentProgram;Gl===!0&&(qo=eu(pi,ju,Is));let U_=!1,Hl=!1,ho=!1;const Ro=qo.getUniforms(),hl=ur.uniforms;if(Ve.useProgram(qo.program)&&(U_=!0,Hl=!0,ho=!0),pi.id!==me&&(me=pi.id,Hl=!0),U_||Pe!==Ms){if(Ro.setValue(It,"projectionMatrix",Ms.projectionMatrix),ot.logarithmicDepthBuffer&&Ro.setValue(It,"logDepthBufFC",2/(Math.log(Ms.far+1)/Math.LN2)),Pe!==Ms&&(Pe=Ms,Hl=!0,ho=!0),pi.isShaderMaterial||pi.isMeshPhongMaterial||pi.isMeshToonMaterial||pi.isMeshStandardMaterial||pi.envMap){const Ea=Ro.map.cameraPosition;Ea!==void 0&&Ea.setValue(It,_n.setFromMatrixPosition(Ms.matrixWorld))}(pi.isMeshPhongMaterial||pi.isMeshToonMaterial||pi.isMeshLambertMaterial||pi.isMeshBasicMaterial||pi.isMeshStandardMaterial||pi.isShaderMaterial)&&Ro.setValue(It,"isOrthographic",Ms.isOrthographicCamera===!0),(pi.isMeshPhongMaterial||pi.isMeshToonMaterial||pi.isMeshLambertMaterial||pi.isMeshBasicMaterial||pi.isMeshStandardMaterial||pi.isShaderMaterial||pi.isShadowMaterial||Is.isSkinnedMesh)&&Ro.setValue(It,"viewMatrix",Ms.matrixWorldInverse)}if(Is.isSkinnedMesh){Ro.setOptional(It,Is,"bindMatrix"),Ro.setOptional(It,Is,"bindMatrixInverse");const Ea=Is.skeleton;Ea&&(ot.floatVertexTextures?(Ea.boneTexture===null&&Ea.computeBoneTexture(),Ro.setValue(It,"boneTexture",Ea.boneTexture,de),Ro.setValue(It,"boneTextureSize",Ea.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Gu=Ts.morphAttributes;var Ur,Xa;(Gu.position!==void 0||Gu.normal!==void 0||Gu.color!==void 0&&ot.isWebGL2===!0)&&cr.update(Is,Ts,qo),(Hl||ur.receiveShadow!==Is.receiveShadow)&&(ur.receiveShadow=Is.receiveShadow,Ro.setValue(It,"receiveShadow",Is.receiveShadow)),pi.isMeshGouraudMaterial&&pi.envMap!==null&&(hl.envMap.value=Ap,hl.flipEnvMap.value=Ap.isCubeTexture&&Ap.isRenderTargetTexture===!1?-1:1),Hl&&(Ro.setValue(It,"toneMappingExposure",q.toneMappingExposure),ur.needsLights&&(Xa=ho,(Ur=hl).ambientLightColor.needsUpdate=Xa,Ur.lightProbe.needsUpdate=Xa,Ur.directionalLights.needsUpdate=Xa,Ur.directionalLightShadows.needsUpdate=Xa,Ur.pointLights.needsUpdate=Xa,Ur.pointLightShadows.needsUpdate=Xa,Ur.spotLights.needsUpdate=Xa,Ur.spotLightShadows.needsUpdate=Xa,Ur.rectAreaLights.needsUpdate=Xa,Ur.hemisphereLights.needsUpdate=Xa),Gg&&pi.fog===!0&&Tn.refreshFogUniforms(hl,Gg),Tn.refreshMaterialUniforms(hl,pi,Ot,Mt,q.userData.transmissionRenderTarget||un),$d.upload(It,ur.uniformsList,hl,de)),pi.isShaderMaterial&&pi.uniformsNeedUpdate===!0&&($d.upload(It,ur.uniformsList,hl,de),pi.uniformsNeedUpdate=!1),pi.isSpriteMaterial&&Ro.setValue(It,"center",Is.center),Ro.setValue(It,"modelViewMatrix",Is.modelViewMatrix),Ro.setValue(It,"normalMatrix",Is.normalMatrix),Ro.setValue(It,"modelMatrix",Is.matrixWorld);const xa=pi.extraUniformsToUpload;if(xa&&Object.entries(xa).forEach(([Ea,bp])=>Ro.setValue(It,Ea,bp.value,de)),pi.isShaderMaterial||pi.isRawShaderMaterial){const Ea=pi.uniformsGroups;for(let bp=0,aA=Ea.length;bp<aA;bp++)if(ot.isWebGL2){const Uw=Ea[bp];Fu.update(Uw,qo),Fu.bind(Uw,qo)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return qo}(Te,Rt,Nt,jt,rn);Ve.setMaterial(jt,Gi);let gi=Nt.index,nr=1;jt.wireframe===!0&&(gi=Lt.getWireframeAttribute(Nt),nr=2);const Yi=Nt.drawRange,Oi=Nt.attributes.position;let uo=Yi.start*nr,qa=(Yi.start+Yi.count)*nr;On!==null&&(uo=Math.max(uo,On.start*nr),qa=Math.min(qa,(On.start+On.count)*nr)),gi!==null?(uo=Math.max(uo,0),qa=Math.min(qa,gi.count)):Oi!=null&&(uo=Math.max(uo,0),qa=Math.min(qa,Oi.count));const or=qa-uo;if(or<0||or===1/0)return;let Yf;Vi.setup(rn,jt,di,Nt,gi);let Gr=Po;if(gi!==null&&(Yf=Ut.get(gi),Gr=ci,Gr.setIndex(Yf)),rn.isMesh)jt.wireframe===!0?(Ve.setLineWidth(jt.wireframeLinewidth*De()),Gr.setMode(It.LINES)):Gr.setMode(It.TRIANGLES);else if(rn.isLine){let Ms=jt.linewidth;Ms===void 0&&(Ms=1),Ve.setLineWidth(Ms*De()),rn.isLineSegments?Gr.setMode(It.LINES):rn.isLineLoop?Gr.setMode(It.LINE_LOOP):Gr.setMode(It.LINE_STRIP)}else rn.isPoints?Gr.setMode(It.POINTS):rn.isSprite&&Gr.setMode(It.TRIANGLES);if(rn.isInstancedMesh)Gr.renderInstances(uo,or,rn.count);else if(Nt.isInstancedBufferGeometry){const Ms=Nt._maxInstanceCount!==void 0?Nt._maxInstanceCount:1/0,ju=Math.min(Nt.instanceCount,Ms);Gr.renderInstances(uo,or,ju)}else Gr.render(uo,or)},this.compile=function(Te,Rt){function Nt(jt,rn,On){jt.transparent===!0&&jt.side===ht&&jt.forceSinglePass===!1?(jt.side=Ce,jt.needsUpdate=!0,eu(jt,rn,On),jt.side=et,jt.needsUpdate=!0,eu(jt,rn,On),jt.side=ht):eu(jt,rn,On)}G=Cn.get(Te),G.init(),Q.push(G),Te.traverseVisible(function(jt){jt.isLight&&jt.layers.test(Rt.layers)&&(G.pushLight(jt),jt.castShadow&&G.pushShadow(jt))}),G.setupLights(q.useLegacyLights),Te.traverse(function(jt){const rn=jt.material;if(rn)if(Array.isArray(rn))for(let On=0;On<rn.length;On++)Nt(rn[On],Te,jt);else Nt(rn,Te,jt)}),Q.pop(),G=null};let O_=null;function iA(){Kh.stop()}function Yh(){Kh.start()}const Kh=new Hc;function L_(Te,Rt,Nt,jt){if(Te.visible===!1)return;if(Te.layers.test(Rt.layers)){if(Te.isGroup)Nt=Te.renderOrder;else if(Te.isLOD)Te.autoUpdate===!0&&Te.update(Rt);else if(Te.isLight)G.pushLight(Te),Te.castShadow&&G.pushShadow(Te);else if(Te.isSprite){if(!Te.frustumCulled||gn.intersectsSprite(Te)){jt&&_n.setFromMatrixPosition(Te.matrixWorld).applyMatrix4(Zt);const On=qt.update(Te),Gi=Te.material;Gi.visible&&z.push(Te,On,Gi,Nt,_n.z,null)}}else if((Te.isMesh||Te.isLine||Te.isPoints)&&(!Te.frustumCulled||gn.intersectsObject(Te))){Te.isSkinnedMesh&&Te.skeleton.frame!==Re.render.frame&&(Te.skeleton.update(),Te.skeleton.frame=Re.render.frame);const On=qt.update(Te),Gi=Te.material;if(jt&&(On.boundingSphere===null&&On.computeBoundingSphere(),_n.copy(On.boundingSphere.center).applyMatrix4(Te.matrixWorld).applyMatrix4(Zt)),Array.isArray(Gi)){const di=On.groups;for(let gi=0,nr=di.length;gi<nr;gi++){const Yi=di[gi],Oi=Gi[Yi.materialIndex];Oi&&Oi.visible&&z.push(Te,On,Oi,Nt,_n.z,Yi)}}else Gi.visible&&z.push(Te,On,Gi,Nt,_n.z,null)}}const rn=Te.children;for(let On=0,Gi=rn.length;On<Gi;On++)L_(rn[On],Rt,Nt,jt)}function k_(Te,Rt,Nt,jt){const rn=Te.opaque,On=Te.transmissive,Gi=Te.transparent;if(G.setupLightsView(Nt),xt===!0&&mi.setGlobalState(q.clippingPlanes,Nt),q.userData.transmissionRender===void 0&&q.userData.renderTransmissionPass!==!1&&On.length>0&&function(di,gi,nr,Yi){if(console.warn("three.js internal render transmission pass should not be called"),un===null){const or=ot.isWebGL2;un=new yo(1024,1024,{generateMipmaps:!0,type:we.has("EXT_color_buffer_half_float")?pr:ec,minFilter:bl,samples:or&&E===!0?4:0})}const Oi=q.getRenderTarget();q.setRenderTarget(un),q.clear();const uo=q.toneMapping;q.toneMapping=Ki,Vg(di,nr,Yi),de.updateMultisampleRenderTarget(un),de.updateRenderTargetMipmap(un);let qa=!1;for(let or=0,Yf=gi.length;or<Yf;or++){const Gr=gi[or],Ms=Gr.object,ju=Gr.geometry,Ts=Gr.material,pi=Gr.group;if(Ts.side===ht&&Ms.layers.test(Yi.layers)){const Is=Ts.side;Ts.side=Ce,Ts.needsUpdate=!0,rA(Ms,nr,Yi,ju,Ts,pi),Ts.side=Is,Ts.needsUpdate=!0,qa=!0}}qa===!0&&(de.updateMultisampleRenderTarget(un),de.updateRenderTargetMipmap(un)),q.setRenderTarget(Oi),q.toneMapping=uo}([...rn,...Gi],On,Rt,Nt),jt&&Ve.viewport(tt.copy(jt)),q.userData.opaqueRender!==!1&&rn.length>0&&Vg(rn,Rt,Nt),q.userData.transparentRender!==!1&&Gi.length>0&&Vg(Gi,Rt,Nt),q.userData.transmissionRender!==!1&&On.length>0){un||(un=new yo(1,1));const di=(q.userData.transmissionRenderTarget||un).texture,gi=ot.isWebGL2,nr=di.generateMipmaps,Yi=di.minFilter;gi&&q.userData.blurTransmissionTarget&&q.userData.transmissionRenderTarget&&(di.generateMipmaps=!0,di.minFilter=bl,di.needsUpdate=!0,de.updateMultisampleRenderTarget(q.userData.transmissionRenderTarget),de.updateRenderTargetMipmap(q.userData.transmissionRenderTarget)),Vg(On,Rt,Nt),gi&&q.userData.blurTransmissionTarget&&q.userData.transmissionRenderTarget&&(di.generateMipmaps=nr,di.minFilter=Yi,di.needsUpdate=!0,de.updateMultisampleRenderTarget(q.userData.transmissionRenderTarget),de.updateRenderTargetMipmap(q.userData.transmissionRenderTarget))}Ve.buffers.depth.setTest(!0),Ve.buffers.depth.setMask(!0),Ve.buffers.color.setMask(!0),Ve.setPolygonOffset(!1)}function Vg(Te,Rt,Nt){const jt={...q.userData};q.userData.opaqueRender=void 0,q.userData.transparentRender=void 0,q.userData.transmissionRender=void 0,q.userData.backgroundRender=void 0;const rn=Rt.isScene===!0?Rt.overrideMaterial:null;for(let On=0,Gi=Te.length;On<Gi;On++){const di=Te[On],gi=di.object,nr=di.geometry,Yi=rn===null?di.material:rn,Oi=di.group;gi.layers.test(Nt.layers)&&rA(gi,Rt,Nt,nr,Yi,Oi)}Object.assign(q.userData,jt)}function rA(Te,Rt,Nt,jt,rn,On){Te.onBeforeRender(q,Rt,Nt,jt,rn,On),Te.modelViewMatrix.multiplyMatrices(Nt.matrixWorldInverse,Te.matrixWorld),Te.normalMatrix.getNormalMatrix(Te.modelViewMatrix),rn.onBeforeRender(q,Rt,Nt,jt,Te,On),rn.transparent===!0&&rn.side===ht&&rn.forceSinglePass===!1?(rn.side=Ce,rn.needsUpdate=!0,q.renderBufferDirect(Nt,Rt,jt,rn,Te,On),rn.side=et,rn.needsUpdate=!0,q.renderBufferDirect(Nt,Rt,jt,rn,Te,On),rn.side=ht):q.renderBufferDirect(Nt,Rt,jt,rn,Te,On),Te.onAfterRender(q,Rt,Nt,jt,rn,On),rn.onAfterRender(q,Rt,Nt,jt,Te,On)}function eu(Te,Rt,Nt){Rt.isScene!==!0&&(Rt=ai);const jt=it.get(Te),rn=G.state.lights,On=G.state.shadowsArray,Gi=rn.state.version,di=vn.getParameters(Te,rn.state,On,Rt,Nt),gi=vn.getProgramCacheKey(di);let nr=jt.programs;jt.environment=Te.isMeshStandardMaterial?Rt.environment:null,jt.fog=Rt.fog,jt.envMap=(Te.isMeshStandardMaterial?ze:Ge).get(Te.envMap||jt.environment),nr===void 0&&(Te.addEventListener("dispose",Lw),nr=new Map,jt.programs=nr);let Yi=nr.get(gi);if(Yi!==void 0){if(jt.currentProgram===Yi&&jt.lightsStateVersion===Gi)return sA(Te,di),Yi}else di.uniforms=vn.getUniforms(Te),Te.onBuild(Nt,di,q),Te.onBeforeCompile(di,q),Yi=vn.acquireProgram(di,gi),nr.set(gi,Yi),jt.uniforms=di.uniforms;const Oi=jt.uniforms;(Te.isShaderMaterial||Te.isRawShaderMaterial)&&Te.clipping!==!0||(Oi.clippingPlanes=mi.uniform),sA(Te,di),jt.needsLights=function(or){return or.isMeshLambertMaterial||or.isMeshToonMaterial||or.isMeshPhongMaterial||or.isMeshStandardMaterial||or.isShadowMaterial||or.isShaderMaterial&&or.lights===!0}(Te),jt.lightsStateVersion=Gi,jt.needsLights&&(Oi.ambientLightColor.value=rn.state.ambient,Oi.lightProbe.value=rn.state.probe,Oi.directionalLights.value=rn.state.directional,Oi.directionalLightShadows.value=rn.state.directionalShadow,Oi.spotLights.value=rn.state.spot,Oi.spotLightShadows.value=rn.state.spotShadow,Oi.rectAreaLights.value=rn.state.rectArea,Oi.ltc_1.value=rn.state.rectAreaLTC1,Oi.ltc_2.value=rn.state.rectAreaLTC2,Oi.pointLights.value=rn.state.point,Oi.pointLightShadows.value=rn.state.pointShadow,Oi.hemisphereLights.value=rn.state.hemi,Oi.directionalShadowMap.value=rn.state.directionalShadowMap,Oi.directionalShadowMatrix.value=rn.state.directionalShadowMatrix,Oi.spotShadowMap.value=rn.state.spotShadowMap,Oi.spotLightMatrix.value=rn.state.spotLightMatrix,Oi.spotLightMap.value=rn.state.spotLightMap,Oi.pointShadowMap.value=rn.state.pointShadowMap,Oi.pointShadowMatrix.value=rn.state.pointShadowMatrix);const uo=Yi.getUniforms(),qa=$d.seqWithValue(uo.seq,Oi);return jt.currentProgram=Yi,jt.uniformsList=qa,Yi}function sA(Te,Rt){const Nt=it.get(Te);Nt.outputColorSpace=Rt.outputColorSpace,Nt.instancing=Rt.instancing,Nt.skinning=Rt.skinning,Nt.morphTargets=Rt.morphTargets,Nt.morphNormals=Rt.morphNormals,Nt.morphColors=Rt.morphColors,Nt.morphTargetsCount=Rt.morphTargetsCount,Nt.numClippingPlanes=Rt.numClippingPlanes,Nt.numIntersection=Rt.numClipIntersection,Nt.vertexAlphas=Rt.vertexAlphas,Nt.vertexTangents=Rt.vertexTangents,Nt.toneMapping=Rt.toneMapping}Kh.setAnimationLoop(function(Te){O_&&O_(Te)}),typeof self<"u"&&Kh.setContext(self),this.setAnimationLoop=function(Te){O_=Te,Wo.setAnimationLoop(Te),Te===null?Kh.stop():Kh.start()},Wo.addEventListener("sessionstart",iA),Wo.addEventListener("sessionend",Yh),this.render=function(Te,Rt){if(Rt===void 0||Rt.isCamera===!0){if(K!==!0){if(Te.matrixWorldAutoUpdate===!0&&Te.updateMatrixWorld(),Rt.parent===null&&Rt.matrixWorldAutoUpdate===!0&&Rt.updateMatrixWorld(),Wo.enabled===!0&&Wo.isPresenting===!0&&(Wo.cameraAutoUpdate===!0&&Wo.updateCamera(Rt),Rt=Wo.getCamera()),Te.isScene===!0&&Te.onBeforeRender(q,Te,Rt,ve),G=Cn.get(Te,Q.length),G.init(),Q.push(G),Zt.multiplyMatrices(Rt.projectionMatrix,Rt.matrixWorldInverse),gn.setFromProjectionMatrix(Zt),Wt=this.localClippingEnabled,xt=mi.init(this.clippingPlanes,Wt),z=ei.get(Te,W.length),z.init(),W.push(z),L_(Te,Rt,0,q.sortObjects),z.finish(),q.sortObjects===!0&&z.sort(tn,An),q.userData.shadowMapRender!==!1){xt===!0&&mi.beginShadows();const Nt=G.state.shadowsArray;Nt.length>0&&li.render(Nt,Te,Rt),xt===!0&&mi.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),q.userData.backgroundRender!==!1&&Qn.render(z,Te),q.userData.sceneRender!==!1)if(G.setupLights(q.useLegacyLights),Rt.isArrayCamera){const Nt=Rt.cameras;for(let jt=0,rn=Nt.length;jt<rn;jt++){const On=Nt[jt];k_(z,Te,On,On.viewport)}}else k_(z,Te,Rt);ve!==null&&(de.updateMultisampleRenderTarget(ve),de.updateRenderTargetMipmap(ve)),Te.isScene===!0&&Te.onAfterRender(q,Te,Rt),Vi.resetDefaultState(),me=-1,Pe=null,Q.pop(),G=Q.length>0?Q[Q.length-1]:null,W.pop(),z=W.length>0?W[W.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return ne},this.getActiveMipmapLevel=function(){return be},this.getRenderTarget=function(){return ve},this.setRenderTargetTextures=function(Te,Rt,Nt){it.get(Te.texture).__webglTexture=Rt,it.get(Te.depthTexture).__webglTexture=Nt;const jt=it.get(Te);jt.__hasExternalTextures=!0,jt.__hasExternalTextures&&(jt.__autoAllocateDepthBuffer=Nt===void 0,jt.__autoAllocateDepthBuffer||we.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),jt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Te,Rt){const Nt=it.get(Te);Nt.__webglFramebuffer=Rt,Nt.__useDefaultFramebuffer=Rt===void 0},this.setRenderTarget=function(Te,Rt=0,Nt=0){ve=Te,ne=Rt,be=Nt;let jt=!0,rn=null,On=!1,Gi=!1;if(Te){const di=it.get(Te);di.__useDefaultFramebuffer!==void 0?(Ve.bindFramebuffer(It.FRAMEBUFFER,null),jt=!1):di.__webglFramebuffer===void 0?de.setupRenderTarget(Te):di.__hasExternalTextures&&de.rebindTextures(Te,it.get(Te.texture).__webglTexture,it.get(Te.depthTexture).__webglTexture);const gi=Te.texture;(gi.isData3DTexture||gi.isDataArrayTexture||gi.isCompressedArrayTexture)&&(Gi=!0);const nr=it.get(Te).__webglFramebuffer;Te.isWebGLCubeRenderTarget?(rn=nr[Rt],On=!0):rn=ot.isWebGL2&&Te.samples>0&&de.useMultisampledRTT(Te)===!1?it.get(Te).__webglMultisampledFramebuffer:nr,tt.copy(Te.viewport),Oe.copy(Te.scissor),pt=Te.scissorTest}else tt.copy(nn).multiplyScalar(Ot).floor(),Oe.copy(Xt).multiplyScalar(Ot).floor(),pt=dn;if(Ve.bindFramebuffer(It.FRAMEBUFFER,rn)&&ot.drawBuffers&&jt&&Ve.drawBuffers(Te,rn),Ve.viewport(tt),Ve.scissor(Oe),Ve.setScissorTest(pt),On){const di=it.get(Te.texture);It.framebufferTexture2D(It.FRAMEBUFFER,It.COLOR_ATTACHMENT0,It.TEXTURE_CUBE_MAP_POSITIVE_X+Rt,di.__webglTexture,Nt)}else if(Gi){const di=it.get(Te.texture),gi=Rt||0;It.framebufferTextureLayer(It.FRAMEBUFFER,It.COLOR_ATTACHMENT0,di.__webglTexture,Nt||0,gi)}me=-1},this.readRenderTargetPixels=function(Te,Rt,Nt,jt,rn,On,Gi,di){if(!Te||!Te.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let gi=it.get(Te).__webglFramebuffer;if(Te.isWebGLCubeRenderTarget&&Gi!==void 0&&(gi=gi[Gi]),gi){Ve.bindFramebuffer(It.FRAMEBUFFER,gi);try{const nr=Array.isArray(Te.texture)?Te.texture[di||0]:Te.texture,Yi=nr.format,Oi=nr.type;if(Yi!==Sr&&Xi.convert(Yi)!==It.getParameter(It.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const uo=Oi===pr&&(we.has("EXT_color_buffer_half_float")||ot.isWebGL2&&we.has("EXT_color_buffer_float"));if(!(Oi===ec||Xi.convert(Oi)===It.getParameter(It.IMPLEMENTATION_COLOR_READ_TYPE)||Oi===tc&&(ot.isWebGL2||we.has("OES_texture_float")||we.has("WEBGL_color_buffer_float"))||uo))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Rt>=0&&Rt<=Te.width-jt&&Nt>=0&&Nt<=Te.height-rn&&(Te.isWebGLMultipleRenderTargets&&It.readBuffer(It.COLOR_ATTACHMENT0+di),It.readPixels(Rt,Nt,jt,rn,Xi.convert(Yi),Xi.convert(Oi),On))}finally{const nr=ve?it.get(ve).__webglFramebuffer:null;Ve.bindFramebuffer(It.FRAMEBUFFER,nr)}}},this.copyFramebufferToTexture=function(Te,Rt,Nt=0){const jt=Math.pow(2,-Nt),rn=Math.floor(Rt.image.width*jt),On=Math.floor(Rt.image.height*jt);de.setTexture2D(Rt,0),It.copyTexSubImage2D(It.TEXTURE_2D,Nt,0,0,Te.x,Te.y,rn,On),Ve.unbindTexture()},this.copyTextureToTexture=function(Te,Rt,Nt,jt=0){const rn=Rt.image.width,On=Rt.image.height,Gi=Xi.convert(Nt.format),di=Xi.convert(Nt.type);de.setTexture2D(Nt,0),It.pixelStorei(It.UNPACK_FLIP_Y_WEBGL,Nt.flipY),It.pixelStorei(It.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Nt.premultiplyAlpha),It.pixelStorei(It.UNPACK_ALIGNMENT,Nt.unpackAlignment),Rt.isDataTexture?It.texSubImage2D(It.TEXTURE_2D,jt,Te.x,Te.y,rn,On,Gi,di,Rt.image.data):Rt.isCompressedTexture?It.compressedTexSubImage2D(It.TEXTURE_2D,jt,Te.x,Te.y,Rt.mipmaps[0].width,Rt.mipmaps[0].height,Gi,Rt.mipmaps[0].data):It.texSubImage2D(It.TEXTURE_2D,jt,Te.x,Te.y,Gi,di,Rt.image),jt===0&&Nt.generateMipmaps&&It.generateMipmap(It.TEXTURE_2D),Ve.unbindTexture()},this.copyTextureToTexture3D=function(Te,Rt,Nt,jt,rn=0){if(q.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const On=Te.max.x-Te.min.x+1,Gi=Te.max.y-Te.min.y+1,di=Te.max.z-Te.min.z+1,gi=Xi.convert(jt.format),nr=Xi.convert(jt.type);let Yi;if(jt.isData3DTexture)de.setTexture3D(jt,0),Yi=It.TEXTURE_3D;else{if(!jt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");de.setTexture2DArray(jt,0),Yi=It.TEXTURE_2D_ARRAY}It.pixelStorei(It.UNPACK_FLIP_Y_WEBGL,jt.flipY),It.pixelStorei(It.UNPACK_PREMULTIPLY_ALPHA_WEBGL,jt.premultiplyAlpha),It.pixelStorei(It.UNPACK_ALIGNMENT,jt.unpackAlignment);const Oi=It.getParameter(It.UNPACK_ROW_LENGTH),uo=It.getParameter(It.UNPACK_IMAGE_HEIGHT),qa=It.getParameter(It.UNPACK_SKIP_PIXELS),or=It.getParameter(It.UNPACK_SKIP_ROWS),Yf=It.getParameter(It.UNPACK_SKIP_IMAGES),Gr=Nt.isCompressedTexture?Nt.mipmaps[0]:Nt.image;It.pixelStorei(It.UNPACK_ROW_LENGTH,Gr.width),It.pixelStorei(It.UNPACK_IMAGE_HEIGHT,Gr.height),It.pixelStorei(It.UNPACK_SKIP_PIXELS,Te.min.x),It.pixelStorei(It.UNPACK_SKIP_ROWS,Te.min.y),It.pixelStorei(It.UNPACK_SKIP_IMAGES,Te.min.z),Nt.isDataTexture||Nt.isData3DTexture?It.texSubImage3D(Yi,rn,Rt.x,Rt.y,Rt.z,On,Gi,di,gi,nr,Gr.data):Nt.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),It.compressedTexSubImage3D(Yi,rn,Rt.x,Rt.y,Rt.z,On,Gi,di,gi,Gr.data)):It.texSubImage3D(Yi,rn,Rt.x,Rt.y,Rt.z,On,Gi,di,gi,nr,Gr),It.pixelStorei(It.UNPACK_ROW_LENGTH,Oi),It.pixelStorei(It.UNPACK_IMAGE_HEIGHT,uo),It.pixelStorei(It.UNPACK_SKIP_PIXELS,qa),It.pixelStorei(It.UNPACK_SKIP_ROWS,or),It.pixelStorei(It.UNPACK_SKIP_IMAGES,Yf),rn===0&&jt.generateMipmaps&&It.generateMipmap(Yi),Ve.unbindTexture()},this.initTexture=function(Te){Te.isCubeTexture?de.setTextureCube(Te,0):Te.isData3DTexture?de.setTexture3D(Te,0):Te.isDataArrayTexture||Te.isCompressedArrayTexture?de.setTexture2DArray(Te,0):de.setTexture2D(Te,0),Ve.unbindTexture()},this.resetState=function(){ne=0,be=0,ve=null,Ve.reset(),Vi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(r){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!r}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Jn?Cl:Id}set outputEncoding(r){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=r===Cl?Jn:fr}}class To extends Ha{}To.prototype.isWebGL1Renderer=!0;class t_{constructor(r,l=25e-5){this.isFogExp2=!0,this.name="",this.color=new xn(r),this.density=l}clone(){return new t_(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class n_{constructor(r,l=1,h=1e3){this.isFog=!0,this.name="",this.color=new xn(r),this.near=l,this.far=h}clone(){return new n_(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class tp extends zi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,l){return super.copy(r,l),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),this.backgroundBlurriness=r.backgroundBlurriness,this.backgroundIntensity=r.backgroundIntensity,r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const l=super.toJSON(r);return this.fog!==null&&(l.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(l.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(l.object.backgroundIntensity=this.backgroundIntensity),l}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(r){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=r}}class Ih{constructor(r,l){this.isInterleavedBuffer=!0,this.array=r,this.stride=l,this.count=r!==void 0?r.length/l:0,this.usage=lc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ss()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,l,h){r*=this.stride,h*=l.stride;for(let f=0,v=this.stride;f<v;f++)this.array[r+f]=l.array[h+f];return this}set(r,l=0){return this.array.set(r,l),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ss()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const l=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),h=new this.constructor(l,this.stride);return h.setUsage(this.usage),h}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ss()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Lr=new fe;class kl{constructor(r,l,h,f=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=r,this.itemSize=l,this.offset=h,this.normalized=f}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(r){this.data.needsUpdate=r}applyMatrix4(r){for(let l=0,h=this.data.count;l<h;l++)Lr.fromBufferAttribute(this,l),Lr.applyMatrix4(r),this.setXYZ(l,Lr.x,Lr.y,Lr.z);return this}applyNormalMatrix(r){for(let l=0,h=this.count;l<h;l++)Lr.fromBufferAttribute(this,l),Lr.applyNormalMatrix(r),this.setXYZ(l,Lr.x,Lr.y,Lr.z);return this}transformDirection(r){for(let l=0,h=this.count;l<h;l++)Lr.fromBufferAttribute(this,l),Lr.transformDirection(r),this.setXYZ(l,Lr.x,Lr.y,Lr.z);return this}setX(r,l){return this.normalized&&(l=Mi(l,this.array)),this.data.array[r*this.data.stride+this.offset]=l,this}setY(r,l){return this.normalized&&(l=Mi(l,this.array)),this.data.array[r*this.data.stride+this.offset+1]=l,this}setZ(r,l){return this.normalized&&(l=Mi(l,this.array)),this.data.array[r*this.data.stride+this.offset+2]=l,this}setW(r,l){return this.normalized&&(l=Mi(l,this.array)),this.data.array[r*this.data.stride+this.offset+3]=l,this}getX(r){let l=this.data.array[r*this.data.stride+this.offset];return this.normalized&&(l=ia(l,this.array)),l}getY(r){let l=this.data.array[r*this.data.stride+this.offset+1];return this.normalized&&(l=ia(l,this.array)),l}getZ(r){let l=this.data.array[r*this.data.stride+this.offset+2];return this.normalized&&(l=ia(l,this.array)),l}getW(r){let l=this.data.array[r*this.data.stride+this.offset+3];return this.normalized&&(l=ia(l,this.array)),l}setXY(r,l,h){return r=r*this.data.stride+this.offset,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array)),this.data.array[r+0]=l,this.data.array[r+1]=h,this}setXYZ(r,l,h,f){return r=r*this.data.stride+this.offset,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array),f=Mi(f,this.array)),this.data.array[r+0]=l,this.data.array[r+1]=h,this.data.array[r+2]=f,this}setXYZW(r,l,h,f,v){return r=r*this.data.stride+this.offset,this.normalized&&(l=Mi(l,this.array),h=Mi(h,this.array),f=Mi(f,this.array),v=Mi(v,this.array)),this.data.array[r+0]=l,this.data.array[r+1]=h,this.data.array[r+2]=f,this.data.array[r+3]=v,this}clone(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const l=[];for(let h=0;h<this.count;h++){const f=h*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)l.push(this.data.array[f+v])}return new tr(new this.array.constructor(l),this.itemSize,this.normalized)}return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.clone(r)),new kl(r.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const l=[];for(let h=0;h<this.count;h++){const f=h*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)l.push(this.data.array[f+v])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:l,normalized:this.normalized}}return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.toJSON(r)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Cu extends ks{constructor(r){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new xn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}}let qs;const Mu=new fe,np=new fe,xf=new fe,ip=new Ht,eg=new Ht,Gb=new si,tg=new fe,Ef=new fe,cs=new fe,ki=new Ht,Sf=new Ht,br=new Ht;class Hb extends zi{constructor(r){if(super(),this.isSprite=!0,this.type="Sprite",qs===void 0){qs=new Y;const l=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),h=new Ih(l,5);qs.setIndex([0,1,2,0,2,3]),qs.setAttribute("position",new kl(h,3,0,!1)),qs.setAttribute("uv",new kl(h,2,3,!1))}this.geometry=qs,this.material=r!==void 0?r:new Cu,this.center=new Ht(.5,.5)}raycast(r,l){r.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),np.setFromMatrixScale(this.matrixWorld),Gb.copy(r.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(r.camera.matrixWorldInverse,this.matrixWorld),xf.setFromMatrixPosition(this.modelViewMatrix),r.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&np.multiplyScalar(-xf.z);const h=this.material.rotation;let f,v;h!==0&&(v=Math.cos(h),f=Math.sin(h));const b=this.center;Cf(tg.set(-.5,-.5,0),xf,b,np,f,v),Cf(Ef.set(.5,-.5,0),xf,b,np,f,v),Cf(cs.set(.5,.5,0),xf,b,np,f,v),ki.set(0,0),Sf.set(1,0),br.set(1,1);let E=r.ray.intersectTriangle(tg,Ef,cs,!1,Mu);if(E===null&&(Cf(Ef.set(-.5,.5,0),xf,b,np,f,v),Sf.set(0,1),E=r.ray.intersectTriangle(tg,cs,Ef,!1,Mu),E===null))return;const D=r.ray.origin.distanceTo(Mu);D<r.near||D>r.far||l.push({distance:D,point:Mu.clone(),uv:Ls.getInterpolation(Mu,tg,Ef,cs,ki,Sf,br,new Ht),face:null,object:this})}copy(r,l){return super.copy(r,l),r.center!==void 0&&this.center.copy(r.center),this.material=r.material,this}}function Cf(A,r,l,h,f,v){ip.subVectors(A,l).addScalar(.5).multiply(h),f!==void 0?(eg.x=v*ip.x-f*ip.y,eg.y=f*ip.x+v*ip.y):eg.copy(ip),A.copy(r),A.x+=eg.x,A.y+=eg.y,A.applyMatrix4(Gb)}const Mf=new fe,Ul=new fe;class Tf extends zi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(r){super.copy(r,!1);const l=r.levels;for(let h=0,f=l.length;h<f;h++){const v=l[h];this.addLevel(v.object.clone(),v.distance,v.hysteresis)}return this.autoUpdate=r.autoUpdate,this}addLevel(r,l=0,h=0){l=Math.abs(l);const f=this.levels;let v;for(v=0;v<f.length&&!(l<f[v].distance);v++);return f.splice(v,0,{distance:l,hysteresis:h,object:r}),this.add(r),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){const l=this.levels;if(l.length>0){let h,f;for(h=1,f=l.length;h<f;h++){let v=l[h].distance;if(l[h].object.visible&&(v-=v*l[h].hysteresis),r<v)break}return l[h-1].object}return null}raycast(r,l){if(this.levels.length>0){Mf.setFromMatrixPosition(this.matrixWorld);const h=r.ray.origin.distanceTo(Mf);this.getObjectForDistance(h).raycast(r,l)}}update(r){const l=this.levels;if(l.length>1){Mf.setFromMatrixPosition(r.matrixWorld),Ul.setFromMatrixPosition(this.matrixWorld);const h=Mf.distanceTo(Ul)/r.zoom;let f,v;for(l[0].object.visible=!0,f=1,v=l.length;f<v;f++){let b=l[f].distance;if(l[f].object.visible&&(b-=b*l[f].hysteresis),!(h>=b))break;l[f-1].object.visible=!1,l[f].object.visible=!0}for(this._currentLevel=f-1;f<v;f++)l[f].object.visible=!1}}toJSON(r){const l=super.toJSON(r);this.autoUpdate===!1&&(l.object.autoUpdate=!1),l.object.levels=[];const h=this.levels;for(let f=0,v=h.length;f<v;f++){const b=h[f];l.object.levels.push({object:b.object.uuid,distance:b.distance,hysteresis:b.hysteresis})}return l}}const ng=new fe,iy=new ji,i_=new ji,Qb=new fe,r_=new si,Tu=new fe;class ry extends Us{constructor(r,l){super(r,l),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new si,this.bindMatrixInverse=new si,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const r=this.geometry;this.boundingBox===null&&(this.boundingBox=new bo),this.boundingBox.makeEmpty();const l=r.getAttribute("position");for(let h=0;h<l.count;h++)Tu.fromBufferAttribute(l,h),this.applyBoneTransform(h,Tu),this.boundingBox.expandByPoint(Tu)}computeBoundingSphere(){const r=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new la),this.boundingSphere.makeEmpty();const l=r.getAttribute("position");for(let h=0;h<l.count;h++)Tu.fromBufferAttribute(l,h),this.applyBoneTransform(h,Tu),this.boundingSphere.expandByPoint(Tu)}copy(r,l){return super.copy(r,l),this.bindMode=r.bindMode,this.bindMatrix.copy(r.bindMatrix),this.bindMatrixInverse.copy(r.bindMatrixInverse),this.skeleton=r.skeleton,this}getVertexPosition(r,l){return super.getVertexPosition(r,l),this.applyBoneTransform(r,l),l}bind(r,l){this.skeleton=r,l===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),l=this.matrixWorld),this.bindMatrix.copy(l),this.bindMatrixInverse.copy(l).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const r=new ji,l=this.geometry.attributes.skinWeight;for(let h=0,f=l.count;h<f;h++){r.fromBufferAttribute(l,h);const v=1/r.manhattanLength();v!==1/0?r.multiplyScalar(v):r.set(1,0,0,0),l.setXYZW(h,r.x,r.y,r.z,r.w)}}updateMatrixWorld(r){super.updateMatrixWorld(r),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(r,l){const h=this.skeleton,f=this.geometry;iy.fromBufferAttribute(f.attributes.skinIndex,r),i_.fromBufferAttribute(f.attributes.skinWeight,r),ng.copy(l).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(let v=0;v<4;v++){const b=i_.getComponent(v);if(b!==0){const E=iy.getComponent(v);r_.multiplyMatrices(h.bones[E].matrixWorld,h.boneInverses[E]),l.addScaledVector(Qb.copy(ng).applyMatrix4(r_),b)}}return l.applyMatrix4(this.bindMatrixInverse)}boneTransform(r,l){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(r,l)}}class ig extends zi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ph extends Or{constructor(r=null,l=1,h=1,f,v,b,E,D,P=vr,O=vr,F,N){super(null,b,E,D,P,O,f,v,F,N),this.isDataTexture=!0,this.image={data:r,width:l,height:h},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const s_=new si,Wb=new si;class rp{constructor(r=[],l=[]){this.uuid=ss(),this.bones=r.slice(0),this.boneInverses=l,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const r=this.bones,l=this.boneInverses;if(this.boneMatrices=new Float32Array(16*r.length),l.length===0)this.calculateInverses();else if(r.length!==l.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let h=0,f=this.bones.length;h<f;h++)this.boneInverses.push(new si)}}calculateInverses(){this.boneInverses.length=0;for(let r=0,l=this.bones.length;r<l;r++){const h=new si;this.bones[r]&&h.copy(this.bones[r].matrixWorld).invert(),this.boneInverses.push(h)}}pose(){for(let r=0,l=this.bones.length;r<l;r++){const h=this.bones[r];h&&h.matrixWorld.copy(this.boneInverses[r]).invert()}for(let r=0,l=this.bones.length;r<l;r++){const h=this.bones[r];h&&(h.parent&&h.parent.isBone?(h.matrix.copy(h.parent.matrixWorld).invert(),h.matrix.multiply(h.matrixWorld)):h.matrix.copy(h.matrixWorld),h.matrix.decompose(h.position,h.quaternion,h.scale))}}update(){const r=this.bones,l=this.boneInverses,h=this.boneMatrices,f=this.boneTexture;for(let v=0,b=r.length;v<b;v++){const E=r[v]?r[v].matrixWorld:Wb;s_.multiplyMatrices(E,l[v]),s_.toArray(h,16*v)}f!==null&&(f.needsUpdate=!0)}clone(){return new rp(this.bones,this.boneInverses)}computeBoneTexture(){let r=Math.sqrt(4*this.bones.length);r=Pi(r),r=Math.max(r,4);const l=new Float32Array(r*r*4);l.set(this.boneMatrices);const h=new Ph(l,r,r,Sr,tc);return h.needsUpdate=!0,this.boneMatrices=l,this.boneTexture=h,this.boneTextureSize=r,this}getBoneByName(r){for(let l=0,h=this.bones.length;l<h;l++){const f=this.bones[l];if(f.name===r)return f}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,l){this.uuid=r.uuid;for(let h=0,f=r.bones.length;h<f;h++){const v=r.bones[h];let b=l[v];b===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",v),b=new ig),this.bones.push(b),this.boneInverses.push(new si().fromArray(r.boneInverses[h]))}return this.init(),this}toJSON(){const r={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;const l=this.bones,h=this.boneInverses;for(let f=0,v=l.length;f<v;f++){const b=l[f];r.bones.push(b.uuid);const E=h[f];r.boneInverses.push(E.toArray())}return r}}class sp extends tr{constructor(r,l,h,f=1){super(r,l,h),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=f}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}toJSON(){const r=super.toJSON();return r.meshPerAttribute=this.meshPerAttribute,r.isInstancedBufferAttribute=!0,r}}const op=new si,sy=new si,Rh=[],oy=new bo,qb=new si,Ir=new Us,If=new la;class o_ extends Us{constructor(r,l,h){super(r,l),this.isInstancedMesh=!0,this.instanceMatrix=new sp(new Float32Array(16*h),16),this.instanceColor=null,this.sourceTrs=null,this.count=h,this.boundingBox=null,this.boundingSphere=null;for(let f=0;f<h;f++)this.setMatrixAt(f,qb)}computeBoundingBox(){const r=this.geometry,l=this.count;this.boundingBox===null&&(this.boundingBox=new bo),r.boundingBox===null&&r.computeBoundingBox(),this.boundingBox.makeEmpty();for(let h=0;h<l;h++)this.getMatrixAt(h,op),oy.copy(r.boundingBox).applyMatrix4(op),this.boundingBox.union(oy)}computeBoundingSphere(){const r=this.geometry,l=this.count;this.boundingSphere===null&&(this.boundingSphere=new la),r.boundingSphere===null&&r.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let h=0;h<l;h++)this.getMatrixAt(h,op),If.copy(r.boundingSphere).applyMatrix4(op),this.boundingSphere.union(If)}copy(r,l){return super.copy(r,l),r.isInstancedMesh?(this.instanceMatrix.copy(r.instanceMatrix),r.instanceColor!==null&&(this.instanceColor=r.instanceColor.clone()),this.count=r.count,this):this}getColorAt(r,l){l.fromArray(this.instanceColor.array,3*r)}getMatrixAt(r,l){l.fromArray(this.instanceMatrix.array,16*r)}raycast(r,l){const h=this.matrixWorld,f=this.count;if(Ir.geometry=this.geometry,Ir.material=this.material,Ir.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),If.copy(this.boundingSphere),If.applyMatrix4(h),r.ray.intersectsSphere(If)!==!1))for(let v=0;v<f;v++){this.getMatrixAt(v,op),sy.multiplyMatrices(h,op),Ir.matrixWorld=sy,Ir.raycast(r,Rh);for(let b=0,E=Rh.length;b<E;b++){const D=Rh[b];D.instanceId=v,D.object=this,l.push(D)}Rh.length=0}}setColorAt(r,l){this.instanceColor===null&&(this.instanceColor=new sp(new Float32Array(3*this.instanceMatrix.count),3)),l.toArray(this.instanceColor.array,3*r)}setMatrixAt(r,l){l.toArray(this.instanceMatrix.array,16*r)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Xs extends ks{constructor(r){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new xn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}}const a_=new fe,Xb=new fe,Yb=new si,ay=new io,l_=new la;class Dh extends zi{constructor(r=new Y,l=new Xs){super(),this.isLine=!0,this.type="Line",this.geometry=r,this.material=l,this.updateMorphTargets()}copy(r,l){return super.copy(r,l),this.material=r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.index===null){const l=r.attributes.position,h=[0];for(let f=1,v=l.count;f<v;f++)a_.fromBufferAttribute(l,f-1),Xb.fromBufferAttribute(l,f),h[f]=h[f-1],h[f]+=a_.distanceTo(Xb);r.setAttribute("lineDistance",new Pn(h,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,l){const h=this.geometry,f=this.matrixWorld,v=r.params.Line.threshold,b=h.drawRange;if(h.boundingSphere===null&&h.computeBoundingSphere(),l_.copy(h.boundingSphere),l_.applyMatrix4(f),l_.radius+=v,r.ray.intersectsSphere(l_)===!1)return;Yb.copy(f).invert(),ay.copy(r.ray).applyMatrix4(Yb);const E=v/((this.scale.x+this.scale.y+this.scale.z)/3),D=E*E,P=new fe,O=new fe,F=new fe,N=new fe,z=this.isLineSegments?2:1,G=h.index,W=h.attributes.position;if(G!==null)for(let Q=Math.max(0,b.start),q=Math.min(G.count,b.start+b.count)-1;Q<q;Q+=z){const K=G.getX(Q),ne=G.getX(Q+1);if(P.fromBufferAttribute(W,K),O.fromBufferAttribute(W,ne),ay.distanceSqToSegment(P,O,N,F)>D)continue;N.applyMatrix4(this.matrixWorld);const be=r.ray.origin.distanceTo(N);be<r.near||be>r.far||l.push({distance:be,point:F.clone().applyMatrix4(this.matrixWorld),index:Q,face:null,faceIndex:null,object:this})}else for(let Q=Math.max(0,b.start),q=Math.min(W.count,b.start+b.count)-1;Q<q;Q+=z){if(P.fromBufferAttribute(W,Q),O.fromBufferAttribute(W,Q+1),ay.distanceSqToSegment(P,O,N,F)>D)continue;N.applyMatrix4(this.matrixWorld);const K=r.ray.origin.distanceTo(N);K<r.near||K>r.far||l.push({distance:K,point:F.clone().applyMatrix4(this.matrixWorld),index:Q,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const r=this.geometry.morphAttributes,l=Object.keys(r);if(l.length>0){const h=r[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,v=h.length;f<v;f++){const b=h[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=f}}}}}const c_=new fe,Kb=new fe;class qc extends Dh{constructor(r,l){super(r,l),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const r=this.geometry;if(r.index===null){const l=r.attributes.position,h=[];for(let f=0,v=l.count;f<v;f+=2)c_.fromBufferAttribute(l,f),Kb.fromBufferAttribute(l,f+1),h[f]=f===0?0:h[f-1],h[f+1]=h[f]+c_.distanceTo(Kb);r.setAttribute("lineDistance",new Pn(h,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ly extends Dh{constructor(r,l){super(r,l),this.isLineLoop=!0,this.type="LineLoop"}}class Pf extends ks{constructor(r){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new xn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.size=r.size,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}}const cy=new si,rg=new io,Bh=new la,sg=new fe;class Rf extends zi{constructor(r=new Y,l=new Pf){super(),this.isPoints=!0,this.type="Points",this.geometry=r,this.material=l,this.updateMorphTargets()}copy(r,l){return super.copy(r,l),this.material=r.material,this.geometry=r.geometry,this}raycast(r,l){const h=this.geometry,f=this.matrixWorld,v=r.params.Points.threshold,b=h.drawRange;if(h.boundingSphere===null&&h.computeBoundingSphere(),Bh.copy(h.boundingSphere),Bh.applyMatrix4(f),Bh.radius+=v,r.ray.intersectsSphere(Bh)===!1)return;cy.copy(f).invert(),rg.copy(r.ray).applyMatrix4(cy);const E=v/((this.scale.x+this.scale.y+this.scale.z)/3),D=E*E,P=h.index,O=h.attributes.position;if(P!==null)for(let F=Math.max(0,b.start),N=Math.min(P.count,b.start+b.count);F<N;F++){const z=P.getX(F);sg.fromBufferAttribute(O,z),og(sg,z,D,f,r,l,this)}else for(let F=Math.max(0,b.start),N=Math.min(O.count,b.start+b.count);F<N;F++)sg.fromBufferAttribute(O,F),og(sg,F,D,f,r,l,this)}updateMorphTargets(){const r=this.geometry.morphAttributes,l=Object.keys(r);if(l.length>0){const h=r[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,v=h.length;f<v;f++){const b=h[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=f}}}}}function og(A,r,l,h,f,v,b){const E=rg.distanceSqToPoint(A);if(E<l){const D=new fe;rg.closestPointToPoint(A,D),D.applyMatrix4(h);const P=f.ray.origin.distanceTo(D);if(P<f.near||P>f.far)return;v.push({distance:P,distanceToRay:Math.sqrt(E),point:D,index:r,face:null,object:b})}}class uy extends Or{constructor(r,l,h,f,v,b,E,D,P){super(r,l,h,f,v,b,E,D,P),this.isVideoTexture=!0,this.minFilter=b!==void 0?b:_r,this.magFilter=v!==void 0?v:_r,this.generateMipmaps=!1;const O=this;"requestVideoFrameCallback"in r&&r.requestVideoFrameCallback(function F(){O.needsUpdate=!0,r.requestVideoFrameCallback(F)})}clone(){return new this.constructor(this.image).copy(this)}update(){const r=this.image;!("requestVideoFrameCallback"in r)&&r.readyState>=r.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class nE extends Or{constructor(r,l,h){super({width:r,height:l}),this.isFramebufferTexture=!0,this.format=h,this.magFilter=vr,this.minFilter=vr,this.generateMipmaps=!1,this.needsUpdate=!0}}class ap extends Or{constructor(r,l,h,f,v,b,E,D,P,O,F,N){super(null,b,E,D,P,O,f,v,F,N),this.isCompressedTexture=!0,this.image={width:l,height:h},this.mipmaps=r,this.flipY=!1,this.generateMipmaps=!1}}class u_ extends ap{constructor(r,l,h,f,v,b){super(r,l,h,v,b),this.isCompressedArrayTexture=!0,this.image.depth=f,this.wrapR=vs}}class Jb extends Or{constructor(r,l,h,f,v,b,E,D,P){super(r,l,h,f,v,b,E,D,P),this.isCanvasTexture=!0,this.needsUpdate=!0}}class cl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,l){const h=this.getUtoTmapping(r);return this.getPoint(h,l)}getPoints(r=5){const l=[];for(let h=0;h<=r;h++)l.push(this.getPoint(h/r));return l}getSpacedPoints(r=5){const l=[];for(let h=0;h<=r;h++)l.push(this.getPointAt(h/r));return l}getLength(){const r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const l=[];let h,f=this.getPoint(0),v=0;l.push(0);for(let b=1;b<=r;b++)h=this.getPoint(b/r),v+=h.distanceTo(f),l.push(v),f=h;return this.cacheArcLengths=l,l}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,l){const h=this.getLengths();let f=0;const v=h.length;let b;b=l||r*h[v-1];let E,D=0,P=v-1;for(;D<=P;)if(f=Math.floor(D+(P-D)/2),E=h[f]-b,E<0)D=f+1;else{if(!(E>0)){P=f;break}P=f-1}if(f=P,h[f]===b)return f/(v-1);const O=h[f];return(f+(b-O)/(h[f+1]-O))/(v-1)}getTangent(r,l){let f=r-1e-4,v=r+1e-4;f<0&&(f=0),v>1&&(v=1);const b=this.getPoint(f),E=this.getPoint(v),D=l||(b.isVector2?new Ht:new fe);return D.copy(E).sub(b).normalize(),D}getTangentAt(r,l){const h=this.getUtoTmapping(r);return this.getTangent(h,l)}computeFrenetFrames(r,l){const h=new fe,f=[],v=[],b=[],E=new fe,D=new si;for(let z=0;z<=r;z++){const G=z/r;f[z]=this.getTangentAt(G,new fe)}v[0]=new fe,b[0]=new fe;let P=Number.MAX_VALUE;const O=Math.abs(f[0].x),F=Math.abs(f[0].y),N=Math.abs(f[0].z);O<=P&&(P=O,h.set(1,0,0)),F<=P&&(P=F,h.set(0,1,0)),N<=P&&h.set(0,0,1),E.crossVectors(f[0],h).normalize(),v[0].crossVectors(f[0],E),b[0].crossVectors(f[0],v[0]);for(let z=1;z<=r;z++){if(v[z]=v[z-1].clone(),b[z]=b[z-1].clone(),E.crossVectors(f[z-1],f[z]),E.length()>Number.EPSILON){E.normalize();const G=Math.acos($i(f[z-1].dot(f[z]),-1,1));v[z].applyMatrix4(D.makeRotationAxis(E,G))}b[z].crossVectors(f[z],v[z])}if(l===!0){let z=Math.acos($i(v[0].dot(v[r]),-1,1));z/=r,f[0].dot(E.crossVectors(v[0],v[r]))>0&&(z=-z);for(let G=1;G<=r;G++)v[G].applyMatrix4(D.makeRotationAxis(f[G],z*G)),b[G].crossVectors(f[G],v[G])}return{tangents:f,normals:v,binormals:b}}clone(){return new this.constructor().copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){const r={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}}class ag extends cl{constructor(r=0,l=0,h=1,f=1,v=0,b=2*Math.PI,E=!1,D=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=r,this.aY=l,this.xRadius=h,this.yRadius=f,this.aStartAngle=v,this.aEndAngle=b,this.aClockwise=E,this.aRotation=D}getPoint(r,l){const h=l||new Ht,f=2*Math.PI;let v=this.aEndAngle-this.aStartAngle;const b=Math.abs(v)<Number.EPSILON;for(;v<0;)v+=f;for(;v>f;)v-=f;v<Number.EPSILON&&(v=b?0:f),this.aClockwise!==!0||b||(v===f?v=-f:v-=f);const E=this.aStartAngle+r*v;let D=this.aX+this.xRadius*Math.cos(E),P=this.aY+this.yRadius*Math.sin(E);if(this.aRotation!==0){const O=Math.cos(this.aRotation),F=Math.sin(this.aRotation),N=D-this.aX,z=P-this.aY;D=N*O-z*F+this.aX,P=N*F+z*O+this.aY}return h.set(D,P)}copy(r){return super.copy(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}toJSON(){const r=super.toJSON();return r.aX=this.aX,r.aY=this.aY,r.xRadius=this.xRadius,r.yRadius=this.yRadius,r.aStartAngle=this.aStartAngle,r.aEndAngle=this.aEndAngle,r.aClockwise=this.aClockwise,r.aRotation=this.aRotation,r}fromJSON(r){return super.fromJSON(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}}class Zb extends ag{constructor(r,l,h,f,v,b){super(r,l,h,h,f,v,b),this.isArcCurve=!0,this.type="ArcCurve"}}function lg(){let A=0,r=0,l=0,h=0;function f(v,b,E,D){A=v,r=E,l=-3*v+3*b-2*E-D,h=2*v-2*b+E+D}return{initCatmullRom:function(v,b,E,D,P){f(b,E,P*(E-v),P*(D-b))},initNonuniformCatmullRom:function(v,b,E,D,P,O,F){let N=(b-v)/P-(E-v)/(P+O)+(E-b)/O,z=(E-b)/O-(D-b)/(O+F)+(D-E)/F;N*=O,z*=O,f(b,E,N,z)},calc:function(v){const b=v*v;return A+r*v+l*b+h*(b*v)}}}const Iu=new fe,cg=new lg,hy=new lg,lp=new lg;class cp extends cl{constructor(r=[],l=!1,h="centripetal",f=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=r,this.closed=l,this.curveType=h,this.tension=f}getPoint(r,l=new fe){const h=l,f=this.points,v=f.length,b=(v-(this.closed?0:1))*r;let E,D,P=Math.floor(b),O=b-P;this.closed?P+=P>0?0:(Math.floor(Math.abs(P)/v)+1)*v:O===0&&P===v-1&&(P=v-2,O=1),this.closed||P>0?E=f[(P-1)%v]:(Iu.subVectors(f[0],f[1]).add(f[0]),E=Iu);const F=f[P%v],N=f[(P+1)%v];if(this.closed||P+2<v?D=f[(P+2)%v]:(Iu.subVectors(f[v-1],f[v-2]).add(f[v-1]),D=Iu),this.curveType==="centripetal"||this.curveType==="chordal"){const z=this.curveType==="chordal"?.5:.25;let G=Math.pow(E.distanceToSquared(F),z),W=Math.pow(F.distanceToSquared(N),z),Q=Math.pow(N.distanceToSquared(D),z);W<1e-4&&(W=1),G<1e-4&&(G=W),Q<1e-4&&(Q=W),cg.initNonuniformCatmullRom(E.x,F.x,N.x,D.x,G,W,Q),hy.initNonuniformCatmullRom(E.y,F.y,N.y,D.y,G,W,Q),lp.initNonuniformCatmullRom(E.z,F.z,N.z,D.z,G,W,Q)}else this.curveType==="catmullrom"&&(cg.initCatmullRom(E.x,F.x,N.x,D.x,this.tension),hy.initCatmullRom(E.y,F.y,N.y,D.y,this.tension),lp.initCatmullRom(E.z,F.z,N.z,D.z,this.tension));return h.set(cg.calc(O),hy.calc(O),lp.calc(O)),h}copy(r){super.copy(r),this.points=[];for(let l=0,h=r.points.length;l<h;l++){const f=r.points[l];this.points.push(f.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){const r=super.toJSON();r.points=[];for(let l=0,h=this.points.length;l<h;l++){const f=this.points[l];r.points.push(f.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let l=0,h=r.points.length;l<h;l++){const f=r.points[l];this.points.push(new fe().fromArray(f))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function $b(A,r,l,h,f){const v=.5*(h-r),b=.5*(f-l),E=A*A;return(2*l-2*h+v+b)*(A*E)+(-3*l+3*h-2*v-b)*E+v*A+l}function ug(A,r,l,h){return function(f,v){const b=1-f;return b*b*v}(A,r)+function(f,v){return 2*(1-f)*f*v}(A,l)+function(f,v){return f*f*v}(A,h)}function Df(A,r,l,h,f){return function(v,b){const E=1-v;return E*E*E*b}(A,r)+function(v,b){const E=1-v;return 3*E*E*v*b}(A,l)+function(v,b){return 3*(1-v)*v*v*b}(A,h)+function(v,b){return v*v*v*b}(A,f)}class hg extends cl{constructor(r=new Ht,l=new Ht,h=new Ht,f=new Ht){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=r,this.v1=l,this.v2=h,this.v3=f}getPoint(r,l=new Ht){const h=l,f=this.v0,v=this.v1,b=this.v2,E=this.v3;return h.set(Df(r,f.x,v.x,b.x,E.x),Df(r,f.y,v.y,b.y,E.y)),h}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}class dg extends cl{constructor(r=new fe,l=new fe,h=new fe,f=new fe){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=r,this.v1=l,this.v2=h,this.v3=f}getPoint(r,l=new fe){const h=l,f=this.v0,v=this.v1,b=this.v2,E=this.v3;return h.set(Df(r,f.x,v.x,b.x,E.x),Df(r,f.y,v.y,b.y,E.y),Df(r,f.z,v.z,b.z,E.z)),h}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}class pg extends cl{constructor(r=new Ht,l=new Ht){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=r,this.v2=l}getPoint(r,l=new Ht){const h=l;return r===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(r).add(this.v1)),h}getPointAt(r,l){return this.getPoint(r,l)}getTangent(r,l=new Ht){return l.subVectors(this.v2,this.v1).normalize()}getTangentAt(r,l){return this.getTangent(r,l)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class dy extends cl{constructor(r=new fe,l=new fe){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=r,this.v2=l}getPoint(r,l=new fe){const h=l;return r===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(r).add(this.v1)),h}getPointAt(r,l){return this.getPoint(r,l)}getTangent(r,l=new fe){return l.subVectors(this.v2,this.v1).normalize()}getTangentAt(r,l){return this.getTangent(r,l)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class h_ extends cl{constructor(r=new Ht,l=new Ht,h=new Ht){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=r,this.v1=l,this.v2=h}getPoint(r,l=new Ht){const h=l,f=this.v0,v=this.v1,b=this.v2;return h.set(ug(r,f.x,v.x,b.x),ug(r,f.y,v.y,b.y)),h}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class d_ extends cl{constructor(r=new fe,l=new fe,h=new fe){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=r,this.v1=l,this.v2=h}getPoint(r,l=new fe){const h=l,f=this.v0,v=this.v1,b=this.v2;return h.set(ug(r,f.x,v.x,b.x),ug(r,f.y,v.y,b.y),ug(r,f.z,v.z,b.z)),h}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class p_ extends cl{constructor(r=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=r}getPoint(r,l=new Ht){const h=l,f=this.points,v=(f.length-1)*r,b=Math.floor(v),E=v-b,D=f[b===0?b:b-1],P=f[b],O=f[b>f.length-2?f.length-1:b+1],F=f[b>f.length-3?f.length-1:b+2];return h.set($b(E,D.x,P.x,O.x,F.x),$b(E,D.y,P.y,O.y,F.y)),h}copy(r){super.copy(r),this.points=[];for(let l=0,h=r.points.length;l<h;l++){const f=r.points[l];this.points.push(f.clone())}return this}toJSON(){const r=super.toJSON();r.points=[];for(let l=0,h=this.points.length;l<h;l++){const f=this.points[l];r.points.push(f.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let l=0,h=r.points.length;l<h;l++){const f=r.points[l];this.points.push(new Ht().fromArray(f))}return this}}var py=Object.freeze({__proto__:null,ArcCurve:Zb,CatmullRomCurve3:cp,CubicBezierCurve:hg,CubicBezierCurve3:dg,EllipseCurve:ag,LineCurve:pg,LineCurve3:dy,QuadraticBezierCurve:h_,QuadraticBezierCurve3:d_,SplineCurve:p_});class fy extends cl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(r){this.curves.push(r)}closePath(){const r=this.curves[0].getPoint(0),l=this.curves[this.curves.length-1].getPoint(1);r.equals(l)||this.curves.push(new pg(l,r))}getPoint(r,l){const h=r*this.getLength(),f=this.getCurveLengths();let v=0;for(;v<f.length;){if(f[v]>=h){const b=f[v]-h,E=this.curves[v],D=E.getLength(),P=D===0?0:1-b/D;return E.getPointAt(P,l)}v++}return null}getLength(){const r=this.getCurveLengths();return r[r.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const r=[];let l=0;for(let h=0,f=this.curves.length;h<f;h++)l+=this.curves[h].getLength(),r.push(l);return this.cacheLengths=r,r}getSpacedPoints(r=40){const l=[];for(let h=0;h<=r;h++)l.push(this.getPoint(h/r));return this.autoClose&&l.push(l[0]),l}getPoints(r=12){const l=[];let h;for(let f=0,v=this.curves;f<v.length;f++){const b=v[f],E=b.isEllipseCurve?2*r:b.isLineCurve||b.isLineCurve3?1:b.isSplineCurve?r*b.points.length:r,D=b.getPoints(E);for(let P=0;P<D.length;P++){const O=D[P];h&&h.equals(O)||(l.push(O),h=O)}}return this.autoClose&&l.length>1&&!l[l.length-1].equals(l[0])&&l.push(l[0]),l}copy(r){super.copy(r),this.curves=[];for(let l=0,h=r.curves.length;l<h;l++){const f=r.curves[l];this.curves.push(f.clone())}return this.autoClose=r.autoClose,this}toJSON(){const r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let l=0,h=this.curves.length;l<h;l++){const f=this.curves[l];r.curves.push(f.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let l=0,h=r.curves.length;l<h;l++){const f=r.curves[l];this.curves.push(new py[f.type]().fromJSON(f))}return this}}class fg extends fy{constructor(r){super(),this.type="Path",this.currentPoint=new Ht,r&&this.setFromPoints(r)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let l=1,h=r.length;l<h;l++)this.lineTo(r[l].x,r[l].y);return this}moveTo(r,l){return this.currentPoint.set(r,l),this}lineTo(r,l){const h=new pg(this.currentPoint.clone(),new Ht(r,l));return this.curves.push(h),this.currentPoint.set(r,l),this}quadraticCurveTo(r,l,h,f){const v=new h_(this.currentPoint.clone(),new Ht(r,l),new Ht(h,f));return this.curves.push(v),this.currentPoint.set(h,f),this}bezierCurveTo(r,l,h,f,v,b){const E=new hg(this.currentPoint.clone(),new Ht(r,l),new Ht(h,f),new Ht(v,b));return this.curves.push(E),this.currentPoint.set(v,b),this}splineThru(r){const l=[this.currentPoint.clone()].concat(r),h=new p_(l);return this.curves.push(h),this.currentPoint.copy(r[r.length-1]),this}arc(r,l,h,f,v,b){const E=this.currentPoint.x,D=this.currentPoint.y;return this.absarc(r+E,l+D,h,f,v,b),this}absarc(r,l,h,f,v,b){return this.absellipse(r,l,h,h,f,v,b),this}ellipse(r,l,h,f,v,b,E,D){const P=this.currentPoint.x,O=this.currentPoint.y;return this.absellipse(r+P,l+O,h,f,v,b,E,D),this}absellipse(r,l,h,f,v,b,E,D){const P=new ag(r,l,h,f,v,b,E,D);if(this.curves.length>0){const F=P.getPoint(0);F.equals(this.currentPoint)||this.lineTo(F.x,F.y)}this.curves.push(P);const O=P.getPoint(1);return this.currentPoint.copy(O),this}copy(r){return super.copy(r),this.currentPoint.copy(r.currentPoint),this}toJSON(){const r=super.toJSON();return r.currentPoint=this.currentPoint.toArray(),r}fromJSON(r){return super.fromJSON(r),this.currentPoint.fromArray(r.currentPoint),this}}class Oh extends Y{constructor(r=[new Ht(0,-.5),new Ht(.5,0),new Ht(0,.5)],l=12,h=0,f=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:r,segments:l,phiStart:h,phiLength:f},l=Math.floor(l),f=$i(f,0,2*Math.PI);const v=[],b=[],E=[],D=[],P=[],O=1/l,F=new fe,N=new Ht,z=new fe,G=new fe,W=new fe;let Q=0,q=0;for(let K=0;K<=r.length-1;K++)switch(K){case 0:Q=r[K+1].x-r[K].x,q=r[K+1].y-r[K].y,z.x=1*q,z.y=-Q,z.z=0*q,W.copy(z),z.normalize(),D.push(z.x,z.y,z.z);break;case r.length-1:D.push(W.x,W.y,W.z);break;default:Q=r[K+1].x-r[K].x,q=r[K+1].y-r[K].y,z.x=1*q,z.y=-Q,z.z=0*q,G.copy(z),z.x+=W.x,z.y+=W.y,z.z+=W.z,z.normalize(),D.push(z.x,z.y,z.z),W.copy(G)}for(let K=0;K<=l;K++){const ne=h+K*O*f,be=Math.sin(ne),ve=Math.cos(ne);for(let me=0;me<=r.length-1;me++){F.x=r[me].x*be,F.y=r[me].y,F.z=r[me].x*ve,b.push(F.x,F.y,F.z),N.x=K/l,N.y=me/(r.length-1),E.push(N.x,N.y);const Pe=D[3*me+0]*be,tt=D[3*me+1],Oe=D[3*me+0]*ve;P.push(Pe,tt,Oe)}}for(let K=0;K<l;K++)for(let ne=0;ne<r.length-1;ne++){const be=ne+K*r.length,ve=be,me=be+r.length,Pe=be+r.length+1,tt=be+1;v.push(ve,me,tt),v.push(Pe,tt,me)}this.setIndex(v),this.setAttribute("position",new Pn(b,3)),this.setAttribute("uv",new Pn(E,2)),this.setAttribute("normal",new Pn(P,3))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Oh(r.points,r.segments,r.phiStart,r.phiLength)}}class mg extends Oh{constructor(r=1,l=1,h=4,f=8){const v=new fg;v.absarc(0,-l/2,r,1.5*Math.PI,0),v.absarc(0,l/2,r,0,.5*Math.PI),super(v.getPoints(h),f),this.type="CapsuleGeometry",this.parameters={radius:r,height:l,capSegments:h,radialSegments:f}}static fromJSON(r){return new mg(r.radius,r.length,r.capSegments,r.radialSegments)}}class up extends Y{constructor(r=1,l=32,h=0,f=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:l,thetaStart:h,thetaLength:f},l=Math.max(3,l);const v=[],b=[],E=[],D=[],P=new fe,O=new Ht;b.push(0,0,0),E.push(0,0,1),D.push(.5,.5);for(let F=0,N=3;F<=l;F++,N+=3){const z=h+F/l*f;P.x=r*Math.cos(z),P.y=r*Math.sin(z),b.push(P.x,P.y,P.z),E.push(0,0,1),O.x=(b[N]/r+1)/2,O.y=(b[N+1]/r+1)/2,D.push(O.x,O.y)}for(let F=1;F<=l;F++)v.push(F,F+1,0);this.setIndex(v),this.setAttribute("position",new Pn(b,3)),this.setAttribute("normal",new Pn(E,3)),this.setAttribute("uv",new Pn(D,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new up(r.radius,r.segments,r.thetaStart,r.thetaLength)}}class Lh extends Y{constructor(r=1,l=1,h=1,f=32,v=1,b=!1,E=0,D=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:r,radiusBottom:l,height:h,radialSegments:f,heightSegments:v,openEnded:b,thetaStart:E,thetaLength:D};const P=this;f=Math.floor(f),v=Math.floor(v);const O=[],F=[],N=[],z=[];let G=0;const W=[],Q=h/2;let q=0;function K(ne){const be=G,ve=new Ht,me=new fe;let Pe=0;const tt=ne===!0?r:l,Oe=ne===!0?1:-1;for(let ke=1;ke<=f;ke++)F.push(0,Q*Oe,0),N.push(0,Oe,0),z.push(.5,.5),G++;const pt=G;for(let ke=0;ke<=f;ke++){const Mt=ke/f*D+E,Ot=Math.cos(Mt),tn=Math.sin(Mt);me.x=tt*tn,me.y=Q*Oe,me.z=tt*Ot,F.push(me.x,me.y,me.z),N.push(0,Oe,0),ve.x=.5*Ot+.5,ve.y=.5*tn*Oe+.5,z.push(ve.x,ve.y),G++}for(let ke=0;ke<f;ke++){const Mt=be+ke,Ot=pt+ke;ne===!0?O.push(Ot,Ot+1,Mt):O.push(Ot+1,Ot,Mt),Pe+=3}P.addGroup(q,Pe,ne===!0?1:2),q+=Pe}(function(){const ne=new fe,be=new fe;let ve=0;const me=(l-r)/h;for(let Pe=0;Pe<=v;Pe++){const tt=[],Oe=Pe/v,pt=Oe*(l-r)+r;for(let ke=0;ke<=f;ke++){const Mt=ke/f,Ot=Mt*D+E,tn=Math.sin(Ot),An=Math.cos(Ot);be.x=pt*tn,be.y=-Oe*h+Q,be.z=pt*An,F.push(be.x,be.y,be.z),ne.set(tn,me,An).normalize(),N.push(ne.x,ne.y,ne.z),z.push(Mt,1-Oe),tt.push(G++)}W.push(tt)}for(let Pe=0;Pe<f;Pe++)for(let tt=0;tt<v;tt++){const Oe=W[tt][Pe],pt=W[tt+1][Pe],ke=W[tt+1][Pe+1],Mt=W[tt][Pe+1];O.push(Oe,pt,Mt),O.push(pt,ke,Mt),ve+=6}P.addGroup(q,ve,0),q+=ve})(),b===!1&&(r>0&&K(!0),l>0&&K(!1)),this.setIndex(O),this.setAttribute("position",new Pn(F,3)),this.setAttribute("normal",new Pn(N,3)),this.setAttribute("uv",new Pn(z,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Lh(r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class Bf extends Lh{constructor(r=1,l=1,h=32,f=1,v=!1,b=0,E=2*Math.PI){super(0,r,l,h,f,v,b,E),this.type="ConeGeometry",this.parameters={radius:r,height:l,radialSegments:h,heightSegments:f,openEnded:v,thetaStart:b,thetaLength:E}}static fromJSON(r){return new Bf(r.radius,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class Pu extends Y{constructor(r=[],l=[],h=1,f=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:l,radius:h,detail:f};const v=[],b=[];function E(N,z,G,W){const Q=W+1,q=[];for(let K=0;K<=Q;K++){q[K]=[];const ne=N.clone().lerp(G,K/Q),be=z.clone().lerp(G,K/Q),ve=Q-K;for(let me=0;me<=ve;me++)q[K][me]=me===0&&K===Q?ne:ne.clone().lerp(be,me/ve)}for(let K=0;K<Q;K++)for(let ne=0;ne<2*(Q-K)-1;ne++){const be=Math.floor(ne/2);ne%2==0?(D(q[K][be+1]),D(q[K+1][be]),D(q[K][be])):(D(q[K][be+1]),D(q[K+1][be+1]),D(q[K+1][be]))}}function D(N){v.push(N.x,N.y,N.z)}function P(N,z){const G=3*N;z.x=r[G+0],z.y=r[G+1],z.z=r[G+2]}function O(N,z,G,W){W<0&&N.x===1&&(b[z]=N.x-1),G.x===0&&G.z===0&&(b[z]=W/2/Math.PI+.5)}function F(N){return Math.atan2(N.z,-N.x)}(function(N){const z=new fe,G=new fe,W=new fe;for(let Q=0;Q<l.length;Q+=3)P(l[Q+0],z),P(l[Q+1],G),P(l[Q+2],W),E(z,G,W,N)})(f),function(N){const z=new fe;for(let G=0;G<v.length;G+=3)z.x=v[G+0],z.y=v[G+1],z.z=v[G+2],z.normalize().multiplyScalar(N),v[G+0]=z.x,v[G+1]=z.y,v[G+2]=z.z}(h),function(){const N=new fe;for(let G=0;G<v.length;G+=3){N.x=v[G+0],N.y=v[G+1],N.z=v[G+2];const W=F(N)/2/Math.PI+.5,Q=(z=N,Math.atan2(-z.y,Math.sqrt(z.x*z.x+z.z*z.z))/Math.PI+.5);b.push(W,1-Q)}var z;(function(){const G=new fe,W=new fe,Q=new fe,q=new fe,K=new Ht,ne=new Ht,be=new Ht;for(let ve=0,me=0;ve<v.length;ve+=9,me+=6){G.set(v[ve+0],v[ve+1],v[ve+2]),W.set(v[ve+3],v[ve+4],v[ve+5]),Q.set(v[ve+6],v[ve+7],v[ve+8]),K.set(b[me+0],b[me+1]),ne.set(b[me+2],b[me+3]),be.set(b[me+4],b[me+5]),q.copy(G).add(W).add(Q).divideScalar(3);const Pe=F(q);O(K,me+0,G,Pe),O(ne,me+2,W,Pe),O(be,me+4,Q,Pe)}})(),function(){for(let G=0;G<b.length;G+=6){const W=b[G+0],Q=b[G+2],q=b[G+4],K=Math.max(W,Q,q),ne=Math.min(W,Q,q);K>.9&&ne<.1&&(W<.2&&(b[G+0]+=1),Q<.2&&(b[G+2]+=1),q<.2&&(b[G+4]+=1))}}()}(),this.setAttribute("position",new Pn(v,3)),this.setAttribute("normal",new Pn(v.slice(),3)),this.setAttribute("uv",new Pn(b,2)),f===0?this.computeVertexNormals():this.normalizeNormals()}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Pu(r.vertices,r.indices,r.radius,r.details)}}class Of extends Pu{constructor(r=1,l=0){const h=(1+Math.sqrt(5))/2,f=1/h;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-f,-h,0,-f,h,0,f,-h,0,f,h,-f,-h,0,-f,h,0,f,-h,0,f,h,0,-h,0,-f,h,0,-f,-h,0,f,h,0,f],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],r,l),this.type="DodecahedronGeometry",this.parameters={radius:r,detail:l}}static fromJSON(r){return new Of(r.radius,r.detail)}}const Lf=new fe,f_=new fe,gg=new fe,m_=new Ls;class kf extends Y{constructor(r=null,l=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:r,thresholdAngle:l},r!==null){const f=Math.pow(10,4),v=Math.cos(na*l),b=r.getIndex(),E=r.getAttribute("position"),D=b?b.count:E.count,P=[0,0,0],O=["a","b","c"],F=new Array(3),N={},z=[];for(let G=0;G<D;G+=3){b?(P[0]=b.getX(G),P[1]=b.getX(G+1),P[2]=b.getX(G+2)):(P[0]=G,P[1]=G+1,P[2]=G+2);const{a:W,b:Q,c:q}=m_;if(W.fromBufferAttribute(E,P[0]),Q.fromBufferAttribute(E,P[1]),q.fromBufferAttribute(E,P[2]),m_.getNormal(gg),F[0]=`${Math.round(W.x*f)},${Math.round(W.y*f)},${Math.round(W.z*f)}`,F[1]=`${Math.round(Q.x*f)},${Math.round(Q.y*f)},${Math.round(Q.z*f)}`,F[2]=`${Math.round(q.x*f)},${Math.round(q.y*f)},${Math.round(q.z*f)}`,F[0]!==F[1]&&F[1]!==F[2]&&F[2]!==F[0])for(let K=0;K<3;K++){const ne=(K+1)%3,be=F[K],ve=F[ne],me=m_[O[K]],Pe=m_[O[ne]],tt=`${be}_${ve}`,Oe=`${ve}_${be}`;Oe in N&&N[Oe]?(gg.dot(N[Oe].normal)<=v&&(z.push(me.x,me.y,me.z),z.push(Pe.x,Pe.y,Pe.z)),N[Oe]=null):tt in N||(N[tt]={index0:P[K],index1:P[ne],normal:gg.clone()})}}for(const G in N)if(N[G]){const{index0:W,index1:Q}=N[G];Lf.fromBufferAttribute(E,W),f_.fromBufferAttribute(E,Q),z.push(Lf.x,Lf.y,Lf.z),z.push(f_.x,f_.y,f_.z)}this.setAttribute("position",new Pn(z,3))}}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}}class kh extends fg{constructor(r){super(r),this.uuid=ss(),this.type="Shape",this.holes=[]}getPointsHoles(r){const l=[];for(let h=0,f=this.holes.length;h<f;h++)l[h]=this.holes[h].getPoints(r);return l}extractPoints(r){return{shape:this.getPoints(r),holes:this.getPointsHoles(r)}}copy(r){super.copy(r),this.holes=[];for(let l=0,h=r.holes.length;l<h;l++){const f=r.holes[l];this.holes.push(f.clone())}return this}toJSON(){const r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let l=0,h=this.holes.length;l<h;l++){const f=this.holes[l];r.holes.push(f.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let l=0,h=r.holes.length;l<h;l++){const f=r.holes[l];this.holes.push(new fg().fromJSON(f))}return this}}function my(A,r,l,h,f){let v,b;if(f===function(E,D,P,O){let F=0;for(let N=D,z=P-O;N<P;N+=O)F+=(E[z]-E[N])*(E[N+1]+E[z+1]),z=N;return F}(A,r,l,h)>0)for(v=r;v<l;v+=h)b=__(v,A[v],A[v+1],b);else for(v=l-h;v>=r;v-=h)b=__(v,A[v],A[v+1],b);return b&&Ag(b,b.next)&&(Nf(b),b=b.next),b}function Uh(A,r){if(!A)return A;r||(r=A);let l,h=A;do if(l=!1,h.steiner||!Ag(h,h.next)&&Kr(h.prev,h,h.next)!==0)h=h.next;else{if(Nf(h),h=r=h.prev,h===h.next)break;l=!0}while(l||h!==r);return r}function vg(A,r,l,h,f,v,b){if(!A)return;!b&&v&&function(O,F,N,z){let G=O;do G.z===0&&(G.z=yy(G.x,G.y,F,N,z)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==O);G.prevZ.nextZ=null,G.prevZ=null,function(W){let Q,q,K,ne,be,ve,me,Pe,tt=1;do{for(q=W,W=null,be=null,ve=0;q;){for(ve++,K=q,me=0,Q=0;Q<tt&&(me++,K=K.nextZ,K);Q++);for(Pe=tt;me>0||Pe>0&&K;)me!==0&&(Pe===0||!K||q.z<=K.z)?(ne=q,q=q.nextZ,me--):(ne=K,K=K.nextZ,Pe--),be?be.nextZ=ne:W=ne,ne.prevZ=be,be=ne;q=K}be.nextZ=null,tt*=2}while(ve>1)}(G)}(A,h,f,v);let E,D,P=A;for(;A.prev!==A.next;)if(E=A.prev,D=A.next,v?gy(A,h,f,v):ew(A))r.push(E.i/l|0),r.push(A.i/l|0),r.push(D.i/l|0),Nf(A),A=D.next,P=D.next;else if((A=D)===P){b?b===1?vg(A=_g(Uh(A),r,l),r,l,h,f,v,2):b===2&&vy(A,r,l,h,f,v):vg(Uh(A),r,l,h,f,v,1);break}}function ew(A){const r=A.prev,l=A,h=A.next;if(Kr(r,l,h)>=0)return!1;const f=r.x,v=l.x,b=h.x,E=r.y,D=l.y,P=h.y,O=f<v?f<b?f:b:v<b?v:b,F=E<D?E<P?E:P:D<P?D:P,N=f>v?f>b?f:b:v>b?v:b,z=E>D?E>P?E:P:D>P?D:P;let G=h.next;for(;G!==r;){if(G.x>=O&&G.x<=N&&G.y>=F&&G.y<=z&&Uf(f,E,v,D,b,P,G.x,G.y)&&Kr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function gy(A,r,l,h){const f=A.prev,v=A,b=A.next;if(Kr(f,v,b)>=0)return!1;const E=f.x,D=v.x,P=b.x,O=f.y,F=v.y,N=b.y,z=E<D?E<P?E:P:D<P?D:P,G=O<F?O<N?O:N:F<N?F:N,W=E>D?E>P?E:P:D>P?D:P,Q=O>F?O>N?O:N:F>N?F:N,q=yy(z,G,r,l,h),K=yy(W,Q,r,l,h);let ne=A.prevZ,be=A.nextZ;for(;ne&&ne.z>=q&&be&&be.z<=K;){if(ne.x>=z&&ne.x<=W&&ne.y>=G&&ne.y<=Q&&ne!==f&&ne!==b&&Uf(E,O,D,F,P,N,ne.x,ne.y)&&Kr(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,be.x>=z&&be.x<=W&&be.y>=G&&be.y<=Q&&be!==f&&be!==b&&Uf(E,O,D,F,P,N,be.x,be.y)&&Kr(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;ne&&ne.z>=q;){if(ne.x>=z&&ne.x<=W&&ne.y>=G&&ne.y<=Q&&ne!==f&&ne!==b&&Uf(E,O,D,F,P,N,ne.x,ne.y)&&Kr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;be&&be.z<=K;){if(be.x>=z&&be.x<=W&&be.y>=G&&be.y<=Q&&be!==f&&be!==b&&Uf(E,O,D,F,P,N,be.x,be.y)&&Kr(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function _g(A,r,l){let h=A;do{const f=h.prev,v=h.next.next;!Ag(f,v)&&nw(f,h,h.next,v)&&Nh(f,v)&&Nh(v,f)&&(r.push(f.i/l|0),r.push(h.i/l|0),r.push(v.i/l|0),Nf(h),Nf(h.next),h=A=v),h=h.next}while(h!==A);return Uh(h)}function vy(A,r,l,h,f,v){let b=A;do{let E=b.next.next;for(;E!==b.prev;){if(b.i!==E.i&&tw(b,E)){let D=yc(b,E);return b=Uh(b,b.next),D=Uh(D,D.next),vg(b,r,l,h,f,v,0),void vg(D,r,l,h,f,v,0)}E=E.next}b=b.next}while(b!==A)}function yg(A,r){return A.x-r.x}function g_(A,r){const l=function(f,v){let b,E=v,D=-1/0;const P=f.x,O=f.y;do{if(O<=E.y&&O>=E.next.y&&E.next.y!==E.y){const Q=E.x+(O-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(Q<=P&&Q>D&&(D=Q,b=E.x<E.next.x?E:E.next,Q===P))return b}E=E.next}while(E!==v);if(!b)return null;const F=b,N=b.x,z=b.y;let G,W=1/0;E=b;do P>=E.x&&E.x>=N&&P!==E.x&&Uf(O<z?P:D,O,N,z,O<z?D:P,O,E.x,E.y)&&(G=Math.abs(O-E.y)/(P-E.x),Nh(E,f)&&(G<W||G===W&&(E.x>b.x||E.x===b.x&&_y(b,E)))&&(b=E,W=G)),E=E.next;while(E!==F);return b}(A,r);if(!l)return r;const h=yc(l,A);return Uh(h,h.next),Uh(l,l.next)}function _y(A,r){return Kr(A.prev,A,r.prev)<0&&Kr(r.next,A,A.next)<0}function yy(A,r,l,h,f){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-l)*f|0)|A<<8))|A<<4))|A<<2))|A<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function iE(A){let r=A,l=A;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==A);return l}function Uf(A,r,l,h,f,v,b,E){return(f-b)*(r-E)>=(A-b)*(v-E)&&(A-b)*(h-E)>=(l-b)*(r-E)&&(l-b)*(v-E)>=(f-b)*(h-E)}function tw(A,r){return A.next.i!==r.i&&A.prev.i!==r.i&&!function(l,h){let f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==h.i&&f.next.i!==h.i&&nw(f,f.next,l,h))return!0;f=f.next}while(f!==l);return!1}(A,r)&&(Nh(A,r)&&Nh(r,A)&&function(l,h){let f=l,v=!1;const b=(l.x+h.x)/2,E=(l.y+h.y)/2;do f.y>E!=f.next.y>E&&f.next.y!==f.y&&b<(f.next.x-f.x)*(E-f.y)/(f.next.y-f.y)+f.x&&(v=!v),f=f.next;while(f!==l);return v}(A,r)&&(Kr(A.prev,A,r.prev)||Kr(A,r.prev,r))||Ag(A,r)&&Kr(A.prev,A,A.next)>0&&Kr(r.prev,r,r.next)>0)}function Kr(A,r,l){return(r.y-A.y)*(l.x-r.x)-(r.x-A.x)*(l.y-r.y)}function Ag(A,r){return A.x===r.x&&A.y===r.y}function nw(A,r,l,h){const f=v_(Kr(A,r,l)),v=v_(Kr(A,r,h)),b=v_(Kr(l,h,A)),E=v_(Kr(l,h,r));return f!==v&&b!==E||!(f!==0||!bg(A,l,r))||!(v!==0||!bg(A,h,r))||!(b!==0||!bg(l,A,h))||!(E!==0||!bg(l,r,h))}function bg(A,r,l){return r.x<=Math.max(A.x,l.x)&&r.x>=Math.min(A.x,l.x)&&r.y<=Math.max(A.y,l.y)&&r.y>=Math.min(A.y,l.y)}function v_(A){return A>0?1:A<0?-1:0}function Nh(A,r){return Kr(A.prev,A,A.next)<0?Kr(A,r,A.next)>=0&&Kr(A,A.prev,r)>=0:Kr(A,r,A.prev)<0||Kr(A,A.next,r)<0}function yc(A,r){const l=new wg(A.i,A.x,A.y),h=new wg(r.i,r.x,r.y),f=A.next,v=r.prev;return A.next=r,r.prev=A,l.next=f,f.prev=l,h.next=l,l.prev=h,v.next=h,h.prev=v,h}function __(A,r,l,h){const f=new wg(A,r,l);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function Nf(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function wg(A,r,l){this.i=A,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class _a{static area(r){const l=r.length;let h=0;for(let f=l-1,v=0;v<l;f=v++)h+=r[f].x*r[v].y-r[v].x*r[f].y;return .5*h}static isClockWise(r){return _a.area(r)<0}static triangulateShape(r,l){const h=[],f=[],v=[];Vr(r),iw(h,r);let b=r.length;l.forEach(Vr);for(let D=0;D<l.length;D++)f.push(b),b+=l[D].length,iw(h,l[D]);const E=function(D,P,O=2){const F=P&&P.length,N=F?P[0]*O:D.length;let z=my(D,0,N,O,!0);const G=[];if(!z||z.next===z.prev)return G;let W,Q,q,K,ne,be,ve;if(F&&(z=function(me,Pe,tt,Oe){const pt=[];let ke,Mt,Ot,tn,An;for(ke=0,Mt=Pe.length;ke<Mt;ke++)Ot=Pe[ke]*Oe,tn=ke<Mt-1?Pe[ke+1]*Oe:me.length,An=my(me,Ot,tn,Oe,!1),An===An.next&&(An.steiner=!0),pt.push(iE(An));for(pt.sort(yg),ke=0;ke<pt.length;ke++)tt=g_(pt[ke],tt);return tt}(D,P,z,O)),D.length>80*O){W=q=D[0],Q=K=D[1];for(let me=O;me<N;me+=O)ne=D[me],be=D[me+1],ne<W&&(W=ne),be<Q&&(Q=be),ne>q&&(q=ne),be>K&&(K=be);ve=Math.max(q-W,K-Q),ve=ve!==0?32767/ve:0}return vg(z,G,O,W,Q,ve,0),G}(h,f);for(let D=0;D<E.length;D+=3)v.push(E.slice(D,D+3));return v}}function Vr(A){const r=A.length;r>2&&A[r-1].equals(A[0])&&A.pop()}function iw(A,r){for(let l=0;l<r.length;l++)A.push(r[l].x),A.push(r[l].y)}class Ns extends Y{constructor(r=new kh([new Ht(.5,.5),new Ht(-.5,.5),new Ht(-.5,-.5),new Ht(.5,-.5)]),l={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:l},r=Array.isArray(r)?r:[r];const h=this,f=[],v=[];for(let E=0,D=r.length;E<D;E++)b(r[E]);function b(E){const D=[],P=l.curveSegments!==void 0?l.curveSegments:12,O=l.steps!==void 0?l.steps:1,F=l.depth!==void 0?l.depth:1;let N=l.bevelEnabled===void 0||l.bevelEnabled,z=l.bevelThickness!==void 0?l.bevelThickness:.2,G=l.bevelSize!==void 0?l.bevelSize:z-.1,W=l.bevelOffset!==void 0?l.bevelOffset:0,Q=l.bevelSegments!==void 0?l.bevelSegments:3;const q=l.extrudePath,K=l.UVGenerator!==void 0?l.UVGenerator:lr;let ne,be,ve,me,Pe,tt=!1;q&&(ne=q.getSpacedPoints(O),tt=!0,N=!1,be=q.computeFrenetFrames(O,!1),ve=new fe,me=new fe,Pe=new fe),N||(Q=0,z=0,G=0,W=0);const Oe=E.extractPoints(P);let pt=Oe.shape;const ke=Oe.holes;if(!_a.isClockWise(pt)){pt=pt.reverse();for(let Ve=0,Re=ke.length;Ve<Re;Ve++){const it=ke[Ve];_a.isClockWise(it)&&(ke[Ve]=it.reverse())}}const Mt=_a.triangulateShape(pt,ke),Ot=pt;for(let Ve=0,Re=ke.length;Ve<Re;Ve++){const it=ke[Ve];pt=pt.concat(it)}function tn(Ve,Re,it){return Re||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ve.clone().addScaledVector(Re,it)}const An=pt.length,nn=Mt.length;function Xt(Ve,Re,it){let de,Ge,ze;const Ut=Ve.x-Re.x,Lt=Ve.y-Re.y,qt=it.x-Ve.x,vn=it.y-Ve.y,Tn=Ut*Ut+Lt*Lt,ei=Ut*vn-Lt*qt;if(Math.abs(ei)>Number.EPSILON){const Cn=Math.sqrt(Tn),mi=Math.sqrt(qt*qt+vn*vn),li=Re.x-Lt/Cn,Qn=Re.y+Ut/Cn,cr=((it.x-vn/mi-li)*vn-(it.y+qt/mi-Qn)*qt)/(Ut*vn-Lt*qt);de=li+Ut*cr-Ve.x,Ge=Qn+Lt*cr-Ve.y;const Po=de*de+Ge*Ge;if(Po<=2)return new Ht(de,Ge);ze=Math.sqrt(Po/2)}else{let Cn=!1;Ut>Number.EPSILON?qt>Number.EPSILON&&(Cn=!0):Ut<-Number.EPSILON?qt<-Number.EPSILON&&(Cn=!0):Math.sign(Lt)===Math.sign(vn)&&(Cn=!0),Cn?(de=-Lt,Ge=Ut,ze=Math.sqrt(Tn)):(de=Ut,Ge=Lt,ze=Math.sqrt(Tn/2))}return new Ht(de/ze,Ge/ze)}const dn=[];for(let Ve=0,Re=Ot.length,it=Re-1,de=Ve+1;Ve<Re;Ve++,it++,de++)it===Re&&(it=0),de===Re&&(de=0),dn[Ve]=Xt(Ot[Ve],Ot[it],Ot[de]);const gn=[];let xt,Wt=dn.concat();for(let Ve=0,Re=ke.length;Ve<Re;Ve++){const it=ke[Ve];xt=[];for(let de=0,Ge=it.length,ze=Ge-1,Ut=de+1;de<Ge;de++,ze++,Ut++)ze===Ge&&(ze=0),Ut===Ge&&(Ut=0),xt[de]=Xt(it[de],it[ze],it[Ut]);gn.push(xt),Wt=Wt.concat(xt)}for(let Ve=0;Ve<Q;Ve++){const Re=Ve/Q,it=z*Math.cos(Re*Math.PI/2),de=G*Math.sin(Re*Math.PI/2)+W;for(let Ge=0,ze=Ot.length;Ge<ze;Ge++){const Ut=tn(Ot[Ge],dn[Ge],de);_n(Ut.x,Ut.y,-it)}for(let Ge=0,ze=ke.length;Ge<ze;Ge++){const Ut=ke[Ge];xt=gn[Ge];for(let Lt=0,qt=Ut.length;Lt<qt;Lt++){const vn=tn(Ut[Lt],xt[Lt],de);_n(vn.x,vn.y,-it)}}}const un=G+W;for(let Ve=0;Ve<An;Ve++){const Re=N?tn(pt[Ve],Wt[Ve],un):pt[Ve];tt?(me.copy(be.normals[0]).multiplyScalar(Re.x),ve.copy(be.binormals[0]).multiplyScalar(Re.y),Pe.copy(ne[0]).add(me).add(ve),_n(Pe.x,Pe.y,Pe.z)):_n(Re.x,Re.y,0)}for(let Ve=1;Ve<=O;Ve++)for(let Re=0;Re<An;Re++){const it=N?tn(pt[Re],Wt[Re],un):pt[Re];tt?(me.copy(be.normals[Ve]).multiplyScalar(it.x),ve.copy(be.binormals[Ve]).multiplyScalar(it.y),Pe.copy(ne[Ve]).add(me).add(ve),_n(Pe.x,Pe.y,Pe.z)):_n(it.x,it.y,F/O*Ve)}for(let Ve=Q-1;Ve>=0;Ve--){const Re=Ve/Q,it=z*Math.cos(Re*Math.PI/2),de=G*Math.sin(Re*Math.PI/2)+W;for(let Ge=0,ze=Ot.length;Ge<ze;Ge++){const Ut=tn(Ot[Ge],dn[Ge],de);_n(Ut.x,Ut.y,F+it)}for(let Ge=0,ze=ke.length;Ge<ze;Ge++){const Ut=ke[Ge];xt=gn[Ge];for(let Lt=0,qt=Ut.length;Lt<qt;Lt++){const vn=tn(Ut[Lt],xt[Lt],de);tt?_n(vn.x,vn.y+ne[O-1].y,ne[O-1].x+it):_n(vn.x,vn.y,F+it)}}}function Zt(Ve,Re){let it=Ve.length;for(;--it>=0;){const de=it;let Ge=it-1;Ge<0&&(Ge=Ve.length-1);for(let ze=0,Ut=O+2*Q;ze<Ut;ze++){const Lt=An*ze,qt=An*(ze+1);De(Re+de+Lt,Re+Ge+Lt,Re+Ge+qt,Re+de+qt)}}}function _n(Ve,Re,it){D.push(Ve),D.push(Re),D.push(it)}function ai(Ve,Re,it){we(Ve),we(Re),we(it);const de=f.length/3,Ge=K.generateTopUV(h,f,de-3,de-2,de-1);ot(Ge[0]),ot(Ge[1]),ot(Ge[2])}function De(Ve,Re,it,de){we(Ve),we(Re),we(de),we(Re),we(it),we(de);const Ge=f.length/3,ze=K.generateSideWallUV(h,f,Ge-6,Ge-3,Ge-2,Ge-1);ot(ze[0]),ot(ze[1]),ot(ze[3]),ot(ze[1]),ot(ze[2]),ot(ze[3])}function we(Ve){f.push(D[3*Ve+0]),f.push(D[3*Ve+1]),f.push(D[3*Ve+2])}function ot(Ve){v.push(Ve.x),v.push(Ve.y)}(function(){const Ve=f.length/3;if(N){let Re=0,it=An*Re;for(let de=0;de<nn;de++){const Ge=Mt[de];ai(Ge[2]+it,Ge[1]+it,Ge[0]+it)}Re=O+2*Q,it=An*Re;for(let de=0;de<nn;de++){const Ge=Mt[de];ai(Ge[0]+it,Ge[1]+it,Ge[2]+it)}}else{for(let Re=0;Re<nn;Re++){const it=Mt[Re];ai(it[2],it[1],it[0])}for(let Re=0;Re<nn;Re++){const it=Mt[Re];ai(it[0]+An*O,it[1]+An*O,it[2]+An*O)}}h.addGroup(Ve,f.length/3-Ve,0)})(),function(){const Ve=f.length/3;let Re=0;Zt(Ot,Re),Re+=Ot.length;for(let it=0,de=ke.length;it<de;it++){const Ge=ke[it];Zt(Ge,Re),Re+=Ge.length}h.addGroup(Ve,f.length/3-Ve,1)}()}this.setAttribute("position",new Pn(f,3)),this.setAttribute("uv",new Pn(v,2)),this.computeVertexNormals()}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return function(l,h,f){if(f.shapes=[],Array.isArray(l))for(let v=0,b=l.length;v<b;v++){const E=l[v];f.shapes.push(E.uuid)}else f.shapes.push(l.uuid);return f.options=Object.assign({},h),h.extrudePath!==void 0&&(f.options.extrudePath=h.extrudePath.toJSON()),f}(this.parameters.shapes,this.parameters.options,r)}static fromJSON(r,l){const h=[];for(let v=0,b=r.shapes.length;v<b;v++){const E=l[r.shapes[v]];h.push(E)}const f=r.options.extrudePath;return f!==void 0&&(r.options.extrudePath=new py[f.type]().fromJSON(f)),new Ns(h,r.options)}}const lr={generateTopUV:function(A,r,l,h,f){const v=r[3*l],b=r[3*l+1],E=r[3*h],D=r[3*h+1],P=r[3*f],O=r[3*f+1];return[new Ht(v,b),new Ht(E,D),new Ht(P,O)]},generateSideWallUV:function(A,r,l,h,f,v){const b=r[3*l],E=r[3*l+1],D=r[3*l+2],P=r[3*h],O=r[3*h+1],F=r[3*h+2],N=r[3*f],z=r[3*f+1],G=r[3*f+2],W=r[3*v],Q=r[3*v+1],q=r[3*v+2];return Math.abs(E-O)<Math.abs(b-P)?[new Ht(b,1-D),new Ht(P,1-F),new Ht(N,1-G),new Ht(W,1-q)]:[new Ht(E,1-D),new Ht(O,1-F),new Ht(z,1-G),new Ht(Q,1-q)]}};class Ru extends Pu{constructor(r=1,l=0){const h=(1+Math.sqrt(5))/2;super([-1,h,0,1,h,0,-1,-h,0,1,-h,0,0,-1,h,0,1,h,0,-1,-h,0,1,-h,h,0,-1,h,0,1,-h,0,-1,-h,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,l),this.type="IcosahedronGeometry",this.parameters={radius:r,detail:l}}static fromJSON(r){return new Ru(r.radius,r.detail)}}class Xc extends Pu{constructor(r=1,l=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],r,l),this.type="OctahedronGeometry",this.parameters={radius:r,detail:l}}static fromJSON(r){return new Xc(r.radius,r.detail)}}class xg extends Y{constructor(r=.5,l=1,h=32,f=1,v=0,b=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:r,outerRadius:l,thetaSegments:h,phiSegments:f,thetaStart:v,thetaLength:b},h=Math.max(3,h);const E=[],D=[],P=[],O=[];let F=r;const N=(l-r)/(f=Math.max(1,f)),z=new fe,G=new Ht;for(let W=0;W<=f;W++){for(let Q=0;Q<=h;Q++){const q=v+Q/h*b;z.x=F*Math.cos(q),z.y=F*Math.sin(q),D.push(z.x,z.y,z.z),P.push(0,0,1),G.x=(z.x/l+1)/2,G.y=(z.y/l+1)/2,O.push(G.x,G.y)}F+=N}for(let W=0;W<f;W++){const Q=W*(h+1);for(let q=0;q<h;q++){const K=q+Q,ne=K,be=K+h+1,ve=K+h+2,me=K+1;E.push(ne,be,me),E.push(be,ve,me)}}this.setIndex(E),this.setAttribute("position",new Pn(D,3)),this.setAttribute("normal",new Pn(P,3)),this.setAttribute("uv",new Pn(O,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new xg(r.innerRadius,r.outerRadius,r.thetaSegments,r.phiSegments,r.thetaStart,r.thetaLength)}}class Ff extends Y{constructor(r=new kh([new Ht(0,.5),new Ht(-.5,-.5),new Ht(.5,-.5)]),l=12){super(),this.type="ShapeGeometry",this.parameters={shapes:r,curveSegments:l};const h=[],f=[],v=[],b=[];let E=0,D=0;if(Array.isArray(r)===!1)P(r);else for(let O=0;O<r.length;O++)P(r[O]),this.addGroup(E,D,O),E+=D,D=0;function P(O){const F=f.length/3,N=O.extractPoints(l);let z=N.shape;const G=N.holes;_a.isClockWise(z)===!1&&(z=z.reverse());for(let Q=0,q=G.length;Q<q;Q++){const K=G[Q];_a.isClockWise(K)===!0&&(G[Q]=K.reverse())}const W=_a.triangulateShape(z,G);for(let Q=0,q=G.length;Q<q;Q++){const K=G[Q];z=z.concat(K)}for(let Q=0,q=z.length;Q<q;Q++){const K=z[Q];f.push(K.x,K.y,0),v.push(0,0,1),b.push(K.x,K.y)}for(let Q=0,q=W.length;Q<q;Q++){const K=W[Q],ne=K[0]+F,be=K[1]+F,ve=K[2]+F;h.push(ne,be,ve),D+=3}}this.setIndex(h),this.setAttribute("position",new Pn(f,3)),this.setAttribute("normal",new Pn(v,3)),this.setAttribute("uv",new Pn(b,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return function(l,h){if(h.shapes=[],Array.isArray(l))for(let f=0,v=l.length;f<v;f++){const b=l[f];h.shapes.push(b.uuid)}else h.shapes.push(l.uuid);return h}(this.parameters.shapes,r)}static fromJSON(r,l){const h=[];for(let f=0,v=r.shapes.length;f<v;f++){const b=l[r.shapes[f]];h.push(b)}return new Ff(h,r.curveSegments)}}class jf extends Y{constructor(r=1,l=32,h=16,f=0,v=2*Math.PI,b=0,E=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:l,heightSegments:h,phiStart:f,phiLength:v,thetaStart:b,thetaLength:E},l=Math.max(3,Math.floor(l)),h=Math.max(2,Math.floor(h));const D=Math.min(b+E,Math.PI);let P=0;const O=[],F=new fe,N=new fe,z=[],G=[],W=[],Q=[];for(let q=0;q<=h;q++){const K=[],ne=q/h;let be=0;q===0&&b===0?be=.5/l:q===h&&D===Math.PI&&(be=-.5/l);for(let ve=0;ve<=l;ve++){const me=ve/l;F.x=-r*Math.cos(f+me*v)*Math.sin(b+ne*E),F.y=r*Math.cos(b+ne*E),F.z=r*Math.sin(f+me*v)*Math.sin(b+ne*E),G.push(F.x,F.y,F.z),N.copy(F).normalize(),W.push(N.x,N.y,N.z),Q.push(me+be,1-ne),K.push(P++)}O.push(K)}for(let q=0;q<h;q++)for(let K=0;K<l;K++){const ne=O[q][K+1],be=O[q][K],ve=O[q+1][K],me=O[q+1][K+1];(q!==0||b>0)&&z.push(ne,be,me),(q!==h-1||D<Math.PI)&&z.push(be,ve,me)}this.setIndex(z),this.setAttribute("position",new Pn(G,3)),this.setAttribute("normal",new Pn(W,3)),this.setAttribute("uv",new Pn(Q,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new jf(r.radius,r.widthSegments,r.heightSegments,r.phiStart,r.phiLength,r.thetaStart,r.thetaLength)}}class Du extends Pu{constructor(r=1,l=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],r,l),this.type="TetrahedronGeometry",this.parameters={radius:r,detail:l}}static fromJSON(r){return new Du(r.radius,r.detail)}}class Fh extends Y{constructor(r=1,l=.4,h=12,f=48,v=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:l,radialSegments:h,tubularSegments:f,arc:v},h=Math.floor(h),f=Math.floor(f);const b=[],E=[],D=[],P=[],O=new fe,F=new fe,N=new fe;for(let z=0;z<=h;z++)for(let G=0;G<=f;G++){const W=G/f*v,Q=z/h*Math.PI*2;F.x=(r+l*Math.cos(Q))*Math.cos(W),F.y=(r+l*Math.cos(Q))*Math.sin(W),F.z=l*Math.sin(Q),E.push(F.x,F.y,F.z),O.x=r*Math.cos(W),O.y=r*Math.sin(W),N.subVectors(F,O).normalize(),D.push(N.x,N.y,N.z),P.push(G/f),P.push(z/h)}for(let z=1;z<=h;z++)for(let G=1;G<=f;G++){const W=(f+1)*z+G-1,Q=(f+1)*(z-1)+G-1,q=(f+1)*(z-1)+G,K=(f+1)*z+G;b.push(W,Q,K),b.push(Q,q,K)}this.setIndex(b),this.setAttribute("position",new Pn(E,3)),this.setAttribute("normal",new Pn(D,3)),this.setAttribute("uv",new Pn(P,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Fh(r.radius,r.tube,r.radialSegments,r.tubularSegments,r.arc)}}class Ac extends Y{constructor(r=1,l=.4,h=64,f=8,v=2,b=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:r,tube:l,tubularSegments:h,radialSegments:f,p:v,q:b},h=Math.floor(h),f=Math.floor(f);const E=[],D=[],P=[],O=[],F=new fe,N=new fe,z=new fe,G=new fe,W=new fe,Q=new fe,q=new fe;for(let ne=0;ne<=h;++ne){const be=ne/h*v*Math.PI*2;K(be,v,b,r,z),K(be+.01,v,b,r,G),Q.subVectors(G,z),q.addVectors(G,z),W.crossVectors(Q,q),q.crossVectors(W,Q),W.normalize(),q.normalize();for(let ve=0;ve<=f;++ve){const me=ve/f*Math.PI*2,Pe=-l*Math.cos(me),tt=l*Math.sin(me);F.x=z.x+(Pe*q.x+tt*W.x),F.y=z.y+(Pe*q.y+tt*W.y),F.z=z.z+(Pe*q.z+tt*W.z),D.push(F.x,F.y,F.z),N.subVectors(F,z).normalize(),P.push(N.x,N.y,N.z),O.push(ne/h),O.push(ve/f)}}for(let ne=1;ne<=h;ne++)for(let be=1;be<=f;be++){const ve=(f+1)*(ne-1)+(be-1),me=(f+1)*ne+(be-1),Pe=(f+1)*ne+be,tt=(f+1)*(ne-1)+be;E.push(ve,me,tt),E.push(me,Pe,tt)}function K(ne,be,ve,me,Pe){const tt=Math.cos(ne),Oe=Math.sin(ne),pt=ve/be*ne,ke=Math.cos(pt);Pe.x=me*(2+ke)*.5*tt,Pe.y=me*(2+ke)*Oe*.5,Pe.z=me*Math.sin(pt)*.5}this.setIndex(E),this.setAttribute("position",new Pn(D,3)),this.setAttribute("normal",new Pn(P,3)),this.setAttribute("uv",new Pn(O,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Ac(r.radius,r.tube,r.tubularSegments,r.radialSegments,r.p,r.q)}}class Bu extends Y{constructor(r=new d_(new fe(-1,-1,0),new fe(-1,1,0),new fe(1,1,0)),l=64,h=1,f=8,v=!1){super(),this.type="TubeGeometry",this.parameters={path:r,tubularSegments:l,radius:h,radialSegments:f,closed:v};const b=r.computeFrenetFrames(l,v);this.tangents=b.tangents,this.normals=b.normals,this.binormals=b.binormals;const E=new fe,D=new fe,P=new Ht;let O=new fe;const F=[],N=[],z=[],G=[];function W(Q){O=r.getPointAt(Q/l,O);const q=b.normals[Q],K=b.binormals[Q];for(let ne=0;ne<=f;ne++){const be=ne/f*Math.PI*2,ve=Math.sin(be),me=-Math.cos(be);D.x=me*q.x+ve*K.x,D.y=me*q.y+ve*K.y,D.z=me*q.z+ve*K.z,D.normalize(),N.push(D.x,D.y,D.z),E.x=O.x+h*D.x,E.y=O.y+h*D.y,E.z=O.z+h*D.z,F.push(E.x,E.y,E.z)}}(function(){for(let Q=0;Q<l;Q++)W(Q);W(v===!1?l:0),function(){for(let Q=0;Q<=l;Q++)for(let q=0;q<=f;q++)P.x=Q/l,P.y=q/f,z.push(P.x,P.y)}(),function(){for(let Q=1;Q<=l;Q++)for(let q=1;q<=f;q++){const K=(f+1)*(Q-1)+(q-1),ne=(f+1)*Q+(q-1),be=(f+1)*Q+q,ve=(f+1)*(Q-1)+q;G.push(K,ne,ve),G.push(ne,be,ve)}}()})(),this.setIndex(G),this.setAttribute("position",new Pn(F,3)),this.setAttribute("normal",new Pn(N,3)),this.setAttribute("uv",new Pn(z,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return r.path=this.parameters.path.toJSON(),r}static fromJSON(r){return new Bu(new py[r.path.type]().fromJSON(r.path),r.tubularSegments,r.radius,r.radialSegments,r.closed)}}class Ou extends Y{constructor(r=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:r},r!==null){const l=[],h=new Set,f=new fe,v=new fe;if(r.index!==null){const b=r.attributes.position,E=r.index;let D=r.groups;D.length===0&&(D=[{start:0,count:E.count,materialIndex:0}]);for(let P=0,O=D.length;P<O;++P){const F=D[P],N=F.start;for(let z=N,G=N+F.count;z<G;z+=3)for(let W=0;W<3;W++){const Q=E.getX(z+W),q=E.getX(z+(W+1)%3);f.fromBufferAttribute(b,Q),v.fromBufferAttribute(b,q),ya(f,v,h)===!0&&(l.push(f.x,f.y,f.z),l.push(v.x,v.y,v.z))}}}else{const b=r.attributes.position;for(let E=0,D=b.count/3;E<D;E++)for(let P=0;P<3;P++){const O=3*E+P,F=3*E+(P+1)%3;f.fromBufferAttribute(b,O),v.fromBufferAttribute(b,F),ya(f,v,h)===!0&&(l.push(f.x,f.y,f.z),l.push(v.x,v.y,v.z))}}this.setAttribute("position",new Pn(l,3))}}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}}function ya(A,r,l){const h=`${A.x},${A.y},${A.z}-${r.x},${r.y},${r.z}`,f=`${r.x},${r.y},${r.z}-${A.x},${A.y},${A.z}`;return l.has(h)!==!0&&l.has(f)!==!0&&(l.add(h),l.add(f),!0)}var Ay=Object.freeze({__proto__:null,BoxGeometry:wu,CapsuleGeometry:mg,CircleGeometry:up,ConeGeometry:Bf,CylinderGeometry:Lh,DodecahedronGeometry:Of,EdgesGeometry:kf,ExtrudeGeometry:Ns,IcosahedronGeometry:Ru,LatheGeometry:Oh,OctahedronGeometry:Xc,PlaneGeometry:qd,PolyhedronGeometry:Pu,RingGeometry:xg,ShapeGeometry:Ff,SphereGeometry:jf,TetrahedronGeometry:Du,TorusGeometry:Fh,TorusKnotGeometry:Ac,TubeGeometry:Bu,WireframeGeometry:Ou});class Eg extends ks{constructor(r){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new xn(0),this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.fog=r.fog,this}}class rw extends sl{constructor(r){super(r),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hp extends ks{constructor(r){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new xn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=No,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.defines={STANDARD:""},this.color.copy(r.color),this.roughness=r.roughness,this.metalness=r.metalness,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.roughnessMap=r.roughnessMap,this.metalnessMap=r.metalnessMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapIntensity=r.envMapIntensity,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class Lu extends hp{constructor(r){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ht(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return $i(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(l){this.ior=(1+.4*l)/(1-.4*l)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new xn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new xn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new xn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(r)}get sheen(){return this._sheen}set sheen(r){this._sheen>0!=r>0&&this.version++,this._sheen=r}get clearcoat(){return this._clearcoat}set clearcoat(r){this._clearcoat>0!=r>0&&this.version++,this._clearcoat=r}get iridescence(){return this._iridescence}set iridescence(r){this._iridescence>0!=r>0&&this.version++,this._iridescence=r}get transmission(){return this._transmission}set transmission(r){this._transmission>0!=r>0&&this.version++,this._transmission=r}copy(r){return super.copy(r),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=r.clearcoat,this.clearcoatMap=r.clearcoatMap,this.clearcoatRoughness=r.clearcoatRoughness,this.clearcoatRoughnessMap=r.clearcoatRoughnessMap,this.clearcoatNormalMap=r.clearcoatNormalMap,this.clearcoatNormalScale.copy(r.clearcoatNormalScale),this.ior=r.ior,this.iridescence=r.iridescence,this.iridescenceMap=r.iridescenceMap,this.iridescenceIOR=r.iridescenceIOR,this.iridescenceThicknessRange=[...r.iridescenceThicknessRange],this.iridescenceThicknessMap=r.iridescenceThicknessMap,this.sheen=r.sheen,this.sheenColor.copy(r.sheenColor),this.sheenColorMap=r.sheenColorMap,this.sheenRoughness=r.sheenRoughness,this.sheenRoughnessMap=r.sheenRoughnessMap,this.transmission=r.transmission,this.transmissionMap=r.transmissionMap,this.thickness=r.thickness,this.thicknessMap=r.thicknessMap,this.attenuationDistance=r.attenuationDistance,this.attenuationColor.copy(r.attenuationColor),this.specularIntensity=r.specularIntensity,this.specularIntensityMap=r.specularIntensityMap,this.specularColor.copy(r.specularColor),this.specularColorMap=r.specularColorMap,this}}class jh extends ks{constructor(r){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new xn(16777215),this.specular=new xn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=No,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=In,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class Yc extends ks{constructor(r){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new xn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=No,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.gradientMap=r.gradientMap,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}}class y_ extends ks{constructor(r){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=No,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.flatShading=r.flatShading,this}}class Ys extends ks{constructor(r){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=No,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=In,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class A_ extends ks{constructor(r){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new xn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=No,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.defines={MATCAP:""},this.color.copy(r.color),this.matcap=r.matcap,this.map=r.map,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.flatShading=r.flatShading,this.fog=r.fog,this}}class by extends Xs{constructor(r){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(r)}copy(r){return super.copy(r),this.scale=r.scale,this.dashSize=r.dashSize,this.gapSize=r.gapSize,this}}function Aa(A,r,l){return Ho(A)?new A.constructor(A.subarray(r,l!==void 0?l:A.length)):A.slice(r,l)}function Qa(A,r,l){return!A||!l&&A.constructor===r?A:typeof r.BYTES_PER_ELEMENT=="number"?new r(A):Array.prototype.slice.call(A)}function Ho(A){return ArrayBuffer.isView(A)&&!(A instanceof DataView)}function wy(A){const r=A.length,l=new Array(r);for(let h=0;h!==r;++h)l[h]=h;return l.sort(function(h,f){return A[h]-A[f]}),l}function ba(A,r,l){const h=A.length,f=new A.constructor(h);for(let v=0,b=0;b!==h;++v){const E=l[v]*r;for(let D=0;D!==r;++D)f[b++]=A[E+D]}return f}function Sg(A,r,l,h){let f=1,v=A[0];for(;v!==void 0&&v[h]===void 0;)v=A[f++];if(v===void 0)return;let b=v[h];if(b!==void 0)if(Array.isArray(b))do b=v[h],b!==void 0&&(r.push(v.time),l.push.apply(l,b)),v=A[f++];while(v!==void 0);else if(b.toArray!==void 0)do b=v[h],b!==void 0&&(r.push(v.time),b.toArray(l,l.length)),v=A[f++];while(v!==void 0);else do b=v[h],b!==void 0&&(r.push(v.time),l.push(b)),v=A[f++];while(v!==void 0)}const rE={arraySlice:Aa,convertArray:Qa,isTypedArray:Ho,getKeyframeOrder:wy,sortedArray:ba,flattenJSON:Sg,subclip:function(A,r,l,h,f=30){const v=A.clone();v.name=r;const b=[];for(let D=0;D<v.tracks.length;++D){const P=v.tracks[D],O=P.getValueSize(),F=[],N=[];for(let z=0;z<P.times.length;++z){const G=P.times[z]*f;if(!(G<l||G>=h)){F.push(P.times[z]);for(let W=0;W<O;++W)N.push(P.values[z*O+W])}}F.length!==0&&(P.times=Qa(F,P.times.constructor),P.values=Qa(N,P.values.constructor),b.push(P))}v.tracks=b;let E=1/0;for(let D=0;D<v.tracks.length;++D)E>v.tracks[D].times[0]&&(E=v.tracks[D].times[0]);for(let D=0;D<v.tracks.length;++D)v.tracks[D].shift(-1*E);return v.resetDuration(),v},makeClipAdditive:function(A,r=0,l=A,h=30){h<=0&&(h=30);const f=l.tracks.length,v=r/h;for(let b=0;b<f;++b){const E=l.tracks[b],D=E.ValueTypeName;if(D==="bool"||D==="string")continue;const P=A.tracks.find(function(q){return q.name===E.name&&q.ValueTypeName===D});if(P===void 0)continue;let O=0;const F=E.getValueSize();E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(O=F/3);let N=0;const z=P.getValueSize();P.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(N=z/3);const G=E.times.length-1;let W;if(v<=E.times[0]){const q=O,K=F-O;W=Aa(E.values,q,K)}else if(v>=E.times[G]){const q=G*F+O,K=q+F-O;W=Aa(E.values,q,K)}else{const q=E.createInterpolant(),K=O,ne=F-O;q.evaluate(v),W=Aa(q.resultBuffer,K,ne)}D==="quaternion"&&new Ao().fromArray(W).normalize().conjugate().toArray(W);const Q=P.times.length;for(let q=0;q<Q;++q){const K=q*z+N;if(D==="quaternion")Ao.multiplyQuaternionsFlat(P.values,K,W,0,P.values,K);else{const ne=z-2*N;for(let be=0;be<ne;++be)P.values[K+be]-=W[be]}}}return A.blendMode=Md,A}};class Cg{constructor(r,l,h,f){this.parameterPositions=r,this._cachedIndex=0,this.resultBuffer=f!==void 0?f:new l.constructor(h),this.sampleValues=l,this.valueSize=h,this.settings=null,this.DefaultSettings_={}}evaluate(r){const l=this.parameterPositions;let h=this._cachedIndex,f=l[h],v=l[h-1];e:{t:{let b;n:{i:if(!(r<f)){for(let E=h+2;;){if(f===void 0){if(r<v)break i;return h=l.length,this._cachedIndex=h,this.copySampleValue_(h-1)}if(h===E)break;if(v=f,f=l[++h],r<f)break t}b=l.length;break n}if(r>=v)break e;{const E=l[1];r<E&&(h=2,v=E);for(let D=h-2;;){if(v===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(h===D)break;if(f=v,v=l[--h-1],r>=v)break t}b=h,h=0}}for(;h<b;){const E=h+b>>>1;r<l[E]?b=E:h=E+1}if(f=l[h],v=l[h-1],v===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(f===void 0)return h=l.length,this._cachedIndex=h,this.copySampleValue_(h-1)}this._cachedIndex=h,this.intervalChanged_(h,v,f)}return this.interpolate_(h,v,r,f)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(r){const l=this.resultBuffer,h=this.sampleValues,f=this.valueSize,v=r*f;for(let b=0;b!==f;++b)l[b]=h[v+b];return l}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class xy extends Cg{constructor(r,l,h,f){super(r,l,h,f),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:oc,endingEnd:oc}}intervalChanged_(r,l,h){const f=this.parameterPositions;let v=r-2,b=r+1,E=f[v],D=f[b];if(E===void 0)switch(this.getSettings_().endingStart){case ac:v=r,E=2*l-h;break;case cu:v=f.length-2,E=l+f[v]-f[v+1];break;default:v=r,E=h}if(D===void 0)switch(this.getSettings_().endingEnd){case ac:b=r,D=2*h-l;break;case cu:b=1,D=h+f[1]-f[0];break;default:b=r-1,D=l}const P=.5*(h-l),O=this.valueSize;this._weightPrev=P/(l-E),this._weightNext=P/(D-h),this._offsetPrev=v*O,this._offsetNext=b*O}interpolate_(r,l,h,f){const v=this.resultBuffer,b=this.sampleValues,E=this.valueSize,D=r*E,P=D-E,O=this._offsetPrev,F=this._offsetNext,N=this._weightPrev,z=this._weightNext,G=(h-l)/(f-l),W=G*G,Q=W*G,q=-N*Q+2*N*W-N*G,K=(1+N)*Q+(-1.5-2*N)*W+(-.5+N)*G+1,ne=(-1-z)*Q+(1.5+z)*W+.5*G,be=z*Q-z*W;for(let ve=0;ve!==E;++ve)v[ve]=q*b[O+ve]+K*b[P+ve]+ne*b[D+ve]+be*b[F+ve];return v}}class zh extends Cg{constructor(r,l,h,f){super(r,l,h,f)}interpolate_(r,l,h,f){const v=this.resultBuffer,b=this.sampleValues,E=this.valueSize,D=r*E,P=D-E,O=(h-l)/(f-l),F=1-O;for(let N=0;N!==E;++N)v[N]=b[P+N]*F+b[D+N]*O;return v}}class Mg extends Cg{constructor(r,l,h,f){super(r,l,h,f)}interpolate_(r){return this.copySampleValue_(r-1)}}class Jr{constructor(r,l,h,f){if(r===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(l===void 0||l.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+r);this.name=r,this.times=Qa(l,this.TimeBufferType),this.values=Qa(h,this.ValueBufferType),this.setInterpolation(f||this.DefaultInterpolation)}static toJSON(r){const l=r.constructor;let h;if(l.toJSON!==this.toJSON)h=l.toJSON(r);else{h={name:r.name,times:Qa(r.times,Array),values:Qa(r.values,Array)};const f=r.getInterpolation();f!==r.DefaultInterpolation&&(h.interpolation=f)}return h.type=r.ValueTypeName,h}InterpolantFactoryMethodDiscrete(r){return new Mg(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodLinear(r){return new zh(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodSmooth(r){return new xy(this.times,this.values,this.getValueSize(),r)}setInterpolation(r){let l;switch(r){case El:l=this.InterpolantFactoryMethodDiscrete;break;case Oc:l=this.InterpolantFactoryMethodLinear;break;case Cd:l=this.InterpolantFactoryMethodSmooth}if(l===void 0){const h="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(r===this.DefaultInterpolation)throw new Error(h);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",h),this}return this.createInterpolant=l,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return El;case this.InterpolantFactoryMethodLinear:return Oc;case this.InterpolantFactoryMethodSmooth:return Cd}}getValueSize(){return this.values.length/this.times.length}shift(r){if(r!==0){const l=this.times;for(let h=0,f=l.length;h!==f;++h)l[h]+=r}return this}scale(r){if(r!==1){const l=this.times;for(let h=0,f=l.length;h!==f;++h)l[h]*=r}return this}trim(r,l){const h=this.times,f=h.length;let v=0,b=f-1;for(;v!==f&&h[v]<r;)++v;for(;b!==-1&&h[b]>l;)--b;if(++b,v!==0||b!==f){v>=b&&(b=Math.max(b,1),v=b-1);const E=this.getValueSize();this.times=Aa(h,v,b),this.values=Aa(this.values,v*E,b*E)}return this}validate(){let r=!0;const l=this.getValueSize();l-Math.floor(l)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);const h=this.times,f=this.values,v=h.length;v===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let b=null;for(let E=0;E!==v;E++){const D=h[E];if(typeof D=="number"&&isNaN(D)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,E,D),r=!1;break}if(b!==null&&b>D){console.error("THREE.KeyframeTrack: Out of order keys.",this,E,D,b),r=!1;break}b=D}if(f!==void 0&&Ho(f))for(let E=0,D=f.length;E!==D;++E){const P=f[E];if(isNaN(P)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,E,P),r=!1;break}}return r}optimize(){const r=Aa(this.times),l=Aa(this.values),h=this.getValueSize(),f=this.getInterpolation()===Cd,v=r.length-1;let b=1;for(let E=1;E<v;++E){let D=!1;const P=r[E];if(P!==r[E+1]&&(E!==1||P!==r[0]))if(f)D=!0;else{const O=E*h,F=O-h,N=O+h;for(let z=0;z!==h;++z){const G=l[O+z];if(G!==l[F+z]||G!==l[N+z]){D=!0;break}}}if(D){if(E!==b){r[b]=r[E];const O=E*h,F=b*h;for(let N=0;N!==h;++N)l[F+N]=l[O+N]}++b}}if(v>0){r[b]=r[v];for(let E=v*h,D=b*h,P=0;P!==h;++P)l[D+P]=l[E+P];++b}return b!==r.length?(this.times=Aa(r,0,b),this.values=Aa(l,0,b*h)):(this.times=r,this.values=l),this}clone(){const r=Aa(this.times,0),l=Aa(this.values,0),h=new this.constructor(this.name,r,l);return h.createInterpolant=this.createInterpolant,h}}Jr.prototype.TimeBufferType=Float32Array,Jr.prototype.ValueBufferType=Float32Array,Jr.prototype.DefaultInterpolation=Oc;class dp extends Jr{}dp.prototype.ValueTypeName="bool",dp.prototype.ValueBufferType=Array,dp.prototype.DefaultInterpolation=El,dp.prototype.InterpolantFactoryMethodLinear=void 0,dp.prototype.InterpolantFactoryMethodSmooth=void 0;class Vh extends Jr{}Vh.prototype.ValueTypeName="color";class zf extends Jr{}zf.prototype.ValueTypeName="number";class Ey extends Cg{constructor(r,l,h,f){super(r,l,h,f)}interpolate_(r,l,h,f){const v=this.resultBuffer,b=this.sampleValues,E=this.valueSize,D=(h-l)/(f-l);let P=r*E;for(let O=P+E;P!==O;P+=4)Ao.slerpFlat(v,0,b,P-E,b,P,D);return v}}class ku extends Jr{InterpolantFactoryMethodLinear(r){return new Ey(this.times,this.values,this.getValueSize(),r)}}ku.prototype.ValueTypeName="quaternion",ku.prototype.DefaultInterpolation=Oc,ku.prototype.InterpolantFactoryMethodSmooth=void 0;class Gh extends Jr{}Gh.prototype.ValueTypeName="string",Gh.prototype.ValueBufferType=Array,Gh.prototype.DefaultInterpolation=El,Gh.prototype.InterpolantFactoryMethodLinear=void 0,Gh.prototype.InterpolantFactoryMethodSmooth=void 0;class pp extends Jr{}pp.prototype.ValueTypeName="vector";class bc{constructor(r,l=-1,h,f=Hs){this.name=r,this.tracks=h,this.duration=l,this.blendMode=f,this.uuid=ss(),this.duration<0&&this.resetDuration()}static parse(r){const l=[],h=r.tracks,f=1/(r.fps||1);for(let b=0,E=h.length;b!==E;++b)l.push(Sy(h[b]).scale(f));const v=new this(r.name,r.duration,l,r.blendMode);return v.uuid=r.uuid,v}static toJSON(r){const l=[],h=r.tracks,f={name:r.name,duration:r.duration,tracks:l,uuid:r.uuid,blendMode:r.blendMode};for(let v=0,b=h.length;v!==b;++v)l.push(Jr.toJSON(h[v]));return f}static CreateFromMorphTargetSequence(r,l,h,f){const v=l.length,b=[];for(let E=0;E<v;E++){let D=[],P=[];D.push((E+v-1)%v,E,(E+1)%v),P.push(0,1,0);const O=wy(D);D=ba(D,1,O),P=ba(P,1,O),f||D[0]!==0||(D.push(v),P.push(P[0])),b.push(new zf(".morphTargetInfluences["+l[E].name+"]",D,P).scale(1/h))}return new this(r,-1,b)}static findByName(r,l){let h=r;if(!Array.isArray(r)){const f=r;h=f.geometry&&f.geometry.animations||f.animations}for(let f=0;f<h.length;f++)if(h[f].name===l)return h[f];return null}static CreateClipsFromMorphTargetSequences(r,l,h){const f={},v=/^([\w-]*?)([\d]+)$/;for(let E=0,D=r.length;E<D;E++){const P=r[E],O=P.name.match(v);if(O&&O.length>1){const F=O[1];let N=f[F];N||(f[F]=N=[]),N.push(P)}}const b=[];for(const E in f)b.push(this.CreateFromMorphTargetSequence(E,f[E],l,h));return b}static parseAnimation(r,l){if(!r)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const h=function(O,F,N,z,G){if(N.length!==0){const W=[],Q=[];Sg(N,W,Q,z),W.length!==0&&G.push(new O(F,W,Q))}},f=[],v=r.name||"default",b=r.fps||30,E=r.blendMode;let D=r.length||-1;const P=r.hierarchy||[];for(let O=0;O<P.length;O++){const F=P[O].keys;if(F&&F.length!==0)if(F[0].morphTargets){const N={};let z;for(z=0;z<F.length;z++)if(F[z].morphTargets)for(let G=0;G<F[z].morphTargets.length;G++)N[F[z].morphTargets[G]]=-1;for(const G in N){const W=[],Q=[];for(let q=0;q!==F[z].morphTargets.length;++q){const K=F[z];W.push(K.time),Q.push(K.morphTarget===G?1:0)}f.push(new zf(".morphTargetInfluence["+G+"]",W,Q))}D=N.length*b}else{const N=".bones["+l[O].name+"]";h(pp,N+".position",F,"pos",f),h(ku,N+".quaternion",F,"rot",f),h(pp,N+".scale",F,"scl",f)}}return f.length===0?null:new this(v,D,f,E)}resetDuration(){let r=0;for(let l=0,h=this.tracks.length;l!==h;++l){const f=this.tracks[l];r=Math.max(r,f.times[f.times.length-1])}return this.duration=r,this}trim(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].trim(0,this.duration);return this}validate(){let r=!0;for(let l=0;l<this.tracks.length;l++)r=r&&this.tracks[l].validate();return r}optimize(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].optimize();return this}clone(){const r=[];for(let l=0;l<this.tracks.length;l++)r.push(this.tracks[l].clone());return new this.constructor(this.name,this.duration,r,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Sy(A){if(A.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const r=function(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return zf;case"vector":case"vector2":case"vector3":case"vector4":return pp;case"color":return Vh;case"quaternion":return ku;case"bool":case"boolean":return dp;case"string":return Gh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}(A.type);if(A.times===void 0){const l=[],h=[];Sg(A.keys,l,h,"value"),A.times=l,A.values=h}return r.parse!==void 0?r.parse(A):new r(A.name,A.times,A.values,A.interpolation)}const Nl={enabled:!1,files:{},add:function(A,r){this.enabled!==!1&&(this.files[A]=r)},get:function(A,r){return this.enabled===!1?r?Promise.resolve():void 0:r?Promise.resolve(this.files[A]):this.files[A]},remove:function(A){delete this.files[A]},clear:function(){this.files={}}};class Fl{constructor(r,l,h){const f=this;let v,b=!1,E=0,D=0;const P=[];this.onStart=void 0,this.onLoad=r,this.onProgress=l,this.onError=h,this.itemStart=function(O){D++,b===!1&&f.onStart!==void 0&&f.onStart(O,E,D),b=!0},this.itemEnd=function(O){E++,f.onProgress!==void 0&&f.onProgress(O,E,D),E===D&&(b=!1,f.onLoad!==void 0&&f.onLoad())},this.itemError=function(O){f.onError!==void 0&&f.onError(O)},this.resolveURL=function(O){return v?v(O):O},this.setURLModifier=function(O){return v=O,this},this.addHandler=function(O,F){return P.push(O,F),this},this.removeHandler=function(O){const F=P.indexOf(O);return F!==-1&&P.splice(F,2),this},this.getHandler=function(O){for(let F=0,N=P.length;F<N;F+=2){const z=P[F],G=P[F+1];if(z.global&&(z.lastIndex=0),z.test(O))return G}return null}}}const sw=new Fl;class ul{constructor(r){this.manager=r!==void 0?r:sw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,l){const h=this;return new Promise(function(f,v){h.load(r,f,l,v)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}}const Kc={};class Cy extends Error{constructor(r,l){super(r),this.response=l}}class wc extends ul{constructor(r){super(r),this.responseType="text",this.useCache=!0}load(r,l,h,f){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r),(this.useCache?Nl.get(r,this.responseType,this.mimeType):Promise.resolve(void 0)).then(v=>{if(v!==void 0)return this.manager.itemStart(r),setTimeout(()=>{l&&l(v),this.manager.itemEnd(r)},0),v;if(Kc[r]!==void 0)return void Kc[r].push({onLoad:l,onProgress:h,onError:f});Kc[r]=[],Kc[r].push({onLoad:l,onProgress:h,onError:f});const b=new Request(r,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),E=this.mimeType,D=this.responseType;fetch(b).then(P=>{if(P.status===200||P.status===0){if(P.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||P.body===void 0||P.body.getReader===void 0)return P;const O=Kc[r],F=P.body.getReader(),N=P.headers.get("Content-Length")||P.headers.get("X-File-Size"),z=N?parseInt(N):0,G=z!==0;let W=0;const Q=new ReadableStream({start(q){(function K(){F.read().then(({done:ne,value:be})=>{if(ne)q.close();else{W+=be.byteLength;const ve=new ProgressEvent("progress",{lengthComputable:G,loaded:W,total:z});for(let me=0,Pe=O.length;me<Pe;me++){const tt=O[me];tt.onProgress&&tt.onProgress(ve)}q.enqueue(be),K()}})})()}});return new Response(Q)}throw new Cy(`fetch for "${P.url}" responded with ${P.status}: ${P.statusText}`,P)}).then(P=>{switch(D){case"arraybuffer":return P.arrayBuffer();case"blob":return P.blob();case"document":return P.text().then(O=>new DOMParser().parseFromString(O,E));case"json":return P.json();default:if(E===void 0)return P.text();{const O=/charset="?([^;"\s]*)"?/i.exec(E),F=O&&O[1]?O[1].toLowerCase():void 0,N=new TextDecoder(F);return P.arrayBuffer().then(z=>N.decode(z))}}}).then(P=>{this.useCache&&Nl.add(r,P,this.responseType);const O=Kc[r];delete Kc[r];for(let F=0,N=O.length;F<N;F++){const z=O[F];z.onLoad&&z.onLoad(P)}}).catch(P=>{const O=Kc[r];if(O===void 0)throw this.manager.itemError(r),P;delete Kc[r];for(let F=0,N=O.length;F<N;F++){const z=O[F];z.onError&&z.onError(P)}this.manager.itemError(r)}).finally(()=>{this.useCache&&this.manager.itemEnd(r)}),this.useCache&&this.manager.itemStart(r)})}setResponseType(r){return this.responseType=r,this}setMimeType(r){return this.mimeType=r,this}}class xc extends ul{constructor(r){super(r)}load(r,l,h,f){const v=this,b=new wc(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(r,function(E){try{l(v.parse(JSON.parse(E)))}catch(D){f?f(D):console.error(D),v.manager.itemError(r)}},h,f)}parse(r){const l=[];for(let h=0;h<r.length;h++){const f=bc.parse(r[h]);l.push(f)}return l}}class sE extends ul{constructor(r){super(r)}load(r,l,h,f){const v=this,b=[],E=new ap,D=new wc(this.manager);D.setPath(this.path),D.setResponseType("arraybuffer"),D.setRequestHeader(this.requestHeader),D.setWithCredentials(v.withCredentials);let P=0;function O(F){D.load(r[F],function(N){const z=v.parse(N,!0);b[F]={width:z.width,height:z.height,format:z.format,mipmaps:z.mipmaps},P+=1,P===6&&(z.mipmapCount===1&&(E.minFilter=_r),E.image=b,E.format=z.format,E.needsUpdate=!0,l&&l(E))},h,f)}if(Array.isArray(r))for(let F=0,N=r.length;F<N;++F)O(F);else D.load(r,function(F){const N=v.parse(F,!0);if(N.isCubemap){const z=N.mipmaps.length/N.mipmapCount;for(let G=0;G<z;G++){b[G]={mipmaps:[]};for(let W=0;W<N.mipmapCount;W++)b[G].mipmaps.push(N.mipmaps[G*N.mipmapCount+W]),b[G].format=N.format,b[G].width=N.width,b[G].height=N.height}E.image=b}else E.image.width=N.width,E.image.height=N.height,E.mipmaps=N.mipmaps;N.mipmapCount===1&&(E.minFilter=_r),E.format=N.format,E.needsUpdate=!0,l&&l(E)},h,f);return E}}class Tg extends ul{constructor(r){super(r)}load(r,l,h,f){const v=r;this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const b=this,E=Nl.get(r);if(E!==void 0)return b.manager.itemStart(r),setTimeout(function(){l&&l(E),b.manager.itemEnd(r)},0),E;const D=ka("img");function P(){F(),Nl.add(r,this),l&&l(this),b.manager.itemEnd(r)}function O(N){F(),f&&f(N),b.manager.itemError(r),b.manager.itemEnd(r)}function F(){D.removeEventListener("load",P,!1),D.removeEventListener("error",O,!1)}return D.addEventListener("load",P,!1),D.addEventListener("error",O,!1),r.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(D.crossOrigin=this.crossOrigin),b.manager.itemStart(r),Nl.get(r,"blob").then(N=>{if(N!==void 0&&!N.type.startsWith("text/plain"))return N.type||(r.endsWith(".svg")||r.startsWith("data:image/svg"))&&(N=new Blob([N],{type:"image/svg+xml"})),void(D.src=URL.createObjectURL(N));const z=new wc(this.manager);z.useCache=!1,z.setPath(this.path),z.setCrossOrigin(this.crossOrigin),z.setResponseType("blob"),z.load(v,function(G){G.type||(r.endsWith(".svg")||r.startsWith("data:image/svg"))&&(G=new Blob([G],{type:"image/svg+xml"})),Nl.add(r,G,"blob"),D.src=URL.createObjectURL(G)},h,G=>{F(),f&&f(G)})}),D}}class ow extends ul{constructor(r){super(r)}load(r,l,h,f){const v=new gc,b=new Tg(this.manager);b.setCrossOrigin(this.crossOrigin),b.setPath(this.path);let E=0;function D(P){b.load(r[P],function(O){v.images[P]=O,E++,E===6&&(v.needsUpdate=!0,l&&l(v))},void 0,f)}for(let P=0;P<r.length;++P)D(P);return v}}class jl extends ul{constructor(r){super(r)}load(r,l,h,f){const v=this,b=new Ph,E=new wc(this.manager);return E.setResponseType("arraybuffer"),E.setRequestHeader(this.requestHeader),E.setPath(this.path),E.setWithCredentials(v.withCredentials),E.load(r,function(D){const P=v.parse(D);P&&(P.image!==void 0?b.image=P.image:P.data!==void 0&&(b.image.width=P.width,b.image.height=P.height,b.image.data=P.data,b.image.complete=!0),b.wrapS=P.wrapS!==void 0?P.wrapS:vs,b.wrapT=P.wrapT!==void 0?P.wrapT:vs,b.magFilter=P.magFilter!==void 0?P.magFilter:_r,b.minFilter=P.minFilter!==void 0?P.minFilter:_r,b.anisotropy=P.anisotropy!==void 0?P.anisotropy:1,P.colorSpace!==void 0?b.colorSpace=P.colorSpace:P.encoding!==void 0&&(b.encoding=P.encoding),P.flipY!==void 0&&(b.flipY=P.flipY),P.format!==void 0&&(b.format=P.format),P.type!==void 0&&(b.type=P.type),P.mipmaps!==void 0&&(b.mipmaps=P.mipmaps,b.minFilter=bl),P.mipmapCount===1&&(b.minFilter=_r),P.generateMipmaps!==void 0&&(b.generateMipmaps=P.generateMipmaps),b.needsUpdate=!0,l&&l(b,P))},h,f),b}}class My extends ul{constructor(r){super(r)}load(r,l,h,f){const v=new Or,b=new Tg(this.manager);return b.setCrossOrigin(this.crossOrigin),b.setPath(this.path),b.load(r,function(E){v.image=E,v.needsUpdate=!0,l!==void 0&&l(v)},h,f),v}}class Hh extends zi{constructor(r,l=1){super(),this.isLight=!0,this.type="Light",this.color=new xn(r),this.intensity=l}dispose(){}copy(r,l){return super.copy(r,l),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const l=super.toJSON(r);return l.object.color=this.color.getHex(),l.object.intensity=this.intensity,this.groundColor!==void 0&&(l.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(l.object.distance=this.distance),this.angle!==void 0&&(l.object.angle=this.angle),this.decay!==void 0&&(l.object.decay=this.decay),this.penumbra!==void 0&&(l.object.penumbra=this.penumbra),this.shadow!==void 0&&(l.object.shadow=this.shadow.toJSON()),l}}class aw extends Hh{constructor(r,l,h){super(r,h),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(zi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new xn(l)}copy(r,l){return super.copy(r,l),this.groundColor.copy(r.groundColor),this}}const Ty=new si,lw=new fe,Vf=new fe;class Io{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ht(512,512),this.map=null,this.mapPass=null,this.matrix=new si,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new km,this._frameExtents=new Ht(1,1),this._viewportCount=1,this._viewports=[new ji(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const l=this.camera,h=this.matrix;lw.setFromMatrixPosition(r.matrixWorld),l.position.copy(lw),Vf.setFromMatrixPosition(r.target.matrixWorld),l.lookAt(Vf),l.updateMatrixWorld(),Ty.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ty),h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(Ty)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.normalBias=r.normalBias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}}class cw extends Io{constructor(){super(new so(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(r){const l=this.camera,h=2*La*r.angle*this.focus,f=this.mapSize.width/this.mapSize.height,v=r.distance||l.far;h===l.fov&&f===l.aspect&&v===l.far||(l.fov=h,l.aspect=f,l.far=v,l.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}}class b_ extends Hh{constructor(r,l,h=0,f=Math.PI/3,v=0,b=2){super(r,l),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(zi.DEFAULT_UP),this.updateMatrix(),this.target=new zi,this.distance=h,this.angle=f,this.penumbra=v,this.decay=b,this.map=null,this.shadow=new cw}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r,l){return super.copy(r,l),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}const Jc=new si,fp=new fe,Ig=new fe;class oE extends Io{constructor(){super(new so(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ht(4,2),this._viewportCount=6,this._viewports=[new ji(2,1,1,1),new ji(0,1,1,1),new ji(3,1,1,1),new ji(1,1,1,1),new ji(3,0,1,1),new ji(1,0,1,1)],this._cubeDirections=[new fe(1,0,0),new fe(-1,0,0),new fe(0,0,1),new fe(0,0,-1),new fe(0,1,0),new fe(0,-1,0)],this._cubeUps=[new fe(0,1,0),new fe(0,1,0),new fe(0,1,0),new fe(0,1,0),new fe(0,0,1),new fe(0,0,-1)]}updateMatrices(r,l=0){const h=this.camera,f=this.matrix,v=r.distance||h.far;v!==h.far&&(h.far=v,h.updateProjectionMatrix()),fp.setFromMatrixPosition(r.matrixWorld),h.position.copy(fp),Ig.copy(h.position),Ig.add(this._cubeDirections[l]),h.up.copy(this._cubeUps[l]),h.lookAt(Ig),h.updateMatrixWorld(),f.makeTranslation(-fp.x,-fp.y,-fp.z),Jc.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jc)}}class Iy extends Hh{constructor(r,l,h=0,f=2){super(r,l),this.isPointLight=!0,this.type="PointLight",this.distance=h,this.decay=f,this.shadow=new oE}get power(){return 4*this.intensity*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r,l){return super.copy(r,l),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}}class Py extends Io{constructor(){super(new jm(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class w_ extends Hh{constructor(r,l){super(r,l),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(zi.DEFAULT_UP),this.updateMatrix(),this.target=new zi,this.shadow=new Py}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}class x_ extends Hh{constructor(r,l){super(r,l),this.isAmbientLight=!0,this.type="AmbientLight"}}class Ec extends Hh{constructor(r,l,h=10,f=10){super(r,l),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=h,this.height=f}get power(){return this.intensity*this.width*this.height*Math.PI}set power(r){this.intensity=r/(this.width*this.height*Math.PI)}copy(r){return super.copy(r),this.width=r.width,this.height=r.height,this}toJSON(r){const l=super.toJSON(r);return l.object.width=this.width,l.object.height=this.height,l}}class Ry{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let r=0;r<9;r++)this.coefficients.push(new fe)}set(r){for(let l=0;l<9;l++)this.coefficients[l].copy(r[l]);return this}zero(){for(let r=0;r<9;r++)this.coefficients[r].set(0,0,0);return this}getAt(r,l){const h=r.x,f=r.y,v=r.z,b=this.coefficients;return l.copy(b[0]).multiplyScalar(.282095),l.addScaledVector(b[1],.488603*f),l.addScaledVector(b[2],.488603*v),l.addScaledVector(b[3],.488603*h),l.addScaledVector(b[4],h*f*1.092548),l.addScaledVector(b[5],f*v*1.092548),l.addScaledVector(b[6],.315392*(3*v*v-1)),l.addScaledVector(b[7],h*v*1.092548),l.addScaledVector(b[8],.546274*(h*h-f*f)),l}getIrradianceAt(r,l){const h=r.x,f=r.y,v=r.z,b=this.coefficients;return l.copy(b[0]).multiplyScalar(.886227),l.addScaledVector(b[1],1.023328*f),l.addScaledVector(b[2],1.023328*v),l.addScaledVector(b[3],1.023328*h),l.addScaledVector(b[4],.858086*h*f),l.addScaledVector(b[5],.858086*f*v),l.addScaledVector(b[6],.743125*v*v-.247708),l.addScaledVector(b[7],.858086*h*v),l.addScaledVector(b[8],.429043*(h*h-f*f)),l}add(r){for(let l=0;l<9;l++)this.coefficients[l].add(r.coefficients[l]);return this}addScaledSH(r,l){for(let h=0;h<9;h++)this.coefficients[h].addScaledVector(r.coefficients[h],l);return this}scale(r){for(let l=0;l<9;l++)this.coefficients[l].multiplyScalar(r);return this}lerp(r,l){for(let h=0;h<9;h++)this.coefficients[h].lerp(r.coefficients[h],l);return this}equals(r){for(let l=0;l<9;l++)if(!this.coefficients[l].equals(r.coefficients[l]))return!1;return!0}copy(r){return this.set(r.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(r,l=0){const h=this.coefficients;for(let f=0;f<9;f++)h[f].fromArray(r,l+3*f);return this}toArray(r=[],l=0){const h=this.coefficients;for(let f=0;f<9;f++)h[f].toArray(r,l+3*f);return r}static getBasisAt(r,l){const h=r.x,f=r.y,v=r.z;l[0]=.282095,l[1]=.488603*f,l[2]=.488603*v,l[3]=.488603*h,l[4]=1.092548*h*f,l[5]=1.092548*f*v,l[6]=.315392*(3*v*v-1),l[7]=1.092548*h*v,l[8]=.546274*(h*h-f*f)}}class Gf extends Hh{constructor(r=new Ry,l=1){super(void 0,l),this.isLightProbe=!0,this.sh=r}copy(r){return super.copy(r),this.sh.copy(r.sh),this}fromJSON(r){return this.intensity=r.intensity,this.sh.fromArray(r.sh),this}toJSON(r){const l=super.toJSON(r);return l.object.sh=this.sh.toArray(),l}}class E_ extends ul{constructor(r){super(r),this.textures={}}load(r,l,h,f){const v=this,b=new wc(v.manager);b.setPath(v.path),b.setRequestHeader(v.requestHeader),b.setWithCredentials(v.withCredentials),b.load(r,function(E){try{l(v.parse(JSON.parse(E)))}catch(D){f?f(D):console.error(D),v.manager.itemError(r)}},h,f)}parse(r){const l=this.textures;function h(b){return l[b]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",b),l[b]}const f=r.metadata&&r.metadata.version<=4.5?fr:void 0,v=E_.createMaterialFromType(r.type);if(r.uuid!==void 0&&(v.uuid=r.uuid),r.name!==void 0&&(v.name=r.name),r.color!==void 0&&v.color!==void 0&&v.color.setHex(r.color,f),r.roughness!==void 0&&(v.roughness=r.roughness),r.metalness!==void 0&&(v.metalness=r.metalness),r.sheen!==void 0&&(v.sheen=r.sheen),r.sheenColor!==void 0&&(v.sheenColor=new xn().setHex(r.sheenColor,f)),r.sheenRoughness!==void 0&&(v.sheenRoughness=r.sheenRoughness),r.emissive!==void 0&&v.emissive!==void 0&&v.emissive.setHex(r.emissive,f),r.specular!==void 0&&v.specular!==void 0&&v.specular.setHex(r.specular,f),r.specularIntensity!==void 0&&(v.specularIntensity=r.specularIntensity),r.specularColor!==void 0&&v.specularColor!==void 0&&v.specularColor.setHex(r.specularColor,f),r.shininess!==void 0&&(v.shininess=r.shininess),r.clearcoat!==void 0&&(v.clearcoat=r.clearcoat),r.clearcoatRoughness!==void 0&&(v.clearcoatRoughness=r.clearcoatRoughness),r.iridescence!==void 0&&(v.iridescence=r.iridescence),r.iridescenceIOR!==void 0&&(v.iridescenceIOR=r.iridescenceIOR),r.iridescenceThicknessRange!==void 0&&(v.iridescenceThicknessRange=r.iridescenceThicknessRange),r.transmission!==void 0&&(v.transmission=r.transmission),r.thickness!==void 0&&(v.thickness=r.thickness),r.attenuationDistance!==void 0&&(v.attenuationDistance=r.attenuationDistance),r.attenuationColor!==void 0&&v.attenuationColor!==void 0&&v.attenuationColor.setHex(r.attenuationColor,f),r.fog!==void 0&&(v.fog=r.fog),r.flatShading!==void 0&&(v.flatShading=r.flatShading),r.blending!==void 0&&(v.blending=r.blending),r.combine!==void 0&&(v.combine=r.combine),r.side!==void 0&&(v.side=r.side),r.shadowSide!==void 0&&(v.shadowSide=r.shadowSide),r.opacity!==void 0&&(v.opacity=r.opacity),r.transparent!==void 0&&(v.transparent=r.transparent),r.alphaTest!==void 0&&(v.alphaTest=r.alphaTest),r.depthTest!==void 0&&(v.depthTest=r.depthTest),r.depthWrite!==void 0&&(v.depthWrite=r.depthWrite),r.colorWrite!==void 0&&(v.colorWrite=r.colorWrite),r.stencilWrite!==void 0&&(v.stencilWrite=r.stencilWrite),r.stencilWriteMask!==void 0&&(v.stencilWriteMask=r.stencilWriteMask),r.stencilFunc!==void 0&&(v.stencilFunc=r.stencilFunc),r.stencilRef!==void 0&&(v.stencilRef=r.stencilRef),r.stencilFuncMask!==void 0&&(v.stencilFuncMask=r.stencilFuncMask),r.stencilFail!==void 0&&(v.stencilFail=r.stencilFail),r.stencilZFail!==void 0&&(v.stencilZFail=r.stencilZFail),r.stencilZPass!==void 0&&(v.stencilZPass=r.stencilZPass),r.wireframe!==void 0&&(v.wireframe=r.wireframe),r.wireframeLinewidth!==void 0&&(v.wireframeLinewidth=r.wireframeLinewidth),r.wireframeLinecap!==void 0&&(v.wireframeLinecap=r.wireframeLinecap),r.wireframeLinejoin!==void 0&&(v.wireframeLinejoin=r.wireframeLinejoin),r.rotation!==void 0&&(v.rotation=r.rotation),r.linewidth!==1&&(v.linewidth=r.linewidth),r.dashSize!==void 0&&(v.dashSize=r.dashSize),r.gapSize!==void 0&&(v.gapSize=r.gapSize),r.scale!==void 0&&(v.scale=r.scale),r.polygonOffset!==void 0&&(v.polygonOffset=r.polygonOffset),r.polygonOffsetFactor!==void 0&&(v.polygonOffsetFactor=r.polygonOffsetFactor),r.polygonOffsetUnits!==void 0&&(v.polygonOffsetUnits=r.polygonOffsetUnits),r.dithering!==void 0&&(v.dithering=r.dithering),r.alphaToCoverage!==void 0&&(v.alphaToCoverage=r.alphaToCoverage),r.premultipliedAlpha!==void 0&&(v.premultipliedAlpha=r.premultipliedAlpha),r.forceSinglePass!==void 0&&(v.forceSinglePass=r.forceSinglePass),r.visible!==void 0&&(v.visible=r.visible),r.toneMapped!==void 0&&(v.toneMapped=r.toneMapped),r.userData!==void 0&&(v.userData=r.userData),r.vertexColors!==void 0&&(typeof r.vertexColors=="number"?v.vertexColors=r.vertexColors>0:v.vertexColors=r.vertexColors),r.uniforms!==void 0)for(const b in r.uniforms){const E=r.uniforms[b];switch(v.uniforms[b]={},E.type){case"t":v.uniforms[b].value=h(E.value);break;case"c":v.uniforms[b].value=new xn().setHex(E.value,f);break;case"v2":v.uniforms[b].value=new Ht().fromArray(E.value);break;case"v3":v.uniforms[b].value=new fe().fromArray(E.value);break;case"v4":v.uniforms[b].value=new ji().fromArray(E.value);break;case"m3":v.uniforms[b].value=new bi().fromArray(E.value);break;case"m4":v.uniforms[b].value=new si().fromArray(E.value);break;default:v.uniforms[b].value=E.value}}if(r.defines!==void 0&&(v.defines=r.defines),r.vertexShader!==void 0&&(v.vertexShader=r.vertexShader),r.fragmentShader!==void 0&&(v.fragmentShader=r.fragmentShader),r.glslVersion!==void 0&&(v.glslVersion=r.glslVersion),r.extensions!==void 0)for(const b in r.extensions)v.extensions[b]=r.extensions[b];if(r.lights!==void 0&&(v.lights=r.lights),r.clipping!==void 0&&(v.clipping=r.clipping),r.size!==void 0&&(v.size=r.size),r.sizeAttenuation!==void 0&&(v.sizeAttenuation=r.sizeAttenuation),r.map!==void 0&&(v.map=h(r.map)),r.matcap!==void 0&&(v.matcap=h(r.matcap)),r.alphaMap!==void 0&&(v.alphaMap=h(r.alphaMap)),r.bumpMap!==void 0&&(v.bumpMap=h(r.bumpMap)),r.bumpScale!==void 0&&(v.bumpScale=r.bumpScale),r.normalMap!==void 0&&(v.normalMap=h(r.normalMap)),r.normalMapType!==void 0&&(v.normalMapType=r.normalMapType),r.normalScale!==void 0){let b=r.normalScale;Array.isArray(b)===!1&&(b=[b,b]),v.normalScale=new Ht().fromArray(b)}return r.displacementMap!==void 0&&(v.displacementMap=h(r.displacementMap)),r.displacementScale!==void 0&&(v.displacementScale=r.displacementScale),r.displacementBias!==void 0&&(v.displacementBias=r.displacementBias),r.roughnessMap!==void 0&&(v.roughnessMap=h(r.roughnessMap)),r.metalnessMap!==void 0&&(v.metalnessMap=h(r.metalnessMap)),r.emissiveMap!==void 0&&(v.emissiveMap=h(r.emissiveMap)),r.emissiveIntensity!==void 0&&(v.emissiveIntensity=r.emissiveIntensity),r.specularMap!==void 0&&(v.specularMap=h(r.specularMap)),r.specularIntensityMap!==void 0&&(v.specularIntensityMap=h(r.specularIntensityMap)),r.specularColorMap!==void 0&&(v.specularColorMap=h(r.specularColorMap)),r.envMap!==void 0&&(v.envMap=h(r.envMap)),r.envMapIntensity!==void 0&&(v.envMapIntensity=r.envMapIntensity),r.reflectivity!==void 0&&(v.reflectivity=r.reflectivity),r.refractionRatio!==void 0&&(v.refractionRatio=r.refractionRatio),r.lightMap!==void 0&&(v.lightMap=h(r.lightMap)),r.lightMapIntensity!==void 0&&(v.lightMapIntensity=r.lightMapIntensity),r.aoMap!==void 0&&(v.aoMap=h(r.aoMap)),r.aoMapIntensity!==void 0&&(v.aoMapIntensity=r.aoMapIntensity),r.gradientMap!==void 0&&(v.gradientMap=h(r.gradientMap)),r.clearcoatMap!==void 0&&(v.clearcoatMap=h(r.clearcoatMap)),r.clearcoatRoughnessMap!==void 0&&(v.clearcoatRoughnessMap=h(r.clearcoatRoughnessMap)),r.clearcoatNormalMap!==void 0&&(v.clearcoatNormalMap=h(r.clearcoatNormalMap)),r.clearcoatNormalScale!==void 0&&(v.clearcoatNormalScale=new Ht().fromArray(r.clearcoatNormalScale)),r.iridescenceMap!==void 0&&(v.iridescenceMap=h(r.iridescenceMap)),r.iridescenceThicknessMap!==void 0&&(v.iridescenceThicknessMap=h(r.iridescenceThicknessMap)),r.transmissionMap!==void 0&&(v.transmissionMap=h(r.transmissionMap)),r.thicknessMap!==void 0&&(v.thicknessMap=h(r.thicknessMap)),r.sheenColorMap!==void 0&&(v.sheenColorMap=h(r.sheenColorMap)),r.sheenRoughnessMap!==void 0&&(v.sheenRoughnessMap=h(r.sheenRoughnessMap)),v}setTextures(r){return this.textures=r,this}static createMaterialFromType(r){return new{ShadowMaterial:Eg,SpriteMaterial:Cu,RawShaderMaterial:rw,ShaderMaterial:sl,PointsMaterial:Pf,MeshPhysicalMaterial:Lu,MeshStandardMaterial:hp,MeshPhongMaterial:jh,MeshToonMaterial:Yc,MeshNormalMaterial:y_,MeshLambertMaterial:Ys,MeshDepthMaterial:Z0,MeshDistanceMaterial:$0,MeshBasicMaterial:pa,MeshMatcapMaterial:A_,LineDashedMaterial:by,LineBasicMaterial:Xs,Material:ks}[r]}}class Pg{static decodeText(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let l="";for(let h=0,f=r.length;h<f;h++)l+=String.fromCharCode(r[h]);try{return decodeURIComponent(escape(l))}catch{return l}}static extractUrlBase(r){const l=r.lastIndexOf("/");return l===-1?"./":r.slice(0,l+1)}static resolveURL(r,l){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(l)&&/^\//.test(r)&&(l=l.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:l+r)}}class mp extends Y{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(r){return super.copy(r),this.instanceCount=r.instanceCount,this}toJSON(){const r=super.toJSON();return r.instanceCount=this.instanceCount,r.isInstancedBufferGeometry=!0,r}}class uw extends ul{constructor(r){super(r)}load(r,l,h,f){const v=this,b=new wc(v.manager);b.setPath(v.path),b.setRequestHeader(v.requestHeader),b.setWithCredentials(v.withCredentials),b.load(r,function(E){try{l(v.parse(JSON.parse(E)))}catch(D){f?f(D):console.error(D),v.manager.itemError(r)}},h,f)}parse(r){const l={},h={};function f(F,N){if(l[N]!==void 0)return l[N];const z=F.interleavedBuffers[N],G=function(q,K){if(h[K]!==void 0)return h[K];const ne=q.arrayBuffers[K],be=new Uint32Array(ne).buffer;return h[K]=be,be}(F,z.buffer),W=sa(z.type,G),Q=new Ih(W,z.stride);return Q.uuid=z.uuid,l[N]=Q,Q}const v=r.isInstancedBufferGeometry?new mp:new Y,b=r.data.index;if(b!==void 0){const F=sa(b.type,b.array);v.setIndex(new tr(F,1))}const E=r.data.attributes;for(const F in E){const N=E[F];let z;if(N.isInterleavedBufferAttribute){const G=f(r.data,N.data);z=new kl(G,N.itemSize,N.offset,N.normalized)}else{const G=sa(N.type,N.array);z=new(N.isInstancedBufferAttribute?sp:tr)(G,N.itemSize,N.normalized)}N.name!==void 0&&(z.name=N.name),N.usage!==void 0&&z.setUsage(N.usage),N.updateRange!==void 0&&(z.updateRange.offset=N.updateRange.offset,z.updateRange.count=N.updateRange.count),v.setAttribute(F,z)}const D=r.data.morphAttributes;if(D)for(const F in D){const N=D[F],z=[];for(let G=0,W=N.length;G<W;G++){const Q=N[G];let q;if(Q.isInterleavedBufferAttribute){const K=f(r.data,Q.data);q=new kl(K,Q.itemSize,Q.offset,Q.normalized)}else{const K=sa(Q.type,Q.array);q=new tr(K,Q.itemSize,Q.normalized)}Q.name!==void 0&&(q.name=Q.name),z.push(q)}v.morphAttributes[F]=z}r.data.morphTargetsRelative&&(v.morphTargetsRelative=!0);const P=r.data.groups||r.data.drawcalls||r.data.offsets;if(P!==void 0)for(let F=0,N=P.length;F!==N;++F){const z=P[F];v.addGroup(z.start,z.count,z.materialIndex)}const O=r.data.boundingSphere;if(O!==void 0){const F=new fe;O.center!==void 0&&F.fromArray(O.center),v.boundingSphere=new la(F,O.radius)}return r.name&&(v.name=r.name),r.userData&&(v.userData=r.userData),v}}class Uu extends ul{constructor(r){super(r)}load(r,l,h,f){const v=this,b=this.path===""?Pg.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||b;const E=new wc(this.manager);E.setPath(this.path),E.setRequestHeader(this.requestHeader),E.setWithCredentials(this.withCredentials),E.load(r,function(D){let P=null;try{P=JSON.parse(D)}catch(F){return f!==void 0&&f(F),void console.error("THREE:ObjectLoader: Can't parse "+r+".",F.message)}const O=P.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry")return f!==void 0&&f(new Error("THREE.ObjectLoader: Can't load "+r)),void console.error("THREE.ObjectLoader: Can't load "+r);v.parse(P,l)},h,f)}async loadAsync(r,l){const h=this.path===""?Pg.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||h;const f=new wc(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials);const v=await f.loadAsync(r,l),b=JSON.parse(v),E=b.metadata;if(E===void 0||E.type===void 0||E.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+r);return await this.parseAsync(b)}parse(r,l){const h=this.parseAnimations(r.animations),f=this.parseShapes(r.shapes),v=this.parseGeometries(r.geometries,f),b=this.parseImages(r.images,function(){l!==void 0&&l(P)}),E=this.parseTextures(r.textures,b),D=this.parseMaterials(r.materials,E),P=this.parseObject(r.object,v,D,E,h),O=this.parseSkeletons(r.skeletons,P);if(this.bindSkeletons(P,O),l!==void 0){let F=!1;for(const N in b)if(b[N].data instanceof HTMLImageElement){F=!0;break}F===!1&&l(P)}return P}async parseAsync(r){const l=this.parseAnimations(r.animations),h=this.parseShapes(r.shapes),f=this.parseGeometries(r.geometries,h),v=await this.parseImagesAsync(r.images),b=this.parseTextures(r.textures,v),E=this.parseMaterials(r.materials,b),D=this.parseObject(r.object,f,E,b,l),P=this.parseSkeletons(r.skeletons,D);return this.bindSkeletons(D,P),D}parseShapes(r){const l={};if(r!==void 0)for(let h=0,f=r.length;h<f;h++){const v=new kh().fromJSON(r[h]);l[v.uuid]=v}return l}parseSkeletons(r,l){const h={},f={};if(l.traverse(function(v){v.isBone&&(f[v.uuid]=v)}),r!==void 0)for(let v=0,b=r.length;v<b;v++){const E=new rp().fromJSON(r[v],f);h[E.uuid]=E}return h}parseGeometries(r,l){const h={};if(r!==void 0){const f=new uw;for(let v=0,b=r.length;v<b;v++){let E;const D=r[v];switch(D.type){case"BufferGeometry":case"InstancedBufferGeometry":E=f.parse(D);break;default:D.type in Ay?E=Ay[D.type].fromJSON(D,l):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${D.type}"`)}E.uuid=D.uuid,D.name!==void 0&&(E.name=D.name),D.userData!==void 0&&(E.userData=D.userData),h[D.uuid]=E}}return h}parseMaterials(r,l){const h={},f={};if(r!==void 0){const v=new E_;v.setTextures(l);for(let b=0,E=r.length;b<E;b++){const D=r[b];h[D.uuid]===void 0&&(h[D.uuid]=v.parse(D)),f[D.uuid]=h[D.uuid]}}return f}parseAnimations(r){const l={};if(r!==void 0)for(let h=0;h<r.length;h++){const f=r[h],v=bc.parse(f);l[v.uuid]=v}return l}parseImages(r,l){const h=this,f={};let v;function b(E){if(typeof E=="string"){const D=E;return function(P){return h.manager.itemStart(P),v.load(P,function(){h.manager.itemEnd(P)},void 0,function(){h.manager.itemError(P),h.manager.itemEnd(P)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(D)?D:h.resourcePath+D)}return E.data?{data:sa(E.type,E.data),width:E.width,height:E.height,complete:!0}:null}if(r!==void 0&&r.length>0){const E=new Fl(l);v=new Tg(E),v.setCrossOrigin(this.crossOrigin);for(let D=0,P=r.length;D<P;D++){const O=r[D],F=O.url;if(Array.isArray(F)){const N=[];for(let z=0,G=F.length;z<G;z++){const W=b(F[z]);W!==null&&(W instanceof HTMLImageElement?N.push(W):N.push(new Ph(W.data,W.width,W.height)))}f[O.uuid]=new Nc(N)}else{const N=b(O.url);f[O.uuid]=new Nc(N)}}}return f}async parseImagesAsync(r){const l=this,h={};let f;async function v(b){if(typeof b=="string"){const E=b,D=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(E)?E:l.resourcePath+E;return await f.loadAsync(D)}return b.data?{data:sa(b.type,b.data),width:b.width,height:b.height,complete:!0}:null}if(r!==void 0&&r.length>0){f=new Tg(this.manager),f.setCrossOrigin(this.crossOrigin);for(let b=0,E=r.length;b<E;b++){const D=r[b],P=D.url;if(Array.isArray(P)){const O=[];for(let F=0,N=P.length;F<N;F++){const z=P[F],G=await v(z);G!==null&&(G instanceof HTMLImageElement?O.push(G):O.push(new Ph(G.data,G.width,G.height)))}h[D.uuid]=new Nc(O)}else{const O=await v(D.url);h[D.uuid]=new Nc(O)}}}return h}parseTextures(r,l){function h(v,b){return typeof v=="number"?v:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",v),b[v])}const f={};if(r!==void 0)for(let v=0,b=r.length;v<b;v++){const E=r[v];E.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',E.uuid),l[E.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",E.image);const D=l[E.image],P=D?D.data:void 0;let O;Array.isArray(P)?(O=new gc,P.length===6&&(O.needsUpdate=!0)):(O=P&&P.data?new Ph:new Or,P&&P.complete&&(O.needsUpdate=!0)),O.source=D,O.uuid=E.uuid,E.name!==void 0&&(O.name=E.name),E.mapping!==void 0&&(O.mapping=h(E.mapping,hw)),E.channel!==void 0&&(O.channel=E.channel),E.offset!==void 0&&O.offset.fromArray(E.offset),E.repeat!==void 0&&O.repeat.fromArray(E.repeat),E.center!==void 0&&O.center.fromArray(E.center),E.rotation!==void 0&&(O.rotation=E.rotation),E.wrap!==void 0&&(O.wrapS=h(E.wrap[0],dw),O.wrapT=h(E.wrap[1],dw)),E.format!==void 0&&(O.format=E.format),E.internalFormat!==void 0&&(O.internalFormat=E.internalFormat),E.type!==void 0&&(O.type=E.type),E.colorSpace!==void 0?O.colorSpace=E.colorSpace:E.encoding!==void 0&&(O.encoding=E.encoding),E.minFilter!==void 0&&(O.minFilter=h(E.minFilter,pw)),E.magFilter!==void 0&&(O.magFilter=h(E.magFilter,pw)),E.anisotropy!==void 0&&(O.anisotropy=E.anisotropy),E.flipY!==void 0&&(O.flipY=E.flipY),E.generateMipmaps!==void 0&&(O.generateMipmaps=E.generateMipmaps),E.premultiplyAlpha!==void 0&&(O.premultiplyAlpha=E.premultiplyAlpha),E.unpackAlignment!==void 0&&(O.unpackAlignment=E.unpackAlignment),E.userData!==void 0&&(O.userData=E.userData),f[E.uuid]=O}return f}parseObject(r,l,h,f,v){let b;const E=r.metadata&&r.metadata.version<=4.5?fr:void 0;function D(z){return l[z]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",z),l[z]}function P(z){if(z!==void 0){if(Array.isArray(z)){const G=[];for(let W=0,Q=z.length;W<Q;W++){const q=z[W];h[q]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",q),G.push(h[q])}return G}return h[z]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",z),h[z]}}function O(z){return f[z]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",z),f[z]}let F,N;switch(r.type){case"Scene":b=new tp,r.background!==void 0&&(Number.isInteger(r.background)?b.background=new xn().setHex(r.background,E):b.background=O(r.background)),r.environment!==void 0&&(b.environment=O(r.environment)),r.fog!==void 0&&(r.fog.type==="Fog"?b.fog=new n_(r.fog.color,r.fog.near,r.fog.far):r.fog.type==="FogExp2"&&(b.fog=new t_(r.fog.color,r.fog.density))),r.backgroundBlurriness!==void 0&&(b.backgroundBlurriness=r.backgroundBlurriness),r.backgroundIntensity!==void 0&&(b.backgroundIntensity=r.backgroundIntensity);break;case"PerspectiveCamera":b=new so(r.fov,r.aspect,r.near,r.far),r.focus!==void 0&&(b.focus=r.focus),r.zoom!==void 0&&(b.zoom=r.zoom),r.filmGauge!==void 0&&(b.filmGauge=r.filmGauge),r.filmOffset!==void 0&&(b.filmOffset=r.filmOffset),r.view!==void 0&&(b.view=Object.assign({},r.view));break;case"OrthographicCamera":b=new jm(r.left,r.right,r.top,r.bottom,r.near,r.far),r.zoom!==void 0&&(b.zoom=r.zoom),r.view!==void 0&&(b.view=Object.assign({},r.view));break;case"AmbientLight":b=new x_(r.color,r.intensity);break;case"DirectionalLight":b=new w_(r.color,r.intensity);break;case"PointLight":b=new Iy(r.color,r.intensity,r.distance,r.decay);break;case"RectAreaLight":b=new Ec(r.color,r.intensity,r.width,r.height);break;case"SpotLight":b=new b_(r.color,r.intensity,r.distance,r.angle,r.penumbra,r.decay);break;case"HemisphereLight":b=new aw(r.color,r.groundColor,r.intensity);break;case"LightProbe":b=new Gf().fromJSON(r);break;case"SkinnedMesh":F=D(r.geometry),N=P(r.material),b=new ry(F,N),r.bindMode!==void 0&&(b.bindMode=r.bindMode),r.bindMatrix!==void 0&&b.bindMatrix.fromArray(r.bindMatrix),r.skeleton!==void 0&&(b.skeleton=r.skeleton);break;case"Mesh":F=D(r.geometry),N=P(r.material),b=new Us(F,N);break;case"InstancedMesh":F=D(r.geometry),N=P(r.material);const z=r.count,G=r.instanceMatrix,W=r.instanceColor;b=new o_(F,N,z),b.instanceMatrix=new sp(new Float32Array(G.array),16),W!==void 0&&(b.instanceColor=new sp(new Float32Array(W.array),W.itemSize));break;case"LOD":b=new Tf;break;case"Line":b=new Dh(D(r.geometry),P(r.material));break;case"LineLoop":b=new ly(D(r.geometry),P(r.material));break;case"LineSegments":b=new qc(D(r.geometry),P(r.material));break;case"PointCloud":case"Points":b=new Rf(D(r.geometry),P(r.material));break;case"Sprite":b=new Hb(P(r.material));break;case"Group":b=new lo;break;case"Bone":b=new ig;break;default:b=new zi}if(b.uuid=r.uuid,r.name!==void 0&&(b.name=r.name),r.matrix!==void 0?(b.matrix.fromArray(r.matrix),r.matrixAutoUpdate!==void 0&&(b.matrixAutoUpdate=r.matrixAutoUpdate),b.matrixAutoUpdate&&b.matrix.decompose(b.position,b.quaternion,b.scale)):(r.position!==void 0&&b.position.fromArray(r.position),r.rotation!==void 0&&b.rotation.fromArray(r.rotation),r.quaternion!==void 0&&b.quaternion.fromArray(r.quaternion),r.scale!==void 0&&b.scale.fromArray(r.scale)),r.up!==void 0&&b.up.fromArray(r.up),r.castShadow!==void 0&&(b.castShadow=r.castShadow),r.receiveShadow!==void 0&&(b.receiveShadow=r.receiveShadow),r.shadow&&(r.shadow.bias!==void 0&&(b.shadow.bias=r.shadow.bias),r.shadow.normalBias!==void 0&&(b.shadow.normalBias=r.shadow.normalBias),r.shadow.radius!==void 0&&(b.shadow.radius=r.shadow.radius),r.shadow.mapSize!==void 0&&b.shadow.mapSize.fromArray(r.shadow.mapSize),r.shadow.camera!==void 0&&(b.shadow.camera=this.parseObject(r.shadow.camera))),r.visible!==void 0&&(b.visible=r.visible),r.frustumCulled!==void 0&&(b.frustumCulled=r.frustumCulled),r.renderOrder!==void 0&&(b.renderOrder=r.renderOrder),r.userData!==void 0&&(b.userData=r.userData),r.layers!==void 0&&(b.layers.mask=r.layers),r.children!==void 0){const z=r.children;for(let G=0;G<z.length;G++)b.add(this.parseObject(z[G],l,h,f,v))}if(r.animations!==void 0){const z=r.animations;for(let G=0;G<z.length;G++){const W=z[G];b.animations.push(v[W])}}if(r.type==="LOD"){r.autoUpdate!==void 0&&(b.autoUpdate=r.autoUpdate);const z=r.levels;for(let G=0;G<z.length;G++){const W=z[G],Q=b.getObjectByProperty("uuid",W.object);Q!==void 0&&b.addLevel(Q,W.distance,W.hysteresis)}}return b}bindSkeletons(r,l){Object.keys(l).length!==0&&r.traverse(function(h){if(h.isSkinnedMesh===!0&&h.skeleton!==void 0){const f=l[h.skeleton];f===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",h.skeleton):h.bind(f,h.bindMatrix)}})}}const hw={UVMapping:gr,CubeReflectionMapping:Ae,CubeRefractionMapping:Ji,EquirectangularReflectionMapping:Er,EquirectangularRefractionMapping:gs,CubeUVReflectionMapping:xi},dw={RepeatWrapping:Di,ClampToEdgeWrapping:vs,MirroredRepeatWrapping:_s},pw={NearestFilter:vr,NearestMipmapNearestFilter:Jo,NearestMipmapLinearFilter:Al,LinearFilter:_r,LinearMipmapNearestFilter:nh,LinearMipmapLinearFilter:bl};class aE extends ul{constructor(r){super(r),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(r){return this.options=r,this}load(r,l,h,f){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const v=this;Nl.get(r,"blob").then(b=>{if(b!==void 0)return v.manager.itemStart(r),void createImageBitmap(b,Object.assign(v.options,{colorSpaceConversion:"none"})).then(function(D){l&&l(D),v.manager.itemEnd(r)}).catch(function(D){f&&f(D),v.manager.itemError(r),v.manager.itemEnd(r)});const E={};E.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",E.headers=this.requestHeader,fetch(r,E).then(function(D){return D.blob()}).then(function(D){return Nl.add(r,D,"blob"),createImageBitmap(D,Object.assign(v.options,{colorSpaceConversion:"none"}))}).then(function(D){l&&l(D),v.manager.itemEnd(r)}).catch(function(D){f&&f(D),v.manager.itemError(r),v.manager.itemEnd(r)}),v.manager.itemStart(r)})}}let S_;class Dy{static getContext(){return S_===void 0&&(S_=new(window.AudioContext||window.webkitAudioContext)),S_}static setContext(r){S_=r}}class fw extends ul{constructor(r){super(r)}load(r,l,h,f){const v=this,b=new wc(this.manager);function E(D){f?f(D):console.error(D),v.manager.itemError(r)}b.setResponseType("arraybuffer"),b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(r,function(D){try{const P=D.slice(0);Dy.getContext().decodeAudioData(P,function(O){l(O)},E)}catch(P){E(P)}},h,f)}}class mw extends Gf{constructor(r,l,h=1){super(void 0,h),this.isHemisphereLightProbe=!0;const f=new xn().set(r),v=new xn().set(l),b=new fe(f.r,f.g,f.b),E=new fe(v.r,v.g,v.b),D=Math.sqrt(Math.PI),P=D*Math.sqrt(.75);this.sh.coefficients[0].copy(b).add(E).multiplyScalar(D),this.sh.coefficients[1].copy(b).sub(E).multiplyScalar(P)}}class By extends Gf{constructor(r,l=1){super(void 0,l),this.isAmbientLightProbe=!0;const h=new xn().set(r);this.sh.coefficients[0].set(h.r,h.g,h.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const Oy=new si,Ly=new si,co=new si;class C_{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new so,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new so,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(r){const l=this._cache;if(l.focus!==r.focus||l.fov!==r.fov||l.aspect!==r.aspect*this.aspect||l.near!==r.near||l.far!==r.far||l.zoom!==r.zoom||l.eyeSep!==this.eyeSep){l.focus=r.focus,l.fov=r.fov,l.aspect=r.aspect*this.aspect,l.near=r.near,l.far=r.far,l.zoom=r.zoom,l.eyeSep=this.eyeSep,co.copy(r.projectionMatrix);const h=l.eyeSep/2,f=h*l.near/l.focus,v=l.near*Math.tan(na*l.fov*.5)/l.zoom;let b,E;Ly.elements[12]=-h,Oy.elements[12]=h,b=-v*l.aspect+f,E=v*l.aspect+f,co.elements[0]=2*l.near/(E-b),co.elements[8]=(E+b)/(E-b),this.cameraL.projectionMatrix.copy(co),b=-v*l.aspect-f,E=v*l.aspect-f,co.elements[0]=2*l.near/(E-b),co.elements[8]=(E+b)/(E-b),this.cameraR.projectionMatrix.copy(co)}this.cameraL.matrixWorld.copy(r.matrixWorld).multiply(Ly),this.cameraR.matrixWorld.copy(r.matrixWorld).multiply(Oy)}}class gw{constructor(r=!0){this.autoStart=r,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ky(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const l=ky();r=(l-this.oldTime)/1e3,this.oldTime=l,this.elapsedTime+=r}return r}}function ky(){return(typeof performance>"u"?Date:performance).now()}const Nu=new fe,Uy=new Ao,wa=new fe,Cs=new fe;class Rg extends zi{constructor(){super(),this.type="AudioListener",this.context=Dy.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new gw}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(r){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=r,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}updateMatrixWorld(r){super.updateMatrixWorld(r);const l=this.context.listener,h=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Nu,Uy,wa),Cs.set(0,0,-1).applyQuaternion(Uy),l.positionX){const f=this.context.currentTime+this.timeDelta;l.positionX.linearRampToValueAtTime(Nu.x,f),l.positionY.linearRampToValueAtTime(Nu.y,f),l.positionZ.linearRampToValueAtTime(Nu.z,f),l.forwardX.linearRampToValueAtTime(Cs.x,f),l.forwardY.linearRampToValueAtTime(Cs.y,f),l.forwardZ.linearRampToValueAtTime(Cs.z,f),l.upX.linearRampToValueAtTime(h.x,f),l.upY.linearRampToValueAtTime(h.y,f),l.upZ.linearRampToValueAtTime(h.z,f)}else l.setPosition(Nu.x,Nu.y,Nu.z),l.setOrientation(Cs.x,Cs.y,Cs.z,h.x,h.y,h.z)}}class Dg extends zi{constructor(r){super(),this.type="Audio",this.listener=r,this.context=r.context,this.gain=this.context.createGain(),this.gain.connect(r.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(r){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=r,this.connect(),this}setMediaElementSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(r),this.connect(),this}setMediaStreamSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(r),this.connect(),this}setBuffer(r){return this.buffer=r,this.sourceType="buffer",this.autoplay&&this.play(),this}play(r=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+r;const l=this.context.createBufferSource();return l.buffer=this.buffer,l.loop=this.loop,l.loopStart=this.loopStart,l.loopEnd=this.loopEnd,l.onended=this.onEnded.bind(this),l.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=l,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let r=1,l=this.filters.length;r<l;r++)this.filters[r-1].connect(this.filters[r]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let r=1,l=this.filters.length;r<l;r++)this.filters[r-1].disconnect(this.filters[r]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(r){return r||(r=[]),this._connected===!0?(this.disconnect(),this.filters=r.slice(),this.connect()):this.filters=r.slice(),this}setDetune(r){if(this.detune=r,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(r){return this.setFilters(r?[r]:[])}setPlaybackRate(r){if(this.hasPlaybackControl!==!1)return this.playbackRate=r,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(r){if(this.hasPlaybackControl!==!1)return this.loop=r,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(r){return this.loopStart=r,this}setLoopEnd(r){return this.loopEnd=r,this}getVolume(){return this.gain.gain.value}setVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}}const Zc=new fe,M_=new Ao,vw=new fe,Qh=new fe;class _w extends Dg{constructor(r){super(r),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(r){return this.panner.refDistance=r,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(r){return this.panner.rolloffFactor=r,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(r){return this.panner.distanceModel=r,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(r){return this.panner.maxDistance=r,this}setDirectionalCone(r,l,h){return this.panner.coneInnerAngle=r,this.panner.coneOuterAngle=l,this.panner.coneOuterGain=h,this}updateMatrixWorld(r){if(super.updateMatrixWorld(r),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Zc,M_,vw),Qh.set(0,0,1).applyQuaternion(M_);const l=this.panner;if(l.positionX){const h=this.context.currentTime+this.listener.timeDelta;l.positionX.linearRampToValueAtTime(Zc.x,h),l.positionY.linearRampToValueAtTime(Zc.y,h),l.positionZ.linearRampToValueAtTime(Zc.z,h),l.orientationX.linearRampToValueAtTime(Qh.x,h),l.orientationY.linearRampToValueAtTime(Qh.y,h),l.orientationZ.linearRampToValueAtTime(Qh.z,h)}else l.setPosition(Zc.x,Zc.y,Zc.z),l.setOrientation(Qh.x,Qh.y,Qh.z)}}class Ny{constructor(r,l=2048){this.analyser=r.context.createAnalyser(),this.analyser.fftSize=l,this.data=new Uint8Array(this.analyser.frequencyBinCount),r.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let r=0;const l=this.getFrequencyData();for(let h=0;h<l.length;h++)r+=l[h];return r/l.length}}class Fy{constructor(r,l,h){let f,v,b;switch(this.binding=r,this.valueSize=h,l){case"quaternion":f=this._slerp,v=this._slerpAdditive,b=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*h),this._workIndex=5;break;case"string":case"bool":f=this._select,v=this._select,b=this._setAdditiveIdentityOther,this.buffer=new Array(5*h);break;default:f=this._lerp,v=this._lerpAdditive,b=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*h)}this._mixBufferRegion=f,this._mixBufferRegionAdditive=v,this._setIdentity=b,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(r,l){const h=this.buffer,f=this.valueSize,v=r*f+f;let b=this.cumulativeWeight;if(b===0){for(let E=0;E!==f;++E)h[v+E]=h[E];b=l}else{b+=l;const E=l/b;this._mixBufferRegion(h,v,0,E,f)}this.cumulativeWeight=b}accumulateAdditive(r){const l=this.buffer,h=this.valueSize,f=h*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(l,f,0,r,h),this.cumulativeWeightAdditive+=r}apply(r){const l=this.valueSize,h=this.buffer,f=r*l+l,v=this.cumulativeWeight,b=this.cumulativeWeightAdditive,E=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,v<1){const D=l*this._origIndex;this._mixBufferRegion(h,f,D,1-v,l)}b>0&&this._mixBufferRegionAdditive(h,f,this._addIndex*l,1,l);for(let D=l,P=l+l;D!==P;++D)if(h[D]!==h[D+l]){E.setValue(h,f);break}}saveOriginalState(){const r=this.binding,l=this.buffer,h=this.valueSize,f=h*this._origIndex;r.getValue(l,f);for(let v=h,b=f;v!==b;++v)l[v]=l[f+v%h];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const r=3*this.valueSize;this.binding.setValue(this.buffer,r)}_setAdditiveIdentityNumeric(){const r=this._addIndex*this.valueSize,l=r+this.valueSize;for(let h=r;h<l;h++)this.buffer[h]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const r=this._origIndex*this.valueSize,l=this._addIndex*this.valueSize;for(let h=0;h<this.valueSize;h++)this.buffer[l+h]=this.buffer[r+h]}_select(r,l,h,f,v){if(f>=.5)for(let b=0;b!==v;++b)r[l+b]=r[h+b]}_slerp(r,l,h,f){Ao.slerpFlat(r,l,r,l,r,h,f)}_slerpAdditive(r,l,h,f,v){const b=this._workIndex*v;Ao.multiplyQuaternionsFlat(r,b,r,l,r,h),Ao.slerpFlat(r,l,r,l,r,b,f)}_lerp(r,l,h,f,v){const b=1-f;for(let E=0;E!==v;++E){const D=l+E;r[D]=r[D]*b+r[h+E]*f}}_lerpAdditive(r,l,h,f,v){for(let b=0;b!==v;++b){const E=l+b;r[E]=r[E]+r[h+b]*f}}}const jy="\\[\\]\\.:\\/",yw=new RegExp("["+jy+"]","g"),Bg="[^"+jy+"]",kr="[^"+jy.replace("\\.","")+"]",gp=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Bg)+/(WCOD+)?/.source.replace("WCOD",kr)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Bg)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Bg)+"$"),$c=["material","materials","bones","map"];class Ui{constructor(r,l,h){this.path=l,this.parsedPath=h||Ui.parseTrackName(l),this.node=Ui.findNode(r,this.parsedPath.nodeName),this.rootNode=r,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(r,l,h){return r&&r.isAnimationObjectGroup?new Ui.Composite(r,l,h):new Ui(r,l,h)}static sanitizeNodeName(r){return r.replace(/\s/g,"_").replace(yw,"")}static parseTrackName(r){const l=gp.exec(r);if(l===null)throw new Error("PropertyBinding: Cannot parse trackName: "+r);const h={nodeName:l[2],objectName:l[3],objectIndex:l[4],propertyName:l[5],propertyIndex:l[6]},f=h.nodeName&&h.nodeName.lastIndexOf(".");if(f!==void 0&&f!==-1){const v=h.nodeName.substring(f+1);$c.indexOf(v)!==-1&&(h.nodeName=h.nodeName.substring(0,f),h.objectName=v)}if(h.propertyName===null||h.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+r);return h}static findNode(r,l){if(l===void 0||l===""||l==="."||l===-1||l===r.name||l===r.uuid)return r;if(r.skeleton){const h=r.skeleton.getBoneByName(l);if(h!==void 0)return h}if(r.children){const h=function(v){for(let b=0;b<v.length;b++){const E=v[b];if(E.name===l||E.uuid===l)return E;const D=h(E.children);if(D)return D}return null},f=h(r.children);if(f)return f}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(r,l){r[l]=this.targetObject[this.propertyName]}_getValue_array(r,l){const h=this.resolvedProperty;for(let f=0,v=h.length;f!==v;++f)r[l++]=h[f]}_getValue_arrayElement(r,l){r[l]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(r,l){this.resolvedProperty.toArray(r,l)}_setValue_direct(r,l){this.targetObject[this.propertyName]=r[l]}_setValue_direct_setNeedsUpdate(r,l){this.targetObject[this.propertyName]=r[l],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(r,l){this.targetObject[this.propertyName]=r[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,l){const h=this.resolvedProperty;for(let f=0,v=h.length;f!==v;++f)h[f]=r[l++]}_setValue_array_setNeedsUpdate(r,l){const h=this.resolvedProperty;for(let f=0,v=h.length;f!==v;++f)h[f]=r[l++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,l){const h=this.resolvedProperty;for(let f=0,v=h.length;f!==v;++f)h[f]=r[l++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(r,l){this.resolvedProperty[this.propertyIndex]=r[l]}_setValue_arrayElement_setNeedsUpdate(r,l){this.resolvedProperty[this.propertyIndex]=r[l],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(r,l){this.resolvedProperty[this.propertyIndex]=r[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(r,l){this.resolvedProperty.fromArray(r,l)}_setValue_fromArray_setNeedsUpdate(r,l){this.resolvedProperty.fromArray(r,l),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(r,l){this.resolvedProperty.fromArray(r,l),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(r,l){this.bind(),this.getValue(r,l)}_setValue_unbound(r,l){this.bind(),this.setValue(r,l)}bind(){let r=this.node;const l=this.parsedPath,h=l.objectName,f=l.propertyName;let v=l.propertyIndex;if(r||(r=Ui.findNode(this.rootNode,l.nodeName),this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!r)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(h){let P=l.objectIndex;switch(h){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let O=0;O<r.length;O++)if(r[O].name===P){P=O;break}break;case"map":if("map"in r){r=r.map;break}if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);r=r.material.map;break;default:if(r[h]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[h]}if(P!==void 0){if(r[P]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[P]}}const b=r[f];if(b===void 0){const P=l.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+P+"."+f+" but it wasn't found.",r)}let E=this.Versioning.None;this.targetObject=r,r.needsUpdate!==void 0?E=this.Versioning.NeedsUpdate:r.matrixWorldNeedsUpdate!==void 0&&(E=this.Versioning.MatrixWorldNeedsUpdate);let D=this.BindingType.Direct;if(v!==void 0){if(f==="morphTargetInfluences"){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);r.morphTargetDictionary[v]!==void 0&&(v=r.morphTargetDictionary[v])}D=this.BindingType.ArrayElement,this.resolvedProperty=b,this.propertyIndex=v}else b.fromArray!==void 0&&b.toArray!==void 0?(D=this.BindingType.HasFromToArray,this.resolvedProperty=b):Array.isArray(b)?(D=this.BindingType.EntireArray,this.resolvedProperty=b):this.propertyName=f;this.getValue=this.GetterByBindingType[D],this.setValue=this.SetterByBindingTypeAndVersioning[D][E]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ui.Composite=class{constructor(A,r,l){const h=l||Ui.parseTrackName(r);this._targetGroup=A,this._bindings=A.subscribe_(r,h)}getValue(A,r){this.bind();const l=this._targetGroup.nCachedObjects_,h=this._bindings[l];h!==void 0&&h.getValue(A,r)}setValue(A,r){const l=this._bindings;for(let h=this._targetGroup.nCachedObjects_,f=l.length;h!==f;++h)l[h].setValue(A,r)}bind(){const A=this._bindings;for(let r=this._targetGroup.nCachedObjects_,l=A.length;r!==l;++r)A[r].bind()}unbind(){const A=this._bindings;for(let r=this._targetGroup.nCachedObjects_,l=A.length;r!==l;++r)A[r].unbind()}},Ui.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ui.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ui.prototype.GetterByBindingType=[Ui.prototype._getValue_direct,Ui.prototype._getValue_array,Ui.prototype._getValue_arrayElement,Ui.prototype._getValue_toArray],Ui.prototype.SetterByBindingTypeAndVersioning=[[Ui.prototype._setValue_direct,Ui.prototype._setValue_direct_setNeedsUpdate,Ui.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_array,Ui.prototype._setValue_array_setNeedsUpdate,Ui.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_arrayElement,Ui.prototype._setValue_arrayElement_setNeedsUpdate,Ui.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_fromArray,Ui.prototype._setValue_fromArray_setNeedsUpdate,Ui.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Og{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ss(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const r={};this._indicesByUUID=r;for(let h=0,f=arguments.length;h!==f;++h)r[arguments[h].uuid]=h;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const l=this;this.stats={objects:{get total(){return l._objects.length},get inUse(){return this.total-l.nCachedObjects_}},get bindingsPerObject(){return l._bindings.length}}}add(){const r=this._objects,l=this._indicesByUUID,h=this._paths,f=this._parsedPaths,v=this._bindings,b=v.length;let E,D=r.length,P=this.nCachedObjects_;for(let O=0,F=arguments.length;O!==F;++O){const N=arguments[O],z=N.uuid;let G=l[z];if(G===void 0){G=D++,l[z]=G,r.push(N);for(let W=0,Q=b;W!==Q;++W)v[W].push(new Ui(N,h[W],f[W]))}else if(G<P){E=r[G];const W=--P,Q=r[W];l[Q.uuid]=G,r[G]=Q,l[z]=W,r[W]=N;for(let q=0,K=b;q!==K;++q){const ne=v[q],be=ne[W];let ve=ne[G];ne[G]=be,ve===void 0&&(ve=new Ui(N,h[q],f[q])),ne[W]=ve}}else r[G]!==E&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=P}remove(){const r=this._objects,l=this._indicesByUUID,h=this._bindings,f=h.length;let v=this.nCachedObjects_;for(let b=0,E=arguments.length;b!==E;++b){const D=arguments[b],P=D.uuid,O=l[P];if(O!==void 0&&O>=v){const F=v++,N=r[F];l[N.uuid]=O,r[O]=N,l[P]=F,r[F]=D;for(let z=0,G=f;z!==G;++z){const W=h[z],Q=W[F],q=W[O];W[O]=Q,W[F]=q}}}this.nCachedObjects_=v}uncache(){const r=this._objects,l=this._indicesByUUID,h=this._bindings,f=h.length;let v=this.nCachedObjects_,b=r.length;for(let E=0,D=arguments.length;E!==D;++E){const P=arguments[E].uuid,O=l[P];if(O!==void 0)if(delete l[P],O<v){const F=--v,N=r[F],z=--b,G=r[z];l[N.uuid]=O,r[O]=N,l[G.uuid]=F,r[F]=G,r.pop();for(let W=0,Q=f;W!==Q;++W){const q=h[W],K=q[F],ne=q[z];q[O]=K,q[F]=ne,q.pop()}}else{const F=--b,N=r[F];F>0&&(l[N.uuid]=O),r[O]=N,r.pop();for(let z=0,G=f;z!==G;++z){const W=h[z];W[O]=W[F],W.pop()}}}this.nCachedObjects_=v}subscribe_(r,l){const h=this._bindingsIndicesByPath;let f=h[r];const v=this._bindings;if(f!==void 0)return v[f];const b=this._paths,E=this._parsedPaths,D=this._objects,P=D.length,O=this.nCachedObjects_,F=new Array(P);f=v.length,h[r]=f,b.push(r),E.push(l),v.push(F);for(let N=O,z=D.length;N!==z;++N){const G=D[N];F[N]=new Ui(G,r,l)}return F}unsubscribe_(r){const l=this._bindingsIndicesByPath,h=l[r];if(h!==void 0){const f=this._paths,v=this._parsedPaths,b=this._bindings,E=b.length-1,D=b[E];l[r[E]]=h,b[h]=D,b.pop(),v[h]=v[E],v.pop(),f[h]=f[E],f.pop()}}}class Aw{constructor(r,l,h=null,f=l.blendMode){this._mixer=r,this._clip=l,this._localRoot=h,this.blendMode=f;const v=l.tracks,b=v.length,E=new Array(b),D={endingStart:oc,endingEnd:oc};for(let P=0;P!==b;++P){const O=v[P].createInterpolant(null);E[P]=O,O.settings=D}this._interpolantSettings=D,this._interpolants=E,this._propertyBindings=new Array(b),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Zp,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(r){return this._startTime=r,this}setLoop(r,l){return this.loop=r,this.repetitions=l,this}setEffectiveWeight(r){return this.weight=r,this._effectiveWeight=this.enabled?r:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(r){return this._scheduleFading(r,0,1)}fadeOut(r){return this._scheduleFading(r,1,0)}crossFadeFrom(r,l,h){if(r.fadeOut(l),this.fadeIn(l),h){const f=this._clip.duration,v=r._clip.duration,b=v/f,E=f/v;r.warp(1,b,l),this.warp(E,1,l)}return this}crossFadeTo(r,l,h){return r.crossFadeFrom(this,l,h)}stopFading(){const r=this._weightInterpolant;return r!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}setEffectiveTimeScale(r){return this.timeScale=r,this._effectiveTimeScale=this.paused?0:r,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(r){return this.timeScale=this._clip.duration/r,this.stopWarping()}syncWith(r){return this.time=r.time,this.timeScale=r.timeScale,this.stopWarping()}halt(r){return this.warp(this._effectiveTimeScale,0,r)}warp(r,l,h){const f=this._mixer,v=f.time,b=this.timeScale;let E=this._timeScaleInterpolant;E===null&&(E=f._lendControlInterpolant(),this._timeScaleInterpolant=E);const D=E.parameterPositions,P=E.sampleValues;return D[0]=v,D[1]=v+h,P[0]=r/b,P[1]=l/b,this}stopWarping(){const r=this._timeScaleInterpolant;return r!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(r,l,h,f){if(!this.enabled)return void this._updateWeight(r);const v=this._startTime;if(v!==null){const D=(r-v)*h;D<0||h===0?l=0:(this._startTime=null,l=h*D)}l*=this._updateTimeScale(r);const b=this._updateTime(l),E=this._updateWeight(r);if(E>0){const D=this._interpolants,P=this._propertyBindings;if(this.blendMode===Md)for(let O=0,F=D.length;O!==F;++O)D[O].evaluate(b),P[O].accumulateAdditive(E);else for(let O=0,F=D.length;O!==F;++O)D[O].evaluate(b),P[O].accumulate(f,E)}}_updateWeight(r){let l=0;if(this.enabled){l=this.weight;const h=this._weightInterpolant;if(h!==null){const f=h.evaluate(r)[0];l*=f,r>h.parameterPositions[1]&&(this.stopFading(),f===0&&(this.enabled=!1))}}return this._effectiveWeight=l,l}_updateTimeScale(r){let l=0;if(!this.paused){l=this.timeScale;const h=this._timeScaleInterpolant;h!==null&&(l*=h.evaluate(r)[0],r>h.parameterPositions[1]&&(this.stopWarping(),l===0?this.paused=!0:this.timeScale=l))}return this._effectiveTimeScale=l,l}_updateTime(r){const l=this._clip.duration,h=this.loop;let f=this.time+r,v=this._loopCount;const b=h===lu;if(r===0)return v===-1?f:b&&(1&v)==1?l-f:f;if(h===Ii){v===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(f>=l)f=l;else{if(!(f<0)){this.time=f;break e}f=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=f,this._mixer.dispatchEvent({type:"finished",action:this,direction:r<0?-1:1})}}else{if(v===-1&&(r>=0?(v=0,this._setEndings(!0,this.repetitions===0,b)):this._setEndings(this.repetitions===0,!0,b)),f>=l||f<0){const E=Math.floor(f/l);f-=l*E,v+=Math.abs(E);const D=this.repetitions-v;if(D<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,f=r>0?l:0,this.time=f,this._mixer.dispatchEvent({type:"finished",action:this,direction:r>0?1:-1});else{if(D===1){const P=r<0;this._setEndings(P,!P,b)}else this._setEndings(!1,!1,b);this._loopCount=v,this.time=f,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:E})}}else this.time=f;if(b&&(1&v)==1)return l-f}return f}_setEndings(r,l,h){const f=this._interpolantSettings;h?(f.endingStart=ac,f.endingEnd=ac):(f.endingStart=r?this.zeroSlopeAtStart?ac:oc:cu,f.endingEnd=l?this.zeroSlopeAtEnd?ac:oc:cu)}_scheduleFading(r,l,h){const f=this._mixer,v=f.time;let b=this._weightInterpolant;b===null&&(b=f._lendControlInterpolant(),this._weightInterpolant=b);const E=b.parameterPositions,D=b.sampleValues;return E[0]=v,D[0]=l,E[1]=v+r,D[1]=h,this}}const lE=new Float32Array(1);class cE extends Ml{constructor(r){super(),this._root=r,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(r,l){const h=r._localRoot||this._root,f=r._clip.tracks,v=f.length,b=r._propertyBindings,E=r._interpolants,D=h.uuid,P=this._bindingsByRootAndName;let O=P[D];O===void 0&&(O={},P[D]=O);for(let F=0;F!==v;++F){const N=f[F],z=N.name;let G=O[z];if(G!==void 0)++G.referenceCount,b[F]=G;else{if(G=b[F],G!==void 0){G._cacheIndex===null&&(++G.referenceCount,this._addInactiveBinding(G,D,z));continue}const W=l&&l._propertyBindings[F].binding.parsedPath;G=new Fy(Ui.create(h,z,W),N.ValueTypeName,N.getValueSize()),++G.referenceCount,this._addInactiveBinding(G,D,z),b[F]=G}E[F].resultBuffer=G.buffer}}_activateAction(r){if(!this._isActiveAction(r)){if(r._cacheIndex===null){const h=(r._localRoot||this._root).uuid,f=r._clip.uuid,v=this._actionsByClip[f];this._bindAction(r,v&&v.knownActions[0]),this._addInactiveAction(r,f,h)}const l=r._propertyBindings;for(let h=0,f=l.length;h!==f;++h){const v=l[h];v.useCount++==0&&(this._lendBinding(v),v.saveOriginalState())}this._lendAction(r)}}_deactivateAction(r){if(this._isActiveAction(r)){const l=r._propertyBindings;for(let h=0,f=l.length;h!==f;++h){const v=l[h];--v.useCount==0&&(v.restoreOriginalState(),this._takeBackBinding(v))}this._takeBackAction(r)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const r=this;this.stats={actions:{get total(){return r._actions.length},get inUse(){return r._nActiveActions}},bindings:{get total(){return r._bindings.length},get inUse(){return r._nActiveBindings}},controlInterpolants:{get total(){return r._controlInterpolants.length},get inUse(){return r._nActiveControlInterpolants}}}}_isActiveAction(r){const l=r._cacheIndex;return l!==null&&l<this._nActiveActions}_addInactiveAction(r,l,h){const f=this._actions,v=this._actionsByClip;let b=v[l];if(b===void 0)b={knownActions:[r],actionByRoot:{}},r._byClipCacheIndex=0,v[l]=b;else{const E=b.knownActions;r._byClipCacheIndex=E.length,E.push(r)}r._cacheIndex=f.length,f.push(r),b.actionByRoot[h]=r}_removeInactiveAction(r){const l=this._actions,h=l[l.length-1],f=r._cacheIndex;h._cacheIndex=f,l[f]=h,l.pop(),r._cacheIndex=null;const v=r._clip.uuid,b=this._actionsByClip,E=b[v],D=E.knownActions,P=D[D.length-1],O=r._byClipCacheIndex;P._byClipCacheIndex=O,D[O]=P,D.pop(),r._byClipCacheIndex=null,delete E.actionByRoot[(r._localRoot||this._root).uuid],D.length===0&&delete b[v],this._removeInactiveBindingsForAction(r)}_removeInactiveBindingsForAction(r){const l=r._propertyBindings;for(let h=0,f=l.length;h!==f;++h){const v=l[h];--v.referenceCount==0&&this._removeInactiveBinding(v)}}_lendAction(r){const l=this._actions,h=r._cacheIndex,f=this._nActiveActions++,v=l[f];r._cacheIndex=f,l[f]=r,v._cacheIndex=h,l[h]=v}_takeBackAction(r){const l=this._actions,h=r._cacheIndex,f=--this._nActiveActions,v=l[f];r._cacheIndex=f,l[f]=r,v._cacheIndex=h,l[h]=v}_addInactiveBinding(r,l,h){const f=this._bindingsByRootAndName,v=this._bindings;let b=f[l];b===void 0&&(b={},f[l]=b),b[h]=r,r._cacheIndex=v.length,v.push(r)}_removeInactiveBinding(r){const l=this._bindings,h=r.binding,f=h.rootNode.uuid,v=h.path,b=this._bindingsByRootAndName,E=b[f],D=l[l.length-1],P=r._cacheIndex;D._cacheIndex=P,l[P]=D,l.pop(),delete E[v],Object.keys(E).length===0&&delete b[f]}_lendBinding(r){const l=this._bindings,h=r._cacheIndex,f=this._nActiveBindings++,v=l[f];r._cacheIndex=f,l[f]=r,v._cacheIndex=h,l[h]=v}_takeBackBinding(r){const l=this._bindings,h=r._cacheIndex,f=--this._nActiveBindings,v=l[f];r._cacheIndex=f,l[f]=r,v._cacheIndex=h,l[h]=v}_lendControlInterpolant(){const r=this._controlInterpolants,l=this._nActiveControlInterpolants++;let h=r[l];return h===void 0&&(h=new zh(new Float32Array(2),new Float32Array(2),1,lE),h.__cacheIndex=l,r[l]=h),h}_takeBackControlInterpolant(r){const l=this._controlInterpolants,h=r.__cacheIndex,f=--this._nActiveControlInterpolants,v=l[f];r.__cacheIndex=f,l[f]=r,v.__cacheIndex=h,l[h]=v}clipAction(r,l,h){const f=l||this._root,v=f.uuid;let b=typeof r=="string"?bc.findByName(f,r):r;const E=b!==null?b.uuid:r,D=this._actionsByClip[E];let P=null;if(h===void 0&&(h=b!==null?b.blendMode:Hs),D!==void 0){const F=D.actionByRoot[v];if(F!==void 0&&F.blendMode===h)return F;P=D.knownActions[0],b===null&&(b=P._clip)}if(b===null)return null;const O=new Aw(this,b,l,h);return this._bindAction(O,P),this._addInactiveAction(O,E,v),O}existingAction(r,l){const h=l||this._root,f=h.uuid,v=typeof r=="string"?bc.findByName(h,r):r,b=v?v.uuid:r,E=this._actionsByClip[b];return E!==void 0&&E.actionByRoot[f]||null}stopAllAction(){const r=this._actions;for(let l=this._nActiveActions-1;l>=0;--l)r[l].stop();return this}update(r){r*=this.timeScale;const l=this._actions,h=this._nActiveActions,f=this.time+=r,v=Math.sign(r),b=this._accuIndex^=1;for(let P=0;P!==h;++P)l[P]._update(f,r,v,b);const E=this._bindings,D=this._nActiveBindings;for(let P=0;P!==D;++P)E[P].apply(b);return this}setTime(r){this.time=0;for(let l=0;l<this._actions.length;l++)this._actions[l].time=0;return this.update(r)}getRoot(){return this._root}uncacheClip(r){const l=this._actions,h=r.uuid,f=this._actionsByClip,v=f[h];if(v!==void 0){const b=v.knownActions;for(let E=0,D=b.length;E!==D;++E){const P=b[E];this._deactivateAction(P);const O=P._cacheIndex,F=l[l.length-1];P._cacheIndex=null,P._byClipCacheIndex=null,F._cacheIndex=O,l[O]=F,l.pop(),this._removeInactiveBindingsForAction(P)}delete f[h]}}uncacheRoot(r){const l=r.uuid,h=this._actionsByClip;for(const v in h){const b=h[v].actionByRoot[l];b!==void 0&&(this._deactivateAction(b),this._removeInactiveAction(b))}const f=this._bindingsByRootAndName[l];if(f!==void 0)for(const v in f){const b=f[v];b.restoreOriginalState(),this._removeInactiveBinding(b)}}uncacheAction(r,l){const h=this.existingAction(r,l);h!==null&&(this._deactivateAction(h),this._removeInactiveAction(h))}}class zy{constructor(r){this.value=r}clone(){return new zy(this.value.clone===void 0?this.value:this.value.clone())}}let Vy=0;class Sc extends Ml{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Vy++}),this.name="",this.usage=lc,this.uniforms=[]}add(r){return this.uniforms.push(r),this}remove(r){const l=this.uniforms.indexOf(r);return l!==-1&&this.uniforms.splice(l,1),this}setName(r){return this.name=r,this}setUsage(r){return this.usage=r,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(r){this.name=r.name,this.usage=r.usage;const l=r.uniforms;this.uniforms.length=0;for(let h=0,f=l.length;h<f;h++)this.uniforms.push(l[h].clone());return this}clone(){return new this.constructor().copy(this)}}class Gy extends Ih{constructor(r,l,h=1){super(r,l),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=h}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}clone(r){const l=super.clone(r);return l.meshPerAttribute=this.meshPerAttribute,l}toJSON(r){const l=super.toJSON(r);return l.isInstancedInterleavedBuffer=!0,l.meshPerAttribute=this.meshPerAttribute,l}}class Hy{constructor(r,l,h,f,v){this.isGLBufferAttribute=!0,this.name="",this.buffer=r,this.type=l,this.itemSize=h,this.elementSize=f,this.count=v,this.version=0}set needsUpdate(r){r===!0&&this.version++}setBuffer(r){return this.buffer=r,this}setType(r,l){return this.type=r,this.elementSize=l,this}setItemSize(r){return this.itemSize=r,this}setCount(r){return this.count=r,this}}class bw{constructor(r,l,h=0,f=1/0){this.ray=new io(r,l),this.near=h,this.far=f,this.camera=null,this.layers=new Dl,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(r,l){this.ray.set(r,l)}setFromCamera(r,l){l.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(l.matrixWorld),this.ray.direction.set(r.x,r.y,.5).unproject(l).sub(this.ray.origin).normalize(),this.camera=l):l.isOrthographicCamera?(this.ray.origin.set(r.x,r.y,(l.near+l.far)/(l.near-l.far)).unproject(l),this.ray.direction.set(0,0,-1).transformDirection(l.matrixWorld),this.camera=l):console.error("THREE.Raycaster: Unsupported camera type: "+l.type)}intersectObject(r,l=!0,h=[]){return Cc(r,this,h,l),h.sort(ww),h}intersectObjects(r,l=!0,h=[]){for(let f=0,v=r.length;f<v;f++)Cc(r[f],this,h,l);return h.sort(ww),h}}function ww(A,r){return A.distance-r.distance}function Cc(A,r,l,h){if(A.layers.test(r.layers)&&A.raycast(r,l),h===!0){const f=A.children;for(let v=0,b=f.length;v<b;v++)Cc(f[v],r,l,!0)}}class Lg{constructor(r=1,l=0,h=0){return this.radius=r,this.phi=l,this.theta=h,this}set(r,l,h){return this.radius=r,this.phi=l,this.theta=h,this}copy(r){return this.radius=r.radius,this.phi=r.phi,this.theta=r.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,l,h){return this.radius=Math.sqrt(r*r+l*l+h*h),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r,h),this.phi=Math.acos($i(l/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Qy{constructor(r=1,l=0,h=0){return this.radius=r,this.theta=l,this.y=h,this}set(r,l,h){return this.radius=r,this.theta=l,this.y=h,this}copy(r){return this.radius=r.radius,this.theta=r.theta,this.y=r.y,this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,l,h){return this.radius=Math.sqrt(r*r+h*h),this.theta=Math.atan2(r,h),this.y=l,this}clone(){return new this.constructor().copy(this)}}const T_=new Ht;class xw{constructor(r=new Ht(1/0,1/0),l=new Ht(-1/0,-1/0)){this.isBox2=!0,this.min=r,this.max=l}set(r,l){return this.min.copy(r),this.max.copy(l),this}setFromPoints(r){this.makeEmpty();for(let l=0,h=r.length;l<h;l++)this.expandByPoint(r[l]);return this}setFromCenterAndSize(r,l){const h=T_.copy(l).multiplyScalar(.5);return this.min.copy(r).sub(h),this.max.copy(r).add(h),this}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(r){return this.isEmpty()?r.set(0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y}getParameter(r,l){return l.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y)}clampPoint(r,l){return l.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,T_).distanceTo(r)}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}const Hf=new fe,vp=new fe;class Ew{constructor(r=new fe,l=new fe){this.start=r,this.end=l}set(r,l){return this.start.copy(r),this.end.copy(l),this}copy(r){return this.start.copy(r.start),this.end.copy(r.end),this}getCenter(r){return r.addVectors(this.start,this.end).multiplyScalar(.5)}delta(r){return r.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(r,l){return this.delta(l).multiplyScalar(r).add(this.start)}closestPointToPointParameter(r,l){Hf.subVectors(r,this.start),vp.subVectors(this.end,this.start);const h=vp.dot(vp);let f=vp.dot(Hf)/h;return l&&(f=$i(f,0,1)),f}closestPointToPoint(r,l,h){const f=this.closestPointToPointParameter(r,l);return this.delta(h).multiplyScalar(f).add(this.start)}applyMatrix4(r){return this.start.applyMatrix4(r),this.end.applyMatrix4(r),this}equals(r){return r.start.equals(this.start)&&r.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Sw=new fe;class Wy extends zi{constructor(r,l){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=l,this.type="SpotLightHelper";const h=new Y,f=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let b=0,E=1,D=32;b<D;b++,E++){const P=b/D*Math.PI*2,O=E/D*Math.PI*2;f.push(Math.cos(P),Math.sin(P),1,Math.cos(O),Math.sin(O),1)}h.setAttribute("position",new Pn(f,3));const v=new Xs({fog:!1,toneMapped:!1});this.cone=new qc(h,v),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const r=this.light.distance?this.light.distance:1e3,l=r*Math.tan(this.light.angle);this.cone.scale.set(l,l,r),Sw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Sw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Wh=new fe,I_=new si,qy=new si;class uE extends qc{constructor(r){const l=Cw(r),h=new Y,f=[],v=[],b=new xn(0,0,1),E=new xn(0,1,0);for(let D=0;D<l.length;D++){const P=l[D];P.parent&&P.parent.isBone&&(f.push(0,0,0),f.push(0,0,0),v.push(b.r,b.g,b.b),v.push(E.r,E.g,E.b))}h.setAttribute("position",new Pn(f,3)),h.setAttribute("color",new Pn(v,3)),super(h,new Xs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=r,this.bones=l,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(r){const l=this.bones,h=this.geometry,f=h.getAttribute("position");qy.copy(this.root.matrixWorld).invert();for(let v=0,b=0;v<l.length;v++){const E=l[v];E.parent&&E.parent.isBone&&(I_.multiplyMatrices(qy,E.matrixWorld),Wh.setFromMatrixPosition(I_),f.setXYZ(b,Wh.x,Wh.y,Wh.z),I_.multiplyMatrices(qy,E.parent.matrixWorld),Wh.setFromMatrixPosition(I_),f.setXYZ(b+1,Wh.x,Wh.y,Wh.z),b+=2)}h.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(r)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Cw(A){const r=[];A.isBone===!0&&r.push(A);for(let l=0;l<A.children.length;l++)r.push.apply(r,Cw(A.children[l]));return r}class kg extends Us{constructor(r,l,h){super(new jf(l,4,2),new pa({wireframe:!0,fog:!1,toneMapped:!1})),this.light=r,this.color=h,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const hE=new fe,Xy=new xn,Mw=new xn;class dE extends zi{constructor(r,l,h){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=h,this.type="HemisphereLightHelper";const f=new Xc(l);f.rotateY(.5*Math.PI),this.material=new pa({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const v=f.getAttribute("position"),b=new Float32Array(3*v.count);f.setAttribute("color",new tr(b,3)),this.add(new Us(f,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const r=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const l=r.geometry.getAttribute("color");Xy.copy(this.light.color),Mw.copy(this.light.groundColor);for(let h=0,f=l.count;h<f;h++){const v=h<f/2?Xy:Mw;l.setXYZ(h,v.r,v.g,v.b)}l.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),r.lookAt(hE.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Ni extends qc{constructor(r=10,l=10,h=4473924,f=8947848){h=new xn(h),f=new xn(f);const v=l/2,b=r/l,E=r/2,D=[],P=[];for(let F=0,N=0,z=-E;F<=l;F++,z+=b){D.push(-E,0,z,E,0,z),D.push(z,0,-E,z,0,E);const G=F===v?h:f;G.toArray(P,N),N+=3,G.toArray(P,N),N+=3,G.toArray(P,N),N+=3,G.toArray(P,N),N+=3}const O=new Y;O.setAttribute("position",new Pn(D,3)),O.setAttribute("color",new Pn(P,3)),super(O,new Xs({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class us extends qc{constructor(r=10,l=16,h=8,f=64,v=4473924,b=8947848){v=new xn(v),b=new xn(b);const E=[],D=[];if(l>1)for(let O=0;O<l;O++){const F=O/l*(2*Math.PI),N=Math.sin(F)*r,z=Math.cos(F)*r;E.push(0,0,0),E.push(N,0,z);const G=1&O?v:b;D.push(G.r,G.g,G.b),D.push(G.r,G.g,G.b)}for(let O=0;O<h;O++){const F=1&O?v:b,N=r-r/h*O;for(let z=0;z<f;z++){let G=z/f*(2*Math.PI),W=Math.sin(G)*N,Q=Math.cos(G)*N;E.push(W,0,Q),D.push(F.r,F.g,F.b),G=(z+1)/f*(2*Math.PI),W=Math.sin(G)*N,Q=Math.cos(G)*N,E.push(W,0,Q),D.push(F.r,F.g,F.b)}}const P=new Y;P.setAttribute("position",new Pn(E,3)),P.setAttribute("color",new Pn(D,3)),super(P,new Xs({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Qo=new fe,P_=new fe,Tw=new fe;class pE extends zi{constructor(r,l,h){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=h,this.type="DirectionalLightHelper",l===void 0&&(l=1);let f=new Y;f.setAttribute("position",new Pn([-l,l,0,l,l,0,l,-l,0,-l,-l,0,-l,l,0],3));const v=new Xs({fog:!1,toneMapped:!1});this.lightPlane=new Dh(f,v),this.add(this.lightPlane),f=new Y,f.setAttribute("position",new Pn([0,0,0,0,0,1],3)),this.targetLine=new Dh(f,v),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Qo.setFromMatrixPosition(this.light.matrixWorld),P_.setFromMatrixPosition(this.light.target.matrixWorld),Tw.subVectors(P_,Qo),this.lightPlane.lookAt(P_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(P_),this.targetLine.scale.z=Tw.length()}}const R_=new fe,hs=new Lm;class fE extends qc{constructor(r){const l=new Y,h=new Xs({color:16777215,vertexColors:!0,toneMapped:!1}),f=[],v=[],b={};function E(G,W){D(G),D(W)}function D(G){f.push(0,0,0),v.push(0,0,0),b[G]===void 0&&(b[G]=[]),b[G].push(f.length/3-1)}E("n1","n2"),E("n2","n4"),E("n4","n3"),E("n3","n1"),E("f1","f2"),E("f2","f4"),E("f4","f3"),E("f3","f1"),E("n1","f1"),E("n2","f2"),E("n3","f3"),E("n4","f4"),E("p","n1"),E("p","n2"),E("p","n3"),E("p","n4"),E("u1","u2"),E("u2","u3"),E("u3","u1"),E("c","t"),E("p","c"),E("cn1","cn2"),E("cn3","cn4"),E("cf1","cf2"),E("cf3","cf4"),l.setAttribute("position",new Pn(f,3)),l.setAttribute("color",new Pn(v,3)),super(l,h),this.type="CameraHelper",this.camera=r,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=b,this.update();const P=new xn(16755200),O=new xn(16711680),F=new xn(43775),N=new xn(16777215),z=new xn(3355443);this.setColors(P,O,F,N,z)}setColors(r,l,h,f,v){const b=this.geometry.getAttribute("color");b.setXYZ(0,r.r,r.g,r.b),b.setXYZ(1,r.r,r.g,r.b),b.setXYZ(2,r.r,r.g,r.b),b.setXYZ(3,r.r,r.g,r.b),b.setXYZ(4,r.r,r.g,r.b),b.setXYZ(5,r.r,r.g,r.b),b.setXYZ(6,r.r,r.g,r.b),b.setXYZ(7,r.r,r.g,r.b),b.setXYZ(8,r.r,r.g,r.b),b.setXYZ(9,r.r,r.g,r.b),b.setXYZ(10,r.r,r.g,r.b),b.setXYZ(11,r.r,r.g,r.b),b.setXYZ(12,r.r,r.g,r.b),b.setXYZ(13,r.r,r.g,r.b),b.setXYZ(14,r.r,r.g,r.b),b.setXYZ(15,r.r,r.g,r.b),b.setXYZ(16,r.r,r.g,r.b),b.setXYZ(17,r.r,r.g,r.b),b.setXYZ(18,r.r,r.g,r.b),b.setXYZ(19,r.r,r.g,r.b),b.setXYZ(20,r.r,r.g,r.b),b.setXYZ(21,r.r,r.g,r.b),b.setXYZ(22,r.r,r.g,r.b),b.setXYZ(23,r.r,r.g,r.b),b.setXYZ(24,l.r,l.g,l.b),b.setXYZ(25,l.r,l.g,l.b),b.setXYZ(26,l.r,l.g,l.b),b.setXYZ(27,l.r,l.g,l.b),b.setXYZ(28,l.r,l.g,l.b),b.setXYZ(29,l.r,l.g,l.b),b.setXYZ(30,l.r,l.g,l.b),b.setXYZ(31,l.r,l.g,l.b),b.setXYZ(32,h.r,h.g,h.b),b.setXYZ(33,h.r,h.g,h.b),b.setXYZ(34,h.r,h.g,h.b),b.setXYZ(35,h.r,h.g,h.b),b.setXYZ(36,h.r,h.g,h.b),b.setXYZ(37,h.r,h.g,h.b),b.setXYZ(38,f.r,f.g,f.b),b.setXYZ(39,f.r,f.g,f.b),b.setXYZ(40,v.r,v.g,v.b),b.setXYZ(41,v.r,v.g,v.b),b.setXYZ(42,v.r,v.g,v.b),b.setXYZ(43,v.r,v.g,v.b),b.setXYZ(44,v.r,v.g,v.b),b.setXYZ(45,v.r,v.g,v.b),b.setXYZ(46,v.r,v.g,v.b),b.setXYZ(47,v.r,v.g,v.b),b.setXYZ(48,v.r,v.g,v.b),b.setXYZ(49,v.r,v.g,v.b),b.needsUpdate=!0}update(){const r=this.geometry,l=this.pointMap;hs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ds("c",l,r,hs,0,0,-1),ds("t",l,r,hs,0,0,1),ds("n1",l,r,hs,-1,-1,-1),ds("n2",l,r,hs,1,-1,-1),ds("n3",l,r,hs,-1,1,-1),ds("n4",l,r,hs,1,1,-1),ds("f1",l,r,hs,-1,-1,1),ds("f2",l,r,hs,1,-1,1),ds("f3",l,r,hs,-1,1,1),ds("f4",l,r,hs,1,1,1),ds("u1",l,r,hs,.7,1.1,-1),ds("u2",l,r,hs,-.7,1.1,-1),ds("u3",l,r,hs,0,2,-1),ds("cf1",l,r,hs,-1,0,1),ds("cf2",l,r,hs,1,0,1),ds("cf3",l,r,hs,0,-1,1),ds("cf4",l,r,hs,0,1,1),ds("cn1",l,r,hs,-1,0,-1),ds("cn2",l,r,hs,1,0,-1),ds("cn3",l,r,hs,0,-1,-1),ds("cn4",l,r,hs,0,1,-1),r.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ds(A,r,l,h,f,v,b){R_.set(f,v,b).unproject(h);const E=r[A];if(E!==void 0){const D=l.getAttribute("position");for(let P=0,O=E.length;P<O;P++)D.setXYZ(E[P],R_.x,R_.y,R_.z)}}const Ug=new bo;class Iw extends qc{constructor(r,l=16776960){const h=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),f=new Float32Array(24),v=new Y;v.setIndex(new tr(h,1)),v.setAttribute("position",new tr(f,3)),super(v,new Xs({color:l,toneMapped:!1})),this.object=r,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(r){if(r!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Ug.setFromObject(this.object),Ug.isEmpty())return;const l=Ug.min,h=Ug.max,f=this.geometry.attributes.position,v=f.array;v[0]=h.x,v[1]=h.y,v[2]=h.z,v[3]=l.x,v[4]=h.y,v[5]=h.z,v[6]=l.x,v[7]=l.y,v[8]=h.z,v[9]=h.x,v[10]=l.y,v[11]=h.z,v[12]=h.x,v[13]=h.y,v[14]=l.z,v[15]=l.x,v[16]=h.y,v[17]=l.z,v[18]=l.x,v[19]=l.y,v[20]=l.z,v[21]=h.x,v[22]=l.y,v[23]=l.z,f.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(r){return this.object=r,this.update(),this}copy(r,l){return super.copy(r,l),this.object=r.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class mE extends qc{constructor(r,l=16776960){const h=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),f=new Y;f.setIndex(new tr(h,1)),f.setAttribute("position",new Pn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(f,new Xs({color:l,toneMapped:!1})),this.box=r,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(r){const l=this.box;l.isEmpty()||(l.getCenter(this.position),l.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(r))}dispose(){this.geometry.dispose(),this.material.dispose()}}class gE extends Dh{constructor(r,l=1,h=16776960){const f=h,v=new Y;v.setAttribute("position",new Pn([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),v.computeBoundingSphere(),super(v,new Xs({color:f,toneMapped:!1})),this.type="PlaneHelper",this.plane=r,this.size=l;const b=new Y;b.setAttribute("position",new Pn([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),b.computeBoundingSphere(),this.add(new Us(b,new pa({color:f,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(r){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(r)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Ng=new fe;let Qf,qh;class Pw extends zi{constructor(r=new fe(0,0,1),l=new fe(0,0,0),h=1,f=16776960,v=.2*h,b=.2*v){super(),this.type="ArrowHelper",Qf===void 0&&(Qf=new Y,Qf.setAttribute("position",new Pn([0,0,0,0,1,0],3)),qh=new Lh(0,.5,1,5,1),qh.translate(0,-.5,0)),this.position.copy(l),this.line=new Dh(Qf,new Xs({color:f,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Us(qh,new pa({color:f,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(h,v,b)}setDirection(r){if(r.y>.99999)this.quaternion.set(0,0,0,1);else if(r.y<-.99999)this.quaternion.set(1,0,0,0);else{Ng.set(r.z,0,-r.x).normalize();const l=Math.acos(r.y);this.quaternion.setFromAxisAngle(Ng,l)}}setLength(r,l=.2*r,h=.2*l){this.line.scale.set(1,Math.max(1e-4,r-l),1),this.line.updateMatrix(),this.cone.scale.set(h,l,h),this.cone.position.y=r,this.cone.updateMatrix()}setColor(r){this.line.material.color.set(r),this.cone.material.color.set(r)}copy(r){return super.copy(r,!1),this.line.copy(r.line),this.cone.copy(r.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Rw extends qc{constructor(r=1){const l=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],h=new Y;h.setAttribute("position",new Pn(l,3)),h.setAttribute("color",new Pn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(h,new Xs({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(r,l,h){const f=new xn,v=this.geometry.attributes.color.array;return f.set(r),f.toArray(v,0),f.toArray(v,3),f.set(l),f.toArray(v,6),f.toArray(v,9),f.set(h),f.toArray(v,12),f.toArray(v,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Yy{constructor(){this.type="ShapePath",this.color=new xn,this.subPaths=[],this.currentPath=null}moveTo(r,l){return this.currentPath=new fg,this.subPaths.push(this.currentPath),this.currentPath.moveTo(r,l),this}lineTo(r,l){return this.currentPath.lineTo(r,l),this}quadraticCurveTo(r,l,h,f){return this.currentPath.quadraticCurveTo(r,l,h,f),this}bezierCurveTo(r,l,h,f,v,b){return this.currentPath.bezierCurveTo(r,l,h,f,v,b),this}splineThru(r){return this.currentPath.splineThru(r),this}toShapes(r){function l(Q,q){const K=q.length;let ne=!1;for(let be=K-1,ve=0;ve<K;be=ve++){let me=q[be],Pe=q[ve],tt=Pe.x-me.x,Oe=Pe.y-me.y;if(Math.abs(Oe)>Number.EPSILON){if(Oe<0&&(me=q[ve],tt=-tt,Pe=q[be],Oe=-Oe),Q.y<me.y||Q.y>Pe.y)continue;if(Q.y===me.y){if(Q.x===me.x)return!0}else{const pt=Oe*(Q.x-me.x)-tt*(Q.y-me.y);if(pt===0)return!0;if(pt<0)continue;ne=!ne}}else{if(Q.y!==me.y)continue;if(Pe.x<=Q.x&&Q.x<=me.x||me.x<=Q.x&&Q.x<=Pe.x)return!0}}return ne}const h=_a.isClockWise,f=this.subPaths;if(f.length===0)return[];let v,b,E;const D=[];if(f.length===1)return b=f[0],E=new kh,E.curves=b.curves,D.push(E),D;let P=!h(f[0].getPoints());P=r?!P:P;const O=[],F=[];let N,z,G=[],W=0;F[W]=void 0,G[W]=[];for(let Q=0,q=f.length;Q<q;Q++)b=f[Q],N=b.getPoints(),v=h(N),v=r?!v:v,v?(!P&&F[W]&&W++,F[W]={s:new kh,p:N},F[W].s.curves=b.curves,P&&W++,G[W]=[]):G[W].push({h:b,p:N[0]});if(!F[0])return function(Q){const q=[];for(let K=0,ne=Q.length;K<ne;K++){const be=Q[K],ve=new kh;ve.curves=be.curves,q.push(ve)}return q}(f);if(F.length>1){let Q=!1,q=0;for(let K=0,ne=F.length;K<ne;K++)O[K]=[];for(let K=0,ne=F.length;K<ne;K++){const be=G[K];for(let ve=0;ve<be.length;ve++){const me=be[ve];let Pe=!0;for(let tt=0;tt<F.length;tt++)l(me.p,F[tt].p)&&(K!==tt&&q++,Pe?(Pe=!1,O[tt].push(me)):Q=!0);Pe&&O[K].push(me)}}q>0&&Q===!1&&(G=O)}for(let Q=0,q=F.length;Q<q;Q++){E=F[Q].s,D.push(E),z=G[Q];for(let K=0,ne=z.length;K<ne;K++)E.holes.push(z[K].h)}return D}}class Dw extends wu{constructor(r,l,h,f,v,b){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(r,l,h,f,v,b)}}class Bw extends mg{constructor(r,l,h,f){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(r,l,h,f)}}class Ky extends up{constructor(r,l,h,f){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(r,l,h,f)}}class Wf extends Bf{constructor(r,l,h,f,v,b,E){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(r,l,h,f,v,b,E)}}class Jy extends Lh{constructor(r,l,h,f,v,b,E,D){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(r,l,h,f,v,b,E,D)}}class Zy extends Of{constructor(r,l){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(r,l)}}class D_ extends Ns{constructor(r,l){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(r,l)}}class Wa extends Ru{constructor(r,l){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(r,l)}}class zl extends Oh{constructor(r,l,h,f){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(r,l,h,f)}}class _p extends Xc{constructor(r,l){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(r,l)}}class Vl extends qd{constructor(r,l,h,f){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(r,l,h,f)}}class $y extends Pu{constructor(r,l,h,f){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(r,l,h,f)}}class yp extends xg{constructor(r,l,h,f,v,b){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(r,l,h,f,v,b)}}class B_ extends Ff{constructor(r,l){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(r,l)}}class qf extends jf{constructor(r,l,h,f,v,b,E){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(r,l,h,f,v,b,E)}}class eA extends Du{constructor(r,l){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(r,l)}}class Ow extends Fh{constructor(r,l,h,f,v){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(r,l,h,f,v)}}class Xf extends Ac{constructor(r,l,h,f,v,b){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(r,l,h,f,v,b)}}class tA extends Bu{constructor(r,l,h,f,v){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(r,l,h,f,v)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:qe}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=qe)},553:function(St,V,p){p.d(V,{_:function(){return Ke}});var qe=p(988);const Je=new WeakMap;class Ke extends qe.aNw{constructor(Xe){super(Xe),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Xe){return this.decoderPath=Xe,this}setDecoderConfig(Xe){return this.decoderConfig=Xe,this}setWorkerLimit(Xe){return this.workerLimit=Xe,this}load(Xe,st,mt,bt){const at=new qe.hH6(this.manager);at.setPath(this.path),at.setResponseType("arraybuffer"),at.setRequestHeader(this.requestHeader),at.setWithCredentials(this.withCredentials),at.load(Xe,Ie=>{this.parse(Ie,st,bt)},mt,bt)}parse(Xe,st,mt){this.decodeDracoFile(Xe,st,null,null,qe.KI_).catch(mt)}decodeDracoFile(Xe,st,mt,bt,at=qe.GUF){const Ie={attributeIDs:mt||this.defaultAttributeIDs,attributeTypes:bt||this.defaultAttributeTypes,useUniqueIDs:!!mt,vertexColorSpace:at};return this.decodeGeometry(Xe,Ie).then(st)}decodeGeometry(Xe,st){const mt=JSON.stringify(st);if(Je.has(Xe)){const Ce=Je.get(Xe);if(Ce.key===mt)return Ce.promise;if(Xe.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let bt;const at=this.workerNextTaskID++,Ie=Xe.byteLength,et=this._getWorker(at,Ie).then(Ce=>(bt=Ce,new Promise((ht,Ze)=>{bt._callbacks[at]={resolve:ht,reject:Ze},bt.postMessage({type:"decode",id:at,taskConfig:st,buffer:Xe},[Xe])}))).then(Ce=>this._createGeometry(Ce.geometry));return et.catch(()=>!0).then(()=>{bt&&at&&this._releaseTask(bt,at)}),Je.set(Xe,{key:mt,promise:et}),et}_createGeometry(Xe){const st=new qe.u9r;Xe.index&&st.setIndex(new qe.TlE(Xe.index.array,1));for(let mt=0;mt<Xe.attributes.length;mt++){const bt=Xe.attributes[mt],at=bt.name,Ie=bt.array,et=bt.itemSize,Ce=new qe.TlE(Ie,et);at==="color"&&this._assignVertexColorSpace(Ce,bt.vertexColorSpace),st.setAttribute(at,Ce)}return st}_assignVertexColorSpace(Xe,st){if(st!==qe.KI_)return;const mt=new qe.Ilk;for(let bt=0,at=Xe.count;bt<at;bt++)mt.fromBufferAttribute(Xe,bt).convertSRGBToLinear(),Xe.setXYZ(bt,mt.r,mt.g,mt.b)}_loadLibrary(Xe,st){const mt=new qe.hH6(this.manager);return mt.setPath(this.decoderPath),mt.setResponseType(st),mt.setWithCredentials(this.withCredentials),new Promise((bt,at)=>{mt.load(Xe,bt,void 0,at)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Xe=typeof WebAssembly!="object"||this.decoderConfig.type==="js",st=[];return Xe?st.push(this._loadLibrary("draco_decoder.js","text")):(st.push(this._loadLibrary("draco_wasm_wrapper.js","text")),st.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(st).then(mt=>{const bt=mt[0];Xe||(this.decoderConfig.wasmBinary=mt[1]);const at=He,Ie=["/* draco decoder */",bt,"","/* worker */",at.substring(at.indexOf("{")+1,at.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([Ie]))}),this.decoderPending}_getWorker(Xe,st){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const bt=new Worker(this.workerSourceURL);bt._callbacks={},bt._taskCosts={},bt._taskLoad=0,bt.postMessage({type:"init",decoderConfig:this.decoderConfig}),bt.onmessage=function(at){const Ie=at.data;switch(Ie.type){case"decode":bt._callbacks[Ie.id].resolve(Ie);break;case"error":bt._callbacks[Ie.id].reject(Ie);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+Ie.type+'"')}},this.workerPool.push(bt)}else this.workerPool.sort(function(bt,at){return bt._taskLoad>at._taskLoad?-1:1});const mt=this.workerPool[this.workerPool.length-1];return mt._taskCosts[Xe]=st,mt._taskLoad+=st,mt})}_releaseTask(Xe,st){Xe._taskLoad-=Xe._taskCosts[st],delete Xe._callbacks[st],delete Xe._taskCosts[st]}debug(){console.log("Task load: ",this.workerPool.map(Xe=>Xe._taskLoad))}dispose(){for(let Xe=0;Xe<this.workerPool.length;++Xe)this.workerPool[Xe].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const He=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(St){var V=__webpackgi_module_cache__[St];if(V!==void 0)return V.exports;var p=__webpackgi_module_cache__[St]={id:St,exports:{}};return __webpackgi_modules__[St].call(p.exports,p,p.exports,__webpackgi_require__),p.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(St){var V=St&&St.__esModule?function(){return St.default}:function(){return St};return __webpackgi_require__.d(V,{a:V}),V},getProto=Object.getPrototypeOf?function(St){return Object.getPrototypeOf(St)}:function(St){return St.__proto__},__webpackgi_require__.t=function(St,V){if(1&V&&(St=this(St)),8&V||typeof St=="object"&&St&&(4&V&&St.__esModule||16&V&&typeof St.then=="function"))return St;var p=Object.create(null);__webpackgi_require__.r(p);var qe={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var Je=2&V&&St;typeof Je=="object"&&!~leafPrototypes.indexOf(Je);Je=getProto(Je))Object.getOwnPropertyNames(Je).forEach(function(Ke){qe[Ke]=function(){return St[Ke]}});return qe.default=function(){return St},__webpackgi_require__.d(p,qe),p},__webpackgi_require__.d=function(St,V){for(var p in V)__webpackgi_require__.o(V,p)&&!__webpackgi_require__.o(St,p)&&Object.defineProperty(St,p,{enumerable:!0,get:V[p]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(St){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(V,p){return __webpackgi_require__.f[p](St,V),V},[]))},__webpackgi_require__.u=function(St){return St+".mjs"},__webpackgi_require__.o=function(St,V){return Object.prototype.hasOwnProperty.call(St,V)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(St,V,p,qe){if(inProgress[St])inProgress[St].push(V);else{var Je,Ke;if(p!==void 0)for(var He=document.getElementsByTagName("script"),ft=0;ft<He.length;ft++){var Xe=He[ft];if(Xe.getAttribute("src")==St||Xe.getAttribute("data-webpack")==dataWebpackPrefix+p){Je=Xe;break}}Je||(Ke=!0,(Je=document.createElement("script")).type="module",Je.charset="utf-8",Je.timeout=120,__webpackgi_require__.nc&&Je.setAttribute("nonce",__webpackgi_require__.nc),Je.setAttribute("data-webpack",dataWebpackPrefix+p),Je.src=St),inProgress[St]=[V];var st=function(bt,at){Je.onerror=Je.onload=null,clearTimeout(mt);var Ie=inProgress[St];if(delete inProgress[St],Je.parentNode&&Je.parentNode.removeChild(Je),Ie&&Ie.forEach(function(et){return et(at)}),bt)return bt(at)},mt=setTimeout(st.bind(null,void 0,{type:"timeout",target:Je}),12e4);Je.onerror=st.bind(null,Je.onerror),Je.onload=st.bind(null,Je.onload),Ke&&document.head.appendChild(Je)}},__webpackgi_require__.r=function(St){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(St,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(St,"__esModule",{value:!0})},function(){var St;if(typeof import.meta.url=="string"&&(St=import.meta.url),!St)throw new Error("Automatic publicPath is not supported in this browser");St=St.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=St+"../../"}(),function(){var St={698:0};__webpackgi_require__.f.j=function(qe,Je){var Ke=__webpackgi_require__.o(St,qe)?St[qe]:void 0;if(Ke!==0)if(Ke)Je.push(Ke[2]);else{var He=new Promise(function(st,mt){Ke=St[qe]=[st,mt]});Je.push(Ke[2]=He);var ft=__webpackgi_require__.p+__webpackgi_require__.u(qe),Xe=new Error;__webpackgi_require__.l(ft,function(st){if(__webpackgi_require__.o(St,qe)&&((Ke=St[qe])!==0&&(St[qe]=void 0),Ke)){var mt=st&&(st.type==="load"?"missing":st.type),bt=st&&st.target&&st.target.src;Xe.message="Loading chunk "+qe+` failed.
(`+mt+": "+bt+")",Xe.name="ChunkLoadError",Xe.type=mt,Xe.request=bt,Ke[1](Xe)}},"chunk-"+qe,qe)}};var V=function(qe,Je){var Ke,He,ft=Je[0],Xe=Je[1],st=Je[2],mt=0;if(ft.some(function(bt){return St[bt]!==0})){for(Ke in Xe)__webpackgi_require__.o(Xe,Ke)&&(__webpackgi_require__.m[Ke]=Xe[Ke]);st&&st(__webpackgi_require__)}for(qe&&qe(Je);mt<ft.length;mt++)He=ft[mt],__webpackgi_require__.o(St,He)&&St[He]&&St[He][0](),St[He]=0},p=self.webpackChunkwebgi=self.webpackChunkwebgi||[];p.forEach(V.bind(null,0)),p.push=V.bind(null,p.push.bind(p))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){var St;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return F_},LY2:function(){return p.LY2},GYo:function(){return s1},GPz:function(){return Bx},HRj:function(){return Cl},li4:function(){return yT},FO5:function(){return Sp},Nlh:function(){return AT},Mp4:function(){return Bc},QvI:function(){return En},PrA:function(){return _l},JHp:function(){return U0},bGH:function(){return p.bGH},NDo:function(){return p.NDo},gSk:function(){return p.gSk},WMw:function(){return p.WMw},OTo:function(){return p.OTo},Se2:function(){return p.Se2},cum:function(){return p.cum},Mig:function(){return p.Mig},B$7:function(){return Ud},i_9:function(){return p.i_9},bBp:function(){return p.bBp},m7l:function(){return p.m7l},sYA:function(){return p.sYA},Xcj:function(){return p.Xcj},mzJ:function(){return p.mzJ},ZZA:function(){return p.ZZA},$Ph:function(){return va},T__:function(){return p.T__},HkE:function(){return p.HkE},tGC:function(){return p.tGC},g1S:function(){return qC},I$C:function(){return nm},QIH:function(){return B0},_JE:function(){return Gw},SwW:function(){return fA},ksm:function(){return Qt},jl_:function(){return kv},b7R:function(){return R0},BDV:function(){return Bm},Ea_:function(){return rr},qff:function(){return kv},tmC:function(){return xn},BON:function(){return Uv},P40:function(){return Om},wLL:function(){return mf},iHO:function(){return I0},BbS:function(){return p.BbS},kqm:function(){return p.kqm},Hmr:function(){return p.Hmr},SJI:function(){return p.SJI},mTL:function(){return p.mTL},y8_:function(){return p.y8_},_Li:function(){return p._Li},w7U:function(){return j0},g56:function(){return Ur},bj3:function(){return th},z81:function(){return p.z81},_MY:function(){return p._MY},L7J:function(){return JS},yEv:function(){return WP},dFZ:function(){return za},N$j:function(){return p.N$j},_YM:function(){return p._YM},TUj:function(){return p.TUj},ZzF:function(){return p.ZzF},qzb:function(){return Ie},GQ:function(){return p.GQ},nvb:function(){return p.nvb},DvJ:function(){return p.DvJ},fQA:function(){return p.fQA},cPz:function(){return H0},TlE:function(){return p.TlE},u9r:function(){return p.u9r},s4_:function(){return p.s4_},T95:function(){return p.T95},F5w:function(){return LA},NlP:function(){return WA},$8Z:function(){return Cp},YYN:function(){return ad},CtF:function(){return p.CtF},V1s:function(){return p.V1s},jOv:function(){return Ds},Rki:function(){return p.Rki},pzV:function(){return ub},itZ:function(){return Ns},MMq:function(){return fd},qKx:function(){return lr},Hmi:function(){return yd},X4S:function(){return DA},vlJ:function(){return L1},nPO:function(){return qu},zcQ:function(){return Cf},GH1:function(){return Ul},ROQ:function(){return p.ROQ},YN5:function(){return p.YN5},BVQ:function(){return p.BVQ},YT8:function(){return p.YT8},_DE:function(){return Nm},YGz:function(){return p.YGz},trn:function(){return p.trn},zf8:function(){return p.zf8},uWy:function(){return p.uWy},wYQ:function(){return jl},SUY:function(){return p.SUY},Ilk:function(){return p.Ilk},R2R:function(){return p.R2R},epp:function(){return p.epp},xmJ:function(){return Fa},GD$:function(){return Na},Z_g:function(){return p.Z_g},EB7:function(){return p.EB7},DqL:function(){return p.DqL},_3:function(){return p._3},b_z:function(){return p.b_z},OCn:function(){return Pc},N_j:function(){return xk},hNv:function(){return TC},_am:function(){return p._am},kB7:function(){return Mu},fY$:function(){return p.fY$},vxC:function(){return p.vxC},BtG:function(){return p.BtG},cBK:function(){return p.cBK},g8_:function(){return p.g8_},AXT:function(){return p.AXT},yj7:function(){return p.yj7},dYG:function(){return p.dYG},tm_:function(){return p.tm_},S2y:function(){return p.S2y},B02:function(){return p.B02},PeU:function(){return p.PeU},Hyl:function(){return p.Hyl},Wqd:function(){return p.Wqd},c0Q:function(){return dI},re0:function(){return pI},Xaj:function(){return p.Xaj},DUb:function(){return Go},dZ3:function(){return p.dZ3},m_w:function(){return p.m_w},fHI:function(){return p.fHI},LBq:function(){return p.LBq},Qww:function(){return of.Q},CGV:function(){return V.Damper},JUT:function(){return p.JUT},p3g:function(){return p.p3g},IEO:function(){return p.IEO},yxD:function(){return p.yxD},CUS:function(){return LC},A5E:function(){return p.A5E},zqG:function(){return Uu},PfX:function(){return Y},Q1o:function(){return Pn},jfJ:function(){return p.jfJ},T_J:function(){return p.T_J},tEQ:function(){return p.tEQ},gb4:function(){return da},qkB:function(){return p.qkB},cvk:function(){return xh},HWo:function(){return Eu},brP:function(){return p.brP},$YQ:function(){return p.$YQ},X8d:function(){return qA},Zdt:function(){return US},yNB:function(){return ki},h7x:function(){return br},Ox3:function(){return p.Ox3},qtn:function(){return ji},cBI:function(){return p.cBI},cU9:function(){return p.cU9},ntt:function(){return p.ntt},DT1:function(){return p.DT1},Kgo:function(){return p.Kgo},ehD:function(){return p.ehD},fhJ:function(){return O0},y1s:function(){return gc},fSK:function(){return p.fSK},Vdb:function(){return p.Vdb},l8J:function(){return p.l8J},dj0:function(){return p.dj0},QM0:function(){return p.QM0},n94:function(){return Kw},OIS:function(){return bp},q8b:function(){return yc},TOt:function(){return p.TOt},xaN:function(){return at},Ny0:function(){return p.Ny0},NeD:function(){return pS},Zof:function(){return ye},N1Y:function(){return _A},itK:function(){return Xd},eD:function(){return p.eD},jwo:function(){return p.jwo},dSO:function(){return p.dSO},Bf4:function(){return p.Bf4},USm:function(){return p.USm},pBf:function(){return p.pBf},eBg:function(){return pC},$Vf:function(){return p.$Vf},O7d:function(){return p.O7d},ksq:function(){return Ky},hFL:function(){return J_},gXf:function(){return U_},hH6:function(){return p.hH6},izP:function(){return XA},kpi:function(){return Qm},DwZ:function(){return Bo},kN3:function(){return jS},e62:function(){return p.e62},a$l:function(){return p.a$l},OM3:function(){return p.OM3},VzW:function(){return p.VzW},ybr:function(){return p.ybr},yo9:function(){return p.yo9},Dzq:function(){return Ha},zCA:function(){return To},$Bt:function(){return _c},Wzm:function(){return p.Wzm},Wl3:function(){return p.Wl3},iWj:function(){return p.iWj},DNz:function(){return Jr},m1M:function(){return Ii},ylh:function(){return p.ylh},v9Y:function(){return p.v9Y},LSk:function(){return p.LSk},LHE:function(){return sr},KE0:function(){return sS},KCF:function(){return dT},a4n:function(){return VE},NKC:function(){return Gh},jrv:function(){return bc},zIH:function(){return nf},Hfk:function(){return kd},png:function(){return Od},tAj:function(){return Ld},Eb_:function(){return no},SJj:function(){return zf},cF0:function(){return _r},BT2:function(){return wE},_8p:function(){return HC},V5Z:function(){return Kc},s5b:function(){return Cy},BHZ:function(){return ls},hkn:function(){return au},GFY:function(){return ea},hZr:function(){return ZA},w$m:function(){return p.w$m},ksN:function(){return p.ksN},j4z:function(){return p.j4z},OAl:function(){return p.OAl},VLJ:function(){return p.VLJ},C73:function(){return xa},ZAu:function(){return p.ZAu},ibP:function(){return uf},lth:function(){return A_},_fI:function(){return Na},hUN:function(){return Lr},cLu:function(){return p.cLu},vmT:function(){return p.vmT},Qpg:function(){return p.Qpg},So8:function(){return p.So8},eOv:function(){return ab},Wjw:function(){return p.Wjw},cJO:function(){return p.cJO},QRU:function(){return p.QRU},S3k:function(){return p.S3k},OPJ:function(){return bT},PpQ:function(){return p.PpQ},q_9:function(){return Br},ZRs:function(){return p.ZRs},oqc:function(){return p.oqc},T_x:function(){return ro},lb7:function(){return p.lb7},L5s:function(){return p.L5s},$TI:function(){return p.$TI},SPe:function(){return p.SPe},aVm:function(){return p.aVm},j87:function(){return p.j87},RNb:function(){return p.RNb},Kz5:function(){return p.Kz5},LYt:function(){return ps},vpT:function(){return p.vpT},kB5:function(){return p.kB5},_C8:function(){return p._C8},Syv:function(){return p.Syv},NMF:function(){return p.NMF},pIN:function(){return p.pIN},eMJ:function(){return p.eMJ},rN7:function(){return Pg},iUp:function(){return mp},GFd:function(){return kE},x5V:function(){return p.x5V},tUh:function(){return p.tUh},z8B:function(){return p.z8B},vcl:function(){return Ys},GZb:function(){return p.GZb},p7y:function(){return p.p7y},S9g:function(){return p.S9g},Zr5:function(){return p.Zr5},vCF:function(){return p.vCF},yt0:function(){return p.yt0},uXU:function(){return p.uXU},_kC:function(){return p._kC},lk7:function(){return p.lk7},USc:function(){return lb},x12:function(){return p.x12},w_R:function(){return LE},Zzh:function(){return p.Zzh},nls:function(){return p.nls},g_z:function(){return p.g_z},U7:function(){return p.U7},FT0:function(){return p.FT0},L1_:function(){return mA},blk:function(){return p.blk},YRm:function(){return Su},ejS:function(){return p.ejS},wUb:function(){return qw},zOz:function(){return Kd},rnI:function(){return p.rnI},wem:function(){return p.wem},lfu:function(){return p.lfu},FDw:function(){return p.FDw},lRj:function(){return p.lRj},D1R:function(){return p.D1R},qyh:function(){return p.qyh},GUF:function(){return p.GUF},EoG:function(){return p.EoG},aNw:function(){return p.aNw},Zp0:function(){return p.Zp0},lLk:function(){return p.lLk},NHT:function(){return wr},jAl:function(){return p.jAl},uEv:function(){return p.uEv},YKA:function(){return p.YKA},cRx:function(){return p.cRx},Y8D:function(){return p.Y8D},RsA:function(){return p.RsA},Y0m:function(){return hw},F5T:function(){return p.F5T},EDU:function(){return D_},z$Q:function(){return Vu},KA8:function(){return rs},ZqF:function(){return Gm},XUj:function(){return Gl},Me$:function(){return qo},u7G:function(){return p.u7G},PEk:function(){return bs},BG4:function(){return Zy},M8C:function(){return p.M8C},Vkp:function(){return p.Vkp},yGw:function(){return p.yGw},Sm8:function(){return p.Sm8},Kj0:function(){return p.Kj0},vBJ:function(){return p.vBJ},QfV:function(){return Sl},lRF:function(){return p.lRF},Lun:function(){return p.Lun},YBo:function(){return p.YBo},kaV:function(){return p.kaV},RSm:function(){return p.RSm},xoR:function(){return p.xoR},EJi:function(){return p.EJi},Wid:function(){return p.Wid},iuj:function(){return Hs},IKL:function(){return p.IKL},r_:function(){return p.r_},OoA:function(){return p.OoA},qhX:function(){return p.qhX},CRe:function(){return by},qPT:function(){return Fm},M5h:function(){return p.M5h},Ns1:function(){return p.Ns1},TyD:function(){return p.TyD},vZf:function(){return p.vZf},HTd:function(){return p.HTd},aH4:function(){return p.aH4},YLQ:function(){return p.YLQ},BVF:function(){return p.BVF},MyG:function(){return p.MyG},jFi:function(){return p.jFi},aCh:function(){return p.aCh},uL9:function(){return p.uL9},TNj:function(){return ba},IFH:function(){return p.IFH},bdR:function(){return p.bdR},RPs:function(){return Mh},kM_:function(){return np},M6v:function(){return p.M6v},RvT:function(){return p.RvT},dUE:function(){return p.dUE},oe_:function(){return ky},BuN:function(){return Nu},Tme:function(){return p.Tme},N9P:function(){return No},tfP:function(){return Mv},Gql:function(){return p.Gql},$XY:function(){return xs},O9d:function(){return wb},zEO:function(){return ta},qfx:function(){return Xu},PA7:function(){return p.PA7},REq:function(){return p.REq},pQR:function(){return p.pQR},ghN:function(){return p.ghN},Hy8:function(){return p.Hy8},Wpd:function(){return p.Wpd},LgZ:function(){return p.LgZ},iWC:function(){return p.iWC},mqn:function(){return ZL},SKe:function(){return Si},iKG:function(){return p.iKG},rCq:function(){return RA},_iA:function(){return p._iA},ntZ:function(){return p.ntZ},anP:function(){return p.anP},X2e:function(){return fT},oxT:function(){return Ho},FCo:function(){return nu},y$t:function(){return p.y$t},cPb:function(){return p.cPb},lmx:function(){return Ti},JOQ:function(){return p.JOQ},BKK:function(){return p.BKK},_12:function(){return p._12},tJx:function(){return p.tJx},mjX:function(){return Yr},cek:function(){return p.cek},qD0:function(){return fu},xG9:function(){return p.xG9},eqi:function(){return V.PointerDragHelper},wI8:function(){return Dp},Sgv:function(){return zS},woe:function(){return p.woe},UY4:function(){return p.UY4},aq0:function(){return p.aq0},ujx:function(){return p.ujx},Uol:function(){return p.Uol},JiH:function(){return am},VYz:function(){return p.VYz},B2H:function(){return yf},_Pm:function(){return Yd},EsW:function(){return oo},iUV:function(){return p.iUV},tf:function(){return p.tf},ZQ6:function(){return p.ZQ6},mXe:function(){return p.mXe},_fP:function(){return p._fP},iLg:function(){return p.iLg},zbs:function(){return p.zbs},ZTh:function(){return p.ZTh},HdW:function(){return p.HdW},UZH:function(){return p.UZH},mSO:function(){return p.mSO},wk1:function(){return p.wk1},E2K:function(){return p.E2K},FUD:function(){return p.FUD},pKu:function(){return p.pKu},GG6:function(){return p.GG6},Gih:function(){return p.Gih},iiP:function(){return p.iiP},SvJ:function(){return p.SvJ},ptH:function(){return p.ptH},jZA:function(){return p.jZA},y2t:function(){return p.y2t},gi4:function(){return p.gi4},Djp:function(){return p.Djp},BG$:function(){return p.BG$},NYV:function(){return p.NYV},xJs:function(){return p.xJs},bsb:function(){return p.bsb},ekQ:function(){return p.ekQ},CaW:function(){return p.CaW},eaV:function(){return p.eaV},BFQ:function(){return p.BFQ},v3W:function(){return p.v3W},ILR:function(){return p.ILR},G_r:function(){return p.G_r},N3F:function(){return ct},fto:function(){return p.fto},l0P:function(){return p.l0P},vCx:function(){return p.vCx},_AM:function(){return p._AM},wuA:function(){return p.wuA},av9:function(){return p.av9},CtA:function(){return p.CtA},fpq:function(){return ru},BvQ:function(){return Jm},FZJ:function(){return Th},FIo:function(){return p.FIo},zHn:function(){return p.zHn},iMs:function(){return p.iMs},T_f:function(){return p.T_f},hEm:function(){return p.hEm},D9w:function(){return p.D9w},sHH:function(){return hl},CdI:function(){return p.CdI},rkc:function(){return Rc},rpg:function(){return p.rpg},ce8:function(){return p.ce8},rOj:function(){return p.rOj},P6m:function(){return Hu},JA6:function(){return po},V4E:function(){return p.V4E},o8S:function(){return p.o8S},flB:function(){return is},lGU:function(){return p.lGU},vuL:function(){return p.vuL},KI_:function(){return p.KI_},iLN:function(){return Qc},X6w:function(){return Nl},rz_:function(){return Fl},jsw:function(){return qs},srG:function(){return Km},i6Z:function(){return Zm},vfv:function(){return bE},xsS:function(){return p.xsS},or:function(){return cb},EQj:function(){return ya},Rnn:function(){return VS},TyN:function(){return fm},ov0:function(){return G0},WdD:function(){return p.WdD},Vj0:function(){return p.Vj0},jyz:function(){return p.jyz},mTM:function(){return ic},Mn1:function(){return Yp},Hlq:function(){return Fr},Fi7:function(){return ho},Tn7:function(){return p.Tn7},bnF:function(){return p.bnF},HW6:function(){return p.HW6},oa8:function(){return p.oa8},T_1:function(){return p.T_1},zHJ:function(){return Xl},iDF:function(){return p.iDF},iAb:function(){return p.iAb},d4E:function(){return Zh},lBg:function(){return sb},JeJ:function(){return GP},FKY:function(){return V.SimpleEventDispatcher},zlZ:function(){return kC},vkg:function(){return Jn},brh:function(){return UC},kZK:function(){return Yl},puG:function(){return ob},OdW:function(){return p.OdW},_YX:function(){return p._YX},TUv:function(){return p.TUv},Hw6:function(){return p.Hw6},aLr:function(){return p.aLr},Aip:function(){return p.Aip},xo$:function(){return p.xo$},bIn:function(){return $L},$V:function(){return p.$V},lDi:function(){return p.lDi},gti:function(){return p.gti},PMe:function(){return p.PMe},iwP:function(){return yo},FvO:function(){return p.FvO},jyi:function(){return p.jyi},xeV:function(){return p.xeV},k74:function(){return p.k74},RlZ:function(){return p.RlZ},KhW:function(){return p.KhW},HgB:function(){return p.HgB},W2J:function(){return p.W2J},JWc:function(){return p.JWc},u37:function(){return p.u37},Z6B:function(){return p.Z6B},QZ1:function(){return p.QZ1},Ir4:function(){return p.Ir4},NwF:function(){return p.NwF},Wbm:function(){return p.Wbm},N4l:function(){return p.N4l},Jxm:function(){return ur},ej9:function(){return Jh},QmN:function(){return p.QmN},Y4W:function(){return V.TYPED_ARRAYS},IOt:function(){return p.IOt},NOD:function(){return zh},L5g:function(){return p.L5g},H$k:function(){return p.H$k},cuP:function(){return mo},xEZ:function(){return p.xEZ},dpR:function(){return p.dpR},wOD:function(){return Va},KNb:function(){return so},IiN:function(){return Um},Cne:function(){return p.Cne},XvJ:function(){return p.XvJ},XZw:function(){return p.XZw},FE5:function(){return p.FE5},Mck:function(){return Bp},lVp:function(){return Lb},CJI:function(){return p.CJI},z$h:function(){return p.z$h},UlW:function(){return p.UlW},WwZ:function(){return p.WwZ},zG7:function(){return xc},Lcc:function(){return p.Lcc},WXh:function(){return p.WXh},Vjr:function(){return hS},LuM:function(){return A0},LP5:function(){return hP},ub3:function(){return p.ub3},OV:function(){return gl},G_n:function(){return Jl},xfE:function(){return p.xfE},qlB:function(){return p.qlB},lCJ:function(){return p.lCJ},WTc:function(){return p.WTc},rAo:function(){return p.rAo},LZj:function(){return ga},xWb:function(){return p.xWb},gH0:function(){return p.gH0},rBU:function(){return p.rBU},rDY:function(){return p.rDY},ywz:function(){return p.ywz},wJv:function(){return p.wJv},JQ4:function(){return p.JQ4},k0A:function(){return p.k0A},irR:function(){return p.irR},LsT:function(){return p.LsT},q5h:function(){return wu},TKh:function(){return Us},tyg:function(){return Hd},Ro5:function(){return bu},CHp:function(){return sm},dwk:function(){return p.dwk},t0w:function(){return JA},M7$:function(){return m0},ML4:function(){return KA},FM8:function(){return p.FM8},Pa4:function(){return p.Pa4},Ltg:function(){return p.Ltg},yC1:function(){return p.yC1},lHq:function(){return hp},fO1:function(){return p.fO1},oMA:function(){return ol},JzW:function(){return St},QEt:function(){return Bu},IFZ:function(){return mm},b5g:function(){return p.b5g},Ywn:function(){return p.Ywn},GVz:function(){return p.GVz},oAp:function(){return p.oAp},kFz:function(){return p.kFz},dd2:function(){return p.dd2},CP7:function(){return p.CP7},fQK:function(){return p.fQK},Wd$:function(){return PC},t1_:function(){return uC},v27:function(){return V0},Uk6:function(){return p.Uk6},H7Z:function(){return z0},_sL:function(){return p._sL},czO:function(){return iu},Pnf:function(){return p.Pnf},c8b:function(){return p.c8b},_lf:function(){return p._lf},ad5:function(){return p.ad5},sZV:function(){return Vd},TfA:function(){return _h},sKX:function(){return Nv},UdM:function(){return rl},P0y:function(){return hf},L_r:function(){return p.L_r},zC5:function(){return V.absMax},Bve:function(){return jw},b5G:function(){return Vm},UeO:function(){return Or},qCx:function(){return IP},$nx:function(){return GE},Bk6:function(){return xm},EER:function(){return y_},y4l:function(){return Lc},P39:function(){return Sy},HI1:function(){return V.aesGcmDecrypt},ZYi:function(){return V.aesGcmEncrypt},wXW:function(){return nn},r5x:function(){return Ot},MSI:function(){return gn},EUu:function(){return ok},jtH:function(){return Nh},T0T:function(){return _a},gAb:function(){return k1},je_:function(){return gP},wBP:function(){return wg},LU2:function(){return sy},wQL:function(){return ak},Zs7:function(){return Lt},sMc:function(){return V.arrayBufferToBase64},x7s:function(){return It},Mnd:function(){return ck},A0_:function(){return uk},d73:function(){return q},HCD:function(){return Kt},YQ8:function(){return bd},RG9:function(){return fn},G2P:function(){return rp},XLf:function(){return op},CGN:function(){return sp},RGi:function(){return V.base64ToArrayBuffer},mvg:function(){return K},Hiy:function(){return Md},XMc:function(){return tn},N7M:function(){return ke},iv:function(){return Xt},n55:function(){return V.blobToDataURL},IaC:function(){return G},h9t:function(){return oy},yDW:function(){return qb},gJv:function(){return Rh},l$g:function(){return ST},vQi:function(){return aI},$MY:function(){return Cd},wJl:function(){return El},Z7Y:function(){return Ph},X7D:function(){return Wb},BnX:function(){return s_},uZ5:function(){return Xs},zVI:function(){return ve},Wz1:function(){return V.colorToDataUrl},DpF:function(){return _b},nNb:function(){return Mo},cqZ:function(){return Gc},pKN:function(){return Tx},CN8:function(){return tg},DdI:function(){return oS},rrX:function(){return Ix},uqj:function(){return ht},Z9P:function(){return Le},KlC:function(){return ip},KVn:function(){return je},oau:function(){return Ut},aw9:function(){return qi},Aap:function(){return ys},Dxg:function(){return V.copyProps},MjT:function(){return qr},F7Q:function(){return Qb},IFq:function(){return SC},IJl:function(){return i_},O5A:function(){return V.createCanvasElement},wCn:function(){return V.createDiv},gGT:function(){return iy},pEc:function(){return vT},Bi6:function(){return V.createImage},fi_:function(){return jg},TT:function(){return ai},q2Z:function(){return qL},NyK:function(){return Al},bgu:function(){return V.createScriptFromURL},kcS:function(){return V.createStyles},rRN:function(){return gS},ivY:function(){return V.css},_s1:function(){return bk},_HO:function(){return Me},tpL:function(){return Ne},DMK:function(){return kh},LjN:function(){return D0},iFs:function(){return fa},qTg:function(){return V.deepAccessObject},J4G:function(){return At},Zj8:function(){return rk},Wtl:function(){return Es},DmK:function(){return Vc},Htt:function(){return wP},Nv0:function(){return Be},tCp:function(){return Qe},Hx7:function(){return Di},imt:function(){return gs},US6:function(){return ci},vZs:function(){return Ef},TE$:function(){return hk},lmu:function(){return V.downloadBlob},SvO:function(){return V.downloadFile},YQY:function(){return Tu},mZN:function(){return ig},VvG:function(){return ry},omp:function(){return V.embedUrlRefs},utz:function(){return be},TFV:function(){return jv},hrz:function(){return V.escapeRegExp},H$s:function(){return Z},JKM:function(){return we},jZf:function(){return bC},RjL:function(){return T1},RRI:function(){return Xi},RUq:function(){return ET},_t4:function(){return Da},YHh:function(){return Ba},R8g:function(){return wt},f1L:function(){return V.getFileHandle},Bbl:function(){return V.getFilenameFromPath},V9r:function(){return V.getKeyByValue},a95:function(){return V.getNewFileHandle},PZ2:function(){return V.getOrCall},w7A:function(){return V.getPropertyDescriptor},N6S:function(){return $e},Uxp:function(){return Tt},tAz:function(){return Dt},R$F:function(){return Ft},N33:function(){return Ct},JFD:function(){return _t},gw2:function(){return sl},rfc:function(){return V.getTypedArray},wo6:function(){return V.getUrlQueryParam},V4T:function(){return Ht},H4P:function(){return V.glsl},NLp:function(){return pp},swA:function(){return vh},_Z3:function(){return tr},ivc:function(){return Mo},rZ1:function(){return Gc},CpZ:function(){return Wo},dyc:function(){return V.html},MxZ:function(){return V.htmlToCanvas},btp:function(){return V.htmlToPng},mXy:function(){return V.htmlToSvg},Ej0:function(){return ec},ep4:function(){return Qi},DQP:function(){return qp},VNr:function(){return Ki},V7q:function(){return V.imageBitmapToBase64},hiB:function(){return V.imageDataToCanvas},zEk:function(){return V.imageToCanvas},qfq:function(){return V.imageUrlToImageData},piB:function(){return V.includesAll},IIc:function(){return sk},rrF:function(){return Ss},naq:function(){return pa},zlD:function(){return Bt},sXR:function(){return gg},p5I:function(){return Nf},wps:function(){return U1},wuo:function(){return CC},GpE:function(){return V.isPropertyWritable},F4b:function(){return kf},NN$:function(){return Vh},t$v:function(){return Q},tdn:function(){return Xc},Y9t:function(){return xg},GEo:function(){return r_},GGm:function(){return V.longestCommonPrefix},DH3:function(){return An},uxM:function(){return V.makeColorSvg},zH3:function(){return V.makeColorSvgCircle},MLs:function(){return sc},xXG:function(){return In},YM4:function(){return __},B3r:function(){return wC},iAx:function(){return V.makeTextSvg},lDn:function(){return se},P1O:function(){return Ue},iib:function(){return pe},qf5:function(){return ce},n4s:function(){return Ze},fr:function(){return J},Z9s:function(){return $},oaQ:function(){return ng},CD7:function(){return Bh},Rc0:function(){return hg},iPG:function(){return Lf},TIc:function(){return V.mobileAndTabletCheck},xsC:function(){return xt},zOc:function(){return V.now},i8W:function(){return V.objectHasOwn},r46:function(){return qt},z2C:function(){return V.onChange},N4A:function(){return V.onChange2},hjq:function(){return V.onChange3},_X$:function(){return V.parseFileExtension},_yn:function(){return rc},Dyg:function(){return V.pathJoin},cUc:function(){return cu},zGw:function(){return up},Ctq:function(){return pt},$ch:function(){return dk},k5b:function(){return Pe},kZl:function(){return _n},OCg:function(){return de},Kd3:function(){return V.prettyScrollbar},YjH:function(){return Fu},Ui8:function(){return WC},YD2:function(){return rg},vi9:function(){return bP},ij3:function(){return Mt},pJq:function(){return V.readFile},YPW:function(){return tt},_tY:function(){return V.remoteWorkerURL},Bg1:function(){return KL},kon:function(){return V.replaceAll},M3g:function(){return Tf},F2z:function(){return W},pJF:function(){return xT},knz:function(){return p.knz},Ejo:function(){return V.safeSetProperty},BgY:function(){return _s},qCG:function(){return Ae},HD9:function(){return xi},Rgz:function(){return vr},fEB:function(){return Ji},Udc:function(){return Wp},ZQg:function(){return bl},ofC:function(){return Vt},yRy:function(){return V.setUrlQueryParam},_NL:function(){return Sk},LCA:function(){return Ra},Sy1:function(){return pP},Vs_:function(){return fP},j1w:function(){return $p},i8J:function(){return Ek},p7C:function(){return Sn},ZAS:function(){return jf},ipH:function(){return pk},$TF:function(){return EP},uZI:function(){return fk},VWG:function(){return Jy},pQ7:function(){return Ru},STw:function(){return Pf},jc8:function(){return ac},BL_:function(){return ne},S6:function(){return wk},T8U:function(){return dt},TD6:function(){return xe},akS:function(){return V.svgToCanvas},QKE:function(){return V.svgToPng},dKx:function(){return V.svgUrl},OvX:function(){return vP},doP:function(){return Ko},$jA:function(){return dr},T99:function(){return ar},LJS:function(){return Za},VsW:function(){return V.timeout},LZE:function(){return te},YMc:function(){return xP},aPg:function(){return ri},LFn:function(){return V.toTitleCase},VsX:function(){return ae},wey:function(){return z},MaE:function(){return Ai},s4x:function(){return Zo},FJA:function(){return Sr},vIA:function(){return Uo},Spv:function(){return Hn},w8l:function(){return sh},riG:function(){return jn},Kbh:function(){return nc},BFq:function(){return su},t8K:function(){return cn},Q7n:function(){return Gt},KGF:function(){return As},e5:function(){return Fe},Rik:function(){return Qd},GZo:function(){return Ws},Bds:function(){return pf},HTu:function(){return ff},cTq:function(){return V.uploadFile},X_Y:function(){return Oc},dA8:function(){return lu},NSm:function(){return xd},bwS:function(){return Oe},Lks:function(){return mk},Rvq:function(){return AP},P4F:function(){return V.verifyPermission},Pd0:function(){return ra},Pjo:function(){return me},Tum:function(){return sa},dRH:function(){return oa},RX0:function(){return ka},reQ:function(){return gk},cWm:function(){return dn},NC9:function(){return V.writeFile},$Re:function(){return Gd},Xo9:function(){return yh},LNO:function(){return P0},iZP:function(){return df}}),function(s){s[s.Error=-2]="Error",s[s.Destroyed=-1]="Destroyed",s[s.None=0]="None",s[s.Running=1]="Running",s[s.Paused=2]="Paused"}(St||(St={}));var V=__webpackgi_require__(8),p=__webpackgi_require__(988);const qe={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Je{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Ke=new p.iKG(-1,1,1,-1,0,1),He=new p.u9r;He.setAttribute("position",new p.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),He.setAttribute("uv",new p.a$l([0,2,0,0,2,0],2));class ft{constructor(e){this._mesh=new p.Kj0(He,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Ke)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Xe extends Je{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof p.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=p.rDY.clone(e.uniforms),this.material=new p.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new ft(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&n&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class st extends Je{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),o=e.state;let a,c;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(a=0,c=1):(a=1,c=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),o.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),o.buffers.stencil.setClear(c),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(i.EQUAL,1,4294967295),o.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),o.buffers.stencil.setLocked(!0)}}class mt extends Je{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class bt{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new p.FM8);this._width=n.width,this._height=n.height,(t=new p.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Xe(qe),this.clock=new p.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,o=this.passes.length;i<o;i++){const a=this.passes[i];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){const c=this.renderer.getContext(),u=this.renderer.state.buffers.stencil;u.setFunc(c.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),u.setFunc(c.EQUAL,1,4294967295)}this.swapBuffers()}st!==void 0&&(a instanceof st?n=!0:a instanceof mt&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new p.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class at extends bt{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}class Ie extends p.ZzF{expandByObject(e,t=!1,n=!1,i){var a;if(((a=e.userData)==null?void 0:a.bboxVisible)===!1)return this;if(!e.visible&&n)return this;if(i&&i(e))return this;if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),et.copy(e.boundingBox),et.applyMatrix4(e.matrixWorld),this.union(et);else{const c=e.geometry;if(c!==void 0)if(t&&c.attributes!=null&&c.attributes.position!==void 0){const u=c.attributes.position;for(let d=0,m=u.count;d<m;d++)Ce.fromBufferAttribute(u,d).applyMatrix4(e.matrixWorld),this.expandByPoint(Ce)}else c.boundingBox===null&&c.computeBoundingBox(),et.copy(c.boundingBox),et.applyMatrix4(e.matrixWorld),this.union(et)}const o=e.children;for(let c=0,u=o.length;c<u;c++)this.expandByObject(o[c],t,n,i);return this}expandByObjects(e,t=!1,n=!1,i){for(let o=0,a=e.length;o<a;o++)this.expandByObject(e[o],t,n,i);return this}getPoints(){return[new p.Pa4(this.min.x,this.min.y,this.min.z),new p.Pa4(this.min.x,this.min.y,this.max.z),new p.Pa4(this.min.x,this.max.y,this.min.z),new p.Pa4(this.min.x,this.max.y,this.max.z),new p.Pa4(this.max.x,this.min.y,this.min.z),new p.Pa4(this.max.x,this.min.y,this.max.z),new p.Pa4(this.max.x,this.max.y,this.min.z),new p.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),n=new p.TUj;for(const i of t){const o=i.project(e);n.min.min(o),n.max.max(o)}return n}}const et=new Ie,Ce=new p.Pa4;function ht(s,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!s.hasAttribute("position")||!s.hasAttribute("normal")||!s.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function n(a){if(a.normalized||a.isInterleavedBufferAttribute){const c=new Float32Array(a.count*a.itemSize);for(let u=0,d=0;u<a.count;u++)c[d++]=a.getX(u),c[d++]=a.getY(u),a.itemSize>2&&(c[d++]=a.getZ(u));return c}return a.array instanceof Float32Array?a.array:new Float32Array(a.array)}const i=s.index?s.toNonIndexed():s,o=e.generateTangents(n(i.attributes.position),n(i.attributes.normal),n(i.attributes.uv));if(t)for(let a=3;a<o.length;a+=4)o[a]*=-1;return i.setAttribute("tangent",new p.TlE(o,4)),s!==i&&s.copy(i),s}function Ze(s,e=!1){const t=s[0].index!==null,n=new Set(Object.keys(s[0].attributes)),i=new Set(Object.keys(s[0].morphAttributes)),o={},a={},c=s[0].morphTargetsRelative,u=new p.u9r;let d=0;for(let m=0;m<s.length;++m){const g=s[m];let _=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+m+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const w in g.attributes){if(!n.has(w))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+m+'. All geometries must have compatible attributes; make sure "'+w+'" attribute exists among all geometries, or in none of them.'),null;o[w]===void 0&&(o[w]=[]),o[w].push(g.attributes[w]),_++}if(_!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+m+". Make sure all geometries have the same number of attributes."),null;if(c!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+m+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const w in g.morphAttributes){if(!i.has(w))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+m+".  .morphAttributes must be consistent throughout all geometries."),null;a[w]===void 0&&(a[w]=[]),a[w].push(g.morphAttributes[w])}if(e){let w;if(t)w=g.index.count;else{if(g.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+m+". The geometry must have either an index or a position attribute"),null;w=g.attributes.position.count}u.addGroup(d,w,m),d+=w}}if(t){let m=0;const g=[];for(let _=0;_<s.length;++_){const w=s[_].index;for(let x=0;x<w.count;++x)g.push(w.getX(x)+m);m+=s[_].attributes.position.count}u.setIndex(g)}for(const m in o){const g=Ue(o[m]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+m+" attribute."),null;u.setAttribute(m,g)}for(const m in a){const g=a[m][0].length;if(g===0)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[m]=[];for(let _=0;_<g;++_){const w=[];for(let T=0;T<a[m].length;++T)w.push(a[m][T][_]);const x=Ue(w);if(!x)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+m+" morphAttribute."),null;u.morphAttributes[m].push(x)}}return u}function Ue(s){let e,t,n,i=0;for(let c=0;c<s.length;++c){const u=s[c];if(u.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=u.itemSize),t!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=u.normalized),n!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=u.array.length}const o=new e(i);let a=0;for(let c=0;c<s.length;++c)o.set(s[c].array,a),a+=s[c].array.length;return new p.TlE(o,t,n)}function At(s){return s.isInstancedInterleavedBufferAttribute||s.isInterleavedBufferAttribute?Be(s):s.isInstancedBufferAttribute?new p.lb7().copy(s):new p.TlE().copy(s)}function Bt(s){let e,t=0,n=0;for(let d=0,m=s.length;d<m;++d){const g=s[d];if(e===void 0&&(e=g.array.constructor),e!==g.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=g.array.length,n+=g.itemSize}const i=new p.vpT(new e(t),n);let o=0;const a=[],c=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"];for(let d=0,m=s.length;d<m;d++){const g=s[d],_=g.itemSize,w=g.count,x=new p.kB5(i,_,o,g.normalized);a.push(x),o+=_;for(let T=0;T<w;T++)for(let I=0;I<_;I++)x[u[I]](T,g[c[I]](T))}return a}function Be(s){const e=s.data.array.constructor,t=s.count,n=s.itemSize,i=s.normalized,o=new e(t*n);let a;a=s.isInstancedInterleavedBufferAttribute?new p.lb7(o,n,i,s.meshPerAttribute):new p.TlE(o,n,i);for(let c=0;c<t;c++)a.setX(c,s.getX(c)),n>=2&&a.setY(c,s.getY(c)),n>=3&&a.setZ(c,s.getZ(c)),n>=4&&a.setW(c,s.getW(c));return a}function Qe(s){const e=s.attributes,t=s.morphTargets,n=new Map;for(const i in e){const o=e[i];o.isInterleavedBufferAttribute&&(n.has(o)||n.set(o,Be(o)),e[i]=n.get(o))}for(const i in t){const o=t[i];o.isInterleavedBufferAttribute&&(n.has(o)||n.set(o,Be(o)),t[i]=n.get(o))}}function Z(s){let e=0;for(const n in s.attributes){const i=s.getAttribute(n);e+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}const t=s.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function $(s,e=1e-4){const t=e>0;e=Math.max(e,Number.EPSILON);const n={},i=s.getIndex(),o=s.getAttribute("position"),a=i?i.count:o.count;let c=0;const u=Object.keys(s.attributes),d={},m={},g=[],_=["getX","getY","getZ","getW"],w=["setX","setY","setZ","setW"];for(let R=0,M=u.length;R<M;R++){const C=u[R],L=s.attributes[C];d[C]=new p.TlE(new L.array.constructor(L.count*L.itemSize),L.itemSize,L.normalized);const k=s.morphAttributes[C];k&&(m[C]=new p.TlE(new k.array.constructor(k.count*k.itemSize),k.itemSize,k.normalized))}const x=Math.log10(1/e),T=Math.pow(10,x);for(let R=0;R<a;R++){const M=i?i.getX(R):R;let C="";for(let L=0,k=u.length;L<k&&t;L++){const j=u[L],H=s.getAttribute(j),X=H.itemSize;for(let ee=0;ee<X;ee++)C+=~~(H[_[ee]](M)*T)+","}if(t&&C in n)g.push(n[C]);else{for(let L=0,k=u.length;L<k;L++){const j=u[L],H=s.getAttribute(j),X=s.morphAttributes[j],ee=H.itemSize,oe=d[j],re=m[j];for(let he=0;he<ee;he++){const le=_[he],ue=w[he];if(oe[ue](c,H[le](M)),X)for(let ge=0,_e=X.length;ge<_e;ge++)re[ge][ue](c,X[ge][le](M))}}t&&(n[C]=c),g.push(c),c++}}const I=s.clone();for(const R in s.attributes){const M=d[R];if(I.setAttribute(R,new p.TlE(M.array.slice(0,c*M.itemSize),M.itemSize,M.normalized)),R in m)for(let C=0;C<m[R].length;C++){const L=m[R][C];I.morphAttributes[R][C]=new p.TlE(L.array.slice(0,c*L.itemSize),L.itemSize,L.normalized)}}return I.setIndex(g),I}function ae(s,e){if(e===p.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===p.z$h||e===p.UlW){let t=s.getIndex();if(t===null){const a=[],c=s.getAttribute("position");if(c===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s;for(let u=0;u<c.count;u++)a.push(u);s.setIndex(a),t=s.getIndex()}const n=t.count-2,i=[];if(e===p.z$h)for(let a=1;a<=n;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2==0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=s.clone();return o.setIndex(i),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}function Le(s){const e=new p.Pa4,t=new p.Pa4,n=new p.Pa4,i=new p.Pa4,o=new p.Pa4,a=new p.Pa4,c=new p.Pa4,u=new p.Pa4,d=new p.Pa4;function m(Ee,Ye,We,Et,lt,rt,kt,Pt){e.fromBufferAttribute(Ye,lt),t.fromBufferAttribute(Ye,rt),n.fromBufferAttribute(Ye,kt);const sn=Ee.morphTargetInfluences;if(We&&sn){c.set(0,0,0),u.set(0,0,0),d.set(0,0,0);for(let hn=0,wn=We.length;hn<wn;hn++){const Xn=sn[hn],zn=We[hn];Xn!==0&&(i.fromBufferAttribute(zn,lt),o.fromBufferAttribute(zn,rt),a.fromBufferAttribute(zn,kt),Et?(c.addScaledVector(i,Xn),u.addScaledVector(o,Xn),d.addScaledVector(a,Xn)):(c.addScaledVector(i.sub(e),Xn),u.addScaledVector(o.sub(t),Xn),d.addScaledVector(a.sub(n),Xn)))}e.add(c),t.add(u),n.add(d)}Ee.isSkinnedMesh&&(Ee.applyBoneTransform(lt,e),Ee.applyBoneTransform(rt,t),Ee.applyBoneTransform(kt,n)),Pt[3*lt+0]=e.x,Pt[3*lt+1]=e.y,Pt[3*lt+2]=e.z,Pt[3*rt+0]=t.x,Pt[3*rt+1]=t.y,Pt[3*rt+2]=t.z,Pt[3*kt+0]=n.x,Pt[3*kt+1]=n.y,Pt[3*kt+2]=n.z}const g=s.geometry,_=s.material;let w,x,T;const I=g.index,R=g.attributes.position,M=g.morphAttributes.position,C=g.morphTargetsRelative,L=g.attributes.normal,k=g.morphAttributes.position,j=g.groups,H=g.drawRange;let X,ee,oe,re,he,le,ue;const ge=new Float32Array(R.count*R.itemSize),_e=new Float32Array(L.count*L.itemSize);if(I!==null)if(Array.isArray(_))for(X=0,oe=j.length;X<oe;X++)for(he=j[X],le=Math.max(he.start,H.start),ue=Math.min(he.start+he.count,H.start+H.count),ee=le,re=ue;ee<re;ee+=3)w=I.getX(ee),x=I.getX(ee+1),T=I.getX(ee+2),m(s,R,M,C,w,x,T,ge),m(s,L,k,C,w,x,T,_e);else for(le=Math.max(0,H.start),ue=Math.min(I.count,H.start+H.count),X=le,oe=ue;X<oe;X+=3)w=I.getX(X),x=I.getX(X+1),T=I.getX(X+2),m(s,R,M,C,w,x,T,ge),m(s,L,k,C,w,x,T,_e);else if(Array.isArray(_))for(X=0,oe=j.length;X<oe;X++)for(he=j[X],le=Math.max(he.start,H.start),ue=Math.min(he.start+he.count,H.start+H.count),ee=le,re=ue;ee<re;ee+=3)w=ee,x=ee+1,T=ee+2,m(s,R,M,C,w,x,T,ge),m(s,L,k,C,w,x,T,_e);else for(le=Math.max(0,H.start),ue=Math.min(R.count,H.start+H.count),X=le,oe=ue;X<oe;X+=3)w=X,x=X+1,T=X+2,m(s,R,M,C,w,x,T,ge),m(s,L,k,C,w,x,T,_e);return{positionAttribute:R,normalAttribute:L,morphedPositionAttribute:new p.a$l(ge,3),morphedNormalAttribute:new p.a$l(_e,3)}}function J(s){if(s.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),s;let e=s.groups;if(e=e.sort((a,c)=>a.materialIndex!==c.materialIndex?a.materialIndex-c.materialIndex:a.start-c.start),s.getIndex()===null){const a=s.getAttribute("position"),c=[];for(let u=0;u<a.count;u+=3)c.push(u,u+1,u+2);s.setIndex(c)}const t=s.getIndex(),n=[];for(let a=0;a<e.length;a++){const c=e[a],u=c.start,d=u+c.count;for(let m=u;m<d;m++)n.push(t.getX(m))}s.dispose(),s.setIndex(n);let i=0;for(let a=0;a<e.length;a++){const c=e[a];c.start=i,i+=c.count}let o=e[0];s.groups=[o];for(let a=1;a<e.length;a++){const c=e[a];o.materialIndex===c.materialIndex?o.count+=c.count:(o=c,s.groups.push(o))}return s}function te(s,e=Math.PI/3){const t=Math.cos(e),n=100*(1+1e-10),i=[new p.Pa4,new p.Pa4,new p.Pa4],o=new p.Pa4,a=new p.Pa4,c=new p.Pa4,u=new p.Pa4;function d(T){return`${~~(T.x*n)},${~~(T.y*n)},${~~(T.z*n)}`}const m=s.toNonIndexed(),g=m.attributes.position,_={};for(let T=0,I=g.count/3;T<I;T++){const R=3*T,M=i[0].fromBufferAttribute(g,R+0),C=i[1].fromBufferAttribute(g,R+1),L=i[2].fromBufferAttribute(g,R+2);o.subVectors(L,C),a.subVectors(M,C);const k=new p.Pa4().crossVectors(o,a).normalize();for(let j=0;j<3;j++){const H=d(i[j]);H in _||(_[H]=[]),_[H].push(k)}}const w=new Float32Array(3*g.count),x=new p.TlE(w,3,!1);for(let T=0,I=g.count/3;T<I;T++){const R=3*T,M=i[0].fromBufferAttribute(g,R+0),C=i[1].fromBufferAttribute(g,R+1),L=i[2].fromBufferAttribute(g,R+2);o.subVectors(L,C),a.subVectors(M,C),c.crossVectors(o,a).normalize();for(let k=0;k<3;k++){const j=_[d(i[k])];u.set(0,0,0);for(let H=0,X=j.length;H<X;H++){const ee=j[H];c.dot(ee)>t&&u.add(ee)}u.normalize(),x.setXYZ(R+k,u.x,u.y,u.z)}}return m.setAttribute("normal",x),m}function ce(s,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),Ze(s,e)}function pe(s){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),Ue(s)}function je(s,e){let t,n;if(Array.isArray(s))for(const o of s){const a=je(o,e);t===void 0||n===void 0?(t=a.min.clone(),n=a.max.clone()):(t.min(a.min),n.max(a.max))}const i=s;if(i.geometry!==void 0){const o=i.geometry.vertices;if(o===void 0&&i.geometry.attributes!==void 0&&"position"in i.geometry.attributes){const a=new p.Pa4,c=i.geometry.attributes.position;for(let u=0;u<c.count*c.itemSize;u+=c.itemSize){a.set(c.array[u],c.array[u+1],c.array[3]);const d=a.applyMatrix4(s.matrixWorld).project(e),m=new p.FM8(d.x,d.y);t===void 0||n===void 0?(t=m.clone(),n=m.clone()):(t.min(m),n.max(m))}}else for(const a of o){const c=a.clone().applyMatrix4(s.matrixWorld).project(e),u=new p.FM8(c.x,c.y);t===void 0||n===void 0?(t=u.clone(),n=u.clone()):(t.min(u),n.max(u))}}if(s.children!==void 0)for(const o of s.children){const a=je(o,e);t===void 0||n===void 0?(t=a.min.clone(),n=a.max.clone()):(t.min(a.min),n.max(a.max))}return new p.TUj(t,n)}const ct="rgbm-16";function wt(s){switch(s){case p.aCh:case p.GUF:return["Linear","( value )"];case p.KI_:return["sRGB","( value )"];case ct:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",s),["Linear","( value )"]}}function _t(s,e){let t;return s&&s.isTexture?t=s.colorSpace:s&&s.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=s.texture.colorSpace):t=p.GUF,e&&s&&s.isTexture&&s.format===p.wk1&&s.type===p.ywz&&s.colorSpace===p.KI_&&(t=p.GUF),t}function Dt(s,e){const t=wt(e);return"vec4 "+s+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function $e(s,e,t){return Dt(s+"TexelToLinear",_t(e,t))+`
`}function Tt(s,e){return Dt(s+"TexelToLinear",e)+`
`}function Ct(s,e){const t=wt(e);return"vec4 "+s+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Ft(s,e,t){return Ct(s,_t(e,t))}function Fe({uniforms:s,propKey:e,thisTarget:t=!1}={}){const n=!!s,i=!!e,o=t;return(a,c)=>{const u=d=>{const m=o?d:n?s:d.uniforms||d._uniforms;let g=i?e:c;o&&(g="_"+g);let _=m[g];return _||(_={value:null},m[g]=_),_};Object.defineProperty(a,c,{get(){return u(this).value},set(d){u(this).value=d,(0,V.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function se(s,e,t=!1,n){const i=!!e,o=!!s;return(a,c)=>{const u=d=>({t:i?e:d.defines||d._defines,p:o?s:c});Object.defineProperty(a,c,{get(){const{t:d,p:m}=u(t?this:this.material);return d[m]},set(d){const{t:m,p:g}=u(t?this:this.material);if((0,V.safeSetProperty)(m,g,d,!0),typeof n=="function"){const _=[g,d];if(n.name){const w=this[n.name];w===n?n.call(this,..._):w.name===`bound ${n.name}`?w(..._):n(..._)}else n(..._)}else(0,V.safeSetProperty)(t?this:this.material,"needsUpdate",!0,!0)}})}}function Me(s){const e=new p.IEO(new Uint8Array([Math.floor(255*s.r),Math.floor(255*s.g),Math.floor(255*s.b),255]),1,1,p.wk1,p.ywz);return e.needsUpdate=!0,e.colorSpace=p.aCh,e}function Ne(s){const e=new p.IEO(new Uint8Array([Math.floor(255*s.x),Math.floor(255*s.y),Math.floor(255*s.z),Math.floor(255*s.w)]),1,1,p.wk1,p.ywz);return e.needsUpdate=!0,e}function Vt(s,e,t){const n=s.userData,{backgroundRender:i,transparentRender:o,shadowMapRender:a,mainRenderPass:c,opaqueRender:u,transmissionRender:d,sceneRender:m,screenSpaceRendering:g}=n;e.backgroundRender!==void 0&&(n.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(n.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(n.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(n.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(n.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(n.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(n.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(n.screenSpaceRendering=e.screenSpaceRendering),t(),n.backgroundRender=i,n.transparentRender=o,n.shadowMapRender=a,n.mainRenderPass=c,n.opaqueRender=u,n.sceneRender=m,n.transmissionRender=d,n.screenSpaceRendering=g}function Kt(s){const e=new Ie().expandByObject(s,!0,!0).getCenter(new p.Pa4);s.position.sub(e),s.updateMatrix(),s.userData.autoCentered=!0,s.userData.isCentered=!0}function fn(s,e,t){const n=.5*new Ie().expandByObject(s,!0,!0).getSize(new p.Pa4).length();e===void 0&&(e=s.userData.autoScaleRadius||1);const i=e/n;return isFinite(i)&&(s.userData.pseudoCentered?s.children.forEach(o=>{o.scale.multiplyScalar(i)}):s.scale.multiplyScalar(i),(t||s.userData.isCentered)&&s.position.multiplyScalar(i),s.traverse(o=>{var a,c;o.isLight&&((c=(a=o.shadow)==null?void 0:a.camera)!=null&&c.right)&&(o.shadow.camera.right*=i,o.shadow.camera.left*=i,o.shadow.camera.top*=i,o.shadow.camera.bottom*=i),o.isCamera&&o.right&&(o.right*=i,o.left*=i,o.top*=i,o.bottom*=i)}),s.userData.autoScaled=!0,s.userData.autoScaleRadius=e,s.dispatchEvent({type:"objectUpdate"})),s}function ri(s,e=-1){return $(s,e)}function In(s,e){return{type:"folder",label:e+" Sampler",hidden:()=>!s[e],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[s[e],"repeat"],onChange:s==null?void 0:s.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[s[e],"offset"],onChange:s==null?void 0:s.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[s[e],"center"],onChange:s==null?void 0:s.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[s[e],"rotation"],onChange:s==null?void 0:s.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[s[e],"colorSpace"],children:[["Linear",p.GUF],["sRGB",p.KI_]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{const t=s[e];t&&(t.needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var t;return((t=s[e])==null?void 0:t.flipY)??!1},setValue:t=>{var i;const n=s[e];if(n&&n.flipY!==t)if(n.image&&ImageBitmap&&n.image instanceof ImageBitmap){const o=n,a=n.source.data;createImageBitmap(a,{imageOrientation:"flipY"}).then(c=>{var u;a.close&&a.close(),o.flipY=t,o.source.data=c,o.source.needsUpdate=!0,o.needsUpdate=!0,(u=s==null?void 0:s.setDirty)==null||u.call(s)})}else n.flipY=t,n.needsUpdate=!0,(i=s==null?void 0:s.setDirty)==null||i.call(s)}}),()=>({type:"dropdown",label:"Wrap S",property:[s[e],"wrapS"],children:[["ClampToEdge",p.uWy],["MirroredRepeat",p.OoA],["Repeat",p.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[s[e],"wrapT"],children:[["ClampToEdge",p.uWy],["MirroredRepeat",p.OoA],["Repeat",p.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[s[e],"anisotropy"],onChange:[()=>{s[e]&&(s[e].needsUpdate=!0),s.needsUpdate=!0},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[s[e],"minFilter"],children:[["Linear",p.wem],["Nearest",p.TyD],["NearestMipmapNearest",p.YLQ],["NearestMipmapLinear",p.vZf],["LinearMipmapNearest",p.qyh],["LinearMipmapLinear",p.D1R]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[s[e],"magFilter"],children:[["Linear",p.wem],["Nearest",p.TyD]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]})]}}const Qi=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function qi(s,e,t=!0){if(!e)return s;for(const n of Object.keys(e)){if(t&&Qi.includes(n)||n.startsWith("__"))continue;const i=e[n];if(typeof s[n]=="function"||typeof i=="function")continue;const o=!i||i.isTexture||i.isObject3D||i.isMaterial;o||typeof i.clone!="function"?o||typeof i!="object"&&!Array.isArray(i)?s[n]=i:s[n]=qi(Array.isArray(i)?[]:{},i,!1):s[n]=i.clone()}return s}const Ki=["appliedMaterials","uuid"];function qr(s,e){if(e)for(const t of Object.keys(e))Ki.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}function dr(s,e,t){const n=(t==null?void 0:t.data)??new Uint8ClampedArray(s.height*s.width*4),i=s.data instanceof Float32Array,o=s.data instanceof Uint16Array;for(let a=0;a<n.length;a++)n[a]=i?255*s.data[a]:o?255*p.A5E.fromHalfFloat(s.data[a]):s.data[a],e===p.GUF&&(n[a]=255*(0,V.LinearToSRGB)(n[a]/255));return t??new ImageData(n,s.width,s.height)}function ar(s,e,t=!1){let n;return n=s.isDataTexture?dr(s.image,s.colorSpace):s.image,Ko(n,e,t)}function Ko(s,e,t=!1){const n=document.createElement("canvas");n.width=Math.min(e,s.width),n.height=Math.floor(1+n.width*s.height/s.width);const i=n.getContext("2d");if(!i)return console.error("textureToDataUrl: could not get canvas context"),n;t===!0&&(i.translate(0,n.height),i.scale(1,-1));let o=!1;if(s.data!==void 0){const a=s;if(s.width!==n.width||s.height!==n.height){const c=document.createElement("canvas");c.width=s.width,c.height=s.height;const u=c.getContext("2d");u?(u.putImageData(a,0,0),i.drawImage(c,0,0,n.width,n.height)):(console.error("textureToDataUrl: could not get temp canvas context"),i.putImageData(a,0,0))}else i.putImageData(a,0,0),t&&(o=!0)}else i.drawImage(s,0,0,n.width,n.height);return o?(0,V.canvasFlipY)(n):n}function Za(s,e,t,n,i){return ar(s,e,t).toDataURL(n,i)}String.prototype.replaceAll||(String.prototype.replaceAll=function(s,e){return Object.prototype.toString.call(s).toLowerCase()==="[object regexp]"?this.replace(s,e):this.replace(new RegExp(s,"g"),e)});const gr=new Map;function Ae(s){return(e,t)=>{const n=e.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");gr.has(n)||gr.set(n,[]),gr.get(n).push([s||t,t])}}const Ji={obj:(s,e)=>Object.fromEntries(Object.entries(s).map(([t,n])=>[t,xi(n,!1,e)])),vec4:s=>({x:s.x,y:s.y,z:s.z,w:s.w,isVector4:!0}),vec3:s=>({x:s.x,y:s.y,z:s.z,isVector3:!0}),vec2:s=>({x:s.x,y:s.y,isVector2:!0}),color:s=>({r:s.r,g:s.g,b:s.b,isColor:!0}),quat:s=>({x:s.x,y:s.y,z:s.z,w:s.w,isQuaternion:!0}),texture:(s,e)=>{var c;if(!(s!=null&&s.isTexture))throw new Error("Expected a texture");if(e!=null&&e.textures[s.uuid])return{uuid:s.uuid,resource:"textures"};if(s.isRenderTargetTexture&&!((c=s.userData)!=null&&c.serializableRenderTarget))return;const t=s.source.data,n=!s.isRenderTargetTexture&&s.userData.rootPath;n&&s.source.data&&(s.userData.__embedUrlImagePreviews?s.source.data=ar(s,16,s.flipY):s.source.data=null);const i=s.userData;s.userData={};const o={images:{}};let a={};try{a=s.toJSON(e||o),!e&&a.image&&(a.image=n&&!s.userData.__embedUrlImagePreviews?void 0:o.images[a.image]),a.userData=xi(qr({},i),!1,e)}catch(u){console.error(u)}return s.userData=i,n&&(e&&!s.userData.__embedUrlImagePreviews&&delete e.images[s.source.uuid],s.source.data=t),e!=null&&e.textures&&!a.resource&&(e.textures[a.uuid]||(e.textures[a.uuid]=a),a={uuid:a.uuid,resource:"textures"}),a},material:(s,e)=>{if(!(s!=null&&s.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[s.uuid])return{uuid:s.uuid,resource:"materials"};s.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const t=e??{textures:{},images:{}},n={},i={};for(const[a,c]of Object.entries(s))if(c!=null&&c.isTexture&&!a.startsWith("__")){const u=Ji.texture(c,t);n[a]=u,i[a]=c,s[a]=u?{isTexture:!0,toJSON:()=>u}:null}let o=s.toJSON(e);for(const[a,c]of Object.entries(i))s[a]=c,delete i[a];if(e){for(const[a,c]of Object.entries(n))c&&(o[a]=c);e!=null&&e.materials&&(e.materials[o.uuid]||(e.materials[o.uuid]=o),o={uuid:o.uuid,resource:"materials"})}else{for(const[a,c]of Object.entries(n))c&&(o[a]=c.uuid);o.textures=Object.values(t.textures),o.images=Object.values(t.images)}return o}},Er=s=>(e,t)=>{var n;return((n=t==null?void 0:t.copy)==null?void 0:n.call(t,e))??new s().copy(e)},gs={obj:(s,e,t)=>Object.assign(e,Object.fromEntries(Object.entries(s).map(([n,i])=>[n,Di(i,e==null?void 0:e[n],!1,t)]))),vec4:Er(p.Ltg),vec3:Er(p.Pa4),vec2:Er(p.FM8),color:Er(p.Ilk),quat:Er(p._fP)};function xi(s,e,t){var o;if(typeof s=="function")return;if(Array.isArray(s))return s.map(a=>xi(a,!1,t));if(typeof s!="object"){if(typeof s=="number"){if(s===1/0)return"Infinity";if(s===-1/0)return"-Infinity";if(isNaN(s))return"NaN"}return s}if(!s)return s;let n=s.constructor??Object;if(n===Object)return Ji.obj(s,t);if(s.isVector2)return Ji.vec2(s);if(s.isVector3)return Ji.vec3(s);if(s.isVector4)return Ji.vec4(s);if(s.isColor)return Ji.color(s);if(s.isQuaternion)return Ji.quat(s);if(s.isTexture)return Ji.texture(s,t);if(s.isMaterial)return Ji.material(s,t);if(!e&&typeof s.toJSON=="function"){const a=s.toJSON(t);return s.serializableClassId&&a&&(a.serializableClassId=s.serializableClassId),a}const i={};for(;n&&n!==Object;)(o=gr.get(n))==null||o.forEach(([a,c])=>{const u=s[c];i[a]=xi(u,!1,t)}),n=Object.getPrototypeOf(n);return s.serializableClassId&&(i.serializableClassId=s.serializableClassId),i}function Di(s,e,t,n){var c,u;let i=e;if(s===void 0)return i;if(typeof e=="number"){if(s==="Infinity")return 1/0;if(s==="-Infinity")return-1/0;if(s==="NaN")return NaN;if(typeof s=="number"||!s)return s}if(Array.isArray(s)){const d=s.length;Array.isArray(i)||(i=[]);for(let m=0;m<d;m++){const g=s[m],_=i.length>m?Di(g,i[m],!1,n):Di(g,void 0,!1,n);i.length<=m?i.push(_):i[m]=_}return i}let o=!1;if(s&&s.resource&&typeof s.resource=="string"&&(s=(c=n[s.resource])==null?void 0:c[s.uuid],o=!0),!i&&s&&!o)if(s.serializableClassId){const d=vs.get(s.serializableClassId);d&&(i=d.DataInConstructor?new d(s):new d)}else typeof s!="object"||s.constructor&&s.constructor!==Object||(i={});if(typeof i=="function")return console.error("cannot deserialize over function",i,s),i;if(s&&typeof s=="object"&&!o){if(s.isVector2)return gs.vec2(s,i);if(s.isVector3)return gs.vec3(s,i);if(s.isVector4)return gs.vec4(s,i);if(s.isColor)return gs.color(s,i);if(s.isQuaternion)return gs.quat(s,i)}if(s==null||i==null||typeof i!="object"||i.isTexture)return o&&(s?s.__useCount=s.__useCount?s.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),s;let a=i.constructor??Object;if(a===Object)return gs.obj(s,i,n);if(!t&&typeof i.fromJSON=="function")return i.isMaterial&&(Object.entries(s).forEach(([d,m])=>{var _;if(!m||!m.resource||typeof m.resource!="string")return;const g=(_=n[m.resource])==null?void 0:_[m.uuid];s[d]=g||null}),s.userData&&(s.userData=Di(s.userData,void 0,!1,n))),i.fromJSON(s,n),i;for(;a&&a!==Object;)(u=gr.get(a))==null||u.forEach(([d,m])=>{const g=i[m],_=Di(s[d],g,!1,n);_!==g&&(0,V.safeSetProperty)(i,m,_,!0)}),a=Object.getPrototypeOf(a);return i}const vs=new Map;function _s(s){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=s}},vs.set(s,e),e)}function vr(s,e,t,n){var a,c,u;if(e!=null&&e.extras[s.uuid])return{uuid:s.uuid,resource:"extras"};let i="";if((a=s.source)!=null&&a._sourceImgBuffer||s.userData.__sourceBuffer){const d=new Uint8Array(((c=s.source)==null?void 0:c._sourceImgBuffer)||s.userData.__sourceBuffer),m=n||s.userData.mimeType||"";i={data:Array.from(d),type:d.constructor.name,path:((u=s.userData.__sourceBlob)==null?void 0:u.name)||s.userData.rootPath||"file."+m.split("/")[1]},m&&(i.mimeType=m)}else s.userData.rootPath?i=s.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const o={uuid:s.uuid,url:i,userData:qr({},s.userData),type:s.type,name:t||s.name};return e!=null&&e.extras?(e.extras[s.uuid]=o,{uuid:s.uuid,resource:"extras"}):o}var Jo=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let th=class extends V.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(s){s!==this._displayCanvasScaling&&(this._displayCanvasScaling=s,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(s){this._pipeline=s,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){const s=this._passes,e=[],t={};for(const n of s){if(n.enabled===!1)continue;const i={after:n.after??[],before:n.before??[],dependencies:new Set(n.required??[])};t[n.passId]=i}for(const[n,i]of Object.entries(t)){const o=new Set([...i.after,...i.before]);i.dependencies.forEach(a=>o.has(a)&&o.delete(a)),o.forEach(a=>{const c=t[a];if(c){if(c.dependencies.has(n))throw console.error("cyclic",n,a),"Cyclic dependency";i.dependencies.add(a)}})}for(;;){let n=!1;const i=[...Object.entries(t)];for(const[o,a]of i)if(!e.includes(o)&&(0,V.includesAll)(e,a.dependencies.values())){const c=Math.max(-1,...a.after.map(d=>e.indexOf(d))),u=Math.min(e.length,...a.before.map(d=>{const m=e.indexOf(d);return m<0?e.length:m}));if(c>=u)throw console.error(a,s,e,c,u),"Not possible";e.splice(a.after.length>0?c+1:u,0,o),n=!0,delete t[o]}if(Object.keys(t).length<1)break;if(!n)throw console.error(i,t,e),"Not possible 2"}return this.pipeline=e,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(s,e){const t=s-this._lastTime;this._lastTime=s,this.frameWaitTime-=t,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:t,time:s,renderer:this,xrFrame:e}))}get clock(){return this._composer.clock}registerPass(s,e=!0){var t;if(e)for(const n of[...this._passes])s.passId===n.passId&&this.unregisterPass(n);this._passes.push(s),(t=s.onRegister)==null||t.call(s,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(s){var t;const e=this._passes.indexOf(s);e>=0&&((t=s.onUnregister)==null||t.call(s,this),this._passes.splice(e,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:s,canvas:e,alpha:t=!0,targetOptions:n}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new p.FM8(512,512),this._frameCount=0,this.defaultRenderToScreen=!0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new p.CP7({canvas:e,antialias:!1,alpha:t,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=i=>{this.dispatchEvent({type:"contextLost",event:i})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new p.FM8(e.clientWidth,e.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=p.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=p.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=p._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(n,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new at(this._renderer,this._composerTarget),s&&this.addEventListener("animationLoop",s)}setSize(s,e,t=!1){!t&&(s?Math.abs(s-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(s&&(this._renderSize.width=s),e&&(this._renderSize.height=e),this.rendererObject.xr.enabled&&this.rendererObject.xr.isPresenting||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(n=>{const i=n,o=i.sizeMultiplier;if(o){const a=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*o);i.setSize(Math.floor(a.width),Math.floor(a.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(s,e,{viewport:t,material:n,shader:i,pass:o,clear:a=!0}={}){const c=this._composer.copyPass,{renderToScreen:u,material:d,uniforms:m,clear:g}=c;n&&(c.material=n);const _=this._renderer.getViewport(new p.Ltg),w=this._renderer.autoClear,x=this._renderer.getRenderTarget();t&&this._renderer.setViewport(new p.Ltg().fromArray(t)),this._renderer.autoClear=!1,c.uniforms=c.material.uniforms,c.renderToScreen=!1,c.clear=a,Vt(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{c.render(this._renderer,e??null,{texture:s},0,!1)}),c.renderToScreen=u,c.clear=g,c.material=d,c.uniforms=m,this._renderer.autoClear=w,t&&this._renderer.setViewport(_),this._renderer.setRenderTarget(x)}clearColor({r:s,g:e,b:t,a:n,target:i,depth:o=!0,stencil:a=!0}){const c=this._renderer.getClearColor(new p.Ilk),u=this._renderer.getClearAlpha();this._renderer.setClearAlpha(n??u),this._renderer.setClearColor(new p.Ilk(s??c.r,e??c.g,t??c.b));const d=this._renderer.getRenderTarget(),m=this._renderer.getActiveCubeFace(),g=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(i??null),this._renderer.clear(!0,o,a),this._renderer.setRenderTarget(d,m,g),this._renderer.setClearColor(c),this._renderer.setClearAlpha(u)}renderModel(s,e){this._renderer.render(s.modelObject,e.cameraObject)}renderScene(s){const e=s.activeCamera;e&&this.renderModel(s,e)}_updated(){this.dispatchEvent({type:"update"})}render(s){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const t of this._passes)t.passObject.enabled&&((e=t.update)==null||e.call(t));s=s??this.defaultRenderToScreen,this._composer.renderToScreen=s,this._composer.render(),this._composer.renderToScreen=!0,s&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(s=>s.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const s=[];for(const e of this._pipeline){const t=this._passes.find(n=>n.passId===e);t?s.push(t.passObject):console.warn("Unable to find pass: ",e)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),s.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._trackedTargets.forEach(s=>s.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(s){this._trackedTargets.push(s)}removeTrackedTarget(s){const e=this._trackedTargets.indexOf(s);e>=0&&this._trackedTargets.splice(e,1)}createTarget({sizeMultiplier:s,samples:e=0,colorSpace:t=p.aCh,type:n=p.ywz,format:i=p.wk1,depthBuffer:o=!0,depthTexture:a=!1,depthTextureType:c=p.JQ4,depthTextureFormat:u=p.qkB,size:d,textureCount:m=1,...g}={},_=!0){this.isWebGL2||(e=0),s!==void 0&&d!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(d=d||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(s=s||1))).width=Math.floor(d.width),d.height=Math.floor(d.height);const w=a?new p.$YQ(d.width,d.height,c):void 0;w&&(w.format=u);const x=this.createTargetCustom(m>1?{width:d.width,height:d.height,count:m}:d,{samples:e,colorSpace:t,type:n,format:i,depthBuffer:o,depthTexture:w},m>1?p.kFz:p.dd2);return this._processNewTarget(x,s,_),this._setTargetOptions(x,g),x}_processNewTarget(s,e,t){return e!==void 0&&(s.sizeMultiplier=e),t&&this.trackTarget(s),s}disposeTarget(s){if(s){if(s.isTemporary)return this.releaseTempTarget(s);this.removeTrackedTarget(s),s.dispose()}}createTargetCustom({width:s,height:e,count:t},n={},i){const o=this._processNewTarget,a=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let c=[s,e];if(t&&t>1&&c.push(t),(i==null?void 0:i.prototype)===p.oAp.prototype){if(s!==e)throw"Width and height of cube render target must be equal";c=[s]}n={format:p.wk1,minFilter:p.wem,magFilter:p.wem,generateMipmaps:!1,type:p.ywz,colorSpace:p.aCh,...n};const u=[this,...c,n];return new class extends(i??p.dd2){constructor(d,...m){super(...m),this.renderer=d,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(g=>{g.__target=this,g.userData||(g.userData={}),g.colorSpace=n.colorSpace,g.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.userData||(this.texture.userData={}),this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(g){console.warn("Render target texture.toJSON might be buggy."),this.source.data.url=a(this.__target,"image/png",90);const _=this.__toJSON.call(this,g);return delete this.source.data.url,_.isRenderTargetTexture=!0,_})}setSize(d,m,g){super.setSize(Math.floor(d),Math.floor(m),g)}clone(d=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const m=super.clone();return m.texture.isRenderTargetTexture=!0,o(m,this.sizeMultiplier||1,d)}}(...u)}getTempTarget(s={}){var n;const e=Al(s);let t;return(n=this._tempTargets[e])!=null&&n.length&&(t=this._tempTargets[e].pop()),t?this._setTargetOptions(t,s):(t=this.createTarget(s),this._processNewTempTarget(t,e)),t}_processNewTempTarget(s,e){return s.isTemporary=!0,s.targetKey=e,this._tempTargets[e]===void 0&&(this._tempTargets[e]=[]),s}releaseTempTarget(s){const e=s.targetKey;if(!e||!s.isTemporary)throw"Not a temp target";this._tempTargets[e].length>this.maxTempPerKey?(this.removeTrackedTarget(s),s.dispose()):this._tempTargets[e].push(s)}updateShaderProperties(s){return this.stableNoise?s.uniforms.frameCount?s.uniforms.frameCount.value=this._totalFrameCount:console.warn("BaseRenderer: no uniform: frameCount"):s.uniforms.frameCount?s.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),s.uniforms.frameCount2&&(s.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(s,e){s.texture.minFilter=e.minFilter??p.wem,s.texture.magFilter=e.magFilter??p.wem,s.texture.generateMipmaps=e.generateMipmaps??!1,s.texture.generateMipmaps&&s.texture.minFilter===p.wem&&(s.texture.minFilter=p.FDw),s.texture.generateMipmaps||s.texture.minFilter!==p.FDw||(s.texture.minFilter=p.wem)}renderTargetToDataUrl(s,e="image/png",t=90,n=0){const i=document.createElement("canvas");i.width=s.width,i.height=s.height;const o=i.getContext("2d");if(!o)throw new Error("Unable to get 2d context");const a=Array.isArray(s.texture)?s.texture[n]:s.texture,c=o.createImageData(s.width,s.height,{colorSpace:["display-p3","srgb"].includes(a.colorSpace)?a.colorSpace:void 0});if(a.type===p.cLu){const d=new Uint16Array(s.width*s.height*4);this._renderer.readRenderTargetPixels(s,0,0,s.width,s.height,d,void 0,n),dr({data:d,width:s.width,height:s.height},a.colorSpace,c)}else if(a.type===p.VzW){const d=new Float32Array(s.width*s.height*4);this._renderer.readRenderTargetPixels(s,0,0,s.width,s.height,d,void 0,n),dr({data:d,width:s.width,height:s.height},a.colorSpace,c)}else this._renderer.readRenderTargetPixels(s,0,0,s.width,s.height,c.data,void 0,n);o.putImageData(c,0,0);const u=i.toDataURL(e,t);return i.remove(),u}renderTargetToBuffer(s,e=0){const t=(Array.isArray(s.texture)?s.texture[e]:s.texture).type===p.cLu?new Uint16Array(s.width*s.height*4):new Uint8Array(s.width*s.height*4);return this._renderer.readRenderTargetPixels(s,0,0,s.width,s.height,t,void 0,e),t}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(s){this.rendererObject.useLegacyLights=s,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(s){console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=s}get renderScale(){return this.displayCanvasScaling}set renderScale(s){this.displayCanvasScaling=s}};function Al(s={}){var e,t;return[s.sizeMultiplier,s.samples,s.colorSpace,s.type,s.format,s.depthBuffer,s.depthTexture,(e=s.size)==null?void 0:e.width,(t=s.size)==null?void 0:t.height].join(";")}function bd(s){var o,a,c,u,d,m,g,_,w;if(!s.isMaterial&&!s.isBufferGeometry)return;const e=Array.from(s.userData.__appliedMeshes).filter(x=>!x.isInstancedMesh&&!!x.parent&&x.children.length===0&&!Array.isArray(x.material));if(e.length<2)return;const t=new Map;for(const x of e){const T=(n=x).parent.uuid+"_"+n.geometry.uuid+"_"+((o=n.material)==null?void 0:o.uuid);t.has(T)||t.set(T,[]),t.get(T).push(x),x.updateMatrix()}var n;const i=t.keys();for(const x of i){const T=t.get(x),I=T[0];if(!I||T.length<2)continue;const R=new p.SPe(I.geometry,I.material,T.length),M=I.userData;I.userData={},R.copy(I),ys(R.userData,M);const C=I.parent;R.position.set(0,0,0),R.rotation.set(0,0,0),R.scale.set(1,1,1),R.updateMatrix();const L=new Float32Array(3*R.count),k=new Float32Array(4*R.count),j=new Float32Array(3*R.count);for(let H=0;H<T.length;H++){const X=T[H],ee=X.matrix;ee.determinant()<0&&(ee.elements[0]*=-1,ee.elements[1]*=-1,ee.elements[2]*=-1),R.setMatrixAt(H,ee),X.position.toArray(L,3*H),X.quaternion.toArray(k,4*H),X.scale.toArray(j,3*H),X.removeFromParent(),(u=(c=(a=X.material)==null?void 0:a.userData)==null?void 0:c.__appliedMeshes)==null||u.delete(X),(g=(m=(d=X.geometry)==null?void 0:d.userData)==null?void 0:m.__appliedMeshes)==null||g.delete(X)}(w=(_=R.material.userData)==null?void 0:_.__appliedMeshes)==null||w.add(R),R.geometry.userData.__appliedMeshes.add(R),R.sourceTrs={TRANSLATION:new p.TlE(L,3),ROTATION:new p.TlE(k,4),SCALE:new p.TlE(j,3)},R.instanceMatrix.needsUpdate=!0,C.add(R),C.setDirty()}}Jo([Ae()],th.prototype,"stableNoise",void 0),Jo([Ae()],th.prototype,"useLegacyLights",null),th=Jo([_s("RenderManager")],th);class _r{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const n=this.writer,i=e;let o=i.sourceTrs;if(!o){const a=new Float32Array(3*i.count),c=new Float32Array(4*i.count),u=new Float32Array(3*i.count),d=new p.yGw,m=new p.Pa4,g=new p._fP,_=new p.Pa4;for(let w=0;w<i.count;w++)i.getMatrixAt(w,d),d.decompose(m,g,_),m.toArray(a,3*w),g.toArray(c,4*w),_.toArray(u,3*w);o={TRANSLATION:new p.TlE(a,3),ROTATION:new p.TlE(c,4),SCALE:new p.TlE(u,3)}}o={TRANSLATION:n.processAccessor(o.TRANSLATION),ROTATION:n.processAccessor(o.ROTATION),SCALE:n.processAccessor(o.SCALE)},i.instanceColor&&(o.COLOR=n.processAccessor(new p.TlE(i.instanceColor.array,3))),n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0,t.extensions=t.extensions||{},t.extensions[this.name]={attributes:o}}}function nh(s,e){if(s.uiConfig)return s.uiConfig;const t={type:"folder",label:()=>s.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[s,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{s.dispatchEvent({type:"select",ui:!0,value:s,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!s.parent,value:()=>{const o=s.parent;o&&o.dispatchEvent({type:"select",ui:!0,value:o})}},{type:"input",label:"Name",property:[s,"name"],onChange:o=>{var a;o.last&&((a=s.setDirty)==null||a.call(s,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!s.isMesh,property:[s,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!s.isMesh,property:[s,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[s,"frustumCulled"]},{type:"vec3",label:"Position",property:[s,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[s,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[s,"scale"]},{type:"input",label:"Render Order",property:[s,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",s.userData.autoScaleRadius||"2",!0],value:o=>{if(!o)return;const a=parseFloat(o);Math.abs(a)>0&&fn(s,a)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&Kt(s)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(o=>({type:"button",label:"Rotate "+o+"90",value:()=>{var a;s.rotateOnAxis(new p.Pa4(o.includes("X")?1:0,o.includes("Y")?1:0,o.includes("Z")?1:0),Math.PI/2*(o.includes("-")?-1:1)),(a=s.setDirty)==null||a.call(s,{sceneUpdate:!0,refreshUi:!1})}}))},s.userData.license!==void 0?{type:"input",label:"License/Credits",property:[s.userData,"license"],limitedUi:!0}:{}]},n=s;if(n!=null&&n.isMesh&&e!==!1){const o=[()=>{const a=Object.entries(n.morphTargetDictionary||{});return a.length?{label:"Morph Targets",type:"folder",children:a.map(([c,u])=>({type:"slider",label:c,bounds:[0,1],stepSize:1e-4,property:[n.morphTargetInfluences,u],onChange:d=>{var m;(m=s.setDirty)==null||m.call(s,{sceneUpdate:d.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var a;return(a=n.geometry)==null?void 0:a.uiConfig},()=>{var a;return Array.isArray(n.material)?n.material.length<1?void 0:{label:"Materials",type:"folder",children:n.material.map(c=>c==null?void 0:c.uiConfig).filter(c=>c)}:(a=n.material)==null?void 0:a.uiConfig}];t.children.push(...o)}const i=s;if(i!=null&&i.isCamera){const o=[{type:"button",label:"Set View",value:()=>{var a;s.dispatchEvent({type:"setView",ui:!0,camera:s}),(a=t.uiRefresh)==null||a.call(t,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var a;return(a=s.userData.iCamera)==null?void 0:a.isActiveCamera},value:()=>{var a;s.dispatchEvent({type:"activateMain",ui:!0,camera:s}),(a=t.uiRefresh)==null||a.call(t,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var a;return!((a=s.userData.iCamera)!=null&&a.isActiveCamera)},value:()=>{var a;s.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(a=t.uiRefresh)==null||a.call(t,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>s.userData.autoLookAtTarget??!1,setValue:a=>{var c;s.userData.autoLookAtTarget=a,(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)}}];t.children.push(...o)}return s.uiConfig=t,t}function Ra(s,e,t){if(!s)return void console.warn("setupIModel: object is undefined");if(s.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",s),delete s.__disposed),s.userData||(s.userData={}),s.userData.__iModelSetup&&s.modelObject)return s;s.userData.__iModelSetup=!0;let n=[];n.push(()=>{[...s.children].forEach(m=>{var g;(g=m==null?void 0:m.dispose)==null||g.call(m),s.add(m)}),s.parent&&s.removeFromParent()}),s.isLight&&!s.assetType?(s.assetType="light",s.lightObject=s):s.isCamera?(s.assetType="camera",s.cameraObject=s):s.assetType||(s.assetType="model"),s.modelObject||(s.modelObject=s),s.setDirty||(s.setDirty=(m={})=>{s.dispatchEvent({...m,type:"objectUpdate",object:s})},s.userData.setDirty&&console.warn("userData.setDirty already defined",s.userData.setDirty,s),s.userData.setDirty=m=>{var g;console.warn("userData.setDirty is deprecated, use setDirty directly"),(g=s.setDirty)==null||g.call(s,m)}),s.addEventListener("added",m=>{var _,w;const g=((_=s.parent)==null?void 0:_.userData.parentRoot)??s.parent;g!==s.userData.parentRoot&&s.traverse(x=>{x.userData.parentRoot=g}),(w=s.setDirty)==null||w.call(s,{change:"addedToParent"})}),s.addEventListener("removed",()=>{var m;(m=s.setDirty)==null||m.call(s,{change:"removedFromParent"}),s.userData.parentRoot!==void 0&&s.traverse(g=>{g.userData.parentRoot=void 0})}),n.push(()=>{});const i=s.dispose;s.dispose=()=>{s.dispatchEvent({type:"dispose"}),i==null||i.call(s)},s.userData.dispose&&console.warn("userData.dispose already defined"),s.userData.dispose=()=>{var m;console.warn("userData.dispose is deprecated, use dispose directly"),(m=s.dispose)==null||m.call(s)};const o=s;!o.isMesh&&!o.isLine||o.userData.__meshSetup||(o.userData.__meshSetup=!0,o.setMaterial||(o.setMaterial=m=>bl(o,m)),o.setGeometry||(o.setGeometry=(m,g=!1)=>Wp(o,m,g),o.setGeometry(o.geometry,!0)),s.userData.setMaterial&&console.warn("userData.setMaterial already defined"),s.userData.setMaterial=m=>{var g;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(g=s.setMaterial)==null||g.call(s,m)},s.userData.setGeometry&&console.warn("userData.setGeometry already defined"),s.userData.setGeometry=(m,...g)=>{var _;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(_=s.setGeometry)==null||_.call(s,m,...g)},s.userData.__keepShadowDef||(s.castShadow=!0,s.receiveShadow=!0,s.userData.__keepShadowDef=!0),n.push(()=>{var _,w,x,T,I,R;const m=((_=o.setMaterial)==null?void 0:_.call(o,void 0))||[],g=(w=o.setGeometry)==null?void 0:w.call(o,void 0);for(const M of m)M&&M.userData&&((x=M.userData.__appliedMeshes)==null?void 0:x.size)===0&&M.userData.disposeOnIdle!==!1&&M.dispose();g&&g.userData&&((T=g.userData.__appliedMeshes)==null?void 0:T.size)===0&&g.userData.disposeOnIdle!==!1&&g.dispose(),(I=o.setMaterial)==null||I.call(o,m),(R=o.setGeometry)==null||R.call(o,g)})),s.uiConfig||s.assetType!=="model"&&s.assetType!=="camera"||(nh(s),n.push(()=>{})),s.addEventListener("objectUpdate",({refreshUi:m})=>{var g,_;return m!==!1&&((_=(g=s.uiConfig)==null?void 0:g.uiRefresh)==null?void 0:_.call(g,"postFrame",!0,1))}),s.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(s.userData.__autoParentDispatchEvents=s.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],s.isCamera&&s.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(s.userData.parentRoot=e);const a=s.dispatchEvent;s.dispatchEvent=m=>{var g;(g=s.userData.__autoParentDispatchEvents)!=null&&g.includes(m.type)&&(m.parentDispatch=!0),m.parentDispatch&&(_=>{const w=s.userData.parentRoot??s.parent;w!=null&&w.modelObject&&w.dispatchEvent(_)})(m),a.call(s,m)};const c=s.clone;s.clone=(...m)=>{const g=s.userData;s.userData={};let _=c.call(s,...m);s.userData=g,ys(_.userData,g);const w=s.userData.parentRoot;return w&&w.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),_=Ra(_,w,t),_.userData.cloneParent=s.uuid,_};const u=s.copy;s.copy=(m,...g)=>{const _=m.userData;m.userData={};const w=u.call(s,m,...g);return m.userData=_,ys(s.userData,m),w};const d=s.add;return s.add=(...m)=>(m.forEach(g=>Ra(g,s.userData.parentRoot||s,t)),d.call(s,...m)),(s=(t==null?void 0:t(s))??s).addEventListener("dispose",()=>{n.forEach(m=>m()),n=[]}),[...s.children].forEach(m=>Ra(m,s,t)),s}function bl(s,e){var o,a,c,u;const t=(Array.isArray(e)?e:[e]).map(d=>d==null?void 0:d.materialObject).filter(d=>d);if(s.material==t||t.length===1&&s.material===t[0])return[];s.userData.__materialUpdater||(s.userData.__materialUpdater=()=>{s.dispatchEvent({type:"materialUpdate"})}),s.userData.__textureUpdater||(s.userData.__textureUpdater=()=>{s.dispatchEvent({type:"textureUpdate"})});const n=Array.isArray(s.material)?[...s.material]:[s.material];for(const d of n)d&&(d.removeEventListener("materialUpdate",s.userData.__materialUpdater),d.removeEventListener("textureUpdate",s.userData.__textureUpdater),(a=(o=d.userData)==null?void 0:o.__appliedMeshes)==null||a.delete(s));const i=[];for(const d of t)d.userData.__appliedMeshes||(d.userData.__appliedMeshes=new Set),i.push(d),d&&(d.addEventListener("materialUpdate",s.userData.__materialUpdater),d.addEventListener("textureUpdate",s.userData.__textureUpdater),d.userData.__appliedMeshes.add(s));return s.material=i.length!==1?i:i[0]??void 0,s.dispatchEvent({type:"materialChanged",material:e,mesh:s}),(u=(c=s.uiConfig)==null?void 0:c.uiRefresh)==null||u.call(c,"postFrame",!0),n}function Wp(s,e,t=!1){var o,a,c,u,d,m;s.userData.__objectUpdater||(s.userData.__objectUpdater=g=>{s.dispatchEvent({...g,type:"objectUpdate"})});let n=s.geometry;const i=n;return(n!==e||t)&&(n&&(n.removeEventListener("geometryUpdate",s.userData.__objectUpdater),(a=(o=n.userData)==null?void 0:o.__appliedMeshes)==null||a.delete(s)),n=e,n&&!n.userData.__appliedMeshes&&(n.userData.__appliedMeshes=new Set),s.geometry=n??void 0,n&&(s.updateMorphTargets(),n.addEventListener("geometryUpdate",s.userData.__objectUpdater),(u=(c=n.userData)==null?void 0:c.__appliedMeshes)==null||u.add(s))),e&&!e.uiConfig&&(e.uiConfig=function(g){return{label:"Geometry",type:"folder",children:[{type:"input",property:[g,"uuid"],disabled:!0},{type:"input",property:[g,"name"]},{type:"button",label:"Center Geometry",value:()=>{g.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const _=new p.Pa4;g.center(_),_.negate();const w=g.userData.__appliedMeshes;for(const x of w)x.updateMatrix(),x.position.copy(_).applyMatrix4(x.matrix),x.setDirty&&x.setDirty()}},{type:"button",label:"Compute vertex normals",value:()=>{g.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{g.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{g.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!g.index,value:()=>{if(g.attributes.index)return;const _=parseFloat(prompt("Tolerance","-1")??"-1");ri(g,_)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!g.index,value:()=>{g.attributes.index&&g.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{g.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||g.setAttribute("uv1",g.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!g.hasAttribute("color"),value:()=>{g.hasAttribute("color")?confirm("Remove color attribute?")&&g.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!g.userData.__appliedMeshes||g.userData.__appliedMeshes.size<2,value:()=>{bd(g)}},{type:"input",label:"Mesh count",get value(){var _,w;return((w=(_=g.userData)==null?void 0:_.__appliedMeshes)==null?void 0:w.size)??0},set value(_){},disabled:!0}]}}(s.geometry)),s.dispatchEvent({type:"geometryChanged",geometry:e}),(m=(d=s.uiConfig)==null?void 0:d.uiRefresh)==null||m.call(d,"postFrame",!0),i===n?void 0:i||void 0}const ec=["appliedMeshes"],qp=["parentRoot","iCamera","iModel"];function ys(s,e){if(e)for(const t of Object.keys(e))qp.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}var ih,Rv=new Uint8Array(16);function wl(){if(!ih&&!(ih=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ih(Rv)}for(var tc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,pr=[],wd=0;wd<256;++wd)pr.push((wd+256).toString(16).substr(1));var vm=function(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(pr[s[e+0]]+pr[s[e+1]]+pr[s[e+2]]+pr[s[e+3]]+"-"+pr[s[e+4]]+pr[s[e+5]]+"-"+pr[s[e+6]]+pr[s[e+7]]+"-"+pr[s[e+8]]+pr[s[e+9]]+"-"+pr[s[e+10]]+pr[s[e+11]]+pr[s[e+12]]+pr[s[e+13]]+pr[s[e+14]]+pr[s[e+15]]).toLowerCase();if(!function(n){return typeof n=="string"&&tc.test(n)}(t))throw TypeError("Stringified UUID is invalid");return t},ns=function(s,e,t){var n=(s=s||{}).random||(s.rng||wl)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return vm(n)};const rh=new Map;function Sr(s,e){return(t,n)=>{const i=t.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");rh.has(i)||rh.set(i,[]);const o=rh.get(i);if(!(o.findIndex(a=>a.propKey===n)<0))throw new Error(`Property ${n} already has a uiConfig decorator`);o.push({params:e||{},propKey:n,uiType:s})}}function Gt(s,e){return Sr("checkbox",{label:s,params:e})}function nc(s,e){return Sr("monitor",{label:s,params:e})}function cn(s,e,t,n){return Sr("slider",{label:s,bounds:e,stepSize:t,params:n})}function As(s,e,t,n){return Sr("vec",{label:s,bounds:e,stepSize:t,params:n})}function Uo(s,e,t){return Sr("dropdown",{label:s,children:e,params:t})}function Ai(s,e){return Sr("button",{label:s,params:e})}function jn(s,e){return Sr("input",{label:s,params:e})}function Zo(s,e){return Sr("color",{label:s,params:e})}function sh(s,e){return Sr("image",{label:s,params:e})}function Da(s){let e=s==null?void 0:s.constructor;if(!s||!e)return[];const t=[],n=[];for(;e&&e!==Object;)n.push(e),e=Object.getPrototypeOf(e);if(!n.length){const i=typeof s=="object"?Object.keys(s):Array.isArray(s)?s.map((o,a)=>a):[];for(const o of i){const a=s[o];if(a==null)continue;const c=a==null?void 0:a.uiConfig;if(c)t.push(c);else{const u=xd(a);u==="folder"?t.push(Ba(o+"",a)):u&&t.push({type:u,label:o+"",property:[s,o]})}}}return n.reverse().forEach(i=>{var o;(o=rh.get(i))==null||o.forEach(({params:a,propKey:c,uiType:u})=>{let d;if(!u){const m=s[c];d=m==null?void 0:m.uiConfig,d?t.push(d):m!=null&&((u=xd(m))==="folder"?d=Ba(c+"",m):u&&(d={type:u,label:c+"",property:[s,c]}))}if(d||(d={property:[s,c],type:u||"input"}),a){const m=typeof a.params=="function"?a.params(s):a.params||{};delete a.params,Object.assign(d,{...a,...m})}t.push(d)})}),t}function Ba(s,e,t={},n="folder"){return{type:n,label:s,children:Da(e),uuid:ns(),...t}}function Hn(s,e,t="folder"){return n=>class extends n{constructor(){super(...arguments),this.uiConfig=Ba(s,this,e||{},t)}}}function su(s,e){return Hn(s,e,"panel")}function xd(s){return s==null?null:Array.isArray(s)?"folder":typeof s=="boolean"?"checkbox":typeof s=="number"?"number":typeof s=="string"?"input":typeof s=="function"?"button":typeof s.x=="number"?"vec":typeof s.r=="number"?"color":s.isTexture?"image":typeof s=="object"?"folder":null}const Ed={type:"change"},Sd={type:"start"},Xp={type:"end"};class _m extends p.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new p.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new p.Pa4(1/0,1/0,1/0),this.clampMin=new p.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:p.RsA.ROTATE,MIDDLE:p.RsA.DOLLY,RIGHT:p.RsA.PAN},this.touches={ONE:p.QmN.ROTATE,TWO:p.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(gt){gt.addEventListener("keydown",wn),this._domElementKeyEvents=gt},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",wn),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Ed),n.update(),o=i.NONE},this.update=function(){const gt=new p.Pa4,zt=new p._fP().setFromUnitVectors(e.up,new p.Pa4(0,1,0)),an=zt.clone().invert(),ui=new p.Pa4,Ri=new p._fP,_i=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const ni=n.object.position;gt.copy(ni).sub(n.target),gt.applyQuaternion(zt),c.setFromVector3(gt),n.autoRotate&&o===i.NONE&&X(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let ii=n.minAzimuthAngle,Bn=n.maxAzimuthAngle;isFinite(ii)&&isFinite(Bn)&&(ii<-Math.PI?ii+=_i:ii>Math.PI&&(ii-=_i),Bn<-Math.PI?Bn+=_i:Bn>Math.PI&&(Bn-=_i),c.theta=ii<=Bn?Math.max(ii,Math.min(Bn,c.theta)):c.theta>(ii+Bn)/2?Math.max(ii,c.theta):Math.min(Bn,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),Math.abs(u.radius)>0&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*(1+u.radius*(n.enableDamping?n.dampingFactor:1)))),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(u.radius=0)),c.radius*=1+u.radius*(n.enableDamping?n.dampingFactor:1)),Math.abs(d-1)>1e-5&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*d)),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(d=1)),c.radius*=d);let ut=0;n.autoPushTarget&&c.radius<n.minDistance&&(ut=n.minDistance-c.radius),n.autoPullTarget&&c.radius>n.maxDistance&&(ut=n.maxDistance-c.radius),c.radius=Math.max(n.minDistance,Math.min(n.maxDistance,c.radius)),n.enableDamping===!0?n.target.addScaledVector(m,n.dampingFactor):n.target.add(m),gt.setFromSpherical(c),gt.applyQuaternion(an),ni.copy(n.target).add(gt),n.target.add(gt.normalize().multiplyScalar(-ut)),ni.clamp(n.clampMin,n.clampMax),n.target.clamp(n.clampMin,n.clampMax),n.object.lookAt(n.target);let on=!1;return n.enableDamping===!0&&Math.abs(u.theta)+Math.abs(u.phi)+Math.abs(u.radius)+m.length()>.001?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,u.radius*=1-n.dampingFactor,m.multiplyScalar(1-n.dampingFactor),on=!0):(u.set(0,0,0),m.set(0,0,0)),d=1,!!(g||on||ui.distanceToSquared(n.object.position)>a||8*(1-Ri.dot(n.object.quaternion))>a)&&(n.dispatchEvent(Ed),ui.copy(n.object.position),Ri.copy(n.object.quaternion),g=!1,!0)}}(),this.stopDamping=function(){u.set(0,0,0),m.set(0,0,0)},this.dispose=function(){n.domElement.removeEventListener("contextmenu",Xn),n.domElement.removeEventListener("pointerdown",kt),n.domElement.removeEventListener("pointercancel",sn),n.domElement.removeEventListener("wheel",hn),n.domElement.removeEventListener("pointermove",Pt),n.domElement.removeEventListener("pointerup",sn),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",wn),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const a=1e-6,c=new p.$V,u=new p.$V(0,0,0);let d=1;const m=new p.Pa4;let g=!1;const _=new p.FM8,w=new p.FM8,x=new p.FM8,T=new p.FM8,I=new p.FM8,R=new p.FM8,M=new p.FM8,C=new p.FM8,L=new p.FM8,k=[],j={};function H(){return n.enableDamping?1:Math.pow(.95,n.zoomSpeed)}function X(gt){u.theta-=gt}function ee(gt){u.phi-=gt}this.rotateUp=ee,this.rotateLeft=X;const oe=function(){const gt=new p.Pa4;return function(zt,an){gt.setFromMatrixColumn(an,0),gt.multiplyScalar(-zt),m.add(gt)}}(),re=function(){const gt=new p.Pa4;return function(zt,an){n.screenSpacePanning===!0?gt.setFromMatrixColumn(an,1):(gt.setFromMatrixColumn(an,0),gt.crossVectors(n.object.up,gt)),gt.multiplyScalar(zt),m.add(gt)}}(),he=function(){const gt=new p.Pa4;return function(zt,an){const ui=n.domElement;if(n.object.isPerspectiveCamera){const Ri=n.object.position;gt.copy(Ri).sub(n.target);let _i=gt.length();_i*=Math.tan(n.object.fov/2*Math.PI/180),oe(2*zt*_i/ui.clientHeight,n.object.matrix),re(2*an*_i/ui.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(oe(zt*(n.object.right-n.object.left)/n.object.zoom/ui.clientWidth,n.object.matrix),re(an*(n.object.top-n.object.bottom)/n.object.zoom/ui.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function le(gt,zt=0){n.object.isPerspectiveCamera?(d/=gt,u.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,u.radius-zt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*gt)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ue(gt,zt=0){n.object.isPerspectiveCamera?(d*=gt,u.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,u.radius+zt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/gt)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ge(gt){_.set(gt.clientX,gt.clientY)}function _e(gt){T.set(gt.clientX,gt.clientY)}function Ee(){if(k.length===1)_.set(k[0].pageX,k[0].pageY);else{const gt=.5*(k[0].pageX+k[1].pageX),zt=.5*(k[0].pageY+k[1].pageY);_.set(gt,zt)}}function Ye(){if(k.length===1)T.set(k[0].pageX,k[0].pageY);else{const gt=.5*(k[0].pageX+k[1].pageX),zt=.5*(k[0].pageY+k[1].pageY);T.set(gt,zt)}}function We(){const gt=k[0].pageX-k[1].pageX,zt=k[0].pageY-k[1].pageY,an=Math.sqrt(gt*gt+zt*zt);M.set(0,an)}function Et(gt){if(k.length==1)w.set(gt.pageX,gt.pageY);else{const an=Gn(gt),ui=.5*(gt.pageX+an.x),Ri=.5*(gt.pageY+an.y);w.set(ui,Ri)}x.subVectors(w,_).multiplyScalar(n.rotateSpeed);const zt=n.domElement;X(2*Math.PI*x.x/zt.clientHeight),ee(2*Math.PI*x.y/zt.clientHeight),_.copy(w)}function lt(gt){if(k.length===1)I.set(gt.pageX,gt.pageY);else{const zt=Gn(gt),an=.5*(gt.pageX+zt.x),ui=.5*(gt.pageY+zt.y);I.set(an,ui)}R.subVectors(I,T).multiplyScalar(n.panSpeed),he(R.x,R.y),T.copy(I)}function rt(gt){const zt=Gn(gt),an=gt.pageX-zt.x,ui=gt.pageY-zt.y,Ri=Math.sqrt(an*an+ui*ui);C.set(0,Ri),L.set(0,Math.pow(C.y/M.y,6*n.zoomSpeed)),le(L.y),M.copy(C)}function kt(gt){n.enabled!==!1&&(k.length===0&&(n.domElement.setPointerCapture(gt.pointerId),n.domElement.addEventListener("pointermove",Pt),n.domElement.addEventListener("pointerup",sn)),function(zt){k.push(zt)}(gt),gt.pointerType==="touch"?function(zt){switch(zn(zt),k.length){case 1:switch(n.touches.ONE){case p.QmN.ROTATE:if(n.enableRotate===!1)return;Ee(),o=i.TOUCH_ROTATE;break;case p.QmN.PAN:if(n.enablePan===!1)return;Ye(),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(n.touches.TWO){case p.QmN.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;n.enableZoom&&We(),n.enablePan&&Ye(),o=i.TOUCH_DOLLY_PAN;break;case p.QmN.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;n.enableZoom&&We(),n.enableRotate&&Ee(),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent(Sd)}(gt):function(zt){let an;switch(zt.button){case 0:an=n.mouseButtons.LEFT;break;case 1:an=n.mouseButtons.MIDDLE;break;case 2:an=n.mouseButtons.RIGHT;break;default:an=-1}switch(an){case p.RsA.DOLLY:if(n.enableZoom===!1)return;(function(ui){M.set(ui.clientX,ui.clientY)})(zt),o=i.DOLLY;break;case p.RsA.ROTATE:if(zt.ctrlKey||zt.metaKey||zt.shiftKey){if(n.enablePan===!1)return;_e(zt),o=i.PAN}else{if(n.enableRotate===!1)return;ge(zt),o=i.ROTATE}break;case p.RsA.PAN:if(zt.ctrlKey||zt.metaKey||zt.shiftKey){if(n.enableRotate===!1)return;ge(zt),o=i.ROTATE}else{if(n.enablePan===!1)return;_e(zt),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent(Sd)}(gt))}function Pt(gt){n.enabled!==!1&&(gt.pointerType==="touch"?function(zt){switch(zn(zt),o){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;Et(zt),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;lt(zt),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;(function(an){n.enableZoom&&rt(an),n.enablePan&&lt(an)})(zt),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;(function(an){n.enableZoom&&rt(an),n.enableRotate&&Et(an)})(zt),n.update();break;default:o=i.NONE}}(gt):gt.buttons?function(zt){switch(o){case i.ROTATE:if(n.enableRotate===!1)return;(function(an){w.set(an.clientX,an.clientY),x.subVectors(w,_).multiplyScalar(n.rotateSpeed);const ui=n.domElement;X(2*Math.PI*x.x/ui.clientHeight),ee(2*Math.PI*x.y/ui.clientHeight),_.copy(w),n.update()})(zt);break;case i.DOLLY:if(n.enableZoom===!1)return;(function(an){C.set(an.clientX,an.clientY),L.subVectors(C,M),L.y>0?le(H()):L.y<0&&ue(H()),M.copy(C),n.update()})(zt);break;case i.PAN:if(n.enablePan===!1)return;(function(an){I.set(an.clientX,an.clientY),R.subVectors(I,T).multiplyScalar(n.panSpeed),he(R.x,R.y),T.copy(I),n.update()})(zt)}}(gt):sn(gt))}function sn(gt){(function(zt){delete j[zt.pointerId];for(let an=0;an<k.length;an++)if(k[an].pointerId==zt.pointerId)return void k.splice(an,1)})(gt),k.length===0&&(n.domElement.releasePointerCapture(gt.pointerId),n.domElement.removeEventListener("pointermove",Pt),n.domElement.removeEventListener("pointerup",sn)),n.dispatchEvent(Xp),o=i.NONE}function hn(gt){n.enabled!==!1&&n.enableZoom!==!1&&o===i.NONE&&(gt.preventDefault(),n.dispatchEvent(Sd),function(zt){let an=0;switch(zt.deltaMode){case 2:an+=1*zt.deltaY;break;case 1:an+=.4*zt.deltaY;break;default:an+=.01*zt.deltaY}zt.deltaY<0?ue(1,an*n.zoomSpeed):zt.deltaY>0&&le(1,-an*n.zoomSpeed),n.update()}(gt),n.dispatchEvent(Xp))}function wn(gt){n.enabled!==!1&&n.enablePan!==!1&&function(zt){let an=!1;switch(zt.code){case n.keys.UP:zt.ctrlKey||zt.metaKey||zt.shiftKey?ee(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):he(0,n.keyPanSpeed),an=!0;break;case n.keys.BOTTOM:zt.ctrlKey||zt.metaKey||zt.shiftKey?ee(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):he(0,-n.keyPanSpeed),an=!0;break;case n.keys.LEFT:zt.ctrlKey||zt.metaKey||zt.shiftKey?X(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):he(n.keyPanSpeed,0),an=!0;break;case n.keys.RIGHT:zt.ctrlKey||zt.metaKey||zt.shiftKey?X(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):he(-n.keyPanSpeed,0),an=!0}an&&(zt.preventDefault(),n.update())}(gt)}function Xn(gt){n.enabled!==!1&&gt.preventDefault()}function zn(gt){let zt=j[gt.pointerId];zt===void 0&&(zt=new p.FM8,j[gt.pointerId]=zt),zt.set(gt.pageX,gt.pageY)}function Gn(gt){const zt=gt.pointerId===k[0].pointerId?k[1]:k[0];return j[zt.pointerId]}this.zoomIn=function(gt){le(1,gt*n.zoomSpeed)},this.zoomOut=function(gt){ue(1,gt*n.zoomSpeed)},n.domElement.addEventListener("contextmenu",Xn),n.domElement.addEventListener("pointerdown",kt),n.domElement.addEventListener("pointercancel",sn),n.domElement.addEventListener("wheel",hn,{passive:!1}),this.update()}}var Fi=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Si=class extends _m{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new p.Pa4(-1e4,-1e4,-1e4),this.clampMax=new p.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(s){super.zoomIn(s)}zoomOut(s){super.zoomOut(s)}dispatchEvent(s){super.dispatchEvent(s)}};Fi([Ae()],Si.prototype,"type",void 0),Fi([Gt()],Si.prototype,"enabled",void 0),Fi([Gt(),Ae()],Si.prototype,"dollyZoom",void 0),Fi([Gt(),Ae()],Si.prototype,"enableDamping",void 0),Fi([jn(),Ae()],Si.prototype,"dampingFactor",void 0),Fi([Gt(),Ae()],Si.prototype,"autoRotate",void 0),Fi([jn(),Ae()],Si.prototype,"autoRotateSpeed",void 0),Fi([Gt(),Ae()],Si.prototype,"enableZoom",void 0),Fi([jn(),Ae()],Si.prototype,"zoomSpeed",void 0),Fi([jn(),Ae()],Si.prototype,"maxZoomSpeed",void 0),Fi([Gt(),Ae()],Si.prototype,"enableRotate",void 0),Fi([jn(),Ae()],Si.prototype,"rotateSpeed",void 0),Fi([Gt(),Ae()],Si.prototype,"enablePan",void 0),Fi([jn(),Ae()],Si.prototype,"panSpeed",void 0),Fi([jn(),Ae()],Si.prototype,"autoPushTarget",void 0),Fi([jn(),Ae()],Si.prototype,"autoPullTarget",void 0),Fi([jn(),Ae()],Si.prototype,"minDistance",void 0),Fi([jn(),Ae()],Si.prototype,"maxDistance",void 0),Fi([jn(),Ae()],Si.prototype,"minZoom",void 0),Fi([jn(),Ae()],Si.prototype,"maxZoom",void 0),Fi([jn(),Ae()],Si.prototype,"minPolarAngle",void 0),Fi([jn(),Ae()],Si.prototype,"maxPolarAngle",void 0),Fi([jn(),Ae()],Si.prototype,"minAzimuthAngle",void 0),Fi([jn(),Ae()],Si.prototype,"maxAzimuthAngle",void 0),Fi([As(),Ae()],Si.prototype,"clampMin",void 0),Fi([As(),Ae()],Si.prototype,"clampMax",void 0),Fi([Ae()],Si.prototype,"screenSpacePanning",void 0),Fi([Ae()],Si.prototype,"keyPanSpeed",void 0),Si=Fi([su("Orbit Controls")],Si);var $o=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Ds extends V.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(e){this._camera.modelObject.userData=e}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>0;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>0;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var i,o;const n={...e};(i=n.position)!=null&&i.isVector3&&(n.position=[n.position.x,n.position.y,n.position.z]),(o=n.target)!=null&&o.isVector3&&(n.target=[n.target.x,n.target.y,n.target.z]),Object.keys(n).forEach(a=>a!=="frustumSize"&&n[a]===void 0&&delete n[a]),Object.assign(this._options,n),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const i=this._options.type==="PerspectiveCamera"?new p.cPb:new p.iKG;i.name=this._camera.name,i.near=this._camera.modelObject.near,i.far=this._camera.modelObject.far,i.zoom=this._camera.modelObject.zoom,i.scale.copy(this._camera.modelObject.scale);const o=this._isActiveCamera;o&&this.deactivateMain(),this._camera=this._setCameraObject(i),t=this._camera.modelObject,o&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let n=this._options.aspect;if(n==="auto"&&(n=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=n),this._options.type==="OrthographicCamera"){const i=this._options.frustumSize;i!==void 0?(t.top=i/2,t.bottom=-i/2,t.left=n*i/2,t.right=-n*i/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Ra(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,t,n){super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=a=>{this.setDirty(a)},this._interactionsEnabled=!0,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new p.Pa4(0,0,10),this._target=new p.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(a,c)=>{const u=new Si(a,c.ownerDocument?c:c.documentElement);return u.screenSpacePanning=!0,u}]]),this._positionWorld=new p.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>this._camera.userData.autoNearFar??!0,setValue:a=>this._camera.userData.autoNearFar=a,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Min Near":"Near",getValue:()=>this._camera.userData.minNearPlane??.5,setValue:a=>this._camera.userData.minNearPlane=a,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Max Far":"Far",getValue:()=>this._camera.userData.maxFarPlane??1e3,setValue:a=>this._camera.userData.maxFarPlane=a,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(a=>({label:a===""?"none":a,value:a})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var a;return(a=this._controls)!=null&&a.zoomIn?{type:"button",label:"Zoom in",value:()=>{var c;(c=this._controls)==null||c.zoomIn(1)}}:{}},()=>{var a;return(a=this._controls)!=null&&a.zoomOut?{type:"button",label:"Zoom out",value:()=>{var c;(c=this._controls)==null||c.zoomOut(1)}}:{}},()=>{var a;return(a=this._controls)==null?void 0:a.uiConfig}]},this.assetType="model",this.uuid=p.M8C.generateUUID(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=n??document.body;const i={...t};this._camera=this._setCameraObject(e??(i.type==="OrthographicCamera"?new p.iKG(-1,1,1,-1):new p.cPb)),this._camera.modelObject.userData.iCamera=this;const o=e;e&&(o.isPerspectiveCamera?(i.fov=o.fov,i.focus=o.focus,i.aspect=o.aspect<=0||o.userData.autoAspect?"auto":o.aspect,i.zoom=o.zoom):o.isOrthographicCamera&&(i.left=o.left,i.right=o.right,i.top=o.top,i.bottom=o.bottom,i.zoom=o.zoom),this.near=o.near,this.far=o.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(i)}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(e=4){var t;(t=this._controls)!=null&&t.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new p.Pa4))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var t,n;const e=this._options.controlsMode;this._controls=((t=this._controlsCtors.get(e))==null?void 0:t(this._camera.modelObject,this._container))??void 0,this._controls||e===""||console.error("Unable to create controls with mode "+e+". Are you missing a plugin?"),(n=this._controls)==null||n.addEventListener("change",this.setDirty),this._controlsMode=this._controls?e:""}_disposeCameraControls(){var e,t;this._controlsMode,(e=this._controls)==null||e.removeEventListener("change",this.setDirty),(t=this._controls)==null||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,n;if(this._options.controlsEnabled){const i=this._options.controlsMode;this._controls?this._controlsMode===i&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=i}if(this._controls){const i=this.interactionsEnabled;this._controls.enabled=i,i&&this._camera.modelObject.up.copy(p.Tme.DEFAULT_UP)}e&&this.setDirty(),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t,"postFrame",!1,1)})}activateMain(e=!0){var t,n;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new p.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(n=(t=this._camera).setDirty)==null||n.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var n,i;const t=this.target;(i=(n=this._controls)==null?void 0:n.target)==null||i.set(t.x,t.y,t.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(t),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t,n,i,o;return(n=(t=e.uniforms.cameraPositionWorld)==null?void 0:t.value)==null||n.copy(this._positionWorld),(o=(i=e.uniforms.cameraNearFar)==null?void 0:i.value)==null||o.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){const t={};return ys(t,this.userData),Object.assign({userData:t},xi(this,!0,e))}fromJSON(e,t){return e.userData&&(ys(this.userData,e.userData),delete(e={...e}).userData),Di(e,this,!0,t),this.positionUpdated(!1),this.refreshCameraOptions(),this.setDirty({change:"deserialize"}),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}$o([Ae("camControls")],Ds.prototype,"_controls",void 0),$o([(0,V.onChange)(Ds.prototype._nearFarChanged)],Ds.prototype,"near",void 0),$o([(0,V.onChange)(Ds.prototype._nearFarChanged)],Ds.prototype,"far",void 0),$o([Ae("camOptions")],Ds.prototype,"_options",void 0),$o([Ae("position")],Ds.prototype,"_position",void 0),$o([Ae("target")],Ds.prototype,"_target",void 0);var xl=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class is extends p.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let n=this._cameras.indexOf(e);n<0&&(this._cameras.push(e),n=this._cameras.length-1),this._activeCamera=n}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get renderCamera(){return this._renderCamera??this.activeCamera}set renderCamera(e){const t=this._renderCamera;this._renderCamera=e,this.dispatchEvent({type:"renderCameraChange",lastCamera:t,camera:e})}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Ie,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new Ds(new p.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Ra(new p.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new p.GQ(this.getBounds())}addModel(e,t={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e==null?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let i=!1;switch(n){case"model":i=e.modelObject.isCamera,i&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e,options:t}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:i=!1}={}){const o=e;o?(t&&!o.userData.autoScaled&&fn(o,o.userData.autoScaleRadius||n),o.traverse(a=>{a.isMesh&&!a.userData.__keepShadowDef&&(a.castShadow=!0,a.receiveShadow=!0,a.userData.__keepShadowDef=!0)}),i?this.modelObject.add(o):this.modelRoot.add(o),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(e=>{var t;(e.dispose??((t=e.modelObject)==null?void 0:t.removeFromParent))()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;((e=this.environment)==null?void 0:e.mapping)===p.xfE&&(this.environment.mapping=p.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map(t=>Ra(t))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);e.assetType!=="texture"&&console.warn("Environment asset not processed",e);const t=e.textureObject||e;this.environment=t}getEnvironment(){return this.environment}setBackground(e){let t;if(!e||e.assetType==="texture"||e.isTexture||e.isColor||e==="environment")t=((e==null?void 0:e.assetType)==="texture"||e.isTexture)&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);t=new p.Ilk(e)}this.background=t}setBackgroundColor(e){this.backgroundColor=e?new p.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate||e!=null&&e.refreshScene?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(e){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({...e,type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var t,n,i;return e.sceneUpdate===!1&&e.refreshScene===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(i=(n=(t=this.boxHelper)==null?void 0:t.box)==null?void 0:n.copy)==null||i.call(n,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new p.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),(e=this.environment)==null||e.dispose()}findObjectsByName(e,t){const n=[];return(t??this.modelObject).traverse(i=>{i.name===e&&n.push(i)}),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var i;const n=e.lightObject;n&&((i=n.children)==null||i.length,t?this.add(n):this.modelRoot.add(n))}getBounds(e=!1,t=!0,n=!0,i){return new Ie().expandByObject(this.modelObject,e,t,o=>!(!n||o.assetType!=="widget")||((i==null?void 0:i(o))??!1))}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;if(e.cameraObject.userData.autoNearFar===!1)return e.near=e.cameraObject.userData.minNearPlane??.5,void(e.far=e.cameraObject.userData.maxFarPlane??1e3);const t=this.getBounds(!1),n=e.cameraObject.getWorldPosition(new p.Pa4).sub(t.getCenter(new p.Pa4)),i=1.5*t.getSize(new p.Pa4).length()/2,o=Math.max(.1,-n.clone().normalize().dot(e.cameraObject.getWorldDirection(new p.Pa4))),a=n.length(),c=Math.max(Math.max(e.cameraObject.userData.minNearPlane??.5,.001),o*(a-i)),u=Math.min(Math.max(c+i,o*(a+i)),e.cameraObject.userData.maxFarPlane??1e3);e.near=c,e.far=u}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return xi(this,!0,e)}fromJSON(e,t){const n=e.environment;return n!==void 0&&(this.setEnvironment(Di(n,this.getEnvironment(),!1,t)),delete e.environment),Di(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera.userData.minNearPlane??.5}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}xl([Ae()],is.prototype,"defaultCamera",void 0),xl([(0,V.onChange2)(is.prototype.setDirty),Ae()],is.prototype,"envMapIntensity",void 0),xl([(0,V.onChange2)(is.prototype.setDirty),Ae()],is.prototype,"fixedEnvMapDirection",void 0),xl([(0,V.onChange2)(is.prototype.setDirty),Ae()],is.prototype,"backgroundIntensity",void 0),xl([Ae(),(0,V.onChange)(is.prototype._onEnvironmentChange.name)],is.prototype,"environment",void 0),xl([Ae(),(0,V.onChange)(is.prototype._onBackgroundChange)],is.prototype,"background",void 0),xl([Ae(),(0,V.onChange)(is.prototype._onBackgroundChange)],is.prototype,"backgroundColor",void 0);function Sn(s,e,t,{replaceAll:n=!1,prepend:i=!1,append:o=!1}={}){if(!s.includes(e))return console.error(`${e} not found in shader`),s;let a=t;return i?a=t+e:o&&(a=e+t),n?s.replaceAll(e,a):s.replace(e,a)}class rs{static ApplyMaterialExtensions(e,t,n,i){for(const o of n)this.ApplyMaterialExtension(e,t,o,i)}static ApplyMaterialExtension(e,t,n,i){let o=(0,V.getOrCall)(n.parsFragmentSnippet,i,e)??"";o.length&&(t.fragmentShader=Sn(t.fragmentShader,this.VoidMain,`
`+o+`
`,{prepend:!0})),o=(0,V.getOrCall)(n.parsVertexSnippet,i,e)??"",o.length&&(t.vertexShader=Sn(t.vertexShader,this.VoidMain,`
`+o+`
`,{prepend:!0})),n.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,n.extraUniforms)),n.extraDefines&&function(a,c){let u=!1;c.materialObject&&c.materialObject.defines===void 0&&(c.materialObject.defines={});const d=Object.entries(a);for(const[m,g]of d)g===void 0?c.materialObject.defines[m]!==void 0&&(delete c.materialObject.defines[m],u=!0):c.materialObject.defines[m]!==g&&(c.materialObject.defines[m]=g,u=!0);u&&(c.materialObject.needsUpdate=!0)}(n.extraDefines,e),n.shaderExtender&&n.shaderExtender(t,e,i),e.lastShader=t}static CacheKeyForExtensions(e,t){let n="";for(const i of t)n+=this.CacheKeyForExtension(e,i);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),t.extraDefines&&Object.values(t.extraDefines).forEach(i=>n+=i),n}static RegisterExtensions(e,t){const n=[];if(t)for(const i of t)i.isCompatible&&i.isCompatible(e)&&(n.push(i),i.uuid||(i.uuid=ns()),i.__setDirty||(i.__setDirty=()=>{i.updateVersion||(i.updateVersion=0),i.updateVersion++}),i.setDirty||(i.setDirty=i.__setDirty));return e.materialExtensions=n,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",i=>function(o,{object:a,renderer:c}){var u;if(o.materialExtensions)for(const d of o.materialExtensions){if((u=d.onObjectRender)==null||u.call(d,a,o,c),o.lastShader){const m=(0,V.getOrCall)(d.updaters)||[];for(const g of m)g&&g.updateShaderProperties(o.lastShader)}d.updateVersion!==o.materialObject.userData["_"+d.uuid+"_version"]&&(o.materialObject.userData["_"+d.uuid+"_version"]=d.updateVersion,o.materialObject.needsUpdate=!0)}}(e,i))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",i=>function(o,{object:a,renderer:c}){var u;if(o.materialExtensions)for(const d of o.materialExtensions)(u=d.onAfterRender)==null||u.call(d,a,o,c)}(e,i))),n}}rs.VoidMain="void main()";class Bc extends p.jyz{constructor(e,t=!1){super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=rs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...rs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){rs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+rs.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class ic extends Bc{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class Yp extends ic{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,colorSpace:p.aCh})),this.setDirty())}_setUniformTexSize(e,t){var a,c;if(!t||!e)return;const n=((a=t.image)==null?void 0:a.width)??512,i=((c=t.image)==null?void 0:c.height)??512,o=e.value;o.isVector2||console.warn("uniform is not a Vector2"),o&&Math.abs(o.x-n)+Math.abs(o.y-i)>.1&&(o.x=n,o.y=i,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,i,o){var a,c;this._setUniformTexSize(this.uniforms.screenSize,(a=e.getRenderTarget())==null?void 0:a.texture);for(const u of this.textures){const d=u.id,m=(c=this.uniforms[d])==null?void 0:c.value;m&&(this._setUniformTexSize(this.uniforms[d+"Size"],m),m.colorSpace!==u.colorSpace&&(u.colorSpace=m.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,i,o)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(n=>`uniform sampler2D ${n.id}; 
`+Tt(n.id??"input",n.colorSpace??p.aCh)).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}function rc(s,...e){const t=s.fragmentShader;return new Yp({defines:Object.assign({},s.defines),uniforms:s.uniforms,vertexShader:s.vertexShader,fragmentShader:t},e)}class Fr extends Xe{constructor(e,...t){super(e.isMaterial?e:rc(e,...t),t.length<1?Fr.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,n,i;(t=(e=this.material)==null?void 0:e.dispose)==null||t.call(e),(i=(n=this.fsQuad)==null?void 0:n.dispose)==null||i.call(n),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(t=>t==null?void 0:t.updateShaderProperties(this.material)))}render(e,t,n,i,o){this.enabled&&super.render(e,t||null,n,i,o)}}Fr.DEFAULT_TEX_ID="tDiffuse",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([Gt("Enabled"),Ae()],Fr.prototype,"enabled",void 0);class ou extends Je{constructor(e,t,n,i,o){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=o!==void 0?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new p.Ilk}render(e,t,n,i,o,a){if(!this.scene||!this.camera)return;const c=e.autoClear;let u,d;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(d=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),u=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),a){const m=e.getContext();m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,a)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),a){const m=e.getContext();m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,u),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=d),e.autoClear=c}}class au extends Fr{constructor(e,t="c = a + b;",n="",i){super({vertexShader:qe.vertexShader,fragmentShader:V.glsl`
                varying vec2 vUv;
                
                ${n}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:i},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class Kp extends ic{constructor(e=!0){super({vertexShader:`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#glMarker mainStart
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.);
#include <map_fragment>
#ifdef USE_ALPHAMAP
float alphaMapValue=
#ifdef ALPHA_I_RGBA_PACKING
1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv));
#else
texture2D(alphaMap,vAlphaMapUv).g;
#endif
#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
diffuseColor.a*=1.-alphaMapValue;
#else
diffuseColor.a*=alphaMapValue;
#endif
#endif
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:p.rDY.merge([p.rBU.common,p.rBU.bumpmap,p.rBU.normalmap,p.rBU.displacementmap,{cameraNearFar:{value:new p.FM8(.1,1e3)},flags:{value:new p.Ltg(255,255,255,255)}}]),defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?p.LSk:p.v9Y}),this.normalMapType=p.IOt,this.flatShading=!1,this._updaters=[]}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o);let a=o.material;Array.isArray(a)&&(a=a[0]),this.uniforms.map.value=(a==null?void 0:a.map)??null,this.uniforms.map.value&&e.materials.refreshTransformUniform(this.uniforms.map.value,this.uniforms.mapTransform),this.uniforms.alphaMap.value=(a==null?void 0:a.alphaMap)??null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.uniforms.alphaTest.value=!a||!a.alphaTest||a.alphaTest<1e-7?.001:a.alphaTest,this.uniforms.displacementMap.value=(a==null?void 0:a.displacementMap)??null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(a==null?void 0:a.displacementScale)??1,this.uniforms.displacementBias.value=(a==null?void 0:a.displacementBias)??0,this.uniforms.bumpMap.value=(a==null?void 0:a.bumpMap)??null,this.uniforms.bumpMap.value&&e.materials.refreshTransformUniform(this.uniforms.bumpMap.value,this.uniforms.bumpMapTransform),this.uniforms.bumpScale.value=(a==null?void 0:a.bumpScale)??1,this.uniforms.normalMap.value=(a==null?void 0:a.normalMap)??null,this.uniforms.normalMap.value&&e.materials.refreshTransformUniform(this.uniforms.normalMap.value,this.uniforms.normalMapTransform),this.uniforms.normalScale.value&&this.uniforms.normalScale.value.copy((a==null?void 0:a.normalScale)??new p.FM8(1,1)),this.normalMapType=(a==null?void 0:a.normalMapType)??p.IOt,this.flatShading=(a==null?void 0:a.flatShading)??!1,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(a!=null&&a.userData.matId?a==null?void 0:a.userData.matId:0)/255,this._updaters.forEach(u=>{u(o,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let c=this.uniforms.alphaMap.value?1:void 0;c!==this.defines.USE_ALPHAMAP&&(c===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=c,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),c=this.uniforms.displacementMap.value?1:void 0,c!==this.defines.USE_DISPLACEMENTMAP&&(c===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=c,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),c=a.userData.ALPHA_I_RGBA_PACKING?1:void 0,c!==this.defines.ALPHA_I_RGBA_PACKING&&(c===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=c,this.needsUpdate=!0),c=a.userData.forcedLinearDepth??void 0,c!==this.defines.FORCED_LINEAR_DEPTH&&(c===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=c,this.needsUpdate=!0),this.side=a.side??p.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const t=this._updaters.indexOf(e);t!==-1&&this._updaters.splice(t,1)}}var vo=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class En extends V.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=xi(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(Di(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,t,n;return((t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetManager"))==null?void 0:t.exportPluginPreset(this))??((n=this.toJSON)==null?void 0:n.call(this))}async importState(e){var n,i;const t=(n=this._viewer)==null?void 0:n.getPluginByType("AssetManager");t?await t.importPluginPreset(e,this):(i=this.fromJSON)==null||i.call(this,e)}storeState(e,t,n){(t=t||(window?window.localStorage:void 0))?(n===void 0&&(n=this.exportState()),n&&t.setItem(this._storeKey(e),JSON.stringify(n))):console.warn("Unable to store state")}async loadState(e,t){if(!(t=t||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const n=t.getItem(this._storeKey(e));n&&await this.importState(JSON.parse(n))}}function sc(s,e,t){return{...e,get dirty(){return e.dirty||!1},set dirty(n){(0,V.safeSetProperty)(e,"dirty",n,!0)},update(){var n,i,o;this.passObject.enabled&&((i=(n=this.passObject).updateShaderProperties)==null||i.call(n,(0,V.getOrCall)(t)),(o=e.update)==null||o.call(this))},onRegister(n){var i,o,a;this.passObject.materialExtension&&((o=(i=s.getPluginByType("AssetManager"))==null?void 0:i.materials)==null||o.registerMaterialExtension(this.passObject.materialExtension)),(a=e.onRegister)==null||a.call(this,n)},onUnregister(n){var i,o,a;this.passObject.materialExtension&&((o=(i=s.getPluginByType("AssetManager"))==null?void 0:i.materials)==null||o.unregisterMaterialExtension(this.passObject.materialExtension)),(a=e.onUnregister)==null||a.call(this,n)},dispose(){var n,i,o;(i=(n=this.passObject).dispose)==null||i.call(n),(o=e.dispose)==null||o.call(this)}}}class ea extends En{_update(e){var t;return((t=this._pass)==null?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t;return((t=(e=this._pass)==null?void 0:e.passObject)==null?void 0:t.enabled)??this._enabledTemp}set enabled(e){var t;(t=this._pass)!=null&&t.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(n){n&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=sc(e,t),t.passObject.onDirty!==void 0&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,n;this._pass&&e.renderer.unregisterPass(this._pass),(n=(t=this._pass)==null?void 0:t.dispose)==null||n.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=this.pass;return n&&(t.pass=xi((n==null?void 0:n.passObject)??n,!1,e)),t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.pass){const n=this.pass;n&&Di(e.pass,(n==null?void 0:n.passObject)??n,!1,t)}return this}}(function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Ae()],ea.prototype,"enabled",null);class Jp extends ou{constructor(e,t,n=new p.Ilk(1,1,1),i=1){super(void 0,void 0,t,n,i),this.target=e,this._transparentMats=new Set,this._transmissiveMats=new Set}render(e,t,n,i,o){var d;const a=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel();(d=this.scene)==null||d.traverse(({material:m})=>{m&&((m.transparent&&m.userData.renderToDepth||!m.transparent&&m.transmission===0&&m.userData.renderToDepth===!1)&&(this._transparentMats.add(m),m.transparent=!m.transparent),Math.abs(m.transmission||0)>0&&m.userData.renderToDepth&&(this._transmissiveMats.add([m,m.transmission]),m.transmission=0))}),Vt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,i,o)),this._transparentMats.forEach(m=>m.transparent=!m.transparent),this._transparentMats.clear(),this._transmissiveMats.forEach(([m,g])=>m.transmission=g),this._transmissiveMats.clear(),e.setRenderTarget(a,c,u)}}class Ii extends ea{get material(){return this._material}passCtor(e){var i,o,a;const t=((i=this._viewer)==null?void 0:i.renderer.isWebGL2)&&this.renderFlagsBuffer,n=e.renderer.createTarget({depthBuffer:!0,samples:((o=this._viewer)==null?void 0:o.useGBufferDepth)&&((a=this._viewer)==null?void 0:a.renderer.composerTarget.samples)||0,type:p.ywz,textureCount:t?2:1,depthTexture:this.renderDepthTexture,depthTextureType:this.depthTextureType});return Array.isArray(n.texture)?(n.texture[0].name="gbufferDepthNormal",n.texture[1].name="gbufferFlags",this._gbufferTextures=n.texture):(n.texture.name="gbufferDepthNormal",this._gbufferTextures.push(n.texture)),this._gbufferTarget=n,this._material=new Kp(t),this._material.userData.isGBufferMaterial=!0,new Jp(n,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0,t=!1,n=p.JQ4){super(),this.renderFlagsBuffer=e,this.renderDepthTexture=t,this.depthTextureType=n,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getDepthTexture(){var e;return(e=this._gbufferTarget)==null?void 0:e.depthTexture}getUnpackSnippet(){return vo}updateShaderProperties(e){var t;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=this.getDepthNormal()??void 0:(t=this._viewer)==null||t.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=this.getFlagsTexture()??void 0;const n=e.uniforms.tGBufferFlags.value?1:0;n!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=n,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}Ii.PluginType="GBuffer";class Zp extends ou{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:p.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?p.cLu:p.ywz,format:p.wk1,minFilter:p.wem,magFilter:p.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,t=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new p.Ilk(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new au({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,t,n,i,o){var g;let a=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,i,o),this.needsSwap=a,void(e.userData.mainRenderPass=void 0);const c=e.userData;c||console.error("threejs is not patched?");const u=this._viewer.useGBufferDepth;let d;if(u){const _=(g=this._viewer.getPlugin(Ii))==null?void 0:g.getTarget();if(_){const w=e.properties.get(_);d=w.__webglDepthRenderbuffer||w.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let m=(_=!1)=>{super.render(e,void 0,n,i,o,d)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(a=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const _=e.autoClearDepth;e.autoClearDepth=!u,Vt(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},m),e.autoClearDepth=_}if(!u){const _=e.properties.get(n);d=_.__webglDepthRenderbuffer||_.__webglDepthbuffer}m=()=>{super.render(e,void 0,this.transparentTarget,i,o,d)};{const _=this.clear,w=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,Vt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},m),this.clear=_,e.autoClearDepth=w}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,o),a=!0);{const _=this.clear;this.clear=!1,c.transmissionRenderTarget=a?t:n,c.blurTransmissionTarget=this.blurTransmissionTarget&&c.transmissionRenderTarget.samples===0,Vt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},m),c.blurTransmissionTarget=void 0,c.transmissionRenderTarget=void 0,this.clear=_}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,o),a=!0)}}else{{const _=this.clear,w=e.autoClearDepth;e.autoClearDepth=!u,this.clear=!0,Vt(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},m),this.clear=_,e.autoClearDepth=w}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const _=this.clear;this.clear=!1,c.transmissionRenderTarget=t,c.blurTransmissionTarget=this.blurTransmissionTarget,Vt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},m),c.blurTransmissionTarget=void 0,c.transmissionRenderTarget=void 0,this.clear=_}a=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=a,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function lu(s,e){return s.multiplyScalar(s.w*e),s.w=1,s}function El(s,e){return lu(s,e),new p.Ilk(s.x,s.y,s.z)}function Oc(s,e){const t=Math.max(s.x,Math.max(s.y,s.z));let n=Math.max(Math.min(t/e,1),0);return n=Math.ceil(255*n)/255,s.divideScalar(n*e),s.w=n,s}function Cd(s,e){return Oc(new p.Ltg(s.r,s.g,s.b,1),e)}const oc={name:"",blending:p.bdR,side:p.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:p.k74,blendDst:p.LgZ,blendEquation:p.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:p.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:p.cum,stencilRef:0,stencilFuncMask:255,stencilFail:p.x5V,stencilZFail:p.x5V,stencilZPass:p.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},ac={...oc,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:p.IOt,normalScale:new p.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},cu={...ac,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new p.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new p.Ilk(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new p.Ilk(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new p.Ilk(1,1,1),specularColorMap:null};class Hs extends p.EJi{constructor(e){super(e),this.typeSlug=Hs.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=rs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...rs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},In(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},In(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},In(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},In(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",p.IOt],["ObjectSpace",p.PA7]].map(e=>({label:e[0],value:e[1]}))},In(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},In(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},In(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},In(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},In(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},In(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},In(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},In(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},In(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},In(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",p.BVF],["Always",p.Se2],["Less",p.Zr5],["LessEqual",p.vCF],["Equal",p.eD],["GreaterEqual",p.ksN],["Greater",p.w$m],["NotEqual",p.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",p.jFi],["Normal",p.bdR],["Additive",p.WMw],["Subtractive",p.N4l],["Multiply",p.M5h]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},In(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},In(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},In(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},In(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},In(this,"iridescenceThicknessMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",p.Wl3],["Back",p._Li],["Double",p.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(xi(this,!1),null,2)],{type:"application/json"});(0,V.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const o of i)e.vertexShader=Sn(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=Sn(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);rs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+rs.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o});const a=this.userData.inverseAlphaMap?1:0;a!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=a,this.needsUpdate=!0)}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}copyProps(e,t=!1,n=!0){if(!t&&!["MeshStandardMaterial",Hs.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const i={},o=Array.from(Object.keys(cu));(0,V.copyProps)(e,i,o);const a=i.userData;delete i.userData;for(const c of Object.keys(i))i[c]===void 0&&delete i[c];if(this.setValues(i),n)for(const c of Qi)this.userData[c]!==void 0&&this.userData[c];return a&&qi(this.userData,a),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var o,a;const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},qi(n.userData,t),n.userData.uuid=this.userData.uuid;const i=e||{textures:Object.fromEntries(((o=n.textures)==null?void 0:o.map(c=>[c.uuid,c]))||[]),images:Object.fromEntries(((a=n.images)==null?void 0:a.map(c=>[c.uuid,c]))||[])};n.userData=xi(n.userData,!1,i),e||(Object.keys(i.textures).length>0&&(n.textures=Object.values(i.textures)),Object.keys(i.images).length>0&&(n.images=Object.values(i.images))),n.type=Hs.TYPE;for(const c of Object.keys(n))n[c]===void 0&&delete n[c];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Hs.TypeSlug="pmat",Hs.TYPE="MeshStandardMaterial2";const Md={...oc,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:p.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class Sl extends p.vBJ{constructor(e){super(e),this.typeSlug=Sl.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.materialExtensions=rs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...rs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},In(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",p.jFi],["Normal",p.bdR],["Additive",p.WMw],["Subtractive",p.N4l],["Multiply",p.M5h]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},In(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},In(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},In(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",p.Wl3],["Back",p._Li],["Double",p.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(xi(this,!1),null,2)],{type:"application/json"});(0,V.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const o of i)e.vertexShader=Sn(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=Sn(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);rs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+rs.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",Sl.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={},i=Array.from(Object.keys(Md));(0,V.copyProps)(e,n,i);const o=n.userData;delete n.userData;for(const a of Object.keys(n))n[a]===void 0&&delete n[a];return this.setValues(n),o&&qi(this.userData,o),this.setDirty(),this}toJSON(e){var o,a;const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},qi(n.userData,t),n.userData.uuid=this.userData.uuid;const i=e||{textures:Object.fromEntries(((o=n.textures)==null?void 0:o.map(c=>[c.uuid,c]))||[]),images:Object.fromEntries(((a=n.images)==null?void 0:a.map(c=>[c.uuid,c]))||[])};n.userData=xi(n.userData,!1,i),e||(Object.keys(i.textures).length>0&&(n.textures=Object.values(i.textures)),Object.keys(i.images).length>0&&(n.images=Object.values(i.images))),n.type=Sl.TYPE;for(const c of Object.keys(n))n[c]===void 0&&delete n[c];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Sl.TypeSlug="bmat",Sl.TYPE="MeshBasicMaterial2";const Td={materialType:Hs.TYPE,name:"standard",color:"#ffffff"},$a={materialType:Sl.TYPE,name:"basic",color:"#ffffff"},Id={[Hs.TYPE]:Td.name,MeshStandardMaterial:Td.name,MeshPhysicalMaterial:Td.name,[Sl.TYPE]:$a.name,MeshBasicMaterial:$a.name};class Cl extends V.SimpleEventDispatcher{constructor(){super(),this._templates=[Td,$a],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||t.assetType!=="material")return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),i=[];n.forEach(o=>{const a=o.userData.__appliedMaterials;a==null||a.delete(t),a&&o.userData.disposeOnIdle!==!1&&a.size===0&&i.push(o)}),i.forEach(o=>{o.dispose()}),this.unregisterMaterial(t)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,t??{})}generateFromTemplateType(e,t){const n=this._templates.find(i=>i.materialType===e);if(n)return this._generateFromTemplate(n,t??{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach(t=>{this._getMapsForMaterial(t).forEach(n=>{let i=n.userData.__appliedMaterials;i||(n.userData.__appliedMaterials=i=new Set),n.addEventListener("update",()=>t.dispatchEvent({type:"textureUpdate",texture:n})),i.add(t)})})}_getMapsForMaterial(e){const t=new Set;for(const n of Object.values(e))n&&n.isTexture&&t.add(n);for(const n of Object.values(e.userData??{}))n&&n.isTexture&&t.add(n);return t}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=ns());const t=this._templates.find(n=>n.templateUUID===e.templateUUID);t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(e=!0){const t=this._materials;this._materials=[];for(const n of t)e||!n.userData.runtimeMaterial?n.dispose():this._materials.push(n)}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e,t=!1){return this._materials.filter(n=>typeof e!="string"||t?n.name.match(typeof e=="string"?"^"+e+"$":e)!==null:n.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){const n=this._processModel(e,t);return(0,V.safeSetProperty)(e,"modelObject",n),e}_processMaterial(e,t){var i,o;if(!e)return;if((i=e.materialObject)!=null&&i.isMaterial)return e;let n=e.mmMaterial;if(!n){const a=((o=e.userData)==null?void 0:o.uuid)||e.uuid;if(n=this.findMaterial(a),n)n.copyProps(e);else{const c=t.useSourceMaterial===!1||!e.isMaterial,u=t.materialTemplate||(c?"standard":Id[e.type]||"standard");n=this.generateFromTemplate(u,c?{}:e)}e.mmMaterial=n}return n}processMaterial(e,t){return e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),t.register!==!1&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,n=!0,i=!1){const o=xi(e,!1),a=JSON.stringify(o,null,n?0:2),c=(t||e.name||"physical_material")+"."+e.typeSlug,u=new File([a],c,{type:"application/json"});return i&&(0,V.downloadFile)(u),u}applyMaterial(e,t){var a;const n=Object.getPrototypeOf(e).constructor.TYPE;let i=this.findMaterialsByName(t,!0);(!i||i.length<1)&&(i=[this.findMaterial(t)]);let o=!1;for(const c of i)if(c&&!c.userData.__isVariation&&c!==e)if(Object.getPrototypeOf(c).constructor.TYPE===n){const u=c.name;c.copyProps(e),c.name=u,o=!0}else{const u=c["__"+n]||this.generateFromTemplateType(n);if(!u)continue;const d=c.name;u.copyProps(e),u.name=d;const m=c.userData.__appliedMeshes;for(const g of[...m??[]])(a=g==null?void 0:g.setMaterial)==null||a.call(g,u),g&&(o=!0);c["__"+n]=u}return o}}class bs extends Cl{_generateFromTemplate(e,t){var c,u,d,m,g;let n;const i={...e};i.customMaterialExtensions=[...i.customMaterialExtensions??[],...this._materialExtensions];const o=(t==null?void 0:t.metadata)&&(t==null?void 0:t.metadata.version)<=4.5;o&&(p.epp.enabled=!1);let a={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&(0,V.copyProps)(t,i,Array.from(Object.keys(cu))),(t==null?void 0:t.type)==="MeshBasicMaterial"&&(i.roughness=.9,i.metalness=0,(c=i.userData)!=null&&c.uuid&&delete i.userData.uuid),a=(u=i.userData)==null?void 0:u.uuid,a&&delete i.userData.uuid,n=new Hs({customMaterialExtensions:i.customMaterialExtensions}).fromJSON(i,void 0,!0),a&&(n.uuid=a),n.userData.uuid=n.uuid,n.setDirty(),t!=null&&t.isMaterial&&t.userData!==void 0&&(t.userData.iMaterial=n);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&(0,V.copyProps)(t,i,Array.from(Object.keys(Md))),a=(d=i.userData)==null?void 0:d.uuid,a&&delete i.userData.uuid,n=new Sl({customMaterialExtensions:i.customMaterialExtensions}).fromJSON(i,void 0,!0),a&&(n.uuid=a,i.userData.uuid=a),n.userData.uuid=n.uuid,n.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:a=null,t&&t.userData&&(a=t.userData,delete t.userData),n=((m=e.generator)==null?void 0:m.call(e,i,t))||void 0,t&&a&&(t.userData=a),a&&n&&(qi(n.userData,a),a!=null&&a.uuid&&(n.uuid=a.uuid),a=null),n&&(n.userData.uuid=n.uuid)}if(n){t.runtimeMaterial&&(n.userData.runtimeMaterial=!0);const _=n;if(n.clone=()=>{_.userData.cloneId||(_.userData.cloneId="0"),_.userData.cloneCount||(_.userData.cloneCount=0),_.userData.cloneCount+=1;const w=this.generateFromTemplate(e.name);return w&&(w.copyProps(_),w.userData.cloneId=w.userData.cloneId+"_"+_.userData.cloneCount,w.userData.cloneCount=0,w.name=w.name+"_"+w.userData.cloneId,w.userData.uuid=w.uuid),w==null?void 0:w.materialObject},t){let w=this.findMaterial(t==null?void 0:t.uuid);w&&this.unregisterMaterial(w),w=this.findMaterial((g=t==null?void 0:t.materialObject)==null?void 0:g.uuid),w&&this.unregisterMaterial(w)}}return o&&(p.epp.enabled=!0),n?this.registerMaterialObject(n):void 0}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let i=!0;Array.isArray(n)||(n=[n],i=!1);const o=[];for(const a of n){const c=this._processMaterial(a,t);o.push(c==null?void 0:c.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(i?o:o[0]))}if(t.recursive!==!1)for(let i=0;i<e.modelObject.children.length;i++)e.modelObject.children[i]=this._processModel(e.modelObject.children[i],t);return e}}class Br{ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e):t}constructor(e,t,n,i){this.cls=e,this.ext=t,this.root=n,this.onCtor=i}}class No{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:t=!1,autoCenter:n=!1,autoScale:i=!1,autoScaleRadius:o=2,license:a=""}={}){if(this.assetType="model",this._modelObject=Ra(new p.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!n||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||n||(e.userData.isCentered=!0):Kt(e),this._modelObject=e;else{n&&console.error("cannot use pseudoCenter and autoCenter at the same time");const c=new Ie().expandByObject(e,!0,!0).getCenter(new p.Pa4);this._modelObject.position.copy(c).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}i&&!this._modelObject.userData.autoScaled?fn(this._modelObject,e.userData.autoScaleRadius||o):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=a}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,n,i,o;(n=(t=this._modelObject)==null?void 0:t.setDirty)==null||n.call(t,e),(o=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||o.call(i,"postFrame",!0)}setMaterial(e){var t,n;return this._modelObject.isMesh?((n=(t=this._modelObject).setMaterial)==null?void 0:n.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var n,i;if(this._modelObject.isMesh)return(i=(n=this._modelObject).setGeometry)==null?void 0:i.call(n,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=nh(this._modelObject,!1)),this._uiConfig}clone(){return new No(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function $p(s,e){return[s.modelObject,...s.modelObject.children].forEach(t=>{Ra(t,t!==s.modelObject?s:void 0,e)}),s}class ta{constructor(){this._processors=new Map}add(e,t){var n;this._processors.has(e)||this._processors.set(e,[]),(n=this._processors.get(e))==null||n.push(t)}remove(e,t){const n=this._processors.get(e),i=(n==null?void 0:n.indexOf(t))||(n==null?void 0:n.findIndex(o=>o.process&&o.process===t.process||o.processAsync&&o.processAsync===t.processAsync));!n||!i||i<0||n.splice(i,1)}get(e){return this._processors.get(e)??[]}async process(e,t,n){var a,c;const i=this.get(e),o=t.assetType;for(const u of i)u.forAssetType===o&&(t=((a=u.process)==null?void 0:a.call(u,t,n))??t,t=await((c=u.processAsync)==null?void 0:c.call(u,t,n))??t);return t}dispose(){this._processors.clear()}}class Jn extends p.hH6{load(e,t,n,i){return super.load(e,o=>{try{if(typeof o!="string")throw new Error("Invalid JSON");t==null||t(JSON.parse(o))}catch(a){i==null||i(a)}},n,i)}}class fr extends p.yxD{constructor(e){super(e),this.type=p.cLu}parse(e){const t=function(u,d){switch(u){case 1:console.error("THREE.RGBELoader Read Error: "+(d||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(d||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(d||""));break;default:console.error("THREE.RGBELoader: Error: "+(d||""))}return-1},n=function(u,d,m){d=d||1024;let g=u.pos,_=-1,w=0,x="",T=String.fromCharCode.apply(null,new Uint16Array(u.subarray(g,g+128)));for(;0>(_=T.indexOf(`
`))&&w<d&&g<u.byteLength;)x+=T,w+=T.length,g+=128,T+=String.fromCharCode.apply(null,new Uint16Array(u.subarray(g,g+128)));return-1<_&&(m!==!1&&(u.pos+=w+_+1),x+T.slice(0,_))},i=function(u,d,m,g){const _=u[d+3],w=Math.pow(2,_-128)/255;m[g+0]=u[d+0]*w,m[g+1]=u[d+1]*w,m[g+2]=u[d+2]*w,m[g+3]=1},o=function(u,d,m,g){const _=u[d+3],w=Math.pow(2,_-128)/255;m[g+0]=p.A5E.toHalfFloat(Math.min(u[d+0]*w,65504)),m[g+1]=p.A5E.toHalfFloat(Math.min(u[d+1]*w,65504)),m[g+2]=p.A5E.toHalfFloat(Math.min(u[d+2]*w,65504)),m[g+3]=p.A5E.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;const c=function(u){const d=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,m=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,g=/^\s*FORMAT=(\S+)\s*$/,_=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,w={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let x,T;if(u.pos>=u.byteLength||!(x=n(u)))return t(1,"no header found");if(!(T=x.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(w.valid|=1,w.programtype=T[1],w.string+=x+`
`;x=n(u),x!==!1;)if(w.string+=x+`
`,x.charAt(0)!=="#"){if((T=x.match(d))&&(w.gamma=parseFloat(T[1])),(T=x.match(m))&&(w.exposure=parseFloat(T[1])),(T=x.match(g))&&(w.valid|=2,w.format=T[1]),(T=x.match(_))&&(w.valid|=4,w.height=parseInt(T[1],10),w.width=parseInt(T[2],10)),2&w.valid&&4&w.valid)break}else w.comments+=x+`
`;return 2&w.valid?4&w.valid?w:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(c!==-1){const u=c.width,d=c.height,m=function(g,_,w){const x=_;if(x<8||x>32767||g[0]!==2||g[1]!==2||128&g[2])return new Uint8Array(g);if(x!==(g[2]<<8|g[3]))return t(3,"wrong scanline width");const T=new Uint8Array(4*_*w);if(!T.length)return t(4,"unable to allocate buffer space");let I=0,R=0;const M=4*x,C=new Uint8Array(4),L=new Uint8Array(M);let k=w;for(;k>0&&R<g.byteLength;){if(R+4>g.byteLength)return t(1);if(C[0]=g[R++],C[1]=g[R++],C[2]=g[R++],C[3]=g[R++],C[0]!=2||C[1]!=2||(C[2]<<8|C[3])!=x)return t(3,"bad rgbe scanline format");let j,H=0;for(;H<M&&R<g.byteLength;){j=g[R++];const ee=j>128;if(ee&&(j-=128),j===0||H+j>M)return t(3,"bad scanline data");if(ee){const oe=g[R++];for(let re=0;re<j;re++)L[H++]=oe}else L.set(g.subarray(R,R+j),H),H+=j,R+=j}const X=x;for(let ee=0;ee<X;ee++){let oe=0;T[I]=L[ee+oe],oe+=x,T[I+1]=L[ee+oe],oe+=x,T[I+2]=L[ee+oe],oe+=x,T[I+3]=L[ee+oe],I+=4}k--}return T}(a.subarray(a.pos),u,d);if(m!==-1){let g,_,w;switch(this.type){case p.VzW:w=m.length/4;const x=new Float32Array(4*w);for(let I=0;I<w;I++)i(m,4*I,x,4*I);g=x,_=p.VzW;break;case p.cLu:w=m.length/4;const T=new Uint16Array(4*w);for(let I=0;I<w;I++)o(m,4*I,T,4*I);g=T,_=p.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:u,height:d,data:g,header:c.string,gamma:c.gamma,exposure:c.exposure,type:_}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(o,a){switch(o.type){case p.VzW:case p.cLu:o.colorSpace=p.GUF,o.minFilter=p.wem,o.magFilter=p.wem,o.generateMipmaps=!1,o.flipY=!0}t&&t(o,a)},n,i)}}function Lc(s){return new Br(class extends fr{constructor(e){super(e),this.setDataType(sl(s.renderer.rendererObject))}},["hdr"],!1)}class Wi extends p.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ws(t)}),this.register(function(t){return new M0(t)}),this.register(function(t){return new Am(t)}),this.register(function(t){return new T0(t)}),this.register(function(t){return new Oa(t)}),this.register(function(t){return new S0(t)}),this.register(function(t){return new Pd(t)}),this.register(function(t){return new ym(t)}),this.register(function(t){return new Bv(t)}),this.register(function(t){return new C0(t)}),this.register(function(t){return new Ov(t)}),this.register(function(t){return new uu(t)}),this.register(function(t){return new ef(t)}),this.register(function(t){return new lc(t)})}load(e,t,n,i){const o=this;let a;a=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:p.Zp0.extractUrlBase(e),this.manager.itemStart(e);const c=function(d){i?i(d):console.error(d),o.manager.itemError(e),o.manager.itemEnd(e)},u=new p.hH6(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){try{o.parse(d,a,function(m){t(m),o.manager.itemEnd(e)},c,e)}catch(m){c(m)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,o){let a;const c={},u={},d=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(d.decode(new Uint8Array(e,0,4))===Rd){try{c[Bi.KHR_BINARY_GLTF]=new bm(e)}catch(g){return void(i&&i(g))}a=JSON.parse(c[Bi.KHR_BINARY_GLTF].content)}else a=JSON.parse(d.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const m=new ia(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});m.fileLoader.setRequestHeader(this.requestHeader);for(let g=0;g<this.pluginCallbacks.length;g++){const _=this.pluginCallbacks[g](m);u[_.name]=_,c[_.name]=!0}if(a.extensionsUsed)for(let g=0;g<a.extensionsUsed.length;++g){const _=a.extensionsUsed[g],w=a.extensionsRequired||[];switch(_){case Bi.KHR_MATERIALS_UNLIT:c[_]=new Cr;break;case Bi.KHR_DRACO_MESH_COMPRESSION:c[_]=new kc(a,this.dracoLoader);break;case Bi.KHR_TEXTURE_TRANSFORM:c[_]=new Lv;break;case Bi.KHR_MESH_QUANTIZATION:c[_]=new wm;break;default:w.indexOf(_)>=0&&u[_]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+_+'".')}}m.setExtensions(c),m.setPlugins(u),m.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,o){n.parse(e,t,i,o)})}}function Dv(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}Wi.ObjectConstructors={DirectionalLight:p.Ox3,PointLight:p.cek,SpotLight:p.PMe,MeshStandardMaterial:p.Wid,MeshBasicMaterial:p.vBJ,MeshPhysicalMaterial:p.EJi,LineBasicMaterial:p.nls,PointsMaterial:p.UY4,PerspectiveCamera:p.cPb,OrthographicCamera:p.iKG};const Bi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class uu{constructor(e){this.parser=e,this.name=Bi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let c;const u=new p.Ilk(16777215);a.color!==void 0&&u.fromArray(a.color);const d=a.range!==void 0?a.range:0;switch(a.type){case"directional":c=new Wi.ObjectConstructors.DirectionalLight(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Wi.ObjectConstructors.PointLight(u),c.distance=d;break;case"spot":c=new Wi.ObjectConstructors.SpotLight(u),c.distance=d,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,c.angle=a.spot.outerConeAngle,c.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return c.position.set(0,0,0),c.decay=2,$i(c,a),a.intensity!==void 0&&(c.intensity=a.intensity),c.name=t.createUniqueName(a.name||"light_"+e),i=Promise.resolve(c),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],o=(i.extensions&&i.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return n._getNodeRef(t.cache,o,a)})}}class Cr{constructor(){this.name=Bi.KHR_MATERIALS_UNLIT}getMaterialType(){return Wi.ObjectConstructors.MeshBasicMaterial}extendParams(e,t,n){const i=[];e.color=new p.Ilk(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const a=o.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}o.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",o.baseColorTexture,p.KI_))}return Promise.all(i)}}class Bv{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class ws{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wi.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const c=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new p.FM8(c,c)}return Promise.all(o)}}class Ov{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wi.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}}class Oa{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wi.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new p.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];return a.sheenColorFactor!==void 0&&t.sheenColor.fromArray(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,p.KI_)),a.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),i.extras&&i.extras.sheenFactor!==void 0&&(t.sheen=i.extras.sheenFactor,delete i.extras.sheenFactor),Promise.all(o)}}class S0{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wi.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(o)}}class Pd{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wi.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const c=a.attenuationColor||[1,1,1];return t.attenuationColor=new p.Ilk(c[0],c[1],c[2]),Promise.all(o)}}class ym{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wi.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class C0{constructor(e){this.parser=e,this.name=Bi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wi.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const c=a.specularColorFactor||[1,1,1];return t.specularColor=new p.Ilk(c[0],c[1],c[2]),a.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,p.KI_)),Promise.all(o)}}class M0{constructor(e){this.parser=e,this.name=Bi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const o=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,a)}}class Am{constructor(e){this.parser=e,this.name=Bi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],c=i.images[a.source];let u=n.textureLoader;if(c.uri){const d=n.options.manager.getHandler(c.uri);d!==null&&(u=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(e,a.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class T0{constructor(e){this.parser=e,this.name=Bi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],c=i.images[a.source];let u=n.textureLoader;if(c.uri){const d=n.options.manager.getHandler(c.uri);d!==null&&(u=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(e,a.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ef{constructor(e){this.name=Bi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(c){const u=i.byteOffset||0,d=i.byteLength||0,m=i.count,g=i.byteStride,_=new Uint8Array(c,u,d);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(m,g,_,i.mode,i.filter).then(function(w){return w.buffer}):a.ready.then(function(){const w=new ArrayBuffer(m*g);return a.decodeGltfBuffer(new Uint8Array(w),m,g,_,i.mode,i.filter),w})})}return null}}class lc{constructor(e){this.name=Bi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const u of i.primitives)if(u.mode!==_o.TRIANGLES&&u.mode!==_o.TRIANGLE_STRIP&&u.mode!==_o.TRIANGLE_FAN&&u.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],c={};for(const u in o)a.push(this.parser.getDependency("accessor",o[u]).then(d=>(c[u]=d,c[u])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(u=>{const d=u.pop(),m=d.isGroup?d.children:[d],g=u[0].count,_=[];for(const w of m){const x=new p.yGw,T=new p.Pa4,I=new p._fP,R=new p.Pa4(1,1,1),M=new p.SPe(w.geometry,w.material,g);for(let C=0;C<g;C++)c.TRANSLATION&&T.fromBufferAttribute(c.TRANSLATION,C),c.ROTATION&&I.fromBufferAttribute(c.ROTATION,C),c.SCALE&&R.fromBufferAttribute(c.SCALE,C),M.setMatrixAt(C,x.compose(T,I,R));M.sourceTrs=c;for(const C in c)C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&w.geometry.setAttribute(C,c[C]);p.Tme.prototype.copy.call(M,w),this.parser.assignFinalMaterial(M),_.push(M)}return d.isGroup?(d.clear(),d.add(..._),d):_[0]}))}}const Rd="glTF";class bm{constructor(e){this.name=Bi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Rd)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,o=new DataView(e,12);let a=0;for(;a<i;){const c=o.getUint32(a,!0);a+=4;const u=o.getUint32(a,!0);if(a+=4,u===1313821514){const d=new Uint8Array(e,12+a,c);this.content=n.decode(d)}else if(u===5130562){const d=12+a;this.body=e.slice(d,d+c)}a+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class kc{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Bi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,c={},u={},d={};for(const m in a){const g=tf[m]||m.toLowerCase();c[g]=a[m]}for(const m in e.attributes){const g=tf[m]||m.toLowerCase();if(a[m]!==void 0){const _=n.accessors[e.attributes[m]],w=Uc[_.componentType];d[g]=w.name,u[g]=_.normalized===!0}}return t.getDependency("bufferView",o).then(function(m){return new Promise(function(g){i.decodeDracoFile(m,function(_){for(const w in _.attributes){const x=_.attributes[w],T=u[w];T!==void 0&&(x.normalized=T)}g(_)},c,d)})})}}class Lv{constructor(){this.name=Bi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class wm{constructor(){this.name=Bi.KHR_MESH_QUANTIZATION}}class Dd extends p._C8{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i*3+i;for(let a=0;a!==i;a++)t[a]=n[o+a];return t}interpolate_(e,t,n,i){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,u=2*c,d=3*c,m=i-t,g=(n-t)/m,_=g*g,w=_*g,x=e*d,T=x-d,I=-2*w+3*_,R=w-_,M=1-I,C=R-_+g;for(let L=0;L!==c;L++){const k=a[T+L+c],j=a[T+L+u]*m,H=a[x+L+c],X=a[x+L]*m;o[L]=M*k+C*j+I*H+R*X}return o}}const oh=new p._fP;class ah extends Dd{interpolate_(e,t,n,i){const o=super.interpolate_(e,t,n,i);return oh.fromArray(o).normalize().toArray(o),o}}const _o={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Uc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Bd={9728:p.TyD,9729:p.wem,9984:p.YLQ,9985:p.qyh,9986:p.aH4,9987:p.D1R},Ml={33071:p.uWy,33648:p.OoA,10497:p.rpg},Mr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tf={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},na={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},La={CUBICSPLINE:void 0,LINEAR:p.NMF,STEP:p.Syv};function ss(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function $i(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function lh(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ch(s){const e=s.extensions&&s.extensions[Bi.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+hu(e.attributes):s.indices+":"+hu(s.attributes)+":"+s.mode,t}function hu(s){let e="";const t=Object.keys(s).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+s[t[n]]+";";return e}function Pi(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const cc=new p.yGw;class ia{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Dv,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,o=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,o=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&o<98?this.textureLoader=new p.dpR(this.options.manager):this.textureLoader=new p.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new p.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const c={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:n,userData:{}};ss(o,c,i),$i(c,i),Promise.all(n._invokeAll(function(u){return u.afterRoot&&u.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=t.length;i<o;i++){const a=t[i].joints;for(let c=0,u=a.length;c<u;c++)e[a[c]].isBone=!0}for(let i=0,o=e.length;i<o;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),o=(a,c)=>{const u=this.associations.get(a);u!=null&&this.associations.set(c,u);for(const[d,m]of a.children.entries())o(m,c.children[d])};return o(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const o=e(t[i]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(o,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Bi.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(o,a){n.load(p.Zp0.resolveURL(t.uri,i.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=Mr[i.type],c=Uc[i.componentType],u=i.normalized===!0,d=new c(i.count*a);return Promise.resolve(new p.TlE(d,a,u))}const o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(a){const c=a[0],u=Mr[i.type],d=Uc[i.componentType],m=d.BYTES_PER_ELEMENT,g=m*u,_=i.byteOffset||0,w=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,x=i.normalized===!0;let T,I;if(w&&w!==g){const R=Math.floor(_/w),M="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+R+":"+i.count;let C=t.cache.get(M);C||(T=new d(c,R*w,i.count*w/m),C=new p.vpT(T,w/m),t.cache.add(M,C)),I=new p.kB5(C,u,_%w/m,x)}else T=c===null?new d(i.count*u):new d(c,_,i.count*u),I=new p.TlE(T,u,x);if(i.sparse!==void 0){const R=Mr.SCALAR,M=Uc[i.sparse.indices.componentType],C=i.sparse.indices.byteOffset||0,L=i.sparse.values.byteOffset||0,k=new M(a[1],C,i.sparse.count*R),j=new d(a[2],L,i.sparse.count*u);c!==null&&(I=new p.TlE(I.array.slice(),I.itemSize,I.normalized));for(let H=0,X=k.length;H<X;H++){const ee=k[H];if(I.setX(ee,j[H*u]),u>=2&&I.setY(ee,j[H*u+1]),u>=3&&I.setZ(ee,j[H*u+2]),u>=4&&I.setW(ee,j[H*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return I})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,o=t.images[i];let a=this.textureLoader;if(o.uri){const c=n.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,n){const i=this,o=this.json,a=o.textures[e],c=o.images[t],u=(c.uri||c.bufferView)+":"+a.sampler;if(this.textureCache[u])return this.textureCache[u];const d=this.loadImageSource(t,n).then(function(m){m.name=a.name||c.name||"",m.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(m.name=c.uri);const g=(o.samplers||{})[a.sampler]||{};return m.magFilter=Bd[g.magFilter]||p.wem,m.minFilter=Bd[g.minFilter]||p.D1R,m.wrapS=Ml[g.wrapS]||p.rpg,m.wrapT=Ml[g.wrapT]||p.rpg,g.extras&&g.extras.uuid!==void 0&&(m.uuid=g.extras.uuid),i.associations.set(m,{textures:e}),m}).catch(function(){return null});return this.textureCache[u]=d,d}loadImageSource(e,t,n=!1,i=!1){const o=this,a=this.json,c=this.options;if(!i&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(x=>x.clone());const u=a.images[e],d=self.URL||self.webkitURL;u.uri===void 0&&u.extras&&u.extras.uri&&(u.uri=u.extras.uri);let m=u.uri||"",g=!1,_=null;if(u.bufferView===void 0||n&&m){if(u.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else m=o.getDependency("bufferView",u.bufferView).then(function(x){g=!0;const T=new Blob([x],{type:u.mimeType});return m=d.createObjectURL(T),_=T,m});const w=Promise.resolve(m).then(function(x){return new Promise(function(T,I){let R=T;t.isImageBitmapLoader===!0&&(R=function(M){const C=new p.xEZ(M);C.needsUpdate=!0,T(C)}),t.load(p.Zp0.resolveURL(x,c.path),R,void 0,function(M){t.isImageBitmapLoader===!0?(t=new p.dpR(o.options.manager),R=T,t.setCrossOrigin(o.options.crossOrigin),t.setRequestHeader(o.options.requestHeader),t.load(p.Zp0.resolveURL(x,c.path),R,void 0,I)):I(M)})})}).then(function(x){var T;if(g===!0&&d.revokeObjectURL(m),x.userData.mimeType=u.mimeType||((T=u.uri).search(/\.jpe?g($|\?)/i)>0||T.search(/^data\:image\/jpeg/)===0?"image/jpeg":T.search(/\.webp($|\?)/i)>0||T.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),x.flipY=!1,u.extras){if(u.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let I=x;const R=u.extras.flipY&&!I.flipY;createImageBitmap(I.source.data,{imageOrientation:R?"flipY":"none"}).then(function(M){I._newTex&&(I=I._newTex),I.source.data.close&&I.source.data.close(),I.source.data=M,I.source.needsUpdate=!0,I.needsUpdate=!0})}x.flipY=u.extras.flipY,x.needsUpdate=!0,delete u.extras.flipY}u.extras.uuid!==void 0&&(x.source.uuid=u.extras.uuid),u.extras.t_uuid!==void 0&&(x.uuid=u.extras.t_uuid)}return u.uri&&typeof u.uri=="string"&&g===!1&&!u.uri.startsWith("/")&&(x.userData.rootPath=p.Zp0.resolveURL(u.uri,c.path)),_&&(x.userData.__sourceBlob=_),!n&&u.uri&&u.uri!==m&&o.loadImageSource(e,t,!0,!0).then(function(I){x.source.data&&x.source.data.close&&x.source.data.close(),x.dispose(),x.source=I.source,x.source.needsUpdate=!0,x.needsUpdate=!0,x.uuid=I.uuid,x.flipY=I.flipY,x.userData=I.userData,x.setDirty&&x.setDirty(),I._newTex=x}),x}).catch(function(x){throw console.error("THREE.GLTFLoader: Couldn't load texture",m),x});return this.sourceCache[e]=w,w}assignTexture(e,t,n,i){const o=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&((a=a.clone()).channel=n.texCoord),o.extensions[Bi.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[Bi.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const u=o.associations.get(a);a=o.extensions[Bi.KHR_TEXTURE_TRANSFORM].extendTexture(a,c),o.associations.set(a,u)}}return i!==void 0&&(a.colorSpace=i),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let u=this.cache.get(c);u||(u=new Wi.ObjectConstructors.PointsMaterial,p.F5T.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(c,u)),n=u}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let u=this.cache.get(c);u||(u=new Wi.ObjectConstructors.LineBasicMaterial,p.F5T.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,this.cache.add(c,u)),n=u}if(i||o||a){let c="ClonedMaterial:"+n.uuid+":";i&&(c+="derivative-tangents:"),o&&(c+="vertex-colors:"),a&&(c+="flat-shading:");let u=this.cache.get(c);u||(u=n.clone(),o&&(u.vertexColors=!0),a&&(u.flatShading=!0),i&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(n))),n=u}e.material=n}getMaterialType(){return Wi.ObjectConstructors.MeshStandardMaterial}loadMaterial(e){const t=this,n=this.json,i=this.extensions,o=n.materials[e];let a;const c={},u=[];if((o.extensions||{})[Bi.KHR_MATERIALS_UNLIT]){const m=i[Bi.KHR_MATERIALS_UNLIT];a=m.getMaterialType(),u.push(m.extendParams(c,o,t))}else{const m=o.pbrMetallicRoughness||{};if(c.color=new p.Ilk(1,1,1),c.opacity=1,Array.isArray(m.baseColorFactor)){const g=m.baseColorFactor;c.color.fromArray(g),c.opacity=g[3]}m.baseColorTexture!==void 0&&u.push(t.assignTexture(c,"map",m.baseColorTexture,p.KI_)),c.metalness=m.metallicFactor!==void 0?m.metallicFactor:1,c.roughness=m.roughnessFactor!==void 0?m.roughnessFactor:1,m.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(c,"metalnessMap",m.metallicRoughnessTexture)),u.push(t.assignTexture(c,"roughnessMap",m.metallicRoughnessTexture))),a=this._invokeOne(function(g){return g.getMaterialType&&g.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(g){return g.extendMaterialParams&&g.extendMaterialParams(e,c)})))}o.doubleSided===!0&&(c.side=p.ehD);const d=o.alphaMode||"OPAQUE";if(d==="BLEND"?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,d==="MASK"&&(c.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==Wi.ObjectConstructors.MeshBasicMaterial&&(u.push(t.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new p.FM8(1,1),o.normalTexture.scale!==void 0)){const m=o.normalTexture.scale;c.normalScale.set(m,m)}return o.occlusionTexture!==void 0&&a!==Wi.ObjectConstructors.MeshBasicMaterial&&(u.push(t.assignTexture(c,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==Wi.ObjectConstructors.MeshBasicMaterial&&(c.emissive=new p.Ilk().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&a!==Wi.ObjectConstructors.MeshBasicMaterial&&u.push(t.assignTexture(c,"emissiveMap",o.emissiveTexture,p.KI_)),Promise.all(u).then(function(){const m=new a(c);return o.name&&(m.name=o.name),$i(m,o),t.associations.set(m,{materials:e}),o.extensions&&ss(i,m,o),m})}createUniqueName(e){const t=p.iUV.sanitizeNodeName(e||"");let n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function o(c){return n[Bi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(u){return Mi(u,c,t)})}const a=[];for(let c=0,u=e.length;c<u;c++){const d=e[c],m=ch(d),g=i[m];if(g)a.push(g.promise);else{let _;_=d.extensions&&d.extensions[Bi.KHR_DRACO_MESH_COMPRESSION]?o(d):Mi(new p.u9r,d,t),i[m]={primitive:d,promise:_},a.push(_)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,o=n.meshes[e],a=o.primitives,c=[];for(let d=0,m=a.length;d<m;d++){const g=a[d].material===void 0?((u=this.cache).DefaultMaterial===void 0&&(u.DefaultMaterial=new Wi.ObjectConstructors.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:p.Wl3})),u.DefaultMaterial):this.getDependency("material",a[d].material);c.push(g)}var u;return c.push(t.loadGeometries(a)),Promise.all(c).then(function(d){const m=d.slice(0,d.length-1),g=d[d.length-1],_=[];for(let x=0,T=g.length;x<T;x++){const I=g[x],R=a[x];let M;const C=m[x];if(R.mode===_o.TRIANGLES||R.mode===_o.TRIANGLE_STRIP||R.mode===_o.TRIANGLE_FAN||R.mode===void 0)M=o.isSkinnedMesh===!0?new p.TUv(I,C):new p.Kj0(I,C),M.isSkinnedMesh===!0&&M.normalizeSkinWeights(),R.mode===_o.TRIANGLE_STRIP?M.geometry=ae(M.geometry,p.UlW):R.mode===_o.TRIANGLE_FAN&&(M.geometry=ae(M.geometry,p.z$h));else if(R.mode===_o.LINES)M=new p.ejS(I,C);else if(R.mode===_o.LINE_STRIP)M=new p.x12(I,C);else if(R.mode===_o.LINE_LOOP)M=new p.blk(I,C);else{if(R.mode!==_o.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+R.mode);M=new p.woe(I,C)}Object.keys(M.geometry.morphAttributes).length>0&&lh(M,o),M.name=t.createUniqueName(o.name||"mesh_"+e),M.geometry&&o.extras&&o.extras.isGeometryUserData?($i(M.geometry,o),R.extensions&&ss(i,M.geometry,R)):($i(M,o),R.extensions&&ss(i,M,R)),t.assignFinalMaterial(M),_.push(M)}o.extensions&&_.forEach(x=>ss(i,x,o));for(let x=0,T=_.length;x<T;x++)t.associations.set(_[x],{meshes:e,primitives:x});if(_.length===1)return _[0];const w=new p.ZAu;t.associations.set(w,{meshes:e});for(let x=0,T=_.length;x<T;x++)w.add(_[x]);return w})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return n.type==="perspective"?t=new Wi.ObjectConstructors.PerspectiveCamera(p.M8C.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new Wi.ObjectConstructors.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),$i(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,o=t.joints.length;i<o;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const o=i.pop(),a=i,c=[],u=[];for(let d=0,m=a.length;d<m;d++){const g=a[d];if(g){c.push(g);const _=new p.yGw;o!==null&&_.fromArray(o.array,16*d),u.push(_)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[d])}return new p.OdW(c,u)})}loadAnimation(e){const t=this.json.animations[e],n=t.name?t.name:"animation_"+e,i=[],o=[],a=[],c=[],u=[];for(let d=0,m=t.channels.length;d<m;d++){const g=t.channels[d],_=t.samplers[g.sampler],w=g.target,x=w.node,T=t.parameters!==void 0?t.parameters[_.input]:_.input,I=t.parameters!==void 0?t.parameters[_.output]:_.output;w.node!==void 0&&(i.push(this.getDependency("node",x)),o.push(this.getDependency("accessor",T)),a.push(this.getDependency("accessor",I)),c.push(_),u.push(w))}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(u)]).then(function(d){const m=d[0],g=d[1],_=d[2],w=d[3],x=d[4],T=[];for(let I=0,R=m.length;I<R;I++){const M=m[I],C=g[I],L=_[I],k=w[I],j=x[I];if(M===void 0)continue;let H;switch(M.updateMatrix(),na[j.path]){case na.weights:H=p.dUE;break;case na.rotation:H=p.iLg;break;default:H=p.yC1}const X=M.name?M.name:M.uuid,ee=k.interpolation!==void 0?La[k.interpolation]:p.NMF,oe=[];na[j.path]===na.weights?M.traverse(function(he){he.morphTargetInfluences&&oe.push(he.name?he.name:he.uuid)}):oe.push(X);let re=L.array;if(L.normalized){const he=Pi(re.constructor),le=new Float32Array(re.length);for(let ue=0,ge=re.length;ue<ge;ue++)le[ue]=re[ue]*he;re=le}for(let he=0,le=oe.length;he<le;he++){const ue=new H(oe[he]+"."+na[j.path],C.array,re,ee);k.interpolation==="CUBICSPLINE"&&(ue.createInterpolant=function(ge){return new(this instanceof p.iLg?ah:Dd)(this.times,this.values,this.getValueSize()/3,ge)},ue.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),T.push(ue)}}return new p.m7l(n,void 0,T)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(o){const a=n._getNodeRef(n.meshCache,i.mesh,o);return i.weights!==void 0&&a.traverse(function(c){if(c.isMesh)for(let u=0,d=i.weights.length;u<d;u++)c.morphTargetInfluences[u]=i.weights[u]}),a})}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),o=[],a=n.children||[];for(let u=0,d=a.length;u<d;u++)o.push(t.getDependency("node",a[u]));const c=n.skin===void 0?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(o),c]).then(function(u){const d=u[0],m=u[1],g=u[2];g!==null&&d.traverse(function(_){_.isSkinnedMesh&&_.bind(g,cc)});for(let _=0,w=m.length;_<w;_++)d.add(m[_]);return d})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],a=o.name?i.createUniqueName(o.name):"",c=[],u=i._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return u&&c.push(u),o.camera!==void 0&&c.push(i.getDependency("camera",o.camera).then(function(d){return i._getNodeRef(i.cameraCache,o.camera,d)})),i._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){c.push(d)}),this.nodeCache[e]=Promise.all(c).then(function(d){let m;if(m=o.isBone===!0?new p.N$j:d.length>1?new p.ZAu:d.length===1?d[0]:new p.Tme,m!==d[0])for(let g=0,_=d.length;g<_;g++)m.add(d[g]);if(o.name&&(m.userData.name=o.name,m.name=a),$i(m,o),o.extensions&&ss(n,m,o),o.matrix!==void 0){const g=new p.yGw;g.fromArray(o.matrix),m.applyMatrix4(g)}else o.translation!==void 0&&m.position.fromArray(o.translation),o.rotation!==void 0&&m.quaternion.fromArray(o.rotation),o.scale!==void 0&&m.scale.fromArray(o.scale);return i.associations.has(m)||i.associations.set(m,{}),i.associations.get(m).nodes=e,m}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,o=new p.ZAu;n.name&&(o.name=i.createUniqueName(n.name)),$i(o,n),n.extensions&&ss(t,o,n);const a=n.nodes||[],c=[];for(let u=0,d=a.length;u<d;u++)c.push(i.getDependency("node",a[u]));return Promise.all(c).then(function(u){for(let d=0,m=u.length;d<m;d++)o.add(u[d]);return i.associations=(d=>{const m=new Map;for(const[g,_]of i.associations)(g instanceof p.F5T||g instanceof p.xEZ)&&m.set(g,_);return d.traverse(g=>{const _=i.associations.get(g);_!=null&&m.set(g,_)}),m})(o),o})}}function Mi(s,e,t){const n=e.attributes,i=[];function o(a,c){return t.getDependency("accessor",a).then(function(u){s.setAttribute(c,u)})}for(const a in n){const c=tf[a]||a.toLowerCase();c in s.attributes||i.push(o(n[a],c))}if(e.indices!==void 0&&!s.index){const a=t.getDependency("accessor",e.indices).then(function(c){s.setIndex(c)});i.push(a)}return $i(s,e),function(a,c,u){const d=c.attributes,m=new p.ZzF;if(d.POSITION===void 0)return;{const w=u.json.accessors[d.POSITION],x=w.min,T=w.max;if(x===void 0||T===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(m.set(new p.Pa4(x[0],x[1],x[2]),new p.Pa4(T[0],T[1],T[2])),w.normalized){const I=Pi(Uc[w.componentType]);m.min.multiplyScalar(I),m.max.multiplyScalar(I)}}const g=c.targets;if(g!==void 0){const w=new p.Pa4,x=new p.Pa4;for(let T=0,I=g.length;T<I;T++){const R=g[T];if(R.POSITION!==void 0){const M=u.json.accessors[R.POSITION],C=M.min,L=M.max;if(C!==void 0&&L!==void 0){if(x.setX(Math.max(Math.abs(C[0]),Math.abs(L[0]))),x.setY(Math.max(Math.abs(C[1]),Math.abs(L[1]))),x.setZ(Math.max(Math.abs(C[2]),Math.abs(L[2]))),M.normalized){const k=Pi(Uc[M.componentType]);x.multiplyScalar(k)}w.max(x)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}m.expandByVector(w)}a.boundingBox=m;const _=new p.aLr;m.getCenter(_.center),_.radius=m.min.distanceTo(m.max)/2,a.boundingSphere=_}(s,e,t),Promise.all(i).then(function(){return e.targets!==void 0?function(a,c,u){let d=!1,m=!1,g=!1;for(let T=0,I=c.length;T<I;T++){const R=c[T];if(R.POSITION!==void 0&&(d=!0),R.NORMAL!==void 0&&(m=!0),R.COLOR_0!==void 0&&(g=!0),d&&m&&g)break}if(!d&&!m&&!g)return Promise.resolve(a);const _=[],w=[],x=[];for(let T=0,I=c.length;T<I;T++){const R=c[T];if(d){const M=R.POSITION!==void 0?u.getDependency("accessor",R.POSITION):a.attributes.position;_.push(M)}if(m){const M=R.NORMAL!==void 0?u.getDependency("accessor",R.NORMAL):a.attributes.normal;w.push(M)}if(g){const M=R.COLOR_0!==void 0?u.getDependency("accessor",R.COLOR_0):a.attributes.color;x.push(M)}}return Promise.all([Promise.all(_),Promise.all(w),Promise.all(x)]).then(function(T){const I=T[0],R=T[1],M=T[2];return d&&(a.morphAttributes.position=I),m&&(a.morphAttributes.normal=R),g&&(a.morphAttributes.color=M),a.morphTargetsRelative=!0,a})}(s,e.targets,t):s})}class nf extends Wi{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(Ht)}async preparse(e,t){for(const n of this.preparsers)e=await n.process(e,t);return e}parse(e,t,n,i,o){this.preparse.call(this,e,o||t).then(a=>a?super.parse(a,t,n,i):i&&i(new ErrorEvent("no data"))).catch(a=>{console.error(a),i&&i(a??new ErrorEvent("unknown error"))})}transform(e,t){const n=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return n&&e.animations.length>0&&(n.animations=e.animations),n==null||n.traverse(i=>{i.userData.gltfUUID&&(i.uuid=i.userData.gltfUUID,delete i.userData.gltfUUID)}),n}register(e){return super.register(e)}}const Ht={key:(s,e,t)=>s.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+t)||"",async process(s,e){var u;if(typeof s=="string"||!new TextDecoder().decode(new Uint8Array(s,0,100)).includes("WebGiGLBWrapper"))return s;const t=new bm(s),n=JSON.parse(t.content||"{}");let i=t.body||s;const o=(u=n.asset)==null?void 0:u.encryption;if(!o)return i;const a=o.type,c=o.version;if(a==="aesgcm"&&c===1){const d=await(0,V.getOrCall)(this.key,o,n,e)||"";try{i=(await(0,V.aesGcmDecrypt)(new Uint8Array(i),d)).buffer}catch{throw new ErrorEvent("decryption error")}}return i}};class bi extends p.hH6{constructor(e){super(e),this.type=p.cLu}async loadAsync(e,t){const n=await this.parseAsync(e,t,!1),i=new p.IEO(n.data,n.width,n.height,p.wk1,this.type);return i.needsUpdate=!0,i.flipY=!0,i.colorSpace=p.KI_,i.minFilter=p.wem,i.magFilter=p.wem,i.source.data.complete=!0,i}async parseAsync(e,t,n=!1){let i=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const u=await super.loadAsync(e,t);e=URL.createObjectURL(u),i=!0}const o=await(0,V.imageUrlToImageData)(e);i&&URL.revokeObjectURL(e);let a=Uint8Array;return this.type===p.cLu?a=Uint16Array:this.type===p.VzW&&(a=Uint32Array),{data:function(u,d=3,m=Uint16Array,g=!1){let _;const w=u.byteLength>>2,x=new m(w*d);for(let T=0;T<w;T++)_=Math.pow(2,u[4*T+3]-136),g?(x[T*d]=Math.min(u[4*T]*_,65504),x[T*d+1]=Math.min(u[4*T+1]*_,65504),x[T*d+2]=Math.min(u[4*T+2]*_,65504)):(x[T*d]=p.A5E.toHalfFloat(Math.min(u[4*T]*_,65504)),x[T*d+1]=p.A5E.toHalfFloat(Math.min(u[4*T+1]*_,65504)),x[T*d+2]=p.A5E.toHalfFloat(Math.min(u[4*T+2]*_,65504))),d===4&&(x[T*d+3]=p.A5E.toHalfFloat(1));return x}(o.data,4,a,n),width:o.width,height:o.height}}setDataType(e){return this.type=e,this}}class xs extends p.Gql{constructor(e){super(e),this._imageLoader=new p.S3k(e)}static async LoadRootPathTextures(e,t,n,i=!0){var a;const o=[];for(const c of Array.isArray(e)?e:Object.values(e??{})){const u=(a=c==null?void 0:c.userData)==null?void 0:a.rootPath,d=i&&c.image&&t[c.image];if(!u)continue;const m=n.importPath(u,{processImported:!1}).then(g=>{const _=g==null?void 0:g[0],w=_==null?void 0:_.source;if(!_||!w)return null;const x=new p.Hw6(w.data);return c.image&&(x.uuid=c.image),c.image=x.uuid,d||(t[x.uuid]=x),_.dispose(),x}).catch(g=>(console.error(g),delete c.userData.rootPath,null));d?c.rootPathPromise=m:o.push(m)}await Promise.allSettled(o)}parseTextures2(e,t,n){var a,c;for(const u of e){const d=(a=u==null?void 0:u.userData)==null?void 0:a.rootPath;if(d&&(!u.image||!t[u.image])){const m=new p.Hw6(this._imageLoader.load(d,n));if(!m)continue;u.image&&(m.uuid=u.image),t[m.uuid]=m,u.image=m.uuid}u.userData=Di(u.userData,void 0,!1,{images:t})}const i=super.parseTextures(e,t),o={...i};for(const u of e)(c=u.rootPathPromise)==null||c.then(d=>{if(!d)return;const m=o[u.uuid];m.dispose(),m.source=d,m.source.needsUpdate=!0,m.needsUpdate=!0});return i}parseMaterials2(e,t,n){const i={};return e.forEach(o=>{if(!o)return;const a={...o},c=Object.keys(a);for(const d of c)if(d==="map"||d.endsWith("Map")){const m=a[d];typeof m=="string"&&(t[m]?a[d]=t[m]:(console.warn(`Texture ${m} not found`),delete a[d]))}a.userData&&(a.userData=Di(a.userData,void 0,!1,{textures:t}),a.userData.cloneId&&a.userData.uuid!==o.uuid&&(a.userData.uuid=o.uuid));const u=n.generateFromTemplateType(a.type,a);u&&(i[o.uuid]=u)}),i}}const ra="WEBGI_viewer";function xm(s){return new Br(nf,["gltf","glb","data:model/gltf"],!0,(e,t)=>{if(!e)return e;const n=e,i=new xs(t.loadingManager);return n.register(du(i,s)),n.register(uh()),n.register(rf(i)),n.register(o=>new pu(o)),n.register(o=>new sf(o)),n.register(o=>new Nc(o)),n.register(o=>new Sm(o)),n.register(o=>{var _,w,x,T,I,R,M,C,L;const a=o.getDependency;o.getDependency=async(k,j)=>{const H=await a.call(o,k,j);if(H&&H.userData){const X=H.userData.gltfExtensions;delete H.userData.gltfExtensions,H.userData=Di(H.userData,{},!1,{}),H.userData.gltfExtensions=X}return H};const c=ns()+".drc",u=ns()+".ktx2",d=(x=(w=(_=o.json)==null?void 0:_.extensionsRequired)==null?void 0:w.includes)==null?void 0:x.call(w,"KHR_draco_mesh_compression");if(d){const k=t.registerFile(c);k&&n.setDRACOLoader(k)}((R=(I=(T=o.json)==null?void 0:T.extensionsUsed)==null?void 0:I.includes)==null?void 0:R.call(I,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(n.setMeshoptDecoder(window.MeshoptDecoder),o.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const g=(L=(C=(M=o.json)==null?void 0:M.extensionsUsed)==null?void 0:C.includes)==null?void 0:L.call(C,"KHR_texture_basisu");if(g){const k=t.registerFile(u);k&&(n.setKTX2Loader(k),o.options.ktx2Loader=k)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async k=>{d&&t.unregisterFile(c),g&&t.unregisterFile(u);const j=await Em(o,s,i);k.scene&&(k.scene.__importedViewerConfig=j)}}}),n})}const sa="WEBGI_light_extras",ka="WEBGI_object3d_extras",oa="WEBGI_material_extras",uh=s=>e=>({name:"__"+ka,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(i=>{var c,u;if(!i||!i.isObject3D)return;const o=(u=(c=i.userData)==null?void 0:c.gltfExtensions)==null?void 0:u[ka];if(!o)return void(i.isLight&&!i.isAmbientLight&&(i.castShadow=!0));const a=o.castShadow!==void 0||o.receiveShadow!==void 0;o.castShadow!==void 0&&(i.castShadow=o.castShadow),o.receiveShadow!==void 0&&(i.receiveShadow=o.receiveShadow),o.visible!==void 0&&(i.visible=o.visible),o.frustumCulled!==void 0&&(i.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(i.renderOrder=o.renderOrder),o.layers!==void 0&&(i.layers.mask=o.layers),a&&(i.userData.__keepShadowDef=!0),delete i.userData.gltfExtensions[ka]})})}}),du=(s,e)=>t=>({name:"__"+oa,afterRoot:async n=>{var o,a,c;const i=n.scenes||(n.scene?[n.scene]:[]);for(const u of i){const d=(a=(o=u.userData)==null?void 0:o.gltfExtensions)==null?void 0:a[oa],m=d&&await((c=e.getPlugin(Qt))==null?void 0:c.importConfigResources(d.resources||{}))||{};u.traverse(g=>{var x,T;const _=g==null?void 0:g.material;if(!(_!=null&&_.isMaterial))return;const w=(T=(x=_.userData)==null?void 0:x.gltfExtensions)==null?void 0:T[oa];w&&(w.emissiveIntensity!==void 0&&(_.emissiveIntensity=w.emissiveIntensity),w.fog!==void 0&&(_.fog=w.fog),w.flatShading!==void 0&&(_.flatShading=w.flatShading),w.blending!==void 0&&(_.blending=w.blending),w.side!==void 0&&(_.side=w.side),w.shadowSide!==void 0&&(_.shadowSide=w.shadowSide),w.depthFunc!==void 0&&(_.depthFunc=w.depthFunc),w.depthTest!==void 0&&(_.depthTest=w.depthTest),w.depthWrite!==void 0&&(_.depthWrite=w.depthWrite),w.colorWrite!==void 0&&(_.colorWrite=w.colorWrite),w.vertexColors!==void 0&&(_.vertexColors=w.vertexColors),w.alphaTest!==void 0&&(_.alphaTest=w.alphaTest),w.wireframe!==void 0&&(_.wireframe=w.wireframe),w.wireframeLinewidth!==void 0&&(_.wireframeLinewidth=w.wireframeLinewidth),w.wireframeLinecap!==void 0&&(_.wireframeLinecap=w.wireframeLinecap),w.wireframeLinejoin!==void 0&&(_.wireframeLinejoin=w.wireframeLinejoin),w.rotation!==void 0&&(_.rotation=w.rotation),w.polygonOffset!==void 0&&(_.polygonOffset=w.polygonOffset),w.polygonOffsetFactor!==void 0&&(_.polygonOffsetFactor=w.polygonOffsetFactor),w.polygonOffsetUnits!==void 0&&(_.polygonOffsetUnits=w.polygonOffsetUnits),w.dithering!==void 0&&(_.dithering=w.dithering),w.alphaToCoverage!==void 0&&(_.alphaToCoverage=w.alphaToCoverage),w.premultipliedAlpha!==void 0&&(_.premultipliedAlpha=w.premultipliedAlpha),w.toneMapped!==void 0&&(_.toneMapped=w.toneMapped),w.normalScale!==void 0&&_.normalScale!==void 0&&(Array.isArray(w.normalScale)?_.normalScale.fromArray(w.normalScale):typeof w.normalScale=="number"?_.normalScale.set(w.normalScale,w.normalScale):e.console.warn("normalScale is not an array or number",w.normalScale)),w.reflectivity!==void 0&&(_.reflectivity=w.reflectivity),Object.entries(w).forEach(([I,R])=>{I.startsWith("_")||R&&R.resource&&typeof R.resource=="string"&&(_[I]=Di(R,_[I],!1,m))}),delete _.userData.gltfExtensions[oa])}),d&&delete u.userData.gltfExtensions[oa]}}}),rf=s=>e=>({name:"__"+sa,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(i=>{var a,c;if(!i.isLight)return;const o=(c=(a=i.userData)==null?void 0:a.gltfExtensions)==null?void 0:c[sa];o&&(!i.shadow&&o.shadow&&console.error("Light has no shadow, cannot import",i,o),o.shadow&&i.shadow&&(o.shadow.bias!==void 0&&(i.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(i.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(i.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(i.shadow.camera=s.parseObject(o.shadow.camera))),delete i.userData.gltfExtensions[sa])})})}});async function Em(s,e,t,n){var u,d,m;if(!n){const g=s.json.scenes||[];if(g.length!==1){for(const _ of g)await Em(s,e,t,_);return}n=g[0]}const i=(u=n.extensions)==null?void 0:u[ra];if(!i)return;const o=[];Object.values(i.resources).forEach(g=>{Object.values(g).forEach(_=>{_.url&&(_.url.type==="Uint16Array"&&_.url.data&&o.push(_.url),_.url.type==="Uint8Array"&&_.url.data&&o.push(_.url))})});for(const g of o){const _=g.data.image,w=s.json.images[_],x=await s.getDependency("bufferView",w.bufferView);if(w.mimeType.startsWith("image/")&&g.type==="Uint16Array"&&g.encoding==="rgbe"){const T=new Blob([x]);let I=URL.createObjectURL(T);(g.encodingVersion||1)<2&&(I="data:image/png;base64,"+btoa(await T.text())),g.data=(await new bi().parseAsync(I,void 0,!0)).data,URL.revokeObjectURL(I),delete g.encoding,delete g.encodingVersion}else g.data=x}const a={textures:{},materials:{}},c=i.resources;if(c.textures&&s.json.textures)for(const[g,_]of[...Object.entries(c.textures)]){if(_.uuid||!g)continue;delete c.textures[g];const w=s.json.textures.findIndex(x=>{var T,I,R,M,C,L,k;return((T=x.extras)==null?void 0:T.uuid)===g||((M=(R=(I=s.json.samplers)==null?void 0:I[x.sampler])==null?void 0:R.extras)==null?void 0:M.uuid)===g||((k=(L=(C=s.json.images)==null?void 0:C[x.source])==null?void 0:L.extras)==null?void 0:k.t_uuid)===g});w>=0&&(a.textures[g]=await s.getDependency("texture",w))}if(c.materials&&s.json.materials)for(const[g,_]of[...Object.entries(c.materials)]){if(_.uuid||!g)continue;delete c.materials[g];const w=s.json.materials.findIndex(x=>{var T;return((T=x.extras)==null?void 0:T.uuid)===g});w>=0&&(a.materials[g]=await s.getDependency("material",w),a.materials[g]=(m=(d=e.getPlugin(Qt))==null?void 0:d.materials)==null?void 0:m.processMaterial(a.materials[g],{}))}return i.resources=await e.getPlugin(Qt).importConfigResources(c||{},t,a),i}const Od="WEBGI_materials_bumpmap",Ld="WEBGI_materials_displacementmap",kd="WEBGI_materials_alphamap",no="WEBGI_materials_lightmap";class pu{constructor(e){this.parser=e,this.name=Od}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.bumpScale!==void 0&&(t.bumpScale=a.bumpScale),a.bumpTexture!==void 0&&o.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(o)}}class sf{constructor(e){this.parser=e,this.name=Ld}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.displacementScale!==void 0&&(t.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(t.displacementBias=a.displacementBias),a.displacementTexture!==void 0&&o.push(n.assignTexture(t,"displacementMap",a.displacementTexture)),Promise.all(o)}}class Nc{constructor(e){this.parser=e,this.name=no}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.lightMapIntensity!==void 0&&(t.lightMapIntensity=a.lightMapIntensity),a.lightMapTexture!==void 0&&o.push(n.assignTexture(t,"lightMap",a.lightMapTexture)),Promise.all(o)}}class Sm{constructor(e){this.parser=e,this.name=kd}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.alphaTexture!==void 0&&o.push(n.assignTexture(t,"alphaMap",a.alphaTexture)),Promise.all(o)}}var of=__webpackgi_require__(23);function Or(){return new Br(of.Q,["drc"],!0)}class ji extends p.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new p.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),ys(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=xi(ys({},t),!1),this.userData={},this.children=n,i.type="DirectionalLight2",i.target=this.target.position.toArray(),Object.assign(i,xi(this,!0,e))}fromJSON(e,t){if(e.type!=="DirectionalLight2")return null;const n=e.target,i=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,Di(e,this,!0,t),n&&(e.target=n),i&&(i.color!==void 0&&this.color.set(i.color),i.intensity!==void 0&&(this.intensity=i.intensity),e.object=i),this}}class yo extends p.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i,o,a){super(e,t,n,i,o,a),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),ys(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=xi(ys({},t),!1),this.userData={},this.children=n,i.type="SpotLight2",i.target=this.target.position.toArray(),Object.assign(i,xi(this,!0,e))}fromJSON(e,t){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),Di(e,this,!0,t),this):this)}}class fu extends p.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i){super(e,t,n,i),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),ys(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=xi(ys({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,xi(this,!0,e))}fromJSON(e,t){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),Di(e,this,!0,t),this):this}}class Ud extends p.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(e,t),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),ys(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=xi(ys({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,xi(this,!0,e))}fromJSON(e,t){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),Di(e,this,!0,t),this):this}}class af extends p.aNw{load(e,t,n,i){const o=new p.hH6(this.manager);o.setPath(this.path),o.setResponseType("text"),o.load(e,a=>{try{t(this.parse(a))}catch(c){i?i(c):console.error(c),this.manager.itemError(e)}},n,i)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,n=null;const i=new p.Pa4(0,0,0),o=new p.Pa4(1,1,1),a=e.split(/[\n\r]+/g);let c=null,u=0;for(let g=0,_=a.length;g<_;g++){const w=a[g].trim(),x=w.split(/\s/g);switch(x[0]){case"TITLE":t=w.substring(7,w.length-1);break;case"LUT_3D_SIZE":const T=x[1];n=parseFloat(T),c=new Uint8Array(n*n*n*4);break;case"DOMAIN_MIN":i.x=parseFloat(x[1]),i.y=parseFloat(x[2]),i.z=parseFloat(x[3]);break;case"DOMAIN_MAX":o.x=parseFloat(x[1]),o.y=parseFloat(x[2]),o.z=parseFloat(x[3]);break;default:const I=parseFloat(x[0]),R=parseFloat(x[1]),M=parseFloat(x[2]);if(I>1||I<0||R>1||R<0||M>1||M<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");c[u+0]=255*I,c[u+1]=255*R,c[u+2]=255*M,c[u+3]=255,u+=4}}const d=new p.IEO;d.image.data=c,d.image.width=n,d.image.height=n*n,d.type=p.ywz,d.magFilter=p.wem,d.minFilter=p.wem,d.wrapS=p.uWy,d.wrapT=p.uWy,d.generateMipmaps=!1,d.needsUpdate=!0;const m=new p.JUT;return m.image.data=c,m.image.width=n,m.image.height=n,m.image.depth=n,m.type=p.ywz,m.magFilter=p.wem,m.minFilter=p.wem,m.wrapS=p.uWy,m.wrapT=p.uWy,m.wrapR=p.uWy,m.generateMipmaps=!1,m.needsUpdate=!0,{title:t,size:n,domainMin:i,domainMax:o,texture:d,texture3D:m}}}let Cm=class{constructor({domainMax:s,domainMin:e,size:t,texture:n,texture3D:i,title:o}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=s,this.domainMin=e,this.size=t,this.texture=n,this.texture3D=i,this.title=o,this.uuid=p.M8C.generateUUID(),this.userData.__needsSourceBuffer=!0}fromJSON(s,e){return s.type!==this.type&&console.warn("type mismatch while import",s,this),console.error("not supported"),this}toJSON(s){return vr(this,s,this.texture.name)}};Cm=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([_s("LUTCubeTextureWrapper")],Cm);class lf extends af{parse(e){const t=super.parse(e);return new Cm(t)}}var Ao={},fe=Uint8Array,os=Uint16Array,Tl=Uint32Array,bo=new fe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Fo=new fe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wo=new fe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),el=function(s,e){for(var t=new os(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];var i=new Tl(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return[t,i]},mu=el(bo,2),Fc=mu[0],jo=mu[1];Fc[28]=258,jo[258]=28;for(var uc=el(Fo,0),hc=uc[0],tl=uc[1],dc=new os(32768),er=0;er<32768;++er){var Il=(43690&er)>>>1|(21845&er)<<1;Il=(61680&(Il=(52428&Il)>>>2|(13107&Il)<<2))>>>4|(3855&Il)<<4,dc[er]=((65280&Il)>>>8|(255&Il)<<8)>>>1}var Bs=function(s,e,t){for(var n=s.length,i=0,o=new os(e);i<n;++i)++o[s[i]-1];var a,c=new os(e);for(i=0;i<e;++i)c[i]=c[i-1]+o[i-1]<<1;if(t){a=new os(1<<e);var u=15-e;for(i=0;i<n;++i)if(s[i])for(var d=i<<4|s[i],m=e-s[i],g=c[s[i]-1]++<<m,_=g|(1<<m)-1;g<=_;++g)a[dc[g]>>>u]=d}else for(a=new os(n),i=0;i<n;++i)s[i]&&(a[i]=dc[c[s[i]-1]++]>>>15-s[i]);return a},aa=new fe(288);for(er=0;er<144;++er)aa[er]=8;for(er=144;er<256;++er)aa[er]=9;for(er=256;er<280;++er)aa[er]=7;for(er=280;er<288;++er)aa[er]=8;var hh=new fe(32);for(er=0;er<32;++er)hh[er]=5;var dh=Bs(aa,9,0),cf=Bs(aa,9,1),la=Bs(hh,5,0),Pl=Bs(hh,5,1),ph=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Qs=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(7&e)&t},nl=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(7&e)},gu=function(s){return(s/8|0)+(7&s&&1)},xo=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof os?os:s instanceof Tl?Tl:fe)(t-e);return n.set(s.subarray(e,t)),n},vu=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new fe(0);var i=!e||t,o=!t||t.i;t||(t={}),e||(e=new fe(3*n));var a=function(hn){var wn=e.length;if(hn>wn){var Xn=new fe(Math.max(2*wn,hn));Xn.set(e),e=Xn}},c=t.f||0,u=t.p||0,d=t.b||0,m=t.l,g=t.d,_=t.m,w=t.n,x=8*n;do{if(!m){t.f=c=Qs(s,u,1);var T=Qs(s,u+1,3);if(u+=3,!T){var I=s[(re=gu(u)+4)-4]|s[re-3]<<8,R=re+I;if(R>n){if(o)throw"unexpected EOF";break}i&&a(d+I),e.set(s.subarray(re,R),d),t.b=d+=I,t.p=u=8*R;continue}if(T==1)m=cf,g=Pl,_=9,w=5;else{if(T!=2)throw"invalid block type";var M=Qs(s,u,31)+257,C=Qs(s,u+10,15)+4,L=M+Qs(s,u+5,31)+1;u+=14;for(var k=new fe(L),j=new fe(19),H=0;H<C;++H)j[wo[H]]=Qs(s,u+3*H,7);u+=3*C;var X=ph(j),ee=(1<<X)-1,oe=Bs(j,X,1);for(H=0;H<L;){var re,he=oe[Qs(s,u,ee)];if(u+=15&he,(re=he>>>4)<16)k[H++]=re;else{var le=0,ue=0;for(re==16?(ue=3+Qs(s,u,3),u+=2,le=k[H-1]):re==17?(ue=3+Qs(s,u,7),u+=3):re==18&&(ue=11+Qs(s,u,127),u+=7);ue--;)k[H++]=le}}var ge=k.subarray(0,M),_e=k.subarray(M);_=ph(ge),w=ph(_e),m=Bs(ge,_,1),g=Bs(_e,w,1)}if(u>x){if(o)throw"unexpected EOF";break}}i&&a(d+131072);for(var Ee=(1<<_)-1,Ye=(1<<w)-1,We=u;;We=u){var Et=(le=m[nl(s,u)&Ee])>>>4;if((u+=15&le)>x){if(o)throw"unexpected EOF";break}if(!le)throw"invalid length/literal";if(Et<256)e[d++]=Et;else{if(Et==256){We=u,m=null;break}var lt=Et-254;if(Et>264){var rt=bo[H=Et-257];lt=Qs(s,u,(1<<rt)-1)+Fc[H],u+=rt}var kt=g[nl(s,u)&Ye],Pt=kt>>>4;if(!kt)throw"invalid distance";if(u+=15&kt,_e=hc[Pt],Pt>3&&(rt=Fo[Pt],_e+=nl(s,u)&(1<<rt)-1,u+=rt),u>x){if(o)throw"unexpected EOF";break}i&&a(d+131072);for(var sn=d+lt;d<sn;d+=4)e[d]=e[d-_e],e[d+1]=e[d+1-_e],e[d+2]=e[d+2-_e],e[d+3]=e[d+3-_e];d=sn}}t.l=m,t.p=We,t.b=d,m&&(c=1,t.m=_,t.d=g,t.n=w)}while(!c);return d==e.length?e:xo(e,0,d)},io=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8},si=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},pc=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var i=t.length,o=t.slice();if(!i)return[Rl,0];if(i==1){var a=new fe(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(k,j){return k.f-j.f}),t.push({s:-1,f:25001});var c=t[0],u=t[1],d=0,m=1,g=2;for(t[0]={s:-1,f:c.f+u.f,l:c,r:u};m!=i-1;)c=t[t[d].f<t[g].f?d++:g++],u=t[d!=m&&t[d].f<t[g].f?d++:g++],t[m++]={s:-1,f:c.f+u.f,l:c,r:u};var _=o[0].s;for(n=1;n<i;++n)o[n].s>_&&(_=o[n].s);var w=new os(_+1),x=zo(t[m-1],w,0);if(x>e){n=0;var T=0,I=x-e,R=1<<I;for(o.sort(function(k,j){return w[j.s]-w[k.s]||k.f-j.f});n<i;++n){var M=o[n].s;if(!(w[M]>e))break;T+=R-(1<<x-w[M]),w[M]=e}for(T>>>=I;T>0;){var C=o[n].s;w[C]<e?T-=1<<e-w[C]++-1:++n}for(;n>=0&&T;--n){var L=o[n].s;w[L]==e&&(--w[L],++T)}x=e}return[new fe(w),x]},zo=function(s,e,t){return s.s==-1?Math.max(zo(s.l,e,t+1),zo(s.r,e,t+1)):e[s.s]=t},Mm=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new os(++e),n=0,i=s[0],o=1,a=function(u){t[n++]=u},c=1;c<=e;++c)if(s[c]==i&&c!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(i),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(i);o=1,i=s[c]}return[t.subarray(0,n),e]},fh=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},Ua=function(s,e,t){var n=t.length,i=gu(e+2);s[i]=255&n,s[i+1]=n>>>8,s[i+2]=255^s[i],s[i+3]=255^s[i+1];for(var o=0;o<n;++o)s[i+o+4]=t[o];return 8*(i+4+n)},ca=function(s,e,t,n,i,o,a,c,u,d,m){io(e,m++,t),++i[256];for(var g=pc(i,15),_=g[0],w=g[1],x=pc(o,15),T=x[0],I=x[1],R=Mm(_),M=R[0],C=R[1],L=Mm(T),k=L[0],j=L[1],H=new os(19),X=0;X<M.length;++X)H[31&M[X]]++;for(X=0;X<k.length;++X)H[31&k[X]]++;for(var ee=pc(H,7),oe=ee[0],re=ee[1],he=19;he>4&&!oe[wo[he-1]];--he);var le,ue,ge,_e,Ee=d+5<<3,Ye=fh(i,aa)+fh(o,hh)+a,We=fh(i,_)+fh(o,T)+a+14+3*he+fh(H,oe)+(2*H[16]+3*H[17]+7*H[18]);if(Ee<=Ye&&Ee<=We)return Ua(e,m,s.subarray(u,u+d));if(io(e,m,1+(We<Ye)),m+=2,We<Ye){le=Bs(_,w,0),ue=_,ge=Bs(T,I,0),_e=T;var Et=Bs(oe,re,0);for(io(e,m,C-257),io(e,m+5,j-1),io(e,m+10,he-4),m+=14,X=0;X<he;++X)io(e,m+3*X,oe[wo[X]]);m+=3*he;for(var lt=[M,k],rt=0;rt<2;++rt){var kt=lt[rt];for(X=0;X<kt.length;++X){var Pt=31&kt[X];io(e,m,Et[Pt]),m+=oe[Pt],Pt>15&&(io(e,m,kt[X]>>>5&127),m+=kt[X]>>>12)}}}else le=dh,ue=aa,ge=la,_e=hh;for(X=0;X<c;++X)if(n[X]>255){Pt=n[X]>>>18&31,si(e,m,le[Pt+257]),m+=ue[Pt+257],Pt>7&&(io(e,m,n[X]>>>23&31),m+=bo[Pt]);var sn=31&n[X];si(e,m,ge[sn]),m+=_e[sn],sn>3&&(si(e,m,n[X]>>>5&8191),m+=Fo[sn])}else si(e,m,le[n[X]]),m+=ue[n[X]];return si(e,m,le[256]),m+ue[256]},Eo=new Tl([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Rl=new fe(0),Nd=function(s,e,t,n,i,o){var a=s.length,c=new fe(n+a+5*(1+Math.ceil(a/7e3))+i),u=c.subarray(n,c.length-i),d=0;if(!e||a<8)for(var m=0;m<=a;m+=65535){var g=m+65535;g<a?d=Ua(u,d,s.subarray(m,g)):(u[m]=o,d=Ua(u,d,s.subarray(m,a)))}else{for(var _=Eo[e-1],w=_>>>13,x=8191&_,T=(1<<t)-1,I=new os(32768),R=new os(T+1),M=Math.ceil(t/3),C=2*M,L=function(zt){return(s[zt]^s[zt+1]<<M^s[zt+2]<<C)&T},k=new Tl(25e3),j=new os(288),H=new os(32),X=0,ee=0,oe=(m=0,0),re=0,he=0;m<a;++m){var le=L(m),ue=32767&m,ge=R[le];if(I[ue]=ge,R[le]=ue,re<=m){var _e=a-m;if((X>7e3||oe>24576)&&_e>423){d=ca(s,u,0,k,j,H,ee,oe,he,m-he,d),oe=X=ee=0,he=m;for(var Ee=0;Ee<286;++Ee)j[Ee]=0;for(Ee=0;Ee<30;++Ee)H[Ee]=0}var Ye=2,We=0,Et=x,lt=ue-ge&32767;if(_e>2&&le==L(m-lt))for(var rt=Math.min(w,_e)-1,kt=Math.min(32767,m),Pt=Math.min(258,_e);lt<=kt&&--Et&&ue!=ge;){if(s[m+Ye]==s[m+Ye-lt]){for(var sn=0;sn<Pt&&s[m+sn]==s[m+sn-lt];++sn);if(sn>Ye){if(Ye=sn,We=lt,sn>rt)break;var hn=Math.min(lt,sn-2),wn=0;for(Ee=0;Ee<hn;++Ee){var Xn=m-lt+Ee+32768&32767,zn=Xn-I[Xn]+32768&32767;zn>wn&&(wn=zn,ge=Xn)}}}lt+=(ue=ge)-(ge=I[ue])+32768&32767}if(We){k[oe++]=268435456|jo[Ye]<<18|tl[We];var Gn=31&jo[Ye],gt=31&tl[We];ee+=bo[Gn]+Fo[gt],++j[257+Gn],++H[gt],re=m+Ye,++X}else k[oe++]=s[m],++j[s[m]]}}d=ca(s,u,o,k,j,H,ee,oe,he,m-he,d),!o&&7&d&&(d=Ua(u,d+1,Rl))}return xo(c,0,n+gu(d)+i)},_u=function(){for(var s=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&-306674912)^t>>>1;s[e]=t}return s}(),Dl=function(){var s=-1;return{p:function(e){for(var t=s,n=0;n<e.length;++n)t=_u[255&t^e[n]]^t>>>8;s=t},d:function(){return~s}}},Tm=function(){var s=1,e=0;return{p:function(t){for(var n=s,i=e,o=t.length,a=0;a!=o;){for(var c=Math.min(a+2655,o);a<c;++a)i+=n+=t[a];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}s=n,e=i},d:function(){return(255&(s%=65521))<<24|s>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},So=function(s,e,t,n,i){return Nd(s,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):12+e.mem,t,n,!i)},il=function(s,e){var t={};for(var n in s)t[n]=s[n];for(var n in e)t[n]=e[n];return t},Co=function(s,e,t){for(var n=s(),i=s.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var c=n[a],u=o[a];if(typeof c=="function"){e+=";"+u+"=";var d=c.toString();if(c.prototype)if(d.indexOf("[native code]")!=-1){var m=d.indexOf(" ",8)+1;e+=d.slice(m,d.indexOf("(",m))}else for(var g in e+=d,c.prototype)e+=";"+u+".prototype."+g+"="+c.prototype[g].toString();else e+=d}else t[u]=c}return[e,t]},yu=[],ua=function(s,e,t,n){var i;if(!yu[t]){for(var o="",a={},c=s.length-1,u=0;u<c;++u)o=(i=Co(s[u],o,a))[0],a=i[1];yu[t]=Co(s[c],o,a)}var d=il({},yu[t][1]);return function(m,g,_,w,x){var T=new Worker(Ao[g]||(Ao[g]=URL.createObjectURL(new Blob([m],{type:"text/javascript"}))));return T.onerror=function(I){return x(I.error,null)},T.onmessage=function(I){return x(null,I.data)},T.postMessage(_,w),T}(yu[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,d,function(m){var g=[];for(var _ in m)(m[_]instanceof fe||m[_]instanceof os||m[_]instanceof Tl)&&g.push((m[_]=new m[_].constructor(m[_])).buffer);return g}(d),n)},mh=function(){return[fe,os,Tl,bo,Fo,wo,Fc,hc,cf,Pl,dc,Bs,ph,Qs,nl,gu,xo,vu,pa,fc,zi]},Au=function(){return[fe,os,Tl,bo,Fo,wo,jo,tl,dh,aa,la,hh,dc,Eo,Rl,Bs,io,si,pc,zo,Mm,fh,Ua,ca,gu,xo,Nd,So,Vc,fc]},Im=function(){return[Fd,gh,Zi,Dl,_u]},Pm=function(){return[mc,jd]},jc=function(){return[Ls,Zi,Tm]},Rm=function(){return[Dm]},fc=function(s){return postMessage(s,[s.buffer])},zi=function(s){return s&&s.size&&new fe(s.size)},Os=function(s,e,t,n,i,o){var a=ua(t,n,i,function(c,u){a.terminate(),o(c,u)});return a.postMessage([s,e],e.consume?[s.buffer]:[]),function(){a.terminate()}},as=function(s){return s.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return s.push(e.data[0],e.data[1])}},ha=function(s,e,t,n,i){var o,a=ua(s,n,i,function(c,u){c?(a.terminate(),e.ondata.call(e,c)):(u[1]&&a.terminate(),e.ondata.call(e,c,u[0],u[1]))});a.postMessage(t),e.push=function(c,u){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([c,o=u],[c.buffer])},e.terminate=function(){a.terminate()}},Tr=function(s,e){return s[e]|s[e+1]<<8},mr=function(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24)>>>0},zc=function(s,e){return mr(s,e)+4294967296*mr(s,e+4)},Zi=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},Fd=function(s,e){var t=e.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=e.level<2?4:e.level==9?2:0,s[9]=3,e.mtime!=0&&Zi(s,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){s[3]=8;for(var n=0;n<=t.length;++n)s[n+10]=t.charCodeAt(n)}},mc=function(s){if(s[0]!=31||s[1]!=139||s[2]!=8)throw"invalid gzip data";var e=s[3],t=10;4&e&&(t+=s[10]|2+(s[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!s[t++]);return t+(2&e)},jd=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},gh=function(s){return 10+(s.filename&&s.filename.length+1||0)},Ls=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;s[0]=120,s[1]=n<<6|(n?32-2*n:1)},Dm=function(s){if((15&s[0])!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(32&s[1])throw"invalid zlib data: preset dictionaries not supported"};function ks(s,e){return e||typeof s!="function"||(e=s,s={}),this.ondata=e,s}var da=function(){function s(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return s.prototype.p=function(e,t){this.ondata(So(e,this.o,0,0,!t),t)},s.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},s}(),Bm=function(){return function(s,e){ha([Au,function(){return[as,da]}],this,ks.call(this,s,e),function(t){var n=new da(t.data);onmessage=as(n)},6)}}();function Es(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Os(s,e,[Au],function(n){return fc(Vc(n.data[0],n.data[1]))},0,t)}function Vc(s,e){return So(s,e||{},0,0)}var ro=function(){function s(e){this.s={},this.p=new fe(0),this.ondata=e}return s.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new fe(t+e.length);n.set(this.p),n.set(e,t),this.p=n},s.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=vu(this.p,this.o,this.s);this.ondata(xo(n,t,this.s.b),this.d),this.o=xo(n,this.s.b-32768),this.s.b=this.o.length,this.p=xo(this.p,this.s.p/8|0),this.s.p&=7},s.prototype.push=function(e,t){this.e(e),this.c(t)},s}(),xn=function(){return function(s){this.ondata=s,ha([mh,function(){return[as,ro]}],this,0,function(){var e=new ro;onmessage=as(e)},7)}}();function Ss(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Os(s,e,[mh],function(n){return fc(pa(n.data[0],zi(n.data[1])))},1,t)}function pa(s,e){return vu(s,e)}var Na=function(){function s(e,t){this.c=Dl(),this.l=0,this.v=1,da.call(this,e,t)}return s.prototype.push=function(e,t){da.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=So(e,this.o,this.v&&gh(this.o),t&&8,!t);this.v&&(Fd(n,this.o),this.v=0),t&&(Zi(n,n.length-8,this.c.d()),Zi(n,n.length-4,this.l)),this.ondata(n,t)},s}(),kv=function(){return function(s,e){ha([Au,Im,function(){return[as,da,Na]}],this,ks.call(this,s,e),function(t){var n=new Na(t.data);onmessage=as(n)},8)}}();function Mo(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Os(s,e,[Au,Im,function(){return[Gc]}],function(n){return fc(Gc(n.data[0],n.data[1]))},2,t)}function Gc(s,e){e||(e={});var t=Dl(),n=s.length;t.p(s);var i=So(s,e,gh(e),8),o=i.length;return Fd(i,e),Zi(i,o-8,t.d()),Zi(i,o-4,n),i}var uf=function(){function s(e){this.v=1,ro.call(this,e)}return s.prototype.push=function(e,t){if(ro.prototype.e.call(this,e),this.v){var n=this.p.length>3?mc(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ro.prototype.c.call(this,t)},s}(),rr=function(){return function(s){this.ondata=s,ha([mh,Pm,function(){return[as,ro,uf]}],this,0,function(){var e=new uf;onmessage=as(e)},9)}}();function vh(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Os(s,e,[mh,Pm,function(){return[tr]}],function(n){return fc(tr(n.data[0]))},3,t)}function tr(s,e){return vu(s.subarray(mc(s),-8),e||new fe(jd(s)))}var hf=function(){function s(e,t){this.c=Tm(),this.v=1,da.call(this,e,t)}return s.prototype.push=function(e,t){da.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e);var n=So(e,this.o,this.v&&2,t&&4,!t);this.v&&(Ls(n,this.o),this.v=0),t&&Zi(n,n.length-4,this.c.d()),this.ondata(n,t)},s}(),I0=function(){return function(s,e){ha([Au,jc,function(){return[as,da,hf]}],this,ks.call(this,s,e),function(t){var n=new hf(t.data);onmessage=as(n)},10)}}();function P0(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Os(s,e,[Au,jc,function(){return[df]}],function(n){return fc(df(n.data[0],n.data[1]))},4,t)}function df(s,e){e||(e={});var t=Tm();t.p(s);var n=So(s,e,2,4);return Ls(n,e),Zi(n,n.length-4,t.d()),n}var bu=function(){function s(e){this.v=1,ro.call(this,e)}return s.prototype.push=function(e,t){if(ro.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ro.prototype.c.call(this,t)},s}(),Om=function(){return function(s){this.ondata=s,ha([mh,Rm,function(){return[as,ro,bu]}],this,0,function(){var e=new bu;onmessage=as(e)},11)}}();function pf(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Os(s,e,[mh,Rm,function(){return[ff]}],function(n){return fc(ff(n.data[0],zi(n.data[1])))},5,t)}function ff(s,e){return vu((Dm(s),s.subarray(2,-4)),e)}var Pn=function(){function s(e){this.G=uf,this.I=ro,this.Z=bu,this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new fe(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,o=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(o):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},s}(),R0=function(){function s(e){this.G=rr,this.I=xn,this.Z=Om,this.ondata=e}return s.prototype.push=function(e,t){Pn.prototype.push.call(this,e,t)},s}();function D0(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return s[0]==31&&s[1]==139&&s[2]==8?vh(s,e,t):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?Ss(s,e,t):pf(s,e,t)}function fa(s,e){return s[0]==31&&s[1]==139&&s[2]==8?tr(s,e):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?pa(s,e):ff(s,e)}var zd=function(s,e,t,n){for(var i in s){var o=s[i],a=e+i;o instanceof fe?t[a]=[o,n]:Array.isArray(o)?t[a]=[o[0],il(n,o[1])]:zd(o,a+"/",t,n)}},B=typeof TextEncoder<"u"&&new TextEncoder,y=typeof TextDecoder<"u"&&new TextDecoder,S=0;try{y.decode(Rl,{stream:!0}),S=1}catch{}var U=function(s){for(var e="",t=0;;){var n=s[t++],i=(n>127)+(n>223)+(n>239);if(t+i>s.length)return[e,xo(s,t-1)];i?i==3?(n=((15&n)<<18|(63&s[t++])<<12|(63&s[t++])<<6|63&s[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&i?String.fromCharCode((31&n)<<6|63&s[t++]):String.fromCharCode((15&n)<<12|(63&s[t++])<<6|63&s[t++]):e+=String.fromCharCode(n)}},Y=function(){function s(e){this.ondata=e,S?this.t=new TextDecoder:this.p=Rl}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new fe(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=U(n),o=i[0],a=i[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(o,t)}},s}(),ye=function(){function s(e){this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(xe(e),this.d=t||!1)},s}();function xe(s,e){if(e){for(var t=new fe(s.length),n=0;n<s.length;++n)t[n]=s.charCodeAt(n);return t}if(B)return B.encode(s);var i=s.length,o=new fe(s.length+(s.length>>1)),a=0,c=function(m){o[a++]=m};for(n=0;n<i;++n){if(a+5>o.length){var u=new fe(a+8+(i-n<<1));u.set(o),o=u}var d=s.charCodeAt(n);d<128||e?c(d):d<2048?(c(192|d>>6),c(128|63&d)):d>55295&&d<57344?(c(240|(d=65536+(1047552&d)|1023&s.charCodeAt(++n))>>18),c(128|d>>12&63),c(128|d>>6&63),c(128|63&d)):(c(224|d>>12),c(128|d>>6&63),c(128|63&d))}return xo(o,0,a)}function dt(s,e){if(e){for(var t="",n=0;n<s.length;n+=16384)t+=String.fromCharCode.apply(null,s.subarray(n,n+16384));return t}if(y)return y.decode(s);var i=U(s),o=i[0];if(i[1].length)throw"invalid utf-8 data";return o}var Jt=function(s){return s==1?3:s<6?2:s==9?1:0},bn=function(s,e){return e+30+Tr(s,e+26)+Tr(s,e+28)},oi=function(s,e,t){var n=Tr(s,e+28),i=dt(s.subarray(e+46,e+46+n),!(2048&Tr(s,e+8))),o=e+46+n,a=mr(s,e+20),c=t&&a==4294967295?yr(s,o):[a,mr(s,e+24),mr(s,e+42)],u=c[0],d=c[1],m=c[2];return[Tr(s,e+10),u,d,i,o+Tr(s,e+30)+Tr(s,e+32),m]},yr=function(s,e){for(;Tr(s,e)!=1;e+=4+Tr(s,e+2));return[zc(s,e+12),zc(s,e+4),zc(s,e+20)]},Xr=function(s){var e=0;if(s)for(var t in s){var n=s[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},jr=function(s,e,t,n,i,o,a,c){var u=n.length,d=t.extra,m=c&&c.length,g=Xr(d);Zi(s,e,a!=null?33639248:67324752),e+=4,a!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(o==null&&8),s[e++]=i&&8,s[e++]=255&t.compression,s[e++]=t.compression>>8;var _=new Date(t.mtime==null?Date.now():t.mtime),w=_.getFullYear()-1980;if(w<0||w>119)throw"date not in range 1980-2099";if(Zi(s,e,w<<25|_.getMonth()+1<<21|_.getDate()<<16|_.getHours()<<11|_.getMinutes()<<5|_.getSeconds()>>>1),e+=4,o!=null&&(Zi(s,e,t.crc),Zi(s,e+4,o),Zi(s,e+8,t.size)),Zi(s,e+12,u),Zi(s,e+14,g),e+=16,a!=null&&(Zi(s,e,m),Zi(s,e+6,t.attrs),Zi(s,e+10,a),e+=14),s.set(n,e),e+=u,g)for(var x in d){var T=d[x],I=T.length;Zi(s,e,+x),Zi(s,e+2,I),s.set(T,e+4),e+=4+I}return m&&(s.set(c,e),e+=m),e},ma=function(s,e,t,n,i){Zi(s,e,101010256),Zi(s,e+8,t),Zi(s,e+10,t),Zi(s,e+12,n),Zi(s,e+16,i)},rl=function(){function s(e){this.filename=e,this.c=Dl(),this.size=0,this.compression=0}return s.prototype.process=function(e,t){this.ondata(null,e,t)},s.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},s}(),_h=function(){function s(e,t){var n=this;t||(t={}),rl.call(this,e),this.d=new da(t,function(i,o){n.ondata(null,i,o)}),this.compression=8,this.flag=Jt(t.level)}return s.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},s.prototype.push=function(e,t){rl.prototype.push.call(this,e,t)},s}(),mf=function(){function s(e,t){var n=this;t||(t={}),rl.call(this,e),this.d=new Bm(t,function(i,o,a){n.ondata(i,o,a)}),this.compression=8,this.flag=Jt(t.level),this.terminate=this.d.terminate}return s.prototype.process=function(e,t){this.d.push(e,t)},s.prototype.push=function(e,t){rl.prototype.push.call(this,e,t)},s}(),Vd=function(){function s(e){this.ondata=e,this.u=[],this.d=1}return s.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=xe(e.filename),i=n.length,o=e.comment,a=o&&xe(o),c=i!=e.filename.length||a&&o.length!=a.length,u=i+Xr(e.extra)+30;if(i>65535)throw"filename too long";var d=new fe(u);jr(d,0,e,n,c);var m=[d],g=function(){for(var I=0,R=m;I<R.length;I++){var M=R[I];t.ondata(null,M,!1)}m=[]},_=this.d;this.d=0;var w=this.u.length,x=il(e,{f:n,u:c,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(g(),_){var I=t.u[w+1];I?I.r():t.d=1}_=1}}),T=0;e.ondata=function(I,R,M){if(I)t.ondata(I,R,M),t.terminate();else if(T+=R.length,m.push(R),M){var C=new fe(16);Zi(C,0,134695760),Zi(C,4,e.crc),Zi(C,8,T),Zi(C,12,e.size),m.push(C),x.c=T,x.b=u+T+16,x.crc=e.crc,x.size=e.size,_&&x.r(),_=1}else _&&g()},this.u.push(x)},s.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},s.prototype.e=function(){for(var e=0,t=0,n=0,i=0,o=this.u;i<o.length;i++)n+=46+(d=o[i]).f.length+Xr(d.extra)+(d.o?d.o.length:0);for(var a=new fe(n+22),c=0,u=this.u;c<u.length;c++){var d=u[c];jr(a,e,d,d.f,d.u,d.c,t,d.o),e+=46+d.f.length+Xr(d.extra)+(d.o?d.o.length:0),t+=d.b}ma(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},s.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},s}();function Gd(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};zd(s,"",n,e);var i=Object.keys(n),o=i.length,a=0,c=0,u=o,d=new Array(o),m=[],g=function(){for(var T=0;T<m.length;++T)m[T]()},_=function(){var T=new fe(c+22),I=a,R=c-a;c=0;for(var M=0;M<u;++M){var C=d[M];try{var L=C.c.length;jr(T,c,C,C.f,C.u,L);var k=30+C.f.length+Xr(C.extra),j=c+k;T.set(C.c,j),jr(T,a,C,C.f,C.u,L,c,C.m),a+=16+k+(C.m?C.m.length:0),c=j+L}catch(H){return t(H,null)}}ma(T,a,d.length,R,I),t(null,T)};o||_();for(var w=function(T){var I=i[T],R=n[I],M=R[0],C=R[1],L=Dl(),k=M.length;L.p(M);var j=xe(I),H=j.length,X=C.comment,ee=X&&xe(X),oe=ee&&ee.length,re=Xr(C.extra),he=C.level==0?0:8,le=function(ue,ge){if(ue)g(),t(ue,null);else{var _e=ge.length;d[T]=il(C,{size:k,crc:L.d(),c:ge,f:j,m:ee,u:H!=I.length||ee&&X.length!=oe,compression:he}),a+=30+H+re+_e,c+=76+2*(H+re)+(oe||0)+_e,--o||_()}};if(H>65535&&le("filename too long",null),he)if(k<16e4)try{le(null,Vc(M,C))}catch(ue){le(ue,null)}else m.push(Es(M,C,le));else le(null,M)},x=0;x<u;++x)w(x);return g}function yh(s,e){e||(e={});var t={},n=[];zd(s,"",t,e);var i=0,o=0;for(var a in t){var c=t[a],u=c[0],d=c[1],m=d.level==0?0:8,g=(H=xe(a)).length,_=d.comment,w=_&&xe(_),x=w&&w.length,T=Xr(d.extra);if(g>65535)throw"filename too long";var I=m?Vc(u,d):u,R=I.length,M=Dl();M.p(u),n.push(il(d,{size:u.length,crc:M.d(),c:I,f:H,m:w,u:g!=a.length||w&&_.length!=x,o:i,compression:m})),i+=30+g+T+R,o+=76+2*(g+T)+(x||0)+R}for(var C=new fe(o+22),L=i,k=o-i,j=0;j<n.length;++j){var H=n[j];jr(C,H.o,H,H.f,H.u,H.c.length);var X=30+H.f.length+Xr(H.extra);C.set(H.c,H.o+X),jr(C,i,H,H.f,H.u,H.c.length,H.o,H.m),i+=16+X+(H.m?H.m.length:0)}return ma(C,i,n.length,k,L),C}var Hd=function(){function s(){}return s.prototype.push=function(e,t){this.ondata(null,e,t)},s.compression=0,s}(),Us=function(){function s(){var e=this;this.i=new ro(function(t,n){e.ondata(null,t,n)})}return s.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},s.compression=8,s}(),Uv=function(){function s(e,t){var n=this;t<32e4?this.i=new ro(function(i,o){n.ondata(null,i,o)}):(this.i=new xn(function(i,o,a){n.ondata(i,o,a)}),this.terminate=this.i.terminate)}return s.prototype.push=function(e,t){this.i.terminate&&(e=xo(e,0)),this.i.push(e,t)},s.compression=8,s}(),wu=function(){function s(e){this.onfile=e,this.k=[],this.o={0:Hd},this.p=Rl}return s.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),o=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(i)).length)return this.push(e,t)}else{var a=0,c=0,u=void 0,d=void 0;this.p.length?e.length?((d=new fe(this.p.length+e.length)).set(this.p),d.set(e,this.p.length)):d=this.p:d=e;for(var m=d.length,g=this.c,_=g&&this.d,w=function(){var I,R=mr(d,c);if(R==67324752){a=1,u=c,x.d=null,x.c=0;var M=Tr(d,c+6),C=Tr(d,c+8),L=2048&M,k=8&M,j=Tr(d,c+26),H=Tr(d,c+28);if(m>c+30+j+H){var X=[];x.k.unshift(X),a=2;var ee,oe=mr(d,c+18),re=mr(d,c+22),he=dt(d.subarray(c+30,c+=30+j),!L);oe==4294967295?(I=k?[-2]:yr(d,c),oe=I[0],re=I[1]):k&&(oe=-1),c+=H,x.c=oe;var le={name:he,compression:C,start:function(){if(!le.ondata)throw"no callback";if(oe){var ue=n.o[C];if(!ue)throw"unknown compression type "+C;(ee=oe<0?new ue(he):new ue(he,oe,re)).ondata=function(Ye,We,Et){le.ondata(Ye,We,Et)};for(var ge=0,_e=X;ge<_e.length;ge++){var Ee=_e[ge];ee.push(Ee,!1)}n.k[0]==X&&n.c?n.d=ee:ee.push(Rl,!0)}else le.ondata(null,Rl,!0)},terminate:function(){ee&&ee.terminate&&ee.terminate()}};oe>=0&&(le.size=oe,le.originalSize=re),x.onfile(le)}return"break"}if(g){if(R==134695760)return u=c+=12+(g==-2&&8),a=3,x.c=0,"break";if(R==33639248)return u=c-=4,a=3,x.c=0,"break"}},x=this;c<m-4&&w()!=="break";++c);if(this.p=Rl,g<0){var T=a?d.subarray(0,u-12-(g==-2&&8)-(mr(d,u-16)==134695760&&4)):d.subarray(0,c);_?_.push(T,!!a):this.k[+(a==2)].push(T)}if(2&a)return this.push(d.subarray(c),t);this.p=d.subarray(c)}if(t){if(this.c)throw"invalid zip file";this.p=null}},s.prototype.register=function(e){this.o[e.compression]=e},s}();function Qd(s,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var _=0;_<t.length;++_)t[_]()},i={},o=s.length-22;mr(s,o)!=101010256;--o)if(!o||s.length-o>65558)return void e("invalid zip file",null);var a=Tr(s,o+8);a||e(null,{});var c=a,u=mr(s,o+16),d=u==4294967295;if(d){if(o=mr(s,o-12),mr(s,o)!=101075792)return void e("invalid zip file",null);c=a=mr(s,o+32),u=mr(s,o+48)}for(var m=function(_){var w=oi(s,u,d),x=w[0],T=w[1],I=w[2],R=w[3],M=w[4],C=w[5],L=bn(s,C);u=M;var k=function(H,X){H?(n(),e(H,null)):(i[R]=X,--a||e(null,i))};if(x)if(x==8){var j=s.subarray(L,L+T);if(T<32e4)try{k(null,pa(j,new fe(I)))}catch(H){k(H,null)}else t.push(Ss(j,{size:I},k))}else k("unknown compression type "+x,null);else k(null,xo(s,L,L+T))},g=0;g<c;++g)m();return n}function Ws(s){for(var e={},t=s.length-22;mr(s,t)!=101010256;--t)if(!t||s.length-t>65558)throw"invalid zip file";var n=Tr(s,t+8);if(!n)return{};var i=mr(s,t+16),o=i==4294967295;if(o){if(t=mr(s,t-12),mr(s,t)!=101075792)throw"invalid zip file";n=mr(s,t+32),i=mr(s,t+48)}for(var a=0;a<n;++a){var c=oi(s,i,o),u=c[0],d=c[1],m=c[2],g=c[3],_=c[4],w=c[5],x=bn(s,w);if(i=_,u){if(u!=8)throw"unknown compression type "+u;e[g]=pa(s.subarray(x,x+d),new fe(m))}else e[g]=xo(s,x,x+d)}return e}class Nv extends p.hH6{load(e,t,n,i){return this.setResponseType("arraybuffer"),super.load(e,o=>{const a=Ws(new Uint8Array(o)),c=new Map(Object.entries(a).map(([u,d])=>[u,new File([d],u)]));t==null||t(c)},n,i)}}class B0 extends V.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,t=!1){super(),this._processors=new ta,this._logger=console.log,this.Importers=[new Br(Jn,["json"],!1),new Br(p.hH6,["txt"],!1),new Br(bi,["rgbe.png","hdr.png","hdrpng"],!1),new Br(p.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Br(lf,["cube"],!1),new Br(Nv,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new p.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(Lc(e)),this.Importers.push(xm(e)),this.Importers.push(Or())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){var o;let t=decodeURI(e);const n=(o=this._rootContext)==null?void 0:o.rootUrl;t.includes("://")||!n||t.startsWith(n)||(t=n+t),t=t.replace("./",""),t=t.replace(/^(\/\/)/,"/"),t=t.replace(/\?.*$/,"");const i=this._fileDatabase.get(t);return i?i.ext?(i.objectUrl||(i.objectUrl=URL.createObjectURL(i)+"#"+t),i.objectUrl):(console.error("Unable to determine file extension",i),e):e}_createLoader(e){const t=this._getImporter(e),n=t==null?void 0:t.ctor(this);return n&&(t==null||t.ext.forEach(i=>{const o=new RegExp(i.startsWith("data:")?"^"+i+"\\/":"\\."+i+"$","i");this._loadingManager.addHandler(o,n)})),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}addEventListener(e,t){if(super.addEventListener(e,t),e==="loaderCreate")for(const n of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:n.loader})}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:i}=t;if(i&&i.length<1&&(i=void 0),e.size===0)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const o=[],a=[];if(e.forEach((c,u)=>{this.registerFile(u,c);const d=c.ext;d&&((i==null?void 0:i.includes(d.toLowerCase()))??1)&&(this._isRootFileExtension(d)?o.push(u):a.push(u))}),o.length>0)for(const c of o){let u=await this._importFile(c,void 0,t);u&&(u=await this.processImported(u,t)),n.set(c,u)}else for(const c of a){let u=await this._importFile(c,void 0,t);u&&(u=await this.processImported(u,t)),n.set(c,u)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((c,u)=>{this.unregisterFile(u)}),n}registerFile(e,t){var o;e=e.replace(/\?.*$/,"");const n=(t==null?void 0:t.ext)??((o=(0,V.parseFileExtension)((t==null?void 0:t.name)??e.trim()))==null?void 0:o.toLowerCase());t&&(t.ext||(t.ext=n),this._fileDatabase.set(e,t));let i=this._getLoader(e);if(i||(i=this._createLoader(t??{name:e,ext:n})),i){for(const a of this._loaderCache)if(a.loader===i){a.files.push(e);break}}return i}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return this.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,n={},i){var a;if(t!=null&&t.__imported)return t.__imported;let o;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const c=this.resolveURL(e),u=e.replace(/\?.*$/,"").trim(),d=n.fileHandler??(await this._loadingManager.getHandler(u)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0));if(!d)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:c,rootUrl:p.Zp0.extractUrlBase(e),baseUrl:p.Zp0.extractUrlBase(c)},o=await d.loadAsync(e+(n.queryString?(e.includes("?")?"&":"?")+n.queryString:""),m=>{i&&i(m),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:m.loaded||void 0,totalBytes:m.total||void 0,progress:m.total>0?m.loaded/m.total:1})}),d.transform&&(o=await d.transform(o,n)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(c){return console.error("AssetImporter: Unable to import file",e,t),console.error(c),console.error(c==null?void 0:c.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:c}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t){t.__imported=o;let c=[];Array.isArray(o)?c=o:(a=o.userData)!=null&&a.rootSceneModelRoot?c.push(...o.children):c.push(o),c.forEach(u=>{var d;(d=u.addEventListener)==null||d.call(u,"dispose",()=>{t.__imported=void 0})})}if(o&&typeof o=="object"){o.__rootPath=e;const c=t||this._fileDatabase.get(e);c&&(o.__rootBlob=c)}return o}_getImporter(e,t=!1){return this.Importers.find(n=>{if(t&&!n.root)return!1;const i=n.ext.find(o=>{var a,c,u;return e.ext&&o===e.ext.toLowerCase()||((c=(a=e.name)==null?void 0:a.toLowerCase())==null?void 0:c.endsWith("."+o.toLowerCase()))||(o==null?void 0:o.startsWith("data:"))&&((u=e.name)==null?void 0:u.startsWith(o))});return!!i&&(e.ext=i,!0)})}_getLoader(e){return this._loadingManager.getHandler(e.trim())??void 0}async importAsset(e,t={},n){var a,c,u;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const m=this._cachedAssets.find(g=>g.path===e.path);m&&Object.assign(e,m)}const d=this._cachedAssets.findIndex(m=>m.path===e.path);d>=0&&this._cachedAssets.splice(d,1),this._cachedAssets.push(e)}let i;if(e!=null&&e.preImported&&(i=await e.preImported),!t.forceImport&&i){const d=await this.processImported(i,t);let m=!1;for(const g of d){if((a=g.userData)!=null&&a.rootSceneModelRoot&&[...g.children,...g.__processedChildren||[]].find(_=>_.__disposed)){m=!0;break}if(g.__disposed){m=!0;break}}if(!m||t.reimportDisposed===!1)return d}const o=t.pathOverride||e.path;if(e.preImported=this._importFile(o,typeof((c=e.file)==null?void 0:c.arrayBuffer)=="function"?e.file:void 0,t,n),i=await e.preImported,i&&(this.dispatchEvent({type:"processFileStart",path:o,result:i}),i=await this.processImported(i,t),this.dispatchEvent({type:"processFileEnd",path:o,result:i})),i){const d=[];Array.isArray(i)?d.push(...i):(u=i.userData)!=null&&u.rootSceneModelRoot?d.push(...i.children):d.push(i),d.forEach(m=>{var g;return(g=m.addEventListener)==null?void 0:g.call(m,"dispose",()=>{e!=null&&e.preImported&&(e.preImported=void 0)})})}return i}async importSingle(e,t={}){var n;return typeof e=="string"?await this.importSinglePath(e,t):(n=await this.importAsset(e,t))==null?void 0:n[0]}async importSinglePath(e,t){var n;return(n=await this.importPath(e,t))==null?void 0:n[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed,delete n.fileHandler,delete n.importedFile;const i=JSON.stringify(n);let o;return o=this._cachedAssets.find(a=>a.path===e&&a._options===i)||{path:e},o._options=i,t.importedFile&&(o.file=t.importedFile),await this.importAsset(o,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var a,c,u,d,m,g,_,w;let n=e;if(!n)return[];if(t.processImported===!1)return[n];if(Array.isArray(n)){const x=[];for(const T of n)x.push(...await this.processImported(T,t));return x}if((a=n.userData)!=null&&a.rootSceneModelRoot){if(t._rootSceneImported=!0,n.__processedChildren&&!t.forceImporterReprocess)return n.__processedChildren;if(!(n.children.length<1))return n.animations&&(n.children[0].animations||(n.children[0].animations=[]),n.children[0].animations.push(...n.animations)),n.__importedViewerConfig&&(n.children[0].__importedViewerConfig=n.__importedViewerConfig),n.userData.__importData&&(n.children[0].userData.__importData=n.userData.__importData),n.__processedChildren=await this.processImported([...n.children],t),n.__processedChildren;if(((c=n.animations)==null?void 0:c.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",n.animations),!n.__importedViewerConfig)return[];n=n.__importedViewerConfig}if((u=n.userData)!=null&&u.iModel&&(n=n.userData.iModel),(d=n.userData)!=null&&d.iMaterial&&(n=n.userData.iMaterial),n.assetImporterProcessed&&!t.forceImporterReprocess)return[n];const i=n.__rootPath,o=n.__rootBlob;if(!n.assetType){if(n.isBufferGeometry&&(n=new p.Kj0(n,new p.Wid)),n.isObject3D)if(n.isLight)n=Lm(n);else{const x=[];n.traverse(T=>{T!==n&&T.isLight&&x.push(T)});for(const T of x)Lm(T);n=new No(n,t)}n.isTexture&&(n.assetType="texture",t._testDataTextureComplete&&(n.isDataTexture&&((m=n.image)!=null&&m.data)&&(n.image.complete=!0),(g=n.image)!=null&&g.complete&&(n.needsUpdate=!0)),t.generateMipmaps!==void 0&&(n.generateMipmaps=t.generateMipmaps),n.generateMipmaps||n.isRenderTargetTexture||(n.minFilter=n.minFilter===p.D1R?p.wem:n.minFilter,n.magFilter=n.magFilter===p.D1R?p.wem:n.magFilter)),n.isMaterial&&(n.assetType="material")}if(n.assetType!=null)return n.userData&&(n.userData.rootPath||!i||i.startsWith("blob:")||i.startsWith("/")||(n.userData.rootPath=i),o&&(n.userData.__sourceBlob=o,n.userData.__needsSourceBuffer&&(n.userData.__sourceBuffer=await o.arrayBuffer(),delete n.userData.__needsSourceBuffer))),n=await this._processors.process(n.assetType,n,{}),n.assetImporterProcessed=!0,[n];if(n instanceof Map)return[...(await this.importFiles(n,t)).values()].flat();if(n.type&&n.type!=="ViewerApp"&&n.type!=="ThreeViewer"){const x=this._viewer.getPluginByType(n.type);if(x){let T=n._importedResources||{};return n.resources&&(T=await((_=this._viewer.getManager())==null?void 0:_.importConfigResources(n.resources)),delete n.resources,n._importedResources=T),typeof x.fromJSON=="function"&&(await Promise.resolve(x.fromJSON(n,T)),n.assetImporterProcessed=!1),[]}}return n.plugins||n.type==="ViewerApp"||n.type==="ThreeViewer"?(n.resources=await((w=this._viewer.getManager())==null?void 0:w.importConfigResources(n.resources)),await this._viewer.getManager().importViewerConfig(n),n.assetImporterProcessed=!1,[]):(console.warn("unknown/null asset type: ",n,n.plugins),[n])}dispose(){var e;this.clearCache(),(e=this._processors)==null||e.dispose()}clearLoaderCache(){this._loaderCache.forEach(e=>{e.loader.dispose&&e.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function sl(s){if(!s)return p.ywz;const e=s.extensions.has("EXT_color_buffer_half_float")||s.capabilities.isWebGL2&&s.extensions.has("EXT_color_buffer_float"),t=s.capabilities.isWebGL2||s.extensions.has("OES_texture_float")||s.extensions.has("WEBGL_color_buffer_float");return e?p.cLu:t?p.VzW:p.ywz}function Lm(s){var t,n;if(!s.isLight||s.assetType==="light")return s;if(s.uiConfig)return console.warn("ui config already exists, not supported",s),s;let e;if(s.children.length,s.isDirectionalLight&&(e=new ji),s.isAmbientLight&&(e=new Ud),s.isSpotLight&&(e=new yo),s.isPointLight&&(e=new fu),e){(n=(t=e.lightObject).copy)==null||n.call(t,s);const i=s.parent;i!=null&&i.isObject3D&&(i.remove(s),s.dispose(),s.userData.iModel=e,i.add(e.lightObject),e.uuid=s.uuid),Ra(e.lightObject,i)}else console.warn("unknown light type: ",s);return e}class so extends p.u7G{constructor(e){super(e)}async loadAsync(e,t){var o;const n=new p.hH6(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const i=await n.loadAsync(e,t);try{const a=JSON.parse(i);if(a.images&&this.importer){const c={};let u=a.images;Array.isArray(u)||(u=Object.values(u));for(const d of a.images){if(!d.url||!d.uuid)continue;const m=(o=await this.importer.importPath(d.url,{processImported:!1}))==null?void 0:o[0],g=m==null?void 0:m.source;if(!m||!g)continue;const _=new p.Hw6(g.data);_.uuid=d.uuid,c[_.uuid]=_,m.dispose()}return await xs.LoadRootPathTextures(a.textures,c||a.images,this.importer),this.parse(a,c)}return this.parse(a)}catch(a){throw console.error(a),this.manager.itemError(e),a}}parse(e,t){var u;let n;const i={p:new Promise(d=>{n=d})};if(e.images||e.textures){const d=new xs(this.manager);let m={};const g=T=>{n(),i.p=void 0,Object.values(m).forEach(I=>{var R;I.isTexture&&((R=I.image)!=null&&R.complete)&&(I.needsUpdate=!0)})};let _=e.images||[];Array.isArray(_)||(_=Object.values(_));const w=t||d.parseImages(_,g);let x=e.textures;Array.isArray(x)||(x=Object.values(x)),m=d.parseTextures2(x,w,g),this.setTextures(m)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const o={...e};if(Object.entries(o).forEach(([d,m])=>{m&&typeof m=="string"&&this.textures[m]&&(o[d]=this.textures[m])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),e.normalScale!==void 0){const d=e.normalScale;Array.isArray(d)===!1&&(o.normalScale=[d,d])}let a=e.type;a!=="MeshPhysicalMaterial"&&a!=="MeshStandardMaterial"&&a!=="PhysicalMaterial"||(a=Hs.TYPE),o.userData=Di(o.userData,void 0,!1,this);const c=((u=this.materials)==null?void 0:u.generateFromTemplateType(a,o))??super.parse(e);return this.setTextures({}),c.userData.imageLoadAwaiter=i,c}}class Qt extends V.SimpleEventDispatcher{constructor(e,t,{simpleCache:n=!1,storage:i}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(n||i)&&(n&&(p.CtF.enabled=!0),i&&window.Cache&&typeof window.Cache=="function"&&i instanceof window.Cache)){const o={...p.CtF};p.CtF.get=(a,c,u)=>c?a.startsWith("data:")||a.startsWith("blob")||a.startsWith("chrome-extension")?Promise.resolve(void 0):i.match(a).then(d=>{if(d)switch(c){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(m=>new DOMParser().parseFromString(m,u??"text/html"));case"json":return d.json();default:if(u===void 0)return d.text();{const m=/charset="?([^;"\s]*)"?/i.exec(u),g=m&&m[1]?m[1].toLowerCase():void 0,_=new TextDecoder(g);return d.arrayBuffer().then(w=>_.decode(w))}}}):o.get(a),p.CtF.add=async(a,c,u)=>{if(!u)return o.add(a,c);a.startsWith("data:")||a.startsWith("blob")||a.startsWith("chrome-extension")||(await i.match(a)&&await i.delete(a),await i.put(a,new Response(c,{status:200})))},p.CtF.remove=(a,c)=>{if(!c)return o.remove(a);i.delete(a)}}this.storage=i,this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map(n=>{var i;return(i=this._viewer)==null?void 0:i.scene.addSceneObject(n,{...t,allImported:e})})}async addAssetSingle(e,t={}){var n;return e?(n=await(typeof e=="string"?this.addFromPath:this.addAsset).call(this,e,t))==null?void 0:n[0]:void 0}async addImported(e,t={}){var n;return(n=this._importer)==null?void 0:n.processImported(e,t).then(i=>(this.addProcessedAssets(i,t),i))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(n=>n==null?void 0:n[0])}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const n=e.object;n.assetType==="material"&&((t=this._materials)==null||t.processMaterial(n,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new bs,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new B0(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(n,i)=>($p(n,o=>{var a;return(a=this._materials)==null?void 0:a.processModel(o,{recursive:!1})}),n)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(n,i)=>{var o;return(o=this.materials)!=null&&o.findMaterial(n.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),n.uuid=p.M8C.generateUUID(),n.userData.uuid&&(n.userData.uuid=n.uuid)),this._materials.processMaterial(n,i)}})),this._importer.Importers.push(new Br(so,[Hs.TypeSlug],!1,n=>(n&&(n.materials=this._materials),n&&(n.importer=this._importer),n)));const t=this.importViewerConfig.bind(this);this._importer.Importers.push(new Br(class extends Jn{async loadAsync(n,i){return t(await super.loadAsync(n,i))}},[Qt.ViewerTypeSlug],!0))}onRemove(e){var t,n;e===this._viewer&&((t=this._importer)==null||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(n=this._materials)==null||n.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return(t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetExporterPlugin"))==null?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,t){if(!this._viewer)return{};const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...t},i=this._viewer.toJSON(n);return e||Object.values(n).forEach(o=>{o&&Object.values(o).forEach(a=>{a.url&&(a.url.data instanceof ArrayBuffer||Array.isArray(a.url.data))&&(a.url.type==="Uint16Array"?(a.url.data instanceof Uint16Array||(a.url.data=new Uint16Array(a.url.data)),a.url.data="data:application/octet-stream;base64,"+(0,V.arrayBufferToBase64)(a.url.data.buffer)):a.url.type==="Uint8Array"?(a.url.data instanceof Uint8Array||(a.url.data=new Uint8Array(a.url.data)),a.url.data="data:application/octet-stream;base64,"+(0,V.arrayBufferToBase64)(a.url.data.buffer)):a.url.data instanceof ArrayBuffer?a.url.data="data:application/octet-stream;base64,"+(0,V.arrayBufferToBase64)(a.url.data.buffer):console.warn("Unsupported buffer type",a.url.type))})}),i.resources=n,i}exportPluginPresets(e){var n;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(n=this._viewer)==null?void 0:n.serializePlugins(t,e),resources:t}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){var a;const n=e.type;if(!(t=t||((a=this._viewer)==null?void 0:a.getPluginByType(n))))return void console.warn(`No plugin found for type ${n} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${n} does not support importing presets`);const i=e.resources||{};e.resources&&delete e.resources;const o=await this.importConfigResources(i);return await t.fromJSON(e,o),o&&(e.resources=o),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){var n;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const i of Object.values(t.materials))i.__useCount?delete i.__useCount:(n=this._materials)==null||n.unregisterMaterial(i);for(const i of Object.values(t.textures))i.__useCount&&delete i.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,t,n){var a,c,u;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const i={};Object.values(e).forEach(d=>{d&&Object.values(d).forEach(m=>{if(!m||!m.url||typeof m.url.data!="string")return;const g=m.url.data.match(/^data:.*;base64,(.*)$/);g!=null&&g[1]?m.url.data=(0,V.base64ToArrayBuffer)(g==null?void 0:g[1]):(m.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",m.url.type,"use base64"),m.url.data=new TextEncoder().encode(m.url.data).buffer)})}),t=t??new xs(this._importer.loadingManager),i.animations=e.animations?t.parseAnimations(e.animations):{},n&&n.animations&&(i.animations={...i.animations,...n.animations}),i.shapes=e.shapes?t.parseShapes(e.shapes):{},n&&n.shapes&&(i.shapes={...i.shapes,...n.shapes}),i.geometries=e.geometries?t.parseGeometries(e.geometries,i.shapes):{},n&&n.geometries&&(i.geometries={...i.geometries,...n.geometries}),i.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},n&&n.images&&(i.images={...i.images,...n.images}),await xs.LoadRootPathTextures(e.textures,i.images,this._importer),i.textures=e.textures?t.parseTextures2(Object.values(e.textures),i.images,()=>{Object.values(i.textures).forEach(d=>{var m;d.isTexture&&((m=d.image)!=null&&m.complete)&&(d.needsUpdate=!0)})}):{};for(const d of Object.entries(i.textures))d[1]=(a=await this._importer.processImported(d[1],{}))==null?void 0:a[0],d[1]?i.textures[d[0]]=d[1]:delete i.textures[d[0]];n&&n.textures&&(i.textures={...i.textures,...n.textures});const o=e.materials?Object.values(e.materials):[];for(const d of o)Object.entries(d).forEach(([m,g])=>{g&&g.resource&&g.uuid&&g.resource==="textures"&&(d[m]=g.uuid)});if(i.materials=t.parseMaterials2(o,i.textures,this._materials),n&&n.materials&&(i.materials={...i.materials,...n.materials}),e.object&&(i.object=t.parseObject(e.object,i.geometries,i.materials,i.textures,i.animations),e.skeletons&&(i.skeletons=t.parseSkeletons(e.skeletons,i.object),t.bindSkeletons(i.object,i.skeletons))),e.extras){i.extras=e.extras;for(const d of Object.values(e.extras))if(d.uuid&&d.url)if(typeof d.url=="string"){const m=await((c=this._importer)==null?void 0:c.importPath(d.url));(m==null?void 0:m.length)>0&&(i.extras[d.uuid]=m[0])}else if(d.url.data){const m=new File([(0,V.getTypedArray)(d.url.type,d.url.data)],d.url.path),g=await((u=this._importer)==null?void 0:u.importAsset({path:m.name,file:m}));(g==null?void 0:g.length)>0&&(i.extras[d.uuid]=g[0])}else console.warn("invalid URL type while loading extra resource")}return n&&n.extras&&(i.extras={...i.extras,...n.extras}),i.__isLoadedResources=!0,i}}Qt.PluginType="AssetManager",Qt.ViewerTypeSlug="vjson";class O0{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach(([i,o])=>o&&this.on(i,o))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(n=>n(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var i,o;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const t=Array.from(((i=e.dataTransfer)==null?void 0:i.files)||[]),n=Array.from(((o=e.dataTransfer)==null?void 0:o.items)||[]);if(t.length!==0||n.length!==0)if(n.length>0){const a=n.map(c=>c.webkitGetAsEntry());this._loadNextEntry(new Map,a)}else this._emit("drop",{files:new Map(t.map(a=>(a.filePath=a.name,[a.filePath,a])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const t=[].slice.call(this._inputEl.files??new FileList),n=new Map;t.forEach(i=>{i.filePath=i.webkitRelativePath||i.name,n.set(i.filePath,i)}),this._emit("drop",{files:n})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file(i=>{i.filePath=n.fullPath,e.set(n.fullPath,i),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",n.fullPath));else if(n.isDirectory){const i=n.createReader(),o=a=>{a.length?(t=t.concat(a),i.readEntries(o)):this._loadNextEntry(e,t)};i.readEntries(o)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class gc extends V.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new p.Pa4(.5,.5,3)},this.dependencies=[Qt],this.uiConfig={type:"folder",label:"Drop Options",expanded:!0,children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new O0(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var o,a,c;if(!e)return;const t=this._viewer;if(!t)return;if(this._allowedExtensions!==void 0)for(const u of e.keys())this._allowedExtensions.includes(((o=u.split(".").pop())==null?void 0:o.toLowerCase())??"")||e.delete(u);if(e.size<1)return;const n=t.getPlugin(Qt),i={type:"drop",files:e};if(this.importerParams.autoImport){const u={allowedExtensions:this.allowedExtensions,...this.importerParams};if(i.imported=await((a=n.importer)==null?void 0:a.importFiles(e,u)),this.importerParams.autoAdd){const d=[...((c=i.imported)==null?void 0:c.values())??[]].flat(2).filter(m=>!!m)??[];if(i.assets=n.addProcessedAssets(d,{...this.importerParams}),!u._rootSceneImported)for(const m of i.assets)m.modelObject&&m.modelObject.dispatchEvent({type:"select",value:m.modelObject})}}this.dispatchEvent(i)}promptForFile(){var e;(e=this._inputEl)==null||e.click()}onRemove(e){var t;(t=this._dropzone)==null||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(t=>"."+t).join(", "):"")}}gc.PluginType="Dropzone";var Fv=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};function Ah(s){return Object.getPrototypeOf(s).constructor.PluginType}class ol extends V.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:e=!1,useRgbm:t=!0,useGBufferDepth:n=!1,screenShader:i="",...o}){super(),this.console=console,this._state=St.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(g=>this.resize()):void 0,this._lastSize=new p.FM8,this._onContextRestore=g=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=g=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this.rendersPerFrame=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===jv&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=g=>{var x;if(!g||!g.object)return;const _=g.object.__importedViewerConfig||((x=g.object.modelObject)==null?void 0:x.__importedViewerConfig);if(!_)return;const w=this.getManager();(function(T,I,R){var M;if(T[0]<7||T[0]===7&&T[1]<6){const C=new Set;((M=I.options)!=null&&M.allImported?I.options.allImported:[I.object]).forEach(L=>L.traverse(k=>{k.material&&C.add(k.material)})),C.forEach(L=>{const k=L.map;if(!k)return;const j=k.repeat,H=k.offset,X=k.center,ee=k.rotation;["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","lightMap","metalnessMap","normalMap","roughnessMap","transmissionMap"].forEach(oe=>{const re=L[oe];re&&(re.repeat.copy(j),re.offset.copy(H),re.center.copy(X),re.rotation=ee,re.needsUpdate=!0)}),L.needsUpdate=!0})}})((_.version?_.version:"0.0.0").split(".").map(T=>parseInt(T)),g),w?w.applyViewerConfig(_,_.resources):this.fromJSON(_,_.resources)},this.alert=async g=>alert(g),this.confirm=async g=>confirm(g),this.prompt=async(g,_,w=!0)=>prompt(g,_),this._useRgbm=t,this._useGBufferDepth=n,this._screenShader=i,this._canvas=o.canvas||(0,V.createCanvasElement)();let a=o.container;if(a&&!o.canvas&&a.appendChild(this._canvas),a||(a=this._canvas.parentElement??void 0),!a)throw new Error("No container.");this._container=a,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var T;const g=window.location.href,_="https://dev-sandbox.pixotronics.com/webgi/";if(!g.startsWith(_)||(0,V.getUrlQueryParam)("noUpdate")!==null)return!0;const w=(T=g.match(/\/webgi\/([0-9.a-zA-Z-]+)/))==null?void 0:T[1],x=(await(await fetch(_+"version.txt")).text()).split(`
`)[0];if(w&&w!==x){if(confirm(`New version ${x} is available, do you want to open?`)){const I=window.location.href.replace(w,x);return window.location.href=I,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const c=new Ds(void 0,void 0,this._canvas);c.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var _,w;const g=d.scene.activeCamera;if(g&&g.interactionsEnabled){const x=(_=this.getPluginByType("Progressive"))==null?void 0:_.postFrameConvergedRecordingDelta();if(x!==void 0&&x===0)return;(w=g.controls)==null||w.update()}}),this.scene=new is(c),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new th({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,colorSpace:t?ct:p.aCh,type:t?p.ywz:p.cLu,depthBuffer:!n,generateMipmaps:!!e,minFilter:e?p.FDw:p.wem}}),this._isAntialiased=e&&this._renderer.isWebGL2;let u=!0;this._renderer.rendererObject.userData||(u=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!u;const d=this;this.renderFilter={passId:"render",passObject:new Zp(this,u),update(){const g=this.passObject;g.scene=d.scene.modelObject,g.camera=d.scene.renderCamera.cameraObject}};const m={passId:"screen",after:["render"],required:["render"],passObject:bh(i)};[this.renderFilter,m].forEach(g=>this._renderer.registerPass(g)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",g=>this.setDirty(this.scene,g)),this.scene.addEventListener("sceneMaterialUpdate",g=>this.setDirty(this.scene,g)),this.scene.addEventListener("sceneUpdate",g=>{this.setDirty(this.scene,g),g.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",g=>this.setDirty(this.scene,g)),this._renderer.addEventListener("update",g=>this.setDirty(this._renderer,g)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#ffffff"),o.assetManager&&this.addPluginSync(new Qt(void 0,void 0,typeof o.assetManager=="boolean"?{}:o.assetManager)),o.dropzone&&this.addPluginSync(new gc),this.console.log("WebGi Viewer instance initialized, version: ",ol.VERSION)}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const t of[...Object.values(this.plugins)])this.removePlugin(t,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)==null||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){var i,o;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let a=0;a<this.maxFramePerLoop;a++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const d=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const m=(o=(i=this._renderer.rendererObject.xr.getCamera())==null?void 0:i.cameras[0])==null?void 0:o.viewport;m?(m.x===0&&m.y===0||this.console.warn("x and y must be 0?"),d[0]=m.width,d[1]=m.height,this.console.log("resize for xr",d)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...d),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const c=Object.values(this.plugins).filter(d=>d.dirty);c.length>0&&this.setDirty(c),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const u=this._renderer.dirty;if(u)for(let d=0;d<this.rendersPerFrame;d++){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(this._renderer.defaultRenderToScreen)}catch(m){this.console.error(m),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!u)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._canvas.parentElement!==this._container&&this.console.error("ViewerApp: Canvas is not in the container, this might cause issues with some plugins."),this._container}get canvas(){return this._canvas}get canvasTexture(){if(!this._canvas)throw new Error("Canvas not found");return this._canvasTexture||(this._canvasTexture=new p.ROQ(this._canvas),this._canvasTexture.flipY=!1,this._canvasTexture.needsUpdate=!0),this._canvasTexture}getPlugin(e){return typeof e=="string"?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...t){return this.getPlugin(e)||this.addPlugin(e,...t)}getOrAddPluginSync(e,...t){return this.getPlugin(e)||this.addPluginSync(e,...t)}async addPlugin(e,...t){let n;if(e.prototype){const o=this.getPlugin(e);if(o)return console.error(`Plugin of type ${Ah(o)} already exists, no new plugin created`,o),o;n=new e(...t)}else n=e;const i=Ah(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const o of n.dependencies||[])await this.getOrAddPlugin(o);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),await this.removePlugin(this.plugins[i],!0)),this.plugins[i]=n,await n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}addPluginSync(e,...t){let n;if(e.prototype){const o=this.getPlugin(e);if(o)return console.error(`Plugin of type ${Ah(o)} already exists, no new plugin created`,o),o;n=new e(...t)}else n=e;const i=Ah(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const o of n.dependencies||[])this.getOrAddPluginSync(o);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),this.removePluginSync(this.plugins[i],!0)),this.plugins[i]=n,n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}async addPlugins(e){for(const t of e)await this.addPlugin(t)}async addPluginsSync(e){for(const t of e)this.addPluginSync(t)}async removePlugin(e,t=!0){const n=Ah(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,t=!0){const n=Ah(e);this.plugins[n]&&(e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){const t=e.userData.iCamera??new Ds(e,{controlsMode:"",aspect:"auto"},this._canvas);return e.userData.autoLookAtTarget===void 0?(t.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):t.autoLookAtTarget=e.userData.autoLookAtTarget,t}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}async doOnce(e,t){return new Promise(n=>{const i=async(...o)=>{this.removeEventListener(e,i),n(await(t==null?void 0:t(...o)))};this.addEventListener(e,i)})}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,e==null||typeof e!="string"&&typeof e!="number"&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===jv)return this.scene.setBackground("environment");!e||e!=null&&e.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let t=this._rawBackground??this.scene.getBackground();return t?(t!=null&&t.isVector4&&(t=El(t,7).getHexString()),t!=null&&t.isColor?t.getHexString():this._rawBackground===jv?this.scene.getEnvironment():t):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(Qt)}resetCamera({rootObject:e,centerOffset:t=new p.Pa4(1,1,1),targetOffset:n=new p.Pa4(0,0,0),...i}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const o=e?new Ie().expandByObject(e,!0,!0):this.scene.getBounds(!0),a=o.getCenter(new p.Pa4),c=.5*o.getSize(new p.Pa4).length();a.add(n.clone().multiplyScalar(c)),this.scene.activeCamera.position=new p.Pa4(a.x+t.x*c,a.y+t.y*c,a.z+t.z*c),this.scene.activeCamera.target=a,this.setDirty()}}async fitToView(e,t=1.5,n,i){var a;const o=this.getPluginByType("CameraViews");o?await(o==null?void 0:o.animateToFitObject(e,t,n,i,{min:(((a=this.scene.activeCamera.getControls())==null?void 0:a.minDistance)??.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e,t=!1){var n;return(n=this.getManager())==null?void 0:n.addImportedSingle(e||new p.Tme,{autoScale:!1,pseudoCenter:!1,addToRoot:t})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var n,i,o,a;if(t!=null&&t.isMaterial){const c=(i=(n=this.getManager())==null?void 0:n.materials)==null?void 0:i.findMaterial(t.uuid);if(c)return c}return(a=(o=this.getManager())==null?void 0:o.materials)==null?void 0:a.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(n=>{var i,o;if(!t||t.includes(n[1].constructor.PluginType))return n[1].serializeWithViewer!==!1?(o=(i=n[1]).toJSON)==null?void 0:o.call(i,e):void 0}).filter(n=>!!n)}deserializePlugins(e,t){return e.forEach(n=>{var o;if(!n.type)return void this.console.warn("Invalid plugin to import ",n);const i=this.getPluginByType(n.type);i&&((o=i.fromJSON)==null||o.call(i,n,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){const n=Object.assign({version:ol.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,t)},xi(this,!0,e));return n.backgroundIntensity=this.scene.backgroundIntensity,n.useLegacyLights=this.renderer.useLegacyLights,n.background=n.scene.background||n.scene.backgroundColor,n.background==="environment"&&(n.background="envMapBackground"),n}fromJSON(e,t){var i,o,a,c,u;const n={...e};return n.backgroundIntensity!==void 0&&((i=n.scene)==null?void 0:i.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=n.backgroundIntensity,delete n.backgroundIntensity),n.useLegacyLights!==void 0&&((o=n.renderManager)==null?void 0:o.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=n.useLegacyLights,delete n.useLegacyLights),n.background!==void 0&&((a=n.scene)==null?void 0:a.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),n.background==="envMapBackground"?n.background="environment":typeof n.background=="number"?n.background=new p.Ilk().setHex(n.background,p.GUF):typeof n.background=="string"?n.background=new p.Ilk().setStyle(n.background,p.GUF):(c=n.background)!=null&&c.isColor&&(n.background=new p.Ilk(n.background)),(u=n.background)!=null&&u.isColor?(this.scene.backgroundColor=n.background,this.scene.background=null):n.background?(this.scene.backgroundColor=new p.Ilk("#ffffff"),n.scene.background=n.background):(this.scene.backgroundColor=null,this.scene.background=null),delete n.background),Di(n,this,!0,t),Array.isArray(n.plugins)&&this.deserializePlugins(n.plugins,t),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,t){if(e)return await this.assetManager.addAssetSingle(e,t)}async setEnvironmentMap(e,{setBackground:t=!1,...n}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:t=!1,...n}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}ol.VERSION="0.9.5",Fv([Ae("renderManager")],ol.prototype,"_renderer",void 0),Fv([Ae()],ol.prototype,"scene",void 0),Fv([(0,V.onChange)(ol.prototype._renderEnabledChanged)],ol.prototype,"renderEnabled",void 0);const jv="envMapBackground";function bh(s){return s!=null&&s.isShaderPass2?s:new Fr({...qe,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(s)?s[0]:(s==null?void 0:s.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(s)?s[1]:typeof s=="string"?s:(s==null?void 0:s.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class Wd extends Fr{constructor(e){super({vertexShader:qe.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=p.Wl3}render(e,t,n,i,o){super.render(e,t,n,i,o),this._lastReadBuffer=n,this.needsSwap=!0}reRender(e,t,n,i){this._lastReadBuffer&&this.render(e,t,this._lastReadBuffer,n,i)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class Fa extends ea{get renderToScreen(){return this._renderToScreen}constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[Ii],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var n,i;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(i=(n=this.pass).update)==null||i.call(n),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}async onAdded(e){var t,n;return(n=(t=this._viewer)==null?void 0:t.screenShader)!=null&&n.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,V.safeSetProperty)(e.renderer.passes.find(i=>i.passId==="screen"),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,V.safeSetProperty)(e.renderer.passes.find(t=>t.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var o,a;const t=e.screenShader,n=["",""];this._renderToScreen&&!t.isShaderPass2&&(n[0]=Array.isArray(t)?t[0]:(t==null?void 0:t.pars)||"",n[1]=Array.isArray(t)?t[1]:typeof t=="string"?t:(t==null?void 0:t.main)||"");const i=new Wd(n);return(0,V.safeSetProperty)((a=(o=i.uiConfig)==null?void 0:o.children)==null?void 0:a.find(c=>(c==null?void 0:c.label)==="Enabled"),"hidden",!0,!0),i}_update(e){var t,n,i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((t=this._viewer)==null?void 0:t.getPlugin(Ii)),this._pass.passObject.material.uniforms.tTransparent.value=((i=(n=this._viewer)==null?void 0:n.renderFilter.passObject.transparentTarget)==null?void 0:i.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t;return((t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig)??{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}Fa.PluginType="CombinedPostPlugin";var km=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Hc extends En{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Fa]}get uiConfig(){var e;return(e=this._extension)==null?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),(t=e.getPlugin(Fa))==null||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function zv(s,e,t){return s&~(1<<e)|(t?1:0)<<e}function qd(s,e){return s&~(1<<e)}km([Ae("extension")],Hc.prototype,"_extension",void 0),km([Ae()],Hc.prototype,"enabled",void 0);var hi,mn=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const ga=p.dZ3;let ja=hi=class{constructor(s,e=!0){this.depthTonemap=e,this.toneMapping=p.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(t,n)=>this.enabled?V.glsl`
            ${this.depthTonemap?vo:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${`int getToneMapBit(in int number){
#ifdef WebGL2Context
return(number/2)%2;
#else
return int(mod(floor(float(number)/2.),2.));
#endif
}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=s.getPlugin(Fa),this._setDirty=this._setDirty.bind(this),this.depthTonemap=e}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(s,e,t){if(!this.enabled)return;const{toneMapping:n,toneMappingExposure:i,outputColorSpace:o}=t;this._rendererState.toneMapping=n,this._rendererState.toneMappingExposure=i,this._rendererState.outputColorSpace=o;let a=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==a&&(e.materialObject.defines.TONEMAP_BACKGROUND=a,e.materialObject.needsUpdate=!0),a=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==a&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=a,e.materialObject.needsUpdate=!0),a=this.renderDepth?"1":"0",e.materialObject.defines.DEBUG_DEPTH!==a&&(e.materialObject.defines.DEBUG_DEPTH=a,e.materialObject.needsUpdate=!0),t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,t.outputColorSpace=p.KI_,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(s,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure,t.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var s;(s=this.__setDirty)==null||s.call(this),this._setDirty()}};ja.PluginType="Tonemap",mn([Uo("Mode",[["Linear",p.EoG],["Reinhard",p.CdI],["Cineon",p.YGz],["ACESFilmic",p.LY2],["Uncharted2",ga]].map(s=>({label:s[0],value:s[1]})),{limitedUi:!0}),(0,V.onChange)(hi.prototype._setDirty),Ae()],ja.prototype,"toneMapping",void 0),mn([(0,V.onChange)(hi.prototype._setDirty),Gt("Tonemap Background",{limitedUi:!0}),Ae()],ja.prototype,"tonemapBackground",void 0),mn([(0,V.onChange)(hi.prototype._setDirty),Gt("Clip Background"),Ae()],ja.prototype,"clipBackground",void 0),mn([(0,V.onChange)(hi.prototype._setDirty),cn("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Ae()],ja.prototype,"exposure",void 0),mn([(0,V.onChange)(hi.prototype._setDirty),cn("Saturation",[0,2],.01,{limitedUi:!0}),Ae()],ja.prototype,"saturation",void 0),mn([(0,V.onChange)(hi.prototype._setDirty),cn("Contrast",[0,2],.01,{limitedUi:!0}),Ae()],ja.prototype,"contrast",void 0),mn([(0,V.onChange)(hi.prototype._setDirty),Gt("Render Depth")],ja.prototype,"renderDepth",void 0),ja=hi=mn([Hn("Tonemapping")],ja);class Um extends Hc{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){var t;await super.onAdded(e),(t=e.getPlugin(Ii))==null||t.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new ja(e,this.depthTonemap)}get exposure(){var e;return((e=this._extension)==null?void 0:e.exposure)??1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e;return((e=this._extension)==null?void 0:e.saturation)??1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e;return((e=this._extension)==null?void 0:e.contrast)??1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e;return((e=this._extension)==null?void 0:e.toneMapping)??p.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){var n,i;if(e instanceof p.Kj0&&((n=e.material)!=null&&n.userData)){const o=((i=e.material)==null?void 0:i.userData.postTonemap)===!1?0:1;t.w=zv(t.w,1,o)}}}Um.PluginType="Tonemap",p.WdD.tonemapping_pars_fragment=p.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Vv,L0=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let gf=Vv=class{constructor(s){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?V.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=s.getPlugin(Fa),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(this.extraUniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var s;(s=this.__setDirty)==null||s.call(this),this._setDirty()}};gf.PluginType="ChromaticAberration",L0([(0,V.onChange)(Vv.prototype._setDirty),Gt("Enable"),Ae()],gf.prototype,"enabled",void 0),L0([(0,V.onChange)(Vv.prototype._setDirty),cn("Intensity",[0,.1],.001,{limitedUi:!0}),Ae()],gf.prototype,"aberrationIntensity",void 0),gf=Vv=L0([Hn("ChromaticAberration")],gf);class Nm extends Hc{constructor(){super()}generateExtension(e){return new gf(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.aberrationIntensity)??1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Nm.PluginType="ChromaticAberration";class Fm extends En{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(n=>(n.passId||(console.warn("no id found for pass",n),n.passId=ns()),e.renderer.registerPass(n,!0),[n.passId,n])))}async onRemove(e){var t;if(this._passes){for(const n of[...Object.values(this._passes)]){const i=n;e.renderer.unregisterPass(i),(t=i==null?void 0:i.dispose)==null||t.call(i)}this._passes=void 0}await super.onRemove(e)}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=Object.entries(this.passes);t.passes={};for(const[i,o]of n)t.passes[i]=xi((o==null?void 0:o.passObject)??o,!1,e);return t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.passes){const n=Object.entries(this.passes);for(const[i,o]of n)Di(e.passes[i],(o==null?void 0:o.passObject)??o,!1,t)}return this}}var jm=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class zm extends Fr{constructor(e,t,n="rgba"){super({vertexShader:qe.vertexShader,fragmentShader:t+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new p.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new p.FM8}},defines:{B_SRC_ACCESSOR:n}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,i,o){var a,c,u,d;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((a=this.uniforms.tDiffuse.value)==null?void 0:a.image.width)||0,((c=this.uniforms.tDiffuse.value)==null?void 0:c.image.height)||0),super.render(e,t,this._target,i,o),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(((u=this.uniforms.tDiffuse.value)==null?void 0:u.image.width)||0,((d=this.uniforms.tDiffuse.value)==null?void 0:d.image.height)||0),super.render(e,this._target,t,i,o))}}jm([Ae(),Fe()],zm.prototype,"smoothEnabled",void 0),jm([Ae(),Fe()],zm.prototype,"edgeSharpness",void 0);var Vo="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",al=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,vf=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,Gv=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class xu extends Fr{constructor(e,t,n){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new p.FM8(512,512)},saoData:{value:new p.Ltg},frameCount:{value:0},cameraNearFar:{value:new p.FM8(.1,1e3)},projection:{value:new p.yGw},saoBiasEpsilon:{value:new p.Pa4(1,1,1)}},vertexShader:Vo,fragmentShader:`

${al}

${n}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;bool disableAO=getSelectionBit(getGBufferFlags(vUv).a)>0?true:false;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1.3},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(i,o,a)=>{i.defines.SSAO_ENABLED&&(i.fragmentShader=i.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`))},onObjectRender:(i,o,a)=>{var m,g;this.materialExtension.extraUniforms.tSSAOMap.value=(m=this._target)==null?void 0:m.texture;const c=o.materialObject,u=!c.transparent&&c.transmission<.001;let d=this.enabled&&u&&a.userData.screenSpaceRendering!==!1&&!((g=o.userData)!=null&&g.ssaoDisabled)?1:0;c.defines.SSAO_ENABLED!==d&&(c.defines.SSAO_ENABLED=d,c.needsUpdate=!0),d=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==d&&(this.materialExtension.extraUniforms.tSSAOMap.value=d,c.needsUpdate=!0)},parsFragmentSnippet:i=>{var o;return V.glsl`
             uniform sampler2D tSSAOMap;
             ${$e("tSSAOMap",(o=this._target)==null?void 0:o.texture,i.capabilities.isWebGL2)}
            ${vf}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:i=>{var o,a;return this.enabled?"1":"0"+((a=(o=this._target)==null?void 0:o.texture)==null?void 0:a.colorSpace)},isCompatible:i=>{var o;return!((o=i.materialObject.userData)!=null&&o.ssaoDisabled)&&i.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new zm(this._target,n,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,i,o){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,o),this._smoothEnabled&&this.bilateralPass.render(e,t,n,i,o))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}Gv([Ae()],xu.prototype,"bilateralPass",void 0),Gv([Ae()],xu.prototype,"parameters",void 0);class Qc extends Fm{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[Qt,Ii],this.setDirty=this.setDirty.bind(this)}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var t;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[sc(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new xu(e.renderer,this._aoTarget,((t=e.getPlugin(Ii))==null?void 0:t.getUnpackSnippet())??""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Ii)])}},()=>[e.getPlugin(Ii),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get enabled(){var e,t;return((t=(e=this.passes.ssao)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssao)!=null&&t.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var n;if(this._uiConfig)return this._uiConfig;const e=this,t=e.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[t,"enabled"],onChange:e.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[t.parameters,"intensity"],onChange:e.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[t.parameters,"occlusionWorldRadius"],onChange:e.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[t.parameters,"bias"],onChange:e.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[t.parameters,"falloff"],onChange:e.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(n=t.material)==null?void 0:n.defines,"NUM_SAMPLES"],onChange:[()=>t.material.needsUpdate=!0,e.setDirty]},{type:"checkbox",property:[t.bilateralPass,"smoothEnabled"],onChange:e.setDirty},{type:"vec4",property:[t.bilateralPass,"edgeSharpness"],onChange:e.setDirty}]}}}Qc.PluginType="SSAO";var wh,vc=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Bl=wh=class extends Fr{constructor(){super({vertexShader:qe.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new p.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:vo+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new p.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.2,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(s,e,t,n,i){const o=s.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const a=t;let c=.5,u=a.width*c,d=a.height*c;const m=[];let g=o.getTempTarget({sizeMultiplier:1,type:p.cLu});m.push(g);let _=a;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(s,g,_,n,i),_=g;let w=1;for(;w<this.bloomIterations&&(u/=2,d/=2,c/=2,!(d<2||u<2));w++){g=o.getTempTarget({sizeMultiplier:c,type:p.cLu}),m.push(g),this.material.defines.PASS_STEP=1;let T=this._weights[w];T=this._weights[w-1]!==0?this._weights[w]/this._weights[w-1]:this._weights[w],this.material.uniforms.weight.value=T,this.material.needsUpdate=!0,super.render(s,g,_,n,i),_=g}this.clear=!1;const x=s.autoClear;for(s.autoClear=!1,w-=2;w>=0;w--)g=m[w],m[w]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=p.WMw,this.material.needsUpdate=!0,s.autoClear=!1,super.render(s,g,_,n,i),this.material.blending=p.jFi,o.releaseTempTarget(_),_=g;this.clear=!0,s.autoClear=x,s.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(s,e,_,n,i)):(this.uniforms.tSource.value=a.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(s,e,_,n,i),this.uniforms.tSource.value=null),o.releaseTempTarget(_)}_updateWeights(){if(!this._weights)return;const s=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let t=0;t<this.bloomIterations;t++){let n=t*e+.1,i=1.2-n;n=Math.pow(n,this.power),i=Math.pow(i,this.power),this._weights[t]=i*(1-s)+n*s}this.setDirty()}};function Vm(s){const e=s==null?void 0:s.userData;return!!e&&(e[za.PluginType]||(e[za.PluginType]={}),e[za.PluginType].enable=!0,s.isMaterial&&(s.needsUpdate=!0),!0)}vc([Fe()],Bl.prototype,"prefilter",void 0),vc([cn("Threshold",[0,2]),(0,V.onChange)(wh.prototype._thresholdsUpdated),Ae()],Bl.prototype,"threshold",void 0),vc([cn("Soft Threshold",[0,1]),(0,V.onChange)(wh.prototype._thresholdsUpdated),Ae()],Bl.prototype,"softThreshold",void 0),vc([cn("Intensity",[0,3]),Ae(),Fe()],Bl.prototype,"intensity",void 0),vc([cn("Iterations",[0,7],1),(0,V.onChange)(wh.prototype._updateWeights),Ae()],Bl.prototype,"bloomIterations",void 0),vc([cn("Radius",[0,1],.01),(0,V.onChange)(wh.prototype._updateWeights),Ae()],Bl.prototype,"radius",void 0),vc([cn("Power",[.2,10],.01),(0,V.onChange)(wh.prototype._updateWeights),Ae()],Bl.prototype,"power",void 0),vc([Gt("Debug")],Bl.prototype,"bloomDebug",void 0),Bl=wh=vc([Hn("Bloom")],Bl);class za extends ea{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:ns(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const t={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=e.materialObject.userData[za.PluginType])==null?void 0:n.enable)??!0},set value(n){var o;const i=e.materialObject.userData[za.PluginType];n!==(i==null?void 0:i.enable)&&(i||Vm(e.materialObject),e.materialObject.userData[za.PluginType].enable=n,(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty}]};return t}passCtor(e){const t=new Bl;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),t}async onAdded(e){var n,i;await super.onAdded(e),(n=e.getPlugin(Ii))==null||n.registerGBufferUpdater(this.updateGBuffer);const t=e.getPlugin(Qt);(i=t==null?void 0:t.materials)==null||i.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,t){var n,i;if(e instanceof p.Kj0&&((n=e.material)!=null&&n.userData)){const o=(i=e.material)==null?void 0:i.userData[za.PluginType],a=(o==null?void 0:o.enable)===!1?0:1;t.w=zv(t.w,2,a)}}_update(e){var t,n;return(n=e.getPlugin(Ii))==null||n.updateShaderProperties((t=this.pass)==null?void 0:t.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}za.PluginType="Bloom";var k0="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",_f=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const _b={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new p.FM8},cameraNearFar:{value:new p.FM8}},vertexShader:Vo,fragmentShader:vo+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},H1=(rc({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new p.FM8},direction:{value:new p.FM8}},vertexShader:Vo,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),rc({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new p.FM8},direction:{value:new p.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:Vo,fragmentShader:al+`
`+k0+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(min(vec3(72.),max(vec3(0.),colorSum)),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class xh extends Fr{constructor(){super(_b,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=H1,this.nearFarBlurScale=new p.FM8(.25,.25),this.focalDepthRange=new p.FM8(.5,1.5),this.crossCenter=new p.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new p.Ilk(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=rc({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:Vo,fragmentShader:vo+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=rc({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new p.FM8},direction:{value:new p.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:Vo,fragmentShader:vo+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,t,n,i,o){if(!this.enabled)return;const a=e.baseRenderer,c={minFilter:p.TyD,magFilter:p.TyD,type:p.cLu,colorSpace:p.GUF,sizeMultiplier:.5,format:p.wk1,depthBuffer:!1,generateMipmaps:!1},u=a.getTempTarget(c),d=a.getTempTarget(c);if(this.computeCocMaterial.uniforms.colorTexture.value=n.texture,a.blit(void 0,u,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=u.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),a.blit(void 0,d,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=d.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),a.blit(void 0,u,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=u.texture,a.blit(void 0,d,{material:this.dofBlurMaterial});else{const m=a.getTempTarget(c);this.dofBlurMaterial.uniforms.cocTexture.value=u.texture,this.dofBlurMaterial.uniforms.colorTexture.value=u.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),a.blit(void 0,m,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=m.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),a.blit(void 0,d,{material:this.dofBlurMaterial}),a.releaseTempTarget(m)}this.material.uniforms.blurTexture.value=d.texture,this.material.uniforms.cocTexture.value=u.texture,super.render(e,t,n,i,o),a.releaseTempTarget(u),a.releaseTempTarget(d)}}_f([Ae(),Fe()],xh.prototype,"nearFarBlurScale",void 0),_f([Ae(),Fe()],xh.prototype,"focalDepthRange",void 0),_f([Fe()],xh.prototype,"crossCenter",void 0),_f([Fe()],xh.prototype,"crossRadius",void 0),_f([Fe()],xh.prototype,"crossAlpha",void 0),_f([Fe()],xh.prototype,"crossColor",void 0);class U0 extends Fr{constructor(e){super({vertexShader:qe.vertexShader,fragmentShader:V.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new p.Ltg(1,1,1,1)},weight2:{value:new p.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var yb=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const N0=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class oo extends Fm{constructor(e=2*N0.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=t=>{const n=t.object;(n.modelObject||n.lightObject)&&(n.modelObject||n.lightObject).traverse(i=>{var o;(o=i==null?void 0:i.shadow)!=null&&o.camera&&i.shadow.mapSize&&this.trackedJitterCameras.add([i.shadow.camera,i.shadow.mapSize])})},this._jitterCamera=t=>{var i;const n=t.target;if(this.jitter&&n.renderer.frameCount>1){const o=(c,u)=>{const d={...N0[n.renderer.frameCount%N0.length]};c.setViewOffset(u.width,u.height,d.x,d.y,u.width,u.height)},a=n.scene.activeCamera.cameraObject;o(a,{width:n.canvas.clientWidth*n.renderer.displayCanvasScaling,height:n.canvas.clientHeight*n.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(c=>o(...c)),this._hasSetOffset=!0,(i=this._viewer)==null||i.renderer.resetShadows()}},this._resetCameraJitter=t=>{const n=t.target;this._hasSetOffset&&(n.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=Ba("Progressive",this),this.maxFrameCount=e}async onAdded(e){return await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach(t=>e.renderer.disposeTarget(t)),this._lastFrames.clear(),await super.onRemove(e)}get lastFrame(){var e;return this._lastFrames.get((e=this._viewer)==null?void 0:e.scene.renderCamera.cameraObject.uuid)}getLastFrame(e){return e?this._lastFrames.get(e.cameraObject.uuid):this.lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[sc(e,{passId:"progressive",get dirty(){var n;return t.jitter&&(((n=t._viewer)==null?void 0:n.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends U0{render(n,i,o,a,c){if(t.lastFrame){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((o==null?void 0:o.texture)&&e.renderer.blit(o.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(n,i,o,a,c),e.renderer.blit(i.texture,t.lastFrame,{})}else e.console.error("lastFrame render target undefined")}},update(){if(!t.lastFrame&&e.scene.renderCamera&&t._lastFrames.set(e.scene.renderCamera.cameraObject.uuid,e.renderer.composerTarget.clone(!0)),!t.lastFrame)return void console.error("lastFrame render target undefined");let n=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(n,n,n,n),n=1-n,this.passObject.weights2.set(n,n,n,n),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return(((t=this._viewer)==null?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=((t=this.lastFrame)==null?void 0:t.texture)??void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}oo.PluginType="Progressive",yb([Ae(),jn("Frame count")],oo.prototype,"maxFrameCount",void 0),yb([Ae(),Gt("Jitter")],oo.prototype,"jitter",void 0);class _c extends ea{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:p.wem,magFilter:p.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState<500&&(this._toSaveFrame=!0),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this.setDirty(),await(0,V.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[oo],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var a;const t=(a=this._viewer)==null?void 0:a.canvas;if(!t)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==t)return void(this.pointerEnabled=!0);const n=t.getBoundingClientRect(),i=(e.clientX-n.left)/n.width,o=(e.clientY-n.top)/n.height;this.pointerEnabled=i<0||i>1||o<0||o>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,n=e.getPlugin(oo),i=new class extends U0{constructor(){super(...arguments),this._lastTime=0,this._saveNextFrame=!1,this.uiConfig=Ba("Frame Fade",this)}render(o,a,c,u,d){this.needsSwap=!1;const m=t._target;if(!m||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001||e.scene.renderCamera!==e.scene.activeCamera)return;t._toSaveFrame&&(this._saveNextFrame=!0,t._toSaveFrame=!1),this._saveNextFrame&&n.lastFrame&&(e.renderer.blit(n.lastFrame.texture,m),this._lastTime=0,this._saveNextFrame=!1),this.blendTexture=m==null?void 0:m.texture;const g=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(g),this.weights2.w=1,this.weights1.setScalar(1-g),this.weights1.w=1,super.render(o,a,c,u,d),this.needsSwap=!0;const _=(0,V.now)();this._lastTime<10&&(this._lastTime=_-10);const w=_-this._lastTime;this._lastTime=_,t._fadeTimeState-=w}};return i.enabled=!0,i}setDirty(){var e;this.enabled&&((e=this._viewer)==null||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<1&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return(t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}_c.PluginType="FrameFade";var Hv=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Eu extends ea{passCtor(e){return new xh}constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[Ii],this.enableEdit=!1,this._focalPointHit=new p.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new p.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,t=!0,n=!1){var i,o;this._focalPointHit.copy(e),t&&((o=(i=this._viewer)==null?void 0:i.getPlugin(_c))==null||o.startTransition(this._frameFadeTime)),n&&(this._focalPointHitTime=(0,V.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e;return((e=this.pass)==null?void 0:e.passObject.focalDepthRange.y)??0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.x)??0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.y)??0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,n;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(n=(t=this._viewer)==null?void 0:t.getPlugin(_c))==null||n.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),(t=e.getPluginByType("Picking"))==null||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return(t=e.getPluginByType("Picking"))==null||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_update(e){var a,c;if(!super._update(e))return!1;const t=(a=this.pass)==null?void 0:a.passObject;if(!t)return!1;const n=e.getPlugin(Ii);n==null||n.updateShaderProperties(t.material),t.dofBlurMaterial.uniforms.frameCount&&((c=e.renderer)==null||c.updateShaderProperties(t.dofBlurMaterial));const i=e.scene.renderCamera;if(!i)return!1;i.cameraObject.updateMatrixWorld(!0),i.updateShaderProperties(t.material),i.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),t.focalDepthRange.x=this._tempVec.length(),t.focalDepthRange.x*=i.cameraObject.getWorldDirection(new p.Pa4).dot(this._tempVec.normalize());let o=((0,V.now)()-this._focalPointHitTime)/this.crossFadeTime;if(o=1-Math.min(1,Math.max(0,o)),Math.abs(o-t.crossAlpha)>.01&&(t.crossAlpha=o,this.setDirty()),o>0){const u=this._tempVec.copy(this._focalPointHit).project(i.cameraObject).addScalar(1).divideScalar(2);t.crossCenter.set(u.x,u.y),t.computeCocMaterial.uniformsNeedUpdate=!0,t.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var t,n,i,o,a;if(this._uiConfig)return this._uiConfig;const e=(n=(t=this._pass)==null?void 0:t.passObject)==null?void 0:n.uiConfig;return e?((o=(i=e.children)==null?void 0:i.map(c=>(0,V.getOrCall)(c)))==null||o.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),(a=e.children)==null||a.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=e,e):{}}}Eu.PluginType="DepthOfField",Hv([Ae()],Eu.prototype,"enableEdit",void 0),Hv([Ae("focalPoint")],Eu.prototype,"_focalPointHit",void 0),Hv([Ae()],Eu.prototype,"crossFadeTime",void 0);var F0=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Va=class extends En{addThinFilmLayer(s){return Qv(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new Ab(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Qt],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new p.Ltg},thinNoiseLayerFactors:{value:new p.Ltg},thinColorNoiseParams:{value:new p.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._thinFilmLayer)!=null&&t.hasThinFilm)?al+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(s,e,t)=>{var i;if(!this.enabled||!((i=e.materialObject.userData._thinFilmLayer)!=null&&i.hasThinFilm))return;const n="#glMarker beforeAccumulation";s.fragmentShader=s.fragmentShader.replace(n,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+n),s.defines.USE_UV=""},onObjectRender:(s,e)=>{var i;const t=(i=e.materialObject.userData)==null?void 0:i._thinFilmLayer;if(!(t!=null&&t.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(t.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(t.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(t.colorNoiseParams),this._uniforms.thinFilmFactor.value=t.filmFactor;const n=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==n&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+((t=(e=s.materialObject.userData)==null?void 0:e._thinFilmLayer)!=null&&t.hasThinFilm?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2||s.isDiamondMaterial,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._thinFilmLayer)==null?void 0:n.hasThinFilm)||!1},set value(n){var i,o;n!==((i=s.materialObject.userData._thinFilmLayer)==null?void 0:i.hasThinFilm)&&(n?Qv(s.materialObject)||e.alert("Cannot add thin film."):s.materialObject.userData._thinFilmLayer&&(s.materialObject.userData._thinFilmLayer.hasThinFilm=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var n;return!((n=s.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var n;return!((n=s.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var n;return!((n=s.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=s.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s;(s=this._viewer)==null||s.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(s){var t,n,i,o,a;await super.onAdded(s);const e=s.getPlugin(Qt);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(bb)}async onRemove(s){var e,t,n,i;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=s.getPlugin(Qt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function Qv(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const t=e._thinFilmLayer;return t.hasThinFilm=!0,t.baseLayerFactors===void 0&&(t.baseLayerFactors=[.3,.6,1,.9]),t.noiseLayerFactors===void 0&&(t.noiseLayerFactors=[.7,.5,.9,.7]),t.colorNoiseParams===void 0&&(t.colorNoiseParams=[.5,.5,.5,.7]),t.filmFactor===void 0&&(t.filmFactor=.3),s.isMaterial&&(s.needsUpdate=!0),!0}Va.PluginType="ThinFilmLayerPlugin",Va.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",F0([Gt("Enabled",s=>({onChange:s.setDirty})),Ae()],Va.prototype,"enabled",void 0),Va=F0([Hn("ThinFilmLayer Materials")],Va);class Ab{constructor(e){this.parser=e,this.name=Va.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Qv(t),t.userData._thinFilmLayer=Di(i,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const bb=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;t.extensions=t.extensions||{};const n=xi(e.userData._thinFilmLayer,!1);t.extensions[Va.THIN_FILM_LAYER_GLTF_EXTENSION]=n,s.extensionsUsed[Va.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class yf{async apply(e,t,n){var o,a,c,u;if(!t)return void(this.selected=void 0);let i=this.presets.find(d=>function(m,g){return(typeof m=="string"?m:m.path)===(typeof g=="string"?g:g.path)}(d,t));return i||(this.presets.push(t),i=t),this.selected=i,typeof i!="string"?(a=(o=e.getManager())==null?void 0:o.importer)==null?void 0:a.importAsset(i,n):(u=(c=e.getManager())==null?void 0:c.importer)==null?void 0:u.importPath(i,n)}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class j0 extends yf{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return i&&(i.colorSpace=p.KI_,e.scene.background=i),i}}class Xd extends yf{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return i&&(e.scene.environment=i),i}}class ls extends yf{constructor(e="envMap"){super(),this.key=e,this.name="GemEnvironment",this.name+=e.split("Map")[1]}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return(0,V.safeSetProperty)(e.getPluginByType("Diamond"),this.key,i),i}}class Yr extends yf{async apply(e,t){var i,o;const n=await super.apply(e,t,{processImported:!1});return n?(o=(i=e.getManager())==null?void 0:i.importer)==null?void 0:o.processImported(n):void 0}}class Gm extends Yr{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class Yd extends En{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(t=>{var n;return{label:((n=Af(t))==null?void 0:n.split("/").pop())||"",value:Af(t)}})],getValue:()=>Af(e.selected)||"",setValue:t=>{e.apply(this._viewer,e.presets.find(n=>Af(n)===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,V.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,V.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,n;await super.onAdded(e),this.presetGroups.push(new j0),this.presetGroups.push(new Xd),this.presetGroups.push(new ls),this.presetGroups.push(new ls("envMap2")),this.presetGroups.push(new ls("envMap3")),this.presetGroups.push(new Yr("Ground")),this.presetGroups.push(new Yr("CameraViews")),this.presetGroups.push(new Yr("MaterialConfiguration")),this.presetGroups.push(new Gm),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(t=>[t.name,Af(t.selected)||void 0]).filter(([,t])=>t));return e.type=Yd.PluginType,e}async fromJSON(e,t){var o,a;if(!super.fromJSON(e,t))return null;const n={...e};delete n.type;const i=[];for(const[c,u]of Object.entries(n)){const d=this.presetGroups.find(_=>_.name===c),m=d==null?void 0:d.presets;if(!d||!m)continue;const g=typeof u=="string"?{path:u}:u;i.push(d.apply(this._viewer,g))}return await Promise.all(i),(a=(o=this.uiConfig).uiRefresh)==null||a.call(o,"postFrame",!0),this}async loadPresetGroups(e){var t;typeof e=="string"&&e.startsWith("http")&&(e=await fetch(e).then(async n=>n.json()));for(const[n,i]of Object.entries(e)){const o=(t=this.presetGroups.find(a=>a.name===n))==null?void 0:t.presets;o==null||o.push(...i)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(Af)]).filter(([,e])=>e.length>0))}}function Af(s){return s&&typeof s!="string"?s.path:s}Yd.PluginType="PresetLibraryPlugin";var Hm,Wv=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let bf=Hm=class{constructor(s){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?V.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=s.getPlugin(Fa),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(this.extraUniforms.grainIntensity.value=this.grainIntensity,this.extraUniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var s;(s=this.__setDirty)==null||s.call(this),this._setDirty()}};Wv([(0,V.onChange)(Hm.prototype._setDirty),Gt("Enable"),Ae()],bf.prototype,"enabled",void 0),Wv([(0,V.onChange)(Hm.prototype._setDirty),Gt("Multiply"),Ae()],bf.prototype,"grainMultiply",void 0),Wv([(0,V.onChange)(Hm.prototype._setDirty),cn("Intensity",[0,20],.01,{limitedUi:!0}),Ae()],bf.prototype,"grainIntensity",void 0),bf=Hm=Wv([Hn("FilmicGrain")],bf);class Qm extends Hc{constructor(){super()}generateExtension(e){return new bf(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.grainIntensity)??1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e;return((e=this._extension)==null?void 0:e.grainMultiply)??!1}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}Qm.PluginType="FilmicGrain";class wb extends V.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var t;(t=this._scene)==null||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,t,n,i){super(),this.hoverEnabled=!1,this._scene=e,this._camera=n??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=i??(o=>o.userData.userSelectable!==!1&&o.userData.bboxVisible!==!1&&o.material!=null&&o.material.type!=="ShadowMaterial"),this.raycaster=new p.iMs,this.mouse=new p.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",o=>this.onPointerMove(o)),this.domElement.addEventListener("pointerleave",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointerout",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointercancel",o=>this.onPointerCancel(o)),this.domElement.addEventListener("pointerenter",o=>this.onPointerEnter(o)),this.domElement.addEventListener("pointerdown",o=>this.onPointerDown(o)),this.domElement.addEventListener("pointerup",o=>this.onPointerUp(o))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,V.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var t;e.isPrimary!==!1&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=((t=this.checkIntersection())==null?void 0:t.intersects[0].object)??null))}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onDoubleClick(e){console.log("double click")}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(t==null?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var u;const e=(u=this._camera)==null?void 0:u.cameraObject;if(!e)return null;this.raycaster.setFromCamera(this.mouse,e);let t=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const n=[];t=t.filter(d=>!n.includes(d.object.id)&&(n.push(d.object.id),!0));let o,a=null;const c=[];for(const d of t){for(a=d.object,o=d;!(a==null||a.visible&&this.selectionCondition(a));)a=a.parent;a!=null&&c.push(d)}if(t=c,t.length>0){if(a=t[0].object,o=t[0],this._firstHit&&a.id!==this._firstHit.id)a=o.object;else for(let d=0;d<t.length;d++)if(this.selectedObject&&this.selectedObject.id===t[d].object.id){const m=d+1;if(!(m<t.length))return null;o=t[m],a=o.object}this._firstHit=t[0].object}return a&&o&&a?{selectedObject:a,intersect:o,intersects:t,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const xb=new p.ZzF,qv=new p.Pa4;class Kd extends p.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new p.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new p.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new p.$TI(t,6,1);return this.setAttribute("instanceStart",new p.kB5(n,3,0)),this.setAttribute("instanceEnd",new p.kB5(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new p.$TI(t,6,1);return this.setAttribute("instanceColorStart",new p.kB5(n,3,0)),this.setAttribute("instanceColorEnd",new p.kB5(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new p.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new p.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),xb.setFromBufferAttribute(t),this.boundingBox.union(xb))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new p.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let o=0,a=e.count;o<a;o++)qv.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(qv)),qv.fromBufferAttribute(t,o),i=Math.max(i,n.distanceToSquared(qv));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class z0 extends Kd{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new p.Uk6(e))}}p.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new p.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},p.Vj0.line={uniforms:p.rDY.merge([p.rBU.common,p.rBU.fog,p.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Su extends p.jyz{constructor(e){super({type:"LineMaterial",uniforms:p.rDY.clone(p.Vj0.line.uniforms),vertexShader:p.Vj0.line.vertexShader,fragmentShader:p.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const Eb=new p.Pa4,Sb=new p.Pa4;class V0 extends p.Kj0{constructor(e=new Kd,t=new Su({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let a=0,c=0,u=t.count;a<u;a++,c+=2)Eb.fromBufferAttribute(t,a),Sb.fromBufferAttribute(n,a),i[c]=c===0?0:i[c-1],i[c+1]=i[c]+Eb.distanceTo(Sb);const o=new p.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new p.kB5(o,1,0)),e.setAttribute("instanceDistanceEnd",new p.kB5(o,1,1)),this}}class G0 extends p.ZAu{_updater(){const e=this._object;if(e){const t=new Ie().expandByObject(e,!1);t.getCenter(this.position);const n=t.getBoundingSphere(new p.aLr).radius;this.scale.setScalar(n*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const t=new z0(e);this._geometry=t;const n=new Su({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new p.FM8(1024,1024),dashed:!1,toneMapped:!1}),i=new V0(t,n);i.computeLineDistances(),i.scale.set(1,1,1),i.visible=!0,this.add(i)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)==null||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)==null||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class H0 extends G0{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new p.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Ie().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const Jd=new p.iMs,Ga=new p.Pa4,Eh=new p.Pa4,zr=new p._fP,Cb={X:new p.Pa4(1,0,0),Y:new p.Pa4(0,1,0),Z:new p.Pa4(0,0,1)},Q0={type:"change"},Mb={type:"mouseDown"},Tb={type:"mouseUp",mode:null},Ib={type:"objectChange"};class Q1 extends p.Tme{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new Bb;this._gizmo=n,this.add(n);const i=new Ob;this._plane=i,this.add(i);const o=this;function a(R,M){let C=M;Object.defineProperty(o,R,{get:function(){return C!==void 0?C:M},set:function(L){C!==L&&(C=L,i[R]=L,n[R]=L,o.dispatchEvent({type:R+"-changed",value:L}),o.dispatchEvent(Q0))}}),o[R]=M,i[R]=M,n[R]=M}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const c=new p.Pa4,u=new p.Pa4,d=new p._fP,m=new p._fP,g=new p.Pa4,_=new p._fP,w=new p.Pa4,x=new p.Pa4,T=new p.Pa4,I=new p.Pa4;a("worldPosition",c),a("worldPositionStart",u),a("worldQuaternion",d),a("worldQuaternionStart",m),a("cameraPosition",g),a("cameraQuaternion",_),a("pointStart",w),a("pointEnd",x),a("rotationAxis",T),a("rotationAngle",0),a("eye",I),this._offset=new p.Pa4,this._startNorm=new p.Pa4,this._endNorm=new p.Pa4,this._cameraScale=new p.Pa4,this._parentPosition=new p.Pa4,this._parentQuaternion=new p._fP,this._parentQuaternionInv=new p._fP,this._parentScale=new p.Pa4,this._worldScaleStart=new p.Pa4,this._worldQuaternionInv=new p._fP,this._worldScale=new p.Pa4,this._positionStart=new p.Pa4,this._quaternionStart=new p._fP,this._scaleStart=new p.Pa4,this._getPointer=W1.bind(this),this._onPointerDown=X1.bind(this),this._onPointerHover=q1.bind(this),this._onPointerMove=Y1.bind(this),this._onPointerUp=K1.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Jd.setFromCamera(e,this.camera);const t=W0(this._gizmo.picker[this.mode],Jd);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){Jd.setFromCamera(e,this.camera);const t=W0(this._plane,Jd,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Mb.mode=this.mode,this.dispatchEvent(Mb)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let o=this.space;if(n==="scale"?o="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(o="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;Jd.setFromCamera(e,this.camera);const a=W0(this._plane,Jd,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(i.position.applyQuaternion(zr.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),o==="world"&&(i.parent&&i.position.add(Ga.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Ga.setFromMatrixPosition(i.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let c=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(c*=-1),Eh.set(c,c,c)}else Ga.copy(this.pointStart),Eh.copy(this.pointEnd),Ga.applyQuaternion(this._worldQuaternionInv),Eh.applyQuaternion(this._worldQuaternionInv),Eh.divide(Ga),t.search("X")===-1&&(Eh.x=1),t.search("Y")===-1&&(Eh.y=1),t.search("Z")===-1&&(Eh.z=1);i.scale.copy(this._scaleStart).multiply(Eh),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const c=20/this.worldPosition.distanceTo(Ga.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ga.copy(this.rotationAxis).cross(this.eye))*c):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(Cb[t]),Ga.copy(Cb[t]),o==="local"&&Ga.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Ga.cross(this.eye).normalize())*c),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(zr.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(zr.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Q0),this.dispatchEvent(Ib)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Tb.mode=this.mode,this.dispatchEvent(Tb)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Q0),this.dispatchEvent(Ib),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Jd}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function W1(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function q1(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s))}}function X1(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function Y1(s){this.enabled&&this.pointerMove(this._getPointer(s))}function K1(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function W0(s,e,t){const n=e.intersectObject(s,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||t)return n[i];return!1}const Xv=new p.USm,Ar=new p.Pa4(0,1,0),Pb=new p.Pa4(0,0,0),Rb=new p.yGw,Yv=new p._fP,Kv=new p._fP,Wc=new p.Pa4,Db=new p.yGw,Zd=new p.Pa4(1,0,0),Sh=new p.Pa4(0,1,0),Wm=new p.Pa4(0,0,1),$d=new p.Pa4,wf=new p.Pa4,qm=new p.Pa4;class Bb extends p.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new p.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new p.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const o=e.clone();o.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const c=e.clone();c.color.setHex(255);const u=e.clone();u.color.setHex(16711680),u.opacity=.5;const d=e.clone();d.color.setHex(65280),d.opacity=.5;const m=e.clone();m.color.setHex(255),m.opacity=.5;const g=e.clone();g.opacity=.25;const _=e.clone();_.color.setHex(16776960),_.opacity=.25,e.clone().color.setHex(16776960);const w=e.clone();w.color.setHex(7895160);const x=new p.fHI(0,.04,.1,12);x.translate(0,.05,0);const T=new p.DvJ(.08,.08,.08);T.translate(0,.04,0);const I=new p.u9r;I.setAttribute("position",new p.a$l([0,0,0,1,0,0],3));const R=new p.fHI(.0075,.0075,.5,3);function M(le,ue){const ge=new p.XvJ(le,.0075,3,64,ue*Math.PI*2);return ge.rotateY(Math.PI/2),ge.rotateX(Math.PI/2),ge}R.translate(0,.25,0);const C={X:[[new p.Kj0(x,o),[.5,0,0],[0,0,-Math.PI/2]],[new p.Kj0(x,o),[-.5,0,0],[0,0,Math.PI/2]],[new p.Kj0(R,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new p.Kj0(x,a),[0,.5,0]],[new p.Kj0(x,a),[0,-.5,0],[Math.PI,0,0]],[new p.Kj0(R,a)]],Z:[[new p.Kj0(x,c),[0,0,.5],[Math.PI/2,0,0]],[new p.Kj0(x,c),[0,0,-.5],[-Math.PI/2,0,0]],[new p.Kj0(R,c),null,[Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.pQR(.1,0),g.clone()),[0,0,0]]],XY:[[new p.Kj0(new p.DvJ(.15,.15,.01),m.clone()),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),u.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),d.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},L={X:[[new p.Kj0(new p.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new p.Kj0(new p.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,.3,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.pQR(.2,0),n)]],XY:[[new p.Kj0(new p.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},k={START:[[new p.Kj0(new p.pQR(.01,2),i),null,null,null,"helper"]],END:[[new p.Kj0(new p.pQR(.01,2),i),null,null,null,"helper"]],DELTA:[[new p.x12(function(){const le=new p.u9r;return le.setAttribute("position",new p.a$l([0,0,0,1,1,1],3)),le}(),i),null,null,null,"helper"]],X:[[new p.x12(I,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new p.x12(I,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new p.x12(I,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},j={XYZE:[[new p.Kj0(M(.5,1),w),null,[0,Math.PI/2,0]]],X:[[new p.Kj0(M(.5,.5),o)]],Y:[[new p.Kj0(M(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new p.Kj0(M(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new p.Kj0(M(.75,1),_),null,[0,Math.PI/2,0]]]},H={AXIS:[[new p.x12(I,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},X={XYZE:[[new p.Kj0(new p.xo$(.25,10,8),n)]],X:[[new p.Kj0(new p.XvJ(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new p.Kj0(new p.XvJ(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new p.Kj0(new p.XvJ(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new p.Kj0(new p.XvJ(.75,.1,2,24),n)]]},ee={X:[[new p.Kj0(T,o),[.5,0,0],[0,0,-Math.PI/2]],[new p.Kj0(R,o),[0,0,0],[0,0,-Math.PI/2]],[new p.Kj0(T,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new p.Kj0(T,a),[0,.5,0]],[new p.Kj0(R,a)],[new p.Kj0(T,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new p.Kj0(T,c),[0,0,.5],[Math.PI/2,0,0]],[new p.Kj0(R,c),[0,0,0],[Math.PI/2,0,0]],[new p.Kj0(T,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new p.Kj0(new p.DvJ(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),u),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),d),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.DvJ(.1,.1,.1),g.clone())]]},oe={X:[[new p.Kj0(new p.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new p.Kj0(new p.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,.3,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new p.Kj0(new p.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.DvJ(.2,.2,.2),n),[0,0,0]]]},re={X:[[new p.x12(I,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new p.x12(I,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new p.x12(I,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function he(le){const ue=new p.Tme;for(const ge in le)for(let _e=le[ge].length;_e--;){const Ee=le[ge][_e][0].clone(),Ye=le[ge][_e][1],We=le[ge][_e][2],Et=le[ge][_e][3],lt=le[ge][_e][4];Ee.name=ge,Ee.tag=lt,Ye&&Ee.position.set(Ye[0],Ye[1],Ye[2]),We&&Ee.rotation.set(We[0],We[1],We[2]),Et&&Ee.scale.set(Et[0],Et[1],Et[2]),Ee.updateMatrix();const rt=Ee.geometry.clone();rt.applyMatrix4(Ee.matrix),Ee.geometry=rt,Ee.renderOrder=1/0,Ee.position.set(0,0,0),Ee.rotation.set(0,0,0),Ee.scale.set(1,1,1),ue.add(Ee)}return ue}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=he(C)),this.add(this.gizmo.rotate=he(j)),this.add(this.gizmo.scale=he(ee)),this.add(this.picker.translate=he(L)),this.add(this.picker.rotate=he(X)),this.add(this.picker.scale=he(oe)),this.add(this.helper.translate=he(k)),this.add(this.helper.rotate=he(H)),this.add(this.helper.scale=he(re)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Kv;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const o=n[i];let a;o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),a=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag!=="helper"?(o.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Ar.copy(Zd).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Ar.copy(Sh).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Ar.copy(Wm).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Ar.copy(Wm).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Ar.copy(Zd).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Ar.copy(Sh).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Yv.copy(t),Ar.copy(this.eye).applyQuaternion(zr.copy(t).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Rb.lookAt(this.eye,Pb,Sh)),o.name==="X"&&(zr.setFromAxisAngle(Zd,Math.atan2(-Ar.y,Ar.z)),zr.multiplyQuaternions(Yv,zr),o.quaternion.copy(zr)),o.name==="Y"&&(zr.setFromAxisAngle(Sh,Math.atan2(Ar.x,Ar.z)),zr.multiplyQuaternions(Yv,zr),o.quaternion.copy(zr)),o.name==="Z"&&(zr.setFromAxisAngle(Wm,Math.atan2(Ar.y,Ar.x)),zr.multiplyQuaternions(Yv,zr),o.quaternion.copy(zr))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(c){return o.name===c}))&&(o.material.color.setHex(16776960),o.material.opacity=1)):(o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(zr.setFromEuler(Xv.set(0,0,0)),o.quaternion.copy(t).multiply(zr),Math.abs(Ar.copy(Zd).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(zr.setFromEuler(Xv.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(zr),Math.abs(Ar.copy(Sh).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(zr.setFromEuler(Xv.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(zr),Math.abs(Ar.copy(Wm).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(zr.setFromEuler(Xv.set(0,Math.PI/2,0)),Ar.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Rb.lookAt(Pb,Ar,Sh)),o.quaternion.multiply(zr),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Ga.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ga.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Ga),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1)))}super.updateMatrixWorld(e)}}class Ob extends p.Kj0{constructor(){super(new p._12(1e5,1e5,2,2),new p.vBJ({visible:!1,wireframe:!0,side:p.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),$d.copy(Zd).applyQuaternion(t==="local"?this.worldQuaternion:Kv),wf.copy(Sh).applyQuaternion(t==="local"?this.worldQuaternion:Kv),qm.copy(Wm).applyQuaternion(t==="local"?this.worldQuaternion:Kv),Ar.copy(wf),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ar.copy(this.eye).cross($d),Wc.copy($d).cross(Ar);break;case"Y":Ar.copy(this.eye).cross(wf),Wc.copy(wf).cross(Ar);break;case"Z":Ar.copy(this.eye).cross(qm),Wc.copy(qm).cross(Ar);break;case"XY":Wc.copy(qm);break;case"YZ":Wc.copy($d);break;case"XZ":Ar.copy(qm),Wc.copy(wf);break;case"XYZ":case"E":Wc.set(0,0,0)}break;default:Wc.set(0,0,0)}Wc.length()===0?this.quaternion.copy(this.cameraQuaternion):(Db.lookAt(Ga.set(0,0,0),Wc,Ar),this.quaternion.setFromRotationMatrix(Db)),super.updateMatrixWorld(e)}}class Lb extends Q1{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(p.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)==null||t.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const n=e==null?void 0:e.getPlugin(_c);n&&(t.value?n.disable("TransformControls"):n.enable("TransformControls")),this._scene.activeCamera.interactionsEnabled=!t.value}),this._keyDownListener=this._keyDownListener.bind(this),this._keyUpListener=this._keyUpListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var kb=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Ti extends En{get picker(){return this._picker}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}constructor(e=H0,t=!1,n=!0,i=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=o=>{this._viewer&&(this.enabled?this.dispatchEvent(o):o.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const o=this.getSelectedObject();this.autoFocus&&o&&this.setSelectedObject(o,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=i}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)==null?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled||!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new wb(e.scene,e.canvas,void 0,t=>{if(!t.material)return!1;let n=t,i=!1;for(;n;){if(!n.visible||((n.userData.iModel??n).assetType==="model"&&(i=!0),(n.userData.iModel??n).assetType==="widget")||n.userData.userSelectable===!1||n.userData.bboxVisible===!1)return!1;n=n.parent}return i}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new Lb(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var a,c,u;this.dispatchEvent(t);const n=((a=this._picker)==null?void 0:a.selectedObject)||void 0;if(this._pickUi){const d=n==null?void 0:n.uiConfig,m=this.uiConfig;m.children=[...this._uiConfigChildren],d&&m.children.push(d),(c=m.uiRefresh)==null||c.call(m)}const i=this._widget;i&&this._enableWidget&&(n?i.attach(n):i.detach());const o=this._transformControls;o&&((u=this._viewer)!=null&&u.scene.activeCamera.controls)&&(n&&o.enabled?o.attach(n):o.detach()),e.setDirty(),this.autoFocus&&this.focusObject(n)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",t=>{t.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(t.value,this.autoFocus||t.focusCamera)}),e.scene.addEventListener("addSceneObject",async t=>{var o,a;const n=t.object,i=this.getSelectedObject();if(i&&(n==null?void 0:n.assetType)==="material"&&typeof(i==null?void 0:i.setMaterial)=="function"&&((o=i==null?void 0:i.modelObject)!=null&&o.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const c=i.material;if(Array.isArray(c))console.warn("Dropping on material array not yet fully supported."),i.setMaterial(n);else{let u=Array.from((c==null?void 0:c.userData.__appliedMeshes)??[]);(u.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):u.length<1)&&(u=[i]);for(const d of u)d&&((a=d.setMaterial)==null||a.call(d,n))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let i=!1;n==null||n.traverseAncestors(o=>{o===e.scene.modelObject&&(i=!0)}),i||this.setSelectedObject(void 0)})}async focusObject(e){var n,i,o;const t=(n=this._viewer)==null?void 0:n.getPluginByType("CameraViews");await(t==null?void 0:t.animateToFitObject(e,1.25,1e3,"easeOut",{min:(((o=(i=this._viewer)==null?void 0:i.scene.activeCamera.getControls())==null?void 0:o.minDistance)??.5)+.5,max:50}))}enableWidget(e){var t,n,i;if(this._enableWidget=e,e){const o=((t=this._picker)==null?void 0:t.selectedObject)||void 0;o&&((n=this._widget)==null||n.attach(o))}else(i=this._widget)==null||i.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}Ti.PluginType="Picking",kb([Ae()],Ti.prototype,"enabled",void 0),kb([Ae()],Ti.prototype,"autoFocus",void 0);var ep,Xm=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Go=ep=class extends En{enableCustomBump(s,e,t){var i;const n=(i=s.materialObject)==null?void 0:i.userData;if(!n)return!1;if(n._hasCustomBump===void 0){const o=n.__appliedMeshes;let a=!0;if(o)for(const{geometry:c}of o)!c||c.attributes.position&&c.attributes.normal&&c.attributes.uv||(a=!1);if(!a)return!1}return n._hasCustomBump=!0,n._customBumpScale=t??n._customBumpScale??.001,n._customBumpMap=e??n._customBumpMap,s.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new J1(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Qt],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new p.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(s,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(s,e,t)=>{var i;if(!this.enabled||!e.materialObject.userData._hasCustomBump)return;((i=e.materialObject.userData)==null?void 0:i._customBumpMap)&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),s.vertexShader=Sn(s.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),s.vertexShader=Sn(s.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),s.defines.USE_UV="")},onObjectRender:(s,e)=>{var a;const t=e.materialObject.userData;if(!(t!=null&&t._hasCustomBump))return;const n=s;if(!n.isMesh||!n.geometry)return;const i=(a=t._customBumpMap)!=null&&a.isTexture?t._customBumpMap:null;this._uniforms.customBumpMap.value=i,this._uniforms.customBumpScale.value=i?t._customBumpScale:0,i&&(i.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(i.matrix));let o=this.enabled&&i?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t,n;return(this.enabled?"1":"0")+((e=s.materialObject.userData)!=null&&e._hasCustomBump?"1":"0")+((n=(t=s.materialObject.userData)==null?void 0:t._customBumpMap)==null?void 0:n.uuid)},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t=this.enableCustomBump,n={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return s.materialObject.userData._hasCustomBump||!1},set value(i){var o;i!==s.materialObject.userData._hasCustomBump&&(i?t(s)||e.alert("One or more geometries cannot be made anisotropic."):(s.materialObject.userData._hasCustomBump=!1,s.materialObject.needsUpdate=!0),(o=n.uiRefresh)==null||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!s.materialObject.userData._hasCustomBump,property:[s.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!s.materialObject.userData._hasCustomBump,property:[s.materialObject.userData,"_customBumpMap"],onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}},In(s.materialObject.userData,"_customBumpMap")]};return n}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)==null||e.call(s),(t=this._viewer)==null||t.setDirty()},this.enableCustomBumpSelected=()=>{var e,t,n;const s=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return(s==null?void 0:s.assetType)==="material"&&this.enableCustomBump(s)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(s){var t,n,i,o,a;await super.onAdded(s);const e=s.getPlugin(Qt);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(Jv)}async onRemove(s){var t,n,i,o,a,c,u,d,m,g,_,w;(n=(t=s.getPlugin(Qt))==null?void 0:t.materials)==null||n.unregisterMaterialExtension(this.materialExtension),(o=(i=s.getPlugin(Qt))==null?void 0:i.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate);const e=(d=(u=(c=(a=s.getPlugin(Qt))==null?void 0:a.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:u.extensions)==null?void 0:d.indexOf(Jv);return e!==void 0&&e!==-1&&((w=(_=(g=(m=s.getPlugin(Qt))==null?void 0:m.exporter)==null?void 0:g.getExporter("gltf","glb"))==null?void 0:_.extensions)==null||w.splice(e,1)),super.onRemove(s)}};Go.PluginType="CustomBumpMapPlugin",Go.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",Xm([Gt("Enabled",s=>({onChange:s.setDirty})),Ae()],Go.prototype,"enabled",void 0),Xm([Gt("Bicubic",s=>({onChange:s.setDirty})),se("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,ep.prototype.setDirty),Ae()],Go.prototype,"bicubicFiltering",void 0),Xm([Ai("Enable CustomBumpMap",s=>({hidden:()=>{var e;return!((e=s._viewer)!=null&&e.getPlugin(Ti))}}))],Go.prototype,"enableCustomBumpSelected",void 0),Go=ep=Xm([Hn("CustomBumpMap Materials")],Go);class J1{constructor(e){this.parser=e,this.name=Go.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=a.customBumpScale??0;const c=a.customBumpMap;return c&&o.push(n.assignTexture(t.userData,"_customBumpMap",c).then(u=>{u.colorSpace=p.KI_})),Promise.all(o)}}const Jv=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const i={index:s.processTexture(e.userData._customBumpMap)};s.applyTextureTransform(i,e.userData._customBumpMap),n.customBumpMap=i}t.extensions[Go.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=n,s.extensionsUsed[Go.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var Ch,ao=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let sr=Ch=class extends En{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(s){this._animationTime=Math.max(0,Math.min(s,this._animationDuration))}_wheel({deltaY:s}){this.enabled&&Math.abs(s)>.001&&(this._scrollAnimationState=-1*Math.sign(s))}_drag(s){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=s.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=s.delta.y*this._viewer.canvas.height/4)}_postFrame(){var o,a;if(!this._viewer)return;const s=this._viewer,e=this.animateOnScroll,t=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!e&&!t)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))==null||o.enable(Ch.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const c=(0,V.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=c-1/30);let u=c-this._lastFrameTime;if(u*=this.animationSpeed,this._lastFrameTime=c,e&&t?u*=(0,V.absMax)(this._scrollAnimationState,this._dragAnimationState):e?u*=this._scrollAnimationState:t&&(u*=this._dragAnimationState),Math.abs(u)<1e-4)return;const d=(a=this._viewer.getPluginByType("Progressive"))==null?void 0:a.postFrameConvergedRecordingDelta();if(d&&d>0&&(u=d),d===0)return;const m=Math.abs(this.timeScale);this._animationTime+=u*(m>0?m:1)}const n=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const i=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(c=>{c.mixer.setTime(i)}),!(Math.abs(n)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:n,time:i}),s.scene.activeCamera.cameraObject.userData.__animatingCamera&&s.scene.activeCamera.setDirty(),s.scene.refreshActiveCameraNearFar(),s.renderer.resetShadows(),s.setDirty(),!this._fadeDisabled){const c=this._viewer.getPluginByType("FrameFade");c&&(c.disable(Ch.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[Qt],this._pointerDragHelper=new V.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=s=>{const e=s.object;if(e.assetType!=="model"||!e.modelObject||!this._viewer)return;let t=!1;e.modelObject.traverse(n=>{const i=n.animations;if(i.length<1)return;const o=Math.max(...i.map(u=>u.duration));(e.modelObject.userData.gltfAnim_SyncMaxDuration??this.syncMaxDuration)&&(i.forEach(u=>u.duration=o),e.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const a=new p.Xcj(this._viewer.scene.modelRoot.modelObject),c=i.map(u=>a.clipAction(u).setLoop(this.loopAnimations?p.YKA:p.jAl,this.loopRepetitions));c.forEach(u=>u.clampWhenFinished=!0),this.animations.push({mixer:a,clips:i,actions:c,duration:o}),t=!0}),t&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new Z1(e,this))}async onAdded(s){var t,n,i,o,a,c;(n=(t=s.getPlugin(Qt))==null?void 0:t.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),s.scene.addEventListener("addSceneObject",this._objectAdded),(c=(a=(o=(i=s.getPlugin(Qt))==null?void 0:i.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:a.extensions)==null||c.push(Ub),s.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=s.canvas;let e=-1;return Object.defineProperty(s.scene.modelRoot,"currentTimelineMarker",{get:()=>e,set:u=>s.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[e=u]})}),s.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:u})=>{var m;if(!this._viewer)return;if(!u)return this._viewer.scene.activeCamera=(m=this._viewer)==null?void 0:m.scene.defaultCamera,void this._viewer.setDirty();const d=u.camera;d&&(d.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(d))}),super.onAdded(s)}async onRemove(s){var e,t;for(;this.animations.length;)this.animations.pop();return s.scene.removeEventListener("addSceneObject",this._objectAdded),(t=(e=s.getPlugin(Qt))==null?void 0:e.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),s.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(s)}_onPropertyChange(s=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&s&&this.playAnimation()}onStateChange(){var s,e;(e=(s=this.uiConfig)==null?void 0:s.children)==null||e.map(t=>t&&(0,V.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(s,e=!1){return this.playClips([s],e)}async playClips(s,e=!1){const t=[];return this.animations.forEach(({actions:n})=>{n.forEach(i=>{s.includes(i.getClip().name)&&t.push(i)})}),this.playAnimation(e,t)}async playAnimation(s=!1,e){var a;if(!this.enabled)return;let t=!1;this._animationState==="playing"&&(this.stopAnimation(!1),t=!0);let n=0;const i=!e;e||(e=[],this.animations.forEach(({mixer:c,actions:u,clips:d})=>{e.push(...u)})),t?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(c=>{c.reset()}),this._animationTime=0);const o=ns();this._lastAnimId=o;for(const c of e)c.setLoop(this.loopAnimations?p.YKA:p.jAl,this.loopRepetitions),c.play(),n=Math.max(n,c.getClip().duration/Math.abs(c.timeScale));if(this._animationState="playing",(a=this._viewer)==null||a.setDirty(),i){if(!isFinite(this._animationDuration))return;await new Promise((c,u)=>{const d=()=>{this.removeEventListener("checkpointEnd",d),c()};this.addEventListener("checkpointEnd",d)})}else{const c=this.loopAnimations?this.loopRepetitions:1;if(n*=c,!isFinite(n))return;await new Promise((u,d)=>{const m=g=>{g.time>=n&&(this.removeEventListener("animationStep",m),u())};this.addEventListener("animationStep",m)})}o===this._lastAnimId&&this.stopAnimation(s)}pauseAnimation(){var s;this._animationState==="playing"?(this._animationState="paused",(s=this._viewer)==null||s.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var s;this._animationState==="paused"?(this._animationState="playing",(s=this._viewer)==null||s.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(s=!1){var e,t;this._animationState="stopped",s?this.resetAnimation():(e=this._viewer)==null||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))==null||t.enable(Ch.PluginType),this._fadeDisabled=!1)}resetAnimation(){var s;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(s=this._viewer)==null||s.setDirty()):this.stopAnimation(!0)}};sr.PluginType="GLTFAnimation",sr.AnimationMarkersExtension="WEBGI_animation_markers",ao([Ae()],sr.prototype,"autoIncrementTime",void 0),ao([nc()],sr.prototype,"animationState",null),ao([nc()],sr.prototype,"animationTime",null),ao([nc()],sr.prototype,"animationDuration",null),ao([(0,V.onChange2)(Ch.prototype._onPropertyChange),Gt("Loop",{limitedUi:!0}),Ae()],sr.prototype,"loopAnimations",void 0),ao([(0,V.onChange2)(Ch.prototype._onPropertyChange),Ae()],sr.prototype,"loopRepetitions",void 0),ao([cn("Timescale",[-2,2],.01),Ae()],sr.prototype,"timeScale",void 0),ao([cn("Speed",[.1,4],.1,{limitedUi:!0}),Ae()],sr.prototype,"animationSpeed",void 0),ao([Gt(),Ae()],sr.prototype,"animateOnScroll",void 0),ao([Gt(),Ae()],sr.prototype,"animateOnDrag",void 0),ao([Uo("Drag Axis",[{label:"x"},{label:"y"}]),Ae()],sr.prototype,"dragAxis",void 0),ao([Gt(),Ae()],sr.prototype,"autoplayOnLoad",void 0),ao([Gt("syncMaxDuration(dev)"),Ae()],sr.prototype,"syncMaxDuration",void 0),ao([(0,V.onChange)(Ch.prototype.onStateChange)],sr.prototype,"_animationState",void 0),ao([Ai("Play/Pause",s=>({label:()=>s.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],sr.prototype,"playPauseAnimation",null),ao([Ai("Stop",{limitedUi:!0})],sr.prototype,"stopAnimation",null),ao([Ai("Reset",{limitedUi:!0})],sr.prototype,"resetAnimation",null),sr=Ch=ao([Hn("GLTF Animations")],sr);class Z1{constructor(e,t){this.parser=e,this.name=sr.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){let t=[];for(const g of this.parser.json.scenes||[]){if(!g.extensions)continue;const _=g.extensions[this.name];for(const w of(_==null?void 0:_.markers)||[]){const x=w.camera!==void 0?await this.parser.getDependency("camera",w.camera):void 0;w.time===void 0&&(w.time=w.frame/30,console.error("Update timeline markers plugin for correct times.")),t.push({name:w.name,frame:w.frame,time:w.time,camera:x})}}if(t.length<1)return;t=t.sort((g,_)=>g.frame-_.frame);const n=e.scene??e.scenes[0];if(!n)return;n.userData.__markers=t;const i=this.plugin.timelineMarkers,o=t.map(g=>g.time);let a=i.length;const c=t.map(g=>a++),u=Math.max(...o)+.01;i.push(...t);const d=new p.dUE(".currentTimelineMarker",o,c,p.Syv),m=new p.m7l("animationTimelineMarker",u,[d]);m.__gltfExport=!1,e.animations.push(m)}}const Ub=s=>({afterParse(e){const t=s.json.scenes[s.json.scene||0];t.extensions=t.extensions||{};const n={markers:[]},i=[];if((Array.isArray(e)?e:[e]).forEach(o=>o.traverse(a=>{a.userData.__markers&&i.push(...a.userData.__markers)})),i.sort((o,a)=>o.frame-a.frame),!(i.length<1)){for(const o of i){const a=o.camera;if(a){const c=s.nodeMap.get(a);if(c===void 0){console.warn("Camera not found in gltf export",a,s.nodeMap);continue}const u=s.json.nodes[c].camera;o.camera=u,n.markers.push(o)}}t.extensions[sr.AnimationMarkersExtension]=n,s.extensionsUsed[sr.AnimationMarkersExtension]=!0}}});var Ym=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,q0=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,Zv=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,$v=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,Ol=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ll extends Fr{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,t,n,i=!1){super({vertexShader:Vo,fragmentShader:`

${$v}
${Ym}
${al}
${q0}
${n}

${Zv}

varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!i},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new p.yGw},screenSize:{value:new p.FM8},cameraPositionWorld:{value:new p.Pa4},cameraNearFar:{value:new p.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:i?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(o,a,c)=>{var g;if(!o.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(g=this._target)==null?void 0:g.texture;const u=a.materialObject;let d=this.material.defines.SSGI_ENABLED;u.defines.SSGI_ENABLED!==d&&(u.defines.SSGI_ENABLED=d,u.needsUpdate=!0),d=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==d&&(this.materialExtension.extraUniforms.tSSGIMap.value=d,u.needsUpdate=!0);const m="vec3 totalDiffuse =";o.fragmentShader=o.fragmentShader.replace(m,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${m}`),o.fragmentShader=o.fragmentShader.replace("#include <aomap_fragment>",""),o.defines.USE_UV=""},onObjectRender:(o,a,c)=>{var g,_;const u=a.materialObject,d=!u.transparent&&u.transmission<.001,m=this.enabled&&d&&(this.renderWithCamera||this._renderer.frameCount>1)&&c.userData.screenSpaceRendering!==!1&&!((g=u.userData)!=null&&g.ssrtaoDisabled)&&!((_=u.userData)!=null&&_.ssaoDisabled)?1:0;u.defines.SSRTAO_ENABLED!==m&&(u.defines.SSRTAO_ENABLED=m,u.needsUpdate=!0)},parsFragmentSnippet:o=>{var a;return V.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${$e("tSSGIMap",(a=this._target)==null?void 0:a.texture,o.capabilities.isWebGL2)}

            ${vf}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:o=>{var a,c,u,d;return this.enabled?"1":"0"+((c=(a=this._target)==null?void 0:a.texture)==null?void 0:c.colorSpace)+((d=(u=this._target)==null?void 0:u.texture)==null?void 0:d.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:o=>{var a;return!((a=o.materialObject.userData)!=null&&a.ssaoDisabled)&&o.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Da(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=i,this.ssgiEnabled=i,this.bilateralPass=new zm(this._target,n,"rgba")}render(e,t,n,i,o){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,o),this.smoothEnabled&&this.bilateralPass.render(e,t,n,i,o))}}Ol([Ae()],ll.prototype,"bilateralPass",void 0),Ol([cn("Intensity",[0,4]),Ae(),Fe()],ll.prototype,"intensity",void 0),Ol([cn("Power",[0,3]),Ae(),Fe()],ll.prototype,"power",void 0),Ol([Gt("Auto radius"),Ae(),Fe()],ll.prototype,"autoRadius",void 0),Ol([cn("Object Radius",[.01,10]),Ae(),Fe()],ll.prototype,"objectRadius",void 0),Ol([cn("Tolerance",[.1,5]),Ae(),Fe()],ll.prototype,"tolerance",void 0),Ol([cn("Bias",[-.3,.3]),Ae(),Fe()],ll.prototype,"bias",void 0),Ol([cn("Falloff",[1e-4,4]),Ae(),Fe()],ll.prototype,"falloff",void 0),Ol([cn("Ray Count",[1,5],1),Ae(),Fe()],ll.prototype,"rayCount",void 0),Ol([cn("Step count",[1,16],1),Ae(),se("RTAO_STEP_COUNT")],ll.prototype,"stepCount",void 0),Ol([Gt("Smooth Enabled"),Ae()],ll.prototype,"smoothEnabled",void 0),Ol([Gt("Render with Camera")],ll.prototype,"renderWithCamera",void 0);class Km extends Fm{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[Qt,Ii,oo],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var t,n;await super.onAdded(e),this.enabled=this._initEnabled,(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}get enabled(){var e,t;return((t=(e=this.passes.ssrtgi)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssrtgi)!=null&&t.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,n;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),(t=this._viewer)==null||t.getPluginByType("debug"),[sc(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new ll(e.renderer,this._rtgiTarget,((n=e.getPlugin(Ii))==null?void 0:n.getUnpackSnippet())??"",!0),update:()=>{var o;const i=this.enabled;if(i){const a=(o=this._viewer)==null?void 0:o.getPluginByType("SSAO");a!=null&&a.enabled&&(a.enabled=!1)}i&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Ii)])}},()=>[e.getPlugin(Ii),e.getPlugin(oo),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var t,n,i,o;const e=((n=(t=this.passes.ssrtgi)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(o=(i=e.children)==null?void 0:i.map(a=>(0,V.getOrCall)(a)))==null||o.flat(2).forEach(a=>a&&(a.onChange=this.setDirty)),e}}Km.PluginType="SSGI";let e_=class extends ou{constructor(s,e,t){super(s,e,t??new Nb,new p.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(s,e,t,n,i){this.enabled&&super.render(s,e,t,n,i)}};e_=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Hn("High Precision Normal Buffer")],e_);class Nb extends p.RSm{constructor(){super()}onBeforeRender(e,t,n,i,o){let a=o.material;Array.isArray(a)&&(a=a[0]),this.normalMap=(a==null?void 0:a.normalMap)??null,this.bumpMap=(a==null?void 0:a.bumpMap)??null,this.bumpScale=a==null?void 0:a.bumpScale,a!=null&&a.normalScale&&this.normalScale.copy(a==null?void 0:a.normalScale),this.needsUpdate=!0,this.side=a.side??p.ehD}}class Mh extends ea{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:p.cLu,minFilter:p.TyD,magFilter:p.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,n=new Set,i=new Set;return new class extends e_{render(o,a,c,u,d){const m=o.getRenderTarget(),g=o.getActiveCubeFace(),_=o.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:w})=>{w&&((w.transparent&&w.userData.renderToDepth||!w.transparent&&w.transmission===0&&w.userData.renderToDepth===!1)&&(n.add(w),w.transparent=!w.transparent),Math.abs(w.transmission||0)>0&&w.userData.renderToDepth&&(i.add([w,w.transmission]),w.transmission=0))}),Vt(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,a,t,u,d)),n.forEach(w=>w.transparent=!w.transparent),n.clear(),i.forEach(([w,x])=>w.transmission=x),i.clear(),o.setRenderTarget(m,g,_))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,n;return e.renderer.disposeTarget((n=(t=this._normalTarget)==null?void 0:t.dispose)==null?void 0:n.call(t)),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled?((t=this.getNormalBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}Mh.PluginType="NormalBufferPlugin";var X0=function(s,e){return X0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},X0(s,e)};function Y0(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=s}X0(s,e),s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var K0,J0=function(){function s(){}return s._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},s}(),Fb=function(s){function e(t){var n=s.call(this)||this;return n.a=e._xfnv1a(t)(),n}return Y0(e,s),e.prototype.next=function(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},e}(J0),$1=function(s){function e(t){var n=s.call(this)||this,i=e._xfnv1a(t);return n.a=i(),n.b=i(),n.c=i(),n.d=i(),n}return Y0(e,s),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296},e}(J0),Z0=function(s){function e(t){var n=s.call(this)||this,i=e._xfnv1a(t);return n.a=i(),n.b=i(),n.c=i(),n.d=i(),n}return Y0(e,s),e.prototype.next=function(){var t=this.b<<9,n=5*this.a;return n=n<<7|9*(n>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(n>>>0)/4294967296},e}(J0);(function(s){s.sfc32="sfc32",s.mulberry32="mulberry32",s.xoshiro128ss="xoshiro128ss"})(K0||(K0={}));var $0=function(){function s(e,t){t===void 0&&(t=K0.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return s.prototype.next=function(){return this.generator.next()},s.prototype._initializeGenerator=function(){if(function(t){return t===null}(e=this.str)||function(t){return t===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new $1(this.str);case"mulberry32":return new Fb(this.str);case"xoshiro128ss":return new Z0(this.str);default:return this.wrap()}},s.prototype.wrap=function(){return{next:function(){return Math.random()}}},s}(),jb=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Jm extends ji{constructor(e,t,n,i){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new p.Pa4(10,10,10),normalDirection:new p.Pa4(.01,.98,.01).normalize(),direction:new p.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=n??{},this.randomParams=i??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,n=null){const i=new $0(e.toString()),o=new p.FM8(i.next()*Math.PI*2,Math.asin(2*i.next()-1));let a=new p.Pa4(Math.cos(o.x)*Math.cos(o.y),Math.sin(o.y),Math.sin(o.x)*Math.cos(o.y));const c=new p.FM8;for(let u=0;u<5;u++){c.set(i.next(),i.next()),a=zb(c,this._randomParams.normalDirection,.4),i.next()<Math.sqrt(t??this._randomParams.focus)&&(c.set(i.next(),i.next()),a=zb(c,this._randomParams.direction,Math.pow((n??this._randomParams.spread)/2,2)));const d=a.dot(this._randomParams.normalDirection);if(d>0&&d<.4)break}a.normalize(),a.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(a.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new p.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function zb(s,e,t){e=e.clone().normalize();const n=new p.Pa4(0,-e.z,e.y).normalize(),i=new p.Pa4().crossVectors(e,n).normalize(),o=s;o.x=2*o.x*Math.PI,o.y=1-o.y*t;const a=Math.sqrt(1-o.y*o.y);return n.multiplyScalar(Math.cos(o.x)*a).add(i.multiplyScalar(Math.sin(o.x)*a)).add(e.multiplyScalar(o.y))}jb([Ae("shadowParams")],Jm.prototype,"_shadowParams",void 0),jb([Ae("randomParams")],Jm.prototype,"_randomParams",void 0);var ey=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Th extends En{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new Jm("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var n,i;if(!this.enabled)return void(this.light.layers.mask=0);const t=((n=this._viewer)==null?void 0:n.renderer.frameCount)??0;this.light.randomizePosition(t<5?0:t),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(i=this._cameraHelper)==null||i.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new p.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,n;e?(t=this._viewer)==null||t.scene.setDirty():(n=this._viewer)==null||n.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}Th.PluginType="RandomizedDirectionalLight",ey([Ae()],Th.prototype,"enabled",void 0),ey([Ae("rdLight")],Th.prototype,"light",void 0),ey([Ae()],Th.prototype,"lightLayers",void 0);var ty=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,Ll=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let lo=class extends Fr{constructor(s,e,t,n=!0){super({vertexShader:Vo,fragmentShader:`

varying vec2 vUv;

${$v}
${Ym}
${al}
${q0}
${t}

${Zv}

${ty}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new p.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new p.yGw},cameraPositionWorld:{value:new p.Pa4},cameraNearFar:{value:new p.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:n?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(i,o,a)=>{var d,m,g;let c=this.enabled&&a.userData.screenSpaceRendering!==!1&&!((d=o.materialObject.userData)!=null&&d.ssreflDisabled)?1:0;if(o.materialObject.defines.SSR_ENABLED!==c&&(o.materialObject.defines.SSR_ENABLED=c,o.materialObject.needsUpdate=!0),!i.defines.SSR_ENABLED)return;c=this.material.defines.SSR_STEP_COUNT,o.materialObject.defines.SSR_STEP_COUNT!==c&&(o.materialObject.defines.SSR_STEP_COUNT=c,o.materialObject.needsUpdate=!0),c=this.material.defines.SSR_LOW_QUALITY_FRAMES,o.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==c&&(o.materialObject.defines.SSR_LOW_QUALITY_FRAMES=c,o.materialObject.needsUpdate=!0),c=this.material.defines.PERSPECTIVE_CAMERA,o.materialObject.defines.PERSPECTIVE_CAMERA!==c&&(o.materialObject.defines.PERSPECTIVE_CAMERA=c,o.materialObject.needsUpdate=!0),c=this.material.defines.SSR_INLINE,o.materialObject.defines.SSR_INLINE!==c&&(o.materialObject.defines.SSR_INLINE=c,o.materialObject.needsUpdate=!0),c=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,o.materialObject.defines.SSR_MASK_FRONT_RAYS!==c&&(o.materialObject.defines.SSR_MASK_FRONT_RAYS=c,o.materialObject.needsUpdate=!0),c=(m=o.materialObject.userData)!=null&&m.ssreflNonPhysical?"1":"0",o.materialObject.defines.SSR_NON_PHYSICAL!==c&&(o.materialObject.defines.SSR_NON_PHYSICAL=c,o.materialObject.needsUpdate=!0),c=((g=this._target)==null?void 0:g.texture)??null,this.materialExtension.extraUniforms.tSSRMap.value!==c&&(this.materialExtension.extraUniforms.tSSRMap.value=c,o.materialObject.needsUpdate=!0);const u="#glMarker beforeModulation";i.fragmentShader=i.fragmentShader.replace(u,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${u}`)},onObjectRender:(i,o,a)=>{var u;const c=this.enabled&&a.userData.screenSpaceRendering!==!1&&!((u=o.materialObject.userData)!=null&&u.ssreflDisabled)?1:0;o.materialObject.defines.SSR_ENABLED!==c&&(o.materialObject.defines.SSR_ENABLED=c,o.materialObject.needsUpdate=!0)},parsFragmentSnippet:(i,o)=>{var a,c;return!this.enabled||i.userData.screenSpaceRendering===!1||(a=o==null?void 0:o.materialObject.userData)!=null&&a.ssreflDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+$e("tSSRMap",(c=this._target)==null?void 0:c.texture,i.capabilities.isWebGL2)+$e("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,i.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${$v}
    
    #define THREE_PACKING_INCLUDED
    ${Ym}
    
    ${al}
    ${q0}
    ${vo}
    
    ${Zv}
    
    ${ty}
// #endif // SSR_INLINE
#endif
`:"")+`
${vf}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:i=>{var o,a,c;return this.enabled?"1":"0"+((a=(o=this._target)==null?void 0:o.texture)==null?void 0:a.colorSpace)+(this.enabled&&!((c=i.materialObject.userData)!=null&&c.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(u=>u+"").join(",")},isCompatible:i=>{var o;return!((o=i.materialObject.userData)!=null&&o.ssreflDisabled)&&i.isMeshStandardMaterial2}},this.intensity=1,this.boost=new p.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=s,this._target=e,this.needsSwap=!1,this._inline=n}render(s,e,t,n,i){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(s,this._target,t,n,i),this.needsSwap=!1}}};Ll([cn("Intensity",[0,4]),Ae(),Fe()],lo.prototype,"intensity",void 0),Ll([As("Boost"),Ae(),Fe()],lo.prototype,"boost",void 0),Ll([cn("Object Radius",[.01,2]),Ae(),Fe()],lo.prototype,"objectRadius",void 0),Ll([Gt("Auto radius"),Ae(),Fe()],lo.prototype,"autoRadius",void 0),Ll([cn("Power",[0,3]),Ae(),Fe()],lo.prototype,"power",void 0),Ll([cn("Tolerance",[.1,5]),Ae(),Fe()],lo.prototype,"tolerance",void 0),Ll([cn("Step count",[1,32],1),Ae(),se("SSR_STEP_COUNT")],lo.prototype,"stepCount",void 0),Ll([cn("Low Quality Frames",[0,4],1),Ae(),se("SSR_LOW_QUALITY_FRAMES")],lo.prototype,"lowQualityFrames",void 0),Ll([Gt("Ignore front rays"),Ae(),se("SSR_MASK_FRONT_RAYS")],lo.prototype,"maskFrontRays",void 0),Ll([cn("Mask front rays factor",[-1,1],.01,s=>({hidden:()=>!s.maskFrontRays})),Ae(),Fe()],lo.prototype,"maskFrontFactor",void 0),lo=Ll([Hn("Screen Space Reflections")],lo);class Zm extends Fm{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[Qt,Ii,oo],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,t;return((t=(e=this.passes.ssr)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssr)!=null&&t.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,n;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}createPasses(e){var t;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[sc(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new lo(e.renderer,this._ssrTarget,((t=e.getPlugin(Ii))==null?void 0:t.getUnpackSnippet())??"",this.inlineSSR)},()=>[e.getPlugin(Ii),e.getPlugin(oo),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var t,n,i,o;const e=((n=(t=this.passes.ssr)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(o=(i=e.children)==null?void 0:i.map(a=>(0,V.getOrCall)(a)))==null||o.flat(2).forEach(a=>a&&(a.onChange=this.setDirty)),e}}Zm.PluginType="SSReflection";var $m=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let va=class extends En{makeAnisotropic(s){var t;const e=(t=s.materialObject)==null?void 0:t.userData;if(!e)return!1;if(e._isAnisotropic===void 0){const n=e.__appliedMeshes;let i=!0;if(n)for(const{geometry:o}of n)!o||o.index&&o.attributes.position&&o.attributes.normal&&o.attributes.uv||(i=!1),i&&!o.attributes.tangent&&o.computeTangents();if(!i)return!1}return e._isAnisotropic=!0,e._anisotropyFactor===void 0&&(e._anisotropyFactor=1),e._anisotropyNoise===void 0&&(e._anisotropyNoise=0),e._anisotropyDirectionMode===void 0&&(e._anisotropyDirectionMode="DIRECTION"),s.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new eE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Qt],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(s,e,t)=>{var c;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const n=(c=e.materialObject.userData)==null?void 0:c._anisotropyDirectionMap,i=V.glsl`
                //#if ANISOTROPY_ENABLED
                ${al}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(n?$e("anisotropyDirectionMap",n,t.capabilities.isWebGL2):"")+`
`;s.fragmentShader=Sn(s.fragmentShader,"#include <common>",i,{append:!0}),s.fragmentShader=s.fragmentShader.replace("#include <lights_fragment_begin>",p.WdD.lights_fragment_begin),s.fragmentShader=Sn(Sn(s.fragmentShader,"IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let o=Sn(p.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");o=Sn(o,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),s.fragmentShader=Sn(s.fragmentShader,"#include <lights_physical_pars_fragment>",o),s.fragmentShader=Sn(s.fragmentShader,"#include <normal_fragment_begin>",p.WdD.normal_fragment_begin),s.fragmentShader=Sn(s.fragmentShader,"#ifdef USE_NORMALMAP_TANGENTSPACE","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_TANGENT )");let a=V.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+p.WdD.lights_fragment_maps;a=Sn(a,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),a=Sn(a,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),s.fragmentShader=Sn(s.fragmentShader,"#include <lights_fragment_maps>",a),s.defines.USE_UV="",s.vertexTangents=!0},onObjectRender:(s,e)=>{var o;const t=e.materialObject.userData;if(!(t!=null&&t._isAnisotropic))return;const n=s;if(!n.isMesh||!n.geometry)return;if(!n.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=t._anisotropyFactor,this._uniforms.anisotropyNoise.value=t._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(o=t._anisotropyDirectionMap)!=null&&o.isTexture?t._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=t._anisotropyDirection;let i=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==i&&(e.materialObject.defines.ANISOTROPY_ENABLED=i,e.materialObject.needsUpdate=!0),i=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==i&&(e.materialObject.defines.ANISOTROPY_DEBUG=i,e.materialObject.needsUpdate=!0),i=t._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(i="CONSTANT"),i=i==="DIRECTION"?2:i==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==i&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=i,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t,n;return(this.enabled?"1":"0")+((e=s.materialObject.userData)!=null&&e._isAnisotropic?"1":"0")+((n=(t=s.materialObject.userData)==null?void 0:t._anisotropyDirectionMap)==null?void 0:n.uuid)},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>{var s;return[(s=this._viewer)==null?void 0:s.renderer]},getUiConfig:s=>{const e=this._viewer,t=this.makeAnisotropic,n={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return s.materialObject.userData._isAnisotropic||!1},set value(i){var o;i!==s.materialObject.userData._isAnisotropic&&(i?t(s)||e.alert("One or more geometries cannot be made anisotropic."):(s.materialObject.userData._isAnisotropic=!1,s.materialObject.needsUpdate=!0),(o=n.uiRefresh)==null||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(i=>({label:i})),onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}}]};return n}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)==null||e.call(s),(t=this._viewer)==null||t.setDirty()},this.makeSelectedAnisotropic=()=>{var e,t,n;const s=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return(s==null?void 0:s.assetType)==="material"&&this.makeAnisotropic(s)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(s){var t,n,i,o,a;await super.onAdded(s);const e=s.getPlugin(Qt);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(tE)}async onRemove(s){var e,t,n,i;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=s.getPlugin(Qt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};va.PluginType="AnisotropyPlugin",va.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",$m([Gt("Enabled",s=>({onChange:s.setDirty})),Ae()],va.prototype,"enabled",void 0),$m([Ai("Make Anisotropy",s=>({hidden:()=>{var e;return!((e=s._viewer)!=null&&e.getPlugin(Ti))}}))],va.prototype,"makeSelectedAnisotropic",void 0),va=$m([Hn("Anisotropy Materials")],va);class eE{constructor(e){this.parser=e,this.name=va.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=a.anisotropyFactor??0,t.userData._anisotropyNoise=a.anisotropyNoiseFactor??a.anisotropyNoise??0;let{anisotropyDirectionMode:c,anisotropyDirection:u}=a;return c||(c=a.anisotropyTextureMode),u||(u=a.anisotropyRotation),t.userData._anisotropyDirectionMode=c&&typeof(u==null?void 0:u.index)=="number"?c:"CONSTANT",c==="ROTATION"||c==="DIRECTION"?o.push(n.assignTexture(t.userData,"_anisotropyDirectionMap",u).then(d=>{d.colorSpace=p.KI_})):t.userData._anisotropyDirection=u??0,Promise.all(o)}afterRoot(e){var t;return(t=e.scene)==null||t.traverse(n=>{var a,c;if(!((c=(a=n.material)==null?void 0:a.userData)==null?void 0:c._isAnisotropic))return;const o=n.geometry;o.attributes.tangent||(o.computeTangents(),o.attributes.tangent.needsUpdate=!0)}),null}}const tE=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.anisotropyFactor=e.userData._anisotropyFactor||1,n.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,n.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&n.anisotropyDirectionMode!=="CONSTANT"){const i={index:s.processTexture(e.userData._anisotropyDirectionMap)};s.applyTextureTransform(i,e.userData._anisotropyDirectionMap),n.anisotropyDirection=i}else n.anisotropyDirectionMode="CONSTANT",n.anisotropyDirection=e.userData._anisotropyDirection||0;t.extensions[va.ANISOTROPY_GLTF_EXTENSION]=n,s.extensionsUsed[va.ANISOTROPY_GLTF_EXTENSION]=!0}});var ny,Vb=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ha=ny=class extends En{static AddFragmentClipping(s,e,t,n,i){var c;const o=(c=s.materialObject)==null?void 0:c.userData;if(!o)return!1;o._fragmentClippingExt||(o._fragmentClippingExt={});const a=o._fragmentClippingExt;return a.clipEnabled=!0,a.clipPosition===void 0&&(a.clipPosition=(e==null?void 0:e.toArray())??[0,0,0,0]),a.clipParams===void 0&&(a.clipParams=(t==null?void 0:t.toArray())??[1,0,0,0]),a.clipMode===void 0&&(a.clipMode=n??To.Circle),a.clipInvert===void 0&&(a.clipInvert=i??!1),s.materialObject.isMaterial&&(s.needsUpdate=!0),!0}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new t_(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Qt,Ii],this._plane=new p.JOQ,this._viewNormalMatrix=new p.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new p.Ltg},fragClippingParams:{value:new p.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._fragmentClippingExt)!=null&&t.clipEnabled)?vf+V.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${To.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${To.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${To.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${To.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${To.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(s,e,t)=>{var n;this.enabled&&((n=e.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker mainStart",V.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${To.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${To.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${To.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${To.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${To.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(s,e)=>{var i,o,a,c,u,d;let t=(i=e.materialObject.userData)==null?void 0:i._fragmentClippingExt;if(e.materialObject.userData.isGBufferMaterial&&s&&(t=(a=(o=s.material)==null?void 0:o.userData)==null?void 0:a._fragmentClippingExt),!(t!=null&&t.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(t.clipPosition),t.clipMode===To.Plane){const m=(c=this._viewer)==null?void 0:c.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(t.clipParams[0],t.clipParams[1],t.clipParams[2]),this._plane.constant=t.clipParams[3],this._viewNormalMatrix.getNormalMatrix(m),this._plane.applyMatrix4(m,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(t.clipParams);((u=this._viewer)==null?void 0:u.scene.activeCamera.cameraObject)instanceof p.cPb?this._uniforms.fragClippingCamAspect.value=(d=this._viewer)==null?void 0:d.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let n=this.enabled?1:0;n=+this._defines.FRAG_CLIPPING_DEBUG,e.materialObject.defines.FRAG_CLIPPING_DEBUG!==n&&(e.materialObject.defines.FRAG_CLIPPING_DEBUG=n,e.materialObject.needsUpdate=!0),n=+t.clipMode,e.materialObject.defines.FRAG_CLIPPING_MODE!==n&&(e.materialObject.defines.FRAG_CLIPPING_MODE=n,e.materialObject.needsUpdate=!0),n=+t.clipInvert,e.materialObject.defines.FRAG_CLIPPING_INVERSE!==n&&(e.materialObject.defines.FRAG_CLIPPING_INVERSE=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+((t=(e=s.materialObject.userData)==null?void 0:e._fragmentClippingExt)!=null&&t.clipEnabled?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2||s.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var n;return((n=s.materialObject.userData._fragmentClippingExt)==null?void 0:n.clipEnabled)||!1},setValue:n=>{var i,o;n!==((i=s.materialObject.userData._fragmentClippingExt)==null?void 0:i.clipEnabled)&&(n?ny.AddFragmentClipping(s.materialObject)||e.alert("Cannot add fragment clipping extension."):s.materialObject.userData._fragmentClippingExt&&(s.materialObject.userData._fragmentClippingExt.clipEnabled=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(To).map(n=>({label:n[0],value:n[1]})),hidden:()=>{var n;return!((n=s.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[s.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",hidden:()=>{var n;return!((n=s.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[s.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",hidden:()=>{var n;return!((n=s.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[s.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var n;return!((n=s.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[s.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)==null||e.call(s),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(s){var t,n,i,o,a,c,u;await super.onAdded(s);const e=s.getPlugin(Qt);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(n_),(u=(c=s.getPlugin(Ii))==null?void 0:c.material)==null||u.registerMaterialExtensions([this.materialExtension])}async onRemove(s){var e,t,n,i;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=s.getPlugin(Qt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};var To;Ha.PluginType="FragmentClippingExtensionPlugin1",Ha.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",Vb([Gt("Enabled",s=>({onChange:s.setDirty})),Ae()],Ha.prototype,"enabled",void 0),Ha=ny=Vb([Hn("FragmentClipping Materials")],Ha),function(s){s[s.Circle=0]="Circle",s[s.Ellipse=1]="Ellipse",s[s.Rectangle=2]="Rectangle",s[s.Plane=3]="Plane",s[s.Sphere=4]="Sphere"}(To||(To={}));class t_{constructor(e){this.parser=e,this.name=Ha.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Ha.AddFragmentClipping(t),t.userData._fragmentClippingExt=Di(i,t.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const n_=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._fragmentClippingExt||!e.userData._fragmentClippingExt.clipEnabled)return;t.extensions=t.extensions||{};const n=xi(e.userData._fragmentClippingExt,!1);t.extensions[Ha.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=n,s.extensionsUsed[Ha.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var tp,Ih=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Lr=tp=class extends En{constructor(s=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new p.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=s,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var n,i,o;if(!this._viewer)return;const s=this._viewer.scene.background;if(this.enabled&&s!==this._viewer.scene.environment&&s!=="environment")if(s&&s.isDataTexture)s.mapping=p.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const a=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");a?(a.envmapBg=!0,(i=(n=a.uiConfig).uiRefresh)==null||i.call(n,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const e=(o=this._viewer.renderer.rendererObject.background.getBoxMesh2())==null?void 0:o.material,t=(e==null?void 0:e.uniforms)??p.Vj0.backgroundCube.uniforms;t.tripodHeight||(t.tripodHeight={value:1}),t.worldRadius||(t.worldRadius={value:1}),t.originPosition||(t.originPosition={value:new p.Pa4}),t.tripodHeight.value=this.tripodHeight,t.worldRadius.value=this.worldRadius,t.originPosition.value.copy(this.originPosition),e&&(!this.enabled&&e.defines.HDRi_GROUND_PROJ?delete e.defines.HDRi_GROUND_PROJ:this.enabled&&(e.defines.HDRi_GROUND_PROJ="1"),e.needsUpdate=!0),this._viewer.setDirty()}async onAdded(s){var e,t,n;await super.onAdded(s),(n=(t=(e=this._viewer)==null?void 0:e.renderer)==null?void 0:t.rendererObject)!=null&&n.background.getBoxMesh()&&s.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),p.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(p.Vj0.backgroundCube.fragmentShader=Sn(p.Vj0.backgroundCube.fragmentShader,"void main() {",`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,{prepend:!0}),p.Vj0.backgroundCube.fragmentShader=Sn(p.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),s.scene.addEventListener("environmentChanged",this._paramsChanged)}};Lr.PluginType="HDRiGroundPlugin",Ih([Ae(),(0,V.onChange)(tp.prototype._paramsChanged),Gt("Enabled")],Lr.prototype,"enabled",void 0),Ih([Ae(),(0,V.onChange)(tp.prototype._paramsChanged),cn("World Radius",[1,1e3],.01)],Lr.prototype,"worldRadius",void 0),Ih([Ae(),(0,V.onChange)(tp.prototype._paramsChanged),cn("Tripod height",[0,50],.01)],Lr.prototype,"tripodHeight",void 0),Ih([Ae(),(0,V.onChange)(tp.prototype._paramsChanged),As("Origin Position",void 0,.001,s=>({onChange:s._paramsChanged}))],Lr.prototype,"originPosition",void 0),Lr=tp=Ih([Hn("HDRi Ground")],Lr);var kl,Cu=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let qs=kl=class extends En{constructor(s=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[Ii,Qt],this.materialExtension={shaderExtender:(e,t,n)=>{if(!e.defines.SSCS_ENABLED)return;const i=V.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,o=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${$v}
    
    #define THREE_PACKING_INCLUDED
    ${Ym}
    
    ${vo}
    ${al}
    
    ${Zv}

#endif
            
            `+p.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${i}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",p.WdD.lights_fragment_begin),e.fragmentShader=Sn(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=Sn(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{var a;const i=t.materialObject;let o=this.enabled&&n.userData.screenSpaceRendering!==!1&&!((a=i.userData)!=null&&a.sscsDisabled)?1:0;i.defines.SSCS_ENABLED!==o&&(i.defines.SSCS_ENABLED=o,i.needsUpdate=!0),o=this._defines.SSCS_STEP_COUNT,i.defines.SSCS_STEP_COUNT!==o&&(i.defines.SSCS_STEP_COUNT=o,i.needsUpdate=!0),o=+this._defines.SSCS_DEBUG,i.defines.SSCS_DEBUG!==o&&(i.defines.SSCS_DEBUG=o,i.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...kl._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,n,i,o;return[(e=this._viewer)==null?void 0:e.getPlugin(Ii),(t=this._viewer)==null?void 0:t.getPlugin(oo),(n=this._viewer)==null?void 0:n.scene.renderCamera,(i=this._viewer)==null?void 0:i.renderer,(o=this._viewer)==null?void 0:o.scene]}},this.enabled=s,this.userData={setDirty:()=>{var e;(e=this._viewer)==null||e.setDirty()}}}async onAdded(s){var e,t;await super.onAdded(s),(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension)}async onRemove(s){var e,t;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),super.onRemove(s)}};qs.PluginType="SSContactShadows",qs._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new p.yGw},cameraPositionWorld:{value:new p.Pa4},cameraNearFar:{value:new p.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},Cu([Gt("Enabled"),Ae()],qs.prototype,"enabled",void 0),Cu([Fe({uniforms:kl._uniforms,propKey:"sscsRadius"}),cn("Radius",[1e-4,.1],1e-4),Ae()],qs.prototype,"radius",void 0),Cu([Fe({uniforms:kl._uniforms,propKey:"sscsIntensity"}),cn("Intensity",[1e-4,1],1e-4),Ae()],qs.prototype,"intensity",void 0),Cu([Fe({uniforms:kl._uniforms,propKey:"sscsTolerance"}),cn("Tolerance",[.1,5]),Ae()],qs.prototype,"tolerance",void 0),Cu([se("SSCS_DEBUG",void 0,!0),Gt("Debug only SSCS"),Ae()],qs.prototype,"onlySSCSDebug",void 0),Cu([se("SSCS_STEP_COUNT",void 0,!0),cn("Step count",[1,8],1),Ae()],qs.prototype,"stepCount",void 0),qs=kl=Cu([Hn("Screen Space Contact Shadows")],qs);class Mu{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new p.xsS,this._mesh=new p.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new np}dispose(){var e;(e=this._mesh.geometry)==null||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach(t=>{var n;return(n=this._normalsCache[t])==null?void 0:n.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(e=>e.dispose())}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}_getPrecisionType(e){return e==="low"?p.ywz:e==="medium"?p.cLu:e==="high"?p.VzW:p.cLu}captureNormalMap(e,t,n=512,i="medium",o){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const a=t==null?void 0:t.split(";").find(d=>this._normalsCache[d]);if(a){const d=this._normalsCache[a];return t==null||t.split(";").forEach(m=>m!==a&&(this._normalsCache[m]=d)),d.width!==n&&console.warn("last cacheKey normalMapRes mismatch, check model",n),e.userData._normalsCaptureMap=d,!1}const c=this._renderer.createTargetCustom({width:n,height:n},{minFilter:p.TyD,magFilter:p.TyD,generateMipmaps:!1,type:this._getPrecisionType(i)},p.oAp);if(c.attachedGeometries=[],c.autoDispose=Mu.AutoDisposeTargets,!c)throw"Unable to create render target";const u=()=>{var g;const d=new p._am(1e-4,100,c);this._scene.add(d);const m=e.userData.normalsCaptureOffsets;m.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(m.center),m.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(m.offsetMatrixInv),m.radius!==void 0&&(this._mesh.material.uniforms.radius.value=m.radius),this._mesh.geometry=e,o!=null&&o.morphTargetInfluences&&((g=e.morphAttributes)!=null&&g.position)&&(this._mesh.morphTargetInfluences=o.morphTargetInfluences,this._mesh.morphTargetDictionary=o.morphTargetDictionary),d.update(this._renderer.rendererObject,this._scene),this._mesh.morphTargetInfluences=void 0,this._mesh.morphTargetDictionary=void 0,this._scene.remove(d),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=c};return u(),this._renderer.addEventListener("contextRestored",u),c.attachedGeometries.push(e),e.addEventListener("dispose",()=>{var d;c.attachedGeometries=((d=c.attachedGeometries)==null?void 0:d.filter(m=>m!==e))??[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",u),c.autoDispose&&!c.attachedGeometries.length&&c.dispose()}),t==null||t.split(";").forEach(d=>this._normalsCache[d]=c),c.addEventListener("dispose",()=>{t==null||t.split(";").forEach(d=>delete this._normalsCache[d]),this._renderer.removeEventListener("contextRestored",u),delete e.userData._normalsCaptureMap}),!0}}Mu.AutoDisposeTargets=!0;class np extends p.jyz{constructor(){super({vertexShader:`varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;
#include <morphtarget_pars_vertex>
void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);
#include <begin_vertex>
transformed-=offsetCenter;
#include <morphtarget_vertex>
vec4 offsetPos=offsetMatrixInv*vec4(transformed,1.);vecPosition=(modelMatrix*offsetPos).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetPos;}`,fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:p.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new p.yGw().identity()},offsetCenter:{value:new p.Pa4}}})}}var xf=__webpackgi_require__(654);function ip(s){const e=new p.Pa4(0,0,0),t=new p.Pa4(0,0,0),n=new p.Pa4(0,0,0),i=new p.Pa4(0,0,0),o=s.getAttribute("position"),a=s.index;if(a)for(let _=Math.max(0,s.drawRange.start),w=Math.min(a.count,s.drawRange.start+s.drawRange.count)-1;_<w/3;_+=3){const x=a.getX(_),T=a.getX(_+1),I=a.getX(_+2);t.set(o.getX(x),o.getY(x),o.getZ(x)),n.set(o.getX(T),o.getY(T),o.getZ(T)),i.set(o.getX(I),o.getY(I),o.getZ(I)),n.sub(t),i.sub(t),i.cross(n),i.normalize(),e.add(i)}else for(let _=0;_<o.count;_+=3)t.set(o.getX(_),o.getY(_),o.getZ(_)),n.set(o.getX(_+1),o.getY(_+1),o.getZ(_+1)),i.set(o.getX(_+2),o.getY(_+2),o.getZ(_+2)),n.sub(t),i.sub(t),i.cross(n),i.normalize(),e.add(i);e.normalize();let c=!1,u=0;for(;!c;){const _=u/3,w=a?a.getX(_):_,x=a?a.getX(_+1):_+1;t.set(o.getX(w),o.getY(w),o.getZ(w)),n.set(o.getX(x),o.getY(x),o.getZ(x)),t.sub(n),t.normalize();const T=e.dot(t);Math.abs(T-1)>.001&&t.length()>.5&&(c=!0),u+=3}n.crossVectors(t,e),n.normalize(),t.crossVectors(e,n),t.normalize();const d=new p.yGw;d.elements[0]=t.x,d.elements[1]=t.y,d.elements[2]=t.z,d.elements[3]=0,d.elements[4]=e.x,d.elements[5]=e.y,d.elements[6]=e.z,d.elements[7]=0,d.elements[8]=n.x,d.elements[9]=n.y,d.elements[10]=n.z,d.elements[11]=0,d.elements[12]=0,d.elements[13]=0,d.elements[14]=0,d.elements[15]=1,s.computeBoundingSphere();const m=s.boundingSphere.radius,g=new p.yGw().makeScale(m,m,m);return d.multiply(g),d}function eg(s,e,t){const n=new p.Pa4().copy(s),i=new p.Pa4().copy(e),o=new p.Pa4().copy(t);return n.dot(i.cross(o))/6}function Gb(s,e,t){const n=new p.Pa4().copy(s),i=new p.Pa4().copy(e),o=new p.Pa4().copy(t);return i.sub(n),o.sub(n),o.cross(i),.5*o.length()}function tg(s){const e=s.getAttribute("position"),t=s.getAttribute("normal");if(e.count/3>500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",e.count/3),ip(s);const n=new p.Pa4(0,0,0),i=new p.Pa4(0,0,0),o=new p.Pa4(0,0,0),a=s.index,c=[];if(a)for(let R=Math.max(0,s.drawRange.start),M=Math.min(a.count,s.drawRange.start+s.drawRange.count)-1;R<M;R+=3){const C=a.getX(R),L=a.getX(R+1),k=a.getX(R+2);n.set(e.getX(C),e.getY(C),e.getZ(C)),i.set(e.getX(L),e.getY(L),e.getZ(L)),o.set(e.getX(k),e.getY(k),e.getZ(k)),c.push(n.toArray(),i.toArray(),o.toArray())}else for(let R=0;R<e.count;R++)n.set(e.getX(R),e.getY(R),e.getZ(R)),c.push(n.toArray());const u=function(R,M){const C=new p.Pa4;for(let re=0;re<R.length;re+=3)C.x+=R[re],C.y+=R[re+1],C.z+=R[re+2];C.multiplyScalar(1/(R.length/3));const L=new p.Pa4,k=new p.Pa4,j=new p.Pa4,H=new p.Pa4,X=new p.Pa4;let ee=0,oe=0;for(let re=0;re<M.length;re+=3){L.set(M[re][0],M[re][1],M[re][2]),k.set(M[re+1][0],M[re+1][1],M[re+1][2]),j.set(M[re+2][0],M[re+2][1],M[re+2][2]),X.copy(L).add(k).add(j);const he=Gb(L,k,j);X.multiplyScalar(he/3),H.add(X),ee+=he,oe+=eg(L,k,j)}return H.multiplyScalar(1/ee),{centre:C,com:H,volume:oe,area:ee}}(e.array,c);if(u.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let R=0;R<t.count;R++)t.setX(R,-t.getX(R)),t.setY(R,-t.getY(R)),t.setZ(R,-t.getZ(R));t.needsUpdate=!0}const d=[];for(let R=0;R<e.array.length;R+=3)d.push([e.array[R],e.array[R+1],e.array[R+2]]);const m=console.log;console.log=()=>{};const g=(0,xf.getEigenVectors)(d);console.log=m;const _=new p.yGw;_.elements[0]=g[0].vector[0],_.elements[1]=g[0].vector[1],_.elements[2]=g[0].vector[2],_.elements[3]=0,_.elements[4]=g[1].vector[0],_.elements[5]=g[1].vector[1],_.elements[6]=g[1].vector[2],_.elements[7]=0,_.elements[8]=g[2].vector[0],_.elements[9]=g[2].vector[1],_.elements[10]=g[2].vector[2],_.elements[11]=0,_.elements[12]=0,_.elements[13]=0,_.elements[14]=0,_.elements[15]=1;const w=new p.Pa4;w.copy(u.com).sub(u.centre),w.normalize();const x=new p.Pa4(g[2].vector[0],g[2].vector[1],g[2].vector[2]);w.dot(x)<0&&(_.elements[4]=-g[1].vector[0],_.elements[5]=-g[1].vector[1],_.elements[6]=-g[1].vector[2],_.elements[8]=-g[2].vector[0],_.elements[9]=-g[2].vector[1],_.elements[10]=-g[2].vector[2]),s.computeBoundingSphere();const T=s.boundingSphere.radius,I=new p.yGw().makeScale(T,T,T);return _.multiply(I),_}const Ef={...oc,color:new p.Ilk(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new p.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var cs=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ki extends p.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,n,i,o){var u,d;super.onBeforeRender(e,t,n,i,o),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((u=this.envMap)==null?void 0:u.rotation)||0)+this.envMapRotationOffset,this.uniforms.envMapRotationQuat.value.setFromEuler(new p.USm(this.envMapRotationOffsetX,this.envMapRotationOffsetY,this.envMapRotationOffsetZ)),this.extraUniformsToUpload.inverseModelMatrix.value.copy(o.matrixWorld).invert();const a=i.userData.normalsCaptureOffsets;a&&(this.extraUniformsToUpload.centerOffset.value.fromArray(a.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(a.offsetMatrix).premultiply(o.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=a.radius);const c=(d=i.userData._normalsCaptureMap)==null?void 0:d.texture;this.normalsCaptureMap!==c&&(this.normalsCaptureMap=c),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}constructor(e){super({side:p.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
#include <morphtarget_pars_vertex>
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#ifndef USE_INSTANCING
uniform mat4 modelOffsetMatrixInv;
#endif
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#ifdef USE_MORPHTARGETS
vCenterOffset=transformed;
#include <morphtarget_vertex>
vCenterOffset=transformed-vCenterOffset;
#ifndef USE_INSTANCING
vCenterOffset=(modelOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#ifdef USE_MORPHTARGETS
vCenterOffset=(vModelInstanceOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#define CENTER_OFFSET  (centerOffset + vCenterOffset)
#else
#define CENTER_OFFSET  (centerOffset) 
#endif
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform vec4 envMapRotationQuat;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;vec3 t=2.*cross(envMapRotationQuat.xyz,direction);direction+=envMapRotationQuat.w*t+cross(envMapRotationQuat.xyz,t);
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},envMapRotationQuat:{value:new p._fP},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new p.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new p.Pa4(1,1,1)}}}),this.typeSlug=ki.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new p.Ilk(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.envMapRotationOffsetX=0,this.envMapRotationOffsetY=0,this.envMapRotationOffsetZ=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new p.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new p.yGw().identity()},radius:{value:1},centerOffset:{value:new p.Pa4(0,0,0)},modelOffsetMatrix:{value:new p.yGw().identity()},modelOffsetMatrixInv:{value:new p.yGw().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=rs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...rs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){rs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+rs.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate",frameFade:e==null?void 0:e.last}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=(e=this.uniforms.envMap.value)!=null&&e.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){return this.__envMap[this.envMapIndex]??this.__envMap[0]??null}set envMap(e){console.error("Setting separate envmap for indivisual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const t={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.envMapIndex=this.envMapIndex,t.envMapRotationOffset=this.envMapRotationOffset,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=ki.TYPE,t.userData={},qi(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(t=>({label:"env"+(t+1),value:t}))},...Da(this),{type:"input",label:"Mesh count",get value(){var t,n;return((n=(t=e.userData)==null?void 0:t.__appliedMeshes)==null?void 0:n.size)??0},set value(t){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(t){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{const t=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,V.downloadBlob)(t,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(t=>{var n;return(n=t.getUiConfig)==null?void 0:n.call(t,this)})].filter(t=>t),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==ki.TYPE)return console.warn("Material type is not supported",e),this;const t={},n=Array.from(Object.keys(Ef));(0,V.copyProps)(e,t,n);const i=t.userData;return delete t.userData,this.setValues(t),qi(this.userData,i),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}ki.TypeSlug="dmat",ki.TYPE="DiamondMaterial",cs([Zo("Color",{limitedUi:!0}),Fe()],ki.prototype,"color",void 0),cs([cn("Env Intensity",[0,5],.01,{limitedUi:!0}),Fe()],ki.prototype,"envMapIntensity",void 0),cs([cn("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,V.onChange2)(ki.prototype.setDirty)],ki.prototype,"envMapRotationOffset",void 0),cs([cn("Env Rotation Offset X",[-Math.PI,Math.PI],.01),(0,V.onChange2)(ki.prototype.setDirty)],ki.prototype,"envMapRotationOffsetX",void 0),cs([cn("Env Rotation Offset Y",[-Math.PI,Math.PI],.01),(0,V.onChange2)(ki.prototype.setDirty)],ki.prototype,"envMapRotationOffsetY",void 0),cs([cn("Env Rotation Offset Z",[-Math.PI,Math.PI],.01),(0,V.onChange2)(ki.prototype.setDirty)],ki.prototype,"envMapRotationOffsetZ",void 0),cs([cn("Dispersion",[0,.1],1e-4,{limitedUi:!0}),Fe({propKey:"rIndexDelta"})],ki.prototype,"dispersion",void 0),cs([cn("Absorption",[0,15],.01,{limitedUi:!0}),Fe()],ki.prototype,"absorptionFactor",void 0),cs([cn("Refractive Index",[0,4],.01,{limitedUi:!0}),Fe()],ki.prototype,"refractiveIndex",void 0),cs([Fe()],ki.prototype,"squashFactor",void 0),cs([Fe()],ki.prototype,"geometryFactor",void 0),cs([cn("Gamma",[.1,4],.01,{limitedUi:!0}),Fe()],ki.prototype,"gammaFactor",void 0),cs([As("RGB Boost",void 0,void 0,{limitedUi:!0}),Fe()],ki.prototype,"boostFactors",void 0),cs([cn("Transmission",[0,1],.01,{limitedUi:!0}),Fe()],ki.prototype,"transmission",void 0),cs([cn("Reflectivity",[0,2],.01,{limitedUi:!0}),Fe()],ki.prototype,"reflectivity",void 0),cs([se("RAY_BOUNCES",void 0,!0),cn("Ray Bounces",[1,16],1)],ki.prototype,"rayBounces",void 0),cs([se("DIA_ORIENT_ENVMAP",void 0,!0),cn("Diamond Oriented Lighting",[0,1],1)],ki.prototype,"diamondOrientedEnvMap",void 0),cs([Fe({propKey:"tCubeMapNormals"})],ki.prototype,"normalsCaptureMap",void 0),cs([(0,V.onChange)(ki.prototype.refreshEnvUniform)],ki.prototype,"envMapIndex",void 0);var Sf=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class br extends En{get envMapRotation(){var e;return((e=this.envMap)==null?void 0:e.rotation)??0}set envMapRotation(e){var n;const t=[this.envMap,this.envMap2,this.envMap3];for(const i of t)i&&(i.rotation=e,(n=this._viewer)==null||n.scene.setDirty())}refreshEnvMaps(){var n,i,o;if(!this._viewer)return;const e=this.getEnvMaps(),t=((i=(n=this._viewer.getPlugin(Qt))==null?void 0:n.materials)==null?void 0:i.getMaterialsOfType(ki.TypeSlug))||[];for(const a of t)a&&(a.envMaps=e);(o=this._viewer)==null||o.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var t;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const e=((t=this._viewer)==null?void 0:t.scene.getEnvironment())||null;return[e,e,e]},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse(i=>{var a,c,u,d;const o=(c=(a=i.userData)==null?void 0:a.gltfExtensions)==null?void 0:c[br.DIAMOND_GLTF_EXTENSION];o&&i.geometry&&(this.prepareDiamondMesh(i,o),delete i.userData.gltfExtensions[br.DIAMOND_GLTF_EXTENSION]),i.material&&!n.includes(i.material)&&((d=(u=i.material.userData)==null?void 0:u.gltfExtensions)!=null&&d[br.DIAMOND_GLTF_EXTENSION])&&(i.material.materialObject||console.warn("material not processed",i.material),n.push(i.material))}),n.forEach(i=>{const o=i.userData.gltfExtensions[br.DIAMOND_GLTF_EXTENSION];o&&this._convertToDiamondMaterial(i,o)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var t,n,i;const e=(i=(n=(t=this._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject())==null?void 0:i.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==Hs.TypeSlug},value:async()=>{var a,c,u,d,m,g;const e=(c=(a=this._viewer)==null?void 0:a.getPlugin(Ti))==null?void 0:c.getSelectedObject();if(!(e!=null&&e.material))return;const t=await((u=this._viewer)==null?void 0:u.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1)),n=(await((d=this._viewer)==null?void 0:d.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512").toLowerCase(),i=n.endsWith("high")?"high":n.endsWith("low")?"low":"medium";let o=parseInt(n);isFinite(o)||(o=512),o<64&&(o=64),((m=e.material.userData)==null?void 0:m.__appliedMeshes.size)>1&&await((g=this._viewer)==null?void 0:g.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(e.material,{cacheKey:t||void 0,normalMapRes:o,normalMapPrecision:i},{}):this.makeDiamondMesh(e,{cacheKey:t||void 0,normalMapRes:o,normalMapPrecision:i},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var t,n,i;const e=(i=(n=(t=this._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject())==null?void 0:i.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==ki.TypeSlug},value:async()=>{var o,a,c,u,d,m,g,_;const e=(a=(o=this._viewer)==null?void 0:o.getPlugin(Ti))==null?void 0:a.getSelectedObject(),t=e==null?void 0:e.material;if(!t)return;const n=t.userData._baseMaterial;let i=(d=(u=(c=this._viewer)==null?void 0:c.getManager())==null?void 0:u.materials)==null?void 0:d.findMaterial(n);if(i&&!i.isDiamondMaterial||(i=(m=this._viewer)==null?void 0:m.createPhysicalMaterial({color:t.color})),i){const w=t.userData.__appliedMeshes.size>1&&await((g=this._viewer)==null?void 0:g.confirm("Convert all with this material?"))?Array.from(t.userData.__appliedMeshes):[e];for(const x of w)(_=x==null?void 0:x.setMaterial)==null||_.call(x,i)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var t,n,i,o;const e=(i=(n=(t=this._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject())==null?void 0:i.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==ki.TypeSlug||((o=e.userData.__appliedMeshes)==null?void 0:o.size)<2},value:async()=>{var n,i;const e=(i=(n=this._viewer)==null?void 0:n.getPlugin(Ti))==null?void 0:i.getSelectedObject();if(!e)return;const t=e.material;t&&!Array.isArray(t)&&bd(t)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,t,n;(e=this._viewer)==null||e.setDirty(),(n=(t=this.uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0)}async onAdded(e){var o,a,c,u,d,m,g;this._normalCapture=new Mu(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",_=>{var w,x,T,I;if((w=_.material)!=null&&w.isDiamondMaterial){const R=_.material,M=_.mesh||_.object;if(M.geometry&&!((x=this._normalCapture)!=null&&x.hasCapturedNormalMap(M))){const L=((I=(T=R==null?void 0:R.userData)==null?void 0:T.gltfExtensions)==null?void 0:I[br.DIAMOND_GLTF_EXTENSION])??{};L.cacheKey===void 0&&!M.userData._diamondCacheKey&&(R!=null&&R.name)&&(L.cacheKey=R.name),this.prepareDiamondMesh(M,L)}const C=this.getEnvMaps();R.envMaps=C}}),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const t=e.getPlugin(Qt);(o=t==null?void 0:t.importer)==null||o.processors.add("model",this._modelProcessor),(a=e.getPlugin(Ti))==null||a.addEventListener("selectedObjectChanged",this.refreshUi);const n=this.getEnvMaps,i=new Br(class extends Jn{async loadAsync(_,w){var T;const x=await super.loadAsync(_,w);return x.type===ki.TYPE||x.isDiamondMaterialParameters?(x.envMap=n(),(T=t==null?void 0:t.materials)==null?void 0:T.generateFromTemplate("diamond",x)):(console.error("Invalid material type for Diamond Material.",x),null)}},[ki.TypeSlug],!1);return(c=t==null?void 0:t.importer)==null||c.Importers.push(i),(m=(d=(u=t==null?void 0:t.exporter)==null?void 0:u.getExporter("gltf","glb"))==null?void 0:d.extensions)==null||m.push(Hb),(g=t==null?void 0:t.materials)==null||g.registerMaterialTemplate({name:"diamond",materialType:ki.TYPE,isDiamondMaterialParameters:!0,generator:(_,w)=>{const x=!(w!=null&&w.metadata||!w.isDiamondMaterialParameters)||(w==null?void 0:w.metadata)&&(w==null?void 0:w.metadata.version)<=4.5,T=w==null?void 0:w.color;x&&typeof w.color=="number"&&(w.color=new p.Ilk().setHex(w.color,p.GUF).getHex());const I=new ki(_);return I.envMaps=this.getEnvMaps(),w&&I.copyProps(w),w.color=T,I}}),super.onAdded(e)}async onRemove(e){var t,n,i,o;return(t=this._normalCapture)==null||t.dispose(),this._normalCapture=void 0,this.offsetCache={},(i=(n=e.getPlugin(Qt))==null?void 0:n.importer)==null||i.processors.remove("model",this._modelProcessor),(o=e.getPlugin(Ti))==null||o.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n,normalMapPrecision:i}){var c,u;e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=n??e.userData._diamondNormalMapRes,e.userData._diamondNormalMapPrecision=i??e.userData._diamondNormalMapPrecision,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const o=((c=this._normalCapture)==null?void 0:c.captureNormalMap(e.geometry,t,n,i,e))??[void 0,!1],a=(u=this._viewer)==null?void 0:u.getPluginByType("debug");a&&o&&(a.counters.normalsCapture||(a.counters.normalsCapture=0),a.counters.normalsCapture++,console.log("DEBUG: new normal map captured",a.counters.normalsCapture,t),a.addTexture("normal"+a.counters.normalsCapture,()=>{var d,m;return(m=(d=e.geometry)==null?void 0:d.userData._normalsCaptureMap)==null?void 0:m.texture},[40,110*a.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){var i;Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(o=>{o!=null&&o.isMesh&&o.geometry&&this.prepareDiamondMesh(o,t)}),this._convertToDiamondMaterial(e,n),(i=this._viewer)==null||i.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const i=Array.isArray(e.material)?e.material[0]:e.material,o=this._convertToDiamondMaterial(i,n,!1);e.setMaterial(o)}_convertToDiamondMaterial(e,t={isDiamond:!0},n=!0){var a,c,u;let i={...t??{}};i.isDiamond||i.isDiamondMaterialParameters?Array.isArray(i.boostFactors)&&(i.boostFactors=new p.Pa4().fromArray(i.boostFactors)):i={isDiamondMaterialParameters:!0},i.color=i.color??(e==null?void 0:e.color)??new p.Ilk(1,1,1),i.name=i.name??(e==null?void 0:e.name)??"diamond";const o=(u=(c=(a=this._viewer)==null?void 0:a.getManager())==null?void 0:c.materials)==null?void 0:u.generateFromTemplate("diamond",i);if(o&&e&&!e.isDiamondMaterial&&(o.userData._baseMaterial=e.uuid),n){const d=m=>m.setMaterial??(g=>{m.material=g.materialObject});Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(m=>{d(m)(o),this.prepareDiamondMesh(m,t)})}return o}_computeOffsets(e,t,n=!1){var m;if(e.userData.normalsCaptureOffsets){if((0,V.getUrlQueryParam)("recomputeOffsets")===null)return e.userData.normalsCaptureOffsets;console.warn("recomputeOffsets",e.userData.normalsCaptureOffsets)}let i;(m=e.morphAttributes)!=null&&m.position&&(i=e.morphAttributes,e.morphAttributes={}),e.computeBoundingBox();const o=e.boundingBox.getCenter(new p.Pa4).toArray(),a=tg(e).toArray(),c=new p.yGw().fromArray(a).invert(),u=new p.Pa4().fromArray(o).applyMatrix4(c).toArray(),d={center:o,offsetMatrix:a,offsetMatrixInv:c.toArray(),radius:1,centerOffset:u};return e.userData.normalsCaptureOffsets=d,i&&(e.morphAttributes=i,e.computeBoundingBox()),(0,V.getUrlQueryParam)("recomputeOffsets")!==null&&console.warn("recomputeOffsets",d),d}disposeCacheMap(e){var t;(t=this._normalCapture)==null||t.disposeTarget(e)}disposeAllCacheMaps(){var e;(e=this._normalCapture)==null||e.disposeAllTargets()}}br.PluginType="Diamond",br.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Sf([(0,V.onChange)(br.prototype.refreshEnvMaps),Ae()],br.prototype,"envMap",void 0),Sf([(0,V.onChange)(br.prototype.refreshEnvMaps),Ae()],br.prototype,"envMap2",void 0),Sf([(0,V.onChange)(br.prototype.refreshEnvMaps),Ae()],br.prototype,"envMap3",void 0),Sf([(0,V.onChange)(br.prototype.refreshEnvMaps),Ae()],br.prototype,"forceSceneEnvMap",void 0);const Hb=s=>({writeMaterial:(e,t)=>{e.isDiamondMaterial&&(t.extensions=t.extensions||{},t.extensions[br.DIAMOND_GLTF_EXTENSION]=e.toJSON(),s.extensionsUsed[br.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,t)=>{var i,o;if(!(e!=null&&e.material.isDiamondMaterial))return;t.extensions=t.extensions||{};const n={};(o=(i=e.userData)==null?void 0:i.gltfExtensions)==null||delete o[br.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(n.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondNormalMapPrecision&&(n.normalMapPrecision=e.userData._diamondNormalMapPrecision),e.userData._diamondCacheKey&&(n.cacheKey=e.userData._diamondCacheKey),t.extensions[br.DIAMOND_GLTF_EXTENSION]=n,s.extensionsUsed[br.DIAMOND_GLTF_EXTENSION]=!0}});class Cf{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:n=1,scale:i=1}){var u,d,m;const o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");o.width=t.width*i*n,o.height=t.height*i*n,t.assumeClientRect&&(t.x*=e.width/(n*e.clientWidth),t.y*=e.height/(n*e.clientHeight),t.width*=e.width/(n*e.clientWidth),t.height*=e.height/(n*e.clientHeight));const a=o.getContext("2d");if(!a)return console.error("snapshot: cannot create context"),o;const c=e.style.background||((u=e.parentElement)==null?void 0:u.style.background)||"";if(c.includes("url")){const g=(d=/url\("(.*)"\)/gi.exec(c))==null?void 0:d[1];if(g){const _=new Image;_.src=g,await new Promise((w,x)=>{_.onload=()=>w(),_.onerror=()=>x(),_.complete&&w()}),a.drawImage(_,_.width*t.x*n/e.width,_.height*t.y*n/e.height,_.width*t.width*n/e.width,_.height*t.height*n/e.height,0,0,o.width,o.height)}}else a.fillStyle=e.style.background||((m=e.parentElement)==null?void 0:m.style.backgroundColor)||"#00000000",a.fillRect(0,0,o.width,o.height);return a==null||a.drawImage(e,t.x*n,t.y*n,t.width*n,t.height*n,0,0,o.width,o.height),this.Debug&&(document.body.appendChild(o),o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.borderWidth="2px",o.style.borderColor="#ff00ff",setTimeout(()=>o.remove(),5e3)),o}static async GetDataUrl(e,{mimeType:t="image/png",...n}){const i=await this.GetClonedCanvas(e,n),o=i.toDataURL(t);return this.Debug||i.remove(),o}static async GetImage(e,{mimeType:t="image/png",...n}={}){const i=await this.GetDataUrl(e,n);return new Promise((o,a)=>{const c=new Image;c.onload=()=>{o(c)},c.src=i})}static async GetBlob(e,t={}){const n=await this.GetClonedCanvas(e,t),i=await new Promise((o,a)=>{n.toBlob(c=>{c?o(c):a()},t.mimeType??"image/png")});return this.Debug||n.remove(),i}static async GetFile(e,t="image.png",n={}){return n.getDataUrl?await this.GetDataUrl(e,n):new File([await this.GetBlob(e,n)],t,{type:n.mimeType??"image/png",lastModified:(0,V.now)()})}}Cf.Debug=!1;var Mf=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ul=class extends En{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(s,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(s||this.filename,e)}async getDataUrl(s={}){return s.getDataUrl=!0,await this._getFile("",s)??""}async _getFile(s,e={}){var n,i;const t=(n=this._viewer)==null?void 0:n.canvas;if(t){const o=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==o&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const a=(i=this._viewer)==null?void 0:i.getPlugin(oo);if(e.waitForProgressive&&a&&e.timeout===void 0)for(;!a.isConverged(!0);)await(0,V.timeout)(64);else await(0,V.timeout)(e.timeout??200);e.displayPixelRatio=1;const c=await Cf.GetFile(t,s,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=o,c}}async downloadSnapshot(s,e={waitForProgressive:!0}){const t=await this.getFile(s,e);t&&await this._downloadBlob(t,t.name)}async _downloadBlob(s,e){var n,i;const t=(n=this._viewer)==null?void 0:n.getPluginByType("FileTransferPlugin");t?await t.exportFile(s,e):(i=this._viewer)==null||i.console.error("FileTransferPlugin required to export/download file")}};Ul.PluginType="CanvasSnipper",Mf([jn("Filename"),Ae()],Ul.prototype,"filename",void 0),Mf([Ai("Download .png",{limitedUi:!0})],Ul.prototype,"downloadSnapshot",null),Ul=Mf([Hn("Image Export")],Ul);var Tf=function(s){return function(e){return 1-s(1-e)}},ng=function(s){return function(e){return e<=.5?s(2*e)/2:(2-s(2*(1-e)))/2}},iy=function(s){return function(e){return Math.pow(e,s)}},i_=function(s){return function(e){return e*e*((s+1)*e-s)}},Qb=function(s){var e=i_(s);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},r_=function(s){return s},Tu=iy(2),ry=Tf(Tu),ig=ng(Tu),Ph=function(s){return 1-Math.sin(Math.acos(s))},s_=Tf(Ph),Wb=ng(s_),rp=i_(1.525),sp=Tf(rp),op=ng(rp),sy=Qb(1.525),Rh=function(s){if(s===1||s===0)return s;var e=s*s;return s<.36363636363636365?7.5625*e:s<.7272727272727273?9.075*e-9.9*s+3.4:s<.9?12.066481994459833*e-19.63545706371191*s+8.898060941828255:10.8*s*s-20.52*s+10.72},oy=Tf(Rh),qb=function(s){return s<.5?.5*(1-Rh(1-2*s)):.5*Rh(2*s-1)+.5},Ir=function(){return Ir=Object.assign||function(s){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},Ir.apply(this,arguments)};function If(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(n=Object.getOwnPropertySymbols(s);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(t[n[i]]=s[n[i]])}return t}var o_=function(){},Xs=function(s,e,t){return Math.min(Math.max(t,s),e)},a_=.001,Xb=.01,Yb=10,ay=.05,l_=1,Dh=12;function c_(s,e){return s*Math.sqrt(1-e*e)}var Kb=["duration","bounce"],qc=["stiffness","damping","mass"];function ly(s,e){return e.some(function(t){return s[t]!==void 0})}function Pf(s){var e=s.from,t=e===void 0?0:e,n=s.to,i=n===void 0?1:n,o=s.restSpeed,a=o===void 0?2:o,c=s.restDelta,u=If(s,["from","to","restSpeed","restDelta"]),d={done:!1,value:t},m=function(L){var k=Ir({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},L);if(!ly(L,qc)&&ly(L,Kb)){var j=function(H){var X,ee,oe=H.duration,re=oe===void 0?800:oe,he=H.bounce,le=he===void 0?.25:he,ue=H.velocity,ge=ue===void 0?0:ue,_e=H.mass,Ee=_e===void 0?1:_e,Ye=1-le;Ye=Xs(ay,l_,Ye),re=Xs(Xb,Yb,re/1e3),Ye<1?(X=function(lt){var rt=lt*Ye,kt=rt*re,Pt=rt-ge,sn=c_(lt,Ye),hn=Math.exp(-kt);return a_-Pt/sn*hn},ee=function(lt){var rt=lt*Ye*re,kt=rt*ge+ge,Pt=Math.pow(Ye,2)*Math.pow(lt,2)*re,sn=Math.exp(-rt),hn=c_(Math.pow(lt,2),Ye);return(-X(lt)+a_>0?-1:1)*((kt-Pt)*sn)/hn}):(X=function(lt){return Math.exp(-lt*re)*((lt-ge)*re+1)-a_},ee=function(lt){return Math.exp(-lt*re)*(re*re*(ge-lt))});var We=function(lt,rt,kt){for(var Pt=kt,sn=1;sn<Dh;sn++)Pt-=lt(Pt)/rt(Pt);return Pt}(X,ee,5/re);if(re*=1e3,isNaN(We))return{stiffness:100,damping:10,duration:re};var Et=Math.pow(We,2)*Ee;return{stiffness:Et,damping:2*Ye*Math.sqrt(Ee*Et),duration:re}}(L);(k=Ir(Ir(Ir({},k),j),{velocity:0,mass:1})).isResolvedFromDuration=!0}return k}(u),g=m.stiffness,_=m.damping,w=m.mass,x=m.velocity,T=m.duration,I=m.isResolvedFromDuration,R=cy,M=cy;function C(){var L=x?-x/1e3:0,k=i-t,j=_/(2*Math.sqrt(g*w)),H=Math.sqrt(g/w)/1e3;if(c!=null||(c=Math.abs(i-t)<=1?.01:.4),j<1){var X=c_(H,j);R=function(oe){var re=Math.exp(-j*H*oe);return i-re*((L+j*H*k)/X*Math.sin(X*oe)+k*Math.cos(X*oe))},M=function(oe){var re=Math.exp(-j*H*oe);return j*H*re*(Math.sin(X*oe)*(L+j*H*k)/X+k*Math.cos(X*oe))-re*(Math.cos(X*oe)*(L+j*H*k)-X*k*Math.sin(X*oe))}}else if(j===1)R=function(oe){return i-Math.exp(-H*oe)*(k+(L+H*k)*oe)};else{var ee=H*Math.sqrt(j*j-1);R=function(oe){var re=Math.exp(-j*H*oe),he=Math.min(ee*oe,300);return i-re*((L+j*H*k)*Math.sinh(he)+ee*k*Math.cosh(he))/ee}}}return C(),{next:function(L){var k=R(L);if(I)d.done=L>=T;else{var j=1e3*M(L),H=Math.abs(j)<=a,X=Math.abs(i-k)<=c;d.done=H&&X}return d.value=d.done?i:k,d},flipTarget:function(){var L;x=-x,t=(L=[i,t])[0],i=L[1],C()}}}Pf.needsInterpolation=function(s,e){return typeof s=="string"||typeof e=="string"};var cy=function(s){return 0},rg=function(s,e,t){var n=e-s;return n===0?1:(t-s)/n},Bh=function(s,e,t){return-t*s+t*e+s},sg=function(s,e){return function(t){return Math.max(Math.min(t,e),s)}},Rf=function(s){return s%1?Number(s.toFixed(5)):s},og=/(-)?([\d]*\.?[\d])+/g,uy=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,nE=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function ap(s){return typeof s=="string"}var u_={test:function(s){return typeof s=="number"},parse:parseFloat,transform:function(s){return s}},Jb=Ir(Ir({},u_),{transform:sg(0,1)}),cl=(Ir(Ir({},u_),{default:1}),function(s,e){return function(t){return!!(ap(t)&&nE.test(t)&&t.startsWith(s)||e&&Object.prototype.hasOwnProperty.call(t,e))}}),ag=function(s,e,t){return function(n){var i;if(!ap(n))return n;var o=n.match(og),a=o[0],c=o[1],u=o[2],d=o[3];return(i={})[s]=parseFloat(a),i[e]=parseFloat(c),i[t]=parseFloat(u),i.alpha=d!==void 0?parseFloat(d):1,i}},Zb=sg(0,255),lg=Ir(Ir({},u_),{transform:function(s){return Math.round(Zb(s))}}),Iu={test:cl("rgb","red"),parse:ag("red","green","blue"),transform:function(s){var e=s.red,t=s.green,n=s.blue,i=s.alpha,o=i===void 0?1:i;return"rgba("+lg.transform(e)+", "+lg.transform(t)+", "+lg.transform(n)+", "+Rf(Jb.transform(o))+")"}},cg={test:cl("#"),parse:function(s){var e="",t="",n="",i="";return s.length>5?(e=s.substr(1,2),t=s.substr(3,2),n=s.substr(5,2),i=s.substr(7,2)):(e=s.substr(1,1),t=s.substr(2,1),n=s.substr(3,1),i=s.substr(4,1),e+=e,t+=t,n+=n,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}},transform:Iu.transform},hy=function(s){return{test:function(e){return ap(e)&&e.endsWith(s)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+s}}},lp=hy("%"),cp=(Ir(Ir({},lp),{parse:function(s){return lp.parse(s)/100},transform:function(s){return lp.transform(100*s)}}),{test:cl("hsl","hue"),parse:ag("hue","saturation","lightness"),transform:function(s){var e=s.hue,t=s.saturation,n=s.lightness,i=s.alpha,o=i===void 0?1:i;return"hsla("+Math.round(e)+", "+lp.transform(Rf(t))+", "+lp.transform(Rf(n))+", "+Rf(Jb.transform(o))+")"}}),$b=function(s,e,t){var n=s*s,i=e*e;return Math.sqrt(Math.max(0,t*(i-n)+n))},ug=[cg,Iu,cp],Df=function(s){return ug.find(function(e){return e.test(s)})},hg=function(s,e){var t=Df(s),n=Df(e);if(o_(t.transform===n.transform),!t||!n||t.transform!==n.transform)return function(u){return""+(u>0?e:s)};var i=t.parse(s),o=n.parse(e),a=Ir({},i),c=t===cp?Bh:$b;return function(u){for(var d in a)d!=="alpha"&&(a[d]=c(i[d],o[d],u));return a.alpha=Bh(i.alpha,o.alpha,u),t.transform(a)}},dg={test:function(s){return Iu.test(s)||cg.test(s)||cp.test(s)},parse:function(s){return Iu.test(s)?Iu.parse(s):cp.test(s)?cp.parse(s):cg.parse(s)},transform:function(s){return ap(s)?s:s.hasOwnProperty("red")?Iu.transform(s):cp.transform(s)}},pg="${c}",dy="${n}";function h_(s){typeof s=="number"&&(s=""+s);var e=[],t=0,n=s.match(uy);n&&(t=n.length,s=s.replace(uy,pg),e.push.apply(e,n.map(dg.parse)));var i=s.match(og);return i&&(s=s.replace(og,dy),e.push.apply(e,i.map(u_.parse))),{values:e,numColors:t,tokenised:s}}function d_(s){return h_(s).values}function p_(s){var e=h_(s),t=e.values,n=e.numColors,i=e.tokenised,o=t.length;return function(a){for(var c=i,u=0;u<o;u++)c=c.replace(u<n?pg:dy,u<n?dg.transform(a[u]):Rf(a[u]));return c}}var py=function(s){return typeof s=="number"?0:s},fy={test:function(s){var e,t,n,i;return isNaN(s)&&ap(s)&&((t=(e=s.match(og))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((i=(n=s.match(uy))===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0)>0},parse:d_,createTransformer:p_,getAnimatableNone:function(s){var e=d_(s);return p_(s)(e.map(py))}},fg={x:0,y:0,z:0},Oh=function(s){return typeof s=="number"},mg=function(s,e){return function(t){return e(s(t))}},up=function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return s.reduce(mg)};function Lh(s,e){return Oh(s)?function(t){return Bh(s,e,t)}:dg.test(s)?hg(s,e):Lf(s,e)}var Bf=function(s,e){var t=function(o,a,c){if(c||arguments.length===2)for(var u,d=0,m=a.length;d<m;d++)!u&&d in a||(u||(u=Array.prototype.slice.call(a,0,d)),u[d]=a[d]);return o.concat(u||Array.prototype.slice.call(a))}([],s),n=t.length,i=s.map(function(o,a){return Lh(o,e[a])});return function(o){for(var a=0;a<n;a++)t[a]=i[a](o);return t}},Pu=function(s,e){var t=Ir(Ir({},s),e),n={};for(var i in t)s[i]!==void 0&&e[i]!==void 0&&(n[i]=Lh(s[i],e[i]));return function(o){for(var a in n)t[a]=n[a](o);return t}};function Of(s){for(var e=fy.parse(s),t=e.length,n=0,i=0,o=0,a=0;a<t;a++)n||typeof e[a]=="number"?n++:e[a].hue!==void 0?o++:i++;return{parsed:e,numNumbers:n,numRGB:i,numHSL:o}}var Lf=function(s,e){var t=fy.createTransformer(e),n=Of(s),i=Of(e);return n.numHSL===i.numHSL&&n.numRGB===i.numRGB&&n.numNumbers>=i.numNumbers?up(Bf(n.parsed,i.parsed),t):function(o){return""+(o>0?e:s)}},f_=function(s,e){return function(t){return Bh(s,e,t)}};function gg(s,e,t){var n=t===void 0?{}:t,i=n.clamp,o=i===void 0||i,a=n.ease,c=n.mixer,u=s.length;o_(u===e.length),o_(!a||!Array.isArray(a)||a.length===u-1),s[0]>s[u-1]&&(s=[].concat(s),e=[].concat(e),s.reverse(),e.reverse());var d=function(g,_,w){for(var x=[],T=w||(typeof(L=g[0])=="number"?f_:typeof L=="string"?dg.test(L)?hg:Lf:Array.isArray(L)?Bf:typeof L=="object"?Pu:void 0),I=g.length-1,R=0;R<I;R++){var M=T(g[R],g[R+1]);if(_){var C=Array.isArray(_)?_[R]:_;M=up(C,M)}x.push(M)}var L;return x}(e,a,c),m=u===2?function(g,_){var w=g[0],x=g[1],T=_[0];return function(I){return T(rg(w,x,I))}}(s,d):function(g,_){var w=g.length,x=w-1;return function(T){var I=0,R=!1;if(T<=g[0]?R=!0:T>=g[x]&&(I=x-1,R=!0),!R){for(var M=1;M<w&&!(g[M]>T||M===x);M++);I=M-1}var C=rg(g[I],g[I+1],T);return _[I](C)}}(s,d);return o?function(g){return m(Xs(s[0],s[u-1],g))}:m}function m_(s,e){return s.map(function(){return e||ig}).splice(0,s.length-1)}function kf(s){var e=s.from,t=e===void 0?0:e,n=s.to,i=n===void 0?1:n,o=s.ease,a=s.offset,c=s.duration,u=c===void 0?300:c,d={done:!1,value:t},m=Array.isArray(i)?i:[t,i],g=function(x,T){return x.map(function(I){return I*T})}(a&&a.length===m.length?a:function(x){var T=x.length;return x.map(function(I,R){return R!==0?R/(T-1):0})}(m),u);function _(){return gg(g,m,{ease:Array.isArray(o)?o:m_(m,o)})}var w=_();return{next:function(x){return d.value=w(x),d.done=x>=u,d},flipTarget:function(){m.reverse(),w=_()}}}function kh(s){var e=s.velocity,t=e===void 0?0:e,n=s.from,i=n===void 0?0:n,o=s.power,a=o===void 0?.8:o,c=s.timeConstant,u=c===void 0?350:c,d=s.restDelta,m=d===void 0?.5:d,g=s.modifyTarget,_={done:!1,value:i},w=a*t,x=i+w,T=g===void 0?x:g(x);return T!==x&&(w=T-i),{next:function(I){var R=-w*Math.exp(-I/u);return _.done=!(R>m||R<-m),_.value=_.done?T:T+R,_},flipTarget:function(){}}}var my={keyframes:kf,spring:Pf,decay:kh},Uh=1/60*1e3,vg=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},ew=typeof window<"u"?function(s){return window.requestAnimationFrame(s)}:function(s){return setTimeout(function(){return s(vg())},Uh)},gy=!0,_g=!1,vy=!1,yg={delta:0,timestamp:0},g_=["read","update","preRender","render","postRender"],_y=g_.reduce(function(s,e){return s[e]=function(t){var n=[],i=[],o=0,a=!1,c=new WeakSet,u={schedule:function(d,m,g){m===void 0&&(m=!1),g===void 0&&(g=!1);var _=g&&a,w=_?n:i;return m&&c.add(d),w.indexOf(d)===-1&&(w.push(d),_&&a&&(o=n.length)),d},cancel:function(d){var m=i.indexOf(d);m!==-1&&i.splice(m,1),c.delete(d)},process:function(d){var m;if(a=!0,n=(m=[i,n])[0],(i=m[1]).length=0,o=n.length)for(var g=0;g<o;g++){var _=n[g];_(d),c.has(_)&&(u.schedule(_),t())}a=!1}};return u}(function(){return _g=!0}),s},{}),yy=g_.reduce(function(s,e){var t=_y[e];return s[e]=function(n,i,o){return i===void 0&&(i=!1),o===void 0&&(o=!1),_g||Kr(),t.schedule(n,i,o)},s},{}),iE=g_.reduce(function(s,e){return s[e]=_y[e].cancel,s},{}),Uf=function(s){return _y[s].process(yg)},tw=function(s){_g=!1,yg.delta=gy?Uh:Math.max(Math.min(s-yg.timestamp,40),1),yg.timestamp=s,vy=!0,g_.forEach(Uf),vy=!1,_g&&(gy=!1,ew(tw))},Kr=function(){_g=!0,gy=!0,vy||ew(tw)},Ag=function(){return yg},nw=yy;function bg(s,e,t){return t===void 0&&(t=0),s-e-t}var v_=function(s){var e=function(t){var n=t.delta;return s(n)};return{start:function(){return nw.update(e,!0)},stop:function(){return iE.update(e)}}};function Nh(s){var e,t,n,i,o,a=s.from,c=s.autoplay,u=c===void 0||c,d=s.driver,m=d===void 0?v_:d,g=s.elapsed,_=g===void 0?0:g,w=s.repeat,x=w===void 0?0:w,T=s.repeatType,I=T===void 0?"loop":T,R=s.repeatDelay,M=R===void 0?0:R,C=s.onPlay,L=s.onStop,k=s.onComplete,j=s.onRepeat,H=s.onUpdate,X=If(s,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),ee=X.to,oe=0,re=X.duration,he=!1,le=!0,ue=function(_e){if(Array.isArray(_e.to))return kf;if(my[_e.type])return my[_e.type];var Ee=new Set(Object.keys(_e));return Ee.has("ease")||Ee.has("duration")&&!Ee.has("dampingRatio")?kf:Ee.has("dampingRatio")||Ee.has("stiffness")||Ee.has("mass")||Ee.has("damping")||Ee.has("restSpeed")||Ee.has("restDelta")?Pf:kf}(X);!((t=(e=ue).needsInterpolation)===null||t===void 0)&&t.call(e,a,ee)&&(o=gg([0,100],[a,ee],{clamp:!1}),a=0,ee=100);var ge=ue(Ir(Ir({},X),{from:a,to:ee}));return u&&(C==null||C(),(n=m(function(_e){if(le||(_e=-_e),_+=_e,!he){var Ee=ge.next(Math.max(0,_));i=Ee.value,o&&(i=o(i)),he=le?Ee.done:_<=0}H==null||H(i),he&&(oe===0&&(re!=null||(re=_)),oe<x?function(Ye,We,Et,lt){return lt?Ye>=We+Et:Ye<=-Et}(_,re,M,le)&&(oe++,I==="reverse"?_=function(Ye,We,Et,lt){return Et===void 0&&(Et=0),lt===void 0&&(lt=!0),lt?bg(We+-Ye,We,Et):We-(Ye-We)+Et}(_,re,M,le=oe%2==0):(_=bg(_,re,M),I==="mirror"&&ge.flipTarget()),he=!1,j&&j()):(n.stop(),k&&k()))})).start()),{stop:function(){L==null||L(),n.stop()}}}const yc={linear:r_,easeIn:Tu,easeOut:ry,easeInOut:ig,circIn:Ph,circOut:s_,circInOut:Wb,backIn:rp,backOut:sp,backInOut:op,anticipate:sy,bounceOut:Rh,bounceIn:oy,bounceInOut:qb,easeInOutSine:function(s){return-(Math.cos(Math.PI*s)-1)/2}};function __(s,e,t){const n=s[e],i=()=>{typeof(s==null?void 0:s.setDirty)=="function"&&s.setDirty(),t==null||t()};return n.isVector3||n.isVector2||n.isVector4?o=>{n.copy(o),i()}:o=>{s[e]=o,i()}}function Nf(s){return typeof s!="boolean"}async function wg(s,e,t,n){e in s||console.error("invalid key",e,s);const i=__(s,e),o=s[e],a=c=>{var u;i(c),(u=t.onUpdate)==null||u.call(t,c)};if(Nf(o))return typeof t.to=="function"&&(t={...t,to:t.to(o,s)}),_a({...t,from:o,onUpdate:a},n);{const{duration:c}=t;return(0,V.timeout)(c??0).then(()=>a(t.to))}}async function _a(s,e){const t=s.onComplete,n=s.onStop,i=s.onEnd;return s={...s},new Promise((o,a)=>{s.onComplete=()=>{try{t==null||t()}catch(u){return i==null||i(),void a(u)}i==null||i(),o()},s.onStop=()=>{try{n==null||n()}catch(u){return i==null||i(),void a(u)}i==null||i(),o()};const c=Nh(s);e&&e.push(c)})}var Vr=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let iw=1,Ns=class{constructor(s,e,t,n,i){this.position=new p.Pa4,this.target=new p.Pa4,this.quaternion=new p._fP,this.up=new p.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=Ba(this.name,this),s&&(this.position=s),e&&(this.target=e),t&&(this.up=t),n&&(this.quaternion=n),i&&(this.snap=i),this.name="#view"+iw++}_nameChanged(){var s,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(s=this.uiConfig).uiRefresh)==null||e.call(s))}};Vr([Ae(),As()],Ns.prototype,"position",void 0),Vr([Ae(),As()],Ns.prototype,"target",void 0),Vr([Ae(),As()],Ns.prototype,"quaternion",void 0),Vr([Ae(),As()],Ns.prototype,"up",void 0),Vr([Ae(),jn()],Ns.prototype,"name",void 0),Vr([sh()],Ns.prototype,"snap",void 0),Vr([Ai()],Ns.prototype,"focusView",void 0),Vr([Ai()],Ns.prototype,"deleteView",void 0),Vr([Ai()],Ns.prototype,"updateView",void 0),Ns=Vr([_s("CameraView")],Ns);class lr extends En{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Da(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const n=(t=this._viewer)==null?void 0:t.scene.activeCamera;if(!n)return;const i=new p.$V,o=n.position,a=n.target,c=new p._fP().setFromUnitVectors(n.cameraObject.up,new p.Pa4(0,1,0)),u=c.clone().invert(),d=o.clone().sub(a);d.applyQuaternion(c),i.setFromVector3(d),i.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,i.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,i.makeSafe(),d.setFromSpherical(i),d.applyQuaternion(u),o.copy(a).add(d),n.positionUpdated(!1),n.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",n=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var i,o;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))==null||i.enable(lr.PluginType),this._fadeDisabled=!1));const e=(0,V.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let t=e-this._lastFrameTime;this._lastFrameTime=e,t*=this.animateOnScroll?this._scrollAnimationState:1;const n=(o=this._viewer.getPluginByType("Progressive"))==null?void 0:o.postFrameConvergedRecordingDelta();if(n&&n>0&&(t=n),n!==0&&(t*=1e3,!(t<=0||(this._updaters.forEach(a=>{let c=t;a.time+c<0&&(c=-a.time),a.time+=c,Math.abs(c)>.001&&a.u(c)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const a=this._viewer.getPluginByType("FrameFade");a&&(a.disable(lr.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,V.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,V.timeout)(2))}async recordAllViews(e,t=!0){var i;if(!this.enabled)return;const n=(i=this._viewer)==null?void 0:i.getPluginByType("CanvasRecorder");if(n&&n.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!n.isRecording())return new Promise((o,a)=>{const c=()=>{n.removeEventListener("start",u),n.removeEventListener("stop",c),n.removeEventListener("error",d)},u=async()=>{var g;c(),e==null||e(),await this.animateAllViews();const m=await n.stopRecording();if(t){const _=await((g=this._viewer)==null?void 0:g.prompt("Canvas Recorder: Save file as","recording.mp4"));_!==null&&m&&await this._downloadBlob(m,_||"recording.mp4")}o(m)},d=async()=>{c(),a()};n.addEventListener("start",u),n.addEventListener("stop",c),n.addEventListener("error",d),n.startRecording()||console.error("cannot start recording")});console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var t,n;if(!this.enabled)return;const e=this.getCurrentCameraView();e.snap=await((n=(t=this._viewer)==null?void 0:t.getPlugin(Ul))==null?void 0:n.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(e)}addView(e){var t,n;this._cameraViews.push(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,t=!0,n){var m,g,_;if(e||(e=(m=this._viewer)==null?void 0:m.scene.activeCamera),!e)return new Ns;const i=new p.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const o=e.cameraObject.matrixWorld;i.x=o.elements[4],i.y=o.elements[5],i.z=o.elements[6],i.normalize();const a=e.target.clone(),c=e.position.clone(),u=e.cameraObject.parent;u&&(t?c.applyMatrix4(u.matrixWorld):i.transformDirection(u.matrixWorld.clone().invert()));const d=t?e.cameraObject.getWorldQuaternion(new p._fP):e.cameraObject.quaternion.clone();return n?(n.position.copy(c),n.target.copy(a),n.up.copy(i),n.quaternion.copy(d)):((n=new Ns(c,a,i,d,"")).focusView=async()=>n&&this.focusView(n),n.deleteView=()=>n&&this.deleteView(n),n.updateView=()=>this.getCurrentCameraView(e,t,n)),(_=(g=n.uiConfig).uiRefresh)==null||_.call(g,"postFrame",!0),n}setCurrentCameraView(e){var n;const t=(n=this._viewer)==null?void 0:n.scene.activeCamera;t&&(t.position.copy(e.position),t.target.copy(e.target),t.cameraObject.up.copy(e.up),t.cameraObject.quaternion.copy(e.quaternion),t.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var n,i;const t=this._cameraViews.indexOf(e);t>=0&&this._cameraViews.splice(t,1),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return(t=e==null?void 0:e.stop)==null?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await(0,V.timeout)(100)}async animateToView(e,t,n,i=!1){var m,g;const o=(m=this._viewer)==null?void 0:m.scene.activeCamera;if(!o)return;if(this._animating){this._popAnimations.forEach(w=>(w==null?void 0:w.stop)&&w.stop()),this._popAnimations=[];let _=0;for(;this._animating&&(await(0,V.timeout)(100),!(_++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),t===void 0&&(t=this.animDuration),t=Math.max(10,t);const a=typeof n=="function"?n:yc[n||this.animEase],c=this._driver,u=[];this._popAnimations=[];const d=this._popAnimations;if(this.interpolateMode==="spherical")u.push(async function(_,w,x,T,I,R,M){const C=_.target.clone(),L=new p.Pa4,k=new p.Pa4,j=_.cameraObject.parent,H=_.cameraObject.up.clone(),X=Ru({position:_.cameraObject.getWorldPosition(new p.Pa4),up:j?H.transformDirection(j.matrixWorld):H},C),ee=Ru(w,w.target),oe=new p.$V;function re(){_.position.copy(j?j.worldToLocal(k):k),_.target.copy(L),_.positionUpdated()}return _a({from:0,to:1,duration:x,ease:T,driver:I,onUpdate:he=>{oe.phi=Xc(X.phi,ee.phi,he),oe.theta=Xc(X.theta,ee.theta,he),oe.radius=p.M8C.lerp(X.radius,ee.radius,he),L.copy(C).lerp(w.target,he),k.setFromSpherical(oe),k.add(L),re()},onComplete:()=>{k.copy(w.position),L.copy(w.target),re()},onStop:()=>{throw new Error("Animation Stopped")}},R)}(o,e,t,a,c,d));else if(this.interpolateMode==="linear"){u.push(_a({from:o.position.clone(),to:e.position.clone(),duration:t,ease:a,driver:c,onUpdate:x=>o.position=x,onComplete:()=>o.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},d)),u.push(_a({from:o.target.clone(),to:e.target.clone(),duration:t,ease:a,driver:c,onUpdate:x=>{o.target=x,o.targetUpdated()},onComplete:()=>{o.target=e.target,o.targetUpdated()}},d));const _=o.cameraObject.quaternion.clone(),w=new p._fP;u.push(_a({from:0,to:1,duration:t,ease:a,driver:c,onUpdate:x=>{w.copy(_).slerp(e.quaternion,x),o.cameraObject.quaternion.copy(w),o.cameraObject.updateProjectionMatrix()},onComplete:()=>{o.cameraObject.quaternion.copy(e.quaternion),o.cameraObject.updateProjectionMatrix()}},d))}await Promise.allSettled(u).catch(_=>{if(i)throw _}),(g=this._viewer)==null||g.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,V.timeout)(10)}fromJSON(e,t){var n,i;return this._cameraViews.forEach(o=>this.deleteView(o)),super.fromJSON(e,t)?(this._cameraViews.forEach(o=>o.focusView=async()=>this.focusView(o)),this._cameraViews.forEach(o=>o.deleteView=()=>this.deleteView(o)),this._cameraViews.forEach(o=>o.updateView=()=>this.getCurrentCameraView(void 0,void 0,o)),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n),this):null}async animateToObject(e,t=4,n,i,o={min:.5,max:5}){if(!this._viewer)return;const a=new Ie().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),c=a.getCenter(new p.Pa4),u=a.getSize(new p.Pa4).length()/2;await this.animateToTarget(Math.min(o.max,Math.max(o.min,u*t)),c,n,i)}async animateToFitObject(e,t=1.5,n=1e3,i,o={min:.5,max:50}){if(!this._viewer)return;const a=new Ie().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),c=a.getCenter(new p.Pa4),u=a.getSize(new p.Pa4);let d=this._viewer.scene.activeCamera.cameraObject,m=1;if(d.isPerspectiveCamera){const g=d.fov*(Math.PI/180),_=2*Math.atan(Math.tan(g/2)*d.aspect),w=u.z/2+Math.abs(u.x/2/Math.tan(_/2)),x=u.z/2+Math.abs(u.y/2/Math.tan(g/2));m=Math.max(w,x)}await this.animateToTarget(Math.min(o.max,Math.max(o.min,m*t)),c,n,i)}async animateToTarget(e,t,n,i){const o=this.getCurrentCameraView();o.target.copy(t);const a=new p.Pa4().subVectors(o.target,o.position).normalize();o.position.copy(a.multiplyScalar(-e).add(o.target)),await this.animateToView(o,n,i)}async _downloadBlob(e,t){var i,o;const n=(i=this._viewer)==null?void 0:i.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):(o=this._viewer)==null||o.console.error("FileTransferPlugin required to export/download file")}}function Ru(s,e){const t=s.position.clone();t.sub(e);const n=new p.$V().setFromVector3(t);return n.makeSafe(),n}function Xc(s,e,t){const n=e-s;return n>=Math.PI?s+(n-2*Math.PI)*t:n<=-Math.PI?s+(n+2*Math.PI)*t:s+n*t}function xg(s,e,t){const n=(1-t)*Math.cos(s)+t*Math.cos(e),i=(1-t)*Math.sin(s)+t*Math.sin(e);return Math.atan2(i,n)}lr.PluginType="CameraViews",Vr([Ae("cameraViews")],lr.prototype,"_cameraViews",void 0),Vr([(0,V.onChange)(lr.prototype._animationLoop),Ae(),Gt("Loop All Views",{limitedUi:!0})],lr.prototype,"viewLooping",void 0),Vr([Ae(),jn("View Pause Time")],lr.prototype,"viewPauseTime",void 0),Vr([Ae(),Uo("Ease",Object.keys(yc).map(s=>({label:s})))],lr.prototype,"animEase",void 0),Vr([Ae(),cn("Duration",[10,1e4],10,{limitedUi:!0})],lr.prototype,"animDuration",void 0),Vr([Ae(),cn("RotationOffset",[.2,.75],.01)],lr.prototype,"rotationOffset",void 0),Vr([Ae(),Uo("Interpolation",["spherical","linear"].map(s=>({label:s})))],lr.prototype,"interpolateMode",void 0),Vr([Gt(),Ae()],lr.prototype,"seekOnScroll",void 0),Vr([Ai("Animate All Views",{limitedUi:!0})],lr.prototype,"animateAllViews",null),Vr([Ai("Record All Views")],lr.prototype,"recordAllViews",null),Vr([Ai("Add Current View")],lr.prototype,"addCurrentView",null),Vr([Ai("Focus Next")],lr.prototype,"focusNext",void 0),Vr([Ai("Focus Previous")],lr.prototype,"focusPrevious",void 0);const Ff=new p.Pa4;function jf(s,e,t){let n=s.dot(e);n=Math.min(Math.max(n,-1),1);const i=Math.acos(n)*t;return Ff.copy(s).multiplyScalar(n).sub(e).negate().normalize(),s.multiplyScalar(Math.cos(i)).add(Ff.multiplyScalar(Math.sin(i)))}var Du,Fh=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ac=Du=class{constructor(s){this.enabled=!1,this.power=.5,this.bgcolor=new p.Ilk(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new p.Ilk}},this.parsFragmentSnippet=(e,t)=>this.enabled?V.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=s.getPlugin(Fa),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(this.extraUniforms.power.value=this.power,this.extraUniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var s;(s=this.__setDirty)==null||s.call(this),this._setDirty()}};Ac.PluginType="Vignette",Fh([(0,V.onChange)(Du.prototype._setDirty),Gt("Enable"),Ae()],Ac.prototype,"enabled",void 0),Fh([(0,V.onChange)(Du.prototype._setDirty),cn("Power",[.1,4],.01,{limitedUi:!0}),Ae()],Ac.prototype,"power",void 0),Fh([(0,V.onChange)(Du.prototype._setDirty),Zo("Color"),Ae()],Ac.prototype,"bgcolor",void 0),Ac=Du=Fh([Hn("Vignette")],Ac);class Bu extends Hc{constructor(){super()}generateExtension(e){return new Ac(e)}get power(){var e;return((e=this._extension)==null?void 0:e.power)??1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e;return((e=this._extension)==null?void 0:e.bgcolor)??new p.Ilk}set color(e){this._extension&&(this._extension.bgcolor.set(e),this._extension.setDirty())}}Bu.PluginType="Vignette";var Ou=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ya=class extends En{constructor(){super(),this.enabled=!0,this.dependencies=[Qt],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const s=await(0,V.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(s)}async loadScenes(s){var t,n;const e=await Promise.all(s.map(async i=>await i.arrayBuffer()));for(let i=0;i<s.length;i++){const o=s[i];this.scenes.push({[o.name]:new Uint8Array(e[i])}),this.assets[o.name]={path:o.name,file:o}}(n=(t=this.uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t)}async play(){var i;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const s=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin")??this._viewer.getPluginByType("LoadingScreenPlugin");s==null||s.enabled,s&&(s.enabled=!1);const e=this._viewer.getPluginByType("FrameFade"),t=this._viewer.getPluginByType("GLTFAnimation"),n=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const o of this.scenes){if(!this._isPlaying)break;const a=Object.keys(o);t==null||t.stopAnimation(!1),await(n==null?void 0:n.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const u of a){let d=this.assets[u];d||(d={path:u,file:new File([o[u]],u)},this.assets[u]=d),await((i=this._viewer.getManager())==null?void 0:i.addAssetSingle(d,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,s&&(s.enabled=!1),e&&(e.enabled=!0,await e.startTransition(1e3));const c=[(0,V.timeout)(this.minSceneTime)];t&&c.push(t.playAnimation()),n&&c.push(n.animateAllViews()),await Promise.all(c)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const s={};for(const n of this.scenes)for(const i of Object.keys(n)){const o=s[i]?i+"_":i;s[o]=n[o]}const e=yh(s),t=new Blob([e],{type:"application/zip"});(0,V.downloadBlob)(t,"scenes.glbloop")}async onAdded(s){var t,n;await super.onAdded(s);const e=this;(n=(t=s.getManager())==null?void 0:t.importer)==null||n.Importers.push(new Br(class extends Nv{load(i,o,a,c){super.load(i,u=>{e.loadScenes([...u.values()]),o==null||o(null),(0,V.timeout)(100).then(e.play)},a,c)}},["glbloop"],!0))}};ya.PluginType="SceneLoopPlugin",Ou([nc("Loaded scenes")],ya.prototype,"loadedScenes",null),Ou([Ai("Load Scenes")],ya.prototype,"promptLoadScenes",null),Ou([nc("Playing")],ya.prototype,"_isPlaying",void 0),Ou([jn("Min Scene Time")],ya.prototype,"minSceneTime",void 0),Ou([Ai("Play")],ya.prototype,"play",null),Ou([Ai("Stop")],ya.prototype,"stop",null),Ou([Ai("Download Scenes")],ya.prototype,"downloadScenes",null),ya=Ou([Hn("Scene Loop")],ya);var Ay=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Eg=class extends ou{constructor(s,e,t){super(s,e,t??new rw,new p.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(s,e,t,n,i){if(!this.enabled||!this.camera)return;const o=this.overrideMaterial;o.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(s,e,t,n,i),o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value)}};Ay([Gt("Enabled")],Eg.prototype,"enabled",void 0),Eg=Ay([Hn("Velocity Buffer (TAA)")],Eg);class rw extends p.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new p.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new p.Vkp},currentProjectionViewMatrix:{value:new p.yGw},lastProjectionViewMatrix:{value:new p.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new p.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,n,i,o){const a=this._previousWorldMatrices[o.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(a??o.matrixWorld),a?a.copy(o.matrixWorld):this._previousWorldMatrices[o.uuid]=o.matrixWorld.clone();let c=o.material;Array.isArray(c)&&(c=c[0]),this.uniforms.alphaMap.value=(c==null?void 0:c.alphaMap)??null,this.uniforms.alphaTest.value=!c||!c.alphaTest||c.alphaTest<1e-7?.001:c.alphaTest;let u=this.uniforms.alphaMap.value?1:void 0;u!==this.defines.USE_ALPHAMAP&&(u===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=u,this.needsUpdate=!0),u=c.userData.ALPHA_I_RGBA_PACKING?1:void 0,u!==this.defines.ALPHA_I_RGBA_PACKING&&(u===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=u,this.needsUpdate=!0),this.side=c.side??p.ehD}}class hp extends ea{passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:p.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const n=new Set,i=new Set;return new class extends Eg{render(o,a,c,u,d){var w;if(e.renderer.frameCount>0)return;const m=o.getRenderTarget(),g=o.getActiveCubeFace(),_=o.getActiveMipmapLevel();(w=this.scene)==null||w.traverse(({material:x})=>{x&&((x.transparent&&x.userData.renderToDepth||!x.transparent&&x.transmission===0&&x.userData.renderToDepth===!1)&&(n.add(x),x.transparent=!x.transparent),Math.abs(x.transmission||0)>0&&x.userData.renderToDepth&&(i.add([x,x.transmission]),x.transmission=0))}),Vt(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,a,t,u,d)),n.forEach(x=>x.transparent=!x.transparent),n.clear(),i.forEach(([x,T])=>x.transmission=T),i.clear(),o.setRenderTarget(m,g,_)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var n;return e.renderer.disposeTarget((n=t==null?void 0:t.dispose)==null?void 0:n.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled?((t=this.getVelocityBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}hp.PluginType="VelocityBuffer";var Lu,jh=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Yc=Lu=class{constructor(s){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,t)=>this.enabled?`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){
#ifdef WebGL2Context
return number%2;
#else
return int(mod(float(number),2.));
#endif
}int getLUTIndex(in int number){
#ifdef WebGL2Context
return number%8;
#else
return int(mod(float(number),8.));
#endif
}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._viewer=s,this._combinedPostPlugin=s.getPlugin(Fa),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const s=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let e=s?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,e,this.extraUniforms.lutSize,s),this.extraDefines.USE_LUT=this.lutMap?1:0,e=s?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,e,this.extraUniforms.lutSize1,s),this.extraDefines.USE_LUT1=this.lutMap1?1:0,e=s?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,e,this.extraUniforms.lutSize2,s),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=s,this._setDirty()}_updateLUTMap(s,e,t,n){if(s){let i=1;n==1?(e.value=s.texture3D,i=s.texture3D.image.width):s.texture&&(e.value=s.texture,i=s.texture.image.width),e.value.needsUpdate=!0,t.value=i}}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){var s;(s=this.__setDirty)==null||s.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function y_(s){const e=s==null?void 0:s.userData;if(!e)return!1;e[Ys.PluginType]||(e[Ys.PluginType]={});const t=e[Ys.PluginType];return t.enable=!0,t.index===void 0&&(t.index=0),s.isMaterial&&(s.needsUpdate=!0),!0}jh([Ae(),(0,V.onChange)(Lu.prototype._updateParams),Gt("Enable")],Yc.prototype,"enabled",void 0),jh([Ae(),(0,V.onChange)(Lu.prototype._updateParams),Gt("LUT Background")],Yc.prototype,"lutBackground",void 0),jh([Ae(),(0,V.onChange)(Lu.prototype._updateParams),cn("Intensity")],Yc.prototype,"intensity",void 0),jh([(0,V.onChange)(Lu.prototype._updateParams),sh("LUT"),Ae()],Yc.prototype,"lutMap",void 0),jh([(0,V.onChange)(Lu.prototype._updateParams),sh("LUT1"),Ae()],Yc.prototype,"lutMap1",void 0),jh([(0,V.onChange)(Lu.prototype._updateParams),sh("LUT2"),Ae()],Yc.prototype,"lutMap2",void 0),Yc=Lu=jh([Hn("LUT")],Yc);class Ys extends Hc{_getUiConfig(e){var n,i;const t={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var o;return((o=e.materialObject.userData[Ys.PluginType])==null?void 0:o.enable)??!0},set value(o){var c;const a=e.materialObject.userData[Ys.PluginType];o!==(a==null?void 0:a.enable)&&(a||y_(e.materialObject),e.materialObject.userData[Ys.PluginType].enable=o,(c=t.uiRefresh)==null||c.call(t,"postFrame",!0))},onChange:(n=this._extension)==null?void 0:n.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(o=>({label:o[0],value:o[1]})),label:"index",hidden:()=>{const o=e.materialObject.userData[Ys.PluginType];return!!o&&!o.enable},get value(){var o;return((o=e.materialObject.userData[Ys.PluginType])==null?void 0:o.index)??0},set value(o){var a;e.materialObject.userData[Ys.PluginType]||y_(e.materialObject),e.materialObject.userData[Ys.PluginType].index=o,(a=t.uiRefresh)==null||a.call(t,"postFrame",!0)},onChange:(i=this._extension)==null?void 0:i.setDirty}]};return t}constructor(){super(),this.materialExtension={uuid:ns(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>{var t;return(this.enabled?"1":"0")+((t=e.materialObject.userData[Ys.PluginType])!=null&&t.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var n,i;await super.onAdded(e),(n=e.getPlugin(Ii))==null||n.registerGBufferUpdater(this.updateGBuffer);const t=e.getPlugin(Qt);(i=t==null?void 0:t.materials)==null||i.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new Yc(e)}updateGBuffer(e,t){var n,i;if(e instanceof p.Kj0&&((n=e.material)!=null&&n.userData)){const o=(i=e.material)==null?void 0:i.userData[Ys.PluginType];if(o){const a=o.enable===!1?0:1;t.w=zv(t.w,0,a);for(let u=0;u<3;u++)t.y=qd(t.y,u);let c=o.enable?o.index:0;c=Math.min(c,7),t.y=t.y|c}else t.w=zv(t.w,0,1)}}}Ys.PluginType="LUTPlugin1";class A_{constructor(e){this._zee=new p.Pa4(0,0,1),this._euler=new p.USm,this._q0=new p._fP,this._q1=new p._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new p._fP,this._initQuaternionDest=new p._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=t=>{this.deviceOrientation=t},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new p.FM8;this.getQuaternion(e,this._q2);const t=new p.Pa4(0,0,1);return t.applyQuaternion(this._q2),new p.FM8(t.x,t.y)}getQuaternion(e,t){if(t||(t=new p._fP),!this.deviceOrientation)return t.identity();const n=this.deviceOrientation,i=n.alpha!==null?p.M8C.degToRad(n.alpha):0,o=n.beta!==null?p.M8C.degToRad(n.beta):0,a=n.gamma!==null?p.M8C.degToRad(n.gamma):0,c=this.screenOrientation?p.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(t,i,o,a,c,e),t}_toQuaternion(e,t,n,i,o,a){this._euler.set(n,t,-i,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const c=document.getElementById("debug");return c&&(c.textContent=o+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-o)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),a&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(e=this._viewer)==null||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(e=>{e=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new p._fP)}}class by{constructor(){this._mousePos=new p.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new p.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var Aa,Qa=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ho=Aa=class extends En{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new p.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new p.Pa4,this._center=new p.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var c,u;if(!this.enabled)return void((u=(c=this._object)._updateProjectionMatrixParallax)==null?void 0:u.call(c));const s=this._object,e=s.near;let t=e*Math.tan(.5*p.M8C.DEG2RAD*s.fov)/s.zoom,n=2*t,i=s.aspect*n,o=-.5*i;if(s.view!==null&&s.view.enabled){const d=s.view.fullWidth,m=s.view.fullHeight;o+=s.view.offsetX*i/d,t-=s.view.offsetY*n/m,i*=s.view.width/d,n*=s.view.height/m}o-=this._offX*e/this._focalDistance,t-=this._offY*e/this._focalDistance;const a=s.filmOffset;a!==0&&(o+=e*a/s.getFilmWidth()),s.projectionMatrix.makePerspective(o,o+i,t,t-n,e,s.far),s.projectionMatrixInverse.copy(s.projectionMatrix).invert()},this._preFrame=s=>{this.update(s.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new V.Damper,this._yDamper=new V.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(s){var e,t,n;await super.onAdded(s),A_.IsCompatible()?this._input=new A_(s):this._input=new by,s.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),s.addEventListener("preFrame",this._preFrame),(e=this._viewer)==null||e.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(t=this._viewer)==null||t.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(n=s.getPluginByType("Picking"))==null||n.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var s,e,t,n;this._object&&((s=this._object)!=null&&s._updateProjectionMatrixParallax)&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(e=this._viewer)==null?void 0:e.scene.activeCamera.cameraObject,(t=this._object)!=null&&t.isOrthographicCamera?(n=this._viewer)==null||n.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var s;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(s=this._viewer)==null||s.container.appendChild(this._indicator))}onPointerDown(s){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=s.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=s.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(s){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.interactionsEnabled=!1,this._updateFocalDistance();const e=this._object.matrixWorld.elements,t=new p.Pa4(e[0],e[1],e[2]),n=new p.Pa4(e[4],e[5],e[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let i=this.sensitivity;this.invert&&(i*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*i,s,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*i,s,1);const o=this._object;o.position.add(n.multiplyScalar(this._offY)).add(t.multiplyScalar(this._offX)),o.updateProjectionMatrix(),o.updateMatrixWorld(),this._dirty=!0}_onObjectHit(s){var e,t;s.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(s.intersects.intersect.point),s.intersects.selectedObject=null,(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var n,i;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(i=(n=this.uiConfig)==null?void 0:n.uiRefresh)==null||i.call(n,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const s=this._object,e=new p.Pa4;s.getWorldDirection(e),e.normalize(),this._focalDistance=this.focalPointHit.clone().sub(s.position).dot(e)}_onEnabledChange(){var s,e,t;if(this._viewer){if(this.enabled){if((s=this._input)==null||s.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.interactionsEnabled=!1;const n=this._viewer.getPluginByType("CameraViews"),i=n==null?void 0:n.camViews.find(o=>o.name===this.cameraView);n&&i&&n.setCurrentCameraView(i),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const n=this._object;n.updateProjectionMatrix(),n.updateMatrixWorld()}(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var s;(s=this._input)==null||s.disconnect()}};Ho.PluginType="ParallaxCameraControllerPlugin",Qa([(0,V.onChange)(Aa.prototype._onEnabledChange),Ae(),Gt("Enabled")],Ho.prototype,"enabled",void 0),Qa([Ae(),Gt("enableEdit")],Ho.prototype,"enableEdit",void 0),Qa([Ae(),Gt("Invert")],Ho.prototype,"invert",void 0),Qa([Ae(),cn("Sensitivity",[.1,2],.01)],Ho.prototype,"sensitivity",void 0),Qa([Ae("focalPoint"),As("Focal Point Hit",void 0,.001)],Ho.prototype,"focalPointHit",void 0),Qa([(0,V.onChange)(Aa.prototype._onDampingChange),Ae(),cn("Damping",[0,1],.001)],Ho.prototype,"damping",void 0),Qa([Ae(),jn("Camera View")],Ho.prototype,"cameraView",void 0),Ho=Aa=Qa([Hn("Parallax Camera Controller")],Ho);var wy=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ba=class extends En{addNoiseBumpMaterial(s){return Sg(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new rE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Qt],this._uniforms={noiseBumpParams:{value:new p.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new p.Ltg(0,1,3,0)},flakeFallOffParams:{value:new p.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._noiseBumpMat)!=null&&t.hasBump)?al+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(s,e,t)=>{var i;if(!this.enabled||!((i=e.materialObject.userData._noiseBumpMat)!=null&&i.hasBump))return;const n="#glMarker beforeAccumulation";s.fragmentShader=s.fragmentShader.replace(n,`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif

`+n),s.defines.USE_UV="",s.extensionDerivatives=!0},onObjectRender:(s,e)=>{var i;const t=(i=e.materialObject.userData)==null?void 0:i._noiseBumpMat;if(!(t!=null&&t.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(t.bumpNoiseParams),this._uniforms.noiseBumpScale.value=t.bumpScale,this._uniforms.noiseBumpFlakeScale.value=t.flakeScale,this._uniforms.noiseFlakeClamp.value=t.flakeClamp,this._uniforms.noiseFlakeRadius.value=t.flakeRadius,t.flakeParams&&this._uniforms.flakeParams.value.copy(t.flakeParams),t.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(t.flakeFallOffParams),this._uniforms.useColorFlakes.value=t.useColorFlakes;const n=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==n&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+((t=(e=s.materialObject.userData)==null?void 0:e._noiseBumpMat)!=null&&t.hasBump?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.hasBump)||!1},set value(n){var i,o;n!==((i=s.materialObject.userData._noiseBumpMat)==null?void 0:i.hasBump)&&(n?Sg(s.materialObject)||e.alert("Cannot add noise bump."):s.materialObject.userData._noiseBumpMat&&(s.materialObject.userData._noiseBumpMat.hasBump=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=s.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var n;return!((n=s.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var n;return!((n=s.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!((n=s.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var n;return!((n=s.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var n;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var i;return!((i=s.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var i;return!((i=s.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var i;return!((i=s.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"z"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var i;return!((i=s.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"w"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var i;return!((i=s.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var i;return!((i=s.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var i;return!((i=s.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=s.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var n;return!((n=s.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)==null||e.call(s),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(s){var t,n,i,o,a;await super.onAdded(s);const e=s.getPlugin(Qt);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(Cg)}async onRemove(s){var e,t,n,i;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=s.getPlugin(Qt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function Sg(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const t=e._noiseBumpMat;return t.hasBump=!0,t.bumpNoiseParams===void 0&&(t.bumpNoiseParams=[.5,.5]),t.bumpScale===void 0&&(t.bumpScale=.05),t.flakeScale===void 0&&(t.flakeScale=.05),t.flakeClamp===void 0&&(t.flakeClamp=1),t.flakeRadius===void 0&&(t.flakeRadius=.3),t.useColorFlakes===void 0&&(t.useColorFlakes=!1),t.flakeParams===void 0&&(t.flakeParams=new p.Ltg(0,1,3,0)),t.flakeFallOffParams===void 0&&(t.flakeFallOffParams=new p.Pa4(0,1,0)),s.isMaterial&&(s.needsUpdate=!0),!0}ba.PluginType="NoiseBumpMaterialPlugin",ba.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",wy([Gt("Enabled",s=>({onChange:s.setDirty})),Ae()],ba.prototype,"enabled",void 0),ba=wy([Hn("NoiseBump Materials")],ba);class rE{constructor(e){this.parser=e,this.name=ba.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Sg(t),t.userData._noiseBumpMat=Di(i,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const Cg=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;t.extensions=t.extensions||{};const n=xi(e.userData._noiseBumpMat,!1);t.extensions[ba.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=n,s.extensionsUsed[ba.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class xy extends Fr{constructor(e,t){super({vertexShader:qe.vertexShader,fragmentShader:t+`
`+Ym+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new p.FM8},cameraNearFar:{value:new p.FM8},lastProjectionViewMatrix:{value:new p.yGw},currentProjectionViewMatrix:{value:new p.yGw},projection:{value:new p.yGw},inverseViewMatrix:{value:new p.yGw},jitterSample:{value:new p.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new p.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,i,o){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const a=this.uniforms.tVelocity.value?1:0;a!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=a,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,i,o),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}(function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Ae(),Fe()],xy.prototype,"feedBack",void 0);class zh extends ea{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[Ii],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(oo))throw"Add ProgressivePlugin before TAA";const t=new xy(e.getPlugin(oo).lastFrame,e.getPlugin(Ii).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<=1&&e.scene.renderCamera===e.scene.activeCamera,!n.taaEnabled)return!1;const i=e.scene.renderCamera;return n.updateShaderProperties([e.getPlugin(Ii),i,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(oo).lastFrame,n.updateCameraProperties(i==null?void 0:i.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e;return((e=this._viewer)==null?void 0:e.renderer.stableNoise)??this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var t;const e=(t=this.pass)==null?void 0:t.passObject.uiConfig;if(e&&e.children)return e.children.includes(this._stableNoiseConfig)||e.children.push(this._stableNoiseConfig),e}}zh.PluginType="TAA";var Mg=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Jr=class extends En{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=s=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)==null?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(s){var t;if(this.isFullScreen())return;const e=s||((t=this._viewer)==null?void 0:t.canvas);return e?(this._lastFsElement=e,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[e.style.width,e.style.height],e.style.width="100%",e.style.height="100%",e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(s){return this.isFullScreen()?this.exit():this.enter(s)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};Jr.PluginType="FullScreenPlugin",Mg([Ai("Enter FullScreen")],Jr.prototype,"enter",null),Mg([Ai("Exit FullScreen")],Jr.prototype,"exit",null),Mg([Ai("Toggle FullScreen")],Jr.prototype,"toggle",null),Jr=Mg([Hn("Full Screen")],Jr);const dp=(s,e)=>{const t={};for(const n of s.mappings)for(const i of n.variants)t[e[i]]={material:null,gltfMaterialIndex:n.material};return t},Vh="KHR_materials_variants";class zf{constructor(e){this.parser=e,this.name=Vh}async afterRoot(e){const t=this.parser,n=t.json;if(!n.extensions||!n.extensions[this.name])return;const i=(o=>{const a=[],c=new Set;for(const u of o){let d=u,m=0;for(;c.has(d);)d=u+"."+ ++m;c.add(d),a.push(d)}return a})((n.extensions[this.name].variants||[]).map(o=>o.name));for(const o of e.scenes)o.traverse(a=>{const c=t.associations.get(a);if(!c||c.meshes===void 0||c.primitives===void 0)return;const u=n.meshes[c.meshes].primitives[c.primitives].extensions;u&&u[this.name]&&(a.userData._variantMaterials=dp(u[this.name],i))});await Promise.all(e.scenes.map(async o=>{const a=[];return o.traverse(c=>{return(u=c).material!==void 0&&u.userData&&u.userData._variantMaterials&&a.push((async d=>{const m=d.material,g=d.userData._variantMaterials,_=[];for(const w in g){const x=g[w];if(x.material)continue;const T=x.gltfMaterialIndex;_.push(t.getDependency("material",T).then(I=>{d.material=I,t.assignFinalMaterial(d),g[w].material=d.material}))}return Promise.all(_).then(()=>{d.material=m})})(c));var u}),o.userData.__importData||(o.userData.__importData={}),o.userData.__importData[Vh]={names:i},Promise.all(a)}))}}const Ey=s=>s.material!==void 0&&s.userData&&s.userData._variantMaterials&&!!Object.values(s.userData._variantMaterials).filter(e=>ku(e==null?void 0:e.material)),ku=s=>s&&s.isMaterial&&!Array.isArray(s);class Gh{constructor(e){this.writer=e,this.name=Vh,this.variantNames=[]}beforeParse(e){const t=new Set;for(const n of e)n.traverse(i=>{if(!Ey(i))return;const o=i.userData._variantMaterials;for(const a in o){const c=o[a];ku(c.material)&&t.add(a)}});t.forEach(n=>this.variantNames.push(n))}writeMesh(e,t){if(!Ey(e))return;const n=e.userData,i=n._variantMaterials,o={};for(const u in i){const d=i[u].material;if(!ku(d))continue;const m=this.variantNames.indexOf(u),g=this.writer.processMaterial(d);o[g]||(o[g]={material:g,variants:[]}),o[g].variants.push(m)}const a=Object.values(o).map(u=>u.variants.sort((d,m)=>d-m)&&u).sort((u,d)=>u.material-d.material);if(a.length===0)return;const c=ku(n._originalMaterial)?this.writer.processMaterial(n._originalMaterial)??-1:-1;for(const u of t.primitives)c>=0&&(u.material=c),u.extensions=u.extensions||{},u.extensions[this.name]={mappings:a}}afterParse(e){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const n=this.variantNames.map(i=>({name:i}));t.extensions[this.name]={variants:n},this.writer.extensionsUsed[this.name]=!0}}function pp(s){return new Gh(s)}class bc extends En{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Qt],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var n,i;const t=e.object;(t==null?void 0:t.assetType)==="model"&&t.modelObject&&this._viewer&&(t.modelObject.traverse(o=>{var u,d,m,g,_;if(o.userData._variantMaterials)for(const w of Object.values(o.userData._variantMaterials))w!=null&&w.material&&(w.material=((m=(d=(u=this._viewer)==null?void 0:u.getManager())==null?void 0:d.materials)==null?void 0:m.processMaterial(w.material,{}))||w.material);const a=(_=(g=o.userData)==null?void 0:g.__importData)==null?void 0:_[Vh];if(!a)return;const c=a.names||[];for(const w of c)this.variants[w]||(this.variants[w]=[]),this.variants[w].push(o);delete o.userData.__importData[Vh]}),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(e=>e?{label:e}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var n,i,o,a;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(Qt);(n=t==null?void 0:t.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=t==null?void 0:t.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(pp)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new zf(t))}async onRemove(e){var i,o,a,c,u,d;e.scene.removeEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(Qt);(i=t.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate);const n=(c=(a=(o=t.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:a.extensions)==null?void 0:c.indexOf(pp);return n!==void 0&&n!==-1&&((d=(u=t.exporter.getExporter("gltf","glb"))==null?void 0:u.extensions)==null||d.splice(n,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,t=!1,n,i=!0){if(!t&&!n&&this.selectedVariant===e||!e)return;n||(this.selectedVariant=e);const o=n?Array.isArray(n)?n:[n]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const a of o){const c=new Set,u=d=>{var g,_;if(!d.userData._variantMaterials||c.has(d))return;const m=e?(g=d.userData._variantMaterials[e])==null?void 0:g.material:d.userData._originalMaterial;m&&(d.userData._originalMaterial||(d.userData._originalMaterial=d.material),(_=d==null?void 0:d.setMaterial)==null||_.call(d,m)),c.add(d)};i?a.traverse(u):u(a)}}}bc.PluginType="GLTFKHRMaterialVariantsPlugin",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([(0,V.onChange)(bc.prototype._variantChanged)],bc.prototype,"selectedVariant",void 0);function Sy(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const t=e._ssBevel;return t.hasSSBevel=!0,t.radius===void 0&&(t.radius=0),s.isMaterial&&(s.needsUpdate=!0),!0}let Nl=class extends Fr{constructor(s,e,t,n){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new p.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new p.Pa4(1,1,1)}},vertexShader:Vo,fragmentShader:`

            ${t}

            ${al}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(i,o,a)=>{var c,u;this.enabled&&((u=(c=o.materialObject.userData)==null?void 0:c._ssBevel)!=null&&u.hasSSBevel)&&(i.fragmentShader=Sn(i.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(i,o,a)=>{var d,m;if(!this.enabled||!((m=(d=o.materialObject.userData)==null?void 0:d._ssBevel)!=null&&m.hasSSBevel))return;const c=o.materialObject,u=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==u&&(this.materialExtension.extraUniforms.tSSBevelMap.value=u,c.needsUpdate=!0)},getUiConfig:i=>{const o={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var a;return((a=i.materialObject.userData._ssBevel)==null?void 0:a.hasSSBevel)||!1},set value(a){var c,u;a!==((c=i.materialObject.userData._ssBevel)==null?void 0:c.hasSSBevel)&&(a?Sy(i.materialObject)||alert("Cannot add screen space bevel."):i.materialObject.userData._ssBevel&&(i.materialObject.userData._ssBevel.hasSSBevel=!1,i.materialObject.needsUpdate=!0),(u=o.uiRefresh)==null||u.call(o,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var a;return!((a=i.materialObject.userData._ssBevel)!=null&&a.hasSSBevel)},property:[i.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return o},parsFragmentSnippet:(i,o)=>{var a,c;return this.enabled&&((c=(a=o==null?void 0:o.materialObject.userData)==null?void 0:a._ssBevel)!=null&&c.hasSSBevel)?V.glsl`
            uniform sampler2D tSSBevelMap;
            ${vf}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:i=>{var o,a;return(this.enabled?"1":"0")+((a=(o=i.materialObject.userData)==null?void 0:o._ssBevel)!=null&&a.hasSSBevel?"1":"0")},isCompatible:i=>i.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=n,this._edgeMaterial=new ic({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new p.FM8(1,1)},cameraPositionWorld:{value:new p.Pa4(1,1,1)}},vertexShader:Vo,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new ic({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new p.FM8(.5,.5)},direction:{value:new p.FM8(.5,.5)}},vertexShader:Vo,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(s,e,t,n,i){var u,d;if(!this.enabled)return;const o=s.baseRenderer,a={minFilter:p.wem,magFilter:p.wem,isAntialiased:!1,format:p.wk1,depthBuffer:!1,generateMipmaps:!1},c=o.getTempTarget(a);this._renderEdges(o,c),this._blurEdges(o,c),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),(u=this._viewerApp.getPlugin(Ii))==null||u.updateShaderProperties(this.material),(d=this._viewerApp.getPlugin(Mh))==null||d.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=c.texture,super.render(s,this._target,c,n,i),o.releaseTempTarget(c)}_initsamples(){const s=[];return s.push(new p.FM8(-8,0).multiplyScalar(.125)),s.push(new p.FM8(-6,-4).multiplyScalar(.125)),s.push(new p.FM8(-3,-2).multiplyScalar(.125)),s.push(new p.FM8(-2,-6).multiplyScalar(.125)),s.push(new p.FM8(1,-1).multiplyScalar(.125)),s.push(new p.FM8(2,-5).multiplyScalar(.125)),s.push(new p.FM8(6,-7).multiplyScalar(.125)),s.push(new p.FM8(5,-3).multiplyScalar(.125)),s.push(new p.FM8(4,1).multiplyScalar(.125)),s.push(new p.FM8(7,4).multiplyScalar(.125)),s.push(new p.FM8(3,5).multiplyScalar(.125)),s.push(new p.FM8(0,7).multiplyScalar(.125)),s.push(new p.FM8(-1,3).multiplyScalar(.125)),s.push(new p.FM8(-4,6).multiplyScalar(.125)),s.push(new p.FM8(-7,8).multiplyScalar(.125)),s.push(new p.FM8(-5,2).multiplyScalar(.125)),s}_blurEdges(s,e){var a,c;const t={minFilter:p.wem,magFilter:p.wem,isAntialiased:!1,format:p.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},n=s.getTempTarget(t),i=((a=e.texture.image)==null?void 0:a.width)||1,o=((c=e.texture.image)==null?void 0:c.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new p.FM8(i,o),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new p.FM8(1,0),s.blit(void 0,n,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new p.FM8(i/2,o/2),this._separableBlurMaterial.uniforms.colorTexture.value=n.texture,this._separableBlurMaterial.uniforms.direction.value=new p.FM8(0,1),s.blit(void 0,e,{material:this._separableBlurMaterial}),s.releaseTempTarget(n)}_renderEdges(s,e){var i,o,a,c;const t=((i=e.texture.image)==null?void 0:i.width)||1,n=((o=e.texture.image)==null?void 0:o.height)||1;this._edgeMaterial.uniforms.screenSize.value=new p.FM8(t,n),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),(a=this._viewerApp.getPlugin(Ii))==null||a.updateShaderProperties(this._edgeMaterial),(c=this._viewerApp.getPlugin(Mh))==null||c.updateShaderProperties(this._edgeMaterial),s.blit(void 0,e,{material:this._edgeMaterial})}};Nl=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Hn("SSBevel")],Nl);class Fl extends ea{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Qt,Ii,Mh],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new sw(t))}passCtor(e){var t;return this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:p.cLu,minFilter:p.TyD,magFilter:p.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,e.getPluginByType("debug"),new Nl(e.renderer,this._bevelTarget,((t=e.getPlugin(Ii))==null?void 0:t.getUnpackSnippet())??"",e)}async onAdded(e){var n,i,o,a,c,u,d,m;await super.onAdded(e);const t=e.getPlugin(Qt);return(n=this.pass)!=null&&n.passObject.materialExtension&&((o=t==null?void 0:t.materials)==null||o.registerMaterialExtension((i=this.pass)==null?void 0:i.passObject.materialExtension)),(a=t==null?void 0:t.importer)==null||a.addEventListener("loaderCreate",this._loaderCreate),(d=(u=(c=t==null?void 0:t.exporter)==null?void 0:c.getExporter("gltf","glb"))==null?void 0:u.extensions)==null||d.push(ul),(m=e.getPlugin(Ii))==null||m.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,n,i;(e=this._viewer)==null||e.setDirty(),(i=(t=this.pass)==null?void 0:(n=t.passObject.materialExtension).setDirty)==null||i.call(n)}_update(e){var n,i;let t=this.enabled;if(t&&!this._lastEnabled){const o=(n=this._viewer)==null?void 0:n.getPluginByType("NormalBufferPlugin");o&&!o.enabled&&(o.enabled=!0),o||((i=this._viewer)==null||i.console.error("SSBevelPlugin needs NormalBufferPlugin"))}return this._lastEnabled=t,t}get uiConfig(){var t,n,i,o;const e=((n=(t=this.pass)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(o=(i=e.children)==null?void 0:i.map(a=>(0,V.getOrCall)(a)))==null||o.flat(2).forEach(a=>a&&(a.onChange=this.setDirty)),e}updateGBuffer(e,t){var n,i,o;if(e instanceof p.Kj0&&((n=e.material)!=null&&n.userData)){for(let c=3;c<8;c++)t.y=qd(t.y,c);let a=(i=e.material)!=null&&i.userData._ssBevel?(o=e.material)==null?void 0:o.userData._ssBevel.radius:0;a=Math.min(a,31),a<<=3,t.y=t.y|a}}}Fl.PluginType="SSBevelPlugin",Fl.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class sw{constructor(e){this.parser=e,this.name=Fl.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Sy(t),t.userData._ssBevel=Di(i,t.userData._ssBevel,!1,{}),Promise.resolve()}}const ul=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;t.extensions=t.extensions||{};const n=xi(e.userData._ssBevel,!1);t.extensions[Fl.SSBEVEL_GLTF_EXTENSION]=n,s.extensionsUsed[Fl.SSBEVEL_GLTF_EXTENSION]=!0}});class Kc{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Sn(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class Cy extends Hc{generateExtension(e){return new Kc}}Cy.PluginType="GammaCorrection";var wc=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let xc=class extends En{addTriplanarMapping(s){var t;const e=(t=s.materialObject)==null?void 0:t.userData;return!!e&&(e._triplanarMapping||(e._triplanarMapping={}),e._triplanarMapping.enable=!0,e._triplanarMapping.scaleFactor===void 0&&(e._triplanarMapping.scaleFactor=1),e._triplanarMapping.blendFactor===void 0&&(e._triplanarMapping.blendFactor=1),e._triplanarMapping.offsetFactor===void 0&&(e._triplanarMapping.offsetFactor=0),s.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new sE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Qt],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(s,e,t)=>{var u,d;if(!this.enabled||!((d=(u=e.materialObject.userData)==null?void 0:u._triplanarMapping)!=null&&d.enable))return;const n=V.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;s.vertexShader=Sn(s.vertexShader,"#include <common>",n,{prepend:!0});const i=V.glsl`
                // same as worldpos_vertex.glsl.js but added a !
                #if !(defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0)
                vec4 worldPosition = vec4( transformed, 1.0 );
                #ifdef USE_INSTANCING
                worldPosition = instanceMatrix * worldPosition;
                #endif
                worldPosition = modelMatrix * worldPosition;
                #endif
                
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz; 
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;s.vertexShader=Sn(s.vertexShader,"#include <worldpos_vertex>",i,{append:!0});const o=V.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;s.fragmentShader=Sn(s.fragmentShader,"#include <common>",o,{prepend:!0});const a=V.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;s.fragmentShader=Sn(s.fragmentShader,"#include <bumpmap_pars_fragment>",a);let c=Sn(p.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");s.fragmentShader=Sn(s.fragmentShader,"#include <map_fragment>",c),c=Sn(p.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),s.fragmentShader=Sn(s.fragmentShader,"#include <roughnessmap_fragment>",c),c=Sn(p.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),s.fragmentShader=Sn(s.fragmentShader,"#include <metalnessmap_fragment>",c),c=Sn(p.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),s.fragmentShader=Sn(s.fragmentShader,"#include <normal_fragment_maps>",c),s.defines.USE_UV=""},onObjectRender:(s,e)=>{var i,o,a,c;const t=e.materialObject.userData;if(!((i=t==null?void 0:t._triplanarMapping)!=null&&i.enable))return;const n=s;n.isMesh&&n.geometry&&(this._uniforms.triplanarScale.value=(o=t._triplanarMapping)==null?void 0:o.scaleFactor,this._uniforms.triplanarBlend.value=(a=t._triplanarMapping)==null?void 0:a.blendFactor,this._uniforms.triplanarOffset.value=(c=t._triplanarMapping)==null?void 0:c.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+((t=(e=s.materialObject.userData)==null?void 0:e._triplanarMapping)!=null&&t.enable?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>{var s;return[(s=this._viewer)==null?void 0:s.renderer]},getUiConfig:s=>{const e=this._viewer,t=this.addTriplanarMapping,n={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var i;return((i=s.materialObject.userData._triplanarMapping)==null?void 0:i.enable)||!1},set value(i){var o,a;i!==((o=s.materialObject.userData._triplanarMapping)==null?void 0:o.enable)&&(i?t(s)||e.alert("Cannot add Triplanar mapping."):s.materialObject.userData._triplanarMapping&&(s.materialObject.userData._triplanarMapping.enable=!1,s.materialObject.needsUpdate=!0),(a=n.uiRefresh)==null||a.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var i;return!((i=s.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[s.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var i;return!((i=s.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[s.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var i;return!((i=s.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[s.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)==null||e.call(s),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(s){var t,n,i,o,a;await super.onAdded(s);const e=s.getPlugin(Qt);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(Tg)}async onRemove(s){var e,t,n,i;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=s.getPlugin(Qt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};xc.PluginType="TriplanarUVMappingPlugin",xc.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",wc([Gt("Enabled",s=>({onChange:s.setDirty})),Ae()],xc.prototype,"enabled",void 0),xc=wc([Hn("Triplanar Mapping")],xc);class sE{constructor(e){this.parser=e,this.name=xc.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];t.userData||(t.userData={});const o=t.userData;return o._triplanarMapping||(o._triplanarMapping={}),o._triplanarMapping.enable=!0,o._triplanarMapping.scaleFactor===void 0&&(o._triplanarMapping.scaleFactor=1),o._triplanarMapping.blendFactor===void 0&&(o._triplanarMapping.blendFactor=1),o._triplanarMapping.offsetFactor===void 0&&(o._triplanarMapping.offsetFactor=0),t.userData._triplanarMapping=Di(i,t.userData._triplanarMapping,!1,{}),Promise.resolve()}}const Tg=s=>({writeMaterial:(e,t)=>{var i;if(!e.isMeshStandardMaterial||!((i=e.userData._triplanarMapping)!=null&&i.enable))return;t.extensions=t.extensions||{};const n=xi(e.userData._triplanarMapping,!1);t.extensions[xc.TRIPLANAR_GLTF_EXTENSION]=n,s.extensionsUsed[xc.TRIPLANAR_GLTF_EXTENSION]=!0}});var ow=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let jl=class extends En{addClearcoatTint(s){return My(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new Hh(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Qt],this._defines={},this._uniforms={ccTintColor:{value:new p.Ilk},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&t.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(s,e,t)=>{var o;if(!(this.enabled&&((o=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&o.enableTint)&&e.materialObject.clearcoat>0))return;const n="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",i="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";s.fragmentShader.includes(i)&&s.fragmentShader.includes(n)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),s.fragmentShader=s.fragmentShader.replace(i,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),s.fragmentShader=s.fragmentShader.replace(n,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+n),s.defines.USE_UV=""},onObjectRender:(s,e)=>{var i;const t=(i=e.materialObject.userData)==null?void 0:i._clearcoatTint;if(!(t!=null&&t.enableTint))return;this._uniforms.ccTintColor.value.set(t.tintColor),this._uniforms.ccThickness.value=t.thickness,this._uniforms.ccIor.value=t.ior;const n=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==n&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+((t=(e=s.materialObject.userData)==null?void 0:e._clearcoatTint)!=null&&t.enableTint?"1":"0")+(s.materialObject.clearcoat>0?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._clearcoatTint)==null?void 0:n.enableTint)||!1},set value(n){var i,o;n!==((i=s.materialObject.userData._clearcoatTint)==null?void 0:i.enableTint)&&(n?My(s.materialObject)||e.alert("Cannot add clearcoat tint."):s.materialObject.userData._clearcoatTint&&(s.materialObject.userData._clearcoatTint.enableTint=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var n;return!((n=s.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var n;return!((n=s.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var n;return!((n=s.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)==null||e.call(s),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(s){var t,n,i,o,a;await super.onAdded(s);const e=s.getPlugin(Qt);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(a=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||a.push(aw)}async onRemove(s){var e,t,n,i;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=s.getPlugin(Qt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function My(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const t=e._clearcoatTint;return t.enableTint=!0,t.tintColor===void 0&&(t.tintColor=16777215),t.thickness===void 0&&(t.thickness=.1),t.ior===void 0&&(t.ior=1.5),s.isMaterial&&(s.needsUpdate=!0),!0}jl.PluginType="ClearcoatTintPlugin",jl.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",ow([Gt("Enabled",s=>({onChange:s.setDirty})),Ae()],jl.prototype,"enabled",void 0),jl=ow([Hn("ClearcoatTint Materials")],jl);class Hh{constructor(e){this.parser=e,this.name=jl.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),My(t),Di(i,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const aw=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;t.extensions=t.extensions||{};const n=xi(e.userData._clearcoatTint,!1);t.extensions[jl.CLEARCOAT_TINT_GLTF_EXTENSION]=n,s.extensionsUsed[jl.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class Ty{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:i,msg:o,transfer:a}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(o,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class lw{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Vf{constructor(e,t,n,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const Io=[171,75,84,88,32,50,48,187,13,10,26,10];function cw(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}let b_,Jc,fp;const Ig={env:{emscripten_notify_memory_growth:function(s){fp=new Uint8Array(Jc.exports.memory.buffer)}}};class oE{init(){return b_||(b_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Iy).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Ig)).then(this._init):WebAssembly.instantiate(Buffer.from(Iy,"base64"),Ig).then(this._init),b_)}_init(e){Jc=e.instance,Ig.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Jc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=Jc.exports.malloc(n);fp.set(e,i),t=t||Number(Jc.exports.ZSTD_findDecompressedSize(i,n));const o=Jc.exports.malloc(t),a=Jc.exports.ZSTD_decompress(o,t,i,n),c=fp.slice(o,o+a);return Jc.exports.free(i),Jc.exports.free(o),c}}const Iy="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Py=new WeakMap;let w_,x_=0;class Ec extends p.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ty,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new p.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new p.hH6(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([o,a])=>{const c=Ec.BasisWorker,u=["/* constants */","let _EngineFormat = "+JSON.stringify(Ec.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Ec.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ec.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const d=new Worker(this.workerSourceURL),m=this.transcoderBinary.slice(0);return d.postMessage({type:"init",config:this.workerConfig,transcoderBinary:m},[m]),d})}),x_>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),x_++}return this.transcoderPending}load(e,t,n,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new p.hH6(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,a=>{if(Py.has(a))return Py.get(a).promise.then(t).catch(i);this.createTexture(a).then(c=>t?t(c):null).catch(i)},n,i)}_createTextureFrom(e,t){const{mipmaps:n,width:i,height:o,format:a,type:c,error:u,dfdTransferFn:d,dfdFlags:m}=e;if(c==="error")return Promise.reject(u);const g=t.layerCount>1?new p.Z_g(n,i,o,t.layerCount,a,p.ywz):new p.EB7(n,i,o,a,p.ywz);return g.minFilter=n.length===1?p.wem:p.D1R,g.magFilter=p.wem,g.generateMipmaps=!1,g.needsUpdate=!0,g.colorSpace=d===2?p.KI_:p.aCh,g.premultiplyAlpha=!!(1&m),g}async createTexture(e,t={}){const n=function(a){const c=new Uint8Array(a.buffer,a.byteOffset,Io.length);if(c[0]!==Io[0]||c[1]!==Io[1]||c[2]!==Io[2]||c[3]!==Io[3]||c[4]!==Io[4]||c[5]!==Io[5]||c[6]!==Io[6]||c[7]!==Io[7]||c[8]!==Io[8]||c[9]!==Io[9]||c[10]!==Io[10]||c[11]!==Io[11])throw new Error("Missing KTX 2.0 identifier.");const u=new lw,d=17*Uint32Array.BYTES_PER_ELEMENT,m=new Vf(a,Io.length,d,!0);u.vkFormat=m._nextUint32(),u.typeSize=m._nextUint32(),u.pixelWidth=m._nextUint32(),u.pixelHeight=m._nextUint32(),u.pixelDepth=m._nextUint32(),u.layerCount=m._nextUint32(),u.faceCount=m._nextUint32();const g=m._nextUint32();u.supercompressionScheme=m._nextUint32();const _=m._nextUint32(),w=m._nextUint32(),x=m._nextUint32(),T=m._nextUint32(),I=m._nextUint64(),R=m._nextUint64(),M=new Vf(a,Io.length+d,3*g*8,!0);for(let kt=0;kt<g;kt++)u.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+M._nextUint64(),M._nextUint64()),uncompressedByteLength:M._nextUint64()});const C=new Vf(a,_,w,!0),L={vendorId:C._skip(4)._nextUint16(),descriptorType:C._nextUint16(),versionNumber:C._nextUint16(),descriptorBlockSize:C._nextUint16(),colorModel:C._nextUint8(),colorPrimaries:C._nextUint8(),transferFunction:C._nextUint8(),flags:C._nextUint8(),texelBlockDimension:[C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8()],bytesPlane:[C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8()],samples:[]},k=(L.descriptorBlockSize/4-6)/4;for(let kt=0;kt<k;kt++){const Pt={bitOffset:C._nextUint16(),bitLength:C._nextUint8(),channelType:C._nextUint8(),samplePosition:[C._nextUint8(),C._nextUint8(),C._nextUint8(),C._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Pt.channelType?(Pt.sampleLower=C._nextInt32(),Pt.sampleUpper=C._nextInt32()):(Pt.sampleLower=C._nextUint32(),Pt.sampleUpper=C._nextUint32()),L.samples[kt]=Pt}u.dataFormatDescriptor.length=0,u.dataFormatDescriptor.push(L);const j=new Vf(a,x,T,!0);for(;j._offset<T;){const kt=j._nextUint32(),Pt=j._scan(kt),sn=cw(Pt),hn=j._scan(kt-Pt.byteLength);u.keyValue[sn]=sn.match(/^ktx/i)?cw(hn):hn,j._offset%4&&j._skip(4-j._offset%4)}if(R<=0)return u;const H=new Vf(a,I,R,!0),X=H._nextUint16(),ee=H._nextUint16(),oe=H._nextUint32(),re=H._nextUint32(),he=H._nextUint32(),le=H._nextUint32(),ue=[];for(let kt=0;kt<g;kt++)ue.push({imageFlags:H._nextUint32(),rgbSliceByteOffset:H._nextUint32(),rgbSliceByteLength:H._nextUint32(),alphaSliceByteOffset:H._nextUint32(),alphaSliceByteLength:H._nextUint32()});const ge=I+H._offset,_e=ge+oe,Ee=_e+re,Ye=Ee+he,We=new Uint8Array(a.buffer,a.byteOffset+ge,oe),Et=new Uint8Array(a.buffer,a.byteOffset+_e,re),lt=new Uint8Array(a.buffer,a.byteOffset+Ee,he),rt=new Uint8Array(a.buffer,a.byteOffset+Ye,le);return u.globalData={endpointCount:X,selectorCount:ee,imageDescs:ue,endpointsData:We,selectorsData:Et,tablesData:lt,extendedData:rt},u}(new Uint8Array(e));if(n.vkFormat!==0)return async function(a){const{vkFormat:c,pixelWidth:u,pixelHeight:d,pixelDepth:m}=a;if(Ry[c]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const g=a.levels[0];let _,w;if(a.supercompressionScheme===0)_=g.levelData;else{if(a.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");w_||(w_=new Promise(async T=>{const I=new oE;await I.init(),T(I)})),_=(await w_).decode(g.levelData,g.uncompressedByteLength)}w=Gf[c]===p.VzW?new Float32Array(_.buffer,_.byteOffset,_.byteLength/Float32Array.BYTES_PER_ELEMENT):Gf[c]===p.cLu?new Uint16Array(_.buffer,_.byteOffset,_.byteLength/Uint16Array.BYTES_PER_ELEMENT):_;const x=m===0?new p.IEO(w,u,d):new p.JUT(w,u,d,m);return x.type=Gf[c],x.format=Ry[c],x.colorSpace=E_[c]||p.aCh,x.needsUpdate=!0,Promise.resolve(x)}(n);const i=t,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e])).then(a=>this._createTextureFrom(a.data,n));return Py.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),x_--,this}}Ec.BasisFormat={ETC1S:0,UASTC_4x4:1},Ec.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Ec.EngineFormat={RGBAFormat:p.wk1,RGBA_ASTC_4x4_Format:p.ptH,RGBA_BPTC_Format:p.bsb,RGBA_ETC2_EAC_Format:p.ekQ,RGBA_PVRTC_4BPPV1_Format:p.eaV,RGBA_S3TC_DXT5_Format:p.ILR,RGB_ETC1_Format:p.fto,RGB_ETC2_Format:p.l0P,RGB_PVRTC_4BPPV1_Format:p._AM,RGB_S3TC_DXT1_Format:p.wuA},Ec.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						const buffers = [];

						for ( let i = 0; i < mipmaps.length; ++ i ) {

							buffers.push( mipmaps[ i ].data.buffer );

						}

						self.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layers = ktx2File.getLayers() || 1;
		const levels = ktx2File.getLevels();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levels ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const mipmaps = [];

		for ( let mip = 0; mip < levels; mip ++ ) {

			const layerMips = [];

			let mipWidth, mipHeight;

			for ( let layer = 0; layer < layers; layer ++ ) {

				const levelInfo = ktx2File.getImageLevelInfo( mip, layer, 0 );
				mipWidth = levelInfo.origWidth < 4 ? levelInfo.origWidth : levelInfo.width;
				mipHeight = levelInfo.origHeight < 4 ? levelInfo.origHeight : levelInfo.height;
				const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
				const status = ktx2File.transcodeImage(
					dst,
					mip,
					layer,
					0,
					transcoderFormat,
					0,
					- 1,
					- 1,
				);

				if ( ! status ) {

					cleanup();
					throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

				}

				layerMips.push( dst );

			}

			mipmaps.push( { data: concat( layerMips ), width: mipWidth, height: mipHeight } );

		}

		cleanup();

		return { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const Ry={109:p.wk1,97:p.wk1,37:p.wk1,43:p.wk1,103:p.av9,83:p.av9,16:p.av9,22:p.av9,100:p.hEm,76:p.hEm,15:p.hEm,9:p.hEm},Gf={109:p.VzW,97:p.cLu,37:p.ywz,43:p.ywz,103:p.VzW,83:p.cLu,16:p.ywz,22:p.ywz,100:p.VzW,76:p.cLu,15:p.ywz,9:p.ywz},E_={43:p.KI_,22:p.KI_,15:p.KI_},Pg="KHR_texture_basisu";class mp extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt]}async onAdded(e){var t,n,i,o,a,c;this._importer||(this._importer=new Br(class extends Ec{constructor(u){super(u),this.setTranscoderPath(mp.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(u,d){const m=new Uint8Array(u.slice(0)),g=await super.createTexture(u,d);return g.source._sourceImgBuffer=m,g.userData.mimeType="image/ktx2",g.toJSON=_=>vr(g,_,g.name,"image/ktx2"),g.clone=()=>{throw new Error("ktx2 texture cloning not supported")},g}},["ktx2"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer),(c=(a=(o=(i=e.getManager())==null?void 0:i.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:a.extensions)==null||c.push(uw)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}mp.PluginType="KTX2LoadPlugin",mp.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const uw=s=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0&&t.source!==null)return void console.warn("ktx2 export: source already set");const n=e.source._sourceImgBuffer||e.userData.__sourceBuffer;if(!n)return void console.warn("ktx2 export: no source buffer for ktx2");t.extensions=t.extensions||{};const i={},o=new Blob([n],{type:"image/ktx2"});i.source=s.processImageBlob(o,e),t.extensions[Pg]=i,s.extensionsUsed[Pg]=!0}});class Uu extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postRender)}addTexture(e,t,n,i,o,a="postRender",c=!1){var u;this._generators.has(a)||this._generators.set(a,[]),(u=this._generators.get(a))==null||u.push({key:e,fn:t,rect:n?[...n]:void 0,frag:o||i||c?new p.jyz({vertexShader:qe.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:o??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${c?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${c?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${i??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,t="postRender"){var n;this._generators.set(t,((n=this._generators.get(t))==null?void 0:n.filter(i=>i.key!==e))??[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var i;const t=this._viewer,n=t==null?void 0:t.renderer;n&&t&&((i=this._generators.get(e))==null||i.forEach(({key:o,fn:a,rect:c,frag:u})=>{const d=a(t);if(d){if(d.image&&c){const m=d.image.width/d.image.height;c[2]<1&&c[3]<1&&(c[2]=200),c[2]<1&&(c[2]=c[3]*m),c[3]<1&&(c[3]=c[2]/m)}n.blit(d,void 0,{viewport:c,clear:!1,material:u})}}))}}Uu.PluginType="debug";class hw extends p.aNw{constructor(e){super(e)}load(e,t,n,i){const o=this,a=this.path===""?p.Zp0.extractUrlBase(e):this.path,c=new p.hH6(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(u){try{t(o.parse(u,a))}catch(d){i?i(d):console.error(d),o.manager.itemError(e)}},n,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let i={};const o=/\s+/,a={};for(let u=0;u<n.length;u++){let d=n[u];if(d=d.trim(),d.length===0||d.charAt(0)==="#")continue;const m=d.indexOf(" ");let g=m>=0?d.substring(0,m):d;g=g.toLowerCase();let _=m>=0?d.substring(m+1):"";if(_=_.trim(),g==="newmtl")i={name:_},a[_]=i;else if(g==="ka"||g==="kd"||g==="ks"||g==="ke"){const w=_.split(o,3);i[g]=[parseFloat(w[0]),parseFloat(w[1]),parseFloat(w[2])]}else i[g]=_}const c=new dw(this.resourcePath||t,this.materialOptions);return c.setCrossOrigin(this.crossOrigin),c.setManager(this.manager),c.setMaterials(a),c}}class dw{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:p.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:p.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const i=e[n],o={};t[n]=o;for(const a in i){let c=!0,u=i[a];const d=a.toLowerCase();switch(d){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(u=[u[0]/255,u[1]/255,u[2]/255]),this.options&&this.options.ignoreZeroRGBs&&u[0]===0&&u[1]===0&&u[2]===0&&(c=!1)}c&&(o[d]=u)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,n=this.materialsInfo[e],i={name:e,side:this.side};async function o(u,d){if(i[u])return;const m=t.getTextureParams(d,i);return new Promise((g,_)=>{let w=!1,x=()=>!w&&(w=!0)&&g();const T=t.loadTexture((I=t.baseUrl,typeof(R=m.url)!="string"||R===""?"":/^https?:\/\//i.test(R)?R:I+R),void 0,M=>{i[u]=M,x()},void 0,x);var I,R;setTimeout(x,50),T.repeat.copy(m.scale),T.offset.copy(m.offset),T.wrapS=t.wrap,T.wrapT=t.wrap,u!=="map"&&u!=="emissiveMap"||(T.colorSpace=p.KI_)})}const a=Array.from(Object.keys(n||{}));let c=a.includes("d")||a.includes("D");for(const u of a){const d=n[u];let m;if(d!=="")switch(u.toLowerCase()){case"kd":i.color=new p.Ilk().fromArray(d).convertSRGBToLinear();break;case"ks":i.specular=new p.Ilk().fromArray(d).convertSRGBToLinear();break;case"ke":i.emissive=new p.Ilk().fromArray(d).convertSRGBToLinear();break;case"map_kd":await o("map",d);break;case"map_ks":await o("specularMap",d);break;case"map_ke":await o("emissiveMap",d);break;case"norm":await o("normalMap",d);break;case"map_bump":case"bump":await o("bumpMap",d);break;case"map_d":await o("alphaMap",d),i.transparent=!0;break;case"ns":i.shininess=parseFloat(d);break;case"d":m=parseFloat(d),m<1&&(i.opacity=m,i.transparent=!0);break;case"tr":if(c)break;m=parseFloat(d),this.options&&this.options.invertTrProperty&&(m=1-m),m>0&&(i.opacity=1-m,i.transparent=!0)}}return this.materials[e]=new p.xoR(i),this.materials[e]}getTextureParams(e,t){const n={scale:new p.FM8(1,1),offset:new p.FM8(0,0)},i=e.split(/\s+/);let o;return o=i.indexOf("-bm"),o>=0&&(t.bumpScale=parseFloat(i[o+1]),i.splice(o,2)),o=i.indexOf("-s"),o>=0&&(n.scale.set(parseFloat(i[o+1]),parseFloat(i[o+2])),i.splice(o,4)),o=i.indexOf("-o"),o>=0&&(n.offset.set(parseFloat(i[o+1]),parseFloat(i[o+2])),i.splice(o,4)),n.url=i.join(" ").trim(),n}loadTexture(e,t,n,i,o){const a=this.manager!==void 0?this.manager:p.tEQ;let c=a.getHandler(e);c===null&&(c=new p.dpR(a)),c.setCrossOrigin&&c.setCrossOrigin(this.crossOrigin);const u=c.load(e,n,i,o);return t!==void 0&&(u.mapping=t),u}}const pw=/^[og]\s*(.+)?/,aE=/^mtllib /,S_=/^usemtl /,Dy=/^usemap /,fw=/\s+/,mw=new p.Pa4,By=new p.Pa4,Oy=new p.Pa4,Ly=new p.Pa4,co=new p.Pa4,C_=new p.Ilk;function gw(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,o){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const c={index:this.materials.length,name:i||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(u){const d={index:typeof u=="number"?u:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return d.clone=this.clone.bind(d),d}};return this.materials.push(c),c},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),i&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},n&&n.name&&typeof n.clone=="function"){const i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const i=this.vertices,o=this.object.geometry.vertices;o.push(i[e+0],i[e+1],i[e+2]),o.push(i[t+0],i[t+1],i[t+2]),o.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,o=this.object.geometry.normals;o.push(i[e+0],i[e+1],i[e+2]),o.push(i[t+0],i[t+1],i[t+2]),o.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,o=this.object.geometry.normals;mw.fromArray(i,e),By.fromArray(i,t),Oy.fromArray(i,n),co.subVectors(Oy,By),Ly.subVectors(mw,By),co.cross(Ly),co.normalize(),o.push(co.x,co.y,co.z),o.push(co.x,co.y,co.z),o.push(co.x,co.y,co.z)},addColor:function(e,t,n){const i=this.colors,o=this.object.geometry.colors;i[e]!==void 0&&o.push(i[e+0],i[e+1],i[e+2]),i[t]!==void 0&&o.push(i[t+0],i[t+1],i[t+2]),i[n]!==void 0&&o.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,o=this.object.geometry.uvs;o.push(i[e+0],i[e+1]),o.push(i[t+0],i[t+1]),o.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,o,a,c,u,d){const m=this.vertices.length;let g=this.parseVertexIndex(e,m),_=this.parseVertexIndex(t,m),w=this.parseVertexIndex(n,m);if(this.addVertex(g,_,w),this.addColor(g,_,w),c!==void 0&&c!==""){const x=this.normals.length;g=this.parseNormalIndex(c,x),_=this.parseNormalIndex(u,x),w=this.parseNormalIndex(d,x),this.addNormal(g,_,w)}else this.addFaceNormal(g,_,w);if(i!==void 0&&i!==""){const x=this.uvs.length;g=this.parseUVIndex(i,x),_=this.parseUVIndex(o,x),w=this.parseUVIndex(a,x),this.addUV(g,_,w),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const o=this.parseVertexIndex(e[n],t);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));for(let o=0,a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],i))}};return s.startObject("",!1),s}class ky extends p.aNw{constructor(e){super(e),this.materials=null}load(e,t,n,i){const o=this,a=new p.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,async function(c){try{t(await o.parse(c))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},n,i)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new gw;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let i=[];for(let a=0,c=n.length;a<c;a++){const u=n[a].trimStart();if(u.length===0)continue;const d=u.charAt(0);if(d!=="#")if(d==="v"){const m=u.split(fw);switch(m[0]){case"v":t.vertices.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),m.length>=7?(C_.setRGB(parseFloat(m[4]),parseFloat(m[5]),parseFloat(m[6])).convertSRGBToLinear(),t.colors.push(C_.r,C_.g,C_.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case"vt":t.uvs.push(parseFloat(m[1]),parseFloat(m[2]))}}else if(d==="f"){const m=u.slice(1).trim().split(fw),g=[];for(let w=0,x=m.length;w<x;w++){const T=m[w];if(T.length>0){const I=T.split("/");g.push(I)}}const _=g[0];for(let w=1,x=g.length-1;w<x;w++){const T=g[w],I=g[w+1];t.addFace(_[0],T[0],I[0],_[1],T[1],I[1],_[2],T[2],I[2])}}else if(d==="l"){const m=u.substring(1).trim().split(" ");let g=[];const _=[];if(u.indexOf("/")===-1)g=m;else for(let w=0,x=m.length;w<x;w++){const T=m[w].split("/");T[0]!==""&&g.push(T[0]),T[1]!==""&&_.push(T[1])}t.addLineGeometry(g,_)}else if(d==="p"){const m=u.slice(1).trim().split(" ");t.addPointGeometry(m)}else if((i=pw.exec(u))!==null){const m=(" "+i[0].slice(1).trim()).slice(1);t.startObject(m)}else if(S_.test(u))t.object.startMaterial(u.substring(7).trim(),t.materialLibraries);else if(aE.test(u)){t.materialLibraries.push(u.substring(7).trim());const m=u.substring(7).trim(),g=this.manager.getHandler(m);if(g){const _=await g.loadAsync(m).catch(w=>{console.warn(w)});_&&this.setMaterials(_)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(Dy.test(u))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(d==="s"){if(i=u.split(" "),i.length>1){const g=i[1].trim().toLowerCase();t.object.smooth=g!=="0"&&g!=="off"}else t.object.smooth=!0;const m=t.object.currentMaterial();m&&(m.smooth=t.object.smooth)}else{if(u==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+u+'"')}}t.finalize();const o=new p.ZAu;if(o.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let a=0,c=t.objects.length;a<c;a++){const u=t.objects[a],d=u.geometry,m=u.materials,g=d.type==="Line",_=d.type==="Points";let w=!1;if(d.vertices.length===0)continue;const x=new p.u9r;x.setAttribute("position",new p.a$l(d.vertices,3)),d.normals.length>0&&x.setAttribute("normal",new p.a$l(d.normals,3)),d.colors.length>0&&(w=!0,x.setAttribute("color",new p.a$l(d.colors,3))),d.hasUVIndices===!0&&x.setAttribute("uv",new p.a$l(d.uvs,2));const T=[];for(let R=0,M=m.length;R<M;R++){const C=m[R],L=C.name+"_"+C.smooth+"_"+w;let k=t.materials[L];if(this.materials!==null)if(k=await this.materials.create(C.name),!g||!k||k instanceof p.nls){if(_&&k&&!(k instanceof p.UY4)){const j=new p.UY4({size:10,sizeAttenuation:!1});p.F5T.prototype.copy.call(j,k),j.color.copy(k.color),j.map=k.map,k=j}}else{const j=new p.nls;p.F5T.prototype.copy.call(j,k),j.color.copy(k.color),k=j}k===void 0&&(k=g?new p.nls:_?new p.UY4({size:1,sizeAttenuation:!1}):new p.xoR,k.name=C.name,k.flatShading=!C.smooth,k.vertexColors=w,t.materials[L]=k),T.push(k)}let I;if(T.length>1){for(let R=0,M=m.length;R<M;R++){const C=m[R];x.addGroup(C.groupStart,C.groupCount,R)}I=g?new p.ejS(x,T):_?new p.woe(x,T):new p.Kj0(x,T)}else I=g?new p.ejS(x,T[0]):_?new p.woe(x,T[0]):new p.Kj0(x,T[0]);I.name=u.name,o.add(I)}else if(t.vertices.length>0){const a=new p.UY4({size:1,sizeAttenuation:!1}),c=new p.u9r;c.setAttribute("position",new p.a$l(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(c.setAttribute("color",new p.a$l(t.colors,3)),a.vertexColors=!0);const u=new p.woe(c,a);o.add(u)}return o}}class Nu extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt],this._importer1=new Br(ky,["obj"],!0),this._importer2=new Br(hw,["mtl"],!1)}async onAdded(e){var t,n,i,o;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer1),(o=(i=e.getManager())==null?void 0:i.importer)==null||o.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}Nu.PluginType="ObjMtlLoadPlugin";var Uy=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))};try{URL.revokeObjectURL(Uy(""))}catch{Uy=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var wa=Uint8Array,Cs=Uint16Array,Rg=Uint32Array,Dg=new wa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Zc=new wa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),M_=new wa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vw=function(s,e){for(var t=new Cs(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];var i=new Rg(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return[t,i]},Qh=vw(Dg,2),_w=Qh[0],Ny=Qh[1];_w[28]=258,Ny[258]=28;for(var Fy=vw(Zc,0),jy=Fy[0],yw=Fy[1],Bg=new Cs(32768),kr=0;kr<32768;++kr){var gp=(43690&kr)>>>1|(21845&kr)<<1;gp=(61680&(gp=(52428&gp)>>>2|(13107&gp)<<2))>>>4|(3855&gp)<<4,Bg[kr]=((65280&gp)>>>8|(255&gp)<<8)>>>1}var $c=function(s,e,t){for(var n=s.length,i=0,o=new Cs(e);i<n;++i)++o[s[i]-1];var a,c=new Cs(e);for(i=0;i<e;++i)c[i]=c[i-1]+o[i-1]<<1;if(t){a=new Cs(1<<e);var u=15-e;for(i=0;i<n;++i)if(s[i])for(var d=i<<4|s[i],m=e-s[i],g=c[s[i]-1]++<<m,_=g|(1<<m)-1;g<=_;++g)a[Bg[g]>>>u]=d}else for(a=new Cs(n),i=0;i<n;++i)s[i]&&(a[i]=Bg[c[s[i]-1]++]>>>15-s[i]);return a},Ui=new wa(288);for(kr=0;kr<144;++kr)Ui[kr]=8;for(kr=144;kr<256;++kr)Ui[kr]=9;for(kr=256;kr<280;++kr)Ui[kr]=7;for(kr=280;kr<288;++kr)Ui[kr]=8;var Og=new wa(32);for(kr=0;kr<32;++kr)Og[kr]=5;var Aw=$c(Ui,9,0),lE=$c(Ui,9,1),cE=$c(Og,5,0),zy=$c(Og,5,1),Vy=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Sc=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(7&e)&t},Gy=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(7&e)},Hy=function(s){return(s/8|0)+(7&s&&1)},bw=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Cs?Cs:s instanceof Rg?Rg:wa)(t-e);return n.set(s.subarray(e,t)),n},ww=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new wa(0);var i=!e||t,o=!t||t.i;t||(t={}),e||(e=new wa(3*n));var a=function(hn){var wn=e.length;if(hn>wn){var Xn=new wa(Math.max(2*wn,hn));Xn.set(e),e=Xn}},c=t.f||0,u=t.p||0,d=t.b||0,m=t.l,g=t.d,_=t.m,w=t.n,x=8*n;do{if(!m){t.f=c=Sc(s,u,1);var T=Sc(s,u+1,3);if(u+=3,!T){var I=s[(re=Hy(u)+4)-4]|s[re-3]<<8,R=re+I;if(R>n){if(o)throw"unexpected EOF";break}i&&a(d+I),e.set(s.subarray(re,R),d),t.b=d+=I,t.p=u=8*R;continue}if(T==1)m=lE,g=zy,_=9,w=5;else{if(T!=2)throw"invalid block type";var M=Sc(s,u,31)+257,C=Sc(s,u+10,15)+4,L=M+Sc(s,u+5,31)+1;u+=14;for(var k=new wa(L),j=new wa(19),H=0;H<C;++H)j[M_[H]]=Sc(s,u+3*H,7);u+=3*C;var X=Vy(j),ee=(1<<X)-1,oe=$c(j,X,1);for(H=0;H<L;){var re,he=oe[Sc(s,u,ee)];if(u+=15&he,(re=he>>>4)<16)k[H++]=re;else{var le=0,ue=0;for(re==16?(ue=3+Sc(s,u,3),u+=2,le=k[H-1]):re==17?(ue=3+Sc(s,u,7),u+=3):re==18&&(ue=11+Sc(s,u,127),u+=7);ue--;)k[H++]=le}}var ge=k.subarray(0,M),_e=k.subarray(M);_=Vy(ge),w=Vy(_e),m=$c(ge,_,1),g=$c(_e,w,1)}if(u>x){if(o)throw"unexpected EOF";break}}i&&a(d+131072);for(var Ee=(1<<_)-1,Ye=(1<<w)-1,We=u;;We=u){var Et=(le=m[Gy(s,u)&Ee])>>>4;if((u+=15&le)>x){if(o)throw"unexpected EOF";break}if(!le)throw"invalid length/literal";if(Et<256)e[d++]=Et;else{if(Et==256){We=u,m=null;break}var lt=Et-254;if(Et>264){var rt=Dg[H=Et-257];lt=Sc(s,u,(1<<rt)-1)+_w[H],u+=rt}var kt=g[Gy(s,u)&Ye],Pt=kt>>>4;if(!kt)throw"invalid distance";if(u+=15&kt,_e=jy[Pt],Pt>3&&(rt=Zc[Pt],_e+=Gy(s,u)&(1<<rt)-1,u+=rt),u>x){if(o)throw"unexpected EOF";break}i&&a(d+131072);for(var sn=d+lt;d<sn;d+=4)e[d]=e[d-_e],e[d+1]=e[d+1-_e],e[d+2]=e[d+2-_e],e[d+3]=e[d+3-_e];d=sn}}t.l=m,t.p=We,t.b=d,m&&(c=1,t.m=_,t.d=g,t.n=w)}while(!c);return d==e.length?e:bw(e,0,d)},Cc=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8},Lg=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},Qy=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var i=t.length,o=t.slice();if(!i)return[Wy,0];if(i==1){var a=new wa(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(k,j){return k.f-j.f}),t.push({s:-1,f:25001});var c=t[0],u=t[1],d=0,m=1,g=2;for(t[0]={s:-1,f:c.f+u.f,l:c,r:u};m!=i-1;)c=t[t[d].f<t[g].f?d++:g++],u=t[d!=m&&t[d].f<t[g].f?d++:g++],t[m++]={s:-1,f:c.f+u.f,l:c,r:u};var _=o[0].s;for(n=1;n<i;++n)o[n].s>_&&(_=o[n].s);var w=new Cs(_+1),x=T_(t[m-1],w,0);if(x>e){n=0;var T=0,I=x-e,R=1<<I;for(o.sort(function(k,j){return w[j.s]-w[k.s]||k.f-j.f});n<i;++n){var M=o[n].s;if(!(w[M]>e))break;T+=R-(1<<x-w[M]),w[M]=e}for(T>>>=I;T>0;){var C=o[n].s;w[C]<e?T-=1<<e-w[C]++-1:++n}for(;n>=0&&T;--n){var L=o[n].s;w[L]==e&&(--w[L],++T)}x=e}return[new wa(w),x]},T_=function(s,e,t){return s.s==-1?Math.max(T_(s.l,e,t+1),T_(s.r,e,t+1)):e[s.s]=t},xw=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Cs(++e),n=0,i=s[0],o=1,a=function(u){t[n++]=u},c=1;c<=e;++c)if(s[c]==i&&c!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(i),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(i);o=1,i=s[c]}return[t.subarray(0,n),e]},Hf=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},vp=function(s,e,t){var n=t.length,i=Hy(e+2);s[i]=255&n,s[i+1]=n>>>8,s[i+2]=255^s[i],s[i+3]=255^s[i+1];for(var o=0;o<n;++o)s[i+o+4]=t[o];return 8*(i+4+n)},Ew=function(s,e,t,n,i,o,a,c,u,d,m){Cc(e,m++,t),++i[256];for(var g=Qy(i,15),_=g[0],w=g[1],x=Qy(o,15),T=x[0],I=x[1],R=xw(_),M=R[0],C=R[1],L=xw(T),k=L[0],j=L[1],H=new Cs(19),X=0;X<M.length;++X)H[31&M[X]]++;for(X=0;X<k.length;++X)H[31&k[X]]++;for(var ee=Qy(H,7),oe=ee[0],re=ee[1],he=19;he>4&&!oe[M_[he-1]];--he);var le,ue,ge,_e,Ee=d+5<<3,Ye=Hf(i,Ui)+Hf(o,Og)+a,We=Hf(i,_)+Hf(o,T)+a+14+3*he+Hf(H,oe)+(2*H[16]+3*H[17]+7*H[18]);if(Ee<=Ye&&Ee<=We)return vp(e,m,s.subarray(u,u+d));if(Cc(e,m,1+(We<Ye)),m+=2,We<Ye){le=$c(_,w,0),ue=_,ge=$c(T,I,0),_e=T;var Et=$c(oe,re,0);for(Cc(e,m,C-257),Cc(e,m+5,j-1),Cc(e,m+10,he-4),m+=14,X=0;X<he;++X)Cc(e,m+3*X,oe[M_[X]]);m+=3*he;for(var lt=[M,k],rt=0;rt<2;++rt){var kt=lt[rt];for(X=0;X<kt.length;++X){var Pt=31&kt[X];Cc(e,m,Et[Pt]),m+=oe[Pt],Pt>15&&(Cc(e,m,kt[X]>>>5&127),m+=kt[X]>>>12)}}}else le=Aw,ue=Ui,ge=cE,_e=Og;for(X=0;X<c;++X)if(n[X]>255){Pt=n[X]>>>18&31,Lg(e,m,le[Pt+257]),m+=ue[Pt+257],Pt>7&&(Cc(e,m,n[X]>>>23&31),m+=Dg[Pt]);var sn=31&n[X];Lg(e,m,ge[sn]),m+=_e[sn],sn>3&&(Lg(e,m,n[X]>>>5&8191),m+=Zc[sn])}else Lg(e,m,le[n[X]]),m+=ue[n[X]];return Lg(e,m,le[256]),m+ue[256]},Sw=new Rg([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Wy=new wa(0),Wh=function(){var s=1,e=0;return{p:function(t){for(var n=s,i=e,o=t.length,a=0;a!=o;){for(var c=Math.min(a+2655,o);a<c;++a)i+=n+=t[a];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}s=n,e=i},d:function(){return(255&(s%=65521))<<24|s>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},I_=function(s,e,t,n,i){return function(o,a,c,u,d,m){var g=o.length,_=new wa(u+g+5*(1+Math.ceil(g/7e3))+d),w=_.subarray(u,_.length-d),x=0;if(!a||g<8)for(var T=0;T<=g;T+=65535){var I=T+65535;I<g?x=vp(w,x,o.subarray(T,I)):(w[T]=m,x=vp(w,x,o.subarray(T,g)))}else{for(var R=Sw[a-1],M=R>>>13,C=8191&R,L=(1<<c)-1,k=new Cs(32768),j=new Cs(L+1),H=Math.ceil(c/3),X=2*H,ee=function(ni){return(o[ni]^o[ni+1]<<H^o[ni+2]<<X)&L},oe=new Rg(25e3),re=new Cs(288),he=new Cs(32),le=0,ue=0,ge=(T=0,0),_e=0,Ee=0;T<g;++T){var Ye=ee(T),We=32767&T,Et=j[Ye];if(k[We]=Et,j[Ye]=We,_e<=T){var lt=g-T;if((le>7e3||ge>24576)&&lt>423){x=Ew(o,w,0,oe,re,he,ue,ge,Ee,T-Ee,x),ge=le=ue=0,Ee=T;for(var rt=0;rt<286;++rt)re[rt]=0;for(rt=0;rt<30;++rt)he[rt]=0}var kt=2,Pt=0,sn=C,hn=We-Et&32767;if(lt>2&&Ye==ee(T-hn))for(var wn=Math.min(M,lt)-1,Xn=Math.min(32767,T),zn=Math.min(258,lt);hn<=Xn&&--sn&&We!=Et;){if(o[T+kt]==o[T+kt-hn]){for(var Gn=0;Gn<zn&&o[T+Gn]==o[T+Gn-hn];++Gn);if(Gn>kt){if(kt=Gn,Pt=hn,Gn>wn)break;var gt=Math.min(hn,Gn-2),zt=0;for(rt=0;rt<gt;++rt){var an=T-hn+rt+32768&32767,ui=an-k[an]+32768&32767;ui>zt&&(zt=ui,Et=an)}}}hn+=(We=Et)-(Et=k[We])+32768&32767}if(Pt){oe[ge++]=268435456|Ny[kt]<<18|yw[Pt];var Ri=31&Ny[kt],_i=31&yw[Pt];ue+=Dg[Ri]+Zc[_i],++re[257+Ri],++he[_i],_e=T+kt,++le}else oe[ge++]=o[T],++re[o[T]]}}x=Ew(o,w,m,oe,re,he,ue,ge,Ee,T-Ee,x),!m&&7&x&&(x=vp(w,x+1,Wy))}return bw(_,0,u+Hy(x)+d)}(s,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):12+e.mem,t,n,!i)},qy=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},uE=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;s[0]=120,s[1]=n<<6|(n?32-2*n:1)},Cw=function(s){if((15&s[0])!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(32&s[1])throw"invalid zlib data: preset dictionaries not supported"};function kg(s,e){return ww((Cw(s),s.subarray(2,-4)),e)}var hE=typeof TextDecoder<"u"&&new TextDecoder;try{hE.decode(Wy,{stream:!0})}catch{}function Xy(s,e,t){const n=t.length-s-1;if(e>=t[n])return n-1;if(e<=t[s])return s;let i=s,o=n,a=Math.floor((i+o)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?o=a:i=a,a=Math.floor((i+o)/2);return a}function Mw(s,e){let t=1;for(let i=2;i<=s;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=s-e;++i)n*=i;return t/n}class dE extends p.Hyl{constructor(e,t,n,i,o){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<n.length;++a){const c=n[a];this.controlPoints[a]=new p.Ltg(c.x,c.y,c.z,c.w)}}getPoint(e,t=new p.Pa4){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=function(a,c,u,d){const m=Xy(a,d,c),g=function(w,x,T,I){const R=[],M=[],C=[];R[0]=1;for(let L=1;L<=T;++L){M[L]=x-I[w+1-L],C[L]=I[w+L]-x;let k=0;for(let j=0;j<L;++j){const H=C[j+1],X=M[L-j],ee=R[j]/(H+X);R[j]=k+H*ee,k=X*ee}R[L]=k}return R}(m,d,a,c),_=new p.Ltg(0,0,0,0);for(let w=0;w<=a;++w){const x=u[m-a+w],T=g[w],I=x.w*T;_.x+=x.x*I,_.y+=x.y*I,_.z+=x.z*I,_.w+=x.w*T}return _}(this.degree,this.knots,this.controlPoints,i);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(e,t=new p.Pa4){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=function(a,c,u,d,m){const g=function(_,w,x,T,I){const R=I<_?I:_,M=[],C=Xy(_,T,w),L=function(j,H,X,ee,oe){const re=[];for(let Ee=0;Ee<=X;++Ee)re[Ee]=0;const he=[];for(let Ee=0;Ee<=ee;++Ee)he[Ee]=re.slice(0);const le=[];for(let Ee=0;Ee<=X;++Ee)le[Ee]=re.slice(0);le[0][0]=1;const ue=re.slice(0),ge=re.slice(0);for(let Ee=1;Ee<=X;++Ee){ue[Ee]=H-oe[j+1-Ee],ge[Ee]=oe[j+Ee]-H;let Ye=0;for(let We=0;We<Ee;++We){const Et=ge[We+1],lt=ue[Ee-We];le[Ee][We]=Et+lt;const rt=le[We][Ee-1]/le[Ee][We];le[We][Ee]=Ye+Et*rt,Ye=lt*rt}le[Ee][Ee]=Ye}for(let Ee=0;Ee<=X;++Ee)he[0][Ee]=le[Ee][X];for(let Ee=0;Ee<=X;++Ee){let Ye=0,We=1;const Et=[];for(let lt=0;lt<=X;++lt)Et[lt]=re.slice(0);Et[0][0]=1;for(let lt=1;lt<=ee;++lt){let rt=0;const kt=Ee-lt,Pt=X-lt;Ee>=lt&&(Et[We][0]=Et[Ye][0]/le[Pt+1][kt],rt=Et[We][0]*le[kt][Pt]);const sn=Ee-1<=Pt?lt-1:X-Ee;for(let wn=kt>=-1?1:-kt;wn<=sn;++wn)Et[We][wn]=(Et[Ye][wn]-Et[Ye][wn-1])/le[Pt+1][kt+wn],rt+=Et[We][wn]*le[kt+wn][Pt];Ee<=Pt&&(Et[We][lt]=-Et[Ye][lt-1]/le[Pt+1][Ee],rt+=Et[We][lt]*le[Ee][Pt]),he[lt][Ee]=rt;const hn=Ye;Ye=We,We=hn}}let _e=X;for(let Ee=1;Ee<=ee;++Ee){for(let Ye=0;Ye<=X;++Ye)he[Ee][Ye]*=_e;_e*=X-Ee}return he}(C,T,_,R,w),k=[];for(let j=0;j<x.length;++j){const H=x[j].clone(),X=H.w;H.x*=X,H.y*=X,H.z*=X,k[j]=H}for(let j=0;j<=R;++j){const H=k[C-_].clone().multiplyScalar(L[j][0]);for(let X=1;X<=_;++X)H.add(k[C-_+X].clone().multiplyScalar(L[j][X]));M[j]=H}for(let j=R+1;j<=I+1;++j)M[j]=new p.Ltg(0,0,0);return M}(a,c,u,d,m);return function(_){const w=_.length,x=[],T=[];for(let R=0;R<w;++R){const M=_[R];x[R]=new p.Pa4(M.x,M.y,M.z),T[R]=M.w}const I=[];for(let R=0;R<w;++R){const M=x[R].clone();for(let C=1;C<=R;++C)M.sub(I[R-C].clone().multiplyScalar(Mw(R,C)*T[C]));I[R]=M.divideScalar(T[0])}return I}(g)}(this.degree,this.knots,this.controlPoints,i,1);return n.copy(o[1]).normalize(),n}}let Ni,us,Qo;class P_ extends p.aNw{constructor(e){super(e)}load(e,t,n,i){const o=this,a=o.path===""?p.Zp0.extractUrlBase(e):o.path,c=new p.hH6(this.manager);c.setPath(o.path),c.setResponseType("arraybuffer"),c.setRequestHeader(o.requestHeader),c.setWithCredentials(o.withCredentials),c.load(e,function(u){try{t(o.parse(u,a))}catch(d){i?i(d):console.error(d),o.manager.itemError(e)}},n,i)}parse(e,t){if(function(o){const a="Kaydara FBX Binary  \0";return o.byteLength>=a.length&&a===Dw(o,0,a.length)}(e))Ni=new fE().parse(e);else{const o=Dw(e);if(!function(a){const c=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let u=0;function d(m){const g=a[m-1];return a=a.slice(u+m),u++,g}for(let m=0;m<c.length;++m)if(d(1)===c[m])return!1;return!0}(o))throw new Error("THREE.FBXLoader: Unknown format.");if(Iw(o)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Iw(o));Ni=new hs().parse(o)}const n=new p.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),i=new Tw(n,this.manager).parse(Ni);return Ni=null,us=null,Qo=null,i}}class Tw{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){us=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),o=new pE().parse(i);return this.parseScene(i,o,n),Qo}parseConnections(){const e=new Map;return"Connections"in Ni&&Ni.Connections.connections.forEach(function(t){const n=t[0],i=t[1],o=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:i,relationship:o};e.get(n).parents.push(a),e.has(i)||e.set(i,{parents:[],children:[]});const c={ID:n,relationship:o};e.get(i).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in Ni.Objects){const n=Ni.Objects.Video;for(const i in n){const o=n[i];if(e[parseInt(i)]=o.RelativeFilename||o.Filename,"Content"in o){const a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(a||c){const u=this.parseImage(n[i]);t[o.RelativeFilename||o.Filename]=u}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(i){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if(typeof t=="string")return"data:"+o+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:o}))}}parseTextures(e){const t=new Map;if("Texture"in Ni.Objects){const n=Ni.Objects.Texture;for(const i in n){const o=this.parseTexture(n[i],e);t.set(parseInt(i),o)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,o=e.WrapModeV,a=i!==void 0?i.value:0,c=o!==void 0?o.value:0;if(n.wrapS=a===0?p.rpg:p.uWy,n.wrapT=c===0?p.rpg:p.uWy,"Scaling"in e){const u=e.Scaling.value;n.repeat.x=u[0],n.repeat.y=u[1]}if("Translation"in e){const u=e.Translation.value;n.offset.x=u[0],n.offset.y=u[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,o=us.get(e.id).children;let a;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(n=t[o[0].ID],n.indexOf("blob:")!==0&&n.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const c=e.FileName.slice(-3).toLowerCase();if(c==="tga"){const u=this.manager.getHandler(".tga");u===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new p.xEZ):(u.setPath(this.textureLoader.path),a=u.load(n))}else c==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new p.xEZ):a=this.textureLoader.load(n);return this.textureLoader.setPath(i),a}parseMaterials(e){const t=new Map;if("Material"in Ni.Objects){const n=Ni.Objects.Material;for(const i in n){const o=this.parseMaterial(n[i],e);o!==null&&t.set(parseInt(i),o)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!us.has(n))return null;const a=this.parseParameters(e,t,n);let c;switch(o.toLowerCase()){case"phong":c=new p.xoR;break;case"lambert":c=new p.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),c=new p.xoR}return c.setValues(a),c.name=i,c}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new p.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(i.color=new p.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new p.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(i.emissive=new p.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new p.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new p.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return us.get(n).children.forEach(function(a){const c=a.relationship;switch(c){case"Bump":i.bumpMap=o.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(t,a.ID),i.map!==void 0&&(i.map.colorSpace=p.KI_);break;case"DisplacementColor":i.displacementMap=o.getTexture(t,a.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(t,a.ID),i.emissiveMap!==void 0&&(i.emissiveMap.colorSpace=p.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(t,a.ID);break;case"ReflectionColor":i.envMap=o.getTexture(t,a.ID),i.envMap!==void 0&&(i.envMap.mapping=p.dSO,i.envMap.colorSpace=p.KI_);break;case"SpecularColor":i.specularMap=o.getTexture(t,a.ID),i.specularMap!==void 0&&(i.specularMap.colorSpace=p.KI_);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=o.getTexture(t,a.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",c)}}),i}getTexture(e,t){return"LayeredTexture"in Ni.Objects&&t in Ni.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=us.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ni.Objects){const n=Ni.Objects.Deformer;for(const i in n){const o=n[i],a=us.get(parseInt(i));if(o.attrType==="Skin"){const c=this.parseSkeleton(a,n);c.ID=i,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=a.parents[0].ID,e[i]=c}else if(o.attrType==="BlendShape"){const c={id:i};c.rawTargets=this.parseMorphTargets(a,n),c.id=i,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=c}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(i){const o=t[i.ID];if(o.attrType!=="Cluster")return;const a={ID:i.ID,indices:[],weights:[],transformLink:new p.yGw().fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),n.push(a)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const o=e.children[i],a=t[o.ID],c={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;c.geoID=us.get(parseInt(o.ID)).children.filter(function(u){return u.relationship===void 0})[0].ID,n.push(c)}return n}parseScene(e,t,n){Qo=new p.ZAu;const i=this.parseModels(e.skeletons,t,n),o=Ni.Objects.Model,a=this;i.forEach(function(u){const d=o[u.ID];a.setLookAtProperties(u,d),us.get(u.ID).parents.forEach(function(m){const g=i.get(m.ID);g!==void 0&&g.add(u)}),u.parent===null&&Qo.add(u)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Qo.traverse(function(u){if(u.userData.transformData){u.parent&&(u.userData.transformData.parentMatrix=u.parent.matrix,u.userData.transformData.parentMatrixWorld=u.parent.matrixWorld);const d=Pw(u.userData.transformData);u.applyMatrix4(d),u.updateWorldMatrix()}});const c=new R_().parse();Qo.children.length===1&&Qo.children[0].isGroup&&(Qo.children[0].animations=c,Qo=Qo.children[0]),Qo.animations=c}parseModels(e,t,n){const i=new Map,o=Ni.Objects.Model;for(const a in o){const c=parseInt(a),u=o[a],d=us.get(c);let m=this.buildSkeleton(d,e,c,u.attrName);if(!m){switch(u.attrType){case"Camera":m=this.createCamera(d);break;case"Light":m=this.createLight(d);break;case"Mesh":m=this.createMesh(d,t,n);break;case"NurbsCurve":m=this.createCurve(d,t);break;case"LimbNode":case"Root":m=new p.N$j;break;default:m=new p.ZAu}m.name=u.attrName?p.iUV.sanitizeNodeName(u.attrName):"",m.ID=c}this.getTransformData(m,u),i.set(c,m)}return i}buildSkeleton(e,t,n,i){let o=null;return e.parents.forEach(function(a){for(const c in t){const u=t[c];u.rawBones.forEach(function(d,m){if(d.ID===a.ID){const g=o;o=new p.N$j,o.matrixWorld.copy(d.transformLink),o.name=i?p.iUV.sanitizeNodeName(i):"",o.ID=n,u.bones[m]=o,g!==null&&o.add(g)}})}}),o}createCamera(e){let t,n;if(e.children.forEach(function(i){const o=Ni.Objects.NodeAttribute[i.ID];o!==void 0&&(n=o)}),n===void 0)t=new p.Tme;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let a=1e3;n.FarPlane!==void 0&&(a=n.FarPlane.value/1e3);let c=window.innerWidth,u=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(c=n.AspectWidth.value,u=n.AspectHeight.value);const d=c/u;let m=45;n.FieldOfView!==void 0&&(m=n.FieldOfView.value);const g=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new p.cPb(m,d,o,a),g!==null&&t.setFocalLength(g);break;case 1:t=new p.iKG(-c/2,c/2,u/2,-u/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new p.Tme}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const o=Ni.Objects.NodeAttribute[i.ID];o!==void 0&&(n=o)}),n===void 0)t=new p.Tme;else{let i;i=n.LightType===void 0?0:n.LightType.value;let o=16777215;n.Color!==void 0&&(o=new p.Ilk().fromArray(n.Color.value).convertSRGBToLinear());let a=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(a=0);let c=0;n.FarAttenuationEnd!==void 0&&(c=n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?0:n.FarAttenuationEnd.value);const u=1;switch(i){case 0:t=new p.cek(o,a,c,u);break;case 1:t=new p.Ox3(o,a);break;case 2:let d=Math.PI/3;n.InnerAngle!==void 0&&(d=p.M8C.degToRad(n.InnerAngle.value));let m=0;n.OuterAngle!==void 0&&(m=p.M8C.degToRad(n.OuterAngle.value),m=Math.max(m,1)),t=new p.PMe(o,a,c,d,m,u);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new p.cek(o,a)}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,o=null,a=null;const c=[];return e.children.forEach(function(u){t.has(u.ID)&&(o=t.get(u.ID)),n.has(u.ID)&&c.push(n.get(u.ID))}),c.length>1?a=c:c.length>0?a=c[0]:(a=new p.xoR({color:13421772}),c.push(a)),"color"in o.attributes&&c.forEach(function(u){u.vertexColors=!0}),o.FBX_Deformer?(i=new p.TUv(o,a),i.normalizeSkinWeights()):i=new p.Kj0(o,a),i}createCurve(e,t){const n=e.children.reduce(function(o,a){return t.has(a.ID)&&(o=t.get(a.ID)),o},null),i=new p.nls({color:3342591,linewidth:1});return new p.x12(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Rw(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&us.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const i=Ni.Objects.Model[n.ID];if("Lcl_Translation"in i){const o=i.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Qo.add(e.target)):e.lookAt(new p.Pa4().fromArray(o))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const o in e){const a=e[o];us.get(parseInt(a.ID)).parents.forEach(function(c){if(t.has(c.ID)){const u=c.ID;us.get(u).parents.forEach(function(d){n.has(d.ID)&&n.get(d.ID).bind(new p.OdW(a.bones),i[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Ni.Objects){const t=Ni.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(o){e[o.Node]=new p.yGw().fromArray(o.Matrix.a)}):e[i.Node]=new p.yGw().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Ni&&"AmbientColor"in Ni.GlobalSettings){const e=Ni.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const o=new p.Ilk(t,n,i).convertSRGBToLinear();Qo.add(new p.Mig(o,1))}}}}class pE{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Ni.Objects){const n=Ni.Objects.Geometry;for(const i in n){const o=us.get(parseInt(i)),a=this.parseGeometry(o,n[i],e);t.set(parseInt(i),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,o=[],a=e.parents.map(function(g){return Ni.Objects.Model[g.ID]});if(a.length===0)return;const c=e.children.reduce(function(g,_){return i[_.ID]!==void 0&&(g=i[_.ID]),g},null);e.children.forEach(function(g){n.morphTargets[g.ID]!==void 0&&o.push(n.morphTargets[g.ID])});const u=a[0],d={};"RotationOrder"in u&&(d.eulerOrder=Rw(u.RotationOrder.value)),"InheritType"in u&&(d.inheritType=parseInt(u.InheritType.value)),"GeometricTranslation"in u&&(d.translation=u.GeometricTranslation.value),"GeometricRotation"in u&&(d.rotation=u.GeometricRotation.value),"GeometricScaling"in u&&(d.scale=u.GeometricScaling.value);const m=Pw(d);return this.genGeometry(t,c,o,m)}genGeometry(e,t,n,i){const o=new p.u9r;e.attrName&&(o.name=e.attrName);const a=this.parseGeoNode(e,t),c=this.genBuffers(a),u=new p.a$l(c.vertex,3);if(u.applyMatrix4(i),o.setAttribute("position",u),c.colors.length>0&&o.setAttribute("color",new p.a$l(c.colors,3)),t&&(o.setAttribute("skinIndex",new p.qlB(c.weightsIndices,4)),o.setAttribute("skinWeight",new p.a$l(c.vertexWeights,4)),o.FBX_Deformer=t),c.normal.length>0){const d=new p.Vkp().getNormalMatrix(i),m=new p.a$l(c.normal,3);m.applyNormalMatrix(d),o.setAttribute("normal",m)}if(c.uvs.forEach(function(d,m){const g=m===0?"uv":`uv${m}`;o.setAttribute(g,new p.a$l(c.uvs[m],2))}),a.material&&a.material.mappingType!=="AllSame"){let d=c.materialIndex[0],m=0;if(c.materialIndex.forEach(function(g,_){g!==d&&(o.addGroup(m,_-m,d),d=g,m=_)}),o.groups.length>0){const g=o.groups[o.groups.length-1],_=g.start+g.count;_!==c.materialIndex.length&&o.addGroup(_,c.materialIndex.length-_,d)}o.groups.length===0&&o.addGroup(0,c.materialIndex.length,c.materialIndex[0])}return this.addMorphTargets(o,e,n,i),o}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,o){i.indices.forEach(function(a,c){n.weightTable[a]===void 0&&(n.weightTable[a]=[]),n.weightTable[a].push({id:o,weight:i.weights[c]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,o=!1,a=[],c=[],u=[],d=[],m=[],g=[];const _=this;return e.vertexIndices.forEach(function(w,x){let T,I=!1;w<0&&(w^=-1,I=!0);let R=[],M=[];if(a.push(3*w,3*w+1,3*w+2),e.color){const C=Ng(x,n,w,e.color);u.push(C[0],C[1],C[2])}if(e.skeleton){if(e.weightTable[w]!==void 0&&e.weightTable[w].forEach(function(C){M.push(C.weight),R.push(C.id)}),M.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const C=[0,0,0,0],L=[0,0,0,0];M.forEach(function(k,j){let H=k,X=R[j];L.forEach(function(ee,oe,re){if(H>ee){re[oe]=H,H=ee;const he=C[oe];C[oe]=X,X=he}})}),R=C,M=L}for(;M.length<4;)M.push(0),R.push(0);for(let C=0;C<4;++C)m.push(M[C]),g.push(R[C])}if(e.normal){const C=Ng(x,n,w,e.normal);c.push(C[0],C[1],C[2])}e.material&&e.material.mappingType!=="AllSame"&&(T=Ng(x,n,w,e.material)[0],T<0&&(_.negativeMaterialIndices=!0,T=0)),e.uv&&e.uv.forEach(function(C,L){const k=Ng(x,n,w,C);d[L]===void 0&&(d[L]=[]),d[L].push(k[0]),d[L].push(k[1])}),i++,I&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),_.genFace(t,e,a,T,c,u,d,m,g,i),n++,i=0,a=[],c=[],u=[],d=[],m=[],g=[])}),t}genFace(e,t,n,i,o,a,c,u,d,m){for(let g=2;g<m;g++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(g-1)]]),e.vertex.push(t.vertexPositions[n[3*(g-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(g-1)+2]]),e.vertex.push(t.vertexPositions[n[3*g]]),e.vertex.push(t.vertexPositions[n[3*g+1]]),e.vertex.push(t.vertexPositions[n[3*g+2]]),t.skeleton&&(e.vertexWeights.push(u[0]),e.vertexWeights.push(u[1]),e.vertexWeights.push(u[2]),e.vertexWeights.push(u[3]),e.vertexWeights.push(u[4*(g-1)]),e.vertexWeights.push(u[4*(g-1)+1]),e.vertexWeights.push(u[4*(g-1)+2]),e.vertexWeights.push(u[4*(g-1)+3]),e.vertexWeights.push(u[4*g]),e.vertexWeights.push(u[4*g+1]),e.vertexWeights.push(u[4*g+2]),e.vertexWeights.push(u[4*g+3]),e.weightsIndices.push(d[0]),e.weightsIndices.push(d[1]),e.weightsIndices.push(d[2]),e.weightsIndices.push(d[3]),e.weightsIndices.push(d[4*(g-1)]),e.weightsIndices.push(d[4*(g-1)+1]),e.weightsIndices.push(d[4*(g-1)+2]),e.weightsIndices.push(d[4*(g-1)+3]),e.weightsIndices.push(d[4*g]),e.weightsIndices.push(d[4*g+1]),e.weightsIndices.push(d[4*g+2]),e.weightsIndices.push(d[4*g+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(g-1)]),e.colors.push(a[3*(g-1)+1]),e.colors.push(a[3*(g-1)+2]),e.colors.push(a[3*g]),e.colors.push(a[3*g+1]),e.colors.push(a[3*g+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(g-1)]),e.normal.push(o[3*(g-1)+1]),e.normal.push(o[3*(g-1)+2]),e.normal.push(o[3*g]),e.normal.push(o[3*g+1]),e.normal.push(o[3*g+2])),t.uv&&t.uv.forEach(function(_,w){e.uvs[w]===void 0&&(e.uvs[w]=[]),e.uvs[w].push(c[w][0]),e.uvs[w].push(c[w][1]),e.uvs[w].push(c[w][2*(g-1)]),e.uvs[w].push(c[w][2*(g-1)+1]),e.uvs[w].push(c[w][2*g]),e.uvs[w].push(c[w][2*g+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach(function(a){a.rawTargets.forEach(function(c){const u=Ni.Objects.Geometry[c.geoID];u!==void 0&&o.genMorphGeometry(e,t,u,i,c.name)})})}genMorphGeometry(e,t,n,i,o){const a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],c=n.Vertices!==void 0?n.Vertices.a:[],u=n.Indexes!==void 0?n.Indexes.a:[],d=3*e.attributes.position.count,m=new Float32Array(d);for(let x=0;x<u.length;x++){const T=3*u[x];m[T]=c[3*x],m[T+1]=c[3*x+1],m[T+2]=c[3*x+2]}const g={vertexIndices:a,vertexPositions:m},_=this.genBuffers(g),w=new p.a$l(_.vertex,3);w.name=o||n.attrName,w.applyMatrix4(i),e.morphAttributes.position.push(w)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:o,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let o=[];return n==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:i,indices:o,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let o=[];n==="IndexToDirect"&&(o=e.ColorIndex.a);for(let a=0,c=new p.Ilk;a<i.length;a+=4)c.fromArray(i,a).convertSRGBToLinear().toArray(i,a);return{dataSize:4,buffer:i,indices:o,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,o=[];for(let a=0;a<i.length;++a)o.push(a);return{dataSize:1,buffer:i,indices:o,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new p.u9r;const n=t-1,i=e.KnotVector.a,o=[],a=e.Points.a;for(let m=0,g=a.length;m<g;m+=4)o.push(new p.Ltg().fromArray(a,m));let c,u;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){c=n,u=i.length-1-c;for(let m=0;m<n;++m)o.push(o[m])}const d=new dE(n,i,o,c,u).getPoints(12*o.length);return new p.u9r().setFromPoints(d)}}class R_{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],o=this.addClip(i);e.push(o)}return e}parseClips(){if(Ni.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ni.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:i.id,attr:i.attrName,curves:{}};t.set(o.id,o)}}return t}parseAnimationCurves(e){const t=Ni.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(mE),values:t[n].KeyValueFloat.a},o=us.get(i.id);if(o!==void 0){const a=o.parents[0].ID,c=o.parents[0].relationship;c.match(/X/)?e.get(a).curves.x=i:c.match(/Y/)?e.get(a).curves.y=i:c.match(/Z/)?e.get(a).curves.z=i:c.match(/DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=i)}}}parseAnimationLayers(e){const t=Ni.Objects.AnimationLayer,n=new Map;for(const i in t){const o=[],a=us.get(parseInt(i));a!==void 0&&(a.children.forEach(function(c,u){if(e.has(c.ID)){const d=e.get(c.ID);if(d.curves.x!==void 0||d.curves.y!==void 0||d.curves.z!==void 0){if(o[u]===void 0){const m=us.get(c.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID;if(m!==void 0){const g=Ni.Objects.Model[m.toString()];if(g===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",c);const _={modelName:g.attrName?p.iUV.sanitizeNodeName(g.attrName):"",ID:g.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Qo.traverse(function(w){w.ID===g.id&&(_.transform=w.matrix,w.userData.transformData&&(_.eulerOrder=w.userData.transformData.eulerOrder))}),_.transform||(_.transform=new p.yGw),"PreRotation"in g&&(_.preRotation=g.PreRotation.value),"PostRotation"in g&&(_.postRotation=g.PostRotation.value),o[u]=_}}o[u]&&(o[u][d.attr]=d)}else if(d.curves.morph!==void 0){if(o[u]===void 0){const m=us.get(c.ID).parents.filter(function(I){return I.relationship!==void 0})[0].ID,g=us.get(m).parents[0].ID,_=us.get(g).parents[0].ID,w=us.get(_).parents[0].ID,x=Ni.Objects.Model[w],T={modelName:x.attrName?p.iUV.sanitizeNodeName(x.attrName):"",morphName:Ni.Objects.Deformer[m].attrName};o[u]=T}o[u][d.attr]=d}}}),n.set(parseInt(i),o))}return n}parseAnimStacks(e){const t=Ni.Objects.AnimationStack,n={};for(const i in t){const o=us.get(parseInt(i)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(o[0].ID);n[i]={name:t[i].attrName,layer:a}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new p.m7l(e.name,-1,t)}generateTracks(e){const t=[];let n=new p.Pa4,i=new p._fP,o=new p.Pa4;if(e.transform&&e.transform.decompose(n,i,o),n=n.toArray(),i=new p.USm().setFromQuaternion(i,e.eulerOrder).toArray(),o=o.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,n,i){const o=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(o,t,n);return new p.yC1(e+"."+i,o,a)}generateRotationTrack(e,t,n,i,o,a){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(p.M8C.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(p.M8C.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(p.M8C.degToRad));const c=this.getTimesForAllAxes(t),u=this.getKeyframeTrackValues(c,t,n);i!==void 0&&((i=i.map(p.M8C.degToRad)).push(a),i=new p.USm().fromArray(i),i=new p._fP().setFromEuler(i)),o!==void 0&&((o=o.map(p.M8C.degToRad)).push(a),o=new p.USm().fromArray(o),o=new p._fP().setFromEuler(o).invert());const d=new p._fP,m=new p.USm,g=[];for(let _=0;_<u.length;_+=3)m.set(u[_],u[_+1],u[_+2],a),d.setFromEuler(m),i!==void 0&&d.premultiply(i),o!==void 0&&d.multiply(o),d.toArray(g,_/3*4);return new p.iLg(e+".quaternion",c,g)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(o){return o/100}),i=Qo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new p.dUE(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let o=1;o<t.length;o++){const a=t[o];a!==i&&(t[n]=a,i=a,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,o=[];let a=-1,c=-1,u=-1;return e.forEach(function(d){if(t.x&&(a=t.x.times.indexOf(d)),t.y&&(c=t.y.times.indexOf(d)),t.z&&(u=t.z.times.indexOf(d)),a!==-1){const m=t.x.values[a];o.push(m),i[0]=m}else o.push(i[0]);if(c!==-1){const m=t.y.values[c];o.push(m),i[1]=m}else o.push(i[1]);if(u!==-1){const m=t.z.values[u];o.push(m),i[2]=m}else o.push(i[2])}),o}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,o=Math.abs(i);if(o>=180){const a=o/180,c=i/a;let u=n+c;const d=e.times[t-1],m=(e.times[t]-d)/a;let g=d+m;const _=[],w=[];for(;g<e.times[t];)_.push(g),g+=m,w.push(u),u+=c;e.times=Bw(e.times,t,_),e.values=Bw(e.values,t,w)}}}}class hs{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Ug,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,o){const a=i.match(/^[\s\t]*;/),c=i.match(/^[\s\t]*$/);if(a||c)return;const u=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),d=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),m=i.match("^\\t{"+(t.currentIndent-1)+"}}");u?t.parseNodeBegin(i,u):d?t.parseNodeProperty(i,d,n[++o]):m?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(u){return u.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},a=this.parseNodeAttr(i),c=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in c?(n==="PoseNode"?c.PoseNode.push(o):c[n].id!==void 0&&(c[n]={},c[n][c[n].id]=c[n]),a.id!==""&&(c[n][a.id]=o)):typeof a.id=="number"?(c[n]={},c[n][a.id]=o):n!=="Properties70"&&(c[n]=n==="PoseNode"?[o]:o),typeof a.id=="number"&&(o.id=a.id),a.name!==""&&(o.attrName=a.name),a.type!==""&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name!=="Properties70"){if(i==="C"){const c=o.split(",").slice(1),u=parseInt(c[0]),d=parseInt(c[1]);let m=o.split(",").slice(3);m=m.map(function(g){return g.trim().replace(/^"/,"")}),i="connections",o=[u,d],function(g,_){for(let w=0,x=g.length,T=_.length;w<T;w++,x++)g[x]=_[w]}(o,m),a[i]===void 0&&(a[i]=[])}i==="Node"&&(a.id=o),i in a&&Array.isArray(a[i])?a[i].push(o):i!=="a"?a[i]=o:a.a=o,this.setCurrentProp(a,i),i==="a"&&o.slice(-1)!==","&&(a.a=Yy(o))}else this.parseNodeSpecialProperty(e,i,o)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Yy(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(m){return m.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=i[0],a=i[1],c=i[2],u=i[3];let d=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":d=parseFloat(d);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":d=Yy(d)}this.getPrevNode()[o]={type:a,type2:c,flag:u,value:d},this.setCurrentProp(this.getPrevNode(),o)}}class fE{parse(e){const t=new ds(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Ug;for(;!this.endOfContent(t);){const o=this.parseNode(t,n);o!==null&&i.add(o.name,o)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),c=e.getString(a);if(i===0)return null;const u=[];for(let _=0;_<o;_++)u.push(this.parseProperty(e));const d=u.length>0?u[0]:"",m=u.length>1?u[1]:"",g=u.length>2?u[2]:"";for(n.singleProperty=o===1&&e.getOffset()===i;i>e.getOffset();){const _=this.parseNode(e,t);_!==null&&this.parseSubNode(c,n,_)}return n.propertyList=u,typeof d=="number"&&(n.id=d),m!==""&&(n.attrName=m),g!==""&&(n.attrType=g),c!==""&&(n.name=c),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(o,a){a!==0&&i.push(o)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(i){t[i]=n[i]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],o=n.propertyList[1];const a=n.propertyList[2],c=n.propertyList[3];let u;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),u=o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[i]={type:o,type2:a,flag:c,value:u}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(o===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const c=kg(new Uint8Array(e.getArrayBuffer(a))),u=new ds(c.buffer);switch(t){case"b":case"c":return u.getBooleanArray(i);case"d":return u.getFloat64Array(i);case"f":return u.getFloat32Array(i);case"i":return u.getInt32Array(i);case"l":return u.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class ds{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class Ug{add(e,t){this[e]=t}}function Iw(s){const e=s.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function mE(s){return s/46186158e3}const gE=[];function Ng(s,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=s;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const o=i*n.dataSize,a=o+n.dataSize;return function(c,u,d,m){for(let g=d,_=0;g<m;g++,_++)c[_]=u[g];return c}(gE,n.buffer,o,a)}const Qf=new p.USm,qh=new p.Pa4;function Pw(s){const e=new p.yGw,t=new p.yGw,n=new p.yGw,i=new p.yGw,o=new p.yGw,a=new p.yGw,c=new p.yGw,u=new p.yGw,d=new p.yGw,m=new p.yGw,g=new p.yGw,_=new p.yGw,w=s.inheritType?s.inheritType:0;if(s.translation&&e.setPosition(qh.fromArray(s.translation)),s.preRotation){const oe=s.preRotation.map(p.M8C.degToRad);oe.push(s.eulerOrder||p.USm.DEFAULT_ORDER),t.makeRotationFromEuler(Qf.fromArray(oe))}if(s.rotation){const oe=s.rotation.map(p.M8C.degToRad);oe.push(s.eulerOrder||p.USm.DEFAULT_ORDER),n.makeRotationFromEuler(Qf.fromArray(oe))}if(s.postRotation){const oe=s.postRotation.map(p.M8C.degToRad);oe.push(s.eulerOrder||p.USm.DEFAULT_ORDER),i.makeRotationFromEuler(Qf.fromArray(oe)),i.invert()}s.scale&&o.scale(qh.fromArray(s.scale)),s.scalingOffset&&c.setPosition(qh.fromArray(s.scalingOffset)),s.scalingPivot&&a.setPosition(qh.fromArray(s.scalingPivot)),s.rotationOffset&&u.setPosition(qh.fromArray(s.rotationOffset)),s.rotationPivot&&d.setPosition(qh.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(g.copy(s.parentMatrix),m.copy(s.parentMatrixWorld));const x=t.clone().multiply(n).multiply(i),T=new p.yGw;T.extractRotation(m);const I=new p.yGw;I.copyPosition(m);const R=I.clone().invert().multiply(m),M=T.clone().invert().multiply(R),C=o,L=new p.yGw;if(w===0)L.copy(T).multiply(x).multiply(M).multiply(C);else if(w===1)L.copy(T).multiply(M).multiply(x).multiply(C);else{const oe=new p.yGw().scale(new p.Pa4().setFromMatrixScale(g)).clone().invert(),re=M.clone().multiply(oe);L.copy(T).multiply(x).multiply(re).multiply(C)}const k=d.clone().invert(),j=a.clone().invert();let H=e.clone().multiply(u).multiply(d).multiply(t).multiply(n).multiply(i).multiply(k).multiply(c).multiply(a).multiply(o).multiply(j);const X=new p.yGw().copyPosition(H),ee=m.clone().multiply(X);return _.copyPosition(ee),H=_.clone().multiply(L),H.premultiply(m.invert()),H}function Rw(s){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(s=s||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function Yy(s){return s.split(",").map(function(e){return parseFloat(e)})}function Dw(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),new TextDecoder().decode(new Uint8Array(s,e,t))}function Bw(s,e,t){return s.slice(0,e).concat(t).concat(s.slice(e))}class Ky extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt],this._importer=new Br(P_,["fbx"],!0)}async onAdded(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,n,i,o;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&((o=(i=e.getManager())==null?void 0:i.importer)==null||o.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}Ky.PluginType="FBXLoadPlugin";const Wf=new p.cPb(45,1,.1,1e3);function Jy(s,e,t,n=7,i=new p.Pa4(0,0,1.5)){t=t??s.scene.modelObject;const o=new Ie().expandByObject(t??e,!0,!0),a=o.getCenter(new p.Pa4),c=o.getSize(new p.Pa4);Wf.position.copy(a).add(i.clone().multiplyScalar(Math.max(c.x,c.y,c.z))),Wf.lookAt(a),e&&e.traverseVisible(m=>{m.layers.enable(n)}),n>0?Wf.layers.set(n):Wf.layers.enableAll();const u=e==null?void 0:e.visible;e&&(e.visible=!0),s.renderer.rendererObject.setRenderTarget(null),s.renderer.rendererObject.render(t,Wf);const d=s.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=u,e.traverseVisible(m=>{m.layers.disable(n)}),Wf.layers.enableAll()),s.setDirty(),d}class Zy{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new p.Kj0(new p.xo$(1)),cube:new p.Kj0(new p.DvJ(1,1,1)),cylinder:new p.Kj0(new p.fHI(.5,.5,1))};const t=new p.xsS;this._channel=7;const n=new p.vmT(16777215,4473924,1);n.position.set(0,10,0),n.layers.set(this._channel),t.add(n),this._lights.push(n),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const n=this.shapes[t]||new p.Kj0(new p.xo$(1));n.material=e.materialObject,n.geometry.attributes.tangent||n.geometry.computeTangents(),this._scene.add(n),this._scene.environment=this.viewer.scene.getEnvironment();const i=n.material.envMapIntensity;typeof i=="number"&&(n.material.envMapIntensity=Math.max(i,2));const o=Jy(this.viewer,n,this._scene,this._channel,new p.Pa4(0,0,1.5));return typeof i=="number"&&(n.material.envMapIntensity=i),this._scene.remove(n),n.material=void 0,o}}class D_ extends En{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e))},this.dependencies=[Qt],this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)==null?void 0:e.getSelectedObject())==null?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(ac).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())==null?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove variations",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove completely",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(t=>this.applyVariation(t,t.materials[0].uuid))}}]}]}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new Zy(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())==null?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())==null?void 0:t.name)}applyVariation(e,t){var o,a;const n=e.materials.find(c=>c.uuid===t),i=(a=(o=this._viewer)==null?void 0:o.getManager())==null?void 0:a.materials;return!!i&&!!n&&i.applyMaterial(n,e.uuid)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var n;const t=(n=e==null?void 0:e.clone)==null?void 0:n.call(e);if(e&&t){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i||this.variations.push(i={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),i.materials.push(t),this.refreshUi()}}}D_.PluginType="MaterialConfiguratorBasePlugin",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([Ae()],D_.prototype,"variations",void 0);class Wa{static _initializeStyles(){(0,V.createStyles)(V.css`
  .customContextGrid {
    background: #eeeeee55;
    border: 0.5px solid rgba(220, 220, 220, 0.2);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 6px rgba(12, 12, 12, 0.2);

    color: #111111;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
    backdrop-filter: blur(20px);
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }

  .customContextGridItems:hover {
    color: white;
    //background-color: #017AFF;
    box-shadow: 0 0 7px 0px rgba(64, 64, 64, 0.3);
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 5px;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `,this._container),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,t,n,i,o,a,c){var _;const u=(0,V.mobileAndTabletCheck)(),d=u?.15:.25,m=u?1.5:2.5,g=(0,V.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${t} </div>
            `});g.style.top=o+"px",g.style.left=i+"px",g.style.gap=d+"rem",g.style.width=(m+d)*n-d+"rem",g.dataset.tag=e;for(const w of a){const x=(0,V.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${w.image}" class="customContextGridItemImage">
            `});x.style.width=m+"rem",x.style.height=m+"rem",g.appendChild(x),x.onclick=()=>{var T;return(T=w.onClick)==null?void 0:T.call(w,w.id)},c(x,w,g)}return(_=this.Elements)==null||_.push(g),g}static RemoveAll(e){if(e){const t=this.Elements.filter(n=>n.dataset.tag===e);for(const n of t)n.remove();this.Elements=this.Elements.filter(n=>n.dataset.tag!==e)}else{for(const t of this.Elements)t.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=(0,V.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const n of this.Elements)n.remove();this._container.innerHTML="",this._initializeStyles();let t=20;e.appendChild(this._container);for(const n of this.Elements)n.style.top=t+"px",this._container.appendChild(n),t+=n.clientHeight+20}}function zl(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var e=s.ownerDocument;return e&&e.defaultView||window}return s}function _p(s){return s instanceof zl(s).Element||s instanceof Element}function Vl(s){return s instanceof zl(s).HTMLElement||s instanceof HTMLElement}function $y(s){return typeof ShadowRoot<"u"&&(s instanceof zl(s).ShadowRoot||s instanceof ShadowRoot)}Wa.Elements=[],Wa._container=document.createElement("div");var yp=Math.max,B_=Math.min,qf=Math.round;function eA(){var s=navigator.userAgentData;return s!=null&&s.brands?s.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Ow(){return!/^((?!chrome|android).)*safari/i.test(eA())}function Xf(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=s.getBoundingClientRect(),i=1,o=1;e&&Vl(s)&&(i=s.offsetWidth>0&&qf(n.width)/s.offsetWidth||1,o=s.offsetHeight>0&&qf(n.height)/s.offsetHeight||1);var a=(_p(s)?zl(s):window).visualViewport,c=!Ow()&&t,u=(n.left+(c&&a?a.offsetLeft:0))/i,d=(n.top+(c&&a?a.offsetTop:0))/o,m=n.width/i,g=n.height/o;return{width:m,height:g,top:d,right:u+m,bottom:d+g,left:u,x:u,y:d}}function tA(s){var e=zl(s);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function A(s){return s?(s.nodeName||"").toLowerCase():null}function r(s){return((_p(s)?s.ownerDocument:s.document)||window.document).documentElement}function l(s){return Xf(r(s)).left+tA(s).scrollLeft}function h(s){return zl(s).getComputedStyle(s)}function f(s){var e=h(s),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function v(s,e,t){t===void 0&&(t=!1);var n,i,o=Vl(e),a=Vl(e)&&function(g){var _=g.getBoundingClientRect(),w=qf(_.width)/g.offsetWidth||1,x=qf(_.height)/g.offsetHeight||1;return w!==1||x!==1}(e),c=r(e),u=Xf(s,a,t),d={scrollLeft:0,scrollTop:0},m={x:0,y:0};return(o||!o&&!t)&&((A(e)!=="body"||f(c))&&(d=(n=e)!==zl(n)&&Vl(n)?{scrollLeft:(i=n).scrollLeft,scrollTop:i.scrollTop}:tA(n)),Vl(e)?((m=Xf(e,!0)).x+=e.clientLeft,m.y+=e.clientTop):c&&(m.x=l(c))),{x:u.left+d.scrollLeft-m.x,y:u.top+d.scrollTop-m.y,width:u.width,height:u.height}}function b(s){var e=Xf(s),t=s.offsetWidth,n=s.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:s.offsetLeft,y:s.offsetTop,width:t,height:n}}function E(s){return A(s)==="html"?s:s.assignedSlot||s.parentNode||($y(s)?s.host:null)||r(s)}function D(s){return["html","body","#document"].indexOf(A(s))>=0?s.ownerDocument.body:Vl(s)&&f(s)?s:D(E(s))}function P(s,e){var t;e===void 0&&(e=[]);var n=D(s),i=n===((t=s.ownerDocument)==null?void 0:t.body),o=zl(n),a=i?[o].concat(o.visualViewport||[],f(n)?n:[]):n,c=e.concat(a);return i?c:c.concat(P(E(a)))}function O(s){return["table","td","th"].indexOf(A(s))>=0}function F(s){return Vl(s)&&h(s).position!=="fixed"?s.offsetParent:null}function N(s){for(var e=zl(s),t=F(s);t&&O(t)&&h(t).position==="static";)t=F(t);return t&&(A(t)==="html"||A(t)==="body"&&h(t).position==="static")?e:t||function(n){var i=/firefox/i.test(eA());if(/Trident/i.test(eA())&&Vl(n)&&h(n).position==="fixed")return null;var o=E(n);for($y(o)&&(o=o.host);Vl(o)&&["html","body"].indexOf(A(o))<0;){var a=h(o);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||i&&a.willChange==="filter"||i&&a.filter&&a.filter!=="none")return o;o=o.parentNode}return null}(s)||e}var z="top",G="bottom",W="right",Q="left",q="auto",K=[z,G,W,Q],ne="start",be="end",ve="clippingParents",me="viewport",Pe="popper",tt="reference",Oe=K.reduce(function(s,e){return s.concat([e+"-"+ne,e+"-"+be])},[]),pt=[].concat(K,[q]).reduce(function(s,e){return s.concat([e,e+"-"+ne,e+"-"+be])},[]),ke="beforeRead",Mt="read",Ot="afterRead",tn="beforeMain",An="main",nn="afterMain",Xt="beforeWrite",dn="write",gn="afterWrite",xt=[ke,Mt,Ot,tn,An,nn,Xt,dn,gn];function Wt(s){var e=new Map,t=new Set,n=[];function i(o){t.add(o.name),[].concat(o.requires||[],o.requiresIfExists||[]).forEach(function(a){if(!t.has(a)){var c=e.get(a);c&&i(c)}}),n.push(o)}return s.forEach(function(o){e.set(o.name,o)}),s.forEach(function(o){t.has(o.name)||i(o)}),n}var un={placement:"bottom",modifiers:[],strategy:"absolute"};function Zt(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function _n(s){s===void 0&&(s={});var e=s,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?un:i;return function(a,c,u){u===void 0&&(u=o);var d,m,g={placement:"bottom",orderedModifiers:[],options:Object.assign({},un,o),modifiersData:{},elements:{reference:a,popper:c},attributes:{},styles:{}},_=[],w=!1,x={state:g,setOptions:function(I){var R=typeof I=="function"?I(g.options):I;T(),g.options=Object.assign({},o,g.options,R),g.scrollParents={reference:_p(a)?P(a):a.contextElement?P(a.contextElement):[],popper:P(c)};var M,C,L=function(k){var j=Wt(k);return xt.reduce(function(H,X){return H.concat(j.filter(function(ee){return ee.phase===X}))},[])}((M=[].concat(n,g.options.modifiers),C=M.reduce(function(k,j){var H=k[j.name];return k[j.name]=H?Object.assign({},H,j,{options:Object.assign({},H.options,j.options),data:Object.assign({},H.data,j.data)}):j,k},{}),Object.keys(C).map(function(k){return C[k]})));return g.orderedModifiers=L.filter(function(k){return k.enabled}),g.orderedModifiers.forEach(function(k){var j=k.name,H=k.options,X=H===void 0?{}:H,ee=k.effect;if(typeof ee=="function"){var oe=ee({state:g,name:j,instance:x,options:X});_.push(oe||function(){})}}),x.update()},forceUpdate:function(){if(!w){var I=g.elements,R=I.reference,M=I.popper;if(Zt(R,M)){g.rects={reference:v(R,N(M),g.options.strategy==="fixed"),popper:b(M)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(ee){return g.modifiersData[ee.name]=Object.assign({},ee.data)});for(var C=0;C<g.orderedModifiers.length;C++)if(g.reset!==!0){var L=g.orderedModifiers[C],k=L.fn,j=L.options,H=j===void 0?{}:j,X=L.name;typeof k=="function"&&(g=k({state:g,options:H,name:X,instance:x})||g)}else g.reset=!1,C=-1}}},update:(d=function(){return new Promise(function(I){x.forceUpdate(),I(g)})},function(){return m||(m=new Promise(function(I){Promise.resolve().then(function(){m=void 0,I(d())})})),m}),destroy:function(){T(),w=!0}};if(!Zt(a,c))return x;function T(){_.forEach(function(I){return I()}),_=[]}return x.setOptions(u).then(function(I){!w&&u.onFirstUpdate&&u.onFirstUpdate(I)}),x}}var ai=_n(),De={passive:!0},we={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(s){var e=s.state,t=s.instance,n=s.options,i=n.scroll,o=i===void 0||i,a=n.resize,c=a===void 0||a,u=zl(e.elements.popper),d=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&d.forEach(function(m){m.addEventListener("scroll",t.update,De)}),c&&u.addEventListener("resize",t.update,De),function(){o&&d.forEach(function(m){m.removeEventListener("scroll",t.update,De)}),c&&u.removeEventListener("resize",t.update,De)}},data:{}};function ot(s){return s.split("-")[0]}function Ve(s){return s.split("-")[1]}function Re(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function it(s){var e,t=s.reference,n=s.element,i=s.placement,o=i?ot(i):null,a=i?Ve(i):null,c=t.x+t.width/2-n.width/2,u=t.y+t.height/2-n.height/2;switch(o){case z:e={x:c,y:t.y-n.height};break;case G:e={x:c,y:t.y+t.height};break;case W:e={x:t.x+t.width,y:u};break;case Q:e={x:t.x-n.width,y:u};break;default:e={x:t.x,y:t.y}}var d=o?Re(o):null;if(d!=null){var m=d==="y"?"height":"width";switch(a){case ne:e[d]=e[d]-(t[m]/2-n[m]/2);break;case be:e[d]=e[d]+(t[m]/2-n[m]/2)}}return e}var de={name:"popperOffsets",enabled:!0,phase:"read",fn:function(s){var e=s.state,t=s.name;e.modifiersData[t]=it({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},Ge={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ze(s){var e,t=s.popper,n=s.popperRect,i=s.placement,o=s.variation,a=s.offsets,c=s.position,u=s.gpuAcceleration,d=s.adaptive,m=s.roundOffsets,g=s.isFixed,_=a.x,w=_===void 0?0:_,x=a.y,T=x===void 0?0:x,I=typeof m=="function"?m({x:w,y:T}):{x:w,y:T};w=I.x,T=I.y;var R=a.hasOwnProperty("x"),M=a.hasOwnProperty("y"),C=Q,L=z,k=window;if(d){var j=N(t),H="clientHeight",X="clientWidth";j===zl(t)&&h(j=r(t)).position!=="static"&&c==="absolute"&&(H="scrollHeight",X="scrollWidth"),(i===z||(i===Q||i===W)&&o===be)&&(L=G,T-=(g&&j===k&&k.visualViewport?k.visualViewport.height:j[H])-n.height,T*=u?1:-1),i!==Q&&(i!==z&&i!==G||o!==be)||(C=W,w-=(g&&j===k&&k.visualViewport?k.visualViewport.width:j[X])-n.width,w*=u?1:-1)}var ee,oe=Object.assign({position:c},d&&Ge),re=m===!0?function(he){var le=he.x,ue=he.y,ge=window.devicePixelRatio||1;return{x:qf(le*ge)/ge||0,y:qf(ue*ge)/ge||0}}({x:w,y:T}):{x:w,y:T};return w=re.x,T=re.y,u?Object.assign({},oe,((ee={})[L]=M?"0":"",ee[C]=R?"0":"",ee.transform=(k.devicePixelRatio||1)<=1?"translate("+w+"px, "+T+"px)":"translate3d("+w+"px, "+T+"px, 0)",ee)):Object.assign({},oe,((e={})[L]=M?T+"px":"",e[C]=R?w+"px":"",e.transform="",e))}var Ut={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(s){var e=s.state,t=s.options,n=t.gpuAcceleration,i=n===void 0||n,o=t.adaptive,a=o===void 0||o,c=t.roundOffsets,u=c===void 0||c,d={placement:ot(e.placement),variation:Ve(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ze(Object.assign({},d,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:u})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ze(Object.assign({},d,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:u})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},Lt={name:"applyStyles",enabled:!0,phase:"write",fn:function(s){var e=s.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];Vl(o)&&A(o)&&(Object.assign(o.style,n),Object.keys(i).forEach(function(a){var c=i[a];c===!1?o.removeAttribute(a):o.setAttribute(a,c===!0?"":c)}))})},effect:function(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},a=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]).reduce(function(c,u){return c[u]="",c},{});Vl(i)&&A(i)&&(Object.assign(i.style,a),Object.keys(o).forEach(function(c){i.removeAttribute(c)}))})}},requires:["computeStyles"]},qt={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(s){var e=s.state,t=s.options,n=s.name,i=t.offset,o=i===void 0?[0,0]:i,a=pt.reduce(function(m,g){return m[g]=function(_,w,x){var T=ot(_),I=[Q,z].indexOf(T)>=0?-1:1,R=typeof x=="function"?x(Object.assign({},w,{placement:_})):x,M=R[0],C=R[1];return M=M||0,C=(C||0)*I,[Q,W].indexOf(T)>=0?{x:C,y:M}:{x:M,y:C}}(g,e.rects,o),m},{}),c=a[e.placement],u=c.x,d=c.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=u,e.modifiersData.popperOffsets.y+=d),e.modifiersData[n]=a}},vn={left:"right",right:"left",bottom:"top",top:"bottom"};function Tn(s){return s.replace(/left|right|bottom|top/g,function(e){return vn[e]})}var ei={start:"end",end:"start"};function Cn(s){return s.replace(/start|end/g,function(e){return ei[e]})}function mi(s,e){var t=e.getRootNode&&e.getRootNode();if(s.contains(e))return!0;if(t&&$y(t)){var n=e;do{if(n&&s.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function li(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function Qn(s,e,t){return e===me?li(function(n,i){var o=zl(n),a=r(n),c=o.visualViewport,u=a.clientWidth,d=a.clientHeight,m=0,g=0;if(c){u=c.width,d=c.height;var _=Ow();(_||!_&&i==="fixed")&&(m=c.offsetLeft,g=c.offsetTop)}return{width:u,height:d,x:m+l(n),y:g}}(s,t)):_p(e)?function(n,i){var o=Xf(n,!1,i==="fixed");return o.top=o.top+n.clientTop,o.left=o.left+n.clientLeft,o.bottom=o.top+n.clientHeight,o.right=o.left+n.clientWidth,o.width=n.clientWidth,o.height=n.clientHeight,o.x=o.left,o.y=o.top,o}(e,t):li(function(n){var i,o=r(n),a=tA(n),c=(i=n.ownerDocument)==null?void 0:i.body,u=yp(o.scrollWidth,o.clientWidth,c?c.scrollWidth:0,c?c.clientWidth:0),d=yp(o.scrollHeight,o.clientHeight,c?c.scrollHeight:0,c?c.clientHeight:0),m=-a.scrollLeft+l(n),g=-a.scrollTop;return h(c||o).direction==="rtl"&&(m+=yp(o.clientWidth,c?c.clientWidth:0)-u),{width:u,height:d,x:m,y:g}}(r(s)))}function cr(s){return Object.assign({},{top:0,right:0,bottom:0,left:0},s)}function Po(s,e){return e.reduce(function(t,n){return t[n]=s,t},{})}function ci(s,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?s.placement:n,o=t.strategy,a=o===void 0?s.strategy:o,c=t.boundary,u=c===void 0?ve:c,d=t.rootBoundary,m=d===void 0?me:d,g=t.elementContext,_=g===void 0?Pe:g,w=t.altBoundary,x=w!==void 0&&w,T=t.padding,I=T===void 0?0:T,R=cr(typeof I!="number"?I:Po(I,K)),M=_===Pe?tt:Pe,C=s.rects.popper,L=s.elements[x?M:_],k=function(le,ue,ge,_e){var Ee=ue==="clippingParents"?function(lt){var rt=P(E(lt)),kt=["absolute","fixed"].indexOf(h(lt).position)>=0&&Vl(lt)?N(lt):lt;return _p(kt)?rt.filter(function(Pt){return _p(Pt)&&mi(Pt,kt)&&A(Pt)!=="body"}):[]}(le):[].concat(ue),Ye=[].concat(Ee,[ge]),We=Ye[0],Et=Ye.reduce(function(lt,rt){var kt=Qn(le,rt,_e);return lt.top=yp(kt.top,lt.top),lt.right=B_(kt.right,lt.right),lt.bottom=B_(kt.bottom,lt.bottom),lt.left=yp(kt.left,lt.left),lt},Qn(le,We,_e));return Et.width=Et.right-Et.left,Et.height=Et.bottom-Et.top,Et.x=Et.left,Et.y=Et.top,Et}(_p(L)?L:L.contextElement||r(s.elements.popper),u,m,a),j=Xf(s.elements.reference),H=it({reference:j,element:C,strategy:"absolute",placement:i}),X=li(Object.assign({},C,H)),ee=_===Pe?X:j,oe={top:k.top-ee.top+R.top,bottom:ee.bottom-k.bottom+R.bottom,left:k.left-ee.left+R.left,right:ee.right-k.right+R.right},re=s.modifiersData.offset;if(_===Pe&&re){var he=re[i];Object.keys(oe).forEach(function(le){var ue=[W,G].indexOf(le)>=0?1:-1,ge=[z,G].indexOf(le)>=0?"y":"x";oe[le]+=he[ge]*ue})}return oe}var Xi={name:"flip",enabled:!0,phase:"main",fn:function(s){var e=s.state,t=s.options,n=s.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0||i,a=t.altAxis,c=a===void 0||a,u=t.fallbackPlacements,d=t.padding,m=t.boundary,g=t.rootBoundary,_=t.altBoundary,w=t.flipVariations,x=w===void 0||w,T=t.allowedAutoPlacements,I=e.options.placement,R=ot(I),M=u||(R!==I&&x?function(lt){if(ot(lt)===q)return[];var rt=Tn(lt);return[Cn(lt),rt,Cn(rt)]}(I):[Tn(I)]),C=[I].concat(M).reduce(function(lt,rt){return lt.concat(ot(rt)===q?function(kt,Pt){Pt===void 0&&(Pt={});var sn=Pt,hn=sn.placement,wn=sn.boundary,Xn=sn.rootBoundary,zn=sn.padding,Gn=sn.flipVariations,gt=sn.allowedAutoPlacements,zt=gt===void 0?pt:gt,an=Ve(hn),ui=an?Gn?Oe:Oe.filter(function(ni){return Ve(ni)===an}):K,Ri=ui.filter(function(ni){return zt.indexOf(ni)>=0});Ri.length===0&&(Ri=ui);var _i=Ri.reduce(function(ni,ii){return ni[ii]=ci(kt,{placement:ii,boundary:wn,rootBoundary:Xn,padding:zn})[ot(ii)],ni},{});return Object.keys(_i).sort(function(ni,ii){return _i[ni]-_i[ii]})}(e,{placement:rt,boundary:m,rootBoundary:g,padding:d,flipVariations:x,allowedAutoPlacements:T}):rt)},[]),L=e.rects.reference,k=e.rects.popper,j=new Map,H=!0,X=C[0],ee=0;ee<C.length;ee++){var oe=C[ee],re=ot(oe),he=Ve(oe)===ne,le=[z,G].indexOf(re)>=0,ue=le?"width":"height",ge=ci(e,{placement:oe,boundary:m,rootBoundary:g,altBoundary:_,padding:d}),_e=le?he?W:Q:he?G:z;L[ue]>k[ue]&&(_e=Tn(_e));var Ee=Tn(_e),Ye=[];if(o&&Ye.push(ge[re]<=0),c&&Ye.push(ge[_e]<=0,ge[Ee]<=0),Ye.every(function(lt){return lt})){X=oe,H=!1;break}j.set(oe,Ye)}if(H)for(var We=function(lt){var rt=C.find(function(kt){var Pt=j.get(kt);if(Pt)return Pt.slice(0,lt).every(function(sn){return sn})});if(rt)return X=rt,"break"},Et=x?3:1;Et>0&&We(Et)!=="break";Et--);e.placement!==X&&(e.modifiersData[n]._skip=!0,e.placement=X,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Vi(s,e,t){return yp(s,B_(e,t))}var Fu={name:"preventOverflow",enabled:!0,phase:"main",fn:function(s){var e=s.state,t=s.options,n=s.name,i=t.mainAxis,o=i===void 0||i,a=t.altAxis,c=a!==void 0&&a,u=t.boundary,d=t.rootBoundary,m=t.altBoundary,g=t.padding,_=t.tether,w=_===void 0||_,x=t.tetherOffset,T=x===void 0?0:x,I=ci(e,{boundary:u,rootBoundary:d,padding:g,altBoundary:m}),R=ot(e.placement),M=Ve(e.placement),C=!M,L=Re(R),k=L==="x"?"y":"x",j=e.modifiersData.popperOffsets,H=e.rects.reference,X=e.rects.popper,ee=typeof T=="function"?T(Object.assign({},e.rects,{placement:e.placement})):T,oe=typeof ee=="number"?{mainAxis:ee,altAxis:ee}:Object.assign({mainAxis:0,altAxis:0},ee),re=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,he={x:0,y:0};if(j){if(o){var le,ue=L==="y"?z:Q,ge=L==="y"?G:W,_e=L==="y"?"height":"width",Ee=j[L],Ye=Ee+I[ue],We=Ee-I[ge],Et=w?-X[_e]/2:0,lt=M===ne?H[_e]:X[_e],rt=M===ne?-X[_e]:-H[_e],kt=e.elements.arrow,Pt=w&&kt?b(kt):{width:0,height:0},sn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},hn=sn[ue],wn=sn[ge],Xn=Vi(0,H[_e],Pt[_e]),zn=C?H[_e]/2-Et-Xn-hn-oe.mainAxis:lt-Xn-hn-oe.mainAxis,Gn=C?-H[_e]/2+Et+Xn+wn+oe.mainAxis:rt+Xn+wn+oe.mainAxis,gt=e.elements.arrow&&N(e.elements.arrow),zt=gt?L==="y"?gt.clientTop||0:gt.clientLeft||0:0,an=(le=re==null?void 0:re[L])!=null?le:0,ui=Ee+Gn-an,Ri=Vi(w?B_(Ye,Ee+zn-an-zt):Ye,Ee,w?yp(We,ui):We);j[L]=Ri,he[L]=Ri-Ee}if(c){var _i,ni=L==="x"?z:Q,ii=L==="x"?G:W,Bn=j[k],ut=k==="y"?"height":"width",on=Bn+I[ni],kn=Bn-I[ii],Yt=[z,Q].indexOf(R)!==-1,Zn=(_i=re==null?void 0:re[k])!=null?_i:0,Nr=Yt?on:Bn-H[ut]-X[ut]-Zn+oe.altAxis,$r=Yt?Bn+H[ut]+X[ut]-Zn-oe.altAxis:kn,Gs=w&&Yt?function(Xo,Pa,Lo){var fi=Vi(Xo,Pa,Lo);return fi>Lo?Lo:fi}(Nr,Bn,$r):Vi(w?Nr:on,Bn,w?$r:kn);j[k]=Gs,he[k]=Gs-Bn}e.modifiersData[n]=he}},requiresIfExists:["offset"]},It={name:"arrow",enabled:!0,phase:"main",fn:function(s){var e,t=s.state,n=s.name,i=s.options,o=t.elements.arrow,a=t.modifiersData.popperOffsets,c=ot(t.placement),u=Re(c),d=[Q,W].indexOf(c)>=0?"height":"width";if(o&&a){var m=function(X,ee){return cr(typeof(X=typeof X=="function"?X(Object.assign({},ee.rects,{placement:ee.placement})):X)!="number"?X:Po(X,K))}(i.padding,t),g=b(o),_=u==="y"?z:Q,w=u==="y"?G:W,x=t.rects.reference[d]+t.rects.reference[u]-a[u]-t.rects.popper[d],T=a[u]-t.rects.reference[u],I=N(o),R=I?u==="y"?I.clientHeight||0:I.clientWidth||0:0,M=x/2-T/2,C=m[_],L=R-g[d]-m[w],k=R/2-g[d]/2+M,j=Vi(C,k,L),H=u;t.modifiersData[n]=((e={})[H]=j,e.centerOffset=j-k,e)}},effect:function(s){var e=s.state,t=s.options.element,n=t===void 0?"[data-popper-arrow]":t;n!=null&&(typeof n!="string"||(n=e.elements.popper.querySelector(n)))&&mi(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Xh(s,e,t){return t===void 0&&(t={x:0,y:0}),{top:s.top-e.height-t.y,right:s.right-e.width+t.x,bottom:s.bottom-e.height+t.y,left:s.left-e.width-t.x}}function Fg(s){return[z,W,G,Q].some(function(e){return s[e]>=0})}var Wo={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(s){var e=s.state,t=s.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,a=ci(e,{elementContext:"reference"}),c=ci(e,{altBoundary:!0}),u=Xh(a,n),d=Xh(c,i,o),m=Fg(u),g=Fg(d);e.modifiersData[t]={referenceClippingOffsets:u,popperEscapeOffsets:d,isReferenceHidden:m,hasPopperEscaped:g},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":m,"data-popper-escaped":g})}},jg=_n({defaultModifiers:[we,de,Ut,Lt,qt,Xi,Fu,It,Wo]}),zg="tippy-box",nA="tippy-content",Lw="tippy-backdrop",O_="tippy-arrow",iA="tippy-svg-arrow",Yh={passive:!0,capture:!0},Kh=function(){return document.body};function L_(s,e,t){if(Array.isArray(s)){var n=s[e];return n??(Array.isArray(t)?t[e]:t)}return s}function k_(s,e){var t={}.toString.call(s);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Vg(s,e){return typeof s=="function"?s.apply(void 0,e):s}function rA(s,e){return e===0?s:function(n){clearTimeout(t),t=setTimeout(function(){s(n)},e)};var t}function eu(s){return[].concat(s)}function sA(s,e){s.indexOf(e)===-1&&s.push(e)}function Te(s){return[].slice.call(s)}function Rt(s){return Object.keys(s).reduce(function(e,t){return s[t]!==void 0&&(e[t]=s[t]),e},{})}function Nt(){return document.createElement("div")}function jt(s){return["Element","Fragment"].some(function(e){return k_(s,e)})}function rn(s,e){s.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function On(s,e){s.forEach(function(t){t&&t.setAttribute("data-state",e)})}function Gi(s,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){s[n](i,t)})}function di(s,e){for(var t=e;t;){var n;if(s.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var gi={isTouch:!1},nr=0;function Yi(){gi.isTouch||(gi.isTouch=!0,window.performance&&document.addEventListener("mousemove",Oi))}function Oi(){var s=performance.now();s-nr<20&&(gi.isTouch=!1,document.removeEventListener("mousemove",Oi)),nr=s}function uo(){var s,e=document.activeElement;if((s=e)&&s._tippy&&s._tippy.reference===s){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var qa=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),or=Object.assign({appendTo:Kh,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),Yf=Object.keys(or);function Gr(s){var e=(s.plugins||[]).reduce(function(t,n){var i,o=n.name,a=n.defaultValue;return o&&(t[o]=s[o]!==void 0?s[o]:(i=or[o])!=null?i:a),t},{});return Object.assign({},s,e)}function Ms(s,e){var t=Object.assign({},e,{content:Vg(e.content,[s])},e.ignoreAttributes?{}:function(n,i){return(i?Object.keys(Gr(Object.assign({},or,{plugins:i}))):Yf).reduce(function(o,a){var c=(n.getAttribute("data-tippy-"+a)||"").trim();if(!c)return o;if(a==="content")o[a]=c;else try{o[a]=JSON.parse(c)}catch{o[a]=c}return o},{})}(s,e.plugins));return t.aria=Object.assign({},or.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var ju=function(){return"innerHTML"};function Ts(s,e){s[ju()]=e}function pi(s){var e=Nt();return s===!0?e.className=O_:(e.className=iA,jt(s)?e.appendChild(s):Ts(e,s)),e}function Is(s,e){jt(e.content)?(Ts(s,""),s.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Ts(s,e.content):s.textContent=e.content)}function Gg(s){var e=s.firstElementChild,t=Te(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(nA)}),arrow:t.find(function(n){return n.classList.contains(O_)||n.classList.contains(iA)}),backdrop:t.find(function(n){return n.classList.contains(Lw)})}}function kw(s){var e=Nt(),t=Nt();t.className=zg,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Nt();function i(o,a){var c=Gg(e),u=c.box,d=c.content,m=c.arrow;a.theme?u.setAttribute("data-theme",a.theme):u.removeAttribute("data-theme"),typeof a.animation=="string"?u.setAttribute("data-animation",a.animation):u.removeAttribute("data-animation"),a.inertia?u.setAttribute("data-inertia",""):u.removeAttribute("data-inertia"),u.style.maxWidth=typeof a.maxWidth=="number"?a.maxWidth+"px":a.maxWidth,a.role?u.setAttribute("role",a.role):u.removeAttribute("role"),o.content===a.content&&o.allowHTML===a.allowHTML||Is(d,s.props),a.arrow?m?o.arrow!==a.arrow&&(u.removeChild(m),u.appendChild(pi(a.arrow))):u.appendChild(pi(a.arrow)):m&&u.removeChild(m)}return n.className=nA,n.setAttribute("data-state","hidden"),Is(n,s.props),e.appendChild(t),t.appendChild(n),i(s.props,s.props),{popper:e,onUpdate:i}}kw.$$tippy=!0;var vE=1,Ap=[],oA=[];function _E(s,e){var t,n,i,o,a,c,u,d,m=Ms(s,Object.assign({},or,Gr(Rt(e)))),g=!1,_=!1,w=!1,x=!1,T=[],I=rA(gt,m.interactiveDebounce),R=vE++,M=(d=m.plugins).filter(function(ut,on){return d.indexOf(ut)===on}),C={id:R,reference:s,popper:Nt(),popperInstance:null,props:m,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:M,clearDelayTimeouts:function(){clearTimeout(t),clearTimeout(n),cancelAnimationFrame(i)},setProps:function(ut){if(!C.state.isDestroyed){Ee("onBeforeUpdate",[C,ut]),zn();var on=C.props,kn=Ms(s,Object.assign({},on,Rt(ut),{ignoreAttributes:!0}));C.props=kn,Xn(),on.interactiveDebounce!==kn.interactiveDebounce&&(Et(),I=rA(gt,kn.interactiveDebounce)),on.triggerTarget&&!kn.triggerTarget?eu(on.triggerTarget).forEach(function(Yt){Yt.removeAttribute("aria-expanded")}):kn.triggerTarget&&s.removeAttribute("aria-expanded"),We(),_e(),j&&j(on,kn),C.popperInstance&&(Ri(),ni().forEach(function(Yt){requestAnimationFrame(Yt._tippy.popperInstance.forceUpdate)})),Ee("onAfterUpdate",[C,ut])}},setContent:function(ut){C.setProps({content:ut})},show:function(){var ut=C.state.isVisible,on=C.state.isDestroyed,kn=!C.state.isEnabled,Yt=gi.isTouch&&!C.props.touch,Zn=L_(C.props.duration,0,or.duration);if(!(ut||on||kn||Yt||he().hasAttribute("disabled")||(Ee("onShow",[C],!1),C.props.onShow(C)===!1))){if(C.state.isVisible=!0,re()&&(k.style.visibility="visible"),_e(),Pt(),C.state.isMounted||(k.style.transition="none"),re()){var Nr=ue();rn([Nr.box,Nr.content],0)}var $r,Gs,Xo;c=function(){var Pa;if(C.state.isVisible&&!x){if(x=!0,k.offsetHeight,k.style.transition=C.props.moveTransition,re()&&C.props.animation){var Lo=ue(),fi=Lo.box,yl=Lo.content;rn([fi,yl],Zn),On([fi,yl],"visible")}Ye(),We(),sA(oA,C),(Pa=C.popperInstance)==null||Pa.forceUpdate(),Ee("onMount",[C]),C.props.animation&&re()&&function(Gp,Se){hn(Gp,function(){C.state.isShown=!0,Ee("onShown",[C])})}(Zn)}},Gs=C.props.appendTo,Xo=he(),($r=C.props.interactive&&Gs===Kh||Gs==="parent"?Xo.parentNode:Vg(Gs,[Xo])).contains(k)||$r.appendChild(k),C.state.isMounted=!0,Ri()}},hide:function(){var ut=!C.state.isVisible,on=C.state.isDestroyed,kn=!C.state.isEnabled,Yt=L_(C.props.duration,1,or.duration);if(!(ut||on||kn)&&(Ee("onHide",[C],!1),C.props.onHide(C)!==!1)){if(C.state.isVisible=!1,C.state.isShown=!1,x=!1,g=!1,re()&&(k.style.visibility="hidden"),Et(),sn(),_e(!0),re()){var Zn=ue(),Nr=Zn.box,$r=Zn.content;C.props.animation&&(rn([Nr,$r],Yt),On([Nr,$r],"hidden"))}Ye(),We(),C.props.animation?re()&&function(Gs,Xo){hn(Gs,function(){!C.state.isVisible&&k.parentNode&&k.parentNode.contains(k)&&Xo()})}(Yt,C.unmount):C.unmount()}},hideWithInteractivity:function(ut){le().addEventListener("mousemove",I),sA(Ap,I),I(ut)},enable:function(){C.state.isEnabled=!0},disable:function(){C.hide(),C.state.isEnabled=!1},unmount:function(){C.state.isVisible&&C.hide(),C.state.isMounted&&(_i(),ni().forEach(function(ut){ut._tippy.unmount()}),k.parentNode&&k.parentNode.removeChild(k),oA=oA.filter(function(ut){return ut!==C}),C.state.isMounted=!1,Ee("onHidden",[C]))},destroy:function(){C.state.isDestroyed||(C.clearDelayTimeouts(),C.unmount(),zn(),delete s._tippy,C.state.isDestroyed=!0,Ee("onDestroy",[C]))}};if(!m.render)return C;var L=m.render(C),k=L.popper,j=L.onUpdate;k.setAttribute("data-tippy-root",""),k.id="tippy-"+C.id,C.popper=k,s._tippy=C,k._tippy=C;var H=M.map(function(ut){return ut.fn(C)}),X=s.hasAttribute("aria-expanded");return Xn(),We(),_e(),Ee("onCreate",[C]),m.showOnCreate&&ii(),k.addEventListener("mouseenter",function(){C.props.interactive&&C.state.isVisible&&C.clearDelayTimeouts()}),k.addEventListener("mouseleave",function(){C.props.interactive&&C.props.trigger.indexOf("mouseenter")>=0&&le().addEventListener("mousemove",I)}),C;function ee(){var ut=C.props.touch;return Array.isArray(ut)?ut:[ut,0]}function oe(){return ee()[0]==="hold"}function re(){var ut;return!((ut=C.props.render)==null||!ut.$$tippy)}function he(){return u||s}function le(){var ut,on,kn=he().parentNode;return kn&&(on=eu(kn)[0])!=null&&(ut=on.ownerDocument)!=null&&ut.body?on.ownerDocument:document}function ue(){return Gg(k)}function ge(ut){return C.state.isMounted&&!C.state.isVisible||gi.isTouch||o&&o.type==="focus"?0:L_(C.props.delay,ut?0:1,or.delay)}function _e(ut){ut===void 0&&(ut=!1),k.style.pointerEvents=C.props.interactive&&!ut?"":"none",k.style.zIndex=""+C.props.zIndex}function Ee(ut,on,kn){var Yt;kn===void 0&&(kn=!0),H.forEach(function(Zn){Zn[ut]&&Zn[ut].apply(Zn,on)}),kn&&(Yt=C.props)[ut].apply(Yt,on)}function Ye(){var ut=C.props.aria;if(ut.content){var on="aria-"+ut.content,kn=k.id;eu(C.props.triggerTarget||s).forEach(function(Yt){var Zn=Yt.getAttribute(on);if(C.state.isVisible)Yt.setAttribute(on,Zn?Zn+" "+kn:kn);else{var Nr=Zn&&Zn.replace(kn,"").trim();Nr?Yt.setAttribute(on,Nr):Yt.removeAttribute(on)}})}}function We(){!X&&C.props.aria.expanded&&eu(C.props.triggerTarget||s).forEach(function(ut){C.props.interactive?ut.setAttribute("aria-expanded",C.state.isVisible&&ut===he()?"true":"false"):ut.removeAttribute("aria-expanded")})}function Et(){le().removeEventListener("mousemove",I),Ap=Ap.filter(function(ut){return ut!==I})}function lt(ut){if(!gi.isTouch||!w&&ut.type!=="mousedown"){var on=ut.composedPath&&ut.composedPath()[0]||ut.target;if(!C.props.interactive||!di(k,on)){if(eu(C.props.triggerTarget||s).some(function(kn){return di(kn,on)})){if(gi.isTouch||C.state.isVisible&&C.props.trigger.indexOf("click")>=0)return}else Ee("onClickOutside",[C,ut]);C.props.hideOnClick===!0&&(C.clearDelayTimeouts(),C.hide(),_=!0,setTimeout(function(){_=!1}),C.state.isMounted||sn())}}}function rt(){w=!0}function kt(){w=!1}function Pt(){var ut=le();ut.addEventListener("mousedown",lt,!0),ut.addEventListener("touchend",lt,Yh),ut.addEventListener("touchstart",kt,Yh),ut.addEventListener("touchmove",rt,Yh)}function sn(){var ut=le();ut.removeEventListener("mousedown",lt,!0),ut.removeEventListener("touchend",lt,Yh),ut.removeEventListener("touchstart",kt,Yh),ut.removeEventListener("touchmove",rt,Yh)}function hn(ut,on){var kn=ue().box;function Yt(Zn){Zn.target===kn&&(Gi(kn,"remove",Yt),on())}if(ut===0)return on();Gi(kn,"remove",a),Gi(kn,"add",Yt),a=Yt}function wn(ut,on,kn){kn===void 0&&(kn=!1),eu(C.props.triggerTarget||s).forEach(function(Yt){Yt.addEventListener(ut,on,kn),T.push({node:Yt,eventType:ut,handler:on,options:kn})})}function Xn(){var ut;oe()&&(wn("touchstart",Gn,{passive:!0}),wn("touchend",zt,{passive:!0})),(ut=C.props.trigger,ut.split(/\s+/).filter(Boolean)).forEach(function(on){if(on!=="manual")switch(wn(on,Gn),on){case"mouseenter":wn("mouseleave",zt);break;case"focus":wn(qa?"focusout":"blur",an);break;case"focusin":wn("focusout",an)}})}function zn(){T.forEach(function(ut){var on=ut.node,kn=ut.eventType,Yt=ut.handler,Zn=ut.options;on.removeEventListener(kn,Yt,Zn)}),T=[]}function Gn(ut){var on,kn=!1;if(C.state.isEnabled&&!ui(ut)&&!_){var Yt=((on=o)==null?void 0:on.type)==="focus";o=ut,u=ut.currentTarget,We(),!C.state.isVisible&&k_(ut,"MouseEvent")&&Ap.forEach(function(Zn){return Zn(ut)}),ut.type==="click"&&(C.props.trigger.indexOf("mouseenter")<0||g)&&C.props.hideOnClick!==!1&&C.state.isVisible?kn=!0:ii(ut),ut.type==="click"&&(g=!kn),kn&&!Yt&&Bn(ut)}}function gt(ut){var on=ut.target,kn=he().contains(on)||k.contains(on);if(ut.type!=="mousemove"||!kn){var Yt=ni().concat(k).map(function(Zn){var Nr,$r=(Nr=Zn._tippy.popperInstance)==null?void 0:Nr.state;return $r?{popperRect:Zn.getBoundingClientRect(),popperState:$r,props:m}:null}).filter(Boolean);(function(Zn,Nr){var $r=Nr.clientX,Gs=Nr.clientY;return Zn.every(function(Xo){var Pa=Xo.popperRect,Lo=Xo.popperState,fi=Xo.props.interactiveBorder,yl=Lo.placement.split("-")[0],Gp=Lo.modifiersData.offset;if(!Gp)return!0;var Se=yl==="bottom"?Gp.top.y:0,nt=yl==="top"?Gp.bottom.y:0,vt=yl==="right"?Gp.left.x:0,$t=yl==="left"?Gp.right.x:0,ln=Pa.top-Gs+Se>fi,yt=Gs-Pa.bottom-nt>fi,en=Pa.left-$r+vt>fi,Fn=$r-Pa.right-$t>fi;return ln||yt||en||Fn})})(Yt,ut)&&(Et(),Bn(ut))}}function zt(ut){ui(ut)||C.props.trigger.indexOf("click")>=0&&g||(C.props.interactive?C.hideWithInteractivity(ut):Bn(ut))}function an(ut){C.props.trigger.indexOf("focusin")<0&&ut.target!==he()||C.props.interactive&&ut.relatedTarget&&k.contains(ut.relatedTarget)||Bn(ut)}function ui(ut){return!!gi.isTouch&&oe()!==ut.type.indexOf("touch")>=0}function Ri(){_i();var ut=C.props,on=ut.popperOptions,kn=ut.placement,Yt=ut.offset,Zn=ut.getReferenceClientRect,Nr=ut.moveTransition,$r=re()?Gg(k).arrow:null,Gs=Zn?{getBoundingClientRect:Zn,contextElement:Zn.contextElement||he()}:s,Xo=[{name:"offset",options:{offset:Yt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Nr}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Pa){var Lo=Pa.state;if(re()){var fi=ue().box;["placement","reference-hidden","escaped"].forEach(function(yl){yl==="placement"?fi.setAttribute("data-placement",Lo.placement):Lo.attributes.popper["data-popper-"+yl]?fi.setAttribute("data-"+yl,""):fi.removeAttribute("data-"+yl)}),Lo.attributes.popper={}}}}];re()&&$r&&Xo.push({name:"arrow",options:{element:$r,padding:3}}),Xo.push.apply(Xo,(on==null?void 0:on.modifiers)||[]),C.popperInstance=jg(Gs,k,Object.assign({},on,{placement:kn,onFirstUpdate:c,modifiers:Xo}))}function _i(){C.popperInstance&&(C.popperInstance.destroy(),C.popperInstance=null)}function ni(){return Te(k.querySelectorAll("[data-tippy-root]"))}function ii(ut){C.clearDelayTimeouts(),ut&&Ee("onTrigger",[C,ut]),Pt();var on=ge(!0),kn=ee(),Yt=kn[0],Zn=kn[1];gi.isTouch&&Yt==="hold"&&Zn&&(on=Zn),on?t=setTimeout(function(){C.show()},on):C.show()}function Bn(ut){if(C.clearDelayTimeouts(),Ee("onUntrigger",[C,ut]),C.state.isVisible){if(!(C.props.trigger.indexOf("mouseenter")>=0&&C.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ut.type)>=0&&g)){var on=ge(!1);on?n=setTimeout(function(){C.state.isVisible&&C.hide()},on):i=requestAnimationFrame(function(){C.hide()})}}else sn()}}function Kf(s,e){e===void 0&&(e={});var t=or.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",Yi,Yh),window.addEventListener("blur",uo);var n,i=Object.assign({},e,{plugins:t}),o=(n=s,jt(n)?[n]:function(a){return k_(a,"NodeList")}(n)?Te(n):Array.isArray(n)?n:Te(document.querySelectorAll(n))).reduce(function(a,c){var u=c&&_E(c,i);return u&&a.push(u),a},[]);return jt(s)?o[0]:o}Kf.defaultProps=or,Kf.setDefaultProps=function(s){Object.keys(s).forEach(function(e){or[e]=s[e]})},Kf.currentInput=gi;var yE=Object.assign({},Lt,{effect:function(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow)}}),AE=function(s,e){var t;e===void 0&&(e={});var n,i=s,o=[],a=[],c=e.overrides,u=[],d=!1;function m(){a=i.map(function(j){return eu(j.props.triggerTarget||j.reference)}).reduce(function(j,H){return j.concat(H)},[])}function g(){o=i.map(function(j){return j.reference})}function _(j){i.forEach(function(H){j?H.enable():H.disable()})}function w(j){return i.map(function(H){var X=H.setProps;return H.setProps=function(ee){X(ee),H.reference===n&&j.setProps(ee)},function(){H.setProps=X}})}function x(j,H){var X=a.indexOf(H);if(H!==n){n=H;var ee=(c||[]).concat("content").reduce(function(oe,re){return oe[re]=i[X].props[re],oe},{});j.setProps(Object.assign({},ee,{getReferenceClientRect:typeof ee.getReferenceClientRect=="function"?ee.getReferenceClientRect:function(){var oe;return(oe=o[X])==null?void 0:oe.getBoundingClientRect()}}))}}_(!1),g(),m();var T,I,R,M={fn:function(){return{onDestroy:function(){_(!0)},onHidden:function(){n=null},onClickOutside:function(j){j.props.showOnCreate&&!d&&(d=!0,n=null)},onShow:function(j){j.props.showOnCreate&&!d&&(d=!0,x(j,o[0]))},onTrigger:function(j,H){x(j,H.currentTarget)}}}},C=Kf(Nt(),Object.assign({},(T=e,I=["overrides"],R=Object.assign({},T),I.forEach(function(j){delete R[j]}),R),{plugins:[M].concat(e.plugins||[]),triggerTarget:a,popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((t=e.popperOptions)==null?void 0:t.modifiers)||[],[yE])})})),L=C.show;C.show=function(j){if(L(),!n&&j==null)return x(C,o[0]);if(!n||j!=null){if(typeof j=="number")return o[j]&&x(C,o[j]);if(i.indexOf(j)>=0){var H=j.reference;return x(C,H)}return o.indexOf(j)>=0?x(C,j):void 0}},C.showNext=function(){var j=o[0];if(!n)return C.show(0);var H=o.indexOf(n);C.show(o[H+1]||j)},C.showPrevious=function(){var j=o[o.length-1];if(!n)return C.show(j);var H=o.indexOf(n),X=o[H-1]||j;C.show(X)};var k=C.setProps;return C.setProps=function(j){c=j.overrides||c,k(j)},C.setInstances=function(j){_(!0),u.forEach(function(H){return H()}),i=j,_(!1),g(),m(),u=w(C),C.setProps({triggerTarget:a})},u=w(C),C};Kf.setDefaultProps({render:kw});var zu=Kf;class Ks{static _initialize(){this._inited=!0,(0,V.createStyles)(V.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&e.button===0&&this.Remove()})}static Create(e,t,n){this._inited||this._initialize(),this.Element&&this.Remove();const i=(0,V.createDiv)({id:"customContextMenu",addToBody:!1});i.style.top=n+"px",i.style.left=t+"px";for(const[o,a]of Object.entries(e)){const c=(0,V.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:o});i.appendChild(c),c.onclick=a}return this.Element=i,i}static Remove(){var e;(e=this.Element)==null||e.remove(),this.Element=void 0}}Ks.Element=void 0,Ks._inited=!1;class Vu extends D_{constructor(){super(...arguments),this.enableEditContextMenus=!1}async _refreshUi(){var e;if(!await super._refreshUi())return!1;Wa.RemoveAll(Vu.PluginType);for(const t of this.variations)Wa.Create(Vu.PluginType,t.title+(this.enableEditContextMenus?" ("+t.uuid+")":""),5,20,0,t.materials.map(n=>{let i;if(t.preview.startsWith("generate:"))i=this._previewGenerator.generate(n,t.preview.split(":")[1]);else{const o=n[t.preview]||"#ff00ff";i=o.image?(0,V.imageBitmapToBase64)(o.image,100):void 0,i||(i=(0,V.makeColorSvgCircle)(o!=null&&o.isColor?o.getHexString():o))}return{id:n.uuid,image:i,onClick:o=>this.applyVariation(t,o),tooltip:n.name||n.uuid}}),(n,i,o)=>{zu(n,{placement:"bottom",content:i.tooltip}),n.oncontextmenu=a=>{if(!this.enableEditContextMenus)return;a.preventDefault(),a.stopPropagation();const c=Ks.Create({Remove:async()=>{var u;await((u=this._viewer)==null?void 0:u.confirm("Remove material: Remove material from this variation list?"))&&(t.materials=t.materials.filter(d=>d.uuid!==i.id),this.refreshUi(),Ks.Remove())},"Remove All":async()=>{var u;await((u=this._viewer)==null?void 0:u.confirm("Remove all: Remove all materials from this variation list?"))&&(t.materials=[],this.refreshUi(),Ks.Remove())}},a.clientX,a.clientY);document.body.appendChild(c)},o.oncontextmenu=a=>{if(!this.enableEditContextMenus)return;a.preventDefault(),a.stopPropagation();const c=Ks.Create({"Rename mapping":async()=>{var d;const u=await((d=this._viewer)==null?void 0:d.prompt("Change name: New material name to map to",t.uuid,!0));u&&(t.uuid=u,this.refreshUi())},"Rename title":async()=>{var d;const u=await((d=this._viewer)==null?void 0:d.prompt("Change name: New material name to map to",t.title,!0));u&&(t.title=u,this.refreshUi())},"Remove Section":async()=>{var u;await((u=this._viewer)==null?void 0:u.confirm("Remove variations: Remove this category of variations?"))&&(this.removeVariation(t),Ks.Remove())}},a.clientX,a.clientY);document.body.appendChild(c)}});return Wa.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}Vu.PluginType="MaterialConfiguratorPlugin";class ur extends En{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[Qt],this.variations=[],this._selectedSwitchNode=()=>{var i;const e=(i=this._picking)==null?void 0:i.getSelectedObject();if(!e)return;const t=this.variations.map(o=>o.name);let n;return e.traverseAncestors(o=>{n||o.name&&t.includes(o.name)&&(n=o)}),n},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,n;await super.onAdded(e),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",()=>{var i,o;(o=(i=this.uiConfig).uiRefresh)==null||o.call(i)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer&&this.enabled){for(const i of this.variations){if(!i.name)continue;const o=this._viewer.scene.getObjectByName(i.name);if(!o||o.children.length<1)return;i.selected||(i.selected=o.children[0].name||o.children[0].uuid);for(const a of o.children)a.userData.__oldVisible=a.visible,a.visible=(a.name||a.uuid)===i.selected}this._isVisibleChanged=!0}}),e.addEventListener("postRender",()=>{if(this._viewer&&this._isVisibleChanged){for(const i of this.variations){if(!i.name)continue;const o=this._viewer.scene.getObjectByName(i.name);if(!o||o.children.length<1)return;for(const a of o.children){if(a.userData.__oldVisible===void 0)return;a.visible=a.userData.__oldVisible,delete a.userData.__oldVisible}}this._isVisibleChanged=!1}}),this.addEventListener("deserialize",async()=>{this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(t=(e=this.uiConfig).uiRefresh)==null||t.call(e),!0)}}(function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Ae()],ur.prototype,"variations",void 0);class Jh extends ur{_refreshUi(){var e;if(!super._refreshUi())return!1;Wa.RemoveAll(Jh.PluginType);for(const t of this.variations){const n=this._viewer.scene.getObjectByName(t.name);n?(n.children.length<1&&console.warn("SwitchNode does not have enough children",t),Wa.Create(Jh.PluginType,t.title,Math.min(5,n.children.length),20,0,n.children.map(i=>{const o=t.camView,a=new p.Pa4((o.includes("right")?1:0)-(o.includes("left")?1:0),(o.includes("top")?1:0)-(o.includes("bottom")?1:0),(o.includes("front")?1:0)-(o.includes("back")?1:0));t.camDistance||(t.camDistance=1);const c=Jy(this._viewer,i,void 0,7,a.multiplyScalar(.5*t.camDistance));return{id:i.uuid,image:c,onClick:()=>{var u;t.selected=i.name||i.uuid,(u=this._viewer)==null||u.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:i.name||i.uuid}}),(i,o)=>zu(i,{placement:"bottom",content:o.tooltip}))):console.warn("no object found for variation, skipping",t)}return Wa.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}Jh.PluginType="SwitchNodePlugin";class Gl extends En{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0))},this.dependencies=[Qt],this._selectedObject=()=>{var e;return((e=this._picking)==null?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())==null?void 0:e.material)||void 0}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new Zy(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}Gl.PluginType="MaterialLibraryBasePlugin",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([Gt("Enabled")],Gl.prototype,"enabled",void 0);class qo extends Gl{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:ns(),children:[...Da(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Qt).materials.getAllMaterials().map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return(e=this._selectedMaterial())==null?void 0:e.uuid},setValue:e=>{var n,i,o,a,c;const t=(o=(i=(n=this._viewer)==null?void 0:n.getPlugin(Qt))==null?void 0:i.materials)==null?void 0:o.findMaterial(e);if(t)if(this.replaceMaterial)(c=(a=this._selectedObject())==null?void 0:a.setMaterial)==null||c.call(a,t);else{const u=this._selectedMaterial();if(u){const d=u.name,m=u.uuid;u.copyProps(t),u.name=d,u.uuid=m,u.userData.uuid&&(u.userData.uuid=m)}}this._refreshUi()}})]}}async _refreshUi(){var i,o,a;if(!await super._refreshUi())return!1;const e=[Hs.TypeSlug,ki.TypeSlug],t=(o=(i=this._viewer)==null?void 0:i.getPlugin(Qt))==null?void 0:o.materials,n=e.map(c=>[c,t==null?void 0:t.getMaterialsOfType(c)]);Wa.RemoveAll(qo.PluginType);for(const[c,u]of n)Wa.Create(qo.PluginType,c,5,20,0,u==null?void 0:u.filter(d=>!d.userData.runtimeMaterial).map(d=>{let m;const g="generate:sphere";if(g.startsWith("generate:"))m=this._previewGenerator.generate(d,g.split(":")[1]);else{const _=d[g]||"#ff00ff";m=_.image?(0,V.imageBitmapToBase64)(_.image,100):void 0,m||(m=(0,V.makeColorSvg)(_))}return{id:d.uuid,image:m,onClick:_=>{const w=t==null?void 0:t.findMaterial(_);if(w){const x=w.userData.__appliedMeshes;if(x!=null&&x.size){const T=x.keys().next().value;T.dispatchEvent({type:"select",value:T})}}},tooltip:d.name||d.uuid}}),(d,m)=>zu(d,{placement:"bottom",content:m.tooltip}));return Wa.RebuildUi((a=this._viewer)==null?void 0:a.container),!0}}qo.PluginType="MaterialLibraryPlugin",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([Gt("Replace Material")],qo.prototype,"replaceMaterial",void 0);class U_ extends p.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",V.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Fe({propKey:"tLastThis"})],U_.prototype,"lastFrameTexture",void 0);var Hl=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ho extends V.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.shadowMapType=p._MY,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(n,i)=>V.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(n,i,o)=>{this.groundMapMode==="aoMap"?n.fragmentShader=Sn(n.fragmentShader,"#include <aomap_fragment>",Sn(p.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?n.fragmentShader=Sn(n.fragmentShader,"#include <map_fragment>",Sn(p.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(n.fragmentShader=Sn(n.fragmentShader,"#include <alphamap_fragment>",Sn(p.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),n.fragmentShader=Sn(n.fragmentShader,"#include <output_fragment>",V.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&o.capabilities.isWebGL2&&(n.defines.USE_UV="",n.fragmentShader=Sn(n.fragmentShader,"#include <output_fragment>",V.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV // why are we checking for this? this is always supposed to be true
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(n,i)=>{i.materialObject.userData.gMapMode!==this.groundMapMode&&(i.materialObject.userData.gMapMode=this.groundMapMode,i.materialObject.needsUpdate=!0)},isCompatible:n=>n.isMeshStandardMaterial2},this._viewer=e;const t=new Jm(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new p.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new p.Pa4(10,10,10),normalDirection:new p.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new U_({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:p.jFi}),this._shadowBlurMat=new ic({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new p.FM8(.5,.5)},direction:{value:new p.FM8(.5,.5)}},vertexShader:Vo,fragmentShader:`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,n;(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e),(n=this._viewer)==null||n.setDirty()}fromJSON(e,t){return Di(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e||++this._frameNumber>this.maxFrameNumber)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:p.ywz,depthBuffer:!1,size:new p.FM8(t,t),sizeMultiplier:void 0,colorSpace:p.aCh,format:p.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const n=this._viewer.renderer.rendererObject,i=n.shadowMap,o=i.type,a=i.needsUpdate,c=i.autoUpdate;i.type=this.shadowMapType,i.needsUpdate=!0,i.autoUpdate=!1;const u=this._viewer.scene,d=new p.S9g;d.disableAll(),u.modelObject.traverse(x=>{x.isLight&&x!==this._light.lightObject&&(x.userData.__gp_layers=x.layers,x.layers=d)});const m=u.activeCamera.cameraObject;if(m.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";m.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),Vt(n,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(u)),m.layers.disable(this._lightLayer);const g=m.layers.mask;m.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const _=this._viewer.renderer.getTempTarget({type:p.ywz,depthBuffer:!1,size:new p.FM8(t,t),colorSpace:p.aCh,format:p.wk1}),w=_.texture.colorSpace;_.texture.colorSpace=p.aCh,this._viewer.renderer.blit(this._target.texture,_,{clear:!0});{const x=e.material,T=e.frustumCulled,I=n.getRenderTarget(),R=n.getActiveCubeFace(),M=n.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,n.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=_.texture,this._shadowMat.needsUpdate=!0,Vt(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(u)),n.setRenderTarget(I,R,M),e.frustumCulled=T,e.material=x,this.smoothShadow&&this._applySmoothFilter(this._target,_)}return _.texture.colorSpace=w,this._viewer.renderer.releaseTempTarget(_),e.layers.disable(this._lightLayer),m.layers.mask=g,u.modelObject.traverse(x=>{x.isLight&&x!==this._light.lightObject&&(x.layers=x.userData.__gp_layers,delete x.userData.__gp_layers)}),i.type=o,i.needsUpdate=a,i.autoUpdate=c,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,n,i;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((t=this._target)==null?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((n=this._target)==null?void 0:n.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((i=this._target)==null?void 0:i.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}Hl([Ae("randomizedLight")],ho.prototype,"_light",void 0),Hl([(0,V.onChange)(ho.prototype.reset),Ae()],ho.prototype,"maxFrameNumber",void 0),Hl([(0,V.onChange)(ho.prototype.reset),Ae()],ho.prototype,"smoothShadow",void 0),Hl([Ae(),(0,V.onChange)(ho.prototype.reset)],ho.prototype,"shadowMapType",void 0),Hl([(0,V.onChange)(ho.prototype._groundMapModeChanged),Ae()],ho.prototype,"groundMapMode",void 0),Hl([Ae(),(0,V.onChange)(ho.prototype._alphaVignetteChanged)],ho.prototype,"alphaVignette",void 0),Hl([Ae(),(0,V.onChange)(ho.prototype._alphaVignetteChanged)],ho.prototype,"alphaVignetteAxis",void 0),Hl([Ae()],ho.prototype,"maxBakeCount",void 0);var Ro=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class hl extends p.Kj0{_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e)}constructor(e,t,n=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new p.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(I,R,M)=>{if(this.enabled){I.vertexShader=Sn(I.vertexShader,"void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const C="#glMarker beforeModulation";I.fragmentShader=Sn(I.fragmentShader,C,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+C)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?k0+`
`+al+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:I=>this.enabled+" "+I.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(I,{materialObject:R})=>{R.userData.__lastTransparent!==R.transparent&&(R.needsUpdate=!0,R.userData.__lastTransparent=R.transparent)},isCompatible:I=>I.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const i=new p.JOQ,o=new p.Pa4,a=new p.Pa4,c=new p.Pa4,u=new p.yGw,d=new p.Pa4(0,0,-1),m=new p.Ltg,g=new p.Pa4,_=new p.Pa4,w=new p.Ltg,x=new p.yGw,T=new p.cPb;p.M8C.isPowerOfTwo(t.texture.image.width)&&p.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(I,R,M)=>{if(!this.enabled||!I.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const C=M.view?Object.assign({},M.view):null;if(C&&M.clearViewOffset&&M.clearViewOffset(),a.setFromMatrixPosition(this.matrixWorld),c.setFromMatrixPosition(M.matrixWorld),u.extractRotation(this.matrixWorld),o.set(0,0,1),o.applyMatrix4(u),g.subVectors(a,c),g.dot(o)>0)return;g.reflect(o).negate(),g.add(a),u.extractRotation(M.matrixWorld),d.set(0,0,-1),d.applyMatrix4(u),d.add(c),_.subVectors(a,d),_.reflect(o).negate(),_.add(a),T.position.copy(g),T.up.set(0,1,0),T.up.applyMatrix4(u),T.up.reflect(o),T.lookAt(_),T.far=2,T.near=0,T.updateMatrixWorld(),T.projectionMatrix.copy(M.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(T.projectionMatrix),x.multiply(T.matrixWorldInverse),x.multiply(this.matrixWorld),i.setFromNormalAndCoplanarPoint(o,a),i.applyMatrix4(T.matrixWorldInverse),m.set(i.normal.x,i.normal.y,i.normal.z,i.constant);const L=T.projectionMatrix;w.x=(Math.sign(m.x)+L.elements[8])/L.elements[0],w.y=(Math.sign(m.y)+L.elements[9])/L.elements[5],w.z=-1,w.w=(1+L.elements[10])/L.elements[14],m.multiplyScalar(2/m.dot(w)),L.elements[2]=m.x,L.elements[6]=m.y,L.elements[10]=m.z+1-n,L.elements[14]=m.w,this.visible=!1;const k=I.getRenderTarget(),j=I.xr.enabled,H=I.shadowMap.autoUpdate;I.xr.enabled=!1,I.shadowMap.autoUpdate=!1,I.setRenderTarget(this._renderTarget),I.state.buffers.depth.setMask(!0),I.autoClear===!1&&I.clear();const X=R.background;this.transparentReflectionBackground&&(R.background=null);const ee=!this.transparentReflectionBackground;X!=null&&X.isTexture&&ee&&(X.userData||(X.userData={}),X.userData.flipX=!X.userData.flipX),Vt(I,{shadowMapRender:!1,backgroundRender:ee,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>I.render(R,T)),X!=null&&X.isTexture&&ee&&(X.userData.flipX=!X.userData.flipX||void 0),this.transparentReflectionBackground&&(R.background=X),I.xr.enabled=j,I.shadowMap.autoUpdate=H,I.setRenderTarget(k),C!=null&&C.enabled&&M.setViewOffset&&M.setViewOffset(C.fullWidth,C.fullHeight,C.offsetX,C.offsetY,C.width,C.height);const oe=M.viewport;oe!==void 0&&I.state.viewport(oe),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=x,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new p.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=x}getRenderTarget(){return this._renderTarget}}Ro([(0,V.onChange)(hl.prototype._updateExtension)],hl.prototype,"enabled",void 0),Ro([(0,V.onChange)(hl.prototype._updateExtension)],hl.prototype,"reflectorModePhysical",void 0),hl.prototype.isReflector=!0;var Gu=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Ur extends En{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Qt],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new p._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new p.Kj0(this._geometry)}async onAdded(e){var n,i;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Qt);const t=this._createMesh();t.userData.physicsMass=0,this._iMesh=await((n=this._manager)==null?void 0:n.addImportedSingle(t,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(i=this._iMesh)==null?void 0:i.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,n,i;return this._removeMaterial(),this._geometry.dispose(),(t=this._material)==null||t.dispose(),(i=(n=this._iMesh)==null?void 0:n.dispose)==null||i.call(n),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){(e==null?void 0:e.geometryChanged)!==!1&&(e==null?void 0:e.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var t;const e=(t=this._viewer)==null?void 0:t.scene.activeCamera.controls;e&&(e.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=e.maxPolarAngle),e.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(e.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var t,n,i;if(!this._mesh||!this._viewer)return;let e=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,e=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const o=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const a=o.getCenter(new p.Pa4).sub(new p.Pa4(0,o.getSize(new p.Pa4).y/2+this.yOffset,0));e=e||a.clone().sub(this._mesh.position).length()>1e-4,e&&this._mesh.position.copy(a)}e=e||Math.abs(this._mesh.scale.x-this.size)>1e-4,e&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new p.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(n=(t=this._mesh).setDirty)==null||n.call(t)),this._transformNeedRefresh=!1}else e&&((i=this._viewer)==null||i.scene.setDirty())}_refreshMaterial(){var n,i,o,a;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const e=this._material??((i=(n=this._manager)==null?void 0:n.materials)==null?void 0:i.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215}));e&&e.userData.runtimeMaterial;let t=!1;return e!==this._material&&(this._removeMaterial(),e&&(this._material=e),(o=this._material)!=null&&o.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(((a=this._mesh)==null?void 0:a.setMaterial)??(u=>{this._mesh&&(this._mesh.material=u.materialObject)}))(this._material)),t=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),t}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)==null?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}Gu([Ae("material")],Ur.prototype,"_material",void 0),Gu([(0,V.onChange)(Ur.prototype.refreshTransform),Ae()],Ur.prototype,"visible",void 0),Gu([(0,V.onChange2)(Ur.prototype._onSceneUpdate),Ae()],Ur.prototype,"size",void 0),Gu([(0,V.onChange2)(Ur.prototype._onSceneUpdate),Ae()],Ur.prototype,"yOffset",void 0),Gu([(0,V.onChange)(Ur.prototype._refreshOptions2),Ae()],Ur.prototype,"renderToDepth",void 0),Gu([(0,V.onChange)(Ur.prototype._refreshOptions2),Ae()],Ur.prototype,"tonemapGround",void 0),Gu([(0,V.onChange)(Ur.prototype._refreshCameraLimits),Ae()],Ur.prototype,"limitCameraAboveGround",void 0);var Xa=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class xa extends Ur{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;(e=this._shadowBaker)==null||e.reset()}constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=t,t&&this.dependencies.push(Uu),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new hl(this._geometry,this._viewer.renderer.createTarget({type:p.ywz,format:p.wk1,colorSpace:p.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:p.D1R,magFilter:p.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...n)=>{var a,c,u,d,m;let i=(c=(a=this._viewer)==null?void 0:a.getPluginByType("SSReflection"))==null?void 0:c.passes.ssr.passObject;i&&!i.enabled&&(i=void 0),i&&(i.enabled=!1);let o=(m=(d=(u=this._viewer)==null?void 0:u.getPluginByType("SSBevelPlugin"))==null?void 0:d.pass)==null?void 0:m.passObject;o&&!o.enabled&&(o=void 0),o&&(o.enabled=!1),t(...n),i&&(i.enabled=!0),o&&(o.enabled=!0)},e}async onAdded(e){var t,n;await super.onAdded(e),this._showDebug&&((t=e.getPlugin(Uu))==null||t.addTexture("bake_ground_1",()=>{var i,o;return(o=(i=this._shadowBaker)==null?void 0:i.light.shadow.map)==null?void 0:o.texture},[100,100,200,200]),(n=e.getPlugin(Uu))==null||n.addTexture("bake_ground_2",()=>{var i,o;return(o=(i=this._shadowBaker)==null?void 0:i.target)==null?void 0:o.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,n,i;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((t=(e=this._material).unregisterMaterialExtensions)==null||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const o=this._mesh.materialExtension;o||console.warn("unable to find the extension to unregister"),(i=(n=this._material).unregisterMaterialExtensions)==null||i.call(n,[o]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),e.geometryChanged!==!1&&this.autoBakeShadows&&((t=this._shadowBaker)==null||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new ho(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var t,n,i,o;if(!this._viewer)return!1;const e=super._refreshMaterial();if(!this._material)return e;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const a=this._mesh.materialExtension;a.updaters=[this._viewer.scene,this._viewer.renderer],(n=(t=this._material).registerMaterialExtensions)==null||n.call(t,[a]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((o=(i=this._material).registerMaterialExtensions)==null||o.call(i,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),e}_extraUiConfig(){var e,t,n,i,o,a,c,u,d,m,g,_,w,x,T,I,R,M,C,L,k,j,H,X,ee,oe,re,he,le,ue;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var ge,_e;return(_e=(ge=this._uiConfig)==null?void 0:ge.uiRefresh)==null?void 0:_e.call(ge,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var ge;return!((ge=this._shadowBaker)!=null&&ge.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(ge=>({label:ge,value:ge})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"]},{label:"Baked shadow type",type:"dropdown",children:[["Basic",p._MY],["PCF",p._iA],["PCFSoft",p.ntZ],["VSM",p.dwk]].map(ge=>({label:ge[0].toString(),value:ge[1]})),property:[this._shadowBaker,"shadowMapType"]},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)==null?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(t=this._shadowBaker)==null?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(i=(n=this._shadowBaker)==null?void 0:n.light)==null?void 0:i.shadowParams,"enabled"],onChange:[(a=(o=this._shadowBaker)==null?void 0:o.light)==null?void 0:a.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(u=(c=this._shadowBaker)==null?void 0:c.light)==null?void 0:u.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(m=(d=this._shadowBaker)==null?void 0:d.light)==null?void 0:m.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(_=(g=this._shadowBaker)==null?void 0:g.light)==null?void 0:_.randomParams,"distanceScale"],onChange:[(x=(w=this._shadowBaker)==null?void 0:w.light)==null?void 0:x.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(I=(T=this._shadowBaker)==null?void 0:T.light)==null?void 0:I.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(M=(R=this._shadowBaker)==null?void 0:R.light)==null?void 0:M.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(L=(C=this._shadowBaker)==null?void 0:C.light)==null?void 0:L.shadowParams,"radius"],onChange:[(j=(k=this._shadowBaker)==null?void 0:k.light)==null?void 0:j.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(X=(H=this._shadowBaker)==null?void 0:H.light)==null?void 0:X.shadowParams,"frustumSize"],onChange:[(oe=(ee=this._shadowBaker)==null?void 0:ee.light)==null?void 0:oe.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(he=(re=this._shadowBaker)==null?void 0:re.light)==null?void 0:he.shadowParams,"bias"],onChange:[(ue=(le=this._shadowBaker)==null?void 0:le.light)==null?void 0:ue.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}xa.PluginType="Ground",Xa([(0,V.onChange)(xa.prototype.refreshOptions),Ae()],xa.prototype,"bakedShadows",void 0),Xa([(0,V.onChange)(xa.prototype.refreshOptions),Ae()],xa.prototype,"groundReflection",void 0),Xa([(0,V.onChange)(xa.prototype.refreshOptions),Ae()],xa.prototype,"physicalReflections",void 0),Xa([Ae("shadowBaker")],xa.prototype,"_shadowBaker",void 0);class Ea extends p.yxD{constructor(e){super(e),this.type=p.cLu}parse(e){const k=Math.pow(2.7182818,2.2),j={l:0,c:0,lc:0};function H(Se,nt,vt,$t,ln){for(;vt<Se;)nt=nt<<8|ii($t,ln),vt+=8;vt-=Se,j.l=nt>>vt&(1<<Se)-1,j.c=nt,j.lc=vt}const X=new Array(59);function ee(Se){return 63&Se}function oe(Se){return Se>>6}const re={c:0,lc:0};function he(Se,nt,vt,$t){Se=Se<<8|ii(vt,$t),nt+=8,re.c=Se,re.lc=nt}const le={c:0,lc:0};function ue(Se,nt,vt,$t,ln,yt,en,Fn,$n){if(Se==nt){$t<8&&(he(vt,$t,ln,yt),vt=re.c,$t=re.lc);let ti=vt>>($t-=8);if(ti=new Uint8Array([ti])[0],Fn.value+ti>$n)return!1;const Yn=en[Fn.value-1];for(;ti-- >0;)en[Fn.value++]=Yn}else{if(!(Fn.value<$n))return!1;en[Fn.value++]=Se}le.c=vt,le.lc=$t}function ge(Se){return 65535&Se}function _e(Se){const nt=ge(Se);return nt>32767?nt-65536:nt}const Ee={a:0,b:0};function Ye(Se,nt){const vt=_e(Se),$t=_e(nt),ln=vt+(1&$t)+($t>>1),yt=ln,en=ln-$t;Ee.a=yt,Ee.b=en}function We(Se,nt){const vt=ge(Se),$t=ge(nt),ln=vt-($t>>1)&65535,yt=$t+ln-32768&65535;Ee.a=yt,Ee.b=ln}function Et(Se,nt,vt,$t,ln,yt,en){const Fn=en<16384,$n=vt>ln?ln:vt;let ti,Yn,wi=1;for(;wi<=$n;)wi<<=1;for(wi>>=1,ti=wi,wi>>=1;wi>=1;){Yn=0;const Vn=Yn+yt*(ln-ti),Un=yt*wi,yi=yt*ti,yn=$t*wi,qn=$t*ti;let Kn,Ei,es,Dr;for(;Yn<=Vn;Yn+=yi){let Wn=Yn;const Ci=Yn+$t*(vt-ti);for(;Wn<=Ci;Wn+=qn){const Hi=Wn+yn,ko=Wn+Un,$l=ko+yn;Fn?(Ye(Se[Wn+nt],Se[ko+nt]),Kn=Ee.a,es=Ee.b,Ye(Se[Hi+nt],Se[$l+nt]),Ei=Ee.a,Dr=Ee.b,Ye(Kn,Ei),Se[Wn+nt]=Ee.a,Se[Hi+nt]=Ee.b,Ye(es,Dr),Se[ko+nt]=Ee.a,Se[$l+nt]=Ee.b):(We(Se[Wn+nt],Se[ko+nt]),Kn=Ee.a,es=Ee.b,We(Se[Hi+nt],Se[$l+nt]),Ei=Ee.a,Dr=Ee.b,We(Kn,Ei),Se[Wn+nt]=Ee.a,Se[Hi+nt]=Ee.b,We(es,Dr),Se[ko+nt]=Ee.a,Se[$l+nt]=Ee.b)}if(vt&wi){const Hi=Wn+Un;Fn?Ye(Se[Wn+nt],Se[Hi+nt]):We(Se[Wn+nt],Se[Hi+nt]),Kn=Ee.a,Se[Hi+nt]=Ee.b,Se[Wn+nt]=Kn}}if(ln&wi){let Wn=Yn;const Ci=Yn+$t*(vt-ti);for(;Wn<=Ci;Wn+=qn){const Hi=Wn+yn;Fn?Ye(Se[Wn+nt],Se[Hi+nt]):We(Se[Wn+nt],Se[Hi+nt]),Kn=Ee.a,Se[Hi+nt]=Ee.b,Se[Wn+nt]=Kn}}ti=wi,wi>>=1}return Yn}function lt(Se,nt,vt,$t,ln,yt){const en=vt.value,Fn=ni(nt,vt),$n=ni(nt,vt);vt.value+=4;const ti=ni(nt,vt);if(vt.value+=4,Fn<0||Fn>=65537||$n<0||$n>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Yn=new Array(65537),wi=new Array(16384);if(function(Vn){for(let Un=0;Un<16384;Un++)Vn[Un]={},Vn[Un].len=0,Vn[Un].lit=0,Vn[Un].p=null}(wi),function(Vn,Un,yi,yn,qn,Kn){const Ei=Un;let es=0,Dr=0;for(;yn<=qn;yn++){if(Ei.value-Un.value>yi)return!1;H(6,es,Dr,Vn,Ei);const Wn=j.l;if(es=j.c,Dr=j.lc,Kn[yn]=Wn,Wn==63){if(Ei.value-Un.value>yi)throw new Error("Something wrong with hufUnpackEncTable");H(8,es,Dr,Vn,Ei);let Ci=j.l+6;if(es=j.c,Dr=j.lc,yn+Ci>qn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Ci--;)Kn[yn++]=0;yn--}else if(Wn>=59){let Ci=Wn-59+2;if(yn+Ci>qn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Ci--;)Kn[yn++]=0;yn--}}(function(Wn){for(let Hi=0;Hi<=58;++Hi)X[Hi]=0;for(let Hi=0;Hi<65537;++Hi)X[Wn[Hi]]+=1;let Ci=0;for(let Hi=58;Hi>0;--Hi){const ko=Ci+X[Hi]>>1;X[Hi]=Ci,Ci=ko}for(let Hi=0;Hi<65537;++Hi){const ko=Wn[Hi];ko>0&&(Wn[Hi]=ko|X[ko]++<<6)}})(Kn)}(Se,vt,$t-(vt.value-en),Fn,$n,Yn),ti>8*($t-(vt.value-en)))throw new Error("Something wrong with hufUncompress");(function(Vn,Un,yi,yn){for(;Un<=yi;Un++){const qn=oe(Vn[Un]),Kn=ee(Vn[Un]);if(qn>>Kn)throw new Error("Invalid table entry");if(Kn>14){const Ei=yn[qn>>Kn-14];if(Ei.len)throw new Error("Invalid table entry");if(Ei.lit++,Ei.p){const es=Ei.p;Ei.p=new Array(Ei.lit);for(let Dr=0;Dr<Ei.lit-1;++Dr)Ei.p[Dr]=es[Dr]}else Ei.p=new Array(1);Ei.p[Ei.lit-1]=Un}else if(Kn){let Ei=0;for(let es=1<<14-Kn;es>0;es--){const Dr=yn[(qn<<14-Kn)+Ei];if(Dr.len||Dr.p)throw new Error("Invalid table entry");Dr.len=Kn,Dr.lit=Un,Ei++}}}})(Yn,Fn,$n,wi),function(Vn,Un,yi,yn,qn,Kn,Ei,es,Dr){let Wn=0,Ci=0;const Hi=Ei,ko=Math.trunc(yn.value+(qn+7)/8);for(;yn.value<ko;)for(he(Wn,Ci,yi,yn),Wn=re.c,Ci=re.lc;Ci>=14;){const Yo=Un[Wn>>Ci-14&16383];if(Yo.len)Ci-=Yo.len,ue(Yo.lit,Kn,Wn,Ci,yi,yn,es,Dr,Hi),Wn=le.c,Ci=le.lc;else{if(!Yo.p)throw new Error("hufDecode issues");let Hp;for(Hp=0;Hp<Yo.lit;Hp++){const Pv=ee(Vn[Yo.p[Hp]]);for(;Ci<Pv&&yn.value<ko;)he(Wn,Ci,yi,yn),Wn=re.c,Ci=re.lc;if(Ci>=Pv&&oe(Vn[Yo.p[Hp]])==(Wn>>Ci-Pv&(1<<Pv)-1)){Ci-=Pv,ue(Yo.p[Hp],Kn,Wn,Ci,yi,yn,es,Dr,Hi),Wn=le.c,Ci=le.lc;break}}if(Hp==Yo.lit)throw new Error("hufDecode issues")}}const $l=8-qn&7;for(Wn>>=$l,Ci-=$l;Ci>0;){const Yo=Un[Wn<<14-Ci&16383];if(!Yo.len)throw new Error("hufDecode issues");Ci-=Yo.len,ue(Yo.lit,Kn,Wn,Ci,yi,yn,es,Dr,Hi),Wn=le.c,Ci=le.lc}}(Yn,wi,Se,vt,ti,$n,yt,ln,{value:0})}function rt(Se){for(let nt=1;nt<Se.length;nt++){const vt=Se[nt-1]+Se[nt]-128;Se[nt]=vt}}function kt(Se,nt){let vt=0,$t=Math.floor((Se.length+1)/2),ln=0;const yt=Se.length-1;for(;!(ln>yt||(nt[ln++]=Se[vt++],ln>yt));)nt[ln++]=Se[$t++]}function Pt(Se){let nt=Se.byteLength;const vt=new Array;let $t=0;const ln=new DataView(Se);for(;nt>0;){const yt=ln.getInt8($t++);if(yt<0){const en=-yt;nt-=en+1;for(let Fn=0;Fn<en;Fn++)vt.push(ln.getUint8($t++))}else{const en=yt;nt-=2;const Fn=ln.getUint8($t++);for(let $n=0;$n<en+1;$n++)vt.push(Fn)}}return vt}function sn(Se,nt,vt){let $t,ln=1;for(;ln<64;)$t=nt[Se.value],$t==65280?ln=64:$t>>8==255?ln+=255&$t:(vt[ln]=$t,ln++),Se.value++}function hn(Se){const nt=.5*Math.cos(.7853975),vt=.5*Math.cos(3.14159/16),$t=.5*Math.cos(3.14159/8),ln=.5*Math.cos(3*3.14159/16),yt=.5*Math.cos(.981746875),en=.5*Math.cos(3*3.14159/8),Fn=.5*Math.cos(1.374445625),$n=new Array(4),ti=new Array(4),Yn=new Array(4),wi=new Array(4);for(let Vn=0;Vn<8;++Vn){const Un=8*Vn;$n[0]=$t*Se[Un+2],$n[1]=en*Se[Un+2],$n[2]=$t*Se[Un+6],$n[3]=en*Se[Un+6],ti[0]=vt*Se[Un+1]+ln*Se[Un+3]+yt*Se[Un+5]+Fn*Se[Un+7],ti[1]=ln*Se[Un+1]-Fn*Se[Un+3]-vt*Se[Un+5]-yt*Se[Un+7],ti[2]=yt*Se[Un+1]-vt*Se[Un+3]+Fn*Se[Un+5]+ln*Se[Un+7],ti[3]=Fn*Se[Un+1]-yt*Se[Un+3]+ln*Se[Un+5]-vt*Se[Un+7],Yn[0]=nt*(Se[Un+0]+Se[Un+4]),Yn[3]=nt*(Se[Un+0]-Se[Un+4]),Yn[1]=$n[0]+$n[3],Yn[2]=$n[1]-$n[2],wi[0]=Yn[0]+Yn[1],wi[1]=Yn[3]+Yn[2],wi[2]=Yn[3]-Yn[2],wi[3]=Yn[0]-Yn[1],Se[Un+0]=wi[0]+ti[0],Se[Un+1]=wi[1]+ti[1],Se[Un+2]=wi[2]+ti[2],Se[Un+3]=wi[3]+ti[3],Se[Un+4]=wi[3]-ti[3],Se[Un+5]=wi[2]-ti[2],Se[Un+6]=wi[1]-ti[1],Se[Un+7]=wi[0]-ti[0]}for(let Vn=0;Vn<8;++Vn)$n[0]=$t*Se[16+Vn],$n[1]=en*Se[16+Vn],$n[2]=$t*Se[48+Vn],$n[3]=en*Se[48+Vn],ti[0]=vt*Se[8+Vn]+ln*Se[24+Vn]+yt*Se[40+Vn]+Fn*Se[56+Vn],ti[1]=ln*Se[8+Vn]-Fn*Se[24+Vn]-vt*Se[40+Vn]-yt*Se[56+Vn],ti[2]=yt*Se[8+Vn]-vt*Se[24+Vn]+Fn*Se[40+Vn]+ln*Se[56+Vn],ti[3]=Fn*Se[8+Vn]-yt*Se[24+Vn]+ln*Se[40+Vn]-vt*Se[56+Vn],Yn[0]=nt*(Se[Vn]+Se[32+Vn]),Yn[3]=nt*(Se[Vn]-Se[32+Vn]),Yn[1]=$n[0]+$n[3],Yn[2]=$n[1]-$n[2],wi[0]=Yn[0]+Yn[1],wi[1]=Yn[3]+Yn[2],wi[2]=Yn[3]-Yn[2],wi[3]=Yn[0]-Yn[1],Se[0+Vn]=wi[0]+ti[0],Se[8+Vn]=wi[1]+ti[1],Se[16+Vn]=wi[2]+ti[2],Se[24+Vn]=wi[3]+ti[3],Se[32+Vn]=wi[3]-ti[3],Se[40+Vn]=wi[2]-ti[2],Se[48+Vn]=wi[1]-ti[1],Se[56+Vn]=wi[0]-ti[0]}function wn(Se){for(let nt=0;nt<64;++nt){const vt=Se[0][nt],$t=Se[1][nt],ln=Se[2][nt];Se[0][nt]=vt+1.5747*ln,Se[1][nt]=vt-.1873*$t-.4682*ln,Se[2][nt]=vt+1.8556*$t}}function Xn(Se,nt,vt){for(let ln=0;ln<64;++ln)nt[vt+ln]=p.A5E.toHalfFloat(($t=Se[ln])<=1?Math.sign($t)*Math.pow(Math.abs($t),2.2):Math.sign($t)*Math.pow(k,Math.abs($t)-1));var $t}function zn(Se){return new DataView(Se.array.buffer,Se.offset.value,Se.size)}function Gn(Se){const nt=Se.viewer.buffer.slice(Se.offset.value,Se.offset.value+Se.size),vt=new Uint8Array(Pt(nt)),$t=new Uint8Array(vt.length);return rt(vt),kt(vt,$t),new DataView($t.buffer)}function gt(Se){const nt=kg(Se.array.slice(Se.offset.value,Se.offset.value+Se.size)),vt=new Uint8Array(nt.length);return rt(nt),kt(nt,vt),new DataView(vt.buffer)}function zt(Se){const nt=Se.viewer,vt={value:Se.offset.value},$t=new Uint16Array(Se.width*Se.scanlineBlockSize*(Se.channels*Se.type)),ln=new Uint8Array(8192);let yt=0;const en=new Array(Se.channels);for(let yi=0;yi<Se.channels;yi++)en[yi]={},en[yi].start=yt,en[yi].end=en[yi].start,en[yi].nx=Se.width,en[yi].ny=Se.lines,en[yi].size=Se.type,yt+=en[yi].nx*en[yi].ny*en[yi].size;const Fn=Zn(nt,vt),$n=Zn(nt,vt);if($n>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Fn<=$n)for(let yi=0;yi<$n-Fn+1;yi++)ln[yi+Fn]=Bn(nt,vt);const ti=new Uint16Array(65536),Yn=function(yi,yn){let qn=0;for(let Ei=0;Ei<65536;++Ei)(Ei==0||yi[Ei>>3]&1<<(7&Ei))&&(yn[qn++]=Ei);const Kn=qn-1;for(;qn<65536;)yn[qn++]=0;return Kn}(ln,ti),wi=ni(nt,vt);lt(Se.array,nt,vt,wi,$t,yt);for(let yi=0;yi<Se.channels;++yi){const yn=en[yi];for(let qn=0;qn<en[yi].size;++qn)Et($t,yn.start+qn,yn.nx,yn.size,yn.ny,yn.nx*yn.size,Yn)}(function(yi,yn,qn){for(let Kn=0;Kn<qn;++Kn)yn[Kn]=yi[yn[Kn]]})(ti,$t,yt);let Vn=0;const Un=new Uint8Array($t.buffer.byteLength);for(let yi=0;yi<Se.lines;yi++)for(let yn=0;yn<Se.channels;yn++){const qn=en[yn],Kn=qn.nx*qn.size,Ei=new Uint8Array($t.buffer,qn.end*2,Kn*2);Un.set(Ei,Vn),Vn+=Kn*2,qn.end+=Kn}return new DataView(Un.buffer)}function an(Se){const nt=kg(Se.array.slice(Se.offset.value,Se.offset.value+Se.size)),vt=Se.lines*Se.channels*Se.width,$t=Se.type==1?new Uint16Array(vt):new Uint32Array(vt);let ln=0,yt=0;const en=new Array(4);for(let Fn=0;Fn<Se.lines;Fn++)for(let $n=0;$n<Se.channels;$n++){let ti=0;switch(Se.type){case 1:en[0]=ln,en[1]=en[0]+Se.width,ln=en[1]+Se.width;for(let Yn=0;Yn<Se.width;++Yn)ti+=nt[en[0]++]<<8|nt[en[1]++],$t[yt]=ti,yt++;break;case 2:en[0]=ln,en[1]=en[0]+Se.width,en[2]=en[1]+Se.width,ln=en[2]+Se.width;for(let Yn=0;Yn<Se.width;++Yn)ti+=nt[en[0]++]<<24|nt[en[1]++]<<16|nt[en[2]++]<<8,$t[yt]=ti,yt++}}return new DataView($t.buffer)}function ui(Se){const nt=Se.viewer,vt={value:Se.offset.value},$t=new Uint8Array(Se.width*Se.lines*(Se.channels*Se.type*2)),ln={version:ut(nt,vt),unknownUncompressedSize:ut(nt,vt),unknownCompressedSize:ut(nt,vt),acCompressedSize:ut(nt,vt),dcCompressedSize:ut(nt,vt),rleCompressedSize:ut(nt,vt),rleUncompressedSize:ut(nt,vt),rleRawSize:ut(nt,vt),totalAcUncompressedCount:ut(nt,vt),totalDcUncompressedCount:ut(nt,vt),acCompression:ut(nt,vt)};if(ln.version<2)throw new Error("EXRLoader.parse: "+Lo.compression+" version "+ln.version+" is unsupported");const yt=new Array;let en=Zn(nt,vt)-2;for(;en>0;){const yn=Ri(nt.buffer,vt),qn=Bn(nt,vt),Kn=qn>>2&3,Ei=new Int8Array([(qn>>4)-1])[0],es=Bn(nt,vt);yt.push({name:yn,index:Ei,type:es,compression:Kn}),en-=yn.length+3}const Fn=Lo.channels,$n=new Array(Se.channels);for(let yn=0;yn<Se.channels;++yn){const qn=$n[yn]={},Kn=Fn[yn];qn.name=Kn.name,qn.compression=0,qn.decoded=!1,qn.type=Kn.pixelType,qn.pLinear=Kn.pLinear,qn.width=Se.width,qn.height=Se.lines}const ti={idx:new Array(3)};for(let yn=0;yn<Se.channels;++yn){const qn=$n[yn];for(let Kn=0;Kn<yt.length;++Kn){const Ei=yt[Kn];qn.name==Ei.name&&(qn.compression=Ei.compression,Ei.index>=0&&(ti.idx[Ei.index]=yn),qn.offset=yn)}}let Yn,wi,Vn;if(ln.acCompressedSize>0)switch(ln.acCompression){case 0:Yn=new Uint16Array(ln.totalAcUncompressedCount),lt(Se.array,nt,vt,ln.acCompressedSize,Yn,ln.totalAcUncompressedCount);break;case 1:const yn=kg(Se.array.slice(vt.value,vt.value+ln.totalAcUncompressedCount));Yn=new Uint16Array(yn.buffer),vt.value+=ln.totalAcUncompressedCount}if(ln.dcCompressedSize>0){const yn={array:Se.array,offset:vt,size:ln.dcCompressedSize};wi=new Uint16Array(gt(yn).buffer),vt.value+=ln.dcCompressedSize}ln.rleRawSize>0&&(Vn=Pt(kg(Se.array.slice(vt.value,vt.value+ln.rleCompressedSize)).buffer),vt.value+=ln.rleCompressedSize);let Un=0;const yi=new Array($n.length);for(let yn=0;yn<yi.length;++yn)yi[yn]=new Array;for(let yn=0;yn<Se.lines;++yn)for(let qn=0;qn<$n.length;++qn)yi[qn].push(Un),Un+=$n[qn].width*Se.type*2;(function(yn,qn,Kn,Ei,es,Dr){let Wn=new DataView(Dr.buffer);const Ci=Kn[yn.idx[0]].width,Hi=Kn[yn.idx[0]].height,ko=Math.floor(Ci/8),$l=Math.ceil(Ci/8),Yo=Math.ceil(Hi/8),Hp=Ci-8*($l-1),Pv=Hi-8*(Yo-1),Ck={value:0},MC=new Array(3),mb=new Array(3),gb=new Array(3),eh=new Array(3),V1=new Array(3);for(let ts=0;ts<3;++ts)V1[ts]=qn[yn.idx[ts]],MC[ts]=ts<1?0:MC[ts-1]+$l*Yo,mb[ts]=new Float32Array(64),gb[ts]=new Uint16Array(64),eh[ts]=new Uint16Array(64*$l);for(let ts=0;ts<Yo;++ts){let x0=8;ts==Yo-1&&(x0=Pv);let E0=8;for(let xr=0;xr<$l;++xr){xr==$l-1&&(E0=Hp);for(let Wr=0;Wr<3;++Wr)gb[Wr].fill(0),gb[Wr][0]=es[MC[Wr]++],sn(Ck,Ei,gb[Wr]),Ln=gb[Wr],(Nn=mb[Wr])[0]=Yt(Ln[0]),Nn[1]=Yt(Ln[1]),Nn[2]=Yt(Ln[5]),Nn[3]=Yt(Ln[6]),Nn[4]=Yt(Ln[14]),Nn[5]=Yt(Ln[15]),Nn[6]=Yt(Ln[27]),Nn[7]=Yt(Ln[28]),Nn[8]=Yt(Ln[2]),Nn[9]=Yt(Ln[4]),Nn[10]=Yt(Ln[7]),Nn[11]=Yt(Ln[13]),Nn[12]=Yt(Ln[16]),Nn[13]=Yt(Ln[26]),Nn[14]=Yt(Ln[29]),Nn[15]=Yt(Ln[42]),Nn[16]=Yt(Ln[3]),Nn[17]=Yt(Ln[8]),Nn[18]=Yt(Ln[12]),Nn[19]=Yt(Ln[17]),Nn[20]=Yt(Ln[25]),Nn[21]=Yt(Ln[30]),Nn[22]=Yt(Ln[41]),Nn[23]=Yt(Ln[43]),Nn[24]=Yt(Ln[9]),Nn[25]=Yt(Ln[11]),Nn[26]=Yt(Ln[18]),Nn[27]=Yt(Ln[24]),Nn[28]=Yt(Ln[31]),Nn[29]=Yt(Ln[40]),Nn[30]=Yt(Ln[44]),Nn[31]=Yt(Ln[53]),Nn[32]=Yt(Ln[10]),Nn[33]=Yt(Ln[19]),Nn[34]=Yt(Ln[23]),Nn[35]=Yt(Ln[32]),Nn[36]=Yt(Ln[39]),Nn[37]=Yt(Ln[45]),Nn[38]=Yt(Ln[52]),Nn[39]=Yt(Ln[54]),Nn[40]=Yt(Ln[20]),Nn[41]=Yt(Ln[22]),Nn[42]=Yt(Ln[33]),Nn[43]=Yt(Ln[38]),Nn[44]=Yt(Ln[46]),Nn[45]=Yt(Ln[51]),Nn[46]=Yt(Ln[55]),Nn[47]=Yt(Ln[60]),Nn[48]=Yt(Ln[21]),Nn[49]=Yt(Ln[34]),Nn[50]=Yt(Ln[37]),Nn[51]=Yt(Ln[47]),Nn[52]=Yt(Ln[50]),Nn[53]=Yt(Ln[56]),Nn[54]=Yt(Ln[59]),Nn[55]=Yt(Ln[61]),Nn[56]=Yt(Ln[35]),Nn[57]=Yt(Ln[36]),Nn[58]=Yt(Ln[48]),Nn[59]=Yt(Ln[49]),Nn[60]=Yt(Ln[57]),Nn[61]=Yt(Ln[58]),Nn[62]=Yt(Ln[62]),Nn[63]=Yt(Ln[63]),hn(mb[Wr]);wn(mb);for(let Wr=0;Wr<3;++Wr)Xn(mb[Wr],eh[Wr],64*xr)}let Dc=0;for(let xr=0;xr<3;++xr){const Wr=Kn[yn.idx[xr]].type;for(let Qp=8*ts;Qp<8*ts+x0;++Qp){Dc=V1[xr][Qp];for(let vb=0;vb<ko;++vb){const Ad=64*vb+8*(7&Qp);Wn.setUint16(Dc+0*2*Wr,eh[xr][Ad+0],!0),Wn.setUint16(Dc+1*2*Wr,eh[xr][Ad+1],!0),Wn.setUint16(Dc+2*2*Wr,eh[xr][Ad+2],!0),Wn.setUint16(Dc+3*2*Wr,eh[xr][Ad+3],!0),Wn.setUint16(Dc+4*2*Wr,eh[xr][Ad+4],!0),Wn.setUint16(Dc+5*2*Wr,eh[xr][Ad+5],!0),Wn.setUint16(Dc+6*2*Wr,eh[xr][Ad+6],!0),Wn.setUint16(Dc+7*2*Wr,eh[xr][Ad+7],!0),Dc+=8*2*Wr}}if(ko!=$l)for(let Qp=8*ts;Qp<8*ts+x0;++Qp){const vb=V1[xr][Qp]+8*ko*2*Wr,Ad=64*ko+8*(7&Qp);for(let G1=0;G1<E0;++G1)Wn.setUint16(vb+G1*2*Wr,eh[xr][Ad+G1],!0)}}}var Ln,Nn;const PP=new Uint16Array(Ci);Wn=new DataView(Dr.buffer);for(let ts=0;ts<3;++ts){Kn[yn.idx[ts]].decoded=!0;const x0=Kn[yn.idx[ts]].type;if(Kn[ts].type==2)for(let E0=0;E0<Hi;++E0){const Dc=V1[ts][E0];for(let xr=0;xr<Ci;++xr)PP[xr]=Wn.getUint16(Dc+xr*2*x0,!0);for(let xr=0;xr<Ci;++xr)Wn.setFloat32(Dc+xr*2*x0,Yt(PP[xr]),!0)}}})(ti,yi,$n,Yn,wi,$t);for(let yn=0;yn<$n.length;++yn){const qn=$n[yn];if(!qn.decoded){if(qn.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Kn=0,Ei=0;for(let es=0;es<Se.lines;++es){let Dr=yi[yn][Kn];for(let Wn=0;Wn<qn.width;++Wn){for(let Ci=0;Ci<2*qn.type;++Ci)$t[Dr++]=Vn[Ei+Ci*qn.width*qn.height];Ei++}Kn++}}}}return new DataView($t.buffer)}function Ri(Se,nt){const vt=new Uint8Array(Se);let $t=0;for(;vt[nt.value+$t]!=0;)$t+=1;const ln=new TextDecoder().decode(vt.slice(nt.value,nt.value+$t));return nt.value=nt.value+$t+1,ln}function _i(Se,nt){const vt=Se.getInt32(nt.value,!0);return nt.value=nt.value+4,vt}function ni(Se,nt){const vt=Se.getUint32(nt.value,!0);return nt.value=nt.value+4,vt}function ii(Se,nt){const vt=Se[nt.value];return nt.value=nt.value+1,vt}function Bn(Se,nt){const vt=Se.getUint8(nt.value);return nt.value=nt.value+1,vt}const ut=function(Se,nt){let vt;return vt="getBigInt64"in DataView.prototype?Number(Se.getBigInt64(nt.value,!0)):Se.getUint32(nt.value+4,!0)+Number(Se.getUint32(nt.value,!0)<<32),nt.value+=8,vt};function on(Se,nt){const vt=Se.getFloat32(nt.value,!0);return nt.value+=4,vt}function kn(Se,nt){return p.A5E.toHalfFloat(on(Se,nt))}function Yt(Se){const nt=(31744&Se)>>10,vt=1023&Se;return(Se>>15?-1:1)*(nt?nt===31?vt?NaN:1/0:Math.pow(2,nt-15)*(1+vt/1024):vt/1024*6103515625e-14)}function Zn(Se,nt){const vt=Se.getUint16(nt.value,!0);return nt.value+=2,vt}function Nr(Se,nt){return Yt(Zn(Se,nt))}function $r(Se,nt,vt,$t,ln){return $t==="string"||$t==="stringvector"||$t==="iccProfile"?function(yt,en,Fn){const $n=new TextDecoder().decode(new Uint8Array(yt).slice(en.value,en.value+Fn));return en.value=en.value+Fn,$n}(nt,vt,ln):$t==="chlist"?function(yt,en,Fn,$n){const ti=Fn.value,Yn=[];for(;Fn.value<ti+$n-1;){const wi=Ri(en,Fn),Vn=_i(yt,Fn),Un=Bn(yt,Fn);Fn.value+=3;const yi=_i(yt,Fn),yn=_i(yt,Fn);Yn.push({name:wi,pixelType:Vn,pLinear:Un,xSampling:yi,ySampling:yn})}return Fn.value+=1,Yn}(Se,nt,vt,ln):$t==="chromaticities"?function(yt,en){return{redX:on(yt,en),redY:on(yt,en),greenX:on(yt,en),greenY:on(yt,en),blueX:on(yt,en),blueY:on(yt,en),whiteX:on(yt,en),whiteY:on(yt,en)}}(Se,vt):$t==="compression"?function(yt,en){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Bn(yt,en)]}(Se,vt):$t==="box2i"?function(yt,en){return{xMin:ni(yt,en),yMin:ni(yt,en),xMax:ni(yt,en),yMax:ni(yt,en)}}(Se,vt):$t==="lineOrder"?function(yt,en){return["INCREASING_Y"][Bn(yt,en)]}(Se,vt):$t==="float"?on(Se,vt):$t==="v2f"?function(yt,en){return[on(yt,en),on(yt,en)]}(Se,vt):$t==="v3f"?function(yt,en){return[on(yt,en),on(yt,en),on(yt,en)]}(Se,vt):$t==="int"?_i(Se,vt):$t==="rational"?function(yt,en){return[_i(yt,en),ni(yt,en)]}(Se,vt):$t==="timecode"?function(yt,en){return[ni(yt,en),ni(yt,en)]}(Se,vt):$t==="preview"?(vt.value+=ln,"skipped"):void(vt.value+=ln)}const Gs=new DataView(e),Xo=new Uint8Array(e),Pa={value:0},Lo=function(Se,nt,vt){const $t={};if(Se.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");$t.version=Se.getUint8(4);const ln=Se.getUint8(5);$t.spec={singleTile:!!(2&ln),longName:!!(4&ln),deepFormat:!!(8&ln),multiPart:!!(16&ln)},vt.value=8;let yt=!0;for(;yt;){const en=Ri(nt,vt);if(en==0)yt=!1;else{const Fn=Ri(nt,vt),$n=$r(Se,nt,vt,Fn,ni(Se,vt));$n===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Fn}'.`):$t[en]=$n}}if(-5&ln)throw console.error("EXRHeader:",$t),new Error("THREE.EXRLoader: provided file is currently unsupported.");return $t}(Gs,e,Pa),fi=function(Se,nt,vt,$t,ln){const yt={size:0,viewer:nt,array:vt,offset:$t,width:Se.dataWindow.xMax-Se.dataWindow.xMin+1,height:Se.dataWindow.yMax-Se.dataWindow.yMin+1,channels:Se.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:Se.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:p.GUF};switch(Se.compression){case"NO_COMPRESSION":yt.lines=1,yt.uncompress=zn;break;case"RLE_COMPRESSION":yt.lines=1,yt.uncompress=Gn;break;case"ZIPS_COMPRESSION":yt.lines=1,yt.uncompress=gt;break;case"ZIP_COMPRESSION":yt.lines=16,yt.uncompress=gt;break;case"PIZ_COMPRESSION":yt.lines=32,yt.uncompress=zt;break;case"PXR24_COMPRESSION":yt.lines=16,yt.uncompress=an;break;case"DWAA_COMPRESSION":yt.lines=32,yt.uncompress=ui;break;case"DWAB_COMPRESSION":yt.lines=256,yt.uncompress=ui;break;default:throw new Error("EXRLoader.parse: "+Se.compression+" is unsupported")}if(yt.scanlineBlockSize=yt.lines,yt.type==1)switch(ln){case p.VzW:yt.getter=Nr,yt.inputSize=2;break;case p.cLu:yt.getter=Zn,yt.inputSize=2}else{if(yt.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+yt.type+" for "+Se.compression+".");switch(ln){case p.VzW:yt.getter=on,yt.inputSize=4;break;case p.cLu:yt.getter=kn,yt.inputSize=4}}yt.blockCount=(Se.dataWindow.yMax+1)/yt.scanlineBlockSize;for(let Fn=0;Fn<yt.blockCount;Fn++)ut(nt,$t);yt.outputChannels=yt.channels==3?4:yt.channels;const en=yt.width*yt.height*yt.outputChannels;switch(ln){case p.VzW:yt.byteArray=new Float32Array(en),yt.channels<yt.outputChannels&&yt.byteArray.fill(1,0,en);break;case p.cLu:yt.byteArray=new Uint16Array(en),yt.channels<yt.outputChannels&&yt.byteArray.fill(15360,0,en);break;default:console.error("THREE.EXRLoader: unsupported type: ",ln)}return yt.bytesPerLine=yt.width*yt.inputSize*yt.channels,yt.outputChannels==4?(yt.format=p.wk1,yt.colorSpace=p.GUF):(yt.format=p.hEm,yt.colorSpace=p.aCh),yt}(Lo,Gs,Xo,Pa,this.type),yl={value:0},Gp={R:0,G:1,B:2,A:3,Y:0};for(let Se=0;Se<fi.height/fi.scanlineBlockSize;Se++){const nt=ni(Gs,Pa);fi.size=ni(Gs,Pa),fi.lines=nt+fi.scanlineBlockSize>fi.height?fi.height-nt:fi.scanlineBlockSize;const vt=fi.size<fi.lines*fi.bytesPerLine?fi.uncompress(fi):zn(fi);Pa.value+=fi.size;for(let $t=0;$t<fi.scanlineBlockSize;$t++){const ln=$t+Se*fi.scanlineBlockSize;if(ln>=fi.height)break;for(let yt=0;yt<fi.channels;yt++){const en=Gp[Lo.channels[yt].name];for(let Fn=0;Fn<fi.width;Fn++){yl.value=($t*(fi.channels*fi.width)+yt*fi.width+Fn)*fi.inputSize;const $n=(fi.height-1-ln)*(fi.width*fi.outputChannels)+Fn*fi.outputChannels+en;fi.byteArray[$n]=fi.getter(vt,yl)}}}}return{header:Lo,width:fi.width,height:fi.height,data:fi.byteArray,format:fi.format,colorSpace:fi.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(o,a){o.colorSpace=a.colorSpace,o.minFilter=p.wem,o.magFilter=p.wem,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)},n,i)}}class bp extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt]}async onAdded(e){var t,n;this._importer||(this._importer=new Br(class extends Ea{constructor(i){super(i),this.setDataType(sl(e.renderer.rendererObject))}},["exr"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}bp.PluginType="EXRLoadPlugin";const aA=new WeakMap;class Uw extends p.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const o=new p.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),this.url=e,o.load(e,a=>{if(aA.has(a))return aA.get(a).promise.then(t).catch(i);this.decodeObjects(a,e).then(c=>{c.userData.warnings=this.warnings,this.warnings=[],t(c)}).catch(c=>i(c))},n,i)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let n,i;const o=e.byteLength,a=this._getWorker(o).then(c=>(n=c,i=this.workerNextTaskID++,new Promise((u,d)=>{n._callbacks[i]={resolve:u,reject:d},n.postMessage({type:"decode",id:i,buffer:e},[e])}))).then(c=>this._createGeometry(c.data)).catch(c=>{throw c});return a.catch(()=>!0).then(()=>{n&&i&&this._releaseTask(n,i)}),aA.set(e,{url:t,promise:a}),a}parse(e,t,n){this.decodeObjects(e,"").then(i=>{i.userData.warnings=this.warnings,t(i)}).catch(i=>n(i))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const n=JSON.stringify(t);for(let i=0;i<this.materials.length;i++){const o=this.materials[i],a={};if(a.name=o.name,a.color={},a.color.r=o.color.r,a.color.g=o.color.g,a.color.b=o.color.b,a.type=o.type,JSON.stringify(a)===n)return o}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new p.Wid({color:new p.Ilk(1,1,1),metalness:.8,name:"default",side:p.ehD});const t=e.diffuseColor,n=new p.Ilk(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(n.r=1,n.g=1,n.b=1);const i=new p.Wid({color:n,name:e.name,side:p.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),o=new p.dpR;for(let a=0;a<e.textures.length;a++){const c=e.textures[a];if(c.image!==null){const u=o.load(c.image);switch(c.type){case"Diffuse":i.map=u;break;case"Bump":i.bumpMap=u;break;case"Transparency":i.alphaMap=u,i.transparent=!0;break;case"Emap":i.envMap=u}u.wrapS=c.wrapU===0?p.rpg:p.uWy,u.wrapT=c.wrapV===0?p.rpg:p.uWy,u.repeat.set(c.repeat[0],c.repeat[1])}}return i}_createGeometry(e){const t=new p.Tme,n=[],i=[],o=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let a=e.objects;const c=e.materials;for(let u=0;u<a.length;u++){const d=a[u],m=d.attributes;switch(d.objectType){case"InstanceDefinition":i.push(d);break;case"InstanceReference":o.push(d);break;default:let g;if(m.materialIndex>=0){const w=c[m.materialIndex];let x=this._createMaterial(w);x=this._compareMaterials(x),g=this._createObject(d,x)}else{const w=this._createMaterial();g=this._createObject(d,w)}if(g===void 0)continue;const _=e.layers[m.layerIndex];g.visible=!_||_.visible,m.isInstanceDefinitionObject?n.push(g):t.add(g)}}for(let u=0;u<i.length;u++){const d=i[u];a=[];for(let m=0;m<d.attributes.objectIds.length;m++){const g=d.attributes.objectIds[m];for(let _=0;_<n.length;_++)g===n[_].userData.attributes.id&&a.push(n[_])}for(let m=0;m<o.length;m++){const g=o[m];if(g.geometry.parentIdefId===d.attributes.id){const _=g.geometry.xform.array,w=new p.yGw;if(w.set(..._),a.length===1){const x=a[0].clone(!0);if(x.name=g.attributes.name||x.name,x.applyMatrix4(w),g.attributes.materialIndex>=0&&g.attributes.materialIndex!==a[0].userData.attributes.materialIndex){const T=c[g.attributes.materialIndex],I=this._createMaterial(T);x.material=this._compareMaterials(I)}if(x.userData.defAttributes=x.userData.attributes,x.userData.defObjectType=x.userData.objectType,x.userData.attributes={...x.userData.attributes,...g.attributes},x.userData.objectType=g.objectType,g.attributes.layerIndex!==void 0){const T=e.layers[g.attributes.layerIndex];x.visible=T?T.visible:x.visible}t.add(x)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const x=new p.Tme;x.applyMatrix4(w);for(let T=0;T<a.length;T++)x.add(a[T].clone(!0));t.add(x)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const n=new p.s4_,i=e.attributes;let o,a,c,u;switch(e.objectType){case"Point":case"PointSet":o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")?a=new p.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(c=i.drawColor,u=new p.Ilk(c.r/255,c.g/255,c.b/255),a=new p.UY4({color:u,sizeAttenuation:!1,size:2})),a=this._compareMaterials(a);const d=new p.woe(o,a);return d.userData.attributes=i,d.userData.objectType=e.objectType,i.name&&(d.name=i.name),d;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const m=new p.Kj0(o,t);return m.castShadow=i.castsShadows,m.receiveShadow=i.receivesShadows,m.userData.attributes=i,m.userData.objectType=e.objectType,i.name&&(m.name=i.name,o.name=i.name),m;case"Curve":o=n.parse(e.geometry),c=i.drawColor,u=new p.Ilk(c.r/255,c.g/255,c.b/255),a=new p.nls({color:u}),a=this._compareMaterials(a);const g=new p.x12(o,a);return g.userData.attributes=i,g.userData.objectType=e.objectType,i.name&&(g.name=i.name),g;case"TextDot":o=e.geometry;const _=document.createElement("canvas").getContext("2d"),w=`${o.fontHeight}px ${o.fontFace}`;_.font=w;const x=_.measureText(o.text).width+10,T=o.fontHeight+10,I=window.devicePixelRatio;_.canvas.width=x*I,_.canvas.height=T*I,_.canvas.style.width=x+"px",_.canvas.style.height=T+"px",_.setTransform(I,0,0,I,0,0),_.font=w,_.textBaseline="middle",_.textAlign="center",u=i.drawColor,_.fillStyle=`rgba(${u.r},${u.g},${u.b},${u.a})`,_.fillRect(0,0,x,T),_.fillStyle="white",_.fillText(o.text,x/2,T/2);const R=new p.ROQ(_.canvas);R.minFilter=p.wem,R.wrapS=p.uWy,R.wrapT=p.uWy,a=new p.xeV({map:R,depthTest:!1});const M=new p.jyi(a);return M.position.set(o.point[0],o.point[1],o.point[2]),M.scale.set(x/10,T/10,1),M.userData.attributes=i,M.userData.objectType=e.objectType,i.name&&(M.name=i.name),M;case"Light":let C;switch(o=e.geometry,o.lightStyle.name){case"LightStyle_WorldPoint":C=new p.cek,C.castShadow=i.castsShadows,C.position.set(o.location[0],o.location[1],o.location[2]),C.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":C=new p.PMe,C.castShadow=i.castsShadows,C.position.set(o.location[0],o.location[1],o.location[2]),C.target.position.set(o.direction[0],o.direction[1],o.direction[2]),C.angle=o.spotAngleRadians,C.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":C=new p.T_f;const L=Math.abs(o.width[2]),k=Math.abs(o.length[0]);C.position.set(o.location[0]-k/2,o.location[1],o.location[2]-L/2),C.height=k,C.width=L,C.lookAt(o.direction[0],o.direction[1],o.direction[2]);break;case"LightStyle_WorldDirectional":C=new p.Ox3,C.castShadow=i.castsShadows,C.position.set(o.location[0],o.location[1],o.location[2]),C.target.position.set(o.direction[0],o.direction[1],o.direction[2]),C.shadow.normalBias=.1}return C&&(C.intensity=o.intensity,c=o.diffuse,u=new p.Ilk(c.r/255,c.g/255,c.b/255),C.color=u,C.userData.attributes=i,C.userData.objectType=e.objectType),C}}_initLibrary(){if(!this.libraryPending){const e=new p.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((o,a)=>{e.load("rhino3dm.js",o,void 0,a)}),n=new p.hH6(this.manager);n.setPath(this.libraryPath),n.setResponseType("arraybuffer");const i=new Promise((o,a)=>{n.load("rhino3dm.wasm",o,void 0,a)});this.libraryPending=Promise.all([t,i]).then(([o,a])=>{this.libraryConfig.wasmBinary=a;const c=RP,u=["/* rhino3dm.js */",o,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",libraryConfig:this.libraryConfig}),n.onmessage=i=>{const o=i.data;switch(o.type){case"warning":this.warnings.push(o.data),console.warn(o.data);break;case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,i){return n._taskLoad>i._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const RP=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;var N_,lA=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class po extends Uw{constructor(e){super(e),this.materials=[],this.setLibraryPath(po.LIBRARY_PATH)}_createMaterial(e){return po.ImportMaterials?super._createMaterial(e):this.materials[0]||new p.Wid({color:new p.Ilk(1,1,1),metalness:.8,name:"default",side:p.ehD})}async loadAsync(e,t){const n=await super.loadAsync(e,t);n.rotateX(-Math.PI/2),n.userData.materials&&delete n.userData.materials;const i=n.userData.layers;return n.traverse(o=>{var m,g,_,w;const a=(m=o.userData.attributes)==null?void 0:m.castsShadows,c=(g=o.userData.attributes)==null?void 0:g.receivesShadows;o.castShadow=a,o.receiveShadow=c;const u=((_=o.userData.attributes)==null?void 0:_.layerIndex)??((w=o.userData.defAttributes)==null?void 0:w.layerIndex),d=i[u];d&&(o.userData.rhinoLayer=d),o.userData.rhino3dmRoot=n.uuid,this._hideLineMesh(o),this._useInstancedMesh(o),this._useMaterialSource(o,d)}),this.materials=[],n}_useMaterialSource(e,t){var i,o,a,c,u;if(!po.ImportMaterials)return;const n=e;if(((i=n.material)==null?void 0:i.name)==="default"||po.ForceLayerMaterials){const d=((o=n.userData.attributes)==null?void 0:o.materialSource)||((a=n.userData.defAttributes)==null?void 0:a.materialSource),m=((c=n.userData.attributes)==null?void 0:c.colorSource)||((u=n.userData.defAttributes)==null?void 0:u.colorSource);if(!po.ForceLayerMaterials&&!d&&!m)return;po.ForceLayerMaterials||(d==null?void 0:d.value)===0||(d==null?void 0:d.value)===1&&(m==null?void 0:m.value)===0?t&&(n.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):(d==null?void 0:d.value)===3||(d==null?void 0:d.value)===1&&(m==null?void 0:m.value)===3?n.traverseAncestors(g=>{g!=null&&g.material&&(n.material=g.material)}):d&&d.value!==1&&console.warn("Unknown material source",d,n,n.userData.attributes)}}_useInstancedMesh(e){if(!po.ReplaceWithInstancedMesh||e.children.length<=0)return;const t=e.children,n=t.map(o=>o.geometry);n.filter((o,a)=>n.indexOf(o)===a).forEach(o=>{var u;const a=t.filter(d=>d.geometry===o),c=a.length>0?a.filter(d=>d.material===a[0].material):[];if(c.length>1){const d=new p.SPe(o,c[0].material,c.length);d.userData={...c[0].userData},d.userData.instanceUserData=[],d.userData.attributes=d.userData.defAttributes||d.userData.attributes,d.userData.defAttributes&&delete d.userData.defAttributes,d.name=((u=d.userData.attributes)==null?void 0:u.name)||c[0].name,c.forEach((m,g)=>{d.setMatrixAt(g,m.matrix),e.remove(m),d.userData.instanceUserData.push(m.userData)}),e.add(d)}})}_hideLineMesh(e){if(!po.HideLineMesh||e.children.length<=0)return;const t=[];e.traverse(n=>{n&&(n.isLine||n.isLineSegments||n.isPoints)&&t.push(n)}),t.forEach(n=>{n.userData.visible_3dm=n.visible,n.visible=!1})}}po.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",po.ImportMaterials=!0,po.ForceLayerMaterials=!1,po.ReplaceWithInstancedMesh=!1,po.HideLineMesh=!1;let Hu=N_=class extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt],this._importer=new Br(po,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1}_refresh(){po.ImportMaterials=this.importMaterials,po.ForceLayerMaterials=this.forceLayerMaterials,po.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,po.HideLineMesh=this.hideLineMesh}async onAdded(s){var e,t;(t=(e=s.getManager())==null?void 0:e.importer)==null||t.Importers.push(this._importer),this._refresh()}async onDispose(s){}async onRemove(s){var e,t;(t=(e=s.getManager())==null?void 0:e.importer)!=null&&t.Importers&&s.getManager().importer.Importers.splice(s.getManager().importer.Importers.indexOf(this._importer),1)}};Hu.PluginType="Rhino3dmLoadPlugin",lA([(0,V.onChange)(N_.prototype._refresh),Gt()],Hu.prototype,"importMaterials",void 0),lA([(0,V.onChange)(N_.prototype._refresh),Gt()],Hu.prototype,"forceLayerMaterials",void 0),lA([(0,V.onChange)(N_.prototype._refresh),Gt()],Hu.prototype,"replaceWithInstancedMesh",void 0),lA([(0,V.onChange)(N_.prototype._refresh),Gt()],Hu.prototype,"hideLineMesh",void 0),Hu=N_=lA([Hn("Rhino 3dm loader")],Hu);class DP extends p.aNw{constructor(e){super(e)}load(e,t,n,i){const o=this,a=new p.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{t(o.parse(c))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},n,i)}parse(e){function t(o,a,c){for(let u=0,d=o.length;u<d;u++)if(o[u]!==a.getUint8(c+u))return!1;return!0}const n=function(o){if(typeof o=="string"){const a=new Uint8Array(o.length);for(let c=0;c<o.length;c++)a[c]=255&o.charCodeAt(c);return a.buffer||a}return o}(e);return function(o){const a=new DataView(o);if(84+50*a.getUint32(80,!0)===a.byteLength)return!0;const c=[115,111,108,105,100];for(let u=0;u<5;u++)if(t(c,a,u))return!1;return!0}(n)?function(o){const a=new DataView(o),c=a.getUint32(80,!0);let u,d,m,g,_,w,x,T,I=!1;for(let L=0;L<70;L++)a.getUint32(L,!1)==1129270351&&a.getUint8(L+4)==82&&a.getUint8(L+5)==61&&(I=!0,g=new Float32Array(3*c*3),_=a.getUint8(L+6)/255,w=a.getUint8(L+7)/255,x=a.getUint8(L+8)/255,T=a.getUint8(L+9)/255);const R=new p.u9r,M=new Float32Array(3*c*3),C=new Float32Array(3*c*3);for(let L=0;L<c;L++){const k=84+50*L,j=a.getFloat32(k,!0),H=a.getFloat32(k+4,!0),X=a.getFloat32(k+8,!0);if(I){const ee=a.getUint16(k+48,!0);32768&ee?(u=_,d=w,m=x):(u=(31&ee)/31,d=(ee>>5&31)/31,m=(ee>>10&31)/31)}for(let ee=1;ee<=3;ee++){const oe=k+12*ee,re=3*L*3+3*(ee-1);M[re]=a.getFloat32(oe,!0),M[re+1]=a.getFloat32(oe+4,!0),M[re+2]=a.getFloat32(oe+8,!0),C[re]=j,C[re+1]=H,C[re+2]=X,I&&(g[re]=u,g[re+1]=d,g[re+2]=m)}}return R.setAttribute("position",new p.TlE(M,3)),R.setAttribute("normal",new p.TlE(C,3)),I&&(R.setAttribute("color",new p.TlE(g,3)),R.hasColors=!0,R.alpha=T),R}(n):function(o){const a=new p.u9r,c=/solid([\s\S]*?)endsolid/g,u=/facet([\s\S]*?)endfacet/g;let d=0;const m=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,g=new RegExp("vertex"+m+m+m,"g"),_=new RegExp("normal"+m+m+m,"g"),w=[],x=[],T=new p.Pa4;let I,R=0,M=0,C=0;for(;(I=c.exec(o))!==null;){M=C;const L=I[0];for(;(I=u.exec(L))!==null;){let H=0,X=0;const ee=I[0];for(;(I=_.exec(ee))!==null;)T.x=parseFloat(I[1]),T.y=parseFloat(I[2]),T.z=parseFloat(I[3]),X++;for(;(I=g.exec(ee))!==null;)w.push(parseFloat(I[1]),parseFloat(I[2]),parseFloat(I[3])),x.push(T.x,T.y,T.z),H++,C++;X!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+d),H!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+d),d++}const k=M,j=C-M;a.addGroup(k,j,R),R++}return a.setAttribute("position",new p.a$l(w,3)),a.setAttribute("normal",new p.a$l(x,3)),a}(typeof(i=e)!="string"?new TextDecoder().decode(i):i);var i}}class bE extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt]}async onAdded(e){var t,n;this._importer||(this._importer=new Br(DP,["stl"],!0)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}bE.PluginType="STLLoadPlugin";class wE extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}wE.PluginType="GLTFMeshOptPlugin";var BP=__webpackgi_require__(701),Jf=__webpackgi_require__.n(BP),OP=__webpackgi_require__(236),Zf=__webpackgi_require__.n(OP),LP=__webpackgi_require__(850),$f=__webpackgi_require__.n(LP),kP=__webpackgi_require__(182),em=__webpackgi_require__.n(kP),UP=__webpackgi_require__(213),tm=__webpackgi_require__.n(UP),Nw=__webpackgi_require__(27),cA={};Nw.Z&&Nw.Z.locals&&(cA.locals=Nw.Z.locals);var xE,EE=0,Hg={};Hg.styleTagTransform=tm(),Hg.setAttributes=$f(),Hg.insert=function(s,e){(e.target||document.head).appendChild(s)},Hg.domAPI=Zf(),Hg.insertStyleElement=em(),cA.use=function(s){return Hg.options=s||{},EE++||(xE=Jf()(Nw.Z,Hg)),cA},cA.unuse=function(){EE>0&&!--EE&&(xE(),xE=null)};var NP=cA,Fw=__webpackgi_require__(356),uA={};Fw.Z&&Fw.Z.locals&&(uA.locals=Fw.Z.locals);var SE,CE=0,Qg={};Qg.styleTagTransform=tm(),Qg.setAttributes=$f(),Qg.insert=function(s,e){(e.target||document.head).appendChild(s)},Qg.domAPI=Zf(),Qg.insertStyleElement=em(),uA.use=function(s){return Qg.options=s||{},CE++||(SE=Jf()(Fw.Z,Qg)),uA},uA.unuse=function(){CE>0&&!--CE&&(SE(),SE=null)};var FP=uA;class F_ extends En{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e,t){super(),this.container=t,this.enabled=!0,this.dependencies=[Qt],this.processState=new Map,this._mainDiv=(0,V.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,V.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var t,n,i,o,a,c,u,d,m,g,_,w;await super.onAdded(e),(this.container??e.container).appendChild(this._mainDiv),this._updateMainDiv(this.processState),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.addEventListener("importFile",x=>{x.state!=="done"?this.processState.set(x.path,{state:x.state,progress:x.progress?100*x.progress:void 0}):this.processState.delete(x.path),this._updateMainDiv(this.processState)}),(o=(i=e.getManager())==null?void 0:i.importer)==null||o.addEventListener("processFileStart",x=>{this.processState.set(x.path,{state:"processing",progress:void 0}),this._updateMainDiv(this.processState)}),(c=(a=e.getManager())==null?void 0:a.importer)==null||c.addEventListener("processFileEnd",x=>{this.processState.delete(x.path),this._updateMainDiv(this.processState)}),(d=(u=e.getManager())==null?void 0:u.exporter)==null||d.addEventListener("exportFile",x=>{x.state!=="done"?this.processState.set(x.obj.name,{state:x.state,progress:x.progress?100*x.progress:void 0}):this.processState.delete(x.obj.name),this._updateMainDiv(this.processState)}),(m=e.getPluginByType("FileTransferPlugin"))==null||m.addEventListener("transferFile",x=>{x.state!=="done"?this.processState.set(x.path,{state:x.state,progress:x.progress?100*x.progress:void 0}):this.processState.delete(x.path),this._updateMainDiv(this.processState)}),(g=e.getPluginByType("MaterialConfiguratorPlugin"))==null||g.addEventListener("progress",x=>{x.state!=="done"?this.processState.set("MatpreviewGeneration",{state:x.state,progress:0}):this.processState.delete("MatpreviewGeneration"),this._updateMainDiv(this.processState)}),(_=e.getPluginByType("SwitchNodePlugin"))==null||_.addEventListener("progress",x=>{x.state!=="done"?this.processState.set("SwitchNodeGeneration",{state:x.state,progress:0}):this.processState.delete("SwitchNodeGeneration"),this._updateMainDiv(this.processState)}),(w=e.getPluginByType("ThemePlugin"))==null||w.addEventListener("progress",x=>{x.state!=="done"?this.processState.set("ThemeInit",{state:x.state,progress:0}):this.processState.delete("ThemeInit"),this._updateMainDiv(this.processState)})}async onRemove(e){var t;return this._mainDiv.remove(),(t=this._contentDiv)==null||t.remove(),this.processState.clear(),super.onRemove(e)}}(function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Gt("Enabled"),(0,V.onChange)(F_.prototype._onEnabledChange),Ae()],F_.prototype,"enabled",void 0);var Qu,Fs=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let wr=Qu=class extends F_{refresh(){this._updateMainDiv(this._isPreviewing?this._previewState:this.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}constructor(s){super("LoadingScreen",s),this.styles=NP,this.spinners=[{styles:FP,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage="https://static.webgi.xyz/logo.svg",this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["environment.hdr",{state:"adding"}]]),this.loadingElement=(0,V.createDiv)({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=(0,V.createDiv)({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=(0,V.createDiv)({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._sceneUpdate=e=>{if(!this._viewer||!e.hierarchyChanged)return;const t=this._viewer.scene.modelRoot.children;t.length===0&&this.showOnSceneEmpty&&this.show(),t.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment&&(0,V.timeout)(this.hideDelay+300).then(()=>this.minimize()):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await(0,V.timeout)(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await(0,V.timeout)(this.hideDelay),this._isHidden)return this.hide()}show(){this._isHidden&&(this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex")}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen"),this.showFileNames||(this.loadingElement.style.display="block")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen"),this.loadingElement.style.display=""}_setHTML(s,e){s.innerHTML!==e&&(s.innerHTML=e)}_updateMainDiv(s,e=!0){if(!this._viewer||!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");if(this.showFileNames){let n="";s.forEach((i,o)=>{n+=(this.showProcessStates?`<span class="loadingScreenProcessState">${i.state}</span>: `:"")+(o||"").split("/").pop()+(this.showProgress&&i.progress?" - "+i.progress.toFixed(0)+"%":"")+"<br>"}),this._setHTML(this.filesElement,n)}else this._setHTML(this.filesElement,"");const t=[...s.values()].filter(n=>n.state==="error");t.length>0&&t.length===s.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImage" src="${this.logoImage}"/>`:""),e&&(this.hideOnFilesLoad&&(s.size===0||t.length===s.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():s.size>0&&this.showOnFilesLoading&&this.show())}async onAdded(s){this.styles.use({target:this.container??s.container}),this.spinners.forEach(e=>{e.styles.use({target:this.container??s.container})}),s.scene.addEventListener("sceneUpdate",this._sceneUpdate),await super.onAdded(s)}async onRemove(s){s.scene.removeEventListener("sceneUpdate",this._sceneUpdate),await super.onRemove(s)}};wr.PluginType="LoadingScreenPlugin",Fs([Uo("Loader",["Spinner 1"].map((s,e)=>({value:e,label:s}))),(0,V.serialize)()],wr.prototype,"loader",void 0),Fs([jn("Loading text header"),(0,V.onChange)(Qu.prototype.refresh),(0,V.serialize)()],wr.prototype,"loadingTextHeader",void 0),Fs([jn("Error text header"),(0,V.serialize)()],wr.prototype,"errorTextHeader",void 0),Fs([Gt("Show file names"),(0,V.serialize)(),(0,V.onChange)(Qu.prototype.refresh)],wr.prototype,"showFileNames",void 0),Fs([Gt("Show process states"),(0,V.serialize)(),(0,V.onChange)(Qu.prototype.refresh)],wr.prototype,"showProcessStates",void 0),Fs([Gt("Show progress"),(0,V.serialize)(),(0,V.onChange)(Qu.prototype.refresh)],wr.prototype,"showProgress",void 0),Fs([Gt("Hide on only errors"),(0,V.serialize)()],wr.prototype,"hideOnOnlyErrors",void 0),Fs([Gt("Hide on files load"),(0,V.serialize)()],wr.prototype,"hideOnFilesLoad",void 0),Fs([Gt("Hide on scene object load"),(0,V.serialize)()],wr.prototype,"hideOnSceneObjectLoad",void 0),Fs([Gt("Minimize on scene object load"),(0,V.serialize)()],wr.prototype,"minimizeOnSceneObjectLoad",void 0),Fs([Gt("Show when files start loading"),(0,V.serialize)()],wr.prototype,"showOnFilesLoading",void 0),Fs([Gt("Show when scene empty"),(0,V.serialize)()],wr.prototype,"showOnSceneEmpty",void 0),Fs([jn("Hide delay (ms)"),(0,V.serialize)()],wr.prototype,"hideDelay",void 0),Fs([cn("Background Opacity",[0,1]),(0,V.onChange)(Qu.prototype.refresh),(0,V.serialize)()],wr.prototype,"backgroundOpacity",void 0),Fs([cn("Background Blur",[0,100]),(0,V.onChange)(Qu.prototype.refresh),(0,V.serialize)()],wr.prototype,"backgroundBlur",void 0),Fs([jn("Background Color"),(0,V.onChange)(Qu.prototype.refresh),(0,V.serialize)()],wr.prototype,"background",void 0),Fs([jn("Text Color"),(0,V.onChange)(Qu.prototype.refresh),(0,V.serialize)()],wr.prototype,"textColor",void 0),Fs([jn("Logo Image"),(0,V.onChange)(Qu.prototype.refresh),(0,V.serialize)()],wr.prototype,"logoImage",void 0),Fs([Ai("Toggle preview")],wr.prototype,"togglePreview",null),Fs([Ai("Minimize")],wr.prototype,"minimize",null),Fs([Ai("Maximize")],wr.prototype,"maximize",null),wr=Qu=Fs([Hn("Loading Screen")],wr);var Sa=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ps=class extends En{constructor(s=!0){super(),this.animationRunning=!1,this.interactionsDisabled=!1,this.animationDuration=2e3,this.animationDistance=80,this.animationPauseDuration=6e3,this.rotationDistance=.3,this.yOffset=0,this.autoStart=!0,this.autoStartDelay=3e4,this.autoStop=!0,this.autoStartOnObjectLoad=!0,this.autoStartOnObjectLoadDelay=3e3,this.currentTime=0,this.lastActionTime=1/0,this._xDamper=new V.Damper(50),this.pointerIcon=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z"></path>
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z"></path>
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4"></path>
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000"></path>
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff"></path>
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A"></use>
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)"></path>
            </g>
        </g>
    </g>
</svg>`,this._activeCameraUpdate=e=>{this.isDisabled()||(e.change==="deserialize"?(this.stopAnimation(),this.startAnimation()):this.lastActionTime=(0,V.now)())},this._addSceneObject=()=>{this.autoStartOnObjectLoad&&(this.lastActionTime=(0,V.now)()-this.autoStartDelay+this.autoStartOnObjectLoadDelay)},this.onlyOnOrbitControls=!0,this.startAnimation=()=>{this._viewer&&this.cursorEl&&!this.isDisabled()&&(this._viewer.scene.activeCamera.controls.type!=="OrbitControls"&&this.onlyOnOrbitControls?console.warn("InteractionPromptPlugin requires OrbitControls, to run anyway, set onlyOnOrbitControls to false"):this._viewer.scene.modelRoot.children.length!==0&&(this.currentSphericalPosition=new p.$V().setFromVector3(new p.Pa4().subVectors(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target)),this.cursorEl.style.opacity="1",this.currentTime=0,this.animationRunning=!0,this._viewer.scene.activeCamera.interactionsEnabled&&(this.interactionsDisabled=!0,this._viewer.scene.activeCamera.interactionsEnabled=!1)))},this.stopAnimation=()=>{this._viewer&&this.cursorEl&&(this.animationRunning=!1,this.cursorEl.style.opacity="0",this.interactionsDisabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,this.interactionsDisabled=!1))},this._pointerDown=()=>{this.isDisabled()||(this.autoStop&&this.stopAnimation(),this.lastActionTime=(0,V.now)())},this._x=0,this._preFrame=async e=>{if(!this._viewer||!this.cursorEl||(this.isDisabled()&&this.animationRunning&&this.stopAnimation(),this.isDisabled())||(!this.animationRunning&&this.autoStart&&this.lastActionTime+this.autoStartDelay<(0,V.now)()&&this.startAnimation(),!this.animationRunning))return;if(this.currentTime<=this.animationDuration){this.cursorEl.style.opacity="1";const o=this.currentTime/this.animationDuration;this._x=Math.sin(2*Math.PI*o),(o<.25||o>.75)&&(this._x*=this._x*Math.sign(this._x))}else this.cursorEl.style.opacity="0",this._x=0;if(this.currentTime<=this.animationDuration+50){const o=this.currentSphericalPosition.clone();o.theta+=this._x*this.rotationDistance,this._viewer.scene.activeCamera.position.setFromSpherical(o).add(this._viewer.scene.activeCamera.target),this._viewer.scene.activeCamera.positionUpdated()}const t=this._viewer.canvas.getBoundingClientRect(),n=t.width/2+-this._x*Math.min(this.animationDistance,t.width/4),i=t.height/2+this.yOffset*t.height/2;this.cursorEl.style.transform=`translate(${Math.floor(n)}px, ${Math.floor(i)}px)`,this.currentTime+=e.deltaTime,this.currentTime>this.animationDuration+this.animationPauseDuration&&(this.currentTime=0)},this._disabledBy=new Set,this.disable=e=>{this._disabledBy.size,this._disabledBy.add(e)},this.enable=e=>{this._disabledBy.size,this._disabledBy.delete(e)},this.isDisabled=()=>this._disabledBy.size>0||!this.enabled,this.enabled=s}async onAdded(s){await super.onAdded(s),this.lastActionTime=1/0,s.addEventListener("preFrame",this._preFrame),s.container.addEventListener("pointerdown",this._pointerDown,!0),s.container.addEventListener("wheel",this._pointerDown,!0),s.scene.addEventListener("addSceneObject",this._addSceneObject),s.scene.addEventListener("activeCameraUpdate",this._activeCameraUpdate),this._initializeCursor()}async onRemove(s){return this.stopAnimation(),s.removeEventListener("preFrame",this._preFrame),s.container.removeEventListener("pointerdown",this._pointerDown,!0),s.container.removeEventListener("wheel",this._pointerDown,!0),s.scene.removeEventListener("addSceneObject",this._addSceneObject),s.scene.removeEventListener("activeCameraUpdate",this._activeCameraUpdate),this.cursorEl&&this.cursorEl.remove(),super.onRemove(s)}_initializeCursor(){this.cursorEl=document.createElement("div"),this.cursorEl.style.position="absolute",this.cursorEl.style.top="0",this.cursorEl.style.left="0",this.cursorEl.style.width="10px",this.cursorEl.style.height="10px",this.cursorEl.style.opacity="0",this.cursorEl.innerHTML=this.pointerIcon,this._viewer.container.appendChild(this.cursorEl)}};ps.PluginType="InteractionPointerPlugin",Sa([(0,V.serialize)(),Gt()],ps.prototype,"enabled",void 0),Sa([(0,V.serialize)(),jn()],ps.prototype,"animationDuration",void 0),Sa([(0,V.serialize)(),jn()],ps.prototype,"animationDistance",void 0),Sa([(0,V.serialize)(),jn()],ps.prototype,"animationPauseDuration",void 0),Sa([(0,V.serialize)(),jn()],ps.prototype,"rotationDistance",void 0),Sa([(0,V.serialize)(),jn()],ps.prototype,"yOffset",void 0),Sa([(0,V.serialize)(),Gt()],ps.prototype,"autoStart",void 0),Sa([(0,V.serialize)(),jn()],ps.prototype,"autoStartDelay",void 0),Sa([(0,V.serialize)(),Gt()],ps.prototype,"autoStop",void 0),Sa([(0,V.serialize)(),Gt()],ps.prototype,"autoStartOnObjectLoad",void 0),Sa([(0,V.serialize)(),Gt()],ps.prototype,"autoStartOnObjectLoadDelay",void 0),Sa([nc()],ps.prototype,"currentTime",void 0),Sa([nc()],ps.prototype,"lastActionTime",void 0),Sa([(0,V.serialize)()],ps.prototype,"onlyOnOrbitControls",void 0),Sa([Ai()],ps.prototype,"startAnimation",void 0),Sa([Ai()],ps.prototype,"stopAnimation",void 0),ps=Sa([Hn("Interaction Prompt")],ps);class TC extends ol{constructor(e){super(e)}async initialize({caching:e=!0,ground:t=!0,bloom:n=!0,depthTonemap:i=!0,enableDrop:o=!1,importPopup:a=!0,debug:c=!1,interactionPrompt:u=!0}={}){return c&&await this.addPlugin(Uu),this.getPlugin(Qt)||this.addPluginSync(Qt,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await jw(this,{ground:t,bloom:n,depthTonemap:i,enableDrop:o,importPopup:a,interactionPrompt:u}),await this.addPlugin(Vu),await this.addPlugin(Jh),await this.addPlugin(qo),this}}async function jw(s,{ground:e=!0,bloom:t=!0,depthTonemap:n=!0,enableDrop:i=!1,importPopup:o=!1,interactionPrompt:a=!0}={}){await s.getOrAddPlugin(Qt),o&&await s.getOrAddPlugin(wr),await s.getOrAddPlugin(Ii),await s.getOrAddPlugin(Jr),i&&await s.getOrAddPlugin(gc),await s.addPlugin(new oo(32)),await s.getOrAddPlugin(Fa),await s.getOrAddPlugin(Nm),await s.addPlugin(new Um(n||!s.useRgbm)),await s.getOrAddPlugin(Ys),await s.getOrAddPlugin(Bu),await s.getOrAddPlugin(Qm),await s.getOrAddPlugin(Cy),await s.getOrAddPlugin(Zm),await s.getOrAddPlugin(Qc),await s.getOrAddPlugin(br),await s.getOrAddPlugin(_c),await s.getOrAddPlugin(sr),await s.getOrAddPlugin(va),await s.getOrAddPlugin(xc),await s.getOrAddPlugin(Va),await s.getOrAddPlugin(Ha),await s.getOrAddPlugin(ba),await s.getOrAddPlugin(Go),await s.getOrAddPlugin(jl),await s.getOrAddPlugin(bc),await s.getOrAddPlugin(hp,!1),await s.getOrAddPlugin(zh),await s.getOrAddPlugin(lr),await s.getOrAddPlugin(Th,!1),await s.getOrAddPlugin(Lr,!1),await s.getOrAddPlugin(Eu,!1),await s.getOrAddPlugin(qs,!1),await s.getOrAddPlugin(Km,!1),await s.getOrAddPlugin(Mh,!1),await s.getOrAddPlugin(Fl,!1),await s.getOrAddPlugin(mp),await s.getOrAddPlugin(Nu),await s.getOrAddPlugin(Ky),await s.getOrAddPlugin(Hu),await s.getOrAddPlugin(bE),await s.getOrAddPlugin(bp),await s.getOrAddPlugin(wE),await s.getOrAddPlugin(Yd),await s.getOrAddPlugin(ya),await s.getOrAddPlugin(Ho),t&&await s.getOrAddPlugin(za),e&&await s.getOrAddPlugin(xa),a&&await s.getOrAddPlugin(ps),s.renderer.refreshPipeline()}var zw=__webpackgi_require__(109),hA={};zw.Z&&zw.Z.locals&&(hA.locals=zw.Z.locals);var ME,TE=0,Wg={};Wg.styleTagTransform=tm(),Wg.setAttributes=$f(),Wg.insert=function(s,e){(e.target||document.head).appendChild(s)},Wg.domAPI=Zf(),Wg.insertStyleElement=em(),hA.use=function(s){return Wg.options=s||{},TE++||(ME=Jf()(zw.Z,Wg)),hA},hA.unuse=function(){TE>0&&!--TE&&(ME(),ME=null)};var IC=hA;let jP=0;class PC extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=jP++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),t=document.createElement("style");t.textContent=V.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
            //.tippy-box[data-theme~='editor']{
            //    margin: 0.25rem !important;
            //    background-color: hsla(230, 10%, 30%, 1.00) !important;
            //    font-size: 0.9rem !important;
            //    color: hsla(230, 5%, 90%, 1.00) !important;
            //}
        `,IC.use({target:this.wrapper}),zu.setDefaultProps({duration:300,arrow:!0,appendTo:()=>this.wrapper}),this.shadowRoot.append(t,this.wrapper),this._initialized=!0,this._initialize(e).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e!=null&&e._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e!=null&&e.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(e==null?void 0:e.canvas)||(0,V.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new TC({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,t;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((e=this.canvas)==null||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((t=this.canvas)==null||t.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,t,n){this.refreshAll()}clearViewer(){var e,t;(e=this.viewer)==null||e.scene.disposeSceneModels(),(t=this.viewer)==null||t.scene.setEnvironment(null),Object.values(this._models).forEach(async n=>n.then(i=>i.forEach(o=>o.dispose&&o.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],i=[],o=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const c of t)!this._models[c]&&c&&(this._models[c]=this.viewer.getManager().importer.importPath(c,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const a=this.viewer.scene.environment;a?this._environmentFromSource=a:this.viewer.scene.environment=o;for(const[c,u]of Object.entries(this._models))t.includes(c)?n.push(u.then(d=>[c,d])):i.push(u);await Promise.all([Promise.all(n).then(async c=>Promise.all(c.map(async u=>(this._models[u[0]]=this.viewer.getManager().importer.processImported(u[1]),this._models[u[0]])))).then(c=>{for(const u of c)for(const d of u)d&&d.assetType==="model"&&this.viewer.scene.addSceneObject(d)}),Promise.all(i).then(c=>{for(const u of c)for(const d of u)d&&d.assetType==="model"&&d.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(n&&n.assetType!=="texture"||await this.viewer.scene.setEnvironment(n),t==null||t.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}addEventListener(e,t,n){super.addEventListener(e,t,n),e==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",PC);var Vw=__webpackgi_require__(798),dA={};Vw.Z&&Vw.Z.locals&&(dA.locals=Vw.Z.locals);var IE,PE=0,qg={};qg.styleTagTransform=tm(),qg.setAttributes=$f(),qg.insert=function(s,e){(e.target||document.head).appendChild(s)},qg.domAPI=Zf(),qg.insertStyleElement=em(),dA.use=function(s){return qg.options=s||{},PE++||(IE=Jf()(Vw.Z,qg)),dA},dA.unuse=function(){PE>0&&!--PE&&(IE(),IE=null)};var zP=dA;let Gw=class extends F_{constructor(){super("Popup");const s=(0,V.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});s.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(s)}_updateMainDiv(s){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";s.forEach((t,n)=>{e+=`<span class="processState">${t.state}</span>: ${(n||"").split("/").pop()} ${t.progress?" - "+t.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,s.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(s){zP.use({target:s.container}),await super.onAdded(s)}};Gw.PluginType="AssetManagerBasicPopupPlugin",Gw=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Hn("Asset manager popup")],Gw);var Hw=__webpackgi_require__(44),pA={};Hw.Z&&Hw.Z.locals&&(pA.locals=Hw.Z.locals);var RE,DE=0,Xg={};Xg.styleTagTransform=tm(),Xg.setAttributes=$f(),Xg.insert=function(s,e){(e.target||document.head).appendChild(s)},Xg.domAPI=Zf(),Xg.insertStyleElement=em(),pA.use=function(s){return Xg.options=s||{},DE++||(RE=Jf()(Hw.Z,Xg)),pA},pA.unuse=function(){DE>0&&!--DE&&(RE(),RE=null)};var VP=pA;let fA=class extends F_{constructor(s=!0){super("LoadingBar"),this.showText=s}_updateMainDiv(s){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,t=1;s.forEach((n,i)=>{e+=n.progress??99,t+=100}),this._contentDiv.innerHTML=this.showText?(100*e/t).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/t).toFixed(0)+"%",s.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(s){VP.use({target:s.container}),await super.onAdded(s)}};fA.PluginType="AssetManagerLoadingBarPlugin",fA=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Hn("Asset manager loading bar")],fA);class Zh{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var t;this._basePath=(e==null?void 0:e.basePath)??"",this._assets=((t=e==null?void 0:e.assets)==null?void 0:t.map(n=>this._resolveAsset(n)))??[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,V.pathJoin)([this._basePath,e.path])}}}class GP extends V.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find(i=>{var o;return i&&(e.test(i.path)||e.test(((o=i.file)==null?void 0:o.name)??""))});if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}const RC=new p.Pa4,DC=new p.Pa4,Ca=new p.Ltg,Ma=new p.Ltg,$h=new p.Ltg,BE=new p.Pa4,OE=new p.yGw,Ta=new p.Zzh,BC=new p.Pa4,Qw=new p.ZzF,Ww=new p.aLr,ed=new p.Ltg;let td,Yg;function OC(s,e,t){return ed.set(0,0,-e,1).applyMatrix4(s.projectionMatrix),ed.multiplyScalar(1/ed.w),ed.x=Yg/t.width,ed.y=Yg/t.height,ed.applyMatrix4(s.projectionMatrixInverse),ed.multiplyScalar(1/ed.w),Math.abs(Math.max(ed.x,ed.y))}class qw extends p.Kj0{constructor(e=new Kd,t=new Su({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let a=0,c=0,u=t.count;a<u;a++,c+=2)RC.fromBufferAttribute(t,a),DC.fromBufferAttribute(n,a),i[c]=c===0?0:i[c-1],i[c+1]=i[c]+RC.distanceTo(DC);const o=new p.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new p.kB5(o,1,0)),e.setAttribute("instanceDistanceEnd",new p.kB5(o,1,1)),this}raycast(e,t){const n=this.material.worldUnits,i=e.camera;i!==null||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=e.params.Line2!==void 0&&e.params.Line2.threshold||0;td=e.ray;const a=this.matrixWorld,c=this.geometry,u=this.material;let d,m;Yg=u.linewidth+o,c.boundingSphere===null&&c.computeBoundingSphere(),Ww.copy(c.boundingSphere).applyMatrix4(a),d=n?.5*Yg:OC(i,Math.max(i.near,Ww.distanceToPoint(td.origin)),u.resolution),Ww.radius+=d,td.intersectsSphere(Ww)!==!1&&(c.boundingBox===null&&c.computeBoundingBox(),Qw.copy(c.boundingBox).applyMatrix4(a),m=n?.5*Yg:OC(i,Math.max(i.near,Qw.distanceToPoint(td.origin)),u.resolution),Qw.expandByScalar(m),td.intersectsBox(Qw)!==!1&&(n?function(g,_){const w=g.matrixWorld,x=g.geometry,T=x.attributes.instanceStart,I=x.attributes.instanceEnd;for(let R=0,M=Math.min(x.instanceCount,T.count);R<M;R++){Ta.start.fromBufferAttribute(T,R),Ta.end.fromBufferAttribute(I,R),Ta.applyMatrix4(w);const C=new p.Pa4,L=new p.Pa4;td.distanceSqToSegment(Ta.start,Ta.end,L,C),L.distanceTo(C)<.5*Yg&&_.push({point:L,pointOnLine:C,distance:td.origin.distanceTo(L),object:g,face:null,faceIndex:R,uv:null,uv1:null})}}(this,t):function(g,_,w){const x=_.projectionMatrix,T=g.material.resolution,I=g.matrixWorld,R=g.geometry,M=R.attributes.instanceStart,C=R.attributes.instanceEnd,L=Math.min(R.instanceCount,M.count),k=-_.near;td.at(1,$h),$h.w=1,$h.applyMatrix4(_.matrixWorldInverse),$h.applyMatrix4(x),$h.multiplyScalar(1/$h.w),$h.x*=T.x/2,$h.y*=T.y/2,$h.z=0,BE.copy($h),OE.multiplyMatrices(_.matrixWorldInverse,I);for(let j=0,H=L;j<H;j++){if(Ca.fromBufferAttribute(M,j),Ma.fromBufferAttribute(C,j),Ca.w=1,Ma.w=1,Ca.applyMatrix4(OE),Ma.applyMatrix4(OE),Ca.z>k&&Ma.z>k)continue;if(Ca.z>k){const he=Ca.z-Ma.z,le=(Ca.z-k)/he;Ca.lerp(Ma,le)}else if(Ma.z>k){const he=Ma.z-Ca.z,le=(Ma.z-k)/he;Ma.lerp(Ca,le)}Ca.applyMatrix4(x),Ma.applyMatrix4(x),Ca.multiplyScalar(1/Ca.w),Ma.multiplyScalar(1/Ma.w),Ca.x*=T.x/2,Ca.y*=T.y/2,Ma.x*=T.x/2,Ma.y*=T.y/2,Ta.start.copy(Ca),Ta.start.z=0,Ta.end.copy(Ma),Ta.end.z=0;const X=Ta.closestPointToPointParameter(BE,!0);Ta.at(X,BC);const ee=p.M8C.lerp(Ca.z,Ma.z,X),oe=ee>=-1&&ee<=1,re=BE.distanceTo(BC)<.5*Yg;if(oe&&re){Ta.start.fromBufferAttribute(M,j),Ta.end.fromBufferAttribute(C,j),Ta.start.applyMatrix4(I),Ta.end.applyMatrix4(I);const he=new p.Pa4,le=new p.Pa4;td.distanceSqToSegment(Ta.start,Ta.end,le,he),w.push({point:le,pointOnLine:he,distance:td.origin.distanceTo(le),object:g,face:null,faceIndex:j,uv:null,uv1:null})}}}(this,i,t)))}}class mA extends Kd{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class LE extends qw{constructor(e=new mA,t=new Su({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class HP extends p.DqL{constructor(e){super(e)}parse(e,t){const n=new QP(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:n.numberOfFaces===6,mipmapCount:n.numberOfMipmapLevels}}}class QP{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(n[0]!==171||n[1]!==75||n[2]!==84||n[3]!==88||n[4]!==32||n[5]!==49||n[6]!==49||n[7]!==187||n[8]!==13||n[9]!==10||n[10]!==26||n[11]!==10)return void console.error("texture missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(this.arrayBuffer,12,13*i),a=o.getUint32(0,!0)===67305985;this.glType=o.getUint32(1*i,a),this.glTypeSize=o.getUint32(2*i,a),this.glFormat=o.getUint32(3*i,a),this.glInternalFormat=o.getUint32(4*i,a),this.glBaseInternalFormat=o.getUint32(5*i,a),this.pixelWidth=o.getUint32(6*i,a),this.pixelHeight=o.getUint32(7*i,a),this.pixelDepth=o.getUint32(8*i,a),this.numberOfArrayElements=o.getUint32(9*i,a),this.numberOfFaces=o.getUint32(10*i,a),this.numberOfMipmapLevels=o.getUint32(11*i,a),this.bytesOfKeyValueData=o.getUint32(12*i,a),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,i=this.pixelWidth,o=this.pixelHeight;const a=e?this.numberOfMipmapLevels:1;for(let c=0;c<a;c++){const u=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let d=0;d<this.numberOfFaces;d++){const m=new Uint8Array(this.arrayBuffer,n,u);t.push({data:m,width:i,height:o}),n+=u,n+=3-(u+3)%4}i=Math.max(1,.5*i),o=Math.max(1,.5*o)}return t}}class kE extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Qt]}async onAdded(e){var t,n;this._importer||(this._importer=new Br(HP,["ktx"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}kE.PluginType="KTXLoadPlugin";class WP extends p.hH6{constructor(e){super(e),this.responseType="blob"}}class LC extends p.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,n,i){return super.load(e,o=>{try{t==null||t((0,V.blobToDataURL)(o))}catch(a){i==null||i(a)}},n,i)}}class kC{async parseAsync(e,t){return new Blob([JSON.stringify(e,null,t.jsonSpaces??2)],{type:"application/json"})}}class UC{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}const NC={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Xw{constructor(){this.pluginCallbacks=[],this.register(function(e){return new XP(e)}),this.register(function(e){return new YP(e)}),this.register(function(e){return new ZP(e)}),this.register(function(e){return new $P(e)}),this.register(function(e){return new eR(e)}),this.register(function(e){return new tR(e)}),this.register(function(e){return new KP(e)}),this.register(function(e){return new JP(e)}),this.register(function(e){return new nR(e)}),this.register(function(e){return new iR(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,o){const a=o||new GC,c=[];for(let u=0,d=this.pluginCallbacks.length;u<d;u++)c.push(this.pluginCallbacks[u](a));a.setPlugins(c),a.write(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(i,o){n.parse(e,i,o,t)})}}const UE=5120,NE=5121,FE=5122,jE=5123,zE="KHR_mesh_quantization",Mc={};Mc[p.TyD]=9728,Mc[p.YLQ]=9984,Mc[p.aH4]=9986,Mc[p.wem]=9729,Mc[p.qyh]=9985,Mc[p.D1R]=9987,Mc[p.uWy]=33071,Mc[p.rpg]=10497,Mc[p.OoA]=33648;const FC={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},qP=new p.Ilk;function gA(s,e){return s.length===e.length&&s.every(function(t,n){return t===e[n]})}function jC(s){return 4*Math.ceil(s/4)}function Yw(s,e=0){const t=jC(s.byteLength);if(t!==s.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(s)),e!==0)for(let i=s.byteLength;i<t;i++)n[i]=e;return n.buffer}return s}function zC(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function VC(s,e){if(s.toBlob!==void 0)return new Promise(n=>s.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),s.convertToBlob({type:e,quality:t})}class GC{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,o=i.buffers,a=i.json;n=i.options;const c=i.extensionsUsed,u=i.extensionsRequired,d=new Blob(o,{type:"application/octet-stream"}),m=Object.keys(c),g=Object.keys(u);if(m.length>0&&(a.extensionsUsed=m),g.length>0&&(a.extensionsRequired=g),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=d.size),n.binary===!0){const _=new FileReader;_.readAsArrayBuffer(d),_.onloadend=function(){const w=Yw(_.result),x=new DataView(new ArrayBuffer(8));x.setUint32(0,w.byteLength,!0),x.setUint32(4,5130562,!0);const T=Yw((I=JSON.stringify(a),new TextEncoder().encode(I).buffer),32);var I;const R=new DataView(new ArrayBuffer(8));R.setUint32(0,T.byteLength,!0),R.setUint32(4,1313821514,!0);const M=new ArrayBuffer(12),C=new DataView(M);C.setUint32(0,1179937895,!0),C.setUint32(4,2,!0);const L=12+R.byteLength+T.byteLength+x.byteLength+w.byteLength;C.setUint32(8,L,!0);const k=new Blob([M,R,T,x,w],{type:"application/octet-stream"}),j=new FileReader;j.readAsArrayBuffer(k),j.onloadend=function(){t(j.result)}}}else if(a.buffers&&a.buffers.length>0){const _=new FileReader;_.readAsDataURL(d),_.onloadend=function(){const w=_.result;a.buffers[0].uri=w,t(a)}}else t(a)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,i=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&o.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const a in o.gltfExtensions)t.extensions[a]=o.gltfExtensions[a],i[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new p.Pa4;for(let n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),i=new p.Pa4;for(let o=0,a=n.count;o<a;o++)i.fromBufferAttribute(n,o),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),n.setXYZ(o,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const i={};t.offset.x===0&&t.offset.y===0||(i.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(i.rotation=t.rotation,n=!0),t.repeat.x===1&&t.repeat.y===1||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(_){return _.colorSpace===p.KI_?function(w){return w<.04045?.0773993808*w:Math.pow(.9478672986*w+.0521327014,2.4)}:function(w){return w}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const i=e?e.image:null,o=t?t.image:null,a=Math.max(i?i.width:0,o?o.width:0),c=Math.max(i?i.height:0,o?o.height:0),u=zC();u.width=a,u.height=c;const d=u.getContext("2d");d.fillStyle="#00ffff",d.fillRect(0,0,a,c);const m=d.getImageData(0,0,a,c);if(i){d.drawImage(i,0,0,a,c);const _=n(e),w=d.getImageData(0,0,a,c).data;for(let x=2;x<w.length;x+=4)m.data[x]=256*_(w[x]/256)}if(o){d.drawImage(o,0,0,a,c);const _=n(t),w=d.getImageData(0,0,a,c).data;for(let x=1;x<w.length;x+=4)m.data[x]=256*_(w[x]/256)}d.putImageData(m,0,0);const g=(e||t).clone();return g.source=new p.Hw6(u),g.colorSpace=p.aCh,g.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),g}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,i,o){const a=this.json;let c;switch(a.bufferViews||(a.bufferViews=[]),t){case UE:case NE:c=1;break;case FE:case jE:c=2;break;default:c=4}const u=jC(i*e.itemSize*c),d=new DataView(new ArrayBuffer(u));let m=0;for(let _=n;_<n+i;_++)for(let w=0;w<e.itemSize;w++){let x;e.itemSize>4?x=e.array[_*e.itemSize+w]:(w===0?x=e.getX(_):w===1?x=e.getY(_):w===2?x=e.getZ(_):w===3&&(x=e.getW(_)),e.normalized===!0&&(x=p.M8C.normalize(x,e.array))),t===5126?d.setFloat32(m,x,!0):t===5124?d.setInt32(m,x,!0):t===5125?d.setUint32(m,x,!0):t===FE?d.setInt16(m,x,!0):t===jE?d.setUint16(m,x,!0):t===UE?d.setInt8(m,x):t===NE&&d.setUint8(m,x),m+=c}const g={buffer:this.processBuffer(d.buffer),byteOffset:this.byteOffset,byteLength:u};return o!==void 0&&(g.target=o),o===34962&&(g.byteStride=e.itemSize*c),this.byteOffset+=u,a.bufferViews.push(g),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(i){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const a=Yw(o.result),c={buffer:t.processBuffer(a),byteOffset:t.byteOffset,byteLength:a.byteLength};t.byteOffset+=a.byteLength,i(n.bufferViews.push(c)-1)}})}processBufferViewImageBuffer(e){const t=this,n=t.json;n.bufferViews||(n.bufferViews=[]),e=Yw(e);const i={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,n.bufferViews.push(i)-1}processAccessor(e,t,n,i){const o=this.json;let a;if(e.array.constructor===Float32Array)a=5126;else if(e.array.constructor===Int32Array)a=5124;else if(e.array.constructor===Uint32Array)a=5125;else if(e.array.constructor===Int16Array)a=FE;else if(e.array.constructor===Uint16Array)a=jE;else if(e.array.constructor===Int8Array)a=UE;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");a=NE}if(n===void 0&&(n=0),i===void 0&&(i=e.count),i===0)return null;const c=function(g,_,w){const x={min:new Array(g.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(g.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let T=_;T<_+w;T++)for(let I=0;I<g.itemSize;I++){let R;g.itemSize>4?R=g.array[T*g.itemSize+I]:(I===0?R=g.getX(T):I===1?R=g.getY(T):I===2?R=g.getZ(T):I===3&&(R=g.getW(T)),g.normalized===!0&&(R=p.M8C.normalize(R,g.array))),x.min[I]=Math.min(x.min[I],R),x.max[I]=Math.max(x.max[I],R)}return x}(e,n,i);let u;t!==void 0&&(u=e===t.index?34963:34962);const d=this.processBufferView(e,a,n,i,u),m={bufferView:d.id,byteOffset:d.byteOffset,componentType:a,count:i,max:c.max,min:c.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(m.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(m)-1}processImage(e,t,n,i="image/png",o=void 0,a=void 0){if(e!==null){const c=this,u=c.cache,d=c.json,m=c.options,g=c.pending;u.images.has(e)||u.images.set(e,{});const _=u.images.get(e),w=i+":flipY/"+n.toString()+(o||a?";"+o+";"+a:"");if(_[w]!==void 0)return _[w];d.images||(d.images=[]);const x={mimeType:i},T=zC();T.width=Math.min(o||e.width,m.maxTextureSize),T.height=Math.min(a||e.height,m.maxTextureSize);const I=T.getContext("2d");if(n===!0&&(I.translate(0,T.height),I.scale(1,-1)),e.data!==void 0){t!==p.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>m.maxTextureSize||e.height>m.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const M=new Uint8ClampedArray(e.height*e.width*4);for(let C=0;C<M.length;C+=4)M[C+0]=e.data[C+0],M[C+1]=e.data[C+1],M[C+2]=e.data[C+2],M[C+3]=e.data[C+3];I.putImageData(new ImageData(M,e.width,e.height),0,0)}else I.drawImage(e,0,0,T.width,T.height);m.binary===!0?g.push(VC(T,i).then(M=>c.processBufferViewImage(M)).then(M=>{x.bufferView=M})):T.toDataURL!==void 0?x.uri=T.toDataURL(i):g.push(VC(T,i).then(M=>new FileReader().readAsDataURL(M)).then(M=>{x.uri=M}));const R=d.images.push(x)-1;return _[w]=R,R}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Mc[e.magFilter],minFilter:Mc[e.minFilter],wrapS:Mc[e.wrapS],wrapT:Mc[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let i=e.userData.mimeType;i==="image/webp"&&(i="image/png"),i==="image/jpg"&&(i="image/jpeg");const o={sampler:this.processSampler(e),source:!i||["image/jpeg","image/png"].includes(i)?this.processImage(e.image,e.format,e.flipY,i):null};e.name&&(o.name=e.name),this._invokeAll(function(c){c.writeTexture&&c.writeTexture(e,o)}),o.source===null&&console.error("GLTFExporter: Unsupported mime type: "+i+". Cannot export texture.",e);const a=n.textures.push(o)-1;return t.textures.set(e,a),a}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const o=e.color.toArray().concat([e.opacity]);if(gA(o,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const c=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),u={index:this.processTexture(c),channel:c.channel};this.applyTextureTransform(u,c),i.pbrMetallicRoughness.metallicRoughnessTexture=u}if(e.map){const c={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(c,e.map),i.pbrMetallicRoughness.baseColorTexture=c}if(e.emissive){const c=e.emissive;if(Math.max(c.r,c.g,c.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const u={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(u,e.emissiveMap),i.emissiveTexture=u}}if(e.normalMap){const c={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(c.scale=e.normalScale.x),this.applyTextureTransform(c,e.normalMap),i.normalTexture=c}if(e.aoMap){const c={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(c.strength=e.aoMapIntensity),this.applyTextureTransform(c,e.aoMap),i.occlusionTexture=c}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===p.ehD&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(c){c.writeMaterial&&c.writeMaterial(e,i)});const a=n.materials.push(i)-1;return t.materials.set(e,a),a}processMesh(e){const t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let C=0,L=e.material.length;C<L;C++)i.push(e.material[C].uuid);else i.push(e.material.uuid);const o=i.join(":");if(t.meshes.has(o))return t.meshes.get(o);const a=e.geometry;let c;c=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const u={},d={},m=[],g=[],_={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},w=a.getAttribute("normal");w===void 0||this.isNormalizedNormalAttribute(w)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(w)));let x=null;for(let C in a.attributes){if(C.slice(0,5)==="morph")continue;const L=a.attributes[C];if(C=_[C]||C.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(C)||(C="_"+C),t.attributes.has(this.getUID(L))){d[C]=t.attributes.get(this.getUID(L));continue}x=null;const k=L.array;C!=="JOINTS_0"||k instanceof Uint16Array||k instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),x=new p.TlE(new Uint16Array(k),L.itemSize,L.normalized));const j=this.processAccessor(x||L,a);j!==null&&(C.startsWith("_")||this.detectMeshQuantization(C,L),d[C]=j,t.attributes.set(this.getUID(L),j))}if(w!==void 0&&a.setAttribute("normal",w),Object.keys(d).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const C=[],L=[],k={};if(e.morphTargetDictionary!==void 0)for(const j in e.morphTargetDictionary)k[e.morphTargetDictionary[j]]=j;for(let j=0;j<e.morphTargetInfluences.length;++j){const H={};let X=!1;for(const ee in a.morphAttributes){if(ee!=="position"&&ee!=="normal"){X||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),X=!0);continue}const oe=a.morphAttributes[ee][j],re=ee.toUpperCase(),he=a.attributes[ee];if(t.attributes.has(this.getUID(oe,!0))){H[re]=t.attributes.get(this.getUID(oe,!0));continue}const le=oe.clone();if(!a.morphTargetsRelative)for(let ue=0,ge=oe.count;ue<ge;ue++)for(let _e=0;_e<oe.itemSize;_e++)_e===0&&le.setX(ue,oe.getX(ue)-he.getX(ue)),_e===1&&le.setY(ue,oe.getY(ue)-he.getY(ue)),_e===2&&le.setZ(ue,oe.getZ(ue)-he.getZ(ue)),_e===3&&le.setW(ue,oe.getW(ue)-he.getW(ue));H[re]=this.processAccessor(le,a),t.attributes.set(this.getUID(he,!0),H[re])}g.push(H),C.push(e.morphTargetInfluences[j]),e.morphTargetDictionary!==void 0&&L.push(k[j])}u.weights=C,L.length>0&&(u.extras={},u.extras.targetNames=L)}const T=Array.isArray(e.material);if(T&&a.groups.length===0)return null;const I=T?e.material:[e.material],R=T?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let C=0,L=R.length;C<L;C++){const k={mode:c,attributes:d};if(this.serializeUserData(a,k),g.length>0&&(k.targets=g),a.index!==null){let H=this.getUID(a.index);R[C].start===void 0&&R[C].count===void 0||(H+=":"+R[C].start+":"+R[C].count),t.attributes.has(H)?k.indices=t.attributes.get(H):(k.indices=this.processAccessor(a.index,a,R[C].start,R[C].count),t.attributes.set(H,k.indices)),k.indices===null&&delete k.indices}const j=this.processMaterial(I[R[C].materialIndex]);j!==null&&(k.material=j),m.push(k)}u.primitives=m,n.meshes||(n.meshes=[]),this._invokeAll(function(C){C.writeMesh&&C.writeMesh(e,u)});const M=n.meshes.push(u)-1;return t.meshes.set(o,M),M}detectMeshQuantization(e,t){if(this.extensionsUsed[zE])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const i=e.split("_",1)[0];NC[i]&&NC[i].includes(n)&&(this.extensionsUsed[zE]=!0,this.extensionsRequired[zE]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:p.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);const o=(e=Xw.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],c=[];for(let u=0;u<o.length;++u){const d=o[u],m=p.iUV.parseTrackName(d.name);let g=p.iUV.findNode(t,m.nodeName);const _=FC[m.propertyName];if(m.objectName==="bones"&&(g=g.isSkinnedMesh===!0?g.skeleton.getBoneByName(m.objectIndex):void 0),!g||!_)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',d.name),null;const w=1;let x,T=d.values.length/d.times.length;_===FC.morphTargetInfluences&&(T/=g.morphTargetInfluences.length),d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(x="CUBICSPLINE",T/=3):x=d.getInterpolation()===p.Syv?"STEP":"LINEAR",c.push({input:this.processAccessor(new p.TlE(d.times,w)),output:this.processAccessor(new p.TlE(d.values,T)),interpolation:x}),a.push({sampler:c.length-1,target:{node:i.get(g),path:_}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:c,channels:a}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],o=e.skeleton;if(o===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const c=[],u=new Float32Array(16*o.bones.length),d=new p.yGw;for(let m=0;m<o.bones.length;++m)c.push(n.get(o.bones[m])),d.copy(o.boneInverses[m]),d.multiply(e.bindMatrix).toArray(u,16*m);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new p.TlE(u,16)),joints:c,skeleton:n.get(a)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const o={};if(n.trs){const c=e.quaternion.toArray(),u=e.position.toArray(),d=e.scale.toArray();gA(c,[0,0,0,1])||(o.rotation=c),gA(u,[0,0,0])||(o.translation=u),gA(d,[1,1,1])||(o.scale=d)}else e.matrixAutoUpdate&&e.updateMatrix(),gA(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const c=this.processMesh(e);c!==null&&(o.mesh=c)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const c=[];for(let u=0,d=e.children.length;u<d;u++){const m=e.children[u];if(m.visible||n.onlyVisible===!1){const g=this.processNode(m);g!==null&&c.push(g)}}c.length>0&&(o.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,o)});const a=t.nodes.push(o)-1;return i.set(e,a),a}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const o=[];for(let a=0,c=e.children.length;a<c;a++){const u=e.children[a];if(u.visible||n.onlyVisible===!1){const d=this.processNode(u);d!==null&&o.push(d)}}o.length>0&&(i.nodes=o),this.serializeUserData(e,i)}processObjects(e){const t=new p.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const n=[];for(let i=0;i<e.length;i++)e[i]instanceof p.xsS?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class XP{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,i=n.json,o=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},o[this.name]=!0);const c=i.extensions[this.name].lights;c.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:c.length-1}}}class YP{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class KP{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const a={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(a,e.clearcoatMap),o.clearcoatTexture=a}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const a={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(a,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){const a={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(a,e.clearcoatNormalMap),o.clearcoatNormalTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class JP{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const a={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(a,e.iridescenceMap),o.iridescenceTexture=a}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const a={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(a,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class ZP{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const a={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(a,e.transmissionMap),o.transmissionTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class $P{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const a={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(a,e.thicknessMap),o.thicknessTexture=a}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class eR{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class tR{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(qP)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,i=n.extensionsUsed,o={};if(e.specularIntensityMap){const a={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(a,e.specularIntensityMap),o.specularTexture=a}if(e.specularColorMap){const a={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(a,e.specularColorMap),o.specularColorTexture=a}o.specularFactor=e.specularIntensity,o.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class nR{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const n=this.writer,i=n.extensionsUsed,o={};if(e.sheenRoughnessMap){const a={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(a,e.sheenRoughnessMap),o.sheenRoughnessTexture=a}if(e.sheenColorMap){const a={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(a,e.sheenColorMap),o.sheenColorTexture=a}o.sheenRoughnessFactor=e.sheenRoughness,o.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,i[this.name]=!0}}class iR{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}Xw.Utils={GLTFWriter:GC,insertKeyframe:function(s,e){const n=s.getValueSize(),i=new s.TimeBufferType(s.times.length+1),o=new s.ValueBufferType(s.values.length+n),a=s.createInterpolant(new s.ValueBufferType(n));let c;if(s.times.length===0){i[0]=e;for(let u=0;u<n;u++)o[u]=0;c=0}else if(e<s.times[0]){if(Math.abs(s.times[0]-e)<.001)return 0;i[0]=e,i.set(s.times,1),o.set(a.evaluate(e),0),o.set(s.values,n),c=0}else if(e>s.times[s.times.length-1]){if(Math.abs(s.times[s.times.length-1]-e)<.001)return s.times.length-1;i[i.length-1]=e,i.set(s.times,0),o.set(s.values,0),o.set(a.evaluate(e),s.values.length),c=i.length-1}else for(let u=0;u<s.times.length;u++){if(Math.abs(s.times[u]-e)<.001)return u;if(s.times[u]<e&&s.times[u+1]>e){i.set(s.times.slice(0,u+1),0),i[u+1]=e,i.set(s.times.slice(u+1),u+2),o.set(s.values.slice(0,(u+1)*n),0),o.set(a.evaluate(e),(u+1)*n),o.set(s.values.slice((u+1)*n),(u+2)*n),c=u+1;break}}return s.times=i,s.values=o,c},mergeMorphTargetTracks:function(s,e){const t=[],n={},i=s.tracks;for(let o=0;o<i.length;++o){let a=i[o];const c=p.iUV.parseTrackName(a.name),u=p.iUV.findNode(e,c.nodeName);if(c.propertyName!=="morphTargetInfluences"||c.propertyIndex===void 0){t.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(p.NMF)}const d=u.morphTargetInfluences.length,m=u.morphTargetDictionary[c.propertyIndex];if(m===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+c.propertyIndex);let g;if(n[u.uuid]===void 0){g=a.clone();const w=new g.ValueBufferType(d*g.times.length);for(let x=0;x<g.times.length;x++)w[x*d+m]=g.values[x];g.name=(c.nodeName||"")+".morphTargetInfluences",g.values=w,n[u.uuid]=g,t.push(g);continue}const _=a.createInterpolant(new a.ValueBufferType(1));g=n[u.uuid];for(let w=0;w<g.times.length;w++)g.values[w*d+m]=_.evaluate(g.times[w]);for(let w=0;w<a.times.length;w++){const x=this.insertKeyframe(g,a.times[w]);g.values[x*d+m]=a.values[w]}}return s.tracks=t,s}};class HC extends Xw.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new p.Wid}serializeUserData(e,t){const n=e.userData,i={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach(([a,c])=>{(!c||typeof c=="function"||c.isObject3D||c.isTexture||c.isMaterial||c.assetType!=null||a.startsWith("_")||a!=="uuid"&&(ec.includes(a)||qp.includes(a)||Qi.includes(a)))&&(i[a]=c,delete n[a])});const o=xi(n,!1);Object.entries(i).forEach(([a,c])=>{n[a]=c,delete i[a]}),e.userData=o,super.serializeUserData(e,t),e.userData=n}processObjects(e){var t;e.length===1&&((t=e[0])!=null&&t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(n===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return n;const i=JSON.stringify(this.json.materials[n]),o=JSON.parse(i);this.serializeUserData(e,o),this._invokeAll(c=>{c.writeMaterial&&c.writeMaterial(e,o)});const a=this.json.materials.push(o)-1;return this.cache.materials.set(e,a),a}processImageBlob(e,t){if(!e)return-1;const n=this.cache,i=this.options,o=this.pending,a=this.json,c=t.image;n.images.has(c)||n.images.set(c,{});const u=n.images.get(c),d=e.type+":flipY/"+t.flipY.toString();if(u[d]!==void 0)return u[d];a.images||(a.images=[]);const m={mimeType:e.type};i.binary===!0?o.push(new Promise(_=>{this.processBufferViewImage(e).then(w=>{m.bufferView=w,_()})})):o.push((0,V.blobToDataURL)(e).then(_=>{m.uri=_}));const g=a.images.push(m)-1;return u[d]=g,g}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const i=e.source.data,o=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const a=super.processTexture(e),c=n.textures[a];if(!c)return console.error("No texture def",a,e),a;const u=n.images?n.images[c.source]:null;if(u&&(u.extras||(u.extras={}),e.source&&(u.extras.uuid=e.source.uuid),u.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=i,e.userData.mimeType=o,!c)return console.error("textureDef is null",a,e),a;if(c.source>=0){const d=this.json.images[c.source];d.uri?console.warn("uri already set",d.uri):(d.uri=e.userData.rootPath,d.mimeType=o,d.extras||(d.extras={}),d.extras.flipY=e.flipY,d.extras.uri=e.userData.rootPath)}else c.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,o)}return c.source<0&&console.error("textureDef.source cannot be saved",c,e),a}processImage(e,t,n,i="image/png"){return e?super.processImage(e,t,n,i,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,n,i="image/png"){const o=this.cache,a=this.json;o.images.has(e)||o.images.set(e,{});const c=o.images.get(e),u=i+":flipY/"+n.toString();if(c[u]!==void 0)return c[u];a.images||(a.images=[]);const d={mimeType:i,uri:t,extras:{flipY:n}},m=a.images.push(d)-1;return c[u]=m,m}}function rR(s,e){(e=e??document.createElement("script")).type=s.type||"text/javascript",e.text=s.text;for(let t=0;t<s.attributes.length;t++){const n=s.attributes[t];e.setAttribute(n.name,n.value)}return e}function QC(s,e=0){const t=(n=s.byteLength,4*Math.ceil(n/4));var n;if(t!==s.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(s)),e!==0)for(let o=s.byteLength;o<t;o++)i[o]=e;return i.buffer}return s}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(s,e){const t=new Uint8Array(this);e==null&&(e=t.length);const n=new ArrayBuffer(e-s),i=new Uint8Array(n);for(let o=0;o<i.length;o++)i[o]=t[o+s];return n});class VE extends Xw{register(e){return super.register(e)}async parseAsync(e,t){if(!e)throw new Error("No object to export");const n=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((i,o)=>this.parse(e,i,o,t));if(n&&typeof n=="object"&&!n.byteLength)return new Blob([JSON.stringify(n,(i,o)=>i.startsWith("__")?void 0:o,t.jsonSpaces??2)],{type:"model/gltf+json"});if(n){let i=null;return t.encrypt&&(!t.encryptKey&&window.prompt&&(t.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),t.encryptKey?i=function(o,a){const c=QC(o),u=new DataView(new ArrayBuffer(8));u.setUint32(0,c.byteLength,!0),u.setUint32(4,5130562,!0);const d=QC(new TextEncoder().encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})).buffer,32),m=new DataView(new ArrayBuffer(8));m.setUint32(0,d.byteLength,!0),m.setUint32(4,1313821514,!0);const g=new ArrayBuffer(12),_=new DataView(g);_.setUint32(0,1179937895,!0),_.setUint32(4,2,!0);const w=12+m.byteLength+d.byteLength+u.byteLength+c.byteLength;_.setUint32(8,w,!0);const x=new Blob([g,m,d,u,c],{type:"application/octet-stream"});return x.ext="glb",x}(await(0,V.aesGcmEncrypt)(new Uint8Array(n),t.encryptKey)):console.warn("GLTF Export: encryption key not provided, skipping encryption")),i||(i=new Blob([n],{type:"model/gltf+binary"})),i}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,i={}){const o={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!i.embedUrlImages&&i.externalImagesInExtras||!1,embedUrlImages:i.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:i};return i.exportExt==="glb"&&(o.binary=!0),i.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(a=>a.traverse(c=>{c.uuid&&(c.userData.gltfUUID=c.uuid)})),(Array.isArray(e)?e:[e]).forEach(a=>a.traverse(c=>{if(c.animations)for(const u of c.animations)u.__gltfExport===!1||o.animations.includes(u)||o.animations.push(...c.animations)})),super.parse(e,a=>{i.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(c=>c.traverse(u=>{delete u.userData.gltfUUID})),t(Object.assign(a,{__isGLTFOutput:!0}))},n,o,new HC)}}function WC(s,e){const t=s.getPlugin(Qt).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&t.resources.textures&&[...Object.entries(t.resources.textures)].forEach(([i,o])=>{e.json.textures.find(c=>{var u,d,m,g,_;return((u=c.extras)==null?void 0:u.uuid)===i||((m=(d=e.json.samplers[c.sampler])==null?void 0:d.extras)==null?void 0:m.uuid)===i||((_=(g=e.json.images[c.source])==null?void 0:g.extras)==null?void 0:_.t_uuid)===i})&&(o.image&&t.resources.images&&t.resources.images[o.image]&&delete t.resources.images[o.image],t.resources.textures[i]={})}),e.json.materials&&t.resources.materials&&[...Object.entries(t.resources.materials)].forEach(([i,o])=>{e.json.materials.find(a=>{var c;return((c=a.extras)==null?void 0:c.uuid)===i})&&(t.resources.materials[i]={})});const n=[];Object.values(t.resources).forEach(i=>{i&&Object.values(i).forEach(o=>{o.url&&(o.url.type==="Uint16Array"&&o.url.data?(o.url.data instanceof Uint16Array||(o.url.data=new Uint16Array(o.url.data)),n.push(o.url)):o.url.type==="Uint8Array"&&o.url.data&&(o.url.data instanceof Uint8Array||(o.url.data=new Uint8Array(o.url.data)),n.push(o.url)))})});for(const i of n){let o="application/octet-stream";if(i.mimeType&&(o=i.mimeType),e.options.exporterOptions.encodeUint16Rgbe&&i.type==="Uint16Array"&&i.width>0&&i.height>0){const d=sR(i.data,4),m=new ImageData(d,i.width,i.height),g=p.PpQ.getDataURL(m,!0).split(",")[1],_=2;o="image/png",_===1||(i.data=Uint8Array.from(atob(g),w=>w.charCodeAt(0))),i.encoding="rgbe",i.encodingVersion=_}e.json.images||(e.json.images=[]);const a={mimeType:o},c=e.json.images.push(a)-1,u=i.data;a.bufferView=e.processBufferViewImageBuffer(u),i.data={image:c}}return t}function sR(s,e=3,t){let n,i,o,a,c;const u=s.byteLength/(2*e)|0;t=t||new Uint8ClampedArray(4*u);for(let d=0;d<u;d++){n=s[d*e],i=s[d*e+1],o=s[d*e+2],a=Math.max(Math.max(n,i),o);const m=Math.ceil(Math.log2(a));c=Math.pow(2,m-8),t[4*d]=n/c|0,t[4*d+1]=i/c|0,t[4*d+2]=o/c|0,t[4*d+3]=m+128}return t}function GE(s,e,t=VE,n){if(!e)return;const i=s.Exporters.findIndex(a=>a.ext.includes("gltf")||a.ext.includes("glb")),o=[];i>=0?(o.push(...s.Exporters[i].extensions??[]),s.Exporters.splice(i,1)):(o.push(lR),o.push(aR),o.push(oR),o.push(a=>new _r(a)),o.push(a=>new cR(a)),o.push(a=>new uR(a)),o.push(a=>new hR(a)),o.push(a=>new dR(a))),s.Exporters.push({ctor:()=>{const a=new t;return o.forEach(c=>a.register(c)),a.register(c=>({afterParse:u=>{var m,g;if(u=Array.isArray(u)?u[0]:u,!((m=u==null?void 0:u.userData)!=null&&m.rootSceneModelRoot)||((g=u==null?void 0:u.userData)==null?void 0:g.__exportViewerConfig)===!1)return;const d=c.json.scenes[c.json.scene||0];d.extensions||(d.extensions={}),d.extensions[ra]=WC(e,c),c.extensionsUsed[ra]=!0}})),n==null||n(a),a},ext:["gltf","glb"],extensions:o})}const oR=s=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const n={};e.shadow&&(n.shadow=e.shadow.toJSON()),Object.keys(n).length>0&&(t.extensions[sa]=n,s.extensionsUsed[sa]=!0)}}),aR=s=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const n={};e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.visible===!1&&(n.visible=!1),e.frustumCulled===!1&&(n.frustumCulled=!1),e.renderOrder!==0&&(n.renderOrder=e.renderOrder),e.layers.mask!==1&&(n.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),Object.keys(n).length>0&&(t.extensions[ka]=n,s.extensionsUsed[ka]=!0)}}),lR=s=>({writeMaterial(e,t){if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const n={};e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.side!==void 0&&e.side!==p.ehD&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(n.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.normalScale!==void 0&&(n.normalScale=[e.normalScale.x,e.normalScale.y]);const i=this.materialExternalResources[e.uuid];i&&Object.entries(i).forEach(([o,a])=>{var c;o.startsWith("_")||(a!=null&&a.userData&&(a.userData.__embedUrlImagePreviews=(c=s.options.exporterOptions)==null?void 0:c.embedUrlImagePreviews),n[o]=xi(a,!1,this.serializedMeta),a!=null&&a.userData&&delete a.userData.__embedUrlImagePreviews)}),Object.keys(n).length>0&&(t.extensions[oa]=n,s.extensionsUsed[oa]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!s.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(n=>{n==null||n.traverse(i=>{var o;i&&((o=i.material)!=null&&o.isMaterial)&&t.push(i.material)})}),t.forEach(n=>{n&&(this.materialExternalResources[n.uuid]||(this.materialExternalResources[n.uuid]={}),this.materialExternalResources[n.uuid].__materialRef=n,Object.entries(n).forEach(([i,o])=>{i.startsWith("_")||o&&o.isTexture&&o.userData.rootPath&&(o.userData.rootPath.startsWith("http")||o.userData.rootPath.startsWith("data:"))&&(n[i]=null,this.materialExternalResources[n.uuid][i]=o)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(i=>{const o=i.__materialRef;o&&(Object.entries(i).forEach(([a,c])=>{a.startsWith("_")||c&&(o[a]=c)}),delete this.materialExternalResources[o.uuid])});const n=s.json.scenes[s.json.scene||0];n.extensions||(n.extensions={}),n.extensions[oa]={resources:this.serializedMeta},s.extensionsUsed[oa]=!0}});class cR{constructor(e){this.writer=e,this.name=Od}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.bumpScale=e.bumpScale,e.bumpMap){const a={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(a,e.bumpMap),o.bumpTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class uR{constructor(e){this.writer=e,this.name=Ld}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.displacementScale=e.displacementScale,o.displacementBias=e.displacementBias,e.displacementMap){const a={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(a,e.displacementMap),o.displacementTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class hR{constructor(e){this.writer=e,this.name=no}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.lightMapIntensity=e.lightMapIntensity,e.lightMap){const a={index:n.processTexture(e.lightMap)};n.applyTextureTransform(a,e.lightMap),o.lightMapTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class dR{constructor(e){this.writer=e,this.name=kd}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,i=n.extensionsUsed,o={};if(e.alphaMap){const a={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(a,e.alphaMap),o.alphaTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}const pR=new TextEncoder;class fR{parse(e,t,n){if(!function(u,d){if(d.isWebGLRenderTarget&&(!u||!u.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!d||!d.isWebGLRenderTarget&&!d.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const m=d.isWebGLRenderTarget?d.texture:d;return m.type!==p.VzW&&m.type!==p.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):m.format===p.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,t))return;const i=function(u,d={}){const m=u.isTexture?u:u.texture,g=u.isWebGLRenderTarget?u.width:u.image.width,_=u.isWebGLRenderTarget?u.height:u.image.height,w=m.type,x=m.format,T=m.colorSpace,I=d.compression!==void 0?d.compression:3,R=(d.type!==void 0?d.type:p.cLu)===p.VzW?2:1,M={0:1,2:1,3:16}[I];return{width:g,height:_,type:w,format:x,colorSpace:T,compression:I,blockLines:M,dataType:R,dataSize:2*R,numBlocks:Math.ceil(_/M),numInputChannels:4,numOutputChannels:4,flipY:u.isDataTexture&&u.flipY,textureIndex:d.textureIndex||0}}(t,n),o=function(u,d,m){if(d.isDataTexture)return d.image.data;let g;return g=m.type===p.VzW?new Float32Array(m.width*m.height*m.numInputChannels):new Uint16Array(m.width*m.height*m.numInputChannels),u.readRenderTargetPixels(d,0,0,m.width,m.height,g,void 0,m.textureIndex),g}(e,t,i),a=function(u,d){const m=d.width,g=d.height,_={r:0,g:0,b:0,a:0},w={value:0},x=d.numOutputChannels==4?1:0,T=d.type==p.VzW?bR:AR,I=d.dataType==1?_R:HE,R=new Uint8Array(d.width*d.height*d.numOutputChannels*d.dataSize),M=new DataView(R.buffer);for(let C=0;C<g;++C)for(let L=0;L<m;++L){const k=C*m*4+4*L,j=T(u,k),H=T(u,k+1),X=T(u,k+2),ee=T(u,k+3),oe=(d.flipY?C:g-C-1)*m*(3+x)*d.dataSize;vR(_,j,H,X,ee),w.value=oe+L*d.dataSize,I(M,_.a,w),w.value=oe+x*m*d.dataSize+L*d.dataSize,I(M,_.b,w),w.value=oe+(1+x)*m*d.dataSize+L*d.dataSize,I(M,_.g,w),w.value=oe+(2+x)*m*d.dataSize+L*d.dataSize,I(M,_.r,w)}return R}(o,i),c=function(u,d){let m,g,_=0;const w={data:new Array,totalSize:0},x=d.width*d.numOutputChannels*d.blockLines*d.dataSize;switch(d.compression){case 0:m=mR;break;case 2:case 3:m=gR}d.compression!==0&&(g=new Uint8Array(x));for(let T=0;T<d.numBlocks;++T){const I=m(u.subarray(x*T,x*(T+1)),g);_+=I.length,w.data.push({dataChunk:I,size:I.length})}return w.totalSize=_,w}(a,i);return function(u,d){const m=8*d.numBlocks,g=259+18*d.numOutputChannels,_={value:g+m},w=new Uint8Array(g+m+u.totalSize+8*d.numBlocks),x=new DataView(w.buffer);(function(T,I,R){const M={value:0},C=new DataView(T.buffer);ir(C,20000630,M),ir(C,2,M),fo(C,"compression",M),fo(C,"compression",M),ir(C,1,M),vA(C,R.compression,M),fo(C,"screenWindowCenter",M),fo(C,"v2f",M),ir(C,8,M),ir(C,0,M),ir(C,0,M),fo(C,"screenWindowWidth",M),fo(C,"float",M),ir(C,4,M),HE(C,1,M),fo(C,"pixelAspectRatio",M),fo(C,"float",M),ir(C,4,M),HE(C,1,M),fo(C,"lineOrder",M),fo(C,"lineOrder",M),ir(C,1,M),vA(C,0,M),fo(C,"dataWindow",M),fo(C,"box2i",M),ir(C,16,M),ir(C,0,M),ir(C,0,M),ir(C,R.width-1,M),ir(C,R.height-1,M),fo(C,"displayWindow",M),fo(C,"box2i",M),ir(C,16,M),ir(C,0,M),ir(C,0,M),ir(C,R.width-1,M),ir(C,R.height-1,M),fo(C,"channels",M),fo(C,"chlist",M),ir(C,18*R.numOutputChannels+1,M),fo(C,"A",M),ir(C,R.dataType,M),M.value+=4,ir(C,1,M),ir(C,1,M),fo(C,"B",M),ir(C,R.dataType,M),M.value+=4,ir(C,1,M),ir(C,1,M),fo(C,"G",M),ir(C,R.dataType,M),M.value+=4,ir(C,1,M),ir(C,1,M),fo(C,"R",M),ir(C,R.dataType,M),M.value+=4,ir(C,1,M),ir(C,1,M),vA(C,0,M),vA(C,0,M);let L=M.value+8*R.numBlocks;for(let k=0;k<I.data.length;++k)yR(C,L,M),L+=I.data[k].size+8})(w,u,d);for(let T=0;T<u.data.length;++T){const I=u.data[T].dataChunk,R=u.data[T].size;ir(x,T*d.blockLines,_),ir(x,R,_),w.set(I,_.value),_.value+=R}return w}(c,i)}}function mR(s){return s}function gR(s,e){let t=0,n=Math.floor((s.length+1)/2),i=0;const o=s.length-1;for(;!(i>o||(e[t++]=s[i++],i>o));)e[n++]=s[i++];let a=e[0];for(let c=1;c<e.length;c++){const u=e[c]-a+384;a=e[c],e[c]=u}return function(c,u){u||(u={});var d=Wh();d.p(c);var m=I_(c,u,2,4);return uE(m,u),qy(m,m.length-4,d.d()),m}(e)}function vR(s,e,t,n,i){s.r=e,s.g=t,s.b=n,s.a=i}function vA(s,e,t){s.setUint8(t.value,e),t.value+=1}function ir(s,e,t){s.setUint32(t.value,e,!0),t.value+=4}function _R(s,e,t){s.setUint16(t.value,p.A5E.toHalfFloat(e),!0),t.value+=2}function HE(s,e,t){s.setFloat32(t.value,e,!0),t.value+=4}function yR(s,e,t){s.setBigUint64(t.value,BigInt(e),!0),t.value+=8}function fo(s,e,t){const n=pR.encode(e+"\0");for(let i=0;i<n.length;++i)vA(s,n[i],t)}function AR(s,e){return function(t){const n=(31744&t)>>10,i=1023&t;return(t>>15?-1:1)*(n?n===31?i?NaN:1/0:Math.pow(2,n-15)*(1+i/1024):i/1024*6103515625e-14)}(s[e])}function bR(s,e){return s[e]}class Kw extends fR{async parseAsync(e,t){const n=this.parse(e.renderer.rendererObject,e,t);return new Blob([n],{type:"image/x-exr"})}}class qC extends V.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find(t=>t.ext.some(n=>e.includes(n)))}constructor(e,t={}){super(),this._processors=new ta,this.Exporters=[{ctor:()=>new kC,ext:["json"]},{ctor:()=>new UC,ext:["txt","text"]},{ctor:()=>new Kw,ext:["exr"]}],this._cachedParsers=[],GE(this,e)}async exportObject(e,t={}){var o,a;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");(o=e==null?void 0:e.userData)!=null&&o.rootSceneModelRoot&&t.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const n=[];e.assetType==="model"&&e.modelObject.traverse(c=>{c.userData.excludeFromExport&&c.visible&&(c.visible=!1,n.push(c))});const i=await this._exportFile(e,t);return e.assetType==="model"&&n.forEach(c=>c.visible=!0),(a=e==null?void 0:e.userData)!=null&&a.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,i}async _exportFile(e,t={}){let n;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const i=await this.processBeforeExport(e,t),o=t.exportExt??(i==null?void 0:i.typeExt)??(i==null?void 0:i.ext);if(!i||!o)throw new Error(`Unable to preprocess before export ${o}`);const a=this._getParser(o);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const c=await a.parseAsync(i.obj,{exportExt:i.ext??o,...t});c.ext=i.ext,n=c}catch(i){return console.error("AssetExporter: Unable to Export file",e),console.error(i),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:i})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),n}_createParser(e){const t=this.Exporters.find(i=>i.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=t==null?void 0:t.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){var t;return((t=this._cachedParsers.find(n=>n.ext.includes(e)))==null?void 0:t.parser)??this._createParser(e)}async processBeforeExport(e,t={}){if(e.assetType!=null&&e.assetType!=="renderTarget"&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)==null||e.dispose()}}var _A;(function(s){s[s.EDGEBREAKER=1]="EDGEBREAKER",s[s.SEQUENTIAL=0]="SEQUENTIAL"})(_A||(_A={}));class nm extends En{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:_A.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new qC(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(t,n)=>{var i;return n.convertMeshToIndexed&&((i=t.modelObject)==null||i.traverse(o=>{var a;o.geometry&&(o.geometry.attributes.index||((a=o.setGeometry)==null||a.call(o,ri(o.geometry))))})),t}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,n;return(n=this.exporter)==null?void 0:n.exportObject((t=this._viewer)==null?void 0:t.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){var i,o;const n=(i=this._viewer)==null?void 0:i.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):(o=this._viewer)==null||o.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",n=>{var i;typeof((i=n.plugin)==null?void 0:i.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([n,i])=>typeof(i==null?void 0:i.toJSON)=="function"&&(i==null?void 0:i.serializeWithViewer)!==!1).map(([n,i])=>({label:n,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(_A).map(([n,i])=>({label:n,value:i}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(n=>({label:n}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(n=>({type:"slider",label:n,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,n]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(n=>{var i;n.value=!1,(i=n.uiRefresh)==null||i.call(n)})}},{type:"button",label:"Select all",value:()=>{t.forEach(n=>{var i;n.value=!0,(i=n.uiRefresh)==null||i.call(n)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(Qt).exportPluginPresets(t.filter(i=>!!i.value).map(i=>(0,V.getOrCall)(i.label)||"")),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+Qt.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(Qt).exportViewerConfig(!1),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+Qt.ViewerTypeSlug)}}]}]}}}nm.PluginType="AssetExporterPlugin",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([Ae()],nm.prototype,"exportOptions",void 0);class QE{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners[e];if(n!==void 0){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){const n=t.slice(0);for(let i=0,o=n.length;i<o;i++)n[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class j_ extends QE{constructor(e,t,n,i={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=i,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class wR extends QE{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter(i=>t(i.getParent()))),n.forEach(i=>i.dispose()),this}createEdge(e,t,n,i){return this._registerEdge(new j_(e,t,n,i))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function yA(){return yA=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},yA.apply(this,arguments)}function WE(s){return s instanceof j_}function AA(s){return Array.isArray(s)&&s[0]instanceof j_}function bA(s){return!!(function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype}(s)&&function(e){for(const t in e)return e[t]}(s)instanceof j_)}const Pr=Symbol("attributes"),z_=Symbol("immutableKeys");class qE extends QE{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Pr]=void 0,this[z_]=void 0,this.graph=e,this[z_]=new Set,this[Pr]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const i=e[n];if(i instanceof qE){const o=this.graph.createEdge(n,this,i);o.addEventListener("dispose",()=>i.dispose()),this[z_].add(n),t[n]=o}else t[n]=i}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[Pr]){const i=this[Pr][n];if(WE(i)){const o=i;o.getChild()===e&&this.setRef(n,t,o.getAttributes())}else if(AA(i)){const o=i.find(a=>a.getChild()===e);if(o){const a=o.getAttributes();this.removeRef(n,e).addRef(n,t,a)}}else if(bA(i)){const o=i;for(const a in o){const c=o[a];c.getChild()===e&&this.setRefMap(n,a,t,c.getAttributes())}}}return this}get(e){return this[Pr][e]}set(e,t){return this[Pr][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[Pr][e];return t?t.getChild():null}setRef(e,t,n){if(this[z_].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const i=this[Pr][e];if(i&&i.dispose(),!t)return this;const o=this.graph.createEdge(e,this,t,n);return o.addEventListener("dispose",()=>{delete this[Pr][e],this.dispatchEvent({type:"change",attribute:e})}),this[Pr][e]=o,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Pr][e].map(t=>t.getChild())}addRef(e,t,n){const i=this.graph.createEdge(e,this,t,n),o=this[Pr][e];return o.push(i),i.addEventListener("dispose",()=>{const a=o.filter(c=>c!==i);o.length=0;for(const c of a)o.push(c);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[Pr][e].filter(n=>n.getChild()===t).forEach(n=>n.dispose()),this}listRefMapKeys(e){return Object.keys(this[Pr][e])}listRefMapValues(e){return Object.values(this[Pr][e]).map(t=>t.getChild())}getRefMap(e,t){const n=this[Pr][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,i){const o=this[Pr][e],a=o[t];if(a&&a.dispose(),!n)return this;i=Object.assign(i||{},{key:t});const c=this.graph.createEdge(e,this,n,yA({},i,{key:t}));return c.addEventListener("dispose",()=>{delete o[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),o[t]=c,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(yA({},e,{target:this})),this.graph.dispatchEvent(yA({},e,{target:this,type:`node:${e.type}`})),this}}const XC="@glb.bin";var pn,Jw,Tc,Ps,Kg;(function(s){s.ACCESSOR="Accessor",s.ANIMATION="Animation",s.ANIMATION_CHANNEL="AnimationChannel",s.ANIMATION_SAMPLER="AnimationSampler",s.BUFFER="Buffer",s.CAMERA="Camera",s.MATERIAL="Material",s.MESH="Mesh",s.PRIMITIVE="Primitive",s.PRIMITIVE_TARGET="PrimitiveTarget",s.NODE="Node",s.ROOT="Root",s.SCENE="Scene",s.SKIN="Skin",s.TEXTURE="Texture",s.TEXTURE_INFO="TextureInfo"})(pn||(pn={})),function(s){s.INTERLEAVED="interleaved",s.SEPARATE="separate"}(Jw||(Jw={})),function(s){s.ARRAY_BUFFER="ARRAY_BUFFER",s.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",s.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",s.OTHER="OTHER",s.SPARSE="SPARSE"}(Tc||(Tc={})),function(s){s[s.R=4096]="R",s[s.G=256]="G",s[s.B=16]="B",s[s.A=1]="A"}(Ps||(Ps={})),function(s){s.GLTF="GLTF",s.GLB="GLB"}(Kg||(Kg={}));const Zw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var $w,XE,YE=typeof Float32Array<"u"?Float32Array:Array;function KE(s){return Math.hypot(s[0],s[1],s[2])}function xR(s,e,t){var n=e[0],i=e[1],o=e[2],a=t[3]*n+t[7]*i+t[11]*o+t[15];return s[0]=(t[0]*n+t[4]*i+t[8]*o+t[12])/(a=a||1),s[1]=(t[1]*n+t[5]*i+t[9]*o+t[13])/a,s[2]=(t[2]*n+t[6]*i+t[10]*o+t[14])/a,s}function ER(s,e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of s.listPrimitives()){const i=n.getAttribute("POSITION");if(!i)continue;let o=[0,0,0],a=[0,0,0];for(let c=0;c<i.getCount();c++)o=i.getElement(c,o),a=xR(a,o,e),JE(a,t)}return t}function JE(s,e){for(let t=0;t<3;t++)e.min[t]=Math.min(s[t],e.min[t]),e.max[t]=Math.max(s[t],e.max[t])}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)}),$w=new YE(3),YE!=Float32Array&&($w[0]=0,$w[1]=0,$w[2]=0);class Li{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const o of e)t+=o.byteLength;const n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const i=new Uint8Array(n);if(i.set(e),t!==0)for(let o=e.byteLength;o<n;o++)i[o]=t;return i}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Ql{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,i,o]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*i<<8^255*o<<0}static convertSRGBToLinear(e,t){const n=e,i=t;for(let o=0;o<3;o++)i[o]=n[o]<.04045?.0773993808*n[o]:Math.pow(.9478672986*n[o]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,i=t;for(let o=0;o<3;o++)i[o]=n[o]<.0031308?12.92*n[o]:1.055*Math.pow(n[o],.41666)-.055;return t}}class ex{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Li.decodeText(e.slice(12,16))===ex.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}ex.PNG_FRIED_CHUNK_NAME="CgBI";class nd{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)n+=i[0]*i[1]*4,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function SR(s,e){if(e>s.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(s.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return s}nd.impls={"image/jpeg":new class{match(s){return s.length>=3&&s[0]===255&&s[1]===216&&s[2]===255}getSize(s){let e,t,n=new DataView(s.buffer,s.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),SR(n,e),t=n.getUint8(e+1),t===192||t===193||t===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(s.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(s){return 3}},"image/png":new ex};class V_{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return nd.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function YC(s){return Object.prototype.toString.call(s)==="[object Object]"}function Jg(s){if(YC(s)===!1)return!1;const e=s.constructor;if(e===void 0)return!0;const t=e.prototype;return YC(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}(function(s){s[s.SILENT=4]="SILENT",s[s.ERROR=3]="ERROR",s[s.WARN=2]="WARN",s[s.INFO=1]="INFO",s[s.DEBUG=0]="DEBUG"})(XE||(XE={}));class Ic{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Ic.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Ic.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Ic.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Ic.Verbosity.ERROR&&console.error(e)}}function CR(s,e,t){var n=e[0],i=e[1],o=e[2],a=e[3],c=e[4],u=e[5],d=e[6],m=e[7],g=e[8],_=e[9],w=e[10],x=e[11],T=e[12],I=e[13],R=e[14],M=e[15],C=t[0],L=t[1],k=t[2],j=t[3];return s[0]=C*n+L*c+k*g+j*T,s[1]=C*i+L*u+k*_+j*I,s[2]=C*o+L*d+k*w+j*R,s[3]=C*a+L*m+k*x+j*M,s[4]=(C=t[4])*n+(L=t[5])*c+(k=t[6])*g+(j=t[7])*T,s[5]=C*i+L*u+k*_+j*I,s[6]=C*o+L*d+k*w+j*R,s[7]=C*a+L*m+k*x+j*M,s[8]=(C=t[8])*n+(L=t[9])*c+(k=t[10])*g+(j=t[11])*T,s[9]=C*i+L*u+k*_+j*I,s[10]=C*o+L*d+k*w+j*R,s[11]=C*a+L*m+k*x+j*M,s[12]=(C=t[12])*n+(L=t[13])*c+(k=t[14])*g+(j=t[15])*T,s[13]=C*i+L*u+k*_+j*I,s[14]=C*o+L*d+k*w+j*R,s[15]=C*a+L*m+k*x+j*M,s}Ic.Verbosity=XE,Ic.DEFAULT_INSTANCE=new Ic(Ic.Verbosity.INFO);class Hr{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(Math.abs(e[i]-t[i])>n)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return Hr.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return Hr.encodeNormalizedInt(e,t)}static decompose(e,t,n,i){let o=KE([e[0],e[1],e[2]]);const a=KE([e[4],e[5],e[6]]),c=KE([e[8],e[9],e[10]]);var u,d,m,g,_,w,x,T,I,R,M,C,L,k,j,H,X;((d=(u=e)[0])*(x=u[5])-(m=u[1])*(w=u[4]))*((C=u[10])*(X=u[15])-(L=u[11])*(H=u[14]))-(d*(T=u[6])-(g=u[2])*w)*((M=u[9])*X-L*(j=u[13]))+(d*(I=u[7])-(_=u[3])*w)*(M*H-C*j)+(m*T-g*x)*((R=u[8])*X-L*(k=u[12]))-(m*I-_*x)*(R*H-C*k)+(g*I-_*T)*(R*j-M*k)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];const ee=e.slice(),oe=1/o,re=1/a,he=1/c;ee[0]*=oe,ee[1]*=oe,ee[2]*=oe,ee[4]*=re,ee[5]*=re,ee[6]*=re,ee[8]*=he,ee[9]*=he,ee[10]*=he,function(le,ue){var ge=new YE(3);(function(Gn,gt){var zt=gt[4],an=gt[5],ui=gt[6],Ri=gt[8],_i=gt[9],ni=gt[10];Gn[0]=Math.hypot(gt[0],gt[1],gt[2]),Gn[1]=Math.hypot(zt,an,ui),Gn[2]=Math.hypot(Ri,_i,ni)})(ge,ue);var _e=1/ge[0],Ee=1/ge[1],Ye=1/ge[2],We=ue[0]*_e,Et=ue[1]*Ee,lt=ue[2]*Ye,rt=ue[4]*_e,kt=ue[5]*Ee,Pt=ue[6]*Ye,sn=ue[8]*_e,hn=ue[9]*Ee,wn=ue[10]*Ye,Xn=We+kt+wn,zn=0;Xn>0?(zn=2*Math.sqrt(Xn+1),le[3]=.25*zn,le[0]=(Pt-hn)/zn,le[1]=(sn-lt)/zn,le[2]=(Et-rt)/zn):We>kt&&We>wn?(zn=2*Math.sqrt(1+We-kt-wn),le[3]=(Pt-hn)/zn,le[0]=.25*zn,le[1]=(Et+rt)/zn,le[2]=(sn+lt)/zn):kt>wn?(zn=2*Math.sqrt(1+kt-We-wn),le[3]=(sn-lt)/zn,le[0]=(Et+rt)/zn,le[1]=.25*zn,le[2]=(Pt+hn)/zn):(zn=2*Math.sqrt(1+wn-We-kt),le[3]=(Et-rt)/zn,le[0]=(sn+lt)/zn,le[1]=(Pt+hn)/zn,le[2]=.25*zn)}(n,ee),i[0]=o,i[1]=a,i[2]=c}static compose(e,t,n,i){const o=i,a=t[0],c=t[1],u=t[2],d=t[3],m=a+a,g=c+c,_=u+u,w=a*m,x=a*g,T=a*_,I=c*g,R=c*_,M=u*_,C=d*m,L=d*g,k=d*_,j=n[0],H=n[1],X=n[2];return o[0]=(1-(I+M))*j,o[1]=(x+k)*j,o[2]=(T-L)*j,o[3]=0,o[4]=(x-k)*H,o[5]=(1-(w+M))*H,o[6]=(R+C)*H,o[7]=0,o[8]=(T+L)*X,o[9]=(R-C)*X,o[10]=(1-(w+I))*X,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}}function MR(s,e){if(!!s!=!!e)return!1;const t=s.getChild(),n=e.getChild();return t===n||t.equals(n)}function TR(s,e){if(!!s!=!!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++){const n=s[t],i=e[t];if(n.getChild()!==i.getChild()&&!n.getChild().equals(i.getChild()))return!1}return!0}function IR(s,e){if(!!s!=!!e)return!1;const t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(const i in s){const o=s[i],a=e[i];if(!!o!=!!a)return!1;const c=o.getChild(),u=a.getChild();if(c!==u&&!c.equals(u))return!1}return!0}function KC(s,e){if(s===e)return!0;if(!!s!=!!e||!s||!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function JC(s,e){if(s===e)return!0;if(!!s!=!!e)return!1;if(!Jg(s)||!Jg(e))return s===e;const t=s,n=e;let i,o=0,a=0;for(i in t)o++;for(i in n)a++;if(o!==a)return!1;for(i in t){const c=t[i],u=n[i];if(tx(c)&&tx(u)){if(!KC(c,u))return!1}else if(Jg(c)&&Jg(u)){if(!JC(c,u))return!1}else if(c!==u)return!1}return!0}function tx(s){return Array.isArray(s)||ArrayBuffer.isView(s)}const ZC="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",$C=new Set,PR=function(){let s="";for(let e=0;e<6;e++)s+=ZC.charAt(Math.floor(Math.random()*ZC.length));return s};class wA{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return V_.basename(new URL(e,"https://null.example").pathname)}static extension(e){return V_.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),i=t.split("/");n.pop();for(let o=0;o<i.length;o++)i[o]!=="."&&(i[o]===".."?n.pop():n.push(i[o]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}wA.DEFAULT_INIT={},wA.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const wp=s=>s,RR=new Set;class ZE extends qE{constructor(e,t=""){super(e),this[Pr].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,wp)}copy(e,t=wp){for(const n in this[Pr]){const i=this[Pr][n];if(i instanceof j_)this[z_].has(n)||i.dispose();else if(AA(i))for(const o of i)o.dispose();else if(bA(i))for(const o in i)i[o].dispose()}for(const n in e[Pr]){const i=this[Pr][n],o=e[Pr][n];if(o instanceof j_)this[z_].has(n)?i.getChild().copy(t(o.getChild()),t):this.setRef(n,t(o.getChild()),o.getAttributes());else if(AA(o))for(const a of o)this.addRef(n,t(a.getChild()),a.getAttributes());else if(bA(o))for(const a in o){const c=o[a];this.setRefMap(n,a,t(c.getChild()),c.getAttributes())}else this[Pr][n]=Jg(o)?JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?o.slice():o}return this}equals(e,t=RR){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[Pr]){if(t.has(n))continue;const i=this[Pr][n],o=e[Pr][n];if(WE(i)||WE(o)){if(!MR(i,o))return!1}else if(AA(i)||AA(o)){if(!TR(i,o))return!1}else if(bA(i)||bA(o)){if(!IR(i,o))return!1}else if(Jg(i)||Jg(o)){if(!JC(i,o))return!1}else if(tx(i)||tx(o)){if(!KC(i,o))return!1}else if(i!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class dl extends ZE{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class Rn extends dl{constructor(...e){super(...e),this.i=Hr.identity,this.o=Hr.identity}init(){this.propertyType=pn.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Rn.Type.SCALAR,componentType:Rn.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=wp){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Rn.Type.SCALAR:return 1;case Rn.Type.VEC2:return 2;case Rn.Type.VEC3:return 3;case Rn.Type.VEC4:case Rn.Type.MAT2:return 4;case Rn.Type.MAT3:return 9;case Rn.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Rn.ComponentType.BYTE:case Rn.ComponentType.UNSIGNED_BYTE:return 1;case Rn.ComponentType.SHORT:case Rn.ComponentType.UNSIGNED_SHORT:return 2;case Rn.ComponentType.UNSIGNED_INT:case Rn.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let o=0;o<i;o++)e[o]=1/0;for(let o=0;o<n*i;o+=i)for(let a=0;a<i;a++){const c=t[o+a];Number.isFinite(c)&&(e[a]=Math.min(e[a],c))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let o=0;o<i;o++)e[o]=-1/0;for(let o=0;o<n*i;o+=i)for(let a=0;a<i;a++){const c=t[o+a];Number.isFinite(c)&&(e[a]=Math.max(e[a],c))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Rn.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>Hr.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>Hr.encodeNormalizedInt(t,this.get("componentType"))):(this.o=Hr.identity,this.i=Hr.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let o=0;o<n;o++)t[o]=this.o(i[e*n+o]);return t}setElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let o=0;o<n;o++)i[e*n+o]=this.i(t[o]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return Rn.ComponentType.FLOAT;case Uint32Array:return Rn.ComponentType.UNSIGNED_INT;case Uint16Array:return Rn.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Rn.ComponentType.UNSIGNED_BYTE;case Int16Array:return Rn.ComponentType.SHORT;case Int8Array:return Rn.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Rn.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}Rn.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},Rn.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class eM extends dl{init(){this.propertyType=pn.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class $E extends dl{init(){this.propertyType=pn.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}$E.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class G_ extends dl{init(){this.propertyType=pn.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:G_.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Tc.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Tc.OTHER})}}G_.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class tM extends dl{init(){this.propertyType=pn.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Zg extends dl{init(){this.propertyType=pn.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Zg.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Zg.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class js extends ZE{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}js.EXTENSION_NAME=void 0;class Qr extends dl{init(){this.propertyType=pn.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Qr.WrapMode.REPEAT,wrapT:Qr.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Qr.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Qr.MagFilter={NEAREST:9728,LINEAR:9729},Qr.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:nx,G:ix,B:rx,A:DR}=Ps;class $g extends dl{init(){this.propertyType=pn.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:$g.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Qr(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Qr(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Qr(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Qr(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Qr(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Ql.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Ql.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:nx|ix|rx|DR})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Ql.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Ql.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:nx|ix|rx})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:nx|ix|rx})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:nx})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:ix|rx})}}$g.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class nM extends dl{init(){this.propertyType=pn.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class iM extends dl{constructor(...e){super(...e),this.u=null}init(){this.propertyType=pn.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=wp){if(t===wp)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Hr.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),i=this.get("scale").slice();return Hr.decompose(e,t,n,i),this.set("translation",t).set("rotation",n).set("scale",i)}getWorldTranslation(){const e=[0,0,0];return Hr.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Hr.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Hr.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let i=this;i!=null;i=i.u)e.push(i);let t;const n=e.pop().getMatrix();for(;t=e.pop();)CR(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[Pr].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===pn.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class ev extends dl{init(){this.propertyType=pn.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:ev.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Tc.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Tc.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}ev.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class BR extends ZE{init(){this.propertyType=pn.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Tc.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Wl(){return(Wl=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s}).apply(this,arguments)}class rM extends dl{init(){this.propertyType=pn.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=wp){if(t===wp)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class sM extends dl{init(){this.propertyType=pn.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Tc.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class oM extends dl{init(){this.propertyType=pn.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||nd.extensionToMimeType(V_.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=nd.extensionToMimeType(V_.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Li.assertView(e))}getSize(){const e=this.get("image");return e?nd.getSize(e,this.getMimeType()):null}}class aM extends dl{init(){this.propertyType=pn.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",t=>{this.l(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=wp){if(t===wp)throw new Error("Root cannot be copied.");this.set("asset",Wl({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Wl({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const i=e.getExtension(n);this.setExtension(n,t(i))}return this}l(e){return e instanceof rM?this.addRef("scenes",e):e instanceof iM?this.addRef("nodes",e):e instanceof Zg?this.addRef("cameras",e):e instanceof sM?this.addRef("skins",e):e instanceof nM?this.addRef("meshes",e):e instanceof $g?this.addRef("materials",e):e instanceof oM?this.addRef("textures",e):e instanceof eM?this.addRef("animations",e):e instanceof Rn?this.addRef("accessors",e):e instanceof tM&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class H_{static fromGraph(e){return H_.m.get(e)||null}constructor(){this.v=new wR,this.T=new aM(this.v),this.M=Ic.DEFAULT_INSTANCE,H_.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new H_().setLogger(this.M).merge(this)}merge(e){for(const o of e.getRoot().listExtensionsUsed()){const a=this.createExtension(o.constructor);o.isRequired()&&a.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const o of e.v.listEdges())for(const a of[o.getParent(),o.getChild()]){if(t.has(a))continue;let c;c=a.propertyType===pn.TEXTURE_INFO?a:new a.constructor(this.v),n.set(a,c),t.add(a)}const i=o=>{const a=n.get(o);if(!a)throw new Error("Could resolve property.");return a};for(const o of t){const a=n.get(o);if(!a)throw new Error("Could resolve property.");a.propertyType!==pn.TEXTURE_INFO&&a.copy(o,i)}return this}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new rM(this.v,e)}createNode(e=""){return new iM(this.v,e)}createCamera(e=""){return new Zg(this.v,e)}createSkin(e=""){return new sM(this.v,e)}createMesh(e=""){return new nM(this.v,e)}createPrimitive(){return new ev(this.v)}createPrimitiveTarget(e=""){return new BR(this.v,e)}createMaterial(e=""){return new $g(this.v,e)}createTexture(e=""){return new oM(this.v,e)}createAnimation(e=""){return new eM(this.v,e)}createAnimationChannel(e=""){return new $E(this.v,e)}createAnimationSampler(e=""){return new G_(this.v,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new Rn(this.v,e).setBuffer(t)}createBuffer(e=""){return new tM(this.v,e)}}H_.m=new WeakMap;class Zr{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=n=>{const i=n,o=i.target;o instanceof js&&o.extensionName===this.extensionName&&(i.type==="node:create"&&this.I(o),i.type==="node:dispose"&&this.N(o))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Zr.EXTENSION_NAME=void 0;class OR{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const i=this.jsonDoc.json.samplers[n.sampler];i.magFilter!==void 0&&e.setMagFilter(i.magFilter),i.minFilter!==void 0&&e.setMinFilter(i.minFilter),i.wrapS!==void 0&&e.setWrapS(i.wrapS),i.wrapT!==void 0&&e.setWrapT(i.wrapT)}}const lM={logger:Ic.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function sx(s,e){const t=e.bufferViews[s.bufferView],n=e.jsonDoc.json.bufferViews[s.bufferView],i=Zw[s.componentType],o=Rn.getElementSize(s.type),a=i.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==o*a)return function(u,d){const m=d.bufferViews[u.bufferView],g=d.jsonDoc.json.bufferViews[u.bufferView],_=Zw[u.componentType],w=Rn.getElementSize(u.type),x=_.BYTES_PER_ELEMENT,T=u.byteOffset||0,I=new _(u.count*w),R=new DataView(m.buffer,m.byteOffset,m.byteLength),M=g.byteStride;for(let C=0;C<u.count;C++)for(let L=0;L<w;L++){const k=T+C*M+L*x;let j;switch(u.componentType){case Rn.ComponentType.FLOAT:j=R.getFloat32(k,!0);break;case Rn.ComponentType.UNSIGNED_INT:j=R.getUint32(k,!0);break;case Rn.ComponentType.UNSIGNED_SHORT:j=R.getUint16(k,!0);break;case Rn.ComponentType.UNSIGNED_BYTE:j=R.getUint8(k);break;case Rn.ComponentType.SHORT:j=R.getInt16(k,!0);break;case Rn.ComponentType.BYTE:j=R.getInt8(k);break;default:throw new Error(`Unexpected componentType "${u.componentType}".`)}I[C*w+L]=j}return I}(s,e);const c=t.byteOffset+(s.byteOffset||0);return new i(t.buffer.slice(c,c+s.count*o*a))}var xA;(function(s){s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(xA||(xA={}));class id{constructor(e,t,n){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=t,this.options=n;const i=e.getRoot(),o=i.listBuffers().length,a=i.listTextures().length;this.bufferURIGenerator=new cM(o>1,()=>n.basename||"buffer"),this.imageURIGenerator=new cM(a>1,c=>function(u,d){const m=u.getGraph().listParentEdges(d).find(g=>g.getParent()!==u.getRoot());return m?m.getName().replace(/texture$/i,""):""}(e,c)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},i=JSON.stringify(n);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const o={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(i)},a=JSON.stringify(o);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(o));const c={index:this.textureDefIndexMap.get(a)};return t.getTexCoord()!==0&&(c.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(c.extras=t.getExtras()),this.textureInfoDefMap.set(t,c),c}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===Kg.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const i=nd.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,i),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.C.get(e);if(t)return t;if(e.getSparse())return Tc.SPARSE;for(const n of this.O.getGraph().listParentEdges(e)){const{usage:i}=n.getAttributes();if(i)return i;n.getParent().propertyType!==pn.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Tc.OTHER}addAccessorToUsageGroup(e,t){const n=this.C.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.C.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.C.entries()))e[n]=e[n]||[],e[n].push(t);return e}}id.BufferViewTarget=xA,id.BufferViewUsage=Tc,id.USAGE_TO_TARGET={[Tc.ARRAY_BUFFER]:xA.ARRAY_BUFFER,[Tc.ELEMENT_ARRAY_BUFFER]:xA.ELEMENT_ARRAY_BUFFER};class cM{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:ox}=id,{UNSIGNED_INT:LR,UNSIGNED_SHORT:kR,UNSIGNED_BYTE:UR}=Rn.ComponentType;var ax;(function(s){s[s.JSON=1313821514]="JSON",s[s.BIN=5130562]="BIN"})(ax||(ax={}));class NR{constructor(){this.M=Ic.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=Jw.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=uM(t)?this.P(t):{json:JSON.parse(Li.decodeText(t)),resources:{}};return await this.L(n,this.dirname(e)),this.j(n),n}async readJSON(e){return e=this.D(e),this.j(e),(class{static read(t,n=lM){const i=Wl({},lM,n),{json:o}=t,a=new H_().setLogger(i.logger);this.validate(t,i);const c=new OR(t),u=o.asset,d=a.getRoot().getAsset();u.copyright&&(d.copyright=u.copyright),u.extras&&(d.extras=u.extras),o.extras!==void 0&&a.getRoot().setExtras(Wl({},o.extras));const m=o.extensionsUsed||[],g=o.extensionsRequired||[];for(const C of i.extensions)if(m.includes(C.EXTENSION_NAME)){const L=a.createExtension(C).setRequired(g.includes(C.EXTENSION_NAME));for(const k of L.readDependencies)L.install(k,i.dependencies[k])}const _=o.buffers||[];a.getRoot().listExtensionsUsed().filter(C=>C.prereadTypes.includes(pn.BUFFER)).forEach(C=>C.preread(c,pn.BUFFER)),c.buffers=_.map(C=>{const L=a.createBuffer(C.name);return C.extras&&L.setExtras(C.extras),C.uri&&C.uri.indexOf("__")!==0&&L.setURI(C.uri),L}),c.bufferViewBuffers=(o.bufferViews||[]).map((C,L)=>{if(!c.bufferViews[L]){const k=t.json.buffers[C.buffer];c.bufferViews[L]=Li.toView(k.uri?t.resources[k.uri]:t.resources["@glb.bin"],C.byteOffset||0,C.byteLength)}return c.buffers[C.buffer]});const w=o.accessors||[];c.accessors=w.map(C=>{const L=a.createAccessor(C.name,c.bufferViewBuffers[C.bufferView]).setType(C.type);return C.extras&&L.setExtras(C.extras),C.normalized!==void 0&&L.setNormalized(C.normalized),C.bufferView===void 0||L.setArray(sx(C,c)),L});const x=o.images||[],T=o.textures||[];a.getRoot().listExtensionsUsed().filter(C=>C.prereadTypes.includes(pn.TEXTURE)).forEach(C=>C.preread(c,pn.TEXTURE)),c.textures=x.map(C=>{const L=a.createTexture(C.name);if(C.extras&&L.setExtras(C.extras),C.bufferView!==void 0){const k=o.bufferViews[C.bufferView],j=t.json.buffers[k.buffer],H=k.byteOffset||0,X=(j.uri?t.resources[j.uri]:t.resources["@glb.bin"]).slice(H,H+k.byteLength);L.setImage(X)}else C.uri!==void 0&&(L.setImage(t.resources[C.uri]),C.uri.indexOf("__")!==0&&L.setURI(C.uri));if(C.mimeType!==void 0)L.setMimeType(C.mimeType);else if(C.uri){const k=V_.extension(C.uri);L.setMimeType(nd.extensionToMimeType(k))}return L}),c.materials=(o.materials||[]).map(C=>{const L=a.createMaterial(C.name);C.extras&&L.setExtras(C.extras),C.alphaMode!==void 0&&L.setAlphaMode(C.alphaMode),C.alphaCutoff!==void 0&&L.setAlphaCutoff(C.alphaCutoff),C.doubleSided!==void 0&&L.setDoubleSided(C.doubleSided);const k=C.pbrMetallicRoughness||{};if(k.baseColorFactor!==void 0&&L.setBaseColorFactor(k.baseColorFactor),C.emissiveFactor!==void 0&&L.setEmissiveFactor(C.emissiveFactor),k.metallicFactor!==void 0&&L.setMetallicFactor(k.metallicFactor),k.roughnessFactor!==void 0&&L.setRoughnessFactor(k.roughnessFactor),k.baseColorTexture!==void 0){const j=k.baseColorTexture;L.setBaseColorTexture(c.textures[T[j.index].source]),c.setTextureInfo(L.getBaseColorTextureInfo(),j)}if(C.emissiveTexture!==void 0){const j=C.emissiveTexture;L.setEmissiveTexture(c.textures[T[j.index].source]),c.setTextureInfo(L.getEmissiveTextureInfo(),j)}if(C.normalTexture!==void 0){const j=C.normalTexture;L.setNormalTexture(c.textures[T[j.index].source]),c.setTextureInfo(L.getNormalTextureInfo(),j),C.normalTexture.scale!==void 0&&L.setNormalScale(C.normalTexture.scale)}if(C.occlusionTexture!==void 0){const j=C.occlusionTexture;L.setOcclusionTexture(c.textures[T[j.index].source]),c.setTextureInfo(L.getOcclusionTextureInfo(),j),C.occlusionTexture.strength!==void 0&&L.setOcclusionStrength(C.occlusionTexture.strength)}if(k.metallicRoughnessTexture!==void 0){const j=k.metallicRoughnessTexture;L.setMetallicRoughnessTexture(c.textures[T[j.index].source]),c.setTextureInfo(L.getMetallicRoughnessTextureInfo(),j)}return L});const I=o.meshes||[];a.getRoot().listExtensionsUsed().filter(C=>C.prereadTypes.includes(pn.PRIMITIVE)).forEach(C=>C.preread(c,pn.PRIMITIVE)),c.meshes=I.map(C=>{const L=a.createMesh(C.name);return C.extras&&L.setExtras(C.extras),C.weights!==void 0&&L.setWeights(C.weights),(C.primitives||[]).forEach(k=>{const j=a.createPrimitive();k.extras&&j.setExtras(k.extras),k.material!==void 0&&j.setMaterial(c.materials[k.material]),k.mode!==void 0&&j.setMode(k.mode);for(const[X,ee]of Object.entries(k.attributes||{}))j.setAttribute(X,c.accessors[ee]);k.indices!==void 0&&j.setIndices(c.accessors[k.indices]);const H=C.extras&&C.extras.targetNames||[];(k.targets||[]).forEach((X,ee)=>{const oe=H[ee]||ee.toString(),re=a.createPrimitiveTarget(oe);for(const[he,le]of Object.entries(X))re.setAttribute(he,c.accessors[le]);j.addTarget(re)}),L.addPrimitive(j)}),L}),c.cameras=(o.cameras||[]).map(C=>{const L=a.createCamera(C.name).setType(C.type);if(C.extras&&L.setExtras(C.extras),C.type===Zg.Type.PERSPECTIVE){const k=C.perspective;L.setYFov(k.yfov),L.setZNear(k.znear),k.zfar!==void 0&&L.setZFar(k.zfar),k.aspectRatio!==void 0&&L.setAspectRatio(k.aspectRatio)}else{const k=C.orthographic;L.setZNear(k.znear).setZFar(k.zfar).setXMag(k.xmag).setYMag(k.ymag)}return L});const R=o.nodes||[];a.getRoot().listExtensionsUsed().filter(C=>C.prereadTypes.includes(pn.NODE)).forEach(C=>C.preread(c,pn.NODE)),c.nodes=R.map(C=>{const L=a.createNode(C.name);if(C.extras&&L.setExtras(C.extras),C.translation!==void 0&&L.setTranslation(C.translation),C.rotation!==void 0&&L.setRotation(C.rotation),C.scale!==void 0&&L.setScale(C.scale),C.matrix!==void 0){const k=[0,0,0],j=[0,0,0,1],H=[1,1,1];Hr.decompose(C.matrix,k,j,H),L.setTranslation(k),L.setRotation(j),L.setScale(H)}return C.weights!==void 0&&L.setWeights(C.weights),L}),c.skins=(o.skins||[]).map(C=>{const L=a.createSkin(C.name);C.extras&&L.setExtras(C.extras),C.inverseBindMatrices!==void 0&&L.setInverseBindMatrices(c.accessors[C.inverseBindMatrices]),C.skeleton!==void 0&&L.setSkeleton(c.nodes[C.skeleton]);for(const k of C.joints)L.addJoint(c.nodes[k]);return L}),R.map((C,L)=>{const k=c.nodes[L];(C.children||[]).forEach(j=>k.addChild(c.nodes[j])),C.mesh!==void 0&&k.setMesh(c.meshes[C.mesh]),C.camera!==void 0&&k.setCamera(c.cameras[C.camera]),C.skin!==void 0&&k.setSkin(c.skins[C.skin])}),c.animations=(o.animations||[]).map(C=>{const L=a.createAnimation(C.name);C.extras&&L.setExtras(C.extras);const k=(C.samplers||[]).map(j=>{const H=a.createAnimationSampler().setInput(c.accessors[j.input]).setOutput(c.accessors[j.output]).setInterpolation(j.interpolation||G_.Interpolation.LINEAR);return j.extras&&H.setExtras(j.extras),L.addSampler(H),H});return(C.channels||[]).forEach(j=>{const H=a.createAnimationChannel().setSampler(k[j.sampler]).setTargetPath(j.target.path);j.target.node!==void 0&&H.setTargetNode(c.nodes[j.target.node]),j.extras&&H.setExtras(j.extras),L.addChannel(H)}),L});const M=o.scenes||[];return a.getRoot().listExtensionsUsed().filter(C=>C.prereadTypes.includes(pn.SCENE)).forEach(C=>C.preread(c,pn.SCENE)),c.scenes=M.map(C=>{const L=a.createScene(C.name);return C.extras&&L.setExtras(C.extras),(C.nodes||[]).map(k=>c.nodes[k]).forEach(k=>L.addChild(k)),L}),o.scene!==void 0&&a.getRoot().setDefaultScene(c.scenes[o.scene]),a.getRoot().listExtensionsUsed().forEach(C=>C.read(c)),w.forEach((C,L)=>{const k=c.accessors[L],j=!!C.sparse,H=!C.bufferView&&!k.getArray();(j||H)&&k.setSparse(!0).setArray(function(X,ee){const oe=Zw[X.componentType],re=Rn.getElementSize(X.type);let he;he=X.bufferView!==void 0?sx(X,ee):new oe(X.count*re);const le=X.sparse;if(!le)return he;const ue=le.count,ge=Wl({},X,le.indices,{count:ue,type:"SCALAR"}),_e=Wl({},X,le.values,{count:ue}),Ee=sx(ge,ee),Ye=sx(_e,ee);for(let We=0;We<ge.count;We++)for(let Et=0;Et<re;Et++)he[Ee[We]*re+Et]=Ye[We*re+Et];return he}(C,c))}),a}static validate(t,n){const i=t.json;if(i.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${i.asset.version}".`);if(i.extensionsRequired){for(const o of i.extensionsRequired)if(!n.extensions.find(a=>a.EXTENSION_NAME===o))throw new Error(`Missing required extension, "${o}".`)}if(i.extensionsUsed)for(const o of i.extensionsUsed)n.extensions.find(a=>a.EXTENSION_NAME===o)||n.logger.warn(`Missing optional extension, "${o}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const t=this.P(Li.assertView(e));this.j(t);const n=t.json;if(n.buffers&&n.buffers.some(i=>function(o,a){return a.uri!==void 0&&!(a.uri in o.resources)}(t,i)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(i=>function(o,a){return a.uri!==void 0&&!(a.uri in o.resources)&&a.bufferView===void 0}(t,i)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Li.assertView(e)))}async writeJSON(e,t={}){if(t.format===Kg.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return(class{static write(n,i){const o=n.getRoot(),a={asset:Wl({generator:"glTF-Transform v3.2.1"},o.getAsset()),extras:Wl({},o.getExtras())},c={json:a,resources:{}},u=new id(n,c,i),d=i.logger||Ic.DEFAULT_INSTANCE,m=new Set(i.extensions.map(M=>M.EXTENSION_NAME)),g=n.getRoot().listExtensionsUsed().filter(M=>m.has(M.extensionName)),_=n.getRoot().listExtensionsRequired().filter(M=>m.has(M.extensionName));g.length<n.getRoot().listExtensionsUsed().length&&d.warn("Some extensions were not registered for I/O, and will not be written.");for(const M of g)for(const C of M.writeDependencies)M.install(C,i.dependencies[C]);function w(M,C,L,k){const j=[];let H=0;for(const ee of M){const oe=u.createAccessorDef(ee);oe.bufferView=a.bufferViews.length;const re=ee.getArray(),he=Li.pad(Li.toView(re));oe.byteOffset=H,H+=he.byteLength,j.push(he),u.accessorIndexMap.set(ee,a.accessors.length),a.accessors.push(oe)}const X={buffer:C,byteOffset:L,byteLength:Li.concat(j).byteLength};return k&&(X.target=k),a.bufferViews.push(X),{buffers:j,byteLength:H}}function x(M,C,L){const k=M[0].getCount();let j=0;for(const oe of M){const re=u.createAccessorDef(oe);re.bufferView=a.bufferViews.length,re.byteOffset=j;const he=oe.getElementSize(),le=oe.getComponentSize();j+=Li.padNumber(he*le),u.accessorIndexMap.set(oe,a.accessors.length),a.accessors.push(re)}const H=k*j,X=new ArrayBuffer(H),ee=new DataView(X);for(let oe=0;oe<k;oe++){let re=0;for(const he of M){const le=he.getElementSize(),ue=he.getComponentSize(),ge=he.getComponentType(),_e=he.getArray();for(let Ee=0;Ee<le;Ee++){const Ye=oe*j+re+Ee*ue,We=_e[oe*le+Ee];switch(ge){case Rn.ComponentType.FLOAT:ee.setFloat32(Ye,We,!0);break;case Rn.ComponentType.BYTE:ee.setInt8(Ye,We);break;case Rn.ComponentType.SHORT:ee.setInt16(Ye,We,!0);break;case Rn.ComponentType.UNSIGNED_BYTE:ee.setUint8(Ye,We);break;case Rn.ComponentType.UNSIGNED_SHORT:ee.setUint16(Ye,We,!0);break;case Rn.ComponentType.UNSIGNED_INT:ee.setUint32(Ye,We,!0);break;default:throw new Error("Unexpected component type: "+ge)}}re+=Li.padNumber(le*ue)}}return a.bufferViews.push({buffer:C,byteOffset:L,byteLength:H,byteStride:j,target:id.BufferViewTarget.ARRAY_BUFFER}),{byteLength:H,buffers:[new Uint8Array(X)]}}function T(M,C,L){const k=[];let j=0;const H=new Map;let X=-1/0;for(const ge of M){const _e=u.createAccessorDef(ge);a.accessors.push(_e),u.accessorIndexMap.set(ge,a.accessors.length-1);const Ee=[],Ye=[],We=[],Et=new Array(ge.getElementSize()).fill(0);for(let Pt=0,sn=ge.getCount();Pt<sn;Pt++)if(ge.getElement(Pt,We),!Hr.eq(We,Et,0)){X=Math.max(Pt,X),Ee.push(Pt);for(let hn=0;hn<We.length;hn++)Ye.push(We[hn])}const lt=Ee.length,rt={accessorDef:_e,count:lt};if(H.set(ge,rt),lt===0)continue;if(lt>ge.getCount()/3){const Pt=(100*Ee.length/ge.getCount()).toFixed(1);d.warn(`Sparse accessor with many non-zero elements (${Pt}%) may increase file size.`)}const kt=Zw[ge.getComponentType()];rt.indices=Ee,rt.values=new kt(Ye)}if(!Number.isFinite(X))return{buffers:k,byteLength:j};const ee=X<255?Uint8Array:X<65535?Uint16Array:Uint32Array,oe=X<255?UR:X<65535?kR:LR,re={buffer:C,byteOffset:L+j,byteLength:0};for(const ge of M){const _e=H.get(ge);if(_e.count===0)continue;_e.indicesByteOffset=re.byteLength;const Ee=Li.pad(Li.toView(new ee(_e.indices)));k.push(Ee),j+=Ee.byteLength,re.byteLength+=Ee.byteLength}a.bufferViews.push(re);const he=a.bufferViews.length-1,le={buffer:C,byteOffset:L+j,byteLength:0};for(const ge of M){const _e=H.get(ge);if(_e.count===0)continue;_e.valuesByteOffset=le.byteLength;const Ee=Li.pad(Li.toView(_e.values));k.push(Ee),j+=Ee.byteLength,le.byteLength+=Ee.byteLength}a.bufferViews.push(le);const ue=a.bufferViews.length-1;for(const ge of M){const _e=H.get(ge);_e.count!==0&&(_e.accessorDef.sparse={count:_e.count,indices:{bufferView:he,byteOffset:_e.indicesByteOffset,componentType:oe},values:{bufferView:ue,byteOffset:_e.valuesByteOffset}})}return{buffers:k,byteLength:j}}const I=new Map;for(const M of n.getGraph().listEdges()){if(M.getParent()===o)continue;const C=M.getChild();if(C instanceof Rn){const L=I.get(C)||[];L.push(M),I.set(C,L)}}if(a.accessors=[],a.bufferViews=[],a.samplers=[],a.textures=[],a.images=o.listTextures().map((M,C)=>{const L=u.createPropertyDef(M);M.getMimeType()&&(L.mimeType=M.getMimeType());const k=M.getImage();return k&&u.createImageData(L,k,M),u.imageIndexMap.set(M,C),L}),g.filter(M=>M.prewriteTypes.includes(pn.ACCESSOR)).forEach(M=>M.prewrite(u,pn.ACCESSOR)),o.listAccessors().forEach(M=>{const C=u.accessorUsageGroupedByParent,L=u.accessorParents;if(u.accessorIndexMap.has(M))return;const k=I.get(M)||[],j=u.getAccessorUsage(M);if(u.addAccessorToUsageGroup(M,j),C.has(j)){const H=k[0].getParent(),X=L.get(H)||new Set;X.add(M),L.set(H,X)}}),g.filter(M=>M.prewriteTypes.includes(pn.BUFFER)).forEach(M=>M.prewrite(u,pn.BUFFER)),(o.listAccessors().length>0||o.listTextures().length>0||u.otherBufferViews.size>0)&&o.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");a.buffers=[],o.listBuffers().forEach((M,C)=>{const L=u.createPropertyDef(M),k=u.accessorUsageGroupedByParent,j=u.accessorParents,H=M.listParents().filter(le=>le instanceof Rn),X=new Set(H),ee=[],oe=a.buffers.length;let re=0;const he=u.listAccessorUsageGroups();for(const le in he)if(k.has(le))for(const ue of Array.from(j.values())){const ge=Array.from(ue).filter(_e=>X.has(_e)).filter(_e=>u.getAccessorUsage(_e)===le);if(ge.length)if(le!==ox.ARRAY_BUFFER||i.vertexLayout===Jw.INTERLEAVED){const _e=le===ox.ARRAY_BUFFER?x(ge,oe,re):w(ge,oe,re);re+=_e.byteLength,ee.push(..._e.buffers)}else for(const _e of ge){const Ee=x([_e],oe,re);re+=Ee.byteLength,ee.push(...Ee.buffers)}}else{const ue=he[le].filter(Ee=>X.has(Ee));if(!ue.length)continue;const ge=le===ox.ELEMENT_ARRAY_BUFFER?id.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,_e=le===ox.SPARSE?T(ue,oe,re):w(ue,oe,re,ge);re+=_e.byteLength,ee.push(..._e.buffers)}if(u.imageBufferViews.length&&C===0){for(let le=0;le<u.imageBufferViews.length;le++)if(a.bufferViews[a.images[le].bufferView].byteOffset=re,re+=u.imageBufferViews[le].byteLength,ee.push(u.imageBufferViews[le]),re%8){const ue=8-re%8;re+=ue,ee.push(new Uint8Array(ue))}}if(u.otherBufferViews.has(M))for(const le of u.otherBufferViews.get(M))a.bufferViews.push({buffer:oe,byteOffset:re,byteLength:le.byteLength}),u.otherBufferViewsIndexMap.set(le,a.bufferViews.length-1),re+=le.byteLength,ee.push(le);if(re){let le;i.format===Kg.GLB?le="@glb.bin":(le=u.bufferURIGenerator.createURI(M,"bin"),L.uri=le),L.byteLength=re,c.resources[le]=Li.concat(ee)}a.buffers.push(L),u.bufferIndexMap.set(M,C)}),o.listAccessors().find(M=>!M.getBuffer())&&d.warn("Skipped writing one or more Accessors: no Buffer assigned."),a.materials=o.listMaterials().map((M,C)=>{const L=u.createPropertyDef(M);if(M.getAlphaMode()!==$g.AlphaMode.OPAQUE&&(L.alphaMode=M.getAlphaMode()),M.getAlphaMode()===$g.AlphaMode.MASK&&(L.alphaCutoff=M.getAlphaCutoff()),M.getDoubleSided()&&(L.doubleSided=!0),L.pbrMetallicRoughness={},Hr.eq(M.getBaseColorFactor(),[1,1,1,1])||(L.pbrMetallicRoughness.baseColorFactor=M.getBaseColorFactor()),Hr.eq(M.getEmissiveFactor(),[0,0,0])||(L.emissiveFactor=M.getEmissiveFactor()),M.getRoughnessFactor()!==1&&(L.pbrMetallicRoughness.roughnessFactor=M.getRoughnessFactor()),M.getMetallicFactor()!==1&&(L.pbrMetallicRoughness.metallicFactor=M.getMetallicFactor()),M.getBaseColorTexture()){const k=M.getBaseColorTexture(),j=M.getBaseColorTextureInfo();L.pbrMetallicRoughness.baseColorTexture=u.createTextureInfoDef(k,j)}if(M.getEmissiveTexture()){const k=M.getEmissiveTexture(),j=M.getEmissiveTextureInfo();L.emissiveTexture=u.createTextureInfoDef(k,j)}if(M.getNormalTexture()){const k=M.getNormalTexture(),j=M.getNormalTextureInfo(),H=u.createTextureInfoDef(k,j);M.getNormalScale()!==1&&(H.scale=M.getNormalScale()),L.normalTexture=H}if(M.getOcclusionTexture()){const k=M.getOcclusionTexture(),j=M.getOcclusionTextureInfo(),H=u.createTextureInfoDef(k,j);M.getOcclusionStrength()!==1&&(H.strength=M.getOcclusionStrength()),L.occlusionTexture=H}if(M.getMetallicRoughnessTexture()){const k=M.getMetallicRoughnessTexture(),j=M.getMetallicRoughnessTextureInfo();L.pbrMetallicRoughness.metallicRoughnessTexture=u.createTextureInfoDef(k,j)}return u.materialIndexMap.set(M,C),L}),a.meshes=o.listMeshes().map((M,C)=>{const L=u.createPropertyDef(M);let k=null;return L.primitives=M.listPrimitives().map(j=>{const H={attributes:{}};H.mode=j.getMode();const X=j.getMaterial();X&&(H.material=u.materialIndexMap.get(X)),Object.keys(j.getExtras()).length&&(H.extras=j.getExtras());const ee=j.getIndices();ee&&(H.indices=u.accessorIndexMap.get(ee));for(const oe of j.listSemantics())H.attributes[oe]=u.accessorIndexMap.get(j.getAttribute(oe));for(const oe of j.listTargets()){const re={};for(const he of oe.listSemantics())re[he]=u.accessorIndexMap.get(oe.getAttribute(he));H.targets=H.targets||[],H.targets.push(re)}return j.listTargets().length&&!k&&(k=j.listTargets().map(oe=>oe.getName())),H}),M.getWeights().length&&(L.weights=M.getWeights()),k&&(L.extras=L.extras||{},L.extras.targetNames=k),u.meshIndexMap.set(M,C),L}),a.cameras=o.listCameras().map((M,C)=>{const L=u.createPropertyDef(M);if(L.type=M.getType(),L.type===Zg.Type.PERSPECTIVE){L.perspective={znear:M.getZNear(),zfar:M.getZFar(),yfov:M.getYFov()};const k=M.getAspectRatio();k!==null&&(L.perspective.aspectRatio=k)}else L.orthographic={znear:M.getZNear(),zfar:M.getZFar(),xmag:M.getXMag(),ymag:M.getYMag()};return u.cameraIndexMap.set(M,C),L}),a.nodes=o.listNodes().map((M,C)=>{const L=u.createPropertyDef(M);return Hr.eq(M.getTranslation(),[0,0,0])||(L.translation=M.getTranslation()),Hr.eq(M.getRotation(),[0,0,0,1])||(L.rotation=M.getRotation()),Hr.eq(M.getScale(),[1,1,1])||(L.scale=M.getScale()),M.getWeights().length&&(L.weights=M.getWeights()),u.nodeIndexMap.set(M,C),L}),a.skins=o.listSkins().map((M,C)=>{const L=u.createPropertyDef(M),k=M.getInverseBindMatrices();k&&(L.inverseBindMatrices=u.accessorIndexMap.get(k));const j=M.getSkeleton();return j&&(L.skeleton=u.nodeIndexMap.get(j)),L.joints=M.listJoints().map(H=>u.nodeIndexMap.get(H)),u.skinIndexMap.set(M,C),L}),o.listNodes().forEach((M,C)=>{const L=a.nodes[C],k=M.getMesh();k&&(L.mesh=u.meshIndexMap.get(k));const j=M.getCamera();j&&(L.camera=u.cameraIndexMap.get(j));const H=M.getSkin();H&&(L.skin=u.skinIndexMap.get(H)),M.listChildren().length>0&&(L.children=M.listChildren().map(X=>u.nodeIndexMap.get(X)))}),a.animations=o.listAnimations().map((M,C)=>{const L=u.createPropertyDef(M),k=new Map;return L.samplers=M.listSamplers().map((j,H)=>{const X=u.createPropertyDef(j);return X.input=u.accessorIndexMap.get(j.getInput()),X.output=u.accessorIndexMap.get(j.getOutput()),X.interpolation=j.getInterpolation(),k.set(j,H),X}),L.channels=M.listChannels().map(j=>{const H=u.createPropertyDef(j);return H.sampler=k.get(j.getSampler()),H.target={node:u.nodeIndexMap.get(j.getTargetNode()),path:j.getTargetPath()},H}),u.animationIndexMap.set(M,C),L}),a.scenes=o.listScenes().map((M,C)=>{const L=u.createPropertyDef(M);return L.nodes=M.listChildren().map(k=>u.nodeIndexMap.get(k)),u.sceneIndexMap.set(M,C),L});const R=o.getDefaultScene();return R&&(a.scene=o.listScenes().indexOf(R)),a.extensionsUsed=g.map(M=>M.extensionName),a.extensionsRequired=_.map(M=>M.extensionName),g.forEach(M=>M.write(u)),function(M){const C=[];for(const L in M){const k=M[L];(Array.isArray(k)&&k.length===0||k===null||k===""||k&&typeof k=="object"&&Object.keys(k).length===0)&&C.push(L)}for(const L of C)delete M[L]}(a),c}}).write(e,{format:t.format||Kg.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.U,dependencies:Wl({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:Kg.GLB}),i=new Uint32Array([1179937895,2,12]),o=JSON.stringify(t),a=Li.pad(Li.encodeText(o),32),c=Li.toView(new Uint32Array([a.byteLength,1313821514])),u=Li.concat([c,a]);i[i.length-1]+=u.byteLength;const d=Object.values(n)[0];if(!d||!d.byteLength)return Li.concat([Li.toView(i),u]);const m=Li.pad(d,0),g=Li.toView(new Uint32Array([m.byteLength,5130562])),_=Li.concat([g,m]);return i[i.length-1]+=_.byteLength,Li.concat([Li.toView(i),u,_])}async L(e,t){var n=this;const i=[...e.json.images||[],...e.json.buffers||[]].map(async function(o){const a=o.uri;if(!a||a.match(/data:/))return Promise.resolve();e.resources[a]=await n.readURI(n.resolve(t,a),"view"),n.lastReadBytes+=e.resources[a].byteLength});await Promise.all(i)}j(e){function t(n){if(n.uri){if(n.uri in e.resources)Li.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const i=`__${function(){for(let o=0;o<999;o++){const a=PR();if(!$C.has(a))return $C.add(a),a}return""}()}.${V_.extension(n.uri)}`;e.resources[i]=Li.createBufferFromDataURI(n.uri),n.uri=i}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(n)}),(e.json.buffers||[]).forEach(t)}D(e){const{images:t,buffers:n}=e.json;return e={json:Wl({},e.json),resources:Wl({},e.resources)},t&&(e.json.images=t.map(i=>Wl({},i))),n&&(e.json.buffers=n.map(i=>Wl({},i))),e}P(e){if(!uM(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==ax.JSON)throw new Error("Missing required GLB JSON chunk.");const n=t[0],i=Li.decodeText(Li.toView(e,20,n)),o=JSON.parse(i),a=20+n;if(e.byteLength<=a)return{json:o,resources:{}};const c=new Uint32Array(e.buffer,e.byteOffset+a,2);if(c[1]!==ax.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:o,resources:{"@glb.bin":Li.toView(e,a+8,c[0])}}}}function uM(s){if(s.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(s.buffer,s.byteOffset,3);return e[0]===1179937895&&e[1]===2}class FR extends NR{constructor(e=wA.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,t){const n=await fetch(e,this.k);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return wA.resolve(e,t)}dirname(e){return wA.dirname(e)}}const jR=64;class zR{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class EA{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const pl=[171,75,84,88,32,50,48,187,13,10,26,10];function hM(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function eS(s){const e=new Uint8Array(s.buffer,s.byteOffset,pl.length);if(e[0]!==pl[0]||e[1]!==pl[1]||e[2]!==pl[2]||e[3]!==pl[3]||e[4]!==pl[4]||e[5]!==pl[5]||e[6]!==pl[6]||e[7]!==pl[7]||e[8]!==pl[8]||e[9]!==pl[9]||e[10]!==pl[10]||e[11]!==pl[11])throw new Error("Missing KTX 2.0 identifier.");const t=new zR,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new EA(s,pl.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const o=i._nextUint32();t.supercompressionScheme=i._nextUint32();const a=i._nextUint32(),c=i._nextUint32(),u=i._nextUint32(),d=i._nextUint32(),m=i._nextUint64(),g=i._nextUint64(),_=3*o*8,w=new EA(s,pl.length+n,_,!0);for(let Ye=0;Ye<o;Ye++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+w._nextUint64(),w._nextUint64()),uncompressedByteLength:w._nextUint64()});const x=new EA(s,a,c,!0),T={vendorId:x._skip(4)._nextUint16(),descriptorType:x._nextUint16(),versionNumber:x._nextUint16(),descriptorBlockSize:x._nextUint16(),colorModel:x._nextUint8(),colorPrimaries:x._nextUint8(),transferFunction:x._nextUint8(),flags:x._nextUint8(),texelBlockDimension:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],bytesPlane:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],samples:[]},I=(T.descriptorBlockSize/4-6)/4;for(let Ye=0;Ye<I;Ye++){const We={bitOffset:x._nextUint16(),bitLength:x._nextUint8(),channelType:x._nextUint8(),samplePosition:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};We.channelType&jR?(We.sampleLower=x._nextInt32(),We.sampleUpper=x._nextInt32()):(We.sampleLower=x._nextUint32(),We.sampleUpper=x._nextUint32()),T.samples[Ye]=We}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(T);const R=new EA(s,u,d,!0);for(;R._offset<d;){const Ye=R._nextUint32(),We=R._scan(Ye),Et=hM(We),lt=R._scan(Ye-We.byteLength);t.keyValue[Et]=Et.match(/^ktx/i)?hM(lt):lt,R._offset%4&&R._skip(4-R._offset%4)}if(g<=0)return t;const M=new EA(s,m,g,!0),C=M._nextUint16(),L=M._nextUint16(),k=M._nextUint32(),j=M._nextUint32(),H=M._nextUint32(),X=M._nextUint32(),ee=[];for(let Ye=0;Ye<o;Ye++)ee.push({imageFlags:M._nextUint32(),rgbSliceByteOffset:M._nextUint32(),rgbSliceByteLength:M._nextUint32(),alphaSliceByteOffset:M._nextUint32(),alphaSliceByteLength:M._nextUint32()});const oe=m+M._offset,re=oe+k,he=re+j,le=he+H,ue=new Uint8Array(s.buffer,s.byteOffset+oe,k),ge=new Uint8Array(s.buffer,s.byteOffset+re,j),_e=new Uint8Array(s.buffer,s.byteOffset+he,H),Ee=new Uint8Array(s.buffer,s.byteOffset+le,X);return t.globalData={endpointCount:C,selectorCount:L,imageDescs:ee,endpointsData:ue,selectorsData:ge,tablesData:_e,extendedData:Ee},t}class dM extends js{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[pn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}dM.EXTENSION_NAME="EXT_mesh_gpu_instancing";const tv="EXT_mesh_gpu_instancing";class pM extends Zr{constructor(...e){super(...e),this.extensionName=tv,this.provideTypes=[pn.NODE],this.prewriteTypes=[pn.ACCESSOR]}createInstancedMesh(){return new dM(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,n)=>{if(!t.extensions||!t.extensions[tv])return;const i=t.extensions[tv],o=this.createInstancedMesh();for(const a in i.attributes)o.setAttribute(a,e.accessors[i.attributes[a]]);e.nodes[n].setExtension(tv,o)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(tv);if(i){const o=e.nodeIndexMap.get(n),a=t.json.nodes[o],c={attributes:{}};i.listSemantics().forEach(u=>{const d=i.getAttribute(u);c.attributes[u]=e.accessorIndexMap.get(d)}),a.extensions=a.extensions||{},a.extensions[tv]=c}}),this}}function im(){return(im=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s}).apply(this,arguments)}var SA,Q_,Js;pM.EXTENSION_NAME=tv,function(s){s.QUANTIZE="quantize",s.FILTER="filter"}(SA||(SA={})),function(s){s.ATTRIBUTES="ATTRIBUTES",s.TRIANGLES="TRIANGLES",s.INDICES="INDICES"}(Q_||(Q_={})),function(s){s.NONE="NONE",s.OCTAHEDRAL="OCTAHEDRAL",s.QUATERNION="QUATERNION",s.EXPONENTIAL="EXPONENTIAL"}(Js||(Js={}));const{BYTE:VR,SHORT:fM,FLOAT:GR}=Rn.ComponentType,{encodeNormalizedInt:mM,decodeNormalizedInt:tS}=Hr;function HR(s,e,t,n){const{filter:i,bits:o}=n,a={array:s.getArray(),byteStride:s.getElementSize()*s.getComponentSize(),componentType:s.getComponentType(),normalized:s.getNormalized()};if(t!==Q_.ATTRIBUTES)return a;if(i!==Js.NONE){let c=s.getNormalized()?function(u){const d=u.getComponentType(),m=u.getArray(),g=new Float32Array(m.length);for(let _=0;_<m.length;_++)g[_]=tS(m[_],d);return g}(s):new Float32Array(a.array);switch(i){case Js.EXPONENTIAL:a.byteStride=4*s.getElementSize(),a.componentType=GR,a.normalized=!1,a.array=e.encodeFilterExp(c,s.getCount(),a.byteStride,o);break;case Js.OCTAHEDRAL:a.byteStride=o>8?8:4,a.componentType=o>8?fM:VR,a.normalized=!0,c=s.getElementSize()===3?function(u){const d=new Float32Array(4*u.length/3);for(let m=0,g=u.length/3;m<g;m++)d[4*m]=u[3*m],d[4*m+1]=u[3*m+1],d[4*m+2]=u[3*m+2];return d}(c):c,a.array=e.encodeFilterOct(c,s.getCount(),a.byteStride,o);break;case Js.QUATERNION:a.byteStride=8,a.componentType=fM,a.normalized=!0,a.array=e.encodeFilterQuat(c,s.getCount(),a.byteStride,o);break;default:throw new Error("Invalid filter.")}a.min=s.getMin([]),a.max=s.getMax([]),s.getNormalized()&&(a.min=a.min.map(u=>tS(u,s.getComponentType())),a.max=a.max.map(u=>tS(u,s.getComponentType()))),a.normalized&&(a.min=a.min.map(u=>mM(u,a.componentType)),a.max=a.max.map(u=>mM(u,a.componentType)))}else a.byteStride%4&&(a.array=function(c,u){const d=Li.padNumber(c.BYTES_PER_ELEMENT*u)/c.BYTES_PER_ELEMENT,m=new c.constructor(c.length/u*d);for(let g=0;g*u<c.length;g++)for(let _=0;_<u;_++)m[g*d+_]=c[g*u+_];return m}(a.array,s.getElementSize()),a.byteStride=a.array.byteLength/s.getCount());return a}function QR(s,e){return e===id.BufferViewUsage.ELEMENT_ARRAY_BUFFER?s.listParents().some(t=>t instanceof ev&&t.getMode()===ev.Mode.TRIANGLES)?Q_.TRIANGLES:Q_.INDICES:Q_.ATTRIBUTES}function WR(s,e){const t=e.getGraph().listParentEdges(s).filter(n=>!(n.getParent()instanceof aM));for(const n of t){const i=n.getName(),o=n.getAttributes().key||"";if(i==="indices")return{filter:Js.NONE};if(i==="attributes"){if(o==="POSITION")return{filter:Js.NONE};if(o==="TEXCOORD_0")return{filter:Js.NONE};if(o==="NORMAL")return{filter:Js.OCTAHEDRAL,bits:8};if(o==="TANGENT")return{filter:Js.OCTAHEDRAL,bits:8};if(o.startsWith("JOINTS_"))return{filter:Js.NONE};if(o.startsWith("WEIGHTS_"))return{filter:Js.NONE}}if(i==="output"){const a=gM(s);return a==="rotation"?{filter:Js.QUATERNION,bits:16}:a==="translation"||a==="scale"?{filter:Js.EXPONENTIAL,bits:12}:{filter:Js.NONE}}if(i==="input")return{filter:Js.NONE};if(i==="inverseBindMatrices")return{filter:Js.NONE}}return{filter:Js.NONE}}function gM(s){for(const e of s.listParents())if(e instanceof G_){for(const t of e.listParents())if(t instanceof $E)return t.getTargetPath()}return null}const fl="EXT_meshopt_compression",vM={method:SA.QUANTIZE};class nS extends Zr{constructor(...e){super(...e),this.extensionName=fl,this.prereadTypes=[pn.BUFFER,pn.PRIMITIVE],this.prewriteTypes=[pn.BUFFER,pn.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=vM,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=im({},vM,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${fl}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${fl}]: Missing WASM support.`)}return t===pn.BUFFER?this._prereadBuffers(e):t===pn.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,i)=>{if(!n.extensions||!n.extensions[fl])return;const o=n.extensions[fl],a=o.byteOffset||0,c=o.byteLength||0,u=o.count,d=o.byteStride,m=new Uint8Array(u*d),g=t.json.buffers[o.buffer],_=Li.toView(g.uri?t.resources[g.uri]:t.resources[XC],a,c);this._decoder.decodeGltfBuffer(m,u,d,_,o.mode,o.filter),e.bufferViews[i]=m})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var i;n.extensions&&n.extensions[fl]&&(i=t.json.buffers[n.buffer]).extensions&&i.extensions.EXT_meshopt_compression&&i.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[fl].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const i of t.listParents())i instanceof Rn&&i.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===pn.ACCESSOR?this._prewriteAccessors(e):t===pn.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,i=this._encoderOptions,o=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const c of this.document.getRoot().listAccessors()){if(gM(c)==="weights"||c.getSparse())continue;const u=e.getAccessorUsage(c),d=QR(c,u),m=i.method===SA.FILTER?WR(c,this.document):{filter:Js.NONE},g=HR(c,n,d,m),{array:_,byteStride:w}=g,x=c.getBuffer();if(!x)throw new Error(`${fl}: Missing buffer for accessor.`);const T=this.document.getRoot().listBuffers().indexOf(x),I=[u,d,m.filter,w,T].join(":");let R=this._encoderBufferViews[I],M=this._encoderBufferViewData[I],C=this._encoderBufferViewAccessors[I];R&&M||(C=this._encoderBufferViewAccessors[I]=[],M=this._encoderBufferViewData[I]=[],R=this._encoderBufferViews[I]={buffer:a,target:id.USAGE_TO_TARGET[u],byteOffset:0,byteLength:0,byteStride:u===id.BufferViewUsage.ARRAY_BUFFER?w:void 0,extensions:{[fl]:{buffer:T,byteOffset:0,byteLength:0,mode:d,filter:m.filter!==Js.NONE?m.filter:void 0,byteStride:w,count:0}}});const L=e.createAccessorDef(c);L.componentType=g.componentType,L.normalized=g.normalized,L.byteOffset=R.byteLength,L.min&&g.min&&(L.min=g.min),L.max&&g.max&&(L.max=g.max),e.accessorIndexMap.set(c,t.accessors.length),t.accessors.push(L),C.push(L),M.push(new Uint8Array(_.buffer,_.byteOffset,_.byteLength)),R.byteLength+=_.byteLength,R.extensions.EXT_meshopt_compression.count+=c.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const i=this._encoderBufferViews[n],o=this._encoderBufferViewData[n],a=this.document.getRoot().listBuffers()[i.extensions[fl].buffer],c=e.otherBufferViews.get(a)||[],{count:u,byteStride:d,mode:m}=i.extensions[fl],g=Li.concat(o),_=t.encodeGltfBuffer(g,u,d,m),w=Li.pad(_);i.extensions[fl].byteLength=_.byteLength,o.length=0,o.push(w),c.push(w),e.otherBufferViews.set(a,c)}}write(e){let t=0;for(const a in this._encoderBufferViews){const c=this._encoderBufferViews[a],u=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[a][0]),d=this._encoderBufferViewAccessors[a];for(const _ of d)_.bufferView=u;const m=e.jsonDoc.json.bufferViews[u],g=m.byteOffset||0;Object.assign(m,c),m.byteOffset=t,m.extensions[fl].byteOffset=g,t+=Li.padNumber(c.byteLength)}const n=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(n),o=e.jsonDoc.json.buffers[i];return o.byteLength=t,o.extensions={[fl]:{fallback:!0}},n.dispose(),this}}nS.EXTENSION_NAME=fl,nS.EncoderMethod=SA;const CA="EXT_texture_avif";class qR{match(e){return e.length>=12&&Li.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=yM(t,0);if(!n)return null;let i=n.end;for(;n=yM(t,i);)if(n.type==="meta")i=n.start+4;else if(n.type==="iprp"||n.type==="ipco")i=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;i=n.end}return null}getChannels(e){return 4}}class _M extends Zr{constructor(...e){super(...e),this.extensionName=CA,this.prereadTypes=[pn.TEXTURE]}static register(){nd.registerFormat("image/avif",new qR)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[CA]&&(t.source=t.extensions[CA].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[CA]={source:o.source},delete o.source)})}}),this}}function yM(s,e){if(s.byteLength<4+e)return null;const t=s.getUint32(e);return s.byteLength<t+e||t<8?null:{type:Li.decodeText(new Uint8Array(s.buffer,s.byteOffset+e+4,4)),start:e+8,end:e+t}}_M.EXTENSION_NAME=CA;const MA="EXT_texture_webp";class XR{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Li.decodeText(e.slice(0,4)),n=Li.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const i=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<i.byteLength;){const a=Li.decodeText(new Uint8Array([i.getUint8(o),i.getUint8(o+1),i.getUint8(o+2),i.getUint8(o+3)])),c=i.getUint32(o+4,!0);if(a==="VP8 ")return[16383&i.getInt16(o+14,!0),16383&i.getInt16(o+16,!0)];if(a==="VP8L"){const u=i.getUint8(o+9),d=i.getUint8(o+10),m=i.getUint8(o+11);return[1+((63&d)<<8|u),1+((15&i.getUint8(o+12))<<10|m<<2|(192&d)>>6)]}o+=8+c+c%2}return null}getChannels(e){return 4}}class AM extends Zr{constructor(...e){super(...e),this.extensionName=MA,this.prereadTypes=[pn.TEXTURE]}static register(){nd.registerFormat("image/webp",new XR)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[MA]&&(t.source=t.extensions[MA].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[MA]={source:o.source},delete o.source)})}}),this}}AM.EXTENSION_NAME=MA;const bM="KHR_draco_mesh_compression";let Do,wM,xM,ql;function YR(s,e){const t=new Do.DecoderBuffer;try{if(t.Init(e,e.length),s.GetEncodedGeometryType(t)!==Do.TRIANGULAR_MESH)throw new Error(`[${bM}] Unknown geometry type.`);const n=new Do.Mesh;if(!s.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${bM}] Decoding failure.`);return n}finally{Do.destroy(t)}}function KR(s,e){const t=3*e.num_faces();let n,i;if(e.num_points()<=65534){const o=t*Uint16Array.BYTES_PER_ELEMENT;n=Do._malloc(o),s.GetTrianglesUInt16Array(e,o,n),i=new Uint16Array(Do.HEAPU16.buffer,n,t).slice()}else{const o=t*Uint32Array.BYTES_PER_ELEMENT;n=Do._malloc(o),s.GetTrianglesUInt32Array(e,o,n),i=new Uint32Array(Do.HEAPU32.buffer,n,t).slice()}return Do._free(n),i}function JR(s,e,t,n){const i=xM[n.componentType],o=wM[n.componentType],a=t.num_components(),c=e.num_points()*a,u=c*o.BYTES_PER_ELEMENT,d=Do._malloc(u);s.GetAttributeDataArrayForAllPoints(e,t,i,u,d);const m=new o(Do.HEAPF32.buffer,d,c).slice();return Do._free(d),m}var TA,tu;(function(s){s[s.EDGEBREAKER=1]="EDGEBREAKER",s[s.SEQUENTIAL=0]="SEQUENTIAL"})(TA||(TA={})),function(s){s.POSITION="POSITION",s.NORMAL="NORMAL",s.COLOR="COLOR",s.TEX_COORD="TEX_COORD",s.GENERIC="GENERIC"}(tu||(tu={}));const EM={[tu.POSITION]:14,[tu.NORMAL]:10,[tu.COLOR]:8,[tu.TEX_COORD]:12,[tu.GENERIC]:12},SM={decodeSpeed:5,encodeSpeed:5,method:TA.EDGEBREAKER,quantizationBits:EM,quantizationVolume:"mesh"};function ZR(s,e=SM){const t=im({},SM,e);t.quantizationBits=im({},EM,e.quantizationBits);const n=new ql.Encoder,i=new ql.MeshBuilder,o=new ql.Mesh,a={},c=new ql.DracoInt8Array,u=s.listTargets().length>0;let d=!1;for(const I of s.listSemantics()){const R=s.getAttribute(I);if(R.getSparse()){d=!0;continue}const M=$R(I),C=e2(i,R.getComponentType(),o,ql[M],R.getCount(),R.getElementSize(),R.getArray());if(C===-1)throw new Error(`Error compressing "${I}" attribute.`);if(a[I]=C,t.quantizationVolume==="mesh"||I!=="POSITION")n.SetAttributeQuantization(ql[M],t.quantizationBits[M]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:L}=t,k=Math.max(L.max[0]-L.min[0],L.max[1]-L.min[1],L.max[2]-L.min[2]);n.SetAttributeExplicitQuantization(ql[M],t.quantizationBits[M],R.getElementSize(),L.min,k)}}}const m=s.getIndices();if(!m)throw new lx("Primitive must have indices.");i.AddFacesToMesh(o,m.getCount()/3,m.getArray()),n.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),n.SetTrackEncodedProperties(!0),n.SetEncodingMethod(t.method===TA.SEQUENTIAL||u||d?ql.MESH_SEQUENTIAL_ENCODING:ql.MESH_EDGEBREAKER_ENCODING);const g=n.EncodeMeshToDracoBuffer(o,c);if(g<=0)throw new lx("Error applying Draco compression.");const _=new Uint8Array(g);for(let I=0;I<g;++I)_[I]=c.GetValue(I);const w=s.getAttribute("POSITION").getCount(),x=n.GetNumberOfEncodedPoints(),T=3*n.GetNumberOfEncodedFaces();if((u||d)&&x!==w)throw new lx('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return ql.destroy(c),ql.destroy(o),ql.destroy(i),ql.destroy(n),{numVertices:x,numIndices:T,data:_,attributeIDs:a}}function $R(s){return s==="POSITION"?tu.POSITION:s==="NORMAL"?tu.NORMAL:s.startsWith("COLOR_")?tu.COLOR:s.startsWith("TEXCOORD_")?tu.TEX_COORD:tu.GENERIC}function e2(s,e,t,n,i,o,a){switch(e){case Rn.ComponentType.UNSIGNED_BYTE:return s.AddUInt8Attribute(t,n,i,o,a);case Rn.ComponentType.BYTE:return s.AddInt8Attribute(t,n,i,o,a);case Rn.ComponentType.UNSIGNED_SHORT:return s.AddUInt16Attribute(t,n,i,o,a);case Rn.ComponentType.SHORT:return s.AddInt16Attribute(t,n,i,o,a);case Rn.ComponentType.UNSIGNED_INT:return s.AddUInt32Attribute(t,n,i,o,a);case Rn.ComponentType.FLOAT:return s.AddFloatAttribute(t,n,i,o,a);default:throw new Error(`Unexpected component type, "${e}".`)}}class lx extends Error{}const Zs="KHR_draco_mesh_compression";class IA extends Zr{constructor(...e){super(...e),this.extensionName=Zs,this.prereadTypes=[pn.PRIMITIVE],this.prewriteTypes=[pn.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,Do=this._decoderModule,wM={[Rn.ComponentType.FLOAT]:Float32Array,[Rn.ComponentType.UNSIGNED_INT]:Uint32Array,[Rn.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Rn.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Rn.ComponentType.SHORT]:Int16Array,[Rn.ComponentType.BYTE]:Int8Array},xM={[Rn.ComponentType.FLOAT]:Do.DT_FLOAT32,[Rn.ComponentType.UNSIGNED_INT]:Do.DT_UINT32,[Rn.ComponentType.UNSIGNED_SHORT]:Do.DT_UINT16,[Rn.ComponentType.UNSIGNED_BYTE]:Do.DT_UINT8,[Rn.ComponentType.SHORT]:Do.DT_INT16,[Rn.ComponentType.BYTE]:Do.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,ql=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Zs}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,i=new Map;try{const o=n.json.meshes||[];for(const a of o)for(const c of a.primitives){if(!c.extensions||!c.extensions[Zs])continue;const u=c.extensions[Zs];let[d,m]=i.get(u.bufferView)||[];if(!m||!d){const g=n.json.bufferViews[u.bufferView],_=n.json.buffers[g.buffer],w=Li.toView(_.uri?n.resources[_.uri]:n.resources[XC],g.byteOffset||0,g.byteLength);d=new this._decoderModule.Decoder,m=YR(d,w),i.set(u.bufferView,[d,m]),t.debug(`[${Zs}] Decompressed ${w.byteLength} bytes.`)}for(const g in c.attributes){const _=e.jsonDoc.json.accessors[c.attributes[g]],w=d.GetAttributeByUniqueId(m,u.attributes[g]),x=JR(d,m,w,_);e.accessors[c.attributes[g]].setArray(x)}c.indices!==void 0&&e.accessors[c.indices].setArray(KR(d,m))}}finally{for(const[o,a]of Array.from(i.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(a)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Zs}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Zs}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=function(c){const u=c.getLogger(),d=new Set,m=new Set;for(const I of c.getRoot().listMeshes())for(const R of I.listPrimitives())R.getIndices()?R.getMode()!==ev.Mode.TRIANGLES?(m.add(R),u.warn(`[${Zs}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(R):(m.add(R),u.warn(`[${Zs}] Skipping Draco compression on non-indexed primitive.`));const g=c.getRoot().listAccessors(),_=new Map;for(let I=0;I<g.length;I++)_.set(g[I],I);const w=new Map,x=new Set,T=new Map;for(const I of Array.from(d)){let R=CM(I,_);if(x.has(R))T.set(I,R);else{if(w.has(I.getIndices())){const M=I.getIndices(),C=M.clone();_.set(C,c.getRoot().listAccessors().length-1),I.swap(M,C)}for(const M of I.listAttributes())if(w.has(M)){const C=M.clone();_.set(C,c.getRoot().listAccessors().length-1),I.swap(M,C)}R=CM(I,_),x.add(R),T.set(I,R),w.set(I.getIndices(),R);for(const M of I.listAttributes())w.set(M,R)}}for(const I of Array.from(w.keys())){const R=new Set(I.listParents().map(M=>M.propertyType));if(R.size!==2||!R.has(pn.PRIMITIVE)||!R.has(pn.ROOT))throw new Error(`[${Zs}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const I of Array.from(d)){const R=T.get(I),M=I.getIndices();if(w.get(M)!==R||I.listAttributes().some(C=>w.get(C)!==R))throw new Error(`[${Zs}] Draco primitives must share all, or no, accessors.`)}for(const I of Array.from(m)){const R=I.getIndices();if(w.has(R)||I.listAttributes().some(M=>w.has(M)))throw new Error(`[${Zs}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return T}(this.document),o=new Map;let a="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Zs}]: quantizationVolume=scene requires exactly 1 scene.`):a=function(c){const u={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},d=c.propertyType===pn.NODE?[c]:c.listChildren();for(const m of d)m.traverse(g=>{const _=g.getMesh();if(!_)return;const w=ER(_,g.getWorldMatrix());JE(w.min,u),JE(w.max,u)});return u}(this.document.getRoot().listScenes().pop()));for(const c of Array.from(i.keys())){const u=i.get(c);if(!u)throw new Error("Unexpected primitive.");if(o.has(u)){o.set(u,o.get(u));continue}const d=c.getIndices(),m=e.jsonDoc.json.accessors;let g;try{g=ZR(c,im({},this._encoderOptions,{quantizationVolume:a}))}catch(x){if(x instanceof lx){n.warn(`[${Zs}]: ${x.message} Skipping primitive compression.`);continue}throw x}o.set(u,g);const _=e.createAccessorDef(d);_.count=g.numIndices,e.accessorIndexMap.set(d,m.length),m.push(_);for(const x of c.listSemantics()){const T=c.getAttribute(x);if(g.attributeIDs[x]===void 0)continue;const I=e.createAccessorDef(T);I.count=g.numVertices,e.accessorIndexMap.set(T,m.length),m.push(I)}const w=c.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(w)||e.otherBufferViews.set(w,[]),e.otherBufferViews.get(w).push(g.data)}return n.debug(`[${Zs}] Compressed ${i.size} primitives.`),e.extensionData[Zs]={primitiveHashMap:i,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[Zs];for(const n of this.document.getRoot().listMeshes()){const i=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let o=0;o<n.listPrimitives().length;o++){const a=n.listPrimitives()[o],c=i.primitives[o],u=t.primitiveHashMap.get(a);if(!u)continue;const d=t.primitiveEncodingMap.get(u);d&&(c.extensions=c.extensions||{},c.extensions[Zs]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(i=>i!==Zs),n.extensionsRequired=(n.extensionsRequired||[]).filter(i=>i!==Zs)}return this}}function CM(s,e){const t=[],n=s.getIndices();t.push(e.get(n));for(const i of s.listAttributes())t.push(e.get(i));return t.sort().join("|")}IA.EXTENSION_NAME=Zs,IA.EncoderMethod=TA;class W_ extends js{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[pn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:W_.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Ql.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return Ql.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}W_.EXTENSION_NAME="KHR_lights_punctual",W_.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const rd="KHR_lights_punctual";class MM extends Zr{constructor(...e){super(...e),this.extensionName=rd}createLight(e=""){return new W_(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[rd])return this;const n=(t.json.extensions[rd].lights||[]).map(i=>{var o,a;const c=this.createLight().setName(i.name||"").setType(i.type);return i.color!==void 0&&c.setColor(i.color),i.intensity!==void 0&&c.setIntensity(i.intensity),i.range!==void 0&&c.setRange(i.range),((o=i.spot)==null?void 0:o.innerConeAngle)!==void 0&&c.setInnerConeAngle(i.spot.innerConeAngle),((a=i.spot)==null?void 0:a.outerConeAngle)!==void 0&&c.setOuterConeAngle(i.spot.outerConeAngle),c});return t.json.nodes.forEach((i,o)=>{i.extensions&&i.extensions[rd]&&e.nodes[o].setExtension(rd,n[i.extensions[rd].light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],i=new Map;for(const o of this.properties){const a=o,c={type:a.getType()};Hr.eq(a.getColor(),[1,1,1])||(c.color=a.getColor()),a.getIntensity()!==1&&(c.intensity=a.getIntensity()),a.getRange()!=null&&(c.range=a.getRange()),a.getName()&&(c.name=a.getName()),a.getType()===W_.Type.SPOT&&(c.spot={innerConeAngle:a.getInnerConeAngle(),outerConeAngle:a.getOuterConeAngle()}),n.push(c),i.set(a,n.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const a=o.getExtension(rd);if(a){const c=e.nodeIndexMap.get(o),u=t.json.nodes[c];u.extensions=u.extensions||{},u.extensions[rd]={light:i.get(a)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[rd]={lights:n},this}}MM.EXTENSION_NAME=rd;const{R:t2,G:n2}=Ps;class TM extends js{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Qr(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:t2|n2})}}TM.EXTENSION_NAME="KHR_materials_anisotropy";const nv="KHR_materials_anisotropy";class IM extends Zr{constructor(...e){super(...e),this.extensionName=nv}createAnisotropy(){return new TM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[nv]){const a=this.createAnisotropy();e.materials[o].setExtension(nv,a);const c=i.extensions[nv];if(c.anisotropyStrength!==void 0&&a.setAnisotropyStrength(c.anisotropyStrength),c.anisotropyRotation!==void 0&&a.setAnisotropyRotation(c.anisotropyRotation),c.anisotropyTexture!==void 0){const u=c.anisotropyTexture;a.setAnisotropyTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getAnisotropyTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(nv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[nv]={};if(i.getAnisotropyStrength()>0&&(c.anisotropyStrength=i.getAnisotropyStrength()),i.getAnisotropyRotation()!==0&&(c.anisotropyRotation=i.getAnisotropyRotation()),i.getAnisotropyTexture()){const u=i.getAnisotropyTexture(),d=i.getAnisotropyTextureInfo();c.anisotropyTexture=e.createTextureInfoDef(u,d)}}}),this}}IM.EXTENSION_NAME=nv;const{R:PM,G:RM,B:i2}=Ps;class DM extends js{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Qr(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Qr(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Qr(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:PM})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:RM})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:PM|RM|i2})}}DM.EXTENSION_NAME="KHR_materials_clearcoat";const iv="KHR_materials_clearcoat";class BM extends Zr{constructor(...e){super(...e),this.extensionName=iv}createClearcoat(){return new DM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[iv]){const a=this.createClearcoat();e.materials[o].setExtension(iv,a);const c=i.extensions[iv];if(c.clearcoatFactor!==void 0&&a.setClearcoatFactor(c.clearcoatFactor),c.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(c.clearcoatRoughnessFactor),c.clearcoatTexture!==void 0){const u=c.clearcoatTexture;a.setClearcoatTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getClearcoatTextureInfo(),u)}if(c.clearcoatRoughnessTexture!==void 0){const u=c.clearcoatRoughnessTexture;a.setClearcoatRoughnessTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),u)}if(c.clearcoatNormalTexture!==void 0){const u=c.clearcoatNormalTexture;a.setClearcoatNormalTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),u),u.scale!==void 0&&a.setClearcoatNormalScale(u.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(iv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[iv]={clearcoatFactor:i.getClearcoatFactor(),clearcoatRoughnessFactor:i.getClearcoatRoughnessFactor()};if(i.getClearcoatTexture()){const u=i.getClearcoatTexture(),d=i.getClearcoatTextureInfo();c.clearcoatTexture=e.createTextureInfoDef(u,d)}if(i.getClearcoatRoughnessTexture()){const u=i.getClearcoatRoughnessTexture(),d=i.getClearcoatRoughnessTextureInfo();c.clearcoatRoughnessTexture=e.createTextureInfoDef(u,d)}if(i.getClearcoatNormalTexture()){const u=i.getClearcoatNormalTexture(),d=i.getClearcoatNormalTextureInfo();c.clearcoatNormalTexture=e.createTextureInfoDef(u,d),i.getClearcoatNormalScale()!==1&&(c.clearcoatNormalTexture.scale=i.getClearcoatNormalScale())}}}),this}}BM.EXTENSION_NAME=iv;class OM extends js{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}OM.EXTENSION_NAME="KHR_materials_emissive_strength";const rv="KHR_materials_emissive_strength";class LM extends Zr{constructor(...e){super(...e),this.extensionName=rv}createEmissiveStrength(){return new OM(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[rv]){const i=this.createEmissiveStrength();e.materials[n].setExtension(rv,i);const o=t.extensions[rv];o.emissiveStrength!==void 0&&i.setEmissiveStrength(o.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(rv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{},a.extensions[rv]={emissiveStrength:i.getEmissiveStrength()}}}),this}}LM.EXTENSION_NAME=rv;class kM extends js{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}kM.EXTENSION_NAME="KHR_materials_ior";const sv="KHR_materials_ior";class UM extends Zr{constructor(...e){super(...e),this.extensionName=sv}createIOR(){return new kM(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[sv]){const i=this.createIOR();e.materials[n].setExtension(sv,i);const o=t.extensions[sv];o.ior!==void 0&&i.setIOR(o.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(sv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{},a.extensions[sv]={ior:i.getIOR()}}}),this}}UM.EXTENSION_NAME=sv;const{R:r2,G:s2}=Ps;class NM extends js{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Qr(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Qr(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:r2})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:s2})}}NM.EXTENSION_NAME="KHR_materials_iridescence";const ov="KHR_materials_iridescence";class FM extends Zr{constructor(...e){super(...e),this.extensionName=ov}createIridescence(){return new NM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[ov]){const a=this.createIridescence();e.materials[o].setExtension(ov,a);const c=i.extensions[ov];if(c.iridescenceFactor!==void 0&&a.setIridescenceFactor(c.iridescenceFactor),c.iridescenceIor!==void 0&&a.setIridescenceIOR(c.iridescenceIor),c.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(c.iridescenceThicknessMinimum),c.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(c.iridescenceThicknessMaximum),c.iridescenceTexture!==void 0){const u=c.iridescenceTexture;a.setIridescenceTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getIridescenceTextureInfo(),u)}if(c.iridescenceThicknessTexture!==void 0){const u=c.iridescenceThicknessTexture;a.setIridescenceThicknessTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(ov);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[ov]={};if(i.getIridescenceFactor()>0&&(c.iridescenceFactor=i.getIridescenceFactor()),i.getIridescenceIOR()!==1.3&&(c.iridescenceIor=i.getIridescenceIOR()),i.getIridescenceThicknessMinimum()!==100&&(c.iridescenceThicknessMinimum=i.getIridescenceThicknessMinimum()),i.getIridescenceThicknessMaximum()!==400&&(c.iridescenceThicknessMaximum=i.getIridescenceThicknessMaximum()),i.getIridescenceTexture()){const u=i.getIridescenceTexture(),d=i.getIridescenceTextureInfo();c.iridescenceTexture=e.createTextureInfoDef(u,d)}if(i.getIridescenceThicknessTexture()){const u=i.getIridescenceThicknessTexture(),d=i.getIridescenceThicknessTextureInfo();c.iridescenceThicknessTexture=e.createTextureInfoDef(u,d)}}}),this}}FM.EXTENSION_NAME=ov;const{R:jM,G:zM,B:VM,A:GM}=Ps;class HM extends js{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Qr(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Qr(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Ql.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Ql.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:jM|zM|VM|GM})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:jM|zM|VM|GM})}}HM.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const av="KHR_materials_pbrSpecularGlossiness";class QM extends Zr{constructor(...e){super(...e),this.extensionName=av}createPBRSpecularGlossiness(){return new HM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[av]){const a=this.createPBRSpecularGlossiness();e.materials[o].setExtension(av,a);const c=i.extensions[av];if(c.diffuseFactor!==void 0&&a.setDiffuseFactor(c.diffuseFactor),c.specularFactor!==void 0&&a.setSpecularFactor(c.specularFactor),c.glossinessFactor!==void 0&&a.setGlossinessFactor(c.glossinessFactor),c.diffuseTexture!==void 0){const u=c.diffuseTexture;a.setDiffuseTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getDiffuseTextureInfo(),u)}if(c.specularGlossinessTexture!==void 0){const u=c.specularGlossinessTexture;a.setSpecularGlossinessTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(av);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[av]={diffuseFactor:i.getDiffuseFactor(),specularFactor:i.getSpecularFactor(),glossinessFactor:i.getGlossinessFactor()};if(i.getDiffuseTexture()){const u=i.getDiffuseTexture(),d=i.getDiffuseTextureInfo();c.diffuseTexture=e.createTextureInfoDef(u,d)}if(i.getSpecularGlossinessTexture()){const u=i.getSpecularGlossinessTexture(),d=i.getSpecularGlossinessTextureInfo();c.specularGlossinessTexture=e.createTextureInfoDef(u,d)}}}),this}}QM.EXTENSION_NAME=av;const{R:o2,G:a2,B:l2,A:c2}=Ps;class WM extends js{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Qr(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Qr(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Ql.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Ql.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:o2|a2|l2})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:c2})}}WM.EXTENSION_NAME="KHR_materials_sheen";const lv="KHR_materials_sheen";class qM extends Zr{constructor(...e){super(...e),this.extensionName=lv}createSheen(){return new WM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[lv]){const a=this.createSheen();e.materials[o].setExtension(lv,a);const c=i.extensions[lv];if(c.sheenColorFactor!==void 0&&a.setSheenColorFactor(c.sheenColorFactor),c.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(c.sheenRoughnessFactor),c.sheenColorTexture!==void 0){const u=c.sheenColorTexture;a.setSheenColorTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getSheenColorTextureInfo(),u)}if(c.sheenRoughnessTexture!==void 0){const u=c.sheenRoughnessTexture;a.setSheenRoughnessTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(lv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[lv]={sheenColorFactor:i.getSheenColorFactor(),sheenRoughnessFactor:i.getSheenRoughnessFactor()};if(i.getSheenColorTexture()){const u=i.getSheenColorTexture(),d=i.getSheenColorTextureInfo();c.sheenColorTexture=e.createTextureInfoDef(u,d)}if(i.getSheenRoughnessTexture()){const u=i.getSheenRoughnessTexture(),d=i.getSheenRoughnessTextureInfo();c.sheenRoughnessTexture=e.createTextureInfoDef(u,d)}}}),this}}qM.EXTENSION_NAME=lv;const{R:u2,G:h2,B:d2,A:p2}=Ps;class XM extends js{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Qr(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Qr(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Ql.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Ql.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:p2})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:u2|h2|d2})}}XM.EXTENSION_NAME="KHR_materials_specular";const cv="KHR_materials_specular";class YM extends Zr{constructor(...e){super(...e),this.extensionName=cv}createSpecular(){return new XM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[cv]){const a=this.createSpecular();e.materials[o].setExtension(cv,a);const c=i.extensions[cv];if(c.specularFactor!==void 0&&a.setSpecularFactor(c.specularFactor),c.specularColorFactor!==void 0&&a.setSpecularColorFactor(c.specularColorFactor),c.specularTexture!==void 0){const u=c.specularTexture;a.setSpecularTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getSpecularTextureInfo(),u)}if(c.specularColorTexture!==void 0){const u=c.specularColorTexture;a.setSpecularColorTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getSpecularColorTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(cv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[cv]={};if(i.getSpecularFactor()!==1&&(c.specularFactor=i.getSpecularFactor()),Hr.eq(i.getSpecularColorFactor(),[1,1,1])||(c.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const u=i.getSpecularTexture(),d=i.getSpecularTextureInfo();c.specularTexture=e.createTextureInfoDef(u,d)}if(i.getSpecularColorTexture()){const u=i.getSpecularColorTexture(),d=i.getSpecularColorTextureInfo();c.specularColorTexture=e.createTextureInfoDef(u,d)}}}),this}}YM.EXTENSION_NAME=cv;const{R:f2}=Ps;class KM extends js{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Qr(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:f2})}}KM.EXTENSION_NAME="KHR_materials_transmission";const uv="KHR_materials_transmission";class JM extends Zr{constructor(...e){super(...e),this.extensionName=uv}createTransmission(){return new KM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[uv]){const a=this.createTransmission();e.materials[o].setExtension(uv,a);const c=i.extensions[uv];if(c.transmissionFactor!==void 0&&a.setTransmissionFactor(c.transmissionFactor),c.transmissionTexture!==void 0){const u=c.transmissionTexture;a.setTransmissionTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getTransmissionTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(uv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[uv]={transmissionFactor:i.getTransmissionFactor()};if(i.getTransmissionTexture()){const u=i.getTransmissionTexture(),d=i.getTransmissionTextureInfo();c.transmissionTexture=e.createTextureInfoDef(u,d)}}}),this}}JM.EXTENSION_NAME=uv;class ZM extends js{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[pn.MATERIAL]}}ZM.EXTENSION_NAME="KHR_materials_unlit";const q_="KHR_materials_unlit";class $M extends Zr{constructor(...e){super(...e),this.extensionName=q_}createUnlit(){return new ZM(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions[q_]&&e.materials[n].setExtension(q_,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(q_)){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[q_]={}}}),this}}$M.EXTENSION_NAME=q_;class eT extends js{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}eT.EXTENSION_NAME="KHR_materials_variants";class tT extends js{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[pn.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}tT.EXTENSION_NAME="KHR_materials_variants";class iS extends js{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}iS.EXTENSION_NAME="KHR_materials_variants";const sd="KHR_materials_variants";class nT extends Zr{constructor(...e){super(...e),this.extensionName=sd}createMappingList(){return new tT(this.document.getGraph())}createVariant(e=""){return new iS(this.document.getGraph(),e)}createMapping(){return new eT(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof iS)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[sd])return this;const n=(t.json.extensions[sd].variants||[]).map(i=>this.createVariant().setName(i.name||""));return(t.json.meshes||[]).forEach((i,o)=>{const a=e.meshes[o];(i.primitives||[]).forEach((c,u)=>{if(!c.extensions||!c.extensions[sd])return;const d=this.createMappingList(),m=c.extensions[sd];for(const g of m.mappings){const _=this.createMapping();g.material!==void 0&&_.setMaterial(e.materials[g.material]);for(const w of g.variants||[])_.addVariant(n[w]);d.addMapping(_)}a.listPrimitives()[u].setExtension(sd,d)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const i=[],o=new Map;for(const a of n)o.set(a,i.length),i.push(e.createPropertyDef(a));for(const a of this.document.getRoot().listMeshes()){const c=e.meshIndexMap.get(a);a.listPrimitives().forEach((u,d)=>{const m=u.getExtension(sd);if(!m)return;const g=e.jsonDoc.json.meshes[c].primitives[d],_=m.listMappings().map(w=>{const x=e.createPropertyDef(w),T=w.getMaterial();return T&&(x.material=e.materialIndexMap.get(T)),x.variants=w.listVariants().map(I=>o.get(I)),x});g.extensions=g.extensions||{},g.extensions[sd]={mappings:_}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[sd]={variants:i},this}}nT.EXTENSION_NAME=sd;const{G:m2}=Ps;class iT extends js{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[pn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Qr(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:m2})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Ql.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",Ql.hexToFactor(e,t))}}iT.EXTENSION_NAME="KHR_materials_volume";const hv="KHR_materials_volume";class rT extends Zr{constructor(...e){super(...e),this.extensionName=hv}createVolume(){return new iT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[hv]){const a=this.createVolume();e.materials[o].setExtension(hv,a);const c=i.extensions[hv];if(c.thicknessFactor!==void 0&&a.setThicknessFactor(c.thicknessFactor),c.attenuationDistance!==void 0&&a.setAttenuationDistance(c.attenuationDistance),c.attenuationColor!==void 0&&a.setAttenuationColor(c.attenuationColor),c.thicknessTexture!==void 0){const u=c.thicknessTexture;a.setThicknessTexture(e.textures[n[u.index].source]),e.setTextureInfo(a.getThicknessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(hv);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[hv]={};if(i.getThicknessFactor()>0&&(c.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(c.attenuationDistance=i.getAttenuationDistance()),Hr.eq(i.getAttenuationColor(),[1,1,1])||(c.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const u=i.getThicknessTexture(),d=i.getThicknessTextureInfo();c.thicknessTexture=e.createTextureInfoDef(u,d)}}}),this}}rT.EXTENSION_NAME=hv;const sT="KHR_mesh_quantization";class oT extends Zr{constructor(...e){super(...e),this.extensionName=sT}read(e){return this}write(e){return this}}oT.EXTENSION_NAME=sT;const PA="KHR_texture_basisu";class g2{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=eS(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=eS(e).dataFormatDescriptor[0];if(t.colorModel===163)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===166)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=eS(e),n=this.getChannels(e)>3;let i=0;for(let o=0;o<t.levels.length;o++){const a=t.levels[o];i+=a.uncompressedByteLength?a.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o)))/4)*(n?16:8)}return i}}class aT extends Zr{constructor(...e){super(...e),this.extensionName=PA,this.prereadTypes=[pn.TEXTURE]}static register(){nd.registerFormat("image/ktx2",new g2)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions[PA]&&(t.source=t.extensions[PA].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const i=e.imageIndexMap.get(n);t.json.textures.forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[PA]={source:o.source},delete o.source)})}}),this}}aT.EXTENSION_NAME=PA;class lT extends js{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[pn.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}lT.EXTENSION_NAME="KHR_texture_transform";const dv="KHR_texture_transform";class cT extends Zr{constructor(...e){super(...e),this.extensionName=dv}createTransform(){return new lT(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[dv])continue;const i=this.createTransform(),o=n.extensions[dv];o.offset!==void 0&&i.setOffset(o.offset),o.rotation!==void 0&&i.setRotation(o.rotation),o.scale!==void 0&&i.setScale(o.scale),o.texCoord!==void 0&&i.setTexCoord(o.texCoord),t.setExtension(dv,i)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,i]of t){const o=n.getExtension(dv);if(!o)continue;i.extensions=i.extensions||{};const a={},c=Hr.eq;c(o.getOffset(),[0,0])||(a.offset=o.getOffset()),o.getRotation()!==0&&(a.rotation=o.getRotation()),c(o.getScale(),[1,1])||(a.scale=o.getScale()),o.getTexCoord()!=null&&(a.texCoord=o.getTexCoord()),i.extensions[dv]=a}return this}}cT.EXTENSION_NAME=dv;const v2=[pn.ROOT,pn.SCENE,pn.NODE,pn.MESH,pn.MATERIAL,pn.TEXTURE,pn.ANIMATION];class uT extends js{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=v2}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",im({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=im({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return im({"@context":rS(this.get("context"))},rS(this.get("properties")))}fromJSONLD(e){const t=(e=rS(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function rS(s){return JSON.parse(JSON.stringify(s))}uT.EXTENSION_NAME="KHR_xmp_json_ld";const xp="KHR_xmp_json_ld";class hT extends Zr{constructor(...e){super(...e),this.extensionName=xp}createPacket(){return new uT(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[xp];if(!n||!n.packets)return this;const i=e.jsonDoc.json,o=this.document.getRoot(),a=n.packets.map(d=>this.createPacket().fromJSONLD(d)),c=[[i.asset],i.scenes,i.nodes,i.meshes,i.materials,i.images,i.animations],u=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let d=0;d<c.length;d++){const m=c[d]||[];for(let g=0;g<m.length;g++){const _=m[g];_.extensions&&_.extensions[xp]&&u[d][g].setExtension(xp,a[_.extensions[xp].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const i of this.properties){n.push(i.toJSONLD());for(const o of i.listParents()){let a;switch(o.propertyType){case pn.ROOT:a=t.asset;break;case pn.SCENE:a=t.scenes[e.sceneIndexMap.get(o)];break;case pn.NODE:a=t.nodes[e.nodeIndexMap.get(o)];break;case pn.MESH:a=t.meshes[e.meshIndexMap.get(o)];break;case pn.MATERIAL:a=t.materials[e.materialIndexMap.get(o)];break;case pn.TEXTURE:a=t.images[e.imageIndexMap.get(o)];break;case pn.ANIMATION:a=t.animations[e.animationIndexMap.get(o)];break;default:a=null,this.document.getLogger().warn(`[${xp}]: Unsupported parent property, "${o.propertyType}"`)}a&&(a.extensions=a.extensions||{},a.extensions[xp]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[xp]={packets:n}),this}}hT.EXTENSION_NAME=xp;const _2=[pM,nS,_M,AM,IA,MM,IM,BM,LM,UM,FM,QM,YM,qM,JM,$M,nT,rT,oT,aT,cT,hT];class dT extends VE{constructor(e){super(),this._loadedLibs=!1,e=e||{method:IA.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new FR().registerExtensions(_2).registerExtensions([pT,fx,ux,hx,dx,mx,gx,vx,_x,yx,Ax,bx,wx,Ex,xx,Sx,px]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:n,...i}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,i);await this._loadLibs();const o={...i};t&&(o.externalImagesInExtras=!0);const a=await new Promise((_,w)=>this.parse(e,_,w,o)),c=await super.parseAsync(a,o);if(!t)return c;if(!a)throw new Error("GLTFDracoExporter: gltf is null");let u=a;const d=u.byteLength||1/0,m=await(typeof u!="object"||u.byteLength?this._io.readBinary(new Uint8Array(u)):this._io.readJSON({json:u,resources:{}}));if(m.createExtension(IA).setRequired(!0).setEncoderOptions({...this._encoderOptions,...n??{}}),o.exportExt==="glb")u=await this._io.writeBinary(m),isFinite(d)&&console.log("DRACO Compression ratio: "+(u.byteLength/d).toFixed(5));else{const _=await this._io.writeJSON(m);u=_.json,Object.values(_.resources).filter(w=>w).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),u.resources=_.resources)}u.__isGLTFOutput=!0;const g=await super.parseAsync(u,o);if(!g)throw new Error("GLTFDracoExporter: blob is null");return g.ext="glb",g.__uncompressed=c,g}}class sS extends En{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Qt,nm]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,n=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(i,o,a){GE(i,o,dT,c=>{const u=ns()+".drc",d=c;d.loader=a.registerFile(u),d.loader.setDecoderConfig({type:"js"}),d.loader.preload(!0,!0)})})(n,e,t)}}sS.PluginType="GLTFDracoExportPlugin";class y2 extends js{constructor(){super(...arguments),this.extensionName=ra,this.parentTypes=[pn.SCENE],this.propertyType="ViewerJSON"}init(){}}class pT extends Zr{constructor(){super(...arguments),this.extensionName=ra,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},(t=e.jsonDoc.json.scenes)==null||t.forEach((n,i)=>{if(n.extensions&&n.extensions[ra]){const o=new y2(this.document.getGraph());e.scenes[i].setExtension(ra,o),this._viewerConfig=n.extensions[ra]}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var n;if(t.getExtension(ra)){const i=(n=e.jsonDoc.json.scenes)==null?void 0:n[e.jsonDoc.json.scene||0];i&&Object.keys(this._viewerConfig).length>0&&(i.extensions=i.extensions||{},i.extensions[ra]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}pT.EXTENSION_NAME=ra;class cx extends js{addTexture(e,t,n,i=4369){this.setRef(e,n,{channels:i}),this.textures[e]=[t,n]}constructor(e,t,n){super(e,t),this.parentTypes=[pn.MATERIAL,pn.MESH,pn.NODE,pn.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}init(){}}class Ya extends Zr{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,a)=>{var c;if(o.extensions&&o.extensions[this.extensionName]){const u=new cx(this.document.getGraph(),"",this.extensionName);e.materials[a].setExtension(this.extensionName,u);const d={...o.extensions[this.extensionName]};for(const[m,g]of Object.entries(d))if(typeof(g==null?void 0:g.index)=="number"){const _=g,w=(c=i[_.index])==null?void 0:c.source;if(typeof w!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",_);continue}const x=e.textures[w],T=new Qr(this.document.getGraph()),I=this.textureChannels[m]??4369;u.addTexture(m,T,x,I),e.setTextureInfo(T,_),delete d[m]}u.setExtras(d)}}),(t.json.meshes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const c=new cx(this.document.getGraph(),"",this.extensionName);e.meshes[a].setExtension(this.extensionName,c);const u=o.extensions[this.extensionName];c.setExtras(u)}}),(t.json.nodes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const c=new cx(this.document.getGraph(),"",this.extensionName);e.nodes[a].setExtension(this.extensionName,c);const u=o.extensions[this.extensionName];c.setExtras(u)}}),(t.json.scenes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const c=new cx(this.document.getGraph(),"",this.extensionName);e.scenes[a].setExtension(this.extensionName,c);const u=o.extensions[this.extensionName];c.setExtras(u)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c={...i.getExtras()};for(const[u,d]of Object.entries(i.textures)){const m=d[0],g=d[1];g&&(c[u]=e.createTextureInfoDef(g,m))}a.extensions[this.extensionName]=c}}),this.document.getRoot().listMeshes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.meshIndexMap.get(n),a=t.json.meshes[o];a.extensions=a.extensions||{},a.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.nodeIndexMap.get(n),a=t.json.nodes[o];a.extensions=a.extensions||{},a.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listScenes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.jsonDoc.json.scene||0,a=t.json.scenes[o];if(!a)return;a.extensions=a.extensions||{},a.extensions[this.extensionName]=i.getExtras()}}),this}}class ux extends Ya{constructor(){super(...arguments),this.extensionName=ux.EXTENSION_NAME,this.textureChannels={bumpTexture:Ps.R}}}ux.EXTENSION_NAME=Od;class hx extends Ya{constructor(){super(...arguments),this.extensionName=hx.EXTENSION_NAME,this.textureChannels={lightMapTexture:Ps.R|Ps.G|Ps.B}}}hx.EXTENSION_NAME=no;class dx extends Ya{constructor(){super(...arguments),this.extensionName=dx.EXTENSION_NAME,this.textureChannels={alphaTexture:Ps.G}}}dx.EXTENSION_NAME=kd;class px extends Ya{constructor(){super(...arguments),this.extensionName=px.EXTENSION_NAME,this.textureChannels={displacementTexture:Ps.R}}}px.EXTENSION_NAME=Ld;class fx extends Ya{constructor(){super(...arguments),this.extensionName=fx.EXTENSION_NAME}}fx.EXTENSION_NAME=br.DIAMOND_GLTF_EXTENSION;class mx extends Ya{constructor(){super(...arguments),this.extensionName=mx.EXTENSION_NAME}}mx.EXTENSION_NAME=sr.AnimationMarkersExtension;class gx extends Ya{constructor(){super(...arguments),this.extensionName=gx.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Ps.R|Ps.G|Ps.B}}}gx.EXTENSION_NAME=va.ANISOTROPY_GLTF_EXTENSION;class vx extends Ya{constructor(){super(...arguments),this.extensionName=vx.EXTENSION_NAME,this.textureChannels={customBumpMap:Ps.R|Ps.G|Ps.B}}}vx.EXTENSION_NAME=Go.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class _x extends Ya{constructor(){super(...arguments),this.extensionName=_x.EXTENSION_NAME}}_x.EXTENSION_NAME=sa;class yx extends Ya{constructor(){super(...arguments),this.extensionName=yx.EXTENSION_NAME}}yx.EXTENSION_NAME=ka;class Ax extends Ya{constructor(){super(...arguments),this.extensionName=Ax.EXTENSION_NAME}}Ax.EXTENSION_NAME=oa;class bx extends Ya{constructor(){super(...arguments),this.extensionName=bx.EXTENSION_NAME}}bx.EXTENSION_NAME=jl.CLEARCOAT_TINT_GLTF_EXTENSION;class wx extends Ya{constructor(){super(...arguments),this.extensionName=wx.EXTENSION_NAME}}wx.EXTENSION_NAME=Va.THIN_FILM_LAYER_GLTF_EXTENSION;class xx extends Ya{constructor(){super(...arguments),this.extensionName=xx.EXTENSION_NAME}}xx.EXTENSION_NAME=xc.TRIPLANAR_GLTF_EXTENSION;class Ex extends Ya{constructor(){super(...arguments),this.extensionName=Ex.EXTENSION_NAME}}Ex.EXTENSION_NAME=Fl.SSBEVEL_GLTF_EXTENSION;class Sx extends Ya{constructor(){super(...arguments),this.extensionName=Sx.EXTENSION_NAME}}Sx.EXTENSION_NAME=ba.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class fT extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}fT.PluginType="PMREMGenerator";const mT=new p.Pa4,A2=new p._fP,gT=new p.Pa4;class b2 extends p.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const od=new p.yGw,w2=new p.yGw;class x2{constructor(e={}){const t=this;let n,i,o,a;const c={camera:{fov:0,style:""},objects:new WeakMap},u=e.element!==void 0?e.element:document.createElement("div");u.style.overflow="hidden",this.domElement=u;const d=document.createElement("div");d.style.transformOrigin="0 0",d.style.pointerEvents="none",u.appendChild(d);const m=document.createElement("div");function g(T){return Math.abs(T)<1e-10?0:T}function _(T){const I=T.elements;return"matrix3d("+g(I[0])+","+g(-I[1])+","+g(I[2])+","+g(I[3])+","+g(I[4])+","+g(-I[5])+","+g(I[6])+","+g(I[7])+","+g(I[8])+","+g(-I[9])+","+g(I[10])+","+g(I[11])+","+g(I[12])+","+g(-I[13])+","+g(I[14])+","+g(I[15])+")"}function w(T){const I=T.elements;return"translate(-50%,-50%)matrix3d("+g(I[0])+","+g(I[1])+","+g(I[2])+","+g(I[3])+","+g(-I[4])+","+g(-I[5])+","+g(-I[6])+","+g(-I[7])+","+g(I[8])+","+g(I[9])+","+g(I[10])+","+g(I[11])+","+g(I[12])+","+g(I[13])+","+g(I[14])+","+g(I[15])+")"}function x(T,I,R,M){if(T.isCSS3DObject){const C=T.visible===!0&&T.layers.test(R.layers)===!0;if(T.element.style.display=C===!0?"":"none",C===!0){let L;T.onBeforeRender(t,I,R),T.isCSS3DSprite?(od.copy(R.matrixWorldInverse),od.transpose(),T.rotation2D!==0&&od.multiply(w2.makeRotationZ(T.rotation2D)),T.matrixWorld.decompose(mT,A2,gT),od.setPosition(mT),od.scale(gT),od.elements[3]=0,od.elements[7]=0,od.elements[11]=0,od.elements[15]=1,L=w(od)):L=w(T.matrixWorld);const k=T.element,j=c.objects.get(T);if(j===void 0||j.style!==L){k.style.transform=L;const H={style:L};c.objects.set(T,H)}k.parentNode!==m&&m.appendChild(k),T.onAfterRender(t,I,R)}}for(let C=0,L=T.children.length;C<L;C++)x(T.children[C],I,R)}m.style.transformStyle="preserve-3d",d.appendChild(m),this.getSize=function(){return{width:n,height:i}},this.render=function(T,I){const R=I.projectionMatrix.elements[5]*a;let M,C;c.camera.fov!==R&&(d.style.perspective=I.isPerspectiveCamera?R+"px":"",c.camera.fov=R),I.view&&I.view.enabled?(d.style.transform=`translate( ${-I.view.offsetX*(n/I.view.width)}px, ${-I.view.offsetY*(i/I.view.height)}px )`,d.style.transform+=`scale( ${I.view.fullWidth/I.view.width}, ${I.view.fullHeight/I.view.height} )`):d.style.transform="",T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),I.parent===null&&I.matrixWorldAutoUpdate===!0&&I.updateMatrixWorld(),I.isOrthographicCamera&&(M=-(I.right+I.left)/2,C=(I.top+I.bottom)/2);const L=I.view&&I.view.enabled?I.view.height/I.view.fullHeight:1,k=I.isOrthographicCamera?`scale( ${L} )scale(`+R+")translate("+g(M)+"px,"+g(C)+"px)"+_(I.matrixWorldInverse):`scale( ${L} )translateZ(`+R+"px)"+_(I.matrixWorldInverse),j=k+"translate("+o+"px,"+a+"px)";c.camera.style!==j&&(m.style.transform=j,c.camera.style=j),x(T,T,I)},this.setSize=function(T,I){n=T,i=I,o=n/2,a=i/2,u.style.width=T+"px",u.style.height=I+"px",d.style.width=T+"px",d.style.height=I+"px",m.style.width=T+"px",m.style.height=I+"px"}}}var Cx,Mx=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ad=Cx=class extends En{constructor(s=!0){super(),this._scene=new p.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var i,o,a,c,u;const e=(o=(i=this._viewer)==null?void 0:i.getPlugin(Ti))==null?void 0:o.getSelectedObject();if(!(e!=null&&e.geometry))return void await((a=this._viewer)==null?void 0:a.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const t=await((c=this._viewer)==null?void 0:c.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!t)return;const n=await((u=this._viewer)==null?void 0:u.prompt("Width: Enter the width for the object.","512",!1))||"512";n&&this.attachIFrame(e,t,parseInt(n))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)==null||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=s,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const s=this._viewer;s&&this._renderer&&(s.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",s.canvas):this._renderer.domElement.appendChild(s.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new x2;const s=this._viewer.renderer.rendererObject.getSize(new p.FM8);this._renderer.setSize(s.width,s.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const t=this._viewer.renderer.rendererObject.getSize(new p.FM8);this._renderer.setSize(t.width,t.height)})}async onAdded(s){await super.onAdded(s);let e=!0,t=!0;s.addEventListener("postFrame",o=>{var a,c;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(t&&this._trackers.forEach(u=>{var g,_;let d=!0;const m=u.modelObj.material.side;if(m!==p.ehD){const w=new p.Pa4(0,0,1).applyQuaternion(u.cssObj.quaternion),x=(_=(g=this._viewer)==null?void 0:g.scene.activeCamera)==null?void 0:_.cameraObject,T=w.dot(x.getWorldDirection(new p.Pa4));d=m===p._Li?T>0:T<0}u.cssObj.element.style.visibility=d?"visible":"hidden"}),this._trackers.filter(u=>u.dirty).forEach(u=>this._syncProperties(u)),(c=this._renderer)==null||c.render(this._scene,(a=s.scene.activeCamera)==null?void 0:a.cameraObject),e=!1))}),s.addEventListener("update",o=>{this.enabled&&(e=this._trackers.length>0)}),s.scene.addEventListener("sceneUpdate",o=>{this.enabled&&(this._trackers.forEach(a=>a.dirty=!0),e=this._trackers.length>0)}),s.scene.addEventListener("activeCameraUpdate",o=>{this.enabled&&(e=this._trackers.length>0,t=!0)});let n=!1;const i=new p.iMs;s.container.addEventListener("mousemove",o=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const a=this._viewer.canvas.getBoundingClientRect(),c=(o.clientX-a.x)/a.width*2-1,u=-(o.clientY-a.y)/a.height*2+1;i.setFromCamera({x:c,y:u},this._viewer.scene.activeCamera.cameraObject);const d=this._trackers.map(g=>g.modelObj),m=i.intersectObjects(d,!1);if(console.log(m),m.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)})}attachIFrame(s,e,t){const n=Ix(s.modelObject),i=vT(e,t,t*n.y/n.x,()=>{var o;return(o=s.setDirty)==null?void 0:o.call(s)});return this.attachCSS3DObject(i,s),i}attachCSS3DObject(s,e){var n,i,o,a,c;if(this._trackers.push({cssObj:s,modelObj:e.modelObject,dirty:!0}),s.element&&(this._resizeObserver.observe(s.element),s.element.__isCSS3DObjectElement=!0,console.log(s.element,s.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const t=(n=this._viewer)==null?void 0:n.createMaterial("basic",{opacity:0,color:new p.Ilk("black"),blending:p.jFi,side:p.Wl3});if(!t)throw"cannot create mat";t.userData.forcedLinearDepth=0,(i=e.setMaterial)==null||i.call(e,t),Tx(e.modelObject),oS(e.modelObject),Ix(e.modelObject),this._scene.add(s),(a=(o=this.uiConfig)==null?void 0:o.uiRefresh)==null||a.call(o),(c=e.setDirty)==null||c.call(e)}_syncProperties(s){const e=s.modelObj,t=s.cssObj;e.updateMatrixWorld();const n=s.cssObj.element.clientWidth<1.5?0:(s.cssObj.element.clientWidth-1.5)/Ix(e).x,i=Tx(e);t.quaternion.setFromUnitVectors(new p.Pa4(0,0,1),i),t.position.copy(oS(e)),t.scale.set(1,1,1).multiplyScalar(1/n),t.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),s.dirty=!1}async onDispose(s){return this._resizeObserver.disconnect(),super.onDispose(s)}};function vT(s,e,t,n){const i=document.createElement("div");i.style.width=e.toString()+"px",i.style.height=t.toString()+"px",i.style.backgroundColor="transparent";const o=document.createElement("iframe",{is:"x-frame-bypass"});o.style.width="100%",o.style.height="100%",o.style.border="0px";const a=()=>{var c;try{o.contentWindow.name}catch(u){(typeof u=="string"?u:((c=u==null?void 0:u.toString)==null?void 0:c.call(u))??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(u)}n(),o.removeEventListener("load",a)};return o.addEventListener("load",a),o.src=s,i.appendChild(o),new b2(i)}function Tx(s){if(s.geometry.userData.geometryNormal)return s.geometry.userData.geometryNormal;const e=s.geometry.attributes.normal,t=new p.Pa4,n=new p.Pa4;for(let i=0,o=e.count;i<o;i++)t.fromBufferAttribute(e,i),n.add(t);return n.normalize(),s.geometry.userData.geometryNormal=n,n}function oS(s){if(s.geometry.userData.geometryCenter)return s.geometry.userData.geometryCenter;const e=s.geometry;if(!e)return new p.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const t=e.boundingBox.getCenter(new p.Pa4);return s.geometry.userData.geometryCenter=t,t}function Ix(s,e=new p.Pa4(0,0,1)){if(s.geometry.userData.geometrySize)return s.geometry.userData.geometrySize;const t=s.geometry;if(!t)return new p.Pa4(0,0,0);const n=t.clone();n.applyMatrix4(new p.yGw().makeRotationFromQuaternion(new p._fP().setFromUnitVectors(e,Tx(s)).invert())),n.computeBoundingBox();const i=n.boundingBox.getSize(new p.Pa4);return s.geometry.userData.geometrySize=i,n.dispose(),i}ad.PluginType="CSS3DRenderer",Mx([Gt("Enabled"),(0,V.onChange)(Cx.prototype._refreshEnabled),Ae()],ad.prototype,"enabled",void 0),Mx([Gt("Over canvas"),(0,V.onChange)(Cx.prototype._refreshCanvasInDOM),Ae()],ad.prototype,"overCanvas",void 0),Mx([Ai("Attach iframe")],ad.prototype,"attachIFrameToSelected",void 0),ad=Cx=Mx([Hn("CSS3D Renderer")],ad);class E2 extends ou{constructor(e,t,n,i=new p.Ilk(1,1,1),o=1){super(void 0,void 0,n,i,o),this.target=t,this._getSelectedObject=e}render(e,t,n,i,o){const a=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=this._getSelectedObject();if(d)this._renderSelectedObject(e,d,t,i,o);else{e.setRenderTarget(this.target);const m=new p.Ilk;e.getClearColor(m),e.setClearColor(new p.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(m)}e.setRenderTarget(a,c,u)}_renderSelectedObject(e,t,n,i,o){if(!this.camera)return;t.traverse(u=>{u.layers.enable(6)});const a=this.camera.layers.mask;this.camera.layers.set(6);const c=e.userData;c||console.error("threejs is not patched?"),c.transmissionRenderTarget=n,Vt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(e,n,this.target,i,o)),c.transmissionRenderTarget=void 0,t.traverse(u=>{u.layers.disable(6)}),this.camera.layers.mask=a}}var Ep,rm=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Wu=Ep=class{constructor(s,e){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new p.Ilk(15305317),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new p.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new p.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(t,n)=>this.enabled?V.glsl`
            ${vo}
            ${`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`}
        `:"",this._combinedPostPlugin=s.getPlugin(Fa),this._pickingPlugin=s.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),e&&(this.extraUniforms.outlineBuffer.value=e.texture),this._enable()}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Sn(s.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var s;(s=this.__setDirty)==null||s.call(this),this._setDirty()}_enable(){var s;(s=this._pickingPlugin)==null||s.enableWidget(!this.enabled),this._setDirty()}};Wu.PluginType="Outline",rm([(0,V.onChange)(Ep.prototype._enable),Gt("Enable"),Ae()],Wu.prototype,"enabled",void 0),rm([(0,V.onChange)(Ep.prototype._setDirty),Gt("Highlight"),Ae()],Wu.prototype,"enableHighlight",void 0),rm([(0,V.onChange)(Ep.prototype._setDirty),Gt("DynamicSelection"),Ae()],Wu.prototype,"enableDynamicSelection",void 0),rm([(0,V.onChange)(Ep.prototype._setDirty),cn("Intensity",[0,2],.001,{limitedUi:!0}),Ae()],Wu.prototype,"outlineIntensity",void 0),rm([(0,V.onChange)(Ep.prototype._setDirty),cn("Transparency",[0,1],.01,{limitedUi:!0}),Ae()],Wu.prototype,"highlightTransparency",void 0),rm([(0,V.onChange)(Ep.prototype._setDirty),Zo("Color"),Ae()],Wu.prototype,"outlineColor",void 0),rm([(0,V.onChange)(Ep.prototype._setDirty),Gt("Debug")],Wu.prototype,"debugOutline",void 0),Wu=Ep=rm([Hn("Outline")],Wu);class RA extends Hc{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new Wu(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=e==null?void 0:e.getPluginByType("Picking");t||console.error("OutlinePlugin requires PickingPlugin to be added to the viewer");const n=new p.jyz({uniforms:{cameraNearFar:{value:new p.FM8(.1,100)}},vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:p.ehD}),i=sc(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new E2(()=>t==null?void 0:t.getSelectedObject(),this._outlineTarget,n),update(){e.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),i.passObject.scene=e.scene.modelObject,i.passObject.camera=e.scene.renderCamera.cameraObject}});e.renderer.registerPass(i),t==null||t.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(t!=null&&t.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",o=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const a=t==null?void 0:t.getSelectedObject();a&&this._extension.enableDynamicSelection?o.target!==e.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=a?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,t,n){return wg(this._extension,"transparency",{from:e,to:t,duration:n,onComplete:()=>{this._animationCallBack=null}})}}RA.PluginType="Outline";const Px=.2,S2=Math.PI/24,_T=new p.FM8,Rx=(s,e,t)=>{let n=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let i=0;i<=12;++i)s.push(e+.17*Math.cos(n),t+.17*Math.sin(n),0,e+Px*Math.cos(n),t+Px*Math.sin(n),0),n+=S2};class yT extends p.Kj0{constructor(e,t,n=!1){super(((u,d)=>{const m=new p.u9r,g=[],_=[],w=u.getSize(new p.Pa4),x=w.x/2,T=(d?w.y:w.z)/2;Rx(_,x,T),Rx(_,-x,T),Rx(_,-x,-T),Rx(_,x,-T);const I=_.length/3;for(let M=0;M<I-2;M+=2)g.push(M,M+1,M+3,M,M+3,M+2);const R=I-2;return g.push(R,R+1,1,R,1,0),m.setAttribute("position",new p.a$l(_,3)),m.setIndex(g),m})(e,n)),this.boundingSize=new p.Pa4,this._raycaster=new p.iMs,this._camera=t,this._placeOnWall=n;const i=this.material;i.side=p.Wl3,i.color=new p.Ilk(16711935),i.opacity=0,this.userData.bboxVisible=!1;const o=e.getSize(this.boundingSize),a=o.x/2,c=(n?o.y:o.z)/2;this.hitPlane=new p.Kj0(new p._12(2*(a+Px),2*(c+Px))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),n?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){_T.set(t,-n),this.hitPlane.visible=!0;const i=this._positionAndNormalFromPoint(_T,this.hitPlane);return this.hitPlane.visible=!1,i==null?null:i.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const i=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),i}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var n;const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.geometry.dispose(),this.material.dispose(),(n=this.parent)==null||n.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const n=this._raycaster.intersectObject(t,!0);if(n.length===0)return null;const i=n[0];return i.face==null?null:i.uv==null?{position:i.point,normal:i.face.normal,uv:null}:(i.face.normal.applyNormalMatrix(new p.Vkp().getNormalMatrix(i.object.matrixWorld)),{position:i.point,normal:i.face.normal,uv:i.uv})}}const aS=new p.Pa4;class AT{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new p.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new p.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new p.Pa4,this._hitMatrix=new p.yGw,this.xDamper=new V.Damper,this.yDamper=new V.Damper,this.zDamper=new V.Damper,this.yawDamper=new V.Damper,this.scaleDamper=new V.Damper,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(t==null)return;const n=this.frame.getHitTestResultsForTransientInput(t),i=this.presentedScene,o=this.placementBox;if(n.length===1){this.inputSource=e.inputSource;const{axes:a}=this.inputSource.gamepad||{axes:[0,0]},c=o.getHit(i,a[0],a[1]);o.show=!0,c!=null?(this.isTranslating=!0,this.lastDragPosition.copy(c),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*a[0])}else if(n.length===2){o.show=!0,this.isTwoFingering=!0;const{separation:a}=this.fingerPolar(n);this.firstRatio=a/i.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n){var i;this.transientHitTestSource=await((i=e.requestHitTestSourceForTransientInput)==null?void 0:i.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var i;const t=(i=this.xr)==null?void 0:i.getReferenceSpace(),n=t?e.getPose(t):null;return n?(this._hitMatrix.fromArray(n.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,i=t.rotation.y,o=this.placementBox,a=Math.max(o.boundingSize.x,o.boundingSize.y,o.boundingSize.z)/2,c=this.goalPosition,u=t.scale.x;if(!c.equals(n)||this.goalScale!==u){let{x:d,y:m,z:g}=n;d=this.xDamper.update(d,c.x,e,a),m=this.yDamper.update(m,c.y,e,a),g=this.zDamper.update(g,c.z,e,a),n.set(d,m,g);const _=this.scaleDamper.update(u,this.goalScale,e,1);if(t.scale.set(_,_,_),!this.isTranslating){const w=c.y-m;this.placementComplete&&!this.placeOnWall?o.offsetHeight=w/_:w===0&&(this.placementComplete=!0,o.show=!1)}}o.updateOpacity(e),t.rotation.y=this.yawDamper.update(i,this.goalYaw,e,Math.PI)}processInput(e){var a;this.frame=e;const t=this.transientHitTestSource;if(!t||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const n=e.getHitTestResultsForTransientInput(t),i=this.presentedScene,o=i.scale.x;if(this.isTwoFingering)if(n.length<2)this.isTwoFingering=!1;else{const{separation:c,deltaYaw:u}=this.fingerPolar(n);if(this.placeOnWall||(this.goalYaw+=u),!i.userData.__scaleDisabled){const d=c/this.firstRatio;this.goalScale=d<1.3&&d>.7692307692307692?1:d}}else if(n.length!==2)if(this.isRotating&&((a=this.inputSource)!=null&&a.gamepad)){const c=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=c-this.lastAngle,this.lastAngle=c}else this.isTranslating&&(console.log("translating"),n.forEach(c=>{if(c.inputSource!==this.inputSource)return;let u=null;if(c.results.length>0&&(u=this.getHitPoint(c.results[0])),u==null&&(u=this.getTouchLocation()),u!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const d=u.y-this.lastDragPosition.y;if(d<0){this.placementBox.offsetHeight=d/o;const m=aS.copy(this.xr.getCamera().position),g=-d/(m.y-u.y);m.multiplyScalar(g),u.multiplyScalar(1-g).add(m)}}this.goalPosition.add(u),this.lastDragPosition.copy(u)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:c}=this.fingerPolar(n);this.firstRatio=c/o}}getTouchLocation(){var n;const{axes:e}=this.inputSource.gamepad??{axes:[0,0]},t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return t!=null&&(aS.copy(t).sub((n=this.xr)==null?void 0:n.getCamera().position),aS.length()>10)?null:t}fingerPolar(e){var u,d,m,g;const t=((d=(u=e[0].inputSource)==null?void 0:u.gamepad)==null?void 0:d.axes)??[0,0],n=((g=(m=e[1].inputSource)==null?void 0:m.gamepad)==null?void 0:g.axes)??[0,0],i=n[0]-t[0],o=n[1]-t[1],a=Math.atan2(o,i);let c=this.lastAngle-a;return c>Math.PI?c-=2*Math.PI:c<-Math.PI&&(c+=2*Math.PI),this.lastAngle=a,{separation:Math.sqrt(i*i+o*o),deltaYaw:c}}}class C2{constructor(e,t,n,i,o){this.xrLight=e,this.renderer=t,this.lightProbe=n,this.xrWebGLBinding=null,this.estimationStartCallback=o,this.frameCallback=this.onXRFrame.bind(this);const a=t.xr.getSession();if(i&&"XRWebGLBinding"in window){const c=new p.oAp(16);e.environment=c.texture;const u=t.getContext();switch(a.preferredReflectionFormat){case"srgba8":u.getExtension("EXT_sRGB");break;case"rgba16f":u.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(a,u),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}a.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const i=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/i,n.primaryLightIntensity.y/i,n.primaryLightIntensity.z/i),this.xrLight.directionalLight.intensity=i,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class M2 extends p.ZAu{constructor(e,t=!0){super(),this.lightProbe=new p.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new p.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let n=null,i=!1;e.xr.addEventListener("sessionstart",()=>{const o=e.xr.getSession();"requestLightProbe"in o&&o.requestLightProbe({reflectionFormat:o.preferredReflectionFormat}).then(a=>{n=new C2(this,e,a,t,()=>{i=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{n&&(n.dispose(),n=null),i&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{n&&(n.dispose(),n=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var X_=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Sp=class extends En{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new AT,this.dependencies=[Ii],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var s;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):this._xrManager?(this._xrManager.enabled=!0,(s=this._xrManager)==null||s.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{var n;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const s=this._xrManager.getCamera(),e=((n=s.cameras)==null?void 0:n[0])||s,t=this._viewer.scene.activeCamera;t.cameraObject.projectionMatrix.copy(e.projectionMatrix),t.cameraObject.projectionMatrixInverse.copy(t.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var t,n;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,e=(n=(t=this._xrManager)==null?void 0:t.getCamera())==null?void 0:n.cameras[0].viewport;e?s.rendererObject.setViewport(e):console.warn("no viewport for ar camera"),this._viewer.getPlugin(Ii).updateShaderProperties(Y_.material),Y_.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,Vt(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{Y_.render(s.rendererObject,null,s.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:s,deltaTime:e})=>{var o,a;if(this.dirty=!!s&&((o=this._xrManager)==null?void 0:o.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!s)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const t=this._xrManager.getReferenceSpace(),n=s.getViewerPose(t);if(n==null&&this._frameCount,n==null||((a=this._viewer)==null?void 0:a.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const i=this._viewer.scene.activeCamera;this._xrManager.updateCamera(i.cameraObject),i.setDirty(),this.moveToFloor(s),this._touchInputHelper.processInput(s),this._touchInputHelper.moveScene(e),this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new p.Pa4(1,1,1),modelPosition:new p.Pa4,modelRotation:new p._fP,cameraPosition:new p.Pa4(0,0,5),cameraTarget:new p.Pa4,cameraUp:new p.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectionMatrix:new p.yGw,cameraAutoNearFar:void 0,groundOffset:new p.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new p.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var n;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(n=this._viewer.scene.backgroundColor)==null?void 0:n.getHex();const s=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera;s.updateMatrix(),s.updateMatrixWorld(!0),this._preXRState.modelScale.copy(s.scale),this._preXRState.modelPosition.copy(s.position),this._preXRState.modelRotation.copy(s.quaternion),this._preXRState.cameraPosition.copy(e.position),this._preXRState.cameraTarget.copy(e.target),this._preXRState.cameraUp.copy(e.cameraObject.up),e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=e.cameraObject.fov,this._preXRState.cameraAspect=e.cameraObject.aspect),this._preXRState.cameraZoom=e.cameraObject.zoom,this._preXRState.cameraNear=e.cameraObject.near,this._preXRState.cameraFar=e.cameraObject.far,this._preXRState.cameraAutoNearFar=e.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectionMatrix.copy(e.cameraObject.projectionMatrix);const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(this._preXRState.groundOffset.subVectors(s.position,t.mesh.modelObject.position),this._preXRState.groundScale=t.mesh.modelObject.scale.x,this._preXRState.groundRotation=t.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=t.renderToDepth,this._preXRState.groundShadowBaker=t.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const s=20*Math.PI/180,e=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(s),z:-Math.cos(s)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var t,n;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const i=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((n=(t=this._xrSession).requestHitTestSource)==null?void 0:n.call(t,{space:i,offsetRay:e}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async s=>{s.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new M2(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(s),this._xrSession=s},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(s){await super.onAdded(s);const e=s.renderer.rendererObject.xr;if(e.cameraAutoUpdate=!1,this._xrManager=e,this._touchInputHelper.xr=e,!this.domOverlay){const t=document.getElementById("tweakpaneUiContainer");this.domOverlay=t?{root:t}:void 0}if(s.addEventListener("preRender",this._preRender),s.addEventListener("postRender",this._postRender),s.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return s.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(t=>{if(!t)throw new Error("AR not supported")}).catch(t=>{s.console.error("AR not supported:",t),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var t,n;if(!this._viewer)return;const s=this._viewer.scene.modelRoot,e=(n=(t=this._viewer.getPluginByType("Ground"))==null?void 0:t.mesh)==null?void 0:n.modelObject;e&&(e.rotation.z=this._viewer.scene.modelRoot.rotation.y,e.position.copy(this._preXRState.groundOffset).multiplyScalar(s.modelObject.scale.x).sub(s.modelObject.position).negate(),e.scale.setScalar(s.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(s){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const e=s.getHitTestResults(this._hitTestSource);if(!e.length)return;const t=e[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const n=this._touchInputHelper.getHitPoint(t);if(!n)return;this._placementBox.show=!0;const i=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(n),i.position.copy(n),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var u,d;const s=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera,t=(u=this._xrManager)==null?void 0:u.getCamera(),n=t.cameras[0]||t;this._removePlacementBox();const i=this._viewer.scene.getBounds(!0,!0);i.getSize(new p.Pa4).length()>.01&&(this._placementBox=new yT(i,t,this.placeOnWall),s.add(this._placementBox),this._placementBox.show=!1);const o=t.getWorldDirection(new p.Pa4);s.rotation.y=Math.atan2(-o.x,-o.z)-0,e.cameraObject.zoom=n.zoom,e.cameraObject.near=n.near,e.cameraObject.far=n.far,e.cameraObject.userData.autoNearFar=!1,e.cameraObject.isPerspectiveCamera?(e.cameraObject.fov=n.fov,e.cameraObject.aspect=n.viewport.width/n.viewport.height):console.warn("Perspective camera required."),e.cameraObject.updateProjectionMatrix();const a=s.userData.arScale||1;s.scale.set(a,a,a),s.position.copy(t.position).add(o.multiplyScalar(5)),s.visible=!0;const c=(d=this._viewer)==null?void 0:d.getPluginByType("Ground");c!=null&&c.mesh&&(c.shadowBaker.enabled=!1,c.renderToDepth=!1)}_restorePreXRState(){var n;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((n=this._viewer.scene.backgroundColor)==null||n.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const s=this._viewer.scene.modelRoot;s.scale.copy(this._preXRState.modelScale),s.position.copy(this._preXRState.modelPosition),s.quaternion.copy(this._preXRState.modelRotation),s.updateMatrix(),s.updateMatrixWorld(!0),s.visible=!0;const e=this._viewer.scene.activeCamera;e.position.copy(this._preXRState.cameraPosition),e.target.copy(this._preXRState.cameraTarget),e.cameraObject.up.copy(this._preXRState.cameraUp),e.cameraObject.near=this._preXRState.cameraNear,e.cameraObject.far=this._preXRState.cameraFar,e.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(e.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(e.cameraObject.aspect=this._preXRState.cameraAspect)),e.positionUpdated(!1),e.targetUpdated(!0),e.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectionMatrix),e.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectionMatrix).invert(),e.cameraObject.updateMatrixWorld(!0),e.cameraObject.updateProjectionMatrix();const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(t.mesh.modelObject.position.subVectors(s.position,this._preXRState.groundOffset),t.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),t.mesh.modelObject.rotation.z=this._preXRState.groundRotation,t.renderToDepth=this._preXRState.groundRenderToDepth,t.shadowBaker.enabled=this._preXRState.groundShadowBaker,t.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};Sp.PluginType="WEBXR_ARPlugin",X_([Gt("Light Estimate")],Sp.prototype,"estimateLighting",void 0),X_([Gt("Place on Wall")],Sp.prototype,"placeOnWall",void 0),X_([cn("Resilution scale",[.1,1],.1)],Sp.prototype,"xrResolutionScale",void 0),X_([Ai("Enter AR")],Sp.prototype,"enterAR",void 0),X_([Ai("Exit AR")],Sp.prototype,"exitAR",void 0),Sp=X_([Hn("WebXR AR")],Sp);const Y_=new Fr({vertexShader:qe.vertexShader,fragmentShader:`
        ${vo}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...qe.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});Y_.renderToScreen=!1,Y_.useExistingRenderTarget=!0,Y_.clear=!1;var Dx=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let sm=class extends En{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Ii],this.xrResolutionScale=1,this.toJSON=void 0,this.enterVR=()=>{var s;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already inVR"):this._xrManager?(this._xrManager.enabled=!0,(s=this._xrManager)==null||s.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitVR=()=>{this._xrSession&&this._xrSession.end()},this._currentCameraIndex=0,this._preRender=()=>{var n;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const s=this._xrManager.getCamera(),e=((n=s.cameras)==null?void 0:n[this._currentCameraIndex])||s,t=this._viewer.scene.activeCamera;t.cameraObject.zoom=e.zoom,t.cameraObject.near=e.near,t.cameraObject.far=e.far,t.cameraObject.userData.autoNearFar=!1,t.cameraObject.isPerspectiveCamera?(t.cameraObject.fov=e.fov,t.cameraObject.aspect=e.viewport.width/e.viewport.height):console.warn("Perspective camera required."),t.cameraObject.position.copy(e.position),t.cameraObject.rotation.copy(e.rotation),t.cameraObject.updateMatrix(),t.cameraObject.updateProjectionMatrix(),t.cameraObject.projectionMatrix.copy(e.projectionMatrix),t.cameraObject.projectionMatrixInverse.copy(t.cameraObject.projectionMatrix).invert()},this._currentRt=null,this._postRender=()=>{var i,o,a;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,e=(s.rendererObject.getViewport(new p.Ltg),((o=(i=this._xrManager)==null?void 0:i.getCamera())==null?void 0:o.cameras)??[]),t=s.rendererObject.getRenderTarget(),n=(a=e[this._currentCameraIndex])==null?void 0:a.viewport;n?t&&s.rendererObject.setViewport(n):console.warn("no viewport for vr camera index",this._currentCameraIndex),this._viewer.getPlugin(Ii).updateShaderProperties(K_.material),K_.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,Vt(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{K_.render(s.rendererObject,null,s.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0,t&&s.rendererObject.setViewport(t.viewport),this._currentCameraIndex++,this._currentCameraIndex>=e.length&&(this._currentCameraIndex=0)},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:s,deltaTime:e})=>{var o,a;if(this.dirty=!!s&&((o=this._xrManager)==null?void 0:o.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!s)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: VR session init"),this._frameCount++;const t=this._xrManager.getReferenceSpace(),n=s.getViewerPose(t);if(n==null&&this._frameCount,n==null||((a=this._viewer)==null?void 0:a.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const i=this._viewer.scene.activeCamera;this._xrManager.updateCamera(i.cameraObject),i.setDirty(),this._viewer.rendersPerFrame=n?n.views.length:1,this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new p.Pa4(1,1,1),modelPosition:new p.Pa4,modelRotation:new p._fP,cameraPosition:new p.Pa4(0,0,5),cameraTarget:new p.Pa4,cameraUp:new p.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new p.yGw,cameraAutoNearFar:void 0,groundOffset:new p.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new p.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var n;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(n=this._viewer.scene.backgroundColor)==null?void 0:n.getHex();const s=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera;s.updateMatrix(),s.updateMatrixWorld(!0),this._preXRState.modelScale.copy(s.scale),this._preXRState.modelPosition.copy(s.position),this._preXRState.modelRotation.copy(s.quaternion),this._preXRState.cameraPosition.copy(e.position),this._preXRState.cameraTarget.copy(e.target),this._preXRState.cameraUp.copy(e.cameraObject.up),e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=e.cameraObject.fov,this._preXRState.cameraAspect=e.cameraObject.aspect),this._preXRState.cameraZoom=e.cameraObject.zoom,this._preXRState.cameraNear=e.cameraObject.near,this._preXRState.cameraFar=e.cameraObject.far,this._preXRState.cameraAutoNearFar=e.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(e.cameraObject.projectionMatrix);const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(this._preXRState.groundOffset.subVectors(s.position,t.mesh.modelObject.position),this._preXRState.groundScale=t.mesh.modelObject.scale.x,this._preXRState.groundRotation=t.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=t.renderToDepth,this._preXRState.groundShadowBaker=t.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.environment),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{this._xrSession&&this._viewer&&(console.log("webxr: VR session start"),this._viewer.renderer.stableNoise=!0,this._viewer.resize())},this._xrRenderingEnd=()=>{console.log("webxr: VR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async s=>{s.addEventListener("end",this._onSessionEnded),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(s),this._xrSession=s},this._onSessionEnded=()=>{this._xrSession&&this._xrSession.removeEventListener("end",this._onSessionEnded)}}async onAdded(s){await super.onAdded(s);const e=s.renderer.rendererObject.xr;if(e.cameraAutoUpdate=!1,this._xrManager=e,!this.domOverlay){const t=document.getElementById("tweakpaneUiContainer");this.domOverlay=t?{root:t}:void 0}if(s.addEventListener("preRender",this._preRender),s.addEventListener("postRender",this._postRender),s.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return s.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-vr").then(t=>{if(!t)throw new Error("VR not supported")}).catch(t=>{s.console.error("VR not supported:",t),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var t,n;if(!this._viewer)return;const s=this._viewer.scene.modelRoot,e=(n=(t=this._viewer.getPluginByType("Ground"))==null?void 0:t.mesh)==null?void 0:n.modelObject;e&&(e.rotation.z=this._viewer.scene.modelRoot.rotation.y,e.position.copy(this._preXRState.groundOffset).multiplyScalar(s.modelObject.scale.x).sub(s.modelObject.position).negate(),e.scale.setScalar(s.modelObject.scale.x*this._preXRState.groundScale))}_preSetupModel(){var n;const s=this._viewer.scene.modelRoot,e=s.userData.arScale||1;s.scale.set(e,e,e),s.visible=!0;const t=(n=this._viewer)==null?void 0:n.getPluginByType("Ground");t!=null&&t.mesh&&(t.shadowBaker.enabled=!1,t.renderToDepth=!1)}_restorePreXRState(){var n;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((n=this._viewer.scene.backgroundColor)==null||n.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const s=this._viewer.scene.modelRoot;s.scale.copy(this._preXRState.modelScale),s.position.copy(this._preXRState.modelPosition),s.quaternion.copy(this._preXRState.modelRotation),s.updateMatrix(),s.updateMatrixWorld(!0),s.visible=!0;const e=this._viewer.scene.activeCamera;e.position.copy(this._preXRState.cameraPosition),e.target.copy(this._preXRState.cameraTarget),e.cameraObject.up.copy(this._preXRState.cameraUp),e.cameraObject.near=this._preXRState.cameraNear,e.cameraObject.far=this._preXRState.cameraFar,e.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(e.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(e.cameraObject.aspect=this._preXRState.cameraAspect)),e.positionUpdated(!1),e.targetUpdated(!0),e.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),e.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),e.cameraObject.updateMatrixWorld(!0),e.cameraObject.updateProjectionMatrix();const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(t.mesh.modelObject.position.subVectors(s.position,this._preXRState.groundOffset),t.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),t.mesh.modelObject.rotation.z=this._preXRState.groundRotation,t.renderToDepth=this._preXRState.groundRenderToDepth,t.shadowBaker.enabled=this._preXRState.groundShadowBaker,t.refreshTransform()),this._viewer.scene.environment=this._preXRState.environment,this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){}};sm.PluginType="WEBXR_VRPluginBasic",Dx([cn("Resolution scale",[.1,1],.1)],sm.prototype,"xrResolutionScale",void 0),Dx([Ai("Enter VR")],sm.prototype,"enterVR",void 0),Dx([Ai("Exit VR")],sm.prototype,"exitVR",void 0),sm=Dx([Hn("WebXR VR")],sm);const K_=new Fr({vertexShader:qe.vertexShader,fragmentShader:`
        ${vo}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...qe.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});K_.renderToScreen=!1,K_.useExistingRenderTarget=!0,K_.clear=!1;class Bx extends V.SimpleEventDispatcher{get state(){return this._state}setState(e,t){this._state=e,this.dispatchEvent({type:e,...t})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=n=>{n.data&&n.data.size>0&&this._currentRecording.push(n.data)},this._canvas=e,t==null||t.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(t||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()})}}class bT extends Bx{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const t=await(e==null?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._frameCount=0,this.setState("recording")}).catch(e=>{this._onerror({detail:e})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob(t=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t])},e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const t=[];for(const n of e){const i=await this._imgDirectory.getFileHandle(n[0],{create:!0});t.push((0,V.writeFile)(i,n[1]))}await Promise.all(t)}}class DA extends Bx{_setOptions(e){var t;super._setOptions(e),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=DA.GetSupportedMimeTypes([],["h264"],!0)??DA.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!((t=this.options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(e,t),this._resumeSyncTime=0,this._onstop=n=>{var i;if(this._recorder&&this._currentRecording.length>0){const o=new Blob(this._currentRecording,{type:this.options.mimeType});(i=this._recordingCallback)==null||i.call(this,o)}this._recorder=void 0,this.setState("stopped")},this._onstart=n=>{var i;this._frameCount=0,this.options.stepMode&&((i=this._recorder)==null||i.pause()),this.setState("recording")},this._onresume=n=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const i=()=>{var a;this.state==="recording"&&((a=this._recorder)==null||a.pause())},o=Math.min(this._resumeSyncTime-(0,V.now)(),0)+1e3/this.options.frameRate;o>0?(0,V.timeout)(o).then(i):i()},this._onerror=n=>{this.setState("error",{error:n}),this._console.error(n),this._recorder=void 0}}start(){var t,n,i;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const e={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(t=e.mimeType)==null?void 0:t.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const o=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),a=(n=o.getVideoTracks())==null?void 0:n[0];this._track=a,this._recorder=new window.MediaRecorder(o,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((i=this._recorder)==null||i.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,V.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter(c=>!e||e.length<1||e.includes(c)),o=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(c=>!t||t.length<1||t.includes(c)),a=[];return i.forEach(c=>{const u=`video/${c}`;o.forEach(d=>{[`${u};codecs=${d}`,`${u};codecs:${d}`,`${u};codecs=${d.toUpperCase()}`,`${u};codecs:${d.toUpperCase()}`,`${u}`].forEach(m=>{MediaRecorder.isTypeSupported(m)&&a.push(m)})})}),n?a.length>0?a[0]:void 0:a}}class J_ extends Bx{constructor(e,t){super(e,t),this._workerRunning=!1,this.worker=new Worker((0,V.remoteWorkerURL)(J_.LIBRARY_PATH+"ffmpeg-worker-mp4.js",J_.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=n=>{var o;const i=n.data;switch(i.type){case"stdout":case"stderr":if(i.data.indexOf("frame=")===0){const a=parseInt(i.data.split("frame=")[1].split("fps")[0].trim()),c=this._frameCount,u=Math.round(a/c*100);this.dispatchEvent({type:"encode-progress",progress:u,frame:a,totalFrames:c})}console.log(i.data+`
`);break;case"exit":console.log("Process exited with code "+i.data),parseInt(i.data);break;case"done":if(i.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(o=this._recordingCallback)==null||o.call(this,new Blob([i.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const t=this.options.frameRate.toString(),n=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",t,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",n,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob(t=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:t}})},"image/jpeg",90)}pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}}J_.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var lS=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class qu extends En{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!0,this.mimeType="video/mp4",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,n;if(this.convergeMode&&((e=this._recorder)!=null&&e.isRecording())){const i=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))==null?void 0:n.isConverged())||!1,i&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,t,n;if((e=this._recorder)!=null&&e.isRecording()&&(!this.convergeMode||(n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))!=null&&n.isConverged(!0))){const i=()=>{var o;return(o=this._recorder)==null?void 0:o.requestFrame()};this.convergeMode?(0,V.timeout)(1).then(i):i()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;(e=this.uiConfig.children)==null||e.map(t=>(0,V.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e;return((e=this.recorder)==null?void 0:e.state)??"not initialized"}},{type:"button",label:()=>{var e;return(e=this.recorder)!=null&&e.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var e;(e=this.recorder)!=null&&e.isRecording()?this.stopRecording().then(async t=>{if(t){const n=t.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(t,n)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var e,t;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))},value:()=>{var e,t;(t=(e=this._viewer)==null?void 0:e.getPluginByType("CameraViews"))==null||t.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,t,n,i;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))||!((i=(n=this._viewer)==null?void 0:n.getPluginByType("GLTFAnimation"))!=null&&i.animations.length)},value:()=>{var t,n,i,o;const e=((n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation"))==null?void 0:n.animationState)==="playing";(o=(i=this._viewer)==null?void 0:i.getPluginByType("CameraViews"))==null||o.recordAllViews(()=>{var a,c;(c=(a=this._viewer)==null?void 0:a.getPluginByType("GLTFAnimation"))==null||c.playAnimation()}).then(()=>{var a,c;e||((c=(a=this._viewer)==null?void 0:a.getPluginByType("GLTFAnimation"))==null||c.stopAnimation())})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var e,t,n;return!!((e=this.recorder)!=null&&e.isRecording())||!((n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation"))!=null&&n.animations.length)},value:async()=>{var i,o;if((i=this.recorder)!=null&&i.isRecording())return;const e=(o=this._viewer)==null?void 0:o.getPluginByType("GLTFAnimation");if(!e)return;let t=!1;e.loopAnimations&&(t=!0),t&&(e.loopAnimations=!1);const n=await this.record(async()=>e.playAnimation());if(t&&(e.loopAnimations=!0),n){const a=n.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(n,a)}}},{type:"button",limitedUi:!0,label:"Record 360 animation",hidden:()=>{var e;return!!((e=this.recorder)!=null&&e.isRecording())},value:async()=>{var i;if((i=this.recorder)!=null&&i.isRecording()||!this._viewer)return;const e=await this._viewer.prompt("Enter duration in seconds","5",!0);if(e===null)return;const t=parseFloat(e||"5");if(!isFinite(t)||t<=0)return;const n=await this.recordCamera360(t);if(n){const o=n.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(n,o)}}}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e;return((e=this._recorder)==null?void 0:e.isRecording())??!1}refreshRecorderOptions(){if(!this._viewer)return;let e="image";this.mimeType==="video/mp4"?e="ffmpeg.js":this.mimeType==="auto"?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var t;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(t=e.canvas.parentElement)==null||t.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var t,n;this.dirty=e,(t=this._viewer)==null||t.setDirty(),(n=this.uiConfig.children)==null||n.map(i=>(0,V.getOrCall)(i)).flat(2).forEach(i=>{var o;return(o=i==null?void 0:i.uiRefresh)==null?void 0:o.call(i)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(t=this._recorder)==null||t.dispose(),Object.values(this._recorders).forEach(n=>{n==null||n.dispose()}),super.onRemove(e)}async record(e,t){var a,c;if(!this.enabled||(a=this._recorder)!=null&&a.isRecording())return;const n=(c=this._viewer)==null?void 0:c.getPluginByType("Progressive"),i=n==null?void 0:n.maxFrameCount;n&&this.convergeMode&&(n.maxFrameCount=Math.min(16,i??16)),await new Promise((u,d)=>{const m=()=>{this.removeEventListener("start",g),this.removeEventListener("stop",m),this.removeEventListener("error",_)},g=async()=>{m(),t==null||t(),await e(),u()},_=async()=>{m(),d()};this.addEventListener("start",g),this.addEventListener("stop",m),this.addEventListener("error",_),this.startRecording()});const o=await this.stopRecording();return n&&this.convergeMode&&(n.maxFrameCount=i??16),o}startRecording(){var e;return!!this.enabled&&((e=this.recorder)==null?void 0:e.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if((e=this.recorder)!=null&&e.isRecording())return new Promise((t,n)=>{var i;return(i=this.recorder)==null?void 0:i.stop(t)})}async _downloadBlob(e,t){var o,a,c;const n=await((o=this._viewer)==null?void 0:o.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),i=(a=this._viewer)==null?void 0:a.getPluginByType("FileTransferPlugin");i?await i.exportFile(e,n||"recording.mp4"):(c=this._viewer)==null||c.console.error("FileTransferPlugin required to export/download file")}async recordCamera360(e){var m;if((m=this.recorder)!=null&&m.isRecording()||!this._viewer)return;const t=this._viewer.scene.activeCamera;let n=t.interactionsEnabled;for(;!n;)this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),this._viewer.console.warn("interactions are already disabled by something, waiting..."),n=t.interactionsEnabled;n&&(t.interactionsEnabled=!1);const i=t.target.clone(),o=t.position.clone().sub(i),a=await this._viewer.getPluginByType("PopmotionPlugin");if(!a)return void console.error("Popmotion plugin not found");const c=new p.$V().setFromVector3(o);t.position.setFromSpherical(c).add(i),t.positionUpdated(!0);const u=t.autoLookAtTarget;t.autoLookAtTarget=!0;const d=await this.record(async()=>a.animate({from:c.theta,to:c.theta+2*Math.PI,duration:1e3*e,ease:yc.linear,onUpdate:g=>{c.theta=g,t.position.setFromSpherical(c).add(i),t.positionUpdated(!0)}}).promise);return t.autoLookAtTarget=u,t.position.copy(o).add(i),t.positionUpdated(!0),n&&(t.interactionsEnabled=!0),d}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let t;return t=e==="canvas-media"?new DA(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):e==="ffmpeg.js"?new J_(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new bT(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),t.addEventListener("starting",()=>this._stateChange(!1)),t.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),t.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),t.addEventListener("paused",()=>this._stateChange(!1)),t.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),t.addEventListener("encode-progress",n=>{this.dispatchEvent({...n})}),this._recorders[e]=t,t}}qu.PluginType="CanvasRecorder",lS([(0,V.onChange)(qu.prototype.refreshRecorderOptions),Ae()],qu.prototype,"convergeMode",void 0),lS([(0,V.onChange)(qu.prototype.refreshRecorderOptions),Ae()],qu.prototype,"mimeType",void 0),lS([(0,V.onChange)(qu.prototype.refreshRecorderOptions),Ae()],qu.prototype,"videoFrameRate",void 0);var Ox=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const cS=new p.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});cS.depthTest=!1;const uS=new p.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});uS.depthTest=!1;class Pc extends Ur{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new p.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(Uu)}async onAdded(e){const t=e.renderer.createTarget({type:p.ywz,format:p.wk1,colorSpace:p.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:p.wem,magFilter:p.wem});t.texture.name="groundContactDepthTexture";const n=new p.lRF({depthPacking:p.z81});n.onBeforeCompile=function(o){o.uniforms.opacity.value=1,o.fragmentShader=`
						${o.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const i=new Jp(t,n,new p.Ilk(0,0,0),0);this._depthPass=i,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:p.ywz,format:p.wk1,colorSpace:p.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:p.wem,magFilter:p.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(cS.uniforms.h.value=t*this.blurAmount/256,uS.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:cS,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:uS,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){var n,i,o;const t=(n=this._depthPass)==null?void 0:n.target;return t&&((i=this._viewer)==null||i.renderer.disposeTarget(t)),(o=this._depthPass)==null||o.dispose(),this._depthPass=void 0,super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new p.Pa4)),this.shadowCamera.setRotationFromEuler(new p.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var t;if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material&&(this._material.alphaMap=((t=this._depthPass)==null?void 0:t.target.texture)||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),e}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function wT(s,e,t,n){s.traverse(i=>{i&&(i.userData.cloneRotI=e,i.userData.rotationCount=t,i.userData.rotationAxis=n,i.addEventListener("beforeRender",o=>function(a,c){var u;c&&((u=c.map)!=null&&u.isTexture)&&(c.extraUniformsToUpload||(c.extraUniformsToUpload={}),c.extraUniformsToUpload.uvTransform||(c.extraUniformsToUpload.uvTransform={value:new p.Vkp}),c.extraUniformsToUpload.uvTransform.value.setUvTransform(c.map.offset.x*c.map.repeat.x*a.userData.cloneRotI/(a.userData.rotationCount||1),c.map.offset.y*c.map.repeat.y*a.userData.cloneRotI/(a.userData.rotationCount||1),c.map.repeat.x,c.map.repeat.y,c.map.rotation,c.map.center.x,c.map.center.y))}(i,o.material)))})}function xT(s,e,t,n="x"){if(s.userData.rotationCount>1&&!s.userData.rotationRoot)return s;const i=s.parent;if(!i)throw new Error("No parent");if(s.userData.cloneParent){const a=s.userData.cloneParent;if(!(s=i.children.find(c=>a===c.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",a,i),s}let o=i.children.filter(a=>{var c;return((c=a.userData)==null?void 0:c.cloneParent)===s.uuid}).sort((a,c)=>a.userData.cloneRotI-c.userData.cloneRotI);if(s.userData.rotationCount===e&&e===o.length&&t===void 0&&s.userData.rotationAxis===n)return s;if(t==null&&(t=s.userData.rotationSkips??[]),t!==s.userData.rotationSkips&&(s.userData.rotationSkips=[...t]),wT(s,0,e,n),s.userData.rotationRoot=!0,s.visible=!0,e<=o.length){for(let a=e-1;a<o.length;a++)i.remove(o[a]),o[a].traverse(c=>c.userData={__disposed:!0});o=o.slice(0,e)}for(let a=1;a<e;a++){const c=a<=o.length?o[a-1]:s.clone();c.rotation.copy(s.rotation),c.rotation[n]+=a/e*Math.PI*2,wT(c,a,e,n),a>o.length&&i.add(c),c.visible=!t.includes(a)}return s.visible=!t.includes(0),s}Pc.PluginType="ContactShadowGroundPlugin",Ox([(0,V.onChange)(Pc.prototype.refreshOptions),Ae()],Pc.prototype,"contactShadows",void 0),Ox([Ae(),(0,V.onChange)(Pc.prototype._setDirty)],Pc.prototype,"blurAmount",void 0),Ox([Ae(),(0,V.onChange)(Pc.prototype._refreshShadowCameraFrustum)],Pc.prototype,"shadowScale",void 0),Ox([Ae(),(0,V.onChange)(Pc.prototype._refreshShadowCameraFrustum)],Pc.prototype,"shadowHeight",void 0);var Z_,BA=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Xu=Z_=class extends En{async onAdded(s){var e;await super.onAdded(s),(e=s.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(s=!0){super(),this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.enabled=s}_selectedObjectChanged(){var t,n,i,o,a,c,u;if(!this.enabled)return;const s=(n=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"))==null?void 0:n.getSelectedObject();if(!s)return void((o=(i=this.uiConfig).uiRefresh)==null?void 0:o.call(i,"postFrame",!0));const e=s.userData.rotationRoot?s.userData.rotationCount??1:1;this.rotations=e,this.skips=((a=s.userData.rotationSkips)==null?void 0:a.join(","))??"",this.axis=s.userData.rotationAxis||"x",(u=(c=this.uiConfig).uiRefresh)==null||u.call(c,"postFrame",!0)}_paramsChanged(){var e,t,n,i,o,a;if(!this.enabled)return;const s=(t=(e=this._viewer)==null?void 0:e.getPluginByType("Picking"))==null?void 0:t.getSelectedObject();if(s){if(this.rotations>1||s.userData.rotationCount){const c=s.userData.rotationCount,u=xT(s,this.rotations,this.skips.split(",").map(m=>parseInt(m)).filter(m=>isFinite(m)),this.axis),d=u==null?void 0:u.userData.rotationCount;if(d&&d!==c){const m=[];u==null||u.traverseAncestors(g=>{m.push(g)});for(const g of m)if(g.userData.autoScaled){fn(g),(n=this._viewer)==null||n.resetCamera({rootObject:g,centerOffset:new p.Pa4(4,4,4)});break}}s.parent&&!s.userData.__disposed||((o=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"))==null||o.setSelectedObject(u,!0))}(a=this._viewer)==null||a.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};Xu.PluginType="ObjectRotationPlugin",BA([Ae(),Gt("Enabled"),(0,V.onChange)(Z_.prototype._paramsChanged)],Xu.prototype,"enabled",void 0),BA([cn("Rotation Count",[1,100],1,s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!s.rotations}})),(0,V.onChange)(Z_.prototype._paramsChanged)],Xu.prototype,"rotations",void 0),BA([Uo("Axis",["x","y","z"].map(s=>({label:s})),s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!s.rotations}})),(0,V.onChange)(Z_.prototype._paramsChanged)],Xu.prototype,"axis",void 0),BA([jn("Rotation Skips",s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!s.rotations}})),(0,V.onChange)(Z_.prototype._paramsChanged)],Xu.prototype,"skips",void 0),Xu=Z_=BA([Hn("Object Rotations")],Xu);var pv,$_=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let nu=pv=class extends En{constructor(s=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,n)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const i of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=Sn(e.fragmentShader,`#include <${i}>`,p.WdD[i].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=Sn(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=Sn(e.fragmentShader,"#include <normal_fragment_maps>",Sn(Sn(p.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+((t=e.materialObject.bumpMap)==null?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},n)=>{if(this.enabled)for(const[i,o]of Object.entries(this._defines)){const a=typeof o=="number"?o:o?1:0;t.defines[i]!==a&&(t.defines[i]=a,t.needsUpdate=!0)}}},this.dependencies=[Qt],this.enabled=s,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var s,e,t;(e=(s=this._bumpMapExtension)==null?void 0:s.setDirty)==null||e.call(s),(t=this._viewer)==null||t.setDirty()}async onAdded(s){var e,t;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.registerMaterialExtension(this._bumpMapExtension),super.onAdded(s)}async onRemove(s){var e,t;return(t=(e=s.getPlugin(Qt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(s)}};nu.PluginType="ReliefParallaxMapping",$_([(0,V.onChange)(pv.prototype._updateExtension),Ae(),Gt("Enabled")],nu.prototype,"enabled",void 0),$_([(0,V.onChange)(pv.prototype._updateExtension),Gt("Debug Normals")],nu.prototype,"debugNormals",void 0),$_([(0,V.onChange)(pv.prototype._updateExtension),Gt("Debug Hit Height")],nu.prototype,"debugHitHeight",void 0),$_([se("PARALLAX_MAP_STEPS",void 0,!0,pv.prototype._updateExtension),cn("Step count",[1,32],1),Ae()],nu.prototype,"stepCount",void 0),$_([se("PARALLAX_MAP_B_STEPS",void 0,!0,pv.prototype._updateExtension),cn("Binary search steps",[1,8],1),Ae()],nu.prototype,"binaryStepCount",void 0),nu=pv=$_([Hn("Parallax Mapping")],nu);class hS extends p.u9r{constructor(e,t,n=32,i=64,o=!1,a=new p.FM8(1,1),c="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:n,tubularSegments:i,closed:o,primary:c,shapeScale:a.clone()};const u=t.computeFrenetFrames(i,o);this.frames=u;const d=new p.Pa4,m=new p.Pa4,g=new p.Pa4,_=new p.FM8;let w=new p.Pa4;const x=[],T=[],I=[],R=e.getSpacedPoints(n);for(const L of R)L.multiply(a);(function(){for(let L=0;L<i;L++)C(L);C(o===!1?i:0),function(){for(let L=0;L<=i;L++)for(let k=0;k<=n;k++)_.x=L/i,_.y=k/n,T.push(_.x,_.y)}(),function(){const L=c==="shape",k=L?n:i,j=L?i:n;for(let H=1;H<=k;H++)for(let X=1;X<=j;X++){const[ee,oe]=L?[X,H]:[H,X],re=(n+1)*(ee-1)+(oe-1),he=(n+1)*ee+(oe-1),le=(n+1)*ee+oe,ue=(n+1)*(ee-1)+oe;I.push(re,he,ue),I.push(he,le,ue)}}()})(),this.setIndex(I),this.setAttribute("position",new p.a$l(x,3)),this.setAttribute("uv",new p.a$l(T,2)),this.computeVertexNormals();const M=this.attributes.normal;function C(L){w=t.getPointAt(L/i,w);const k=u.normals[L],j=u.binormals[L];for(let H=0;H<=n;H++){const X=R[H%n];m.set(0,0,0).addScaledVector(k,X.x).addScaledVector(j,X.y),d.copy(w).add(m),x.push(d.x,d.y,d.z)}}(function(){for(let k=1;k<n;k++){const j=k+i*(n+1);m.fromBufferAttribute(M,k),g.fromBufferAttribute(M,j),m.add(g).normalize(),M.setXYZ(k,m.x,m.y,m.z),M.setXYZ(j,m.x,m.y,m.z)}for(let k=1;k<i;k++){const j=k*(n+1),H=j+n;m.fromBufferAttribute(M,j),g.fromBufferAttribute(M,H),m.add(g).normalize(),M.setXYZ(j,m.x,m.y,m.z),M.setXYZ(H,m.x,m.y,m.z)}m.fromBufferAttribute(M,0),g.fromBufferAttribute(M,n),m.add(g);const L=i*(n+1);g.fromBufferAttribute(M,L),m.add(g),g.fromBufferAttribute(M,L+n),m.add(g),m.normalize(),M.setXYZ(0,m.x,m.y,m.z),M.setXYZ(n,m.x,m.y,m.z),M.setXYZ(L,m.x,m.y,m.z),M.setXYZ(L+n,m.x,m.y,m.z),M.needsUpdate=!0})()}createSplits(e){this.clearGroups();const t=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,i=[...e,1].sort((c,u)=>c-u);let o=0,a=0;for(const c of i){const u=Math.round(t*c)*n/t;this.addGroup(o,u-o,a++),o=u}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var dS,om=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Xl=dS=class extends En{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new p.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var n,i;const s=(i=(n=this._viewer)==null?void 0:n.getPlugin(Ti))==null?void 0:i.getSelectedObject();if(!s)return;let e=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!e)return;e=parseFloat(e);const t=new pS(0,0,e,e,0,2*Math.PI,!0,0);await this.extrudeObject(s,t)}}async onAdded(s){await super.onAdded(s)}static CreateCurve(s,e){if(s==="circle")return new pS(0,0,e.radius??1,e.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(s,e,t=this.shapeSegments,n=this.tubularSegments,i=this.shapeScale,o=this.materialSplits.split(",").map(c=>parseFloat(c.trim())),a=this.horizontalSplits){var _,w,x,T,I,R,M,C;if(s.userData.isExtrudedTube,s.userData._extrudeSource){const L=s.userData._extrudeSource;if(s=(_=s.parent)==null?void 0:_.children.find(k=>L===k.uuid),!s)return void console.warn("Could not find extrude source with uuid",L)}if(s.userData.extrudedObject){const L=s.userData.extrudedObject,k=(w=s.parent)==null?void 0:w.children.find(j=>L===j.uuid);k&&(k.removeFromParent(),k.geometry.dispose(),k.geometry=null,k.material=null),delete s.userData.extrudedObject}const c=s.geometry;if(!c)return void((x=this._viewer)==null?void 0:x.alert("Extrude: No geometry to extrude"));const u=[s.material];let d;try{const L=dS.ConvertGeometryToFlatShape(c);d=new hS(L,e,t,n,!0,i,a?"shape":"path"),d.computeBoundingBox(),d.createSplits(o)}catch(L){return void((T=this._viewer)==null?void 0:T.alert(typeof L=="string"?L:L==null?void 0:L.message))}u[0].color.set(16777215);for(let L=u.length;L<d.groups.length;L++){const k=u[0].clone();u.push(k),k.color.set(16777215*Math.random())}const m=new p.Kj0(d,u);m.userData._extrudeSource=s.uuid,m.userData.isExtrudedTube=!0,s.visible=!1,s.userData.bboxVisible=!1,m.name=s.name+"_extruded";const g=await((M=(R=(I=this._viewer)==null?void 0:I.getManager())==null?void 0:R.importer)==null?void 0:M.processImportedSingle(m,{autoCenter:!1,autoScale:!1}));g&&((C=s.parent)==null||C.add(g.modelObject),s.userData.extrudedObject=g.modelObject.uuid,g.dispatchEvent({type:"select",ui:!0,value:g}))}static ExtrudeShape(s,e,t,n,i,o,a,c){const u=new hS(s,n,e,t,!0,new p.FM8(i,o),c?"shape":"path");u.computeBoundingBox(),u.createSplits(a);const d=new p.Kj0(u,[]);return d.userData.isExtrudedTube=!0,d}static ConvertGeometryToFlatShape(s,e=!0){if(s.userData.__planarShape)return s.userData.__planarShape;let t=s.attributes.position;if(!t)throw"no position attribute";if(t.count>500)throw"too large to extrude";const n=s;t=n.attributes.position,n.boundingBox||n.computeBoundingBox();const i=n.boundingBox.getSize(new p.Pa4),o=i.x<.001?"x":i.y<.001?"y":i.z<.001?"z":null;if(!o)throw"geometry is not axis aligned not planar";let a=[];for(let u=0;u<t.count;u++){const d=new p.FM8;o==="x"?d.set(t.getY(u),t.getZ(u)):o==="y"?d.set(t.getX(u),t.getZ(u)):d.set(t.getX(u),t.getY(u)),a.push(d)}if(e){let u=0;for(let d=0;d<a.length;d++)(a[d].x<a[u].x||a[d].x===a[u].x&&a[d].y<a[u].y)&&(u=d);u!==0&&(a=a.slice(u).concat(a.slice(0,u)))}const c=new p.bnF(a);return s.userData.__planarShape=c,c}};Xl.PluginType="ShapeTubeExtrudePlugin",om([Gt("Enabled")],Xl.prototype,"enabled",void 0),om([cn("Shape Segments (X)",[1,100],1,s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],Xl.prototype,"shapeSegments",void 0),om([cn("Tube Segments (Y)",[1,100],1,s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],Xl.prototype,"tubularSegments",void 0),om([As("Shape scale",[.01,10],.01,s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],Xl.prototype,"shapeScale",void 0),om([jn("Material Splits",s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],Xl.prototype,"materialSplits",void 0),om([Gt("Horizontal Splits",s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],Xl.prototype,"horizontalSplits",void 0),om([Ai("Extrude Circle Tube",s=>({hidden:()=>{var e,t;return!((t=(e=s._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],Xl.prototype,"extrudeCirceTube",void 0),Xl=dS=om([Hn("Extrude Tube Shapes")],Xl);class pS extends p.Ny0{getPoint(e,t){return super.getPoint(e,t||new p.Pa4)}}class am extends En{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var o,a;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))==null||o.enable(am.PluginType),this._fadeDisabled=!1));const t=(0,V.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=t-1/60);let n=t-this._lastFrameTime;this._lastFrameTime=t;const i=(a=this._viewer.getPluginByType("Progressive"))==null?void 0:a.postFrameConvergedRecordingDelta();if(i&&i>0&&(n=i),i!==0&&(n*=1e3,!(n<=.001)&&(this._updaters.forEach(c=>{let u=n;c.time+u<0&&(u=-c.time),c.time+=u,Math.abs(u)>.001&&c.u(u)}),!this._fadeDisabled&&this.disableFrameFade))){const c=this._viewer.getPluginByType("FrameFade");c&&(c.disable(am.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(n=>n.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=ns(),n={id:t,options:e,stop:()=>{var i,o,a;(i=this.animations[t])!=null&&i._stop?(a=(o=this.animations[t])==null?void 0:o._stop)==null||a.call(o):console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise((i,o)=>{const a={driver:this.defaultDriver,...e,onComplete:()=>{var u;try{(u=e.onComplete)==null||u.call(e)}catch(d){return void o(d)}i()},onStop:()=>{var u;try{(u=e.onStop)==null||u.call(e)}catch(d){return void o(d)}i()}},c=Nh(a);this.animations[t]._stop=c.stop,this.animations[t].options=a}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}am.PluginType="PopmotionPlugin";var fS,Yu,fs=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const Ka=s=>({onChange:e=>{e.last&&s.onChange()}});let mo=fS=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(s){Object.assign(this,s)}reset(){const s=this.onChange;Object.assign(this,new fS),this.onChange=s}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};fs([jn("Text",Ka)],mo.prototype,"text",void 0),fs([cn("Font Size",[2,400],1,Ka)],mo.prototype,"fontSize",void 0),fs([cn("Width",[2,4096],1,Ka)],mo.prototype,"width",void 0),fs([cn("Height",[2,4096],1,Ka)],mo.prototype,"height",void 0),fs([cn("X Offset",[-1024,1024],1,Ka)],mo.prototype,"xOffset",void 0),fs([cn("Y Offset",[-1024,1024],1,Ka)],mo.prototype,"yOffset",void 0),fs([cn("V-Width",[2,4096],1,Ka)],mo.prototype,"boxWidth",void 0),fs([cn("V-Height",[2,4096],1,Ka)],mo.prototype,"boxHeight",void 0),fs([Uo("Text Anchor",["start","middle","end"].map(s=>({label:s})),Ka)],mo.prototype,"textAnchor",void 0),fs([jn("Font",Ka)],mo.prototype,"fontFamily",void 0),fs([jn("Font Url",Ka)],mo.prototype,"fontPath",void 0),fs([Gt("Mask Text",Ka)],mo.prototype,"maskText",void 0),fs([Gt("Inner Shadow",Ka)],mo.prototype,"innerShadow",void 0),fs([Zo("Text Color",Ka)],mo.prototype,"textColor",void 0),fs([Zo("BG Fill",Ka)],mo.prototype,"bgFillColor",void 0),fs([Zo("SVG BG",Ka)],mo.prototype,"svgBackground",void 0),mo=fS=fs([Hn("Text SVG Options")],mo);const ET={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},OA=s=>({hidden:()=>{const e=s.getSelected();return!e||!e.userData[Yl.PluginType]}});let Yl=Yu=class extends En{async onAdded(s){var e;await super.onAdded(s),(e=s.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var s,e;return(e=(s=this._viewer)==null?void 0:s.getPluginByType("Picking"))==null?void 0:e.getSelectedObject()},this.options=new mo,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var t,n,i,o,a,c;if(!this.enabled)return;const s=this.getSelected();if(!s)return void((n=(t=this.uiConfig).uiRefresh)==null?void 0:n.call(t,"postFrame",!0));const e=s.userData[Yu.PluginType];if(!e)return this.options.reset(),this._lastMeta=void 0,void((o=(i=this.uiConfig).uiRefresh)==null?void 0:o.call(i,"postFrame",!0));this._lastMeta!==e&&(this.options.set(e),this._lastMeta=e),(c=(a=this.uiConfig).uiRefresh)==null||c.call(a,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const s=this.getSelected();s&&s.isMesh&&s.userData[Yu.PluginType]&&this.updateText(s,this.options.toJSON())}async addTextToSelected(){var e;const s=this.getSelected();s&&s.isMesh?s.material?(s.userData[Yu.PluginType]||!s.material.map||await((e=this._viewer)==null?void 0:e.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(s):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(s,e){return this.updateText(s,Object.assign(this.options.toJSON(),e))}async updateText(s,e){var o,a;if(!s.isMesh)return;if(!s.material)return void console.error("updateText: no material on mesh");let t=s.userData[Yu.PluginType];t||(s.userData[Yu.PluginType]=t={}),Object.assign(t,e);const n=s.material;n.map&&(n.map._isSimpleTextTexture&&n.map.dispose(),n.map=void 0),n.alphaMap&&(n.alphaMap._isSimpleTextTexture&&n.alphaMap.dispose(),n.alphaMap=void 0),n.bumpMap&&(n.bumpMap._isSimpleTextTexture&&n.bumpMap.dispose(),n.bumpMap=void 0);const i=await this.makeTextSvg(t);this.applyToMap&&(n.map=i),this.applyToAlphaMap&&(n.alphaMap=i,n.transparent=!0),this.applyToBumpMap&&(n.bumpMap=i),n.userData.inverseAlphaMap=this.inverseAlphaMap,n.setDirty(),n.needsUpdate=!0,(a=(o=this.uiConfig).uiRefresh)==null||a.call(o,"postFrame",!0)}async makeTextSvg(s){const e=s.fontFamily||"Arial",t=s.fontPath||this.fonts[e]||"";let n=s.style;if(t.length>0){const a=t.split("?")[0].split(".").pop()||"woff";n+=`
`+(t.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${t}) format(${ET[a]||a});
            }`:"")}let i=function({text:a="Custom Text",svgBackground:c="#ffffff",xOffset:u=0,yOffset:d=0,width:m=1024,height:g=1024,boxWidth:_=1024,boxHeight:w=1024,fontFamily:x="",fontSize:T=32,maskText:I=!0,innerShadow:R=!0,bgFillColor:M="#000000",textColor:C="#ffffff",textAnchor:L="middle",style:k=""}){return`
<svg style="background-color:${c}" width="${m}" height="${g}" viewBox="0 0 ${_} ${w}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${k}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${L}; font-size: ${T}px; font-family: ${x||"Arial"}">
        <defs>

`+(I?`
<mask id="textMask">
<text style="fill:white; font-size: ${T}px;" x="${u+_/2}" y="${w/2+d+T/4}" > ${a} </text>
</mask>
`:"")+`

`+(R?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(I?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${_}" height="${w}" style="fill:${M}"/>
        <text style="${R?"filter: url(#innerShadow);":""} fill:${C};" x="${u+_/2}" y="${w/2+d+T/4}"> ${a} </text>

`+(I?`
        </g>
`:"")+`

    </g>
</svg>
`}({...s,fontFamily:e,style:n});i=await(0,V.embedUrlRefs)(i,async a=>this._getAssetData(a)),i=(0,V.svgUrl)(i);const o=await this._viewer.getManager().importer.importSinglePath(i,{generateMipmaps:!1,minFilter:p.wem});return o._isSimpleTextTexture=!0,o.flipY=!1,o.needsUpdate=!0,o}async _getAssetData(s){var t,n;if(s.startsWith("http://www.w3.org"))return s;const e=(n=(t=this._viewer)==null?void 0:t.getManager())==null?void 0:n.importer;if(!e)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new LC(e.loadingManager),processImported:!1};try{return await e.importPath(s,this._assetLoadOptions)}catch(i){return console.error(i),""}}};Yl.PluginType="SimpleTextPlugin",fs([Sr(void 0,{params:OA})],Yl.prototype,"options",void 0),fs([Gt("Apply Map",OA),(0,V.onChange)(Yu.prototype._paramsChanged)],Yl.prototype,"applyToMap",void 0),fs([Gt("Apply Bump Map",OA),(0,V.onChange)(Yu.prototype._paramsChanged)],Yl.prototype,"applyToBumpMap",void 0),fs([Gt("Apply Alpha Map",OA),(0,V.onChange)(Yu.prototype._paramsChanged)],Yl.prototype,"applyToAlphaMap",void 0),fs([Gt("Invert Alpha Map",OA),(0,V.onChange)(Yu.prototype._paramsChanged)],Yl.prototype,"inverseAlphaMap",void 0),fs([Ai("Add Text",s=>({hidden:()=>!s.getSelected()}))],Yl.prototype,"addTextToSelected",null),Yl=Yu=fs([Hn("Simple Text")],Yl);class mS{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class T2{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class ld{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new ld;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new ld),this.front.build(t)),n.length&&(this.back||(this.back=new ld),this.back.build(n))}}class Kl{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Kl(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new Kl().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,i=t.y,o=t.z,a=e.x,c=e.y,u=e.z;return this.x=i*u-o*c,this.y=o*a-n*u,this.z=n*c-i*a,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new p.Pa4(this.x,this.y,this.z)}}class fv{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new fv(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,i,o){let a=0;const c=[];for(let u=0;u<e.vertices.length;u++){const d=this.normal.dot(e.vertices[u].pos)-this.w,m=d<-fv.EPSILON?2:d>fv.EPSILON?1:0;a|=m,c.push(m)}switch(a){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:i.push(e);break;case 2:o.push(e);break;case 3:{const u=[],d=[];for(let m=0;m<e.vertices.length;m++){const g=(m+1)%e.vertices.length,_=c[m],w=c[g],x=e.vertices[m],T=e.vertices[g];if(_!=2&&u.push(x),_!=1&&d.push(_!=2?x.clone():x),(_|w)==3){const I=(this.w-this.normal.dot(x.pos))/this.normal.dot(new Kl().copy(T.pos).sub(x.pos)),R=x.interpolate(T,I);u.push(R),d.push(R.clone())}}u.length>=3&&i.push(new e0(u,e.shared)),d.length>=3&&o.push(new e0(d,e.shared));break}}}static fromPoints(e,t,n){const i=new Kl().copy(t).sub(e).cross(new Kl().copy(n).sub(e)).normalize();return new fv(i.clone(),i.dot(e))}}fv.EPSILON=1e-5;class e0{constructor(e,t){this.vertices=e,this.shared=t,this.plane=fv.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new e0(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class Lx{constructor(e,t,n,i){this.pos=new Kl().copy(e),this.normal=new Kl().copy(t),this.uv=new Kl().copy(n),this.uv.z=0,i&&(this.color=new Kl().copy(i))}clone(){return new Lx(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new Lx(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class zs{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new zs;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const i=e.attributes.position,o=e.attributes.normal,a=e.attributes.uv,c=e.attributes.color,u=e.groups;let d;if(e.index)d=e.index.array;else{d=new Array(i.array.length/i.itemSize|0);for(let g=0;g<d.length;g++)d[g]=g}const m=d.length/3|0;n=new Array(m);for(let g=0,_=0,w=d.length;g<w;g+=3,_++){const x=new Array(3);for(let T=0;T<3;T++){const I=d[g+T],R=3*I,M=2*I,C=i.array[R],L=i.array[R+1],k=i.array[R+2],j=o.array[R],H=o.array[R+1],X=o.array[R+2],ee=a==null?void 0:a.array[M],oe=a==null?void 0:a.array[M+1];x[T]=new Lx(new Kl(C,L,k),new Kl(j,H,X),new Kl(ee,oe,0),c&&new Kl(c.array[M],c.array[M+1],c.array[M+2]))}if(t===void 0&&u&&u.length>0)for(const T of u)g>=T.start&&g<T.start+T.count&&(n[_]=new e0(x,T.materialIndex));else n[_]=new e0(x,t)}return zs.fromPolygons(n.filter(g=>!isNaN(g.plane.normal.x)))}static toGeometry(e,t){let n=0;const i=e.polygons;for(const w of i)n+=w.vertices.length-2;const o=new p.u9r,a=new mS(3*n*3),c=new mS(3*n*3),u=new T2(2*n*3);let d;const m=[],g=[];for(const w of i){const x=w.vertices,T=x.length;w.shared!==void 0&&(m[w.shared]||(m[w.shared]=[])),T&&x[0].color!==void 0&&(d||(d=new mS(3*n*3)));for(let I=3;I<=T;I++)(w.shared===void 0?g:m[w.shared]).push(a.top/3,a.top/3+1,a.top/3+2),a.write(x[0].pos),a.write(x[I-2].pos),a.write(x[I-1].pos),c.write(x[0].normal),c.write(x[I-2].normal),c.write(x[I-1].normal),u&&(u.write(x[0].uv),u.write(x[I-2].uv),u.write(x[I-1].uv)),d&&(d.write(x[0].color),d.write(x[I-2].color),d.write(x[I-1].color))}o.setAttribute("position",new p.TlE(a.array,3)),o.setAttribute("normal",new p.TlE(c.array,3)),u&&o.setAttribute("uv",new p.TlE(u.array,2)),d&&o.setAttribute("color",new p.TlE(d.array,3));for(let w=0;w<m.length;w++)m[w]===void 0&&(m[w]=[]);if(m.length){let w=[],x=0;for(let T=0;T<m.length;T++)o.addGroup(x,m[T].length,T),x+=m[T].length,w=w.concat(m[T]);o.addGroup(x,g.length,m.length),w=w.concat(g),o.setIndex(w)}const _=new p.yGw().copy(t).invert();return o.applyMatrix4(_),o.computeBoundingSphere(),o.computeBoundingBox(),o}static fromMesh(e,t){const n=zs.fromGeometry(e.geometry,t),i=new p.Pa4,o=new p.Vkp;o.getNormalMatrix(e.matrix);for(let a=0;a<n.polygons.length;a++){const c=n.polygons[a];for(let u=0;u<c.vertices.length;u++){const d=c.vertices[u];d.pos.copy(i.copy(d.pos.toVector3()).applyMatrix4(e.matrix)),d.normal.copy(i.copy(d.normal.toVector3()).applyMatrix3(o))}}return n}static toMesh(e,t,n){const i=zs.toGeometry(e,t),o=new p.Kj0(i,n);return o.matrix.copy(t),o.matrix.decompose(o.position,o.quaternion,o.scale),o.rotation.setFromQuaternion(o.quaternion),o.updateMatrixWorld(),o.castShadow=o.receiveShadow=!0,o}static union(e,t){const n=zs.fromMesh(e),i=zs.fromMesh(t);return zs.toMesh(n.union(i),e.matrix,e.material)}static subtract(e,t){const n=zs.fromMesh(e),i=zs.fromMesh(t);return zs.toMesh(n.subtract(i),e.matrix,e.material)}static intersect(e,t){const n=zs.fromMesh(e),i=zs.fromMesh(t);return zs.toMesh(n.intersect(i),e.matrix,e.material)}clone(){const e=new zs;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new ld(this.clone().polygons),n=new ld(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),zs.fromPolygons(t.allPolygons())}subtract(e){const t=new ld(this.clone().polygons),n=new ld(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),zs.fromPolygons(t.allPolygons())}intersect(e){const t=new ld(this.clone().polygons),n=new ld(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),zs.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return zs.toMesh(this,e,t)}toGeometry(e){return zs.toGeometry(this,e)}}var t0=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const gS=["union","subtract","intersect"];class Cp extends En{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Ti],this.rootMesh=new p.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(t=e.getPlugin(Ti))==null||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject();e&&e.geometry&&(e.userData._isCSGMesh||(e.userData.csgBrush||(e.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,V.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var i,o;const e=(o=(i=this._viewer)==null?void 0:i.getPluginByType("AssetExporterPlugin"))==null?void 0:o.exporter;if(!e||!this.rootObject)return;const t=this.rootMesh.visible;this.rootMesh.visible=!0;const n=await e.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=t,n}_updateSelectedProperties(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject();e&&e.userData.csgBrush&&(e.userData.csgBrush.enabled=this.csgSelectedEnabled,e.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var t,n,i,o,a,c;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject();e&&(this.csgSelectedEnabled=((i=e.userData.csgBrush)==null?void 0:i.enabled)??!1,this.csgSelectedOperation=((o=e.userData.csgBrush)==null?void 0:o.operation)??"union"),(c=(a=this.uiConfig)==null?void 0:a.uiRefresh)==null||c.call(a,"postFrame",!0)}_preFrame(){var t,n;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const e=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(t=this.rootObject)==null||t.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(e)),this.rootMesh&&!this.rootMesh.parent&&((n=this.rootObject)==null||n.modelObject.add(this.rootMesh)),this.showResult?(e.forEach(i=>{i[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(e.forEach(i=>{i[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var t;const e=[];return(t=this._viewer)==null||t.scene.traverse(n=>{var i;n.isMesh&&n.geometry&&((i=n.userData.csgBrush)!=null&&i.enabled)&&e.push([n,n.userData.csgBrush.operation])}),e}_sceneUpdate(e){var t,n;(n=(t=e==null?void 0:e.object)==null?void 0:t.userData)!=null&&n._isCSGMesh||(this._csgNeedsUpdate=!0)}}t0([Gt("Show Result",s=>({onChange:()=>{var e;return(e=s._viewer)==null?void 0:e.setDirty()}}))],Cp.prototype,"showResult",void 0),t0([Ai("Make CSG Brush",s=>({hidden:()=>{var t,n;const e=(n=(t=s._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject();return!(e!=null&&e.userData)||!!e.userData.csgBrush||e.userData._isCSGMesh}}))],Cp.prototype,"makeSelectedCSGBrush",null),t0([Gt("Enabled",s=>({hidden:()=>{var t,n;const e=(n=(t=s._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject();return!e||!e.userData.csgBrush},onChange:s._updateSelectedProperties}))],Cp.prototype,"csgSelectedEnabled",void 0),t0([Uo("Operation",gS.map(s=>({label:s})),s=>({hidden:()=>{var t,n;const e=(n=(t=s._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject();return!e||!e.userData.csgBrush},onChange:s._updateSelectedProperties}))],Cp.prototype,"csgSelectedOperation",void 0),t0([Ai("Refresh CSG")],Cp.prototype,"refreshCSG",null),t0([Ai("Export Result",s=>({hidden:()=>{var e;return!((e=s._viewer)!=null&&e.getPluginByType("AssetExporterPlugin"))}}))],Cp.prototype,"downloadObject",null);function ST(s,e){let t=new zs;const n=s.map(o=>o[0].material).flatMap(o=>o);s.forEach(([o,a])=>{if(!gS.includes(a))return void console.error(`Unknown operation ${a}`);o.updateMatrix(),o.updateMatrixWorld();const c=o.matrix;o.matrix=o.matrixWorld;let u=0;u=Array.isArray(o.material)?void 0:n.indexOf(o.material),t=t[a](zs.fromMesh(o,u)),o.matrix=c});const i=t.toMesh(e??new p.yGw().identity(),n);return i.userData._isCSGMesh=!0,i.geometry.groups=i.geometry.groups.filter(o=>o.count>0),i}let LA=class extends Cp{_buildCSGMesh(s){return ST(s)}};LA.PluginType="CSGPluginBSP",LA=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Hn("CSG Plugin (BSP)")],LA);const CT=0,MT=1,TT=3,IT=4;class Mp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,i=-1/0;for(let o=0,a=e.length;o<a;o++){const c=e[o][t];n=c<n?c:n,i=c>i?c:i}this.min=n,this.max=i}setFromPoints(e,t){let n=1/0,i=-1/0;for(let o=0,a=t.length;o<a;o++){const c=t[o],u=e.dot(c);n=u<n?u:n,i=u>i?u:i}this.min=n,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}Mp.prototype.setFromBox=function(){const s=new p.Pa4;return function(e,t){const n=t.min,i=t.max;let o=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let u=0;u<=1;u++)for(let d=0;d<=1;d++){s.x=n.x*c+i.x*(1-c),s.y=n.y*u+i.y*(1-u),s.z=n.z*d+i.z*(1-d);const m=e.dot(s);o=Math.min(m,o),a=Math.max(m,a)}this.min=o,this.max=a}}();const I2=function(){const s=new p.Pa4,e=new p.Pa4,t=new p.Pa4;return function(n,i,o){const a=n.start,c=s,u=i.start,d=e;t.subVectors(a,u),s.subVectors(n.end,n.start),e.subVectors(i.end,i.start);const m=t.dot(d),g=d.dot(c),_=d.dot(d),w=t.dot(c),x=c.dot(c)*_-g*g;let T,I;T=x!==0?(m*g-w*_)/x:0,I=(m+T*g)/_,o.x=T,o.y=I}}(),vS=function(){const s=new p.FM8,e=new p.Pa4,t=new p.Pa4;return function(n,i,o,a){I2(n,i,s);let c=s.x,u=s.y;if(c>=0&&c<=1&&u>=0&&u<=1)return n.at(c,o),void i.at(u,a);if(c>=0&&c<=1)return u<0?i.at(0,a):i.at(1,a),void n.closestPointToPoint(a,!0,o);if(u>=0&&u<=1)return c<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,a);{let d,m;d=c<0?n.start:n.end,m=u<0?i.start:i.end;const g=e,_=t;return n.closestPointToPoint(m,!0,e),i.closestPointToPoint(d,!0,t),g.distanceToSquared(m)<=_.distanceToSquared(d)?(o.copy(g),void a.copy(m)):(o.copy(d),void a.copy(_))}}}(),P2=function(){const s=new p.Pa4,e=new p.Pa4,t=new p.JOQ,n=new p.Zzh;return function(i,o){const{radius:a,center:c}=i,{a:u,b:d,c:m}=o;if(n.start=u,n.end=d,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a||(n.start=u,n.end=m,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a)||(n.start=d,n.end=m,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a))return!0;const g=o.getPlane(t);if(Math.abs(g.distanceToPoint(c))<=a){const _=g.projectPoint(c,e);if(o.containsPoint(_))return!0}return!1}}(),R2=1e-15;function n0(s){return Math.abs(s)<R2}class cd extends p.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new p.Pa4),this.satBounds=new Array(4).fill().map(()=>new Mp),this.points=[this.a,this.b,this.c],this.sphere=new p.aLr,this.plane=new p.JOQ,this.needsUpdate=!0}intersectsSphere(e){return P2(e,this)}update(){const e=this.a,t=this.b,n=this.c,i=this.points,o=this.satAxes,a=this.satBounds,c=o[0],u=a[0];this.getNormal(c),u.setFromPoints(c,i);const d=o[1],m=a[1];d.subVectors(e,t),m.setFromPoints(d,i);const g=o[2],_=a[2];g.subVectors(t,n),_.setFromPoints(g,i);const w=o[3],x=a[3];w.subVectors(n,e),x.setFromPoints(w,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(c,e),this.needsUpdate=!1}}cd.prototype.closestPointToSegment=function(){const s=new p.Pa4,e=new p.Pa4,t=new p.Zzh;return function(n,i=null,o=null){const{start:a,end:c}=n,u=this.points;let d,m=1/0;for(let g=0;g<3;g++){const _=(g+1)%3;t.start.copy(u[g]),t.end.copy(u[_]),vS(t,n,s,e),d=s.distanceToSquared(e),d<m&&(m=d,i&&i.copy(s),o&&o.copy(e))}return this.closestPointToPoint(a,s),d=a.distanceToSquared(s),d<m&&(m=d,i&&i.copy(s),o&&o.copy(a)),this.closestPointToPoint(c,s),d=c.distanceToSquared(s),d<m&&(m=d,i&&i.copy(s),o&&o.copy(c)),Math.sqrt(m)}}(),cd.prototype.intersectsTriangle=function(){const s=new cd,e=new Array(3),t=new Array(3),n=new Mp,i=new Mp,o=new p.Pa4,a=new p.Pa4,c=new p.Pa4,u=new p.Pa4,d=new p.Zzh,m=new p.Zzh,g=new p.Zzh;return function(_,w=null,x=!1){this.needsUpdate&&this.update(),_.isExtendedTriangle?_.needsUpdate&&_.update():(s.copy(_),s.update(),_=s);const T=this.plane,I=_.plane;if(Math.abs(T.normal.dot(I.normal))>1-1e-10){const R=this.satBounds,M=this.satAxes;t[0]=_.a,t[1]=_.b,t[2]=_.c;for(let k=0;k<4;k++){const j=R[k],H=M[k];if(n.setFromPoints(H,t),j.isSeparated(n))return!1}const C=_.satBounds,L=_.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let k=0;k<4;k++){const j=C[k],H=L[k];if(n.setFromPoints(H,e),j.isSeparated(n))return!1}for(let k=0;k<4;k++){const j=M[k];for(let H=0;H<4;H++){const X=L[H];if(o.crossVectors(j,X),n.setFromPoints(o,e),i.setFromPoints(o,t),n.isSeparated(i))return!1}}return w&&(x||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),w.start.set(0,0,0),w.end.set(0,0,0)),!0}{const R=this.points;let M=!1,C=0;for(let re=0;re<3;re++){const he=R[re],le=R[(re+1)%3];d.start.copy(he),d.end.copy(le),d.delta(a);const ue=M?m.start:m.end,ge=n0(I.distanceToPoint(he));if(n0(I.normal.dot(a))&&ge){m.copy(d),C=2;break}if((I.intersectLine(d,ue)||ge)&&!n0(ue.distanceTo(le))){if(C++,M)break;M=!0}}if(C===1&&_.containsPoint(m.end))return w&&(w.start.copy(m.end),w.end.copy(m.end)),!0;if(C!==2)return!1;const L=_.points;let k=!1,j=0;for(let re=0;re<3;re++){const he=L[re],le=L[(re+1)%3];d.start.copy(he),d.end.copy(le),d.delta(c);const ue=k?g.start:g.end,ge=n0(T.distanceToPoint(he));if(n0(T.normal.dot(c))&&ge){g.copy(d),j=2;break}if((T.intersectLine(d,ue)||ge)&&!n0(ue.distanceTo(le))){if(j++,k)break;k=!0}}if(j===1&&this.containsPoint(g.end))return w&&(w.start.copy(g.end),w.end.copy(g.end)),!0;if(j!==2)return!1;if(m.delta(a),g.delta(c),a.dot(c)<0){let re=g.start;g.start=g.end,g.end=re}const H=m.start.dot(a),X=m.end.dot(a),ee=g.start.dot(a),oe=g.end.dot(a);return(H===oe||ee===X||X<ee!=H<oe)&&(w&&(u.subVectors(m.start,g.start),u.dot(a)>0?w.start.copy(m.start):w.start.copy(g.start),u.subVectors(m.end,g.end),u.dot(a)<0?w.end.copy(m.end):w.end.copy(g.end)),!0)}}}(),cd.prototype.distanceToPoint=function(){const s=new p.Pa4;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}(),cd.prototype.distanceToTriangle=function(){const s=new p.Pa4,e=new p.Pa4,t=["a","b","c"],n=new p.Zzh,i=new p.Zzh;return function(o,a=null,c=null){const u=a||c?n:null;if(this.intersectsTriangle(o,u))return(a||c)&&(a&&u.getCenter(a),c&&u.getCenter(c)),0;let d=1/0;for(let m=0;m<3;m++){let g;const _=t[m],w=o[_];this.closestPointToPoint(w,s),g=w.distanceToSquared(s),g<d&&(d=g,a&&a.copy(s),c&&c.copy(w));const x=this[_];o.closestPointToPoint(x,s),g=x.distanceToSquared(s),g<d&&(d=g,a&&a.copy(x),c&&c.copy(s))}for(let m=0;m<3;m++){const g=t[m],_=t[(m+1)%3];n.set(this[g],this[_]);for(let w=0;w<3;w++){const x=t[w],T=t[(w+1)%3];i.set(o[x],o[T]),vS(n,i,s,e);const I=s.distanceToSquared(e);I<d&&(d=I,a&&a.copy(s),c&&c.copy(e))}}return Math.sqrt(d)}}();const i0=1e-14,r0=1e-10,Tp=new p.Zzh,$s=new p.Zzh,Ip=new p.Pa4,PT=new p.Pa4,kA=new p.JOQ,D2=new cd;function UA(s){return s.a.distanceToSquared(s.b)<i0||s.a.distanceToSquared(s.c)<i0||s.b.distanceToSquared(s.c)<i0}class B2{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new p.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class O2{constructor(){this.trianglePool=new B2,this.triangles=[],this.normal=new p.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:i}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let o=0,a=e.length;o<a;o++){const c=e[o];if(o===0)c.getNormal(i);else if(Math.abs(1-c.getNormal(Ip).dot(i))>i0)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const u=n.getTriangle();u.copy(c),t.push(u)}else{e.getNormal(i);const o=n.getTriangle();o.copy(e),t.push(o)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(kA),Math.abs(1-Math.abs(kA.normal.dot(t)))<r0){const i=[e.a,e.b,e.c];for(let o=0;o<3;o++){const a=(o+1)%3,c=i[o],u=i[a];Ip.subVectors(u,c).normalize(),PT.crossVectors(t,Ip),kA.setFromNormalAndCoplanarPoint(PT,c),this.splitByPlane(kA,e,o)}for(let o=0,a=n.length;o<a;o++)n[o].coplanarCount=0}else this.splitByPlane(kA,e)}splitByPlane(e,t=null,n=-1){const{triangles:i,trianglePool:o}=this;let a=null;t!==null&&(a=D2,a.copy(t),a.needsUpdate=!0);for(let c=0,u=i.length;c<u;c++){const d=i[c],{a:m,b:g,c:_}=d;if(a&&!a.intersectsTriangle(d,Tp,!0))continue;let w=0,x=-1,T=0,I=!1;const R=[m,g,_];for(let M=0;M<3;M++){const C=(M+1)%3;Tp.start.copy(R[M]),Tp.end.copy(R[C]);const L=e.distanceToPoint(Tp.start),k=e.distanceToPoint(Tp.end);if(Math.abs(L)<r0&&Math.abs(k)<r0){I=!0;break}if(Math.abs(L)<r0)continue;L>0&&T++;let j=!!e.intersectLine(Tp,Ip);!j&&Math.abs(k)<r0&&(Ip.copy(Tp.end),j=!0),!j||Ip.distanceTo(Tp.start)<i0||(Ip.distanceTo(Tp.end)<i0&&(x=M),w===0?$s.start.copy(Ip):$s.end.copy(Ip),w++)}if(!I)if(w===2&&$s.distance()>r0)if(x!==-1){x=(x+1)%3;let M=0;M===x&&(M=(M+1)%3);let C=M+1;C===x&&(C=(C+1)%3);const L=o.getTriangle();L.a.copy(R[C]),L.b.copy($s.end),L.c.copy($s.start),UA(L)||i.push(L),d.a.copy(R[M]),d.b.copy($s.start),d.c.copy($s.end),UA(d)&&(i.splice(c,1),c--,u--)}else{const M=R.findIndex(H=>T>=2?e.distanceToPoint(H)<0:e.distanceToPoint(H)>0);if(M===0){let H=$s.start;$s.start=$s.end,$s.end=H}else if(M===-1)continue;const C=(M+1)%3,L=(M+2)%3,k=o.getTriangle(),j=o.getTriangle();R[C].distanceToSquared($s.start)<R[L].distanceToSquared($s.end)?(k.a.copy(R[C]),k.b.copy($s.start),k.c.copy($s.end),j.a.copy(R[C]),j.b.copy(R[L]),j.c.copy($s.start)):(k.a.copy(R[L]),k.b.copy($s.start),k.c.copy($s.end),j.a.copy(R[C]),j.b.copy(R[L]),j.c.copy($s.end)),d.a.copy(R[M]),d.b.copy($s.end),d.c.copy($s.start),UA(k)||i.push(k),UA(j)||i.push(j),UA(d)&&(i.splice(c,1),c--,u--)}else w===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function RT(){return typeof SharedArrayBuffer<"u"}function L2(s){if(s.buffer instanceof SharedArrayBuffer)return s;const e=s.constructor,t=s.buffer,n=new SharedArrayBuffer(t.byteLength),i=new Uint8Array(t);return new Uint8Array(n).set(i,0),new e(n)}class DT{constructor(e,t=500){const n=RT()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:i}=this;e===null&&(e=~~(n.length*i));const o=new t(e);o.set(n,0),this.array=o}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let i=0,o=e.length;i<o;i++)t[n+i]=e[i];this.length+=e.length}clear(){this.length=0}}class k2{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let i=0;for(let o=0;o<t;o++)i+=n[o][e].length;return i}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const i={};t.push(i);for(const o in n)i[o]=new DT(n[o].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,i=n[0][e];if(i){if(i.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let o=0,a=n.length;o<a;o++)n[o][e]=new DT(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const n in t)t[n].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class U2{constructor(e){this.triangle=new p.CJI().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new p.CJI().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class BT{constructor(){this.data={}}addTriangleIntersection(e,t,n,i){const{data:o}=this;o[e]||(o[e]=new U2(t)),o[e].addTriangle(n,i)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(e!==null)e in t&&n.push(t[e].triangle);else for(const i in t)n.push(t[i].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(n=>parseInt(n)):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,i=new Set,o=[],a=c=>{if(n[c])if(t!==null)n[c].intersects[t]&&o.push(n[c].intersects[t]);else{const u=n[c].intersects;for(const d in u)i.has(d)||(i.add(d),o.push(u[d]))}};if(e!==null)a(e);else for(const c in n)a(c);return o}reset(){this.data={}}}class N2{constructor(){this.enabled=!1,this.triangleIntersectsA=new BT,this.triangleIntersectsB=new BT,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,i){const{triangleIntersectsA:o,triangleIntersectsB:a}=this;o.addTriangleIntersection(e,t,n,i),a.addTriangleIntersection(n,i,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class OT{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:i}=this;n[e]||(n[e]=[],i.push(e)),n[e].push(t)}}const lm=new p.zHn,LT=new p.yGw,ml=new p.CJI,Pp=new p.Pa4,kT=new p.Ltg,UT=new p.Ltg,NT=new p.Ltg,_S=new p.Ltg,kx=new p.Ltg,Ux=new p.Ltg,yS=new p.Zzh,AS=new p.Pa4,bS=1e-8,F2=1e-15,Nx=-1,Fx=1,FT=-2,wS=2,jx=0,zx=1,xS=2;let Vx=null;function jT(s){Vx=s}function zT(s,e){function t(){return Math.random()-.5}s.getNormal(AS),lm.direction.copy(AS),s.getMidpoint(lm.origin);let n=0,i=1/0;for(let o=0;o<3;o++){lm.direction.x+=t()*bS,lm.direction.y+=t()*bS,lm.direction.z+=t()*bS,lm.direction.multiplyScalar(-1);const a=e.raycastFirst(lm,p.ehD);if(a&&lm.direction.dot(a.face.normal)>0&&n++,a!==null&&(i=Math.min(i,a.distance)),i<=F2)return a.face.normal.dot(AS)>0?wS:FT;if(n/3>.5||(o-n+1)/3>.5)break}return n/3>.5?Nx:Fx}function j2(s,e,t,n,i,o,a=!1){const c=t.attributes,u=t.index,d=3*s,m=u.getX(d+0),g=u.getX(d+1),_=u.getX(d+2);for(const w in o){const x=c[w],T=o[w];if(!(w in c))throw new Error(`CSG Operations: Attribute ${w} not available on geometry.`);const I=x.itemSize;w==="position"?(ml.a.fromBufferAttribute(x,m).applyMatrix4(n),ml.b.fromBufferAttribute(x,g).applyMatrix4(n),ml.c.fromBufferAttribute(x,_).applyMatrix4(n),ES(ml.a,ml.b,ml.c,e,3,T,a)):w==="normal"?(ml.a.fromBufferAttribute(x,m).applyNormalMatrix(i),ml.b.fromBufferAttribute(x,g).applyNormalMatrix(i),ml.c.fromBufferAttribute(x,_).applyNormalMatrix(i),a&&(ml.a.multiplyScalar(-1),ml.b.multiplyScalar(-1),ml.c.multiplyScalar(-1)),ES(ml.a,ml.b,ml.c,e,3,T,a,!0)):(kT.fromBufferAttribute(x,m),UT.fromBufferAttribute(x,g),NT.fromBufferAttribute(x,_),ES(kT,UT,NT,e,I,T,a))}}function z2(s,e,t,n,i,o,a,c=!1){SS(s,n,i,o,a,c),SS(c?t:e,n,i,o,a,c),SS(c?e:t,n,i,o,a,c)}function VT(s,e,t=!1){switch(s){case CT:if(e===Fx||e===wS&&!t)return zx;break;case MT:if(t){if(e===Nx)return jx}else if(e===Fx||e===FT)return zx;break;case TT:if(e===Nx)return jx;if(e===Fx)return zx;break;case IT:if(e===Nx||e===wS&&!t)return zx;break;default:throw new Error(`Unrecognized CSG operation enum "${s}".`)}return xS}function ES(s,e,t,n,i,o,a=!1,c=!1){const u=d=>{o.push(d.x),i>1&&o.push(d.y),i>2&&o.push(d.z),i>3&&o.push(d.w)};_S.set(0,0,0,0).addScaledVector(s,n.a.x).addScaledVector(e,n.a.y).addScaledVector(t,n.a.z),kx.set(0,0,0,0).addScaledVector(s,n.b.x).addScaledVector(e,n.b.y).addScaledVector(t,n.b.z),Ux.set(0,0,0,0).addScaledVector(s,n.c.x).addScaledVector(e,n.c.y).addScaledVector(t,n.c.z),c&&(_S.normalize(),kx.normalize(),Ux.normalize()),u(_S),a?(u(Ux),u(kx)):(u(kx),u(Ux))}function SS(s,e,t,n,i,o=!1){for(const a in i){const c=e[a],u=i[a];if(!(a in e))throw new Error(`CSG Operations: Attribute ${a} no available on geometry.`);const d=c.itemSize;a==="position"?(Pp.fromBufferAttribute(c,s).applyMatrix4(t),u.push(Pp.x,Pp.y,Pp.z)):a==="normal"?(Pp.fromBufferAttribute(c,s).applyNormalMatrix(n),o&&Pp.multiplyScalar(-1),u.push(Pp.x,Pp.y,Pp.z)):(u.push(c.getX(s)),d>1&&u.push(c.getY(s)),d>2&&u.push(c.getZ(s)),d>3&&u.push(c.getW(s)))}}const cm=new p.yGw,Gx=new p.Vkp,mv=new p.CJI,Hx=new p.CJI,Qx=new p.CJI,Wx=new p.CJI;function V2(s){for(const e of s)return e}function GT(s,e,t,n,i,o,a,c=0){const u=s.matrixWorld.determinant()<0;cm.copy(e.matrixWorld).invert().multiply(s.matrixWorld),Gx.getNormalMatrix(s.matrixWorld).multiplyScalar(u?-1:1);const d=s.geometry.groupIndices,m=s.geometry.index,g=s.geometry.attributes.position,_=e.geometry.boundsTree,w=e.geometry.index,x=e.geometry.attributes.position,T=t.ids,I=t.intersectionSet;for(let R=0,M=T.length;R<M;R++){const C=T[R],L=c===-1?0:d[C]+c,k=a.getGroupSet(L),j=3*C,H=m.getX(j+0),X=m.getX(j+1),ee=m.getX(j+2);mv.a.fromBufferAttribute(g,H).applyMatrix4(cm),mv.b.fromBufferAttribute(g,X).applyMatrix4(cm),mv.c.fromBufferAttribute(g,ee).applyMatrix4(cm),o.initialize(mv);const oe=I[C];for(let he=0,le=oe.length;he<le;he++){const ue=3*oe[he],ge=w.getX(ue+0),_e=w.getX(ue+1),Ee=w.getX(ue+2);Hx.a.fromBufferAttribute(x,ge),Hx.b.fromBufferAttribute(x,_e),Hx.c.fromBufferAttribute(x,Ee),o.splitByTriangle(Hx)}const re=o.triangles;for(let he=0,le=re.length;he<le;he++){const ue=re[he],ge=VT(n,zT(ue,_),i);if(ge!==xS){mv.getBarycoord(ue.a,Wx.a),mv.getBarycoord(ue.b,Wx.b),mv.getBarycoord(ue.c,Wx.c);const _e=ge===jx;j2(C,Wx,s.geometry,s.matrixWorld,Gx,k,u!==_e)}}}return T.length}function HT(s,e,t,n,i,o,a=0){const c=s.matrixWorld.determinant()<0;cm.copy(e.matrixWorld).invert().multiply(s.matrixWorld),Gx.getNormalMatrix(s.matrixWorld).multiplyScalar(c?-1:1);const u=e.geometry.boundsTree,d=s.geometry.groupIndices,m=s.geometry.index,g=s.geometry.attributes,_=g.position,w=[],x=s.geometry.halfEdges,T=new Set;for(let I=0,R=m.count/3;I<R;I++)I in t.intersectionSet||T.add(I);for(;T.size>0;){const I=V2(T);T.delete(I),w.push(I);const R=3*I,M=m.getX(R+0),C=m.getX(R+1),L=m.getX(R+2);Qx.a.fromBufferAttribute(_,M).applyMatrix4(cm),Qx.b.fromBufferAttribute(_,C).applyMatrix4(cm),Qx.c.fromBufferAttribute(_,L).applyMatrix4(cm);const k=VT(n,zT(Qx,u),i);for(;w.length>0;){const j=w.pop(),H=a===-1?0:d[j]+a,X=o.getGroupSet(H);for(let ue=0;ue<3;ue++){const ge=x.getSiblingTriangleIndex(j,ue);ge!==-1&&T.has(ge)&&(w.push(ge),T.delete(ge))}if(k===xS)continue;const ee=3*j,oe=m.getX(ee+0),re=m.getX(ee+1),he=m.getX(ee+2),le=k===jx;z2(oe,re,he,g,s.matrixWorld,Gx,X,le!==c)}}}const QT=0,G2=1,H2=2,CS=1.25,WT=1,MS=65535,Q2=Math.pow(2,-24);class qx{constructor(){}}function ud(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function qT(s){let e=-1,t=-1/0;for(let n=0;n<3;n++){const i=s[n+3]-s[n];i>t&&(t=i,e=n)}return e}function XT(s,e){e.set(s)}function YT(s,e,t){let n,i;for(let o=0;o<3;o++){const a=o+3;n=s[o],i=e[o],t[o]=n<i?n:i,n=s[a],i=e[a],t[a]=n>i?n:i}}function Xx(s,e,t){for(let n=0;n<3;n++){const i=e[s+2*n],o=e[s+2*n+1],a=i-o,c=i+o;a<t[n]&&(t[n]=a),c>t[n+3]&&(t[n+3]=c)}}function NA(s){const e=s[3]-s[0],t=s[4]-s[1],n=s[5]-s[2];return 2*(e*t+t*n+n*e)}function TS(s,e,t,n,i=null){let o=1/0,a=1/0,c=1/0,u=-1/0,d=-1/0,m=-1/0,g=1/0,_=1/0,w=1/0,x=-1/0,T=-1/0,I=-1/0;const R=i!==null;for(let M=6*e,C=6*(e+t);M<C;M+=6){const L=s[M+0],k=s[M+1],j=L-k,H=L+k;j<o&&(o=j),H>u&&(u=H),R&&L<g&&(g=L),R&&L>x&&(x=L);const X=s[M+2],ee=s[M+3],oe=X-ee,re=X+ee;oe<a&&(a=oe),re>d&&(d=re),R&&X<_&&(_=X),R&&X>T&&(T=X);const he=s[M+4],le=s[M+5],ue=he-le,ge=he+le;ue<c&&(c=ue),ge>m&&(m=ge),R&&he<w&&(w=he),R&&he>I&&(I=he)}n[0]=o,n[1]=a,n[2]=c,n[3]=u,n[4]=d,n[5]=m,R&&(i[0]=g,i[1]=_,i[2]=w,i[3]=x,i[4]=T,i[5]=I)}const Rp=32,W2=(s,e)=>s.candidate-e.candidate,um=new Array(Rp).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Yx=new Float32Array(6);class hd{constructor(e,t,n){this.isOrientedBox=!0,this.min=new p.Pa4,this.max=new p.Pa4,this.matrix=new p.yGw,this.invMatrix=new p.yGw,this.points=new Array(8).fill().map(()=>new p.Pa4),this.satAxes=new Array(3).fill().map(()=>new p.Pa4),this.satBounds=new Array(3).fill().map(()=>new Mp),this.alignedSatBounds=new Array(3).fill().map(()=>new Mp),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}hd.prototype.update=function(){const s=this.matrix,e=this.min,t=this.max,n=this.points;for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)for(let m=0;m<=1;m++){const g=n[1*u|2*d|4*m];g.x=u?t.x:e.x,g.y=d?t.y:e.y,g.z=m?t.z:e.z,g.applyMatrix4(s)}const i=this.satBounds,o=this.satAxes,a=n[0];for(let u=0;u<3;u++){const d=o[u],m=i[u],g=n[1<<u];d.subVectors(a,g),m.setFromPoints(d,n)}const c=this.alignedSatBounds;c[0].setFromPointsField(n,"x"),c[1].setFromPointsField(n,"y"),c[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},hd.prototype.intersectsBox=function(){const s=new Mp;return function(e){this.needsUpdate&&this.update();const t=e.min,n=e.max,i=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(s.min=t.x,s.max=n.x,a[0].isSeparated(s)||(s.min=t.y,s.max=n.y,a[1].isSeparated(s))||(s.min=t.z,s.max=n.z,a[2].isSeparated(s)))return!1;for(let c=0;c<3;c++){const u=o[c],d=i[c];if(s.setFromBox(u,e),d.isSeparated(s))return!1}return!0}}(),hd.prototype.intersectsTriangle=function(){const s=new cd,e=new Array(3),t=new Mp,n=new Mp,i=new p.Pa4;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(s.copy(o),s.update(),o=s);const a=this.satBounds,c=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let g=0;g<3;g++){const _=a[g],w=c[g];if(t.setFromPoints(w,e),_.isSeparated(t))return!1}const u=o.satBounds,d=o.satAxes,m=this.points;for(let g=0;g<3;g++){const _=u[g],w=d[g];if(t.setFromPoints(w,m),_.isSeparated(t))return!1}for(let g=0;g<3;g++){const _=c[g];for(let w=0;w<4;w++){const x=d[w];if(i.crossVectors(_,x),t.setFromPoints(i,e),n.setFromPoints(i,m),t.isSeparated(n))return!1}}return!0}}(),hd.prototype.closestPointToPoint=function(s,e){return this.needsUpdate&&this.update(),e.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},hd.prototype.distanceToPoint=function(){const s=new p.Pa4;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}(),hd.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new p.Zzh),t=new Array(12).fill().map(()=>new p.Zzh),n=new p.Pa4,i=new p.Pa4;return function(o,a=0,c=null,u=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||u)&&(o.getCenter(i),this.closestPointToPoint(i,n),o.closestPointToPoint(n,i),c&&c.copy(n),u&&u.copy(i)),0;const d=a*a,m=o.min,g=o.max,_=this.points;let w=1/0;for(let T=0;T<8;T++){const I=_[T];i.copy(I).clamp(m,g);const R=I.distanceToSquared(i);if(R<w&&(w=R,c&&c.copy(I),u&&u.copy(i),R<d))return Math.sqrt(R)}let x=0;for(let T=0;T<3;T++)for(let I=0;I<=1;I++)for(let R=0;R<=1;R++){const M=(T+1)%3,C=(T+2)%3,L=1<<T|I<<M|R<<C,k=_[I<<M|R<<C],j=_[L];e[x].set(k,j);const H=s[T],X=s[M],ee=s[C],oe=t[x],re=oe.start,he=oe.end;re[H]=m[H],re[X]=I?m[X]:g[X],re[ee]=R?m[ee]:g[X],he[H]=g[H],he[X]=I?m[X]:g[X],he[ee]=R?m[ee]:g[X],x++}for(let T=0;T<=1;T++)for(let I=0;I<=1;I++)for(let R=0;R<=1;R++){i.x=T?g.x:m.x,i.y=I?g.y:m.y,i.z=R?g.z:m.z,this.closestPointToPoint(i,n);const M=i.distanceToSquared(n);if(M<w&&(w=M,c&&c.copy(n),u&&u.copy(i),M<d))return Math.sqrt(M)}for(let T=0;T<12;T++){const I=e[T];for(let R=0;R<12;R++){const M=t[R];vS(I,M,n,i);const C=n.distanceToSquared(i);if(C<w&&(w=C,c&&c.copy(n),u&&u.copy(i),C<d))return Math.sqrt(C)}}return Math.sqrt(w)}}();const Kx=new p.Pa4,Jx=new p.Pa4,Zx=new p.Pa4,KT=new p.FM8,JT=new p.FM8,ZT=new p.FM8,$T=new p.Pa4;function eI(s,e,t,n,i){const o=3*n,a=s.index.getX(o),c=s.index.getX(o+1),u=s.index.getX(o+2),d=function(m,g,_,w,x,T,I){Kx.fromBufferAttribute(g,w),Jx.fromBufferAttribute(g,x),Zx.fromBufferAttribute(g,T);const R=function(M,C,L,k,j,H){let X;return X=H===p._Li?M.intersectTriangle(k,L,C,!0,j):M.intersectTriangle(C,L,k,H!==p.ehD,j),X===null?null:{distance:M.origin.distanceTo(j),point:j.clone()}}(m,Kx,Jx,Zx,$T,I);if(R){_&&(KT.fromBufferAttribute(_,w),JT.fromBufferAttribute(_,x),ZT.fromBufferAttribute(_,T),R.uv=p.CJI.getUV($T,Kx,Jx,Zx,KT,JT,ZT,new p.FM8));const M={a:w,b:x,c:T,normal:new p.Pa4,materialIndex:0};p.CJI.getNormal(Kx,Jx,Zx,M.normal),R.face=M,R.faceIndex=w}return R}(t,s.attributes.position,s.attributes.uv,a,c,u,e);return d?(d.faceIndex=n,i&&i.push(d),d):null}function dd(s,e,t,n){const i=s.a,o=s.b,a=s.c;let c=e,u=e+1,d=e+2;t&&(c=t.getX(e),u=t.getX(e+1),d=t.getX(e+2)),i.x=n.getX(c),i.y=n.getY(c),i.z=n.getZ(c),o.x=n.getX(u),o.y=n.getY(u),o.z=n.getZ(u),a.x=n.getX(d),a.y=n.getY(d),a.z=n.getZ(d)}function tI(s,e,t,n,i,o,a){const c=t.index,u=t.attributes.position;for(let d=s,m=e+s;d<m;d++)if(dd(a,3*d,c,u),a.needsUpdate=!0,n(a,d,i,o))return!0;return!1}class nI{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function hm(s,e){return e[s+15]===65535}function s0(s,e){return e[s+6]}function FA(s,e){return e[s+14]}function jA(s){return s+8}function zA(s,e){return e[s+6]}const o0=new p.ZzF,$x=new p.Pa4,q2=["x","y","z"];function IS(s,e,t,n,i){let o=2*s,a=a0,c=dm,u=pm;if(hm(o,c))(function(d,m,g,_,w,x){for(let T=_,I=_+w;T<I;T++)eI(d,m,g,T,x)})(e,t,n,s0(s,u),FA(o,c),i);else{const d=jA(s);e1(d,a,n,$x)&&IS(d,e,t,n,i);const m=zA(s,u);e1(m,a,n,$x)&&IS(m,e,t,n,i)}}function PS(s,e,t,n){let i=2*s,o=a0,a=dm,c=pm;if(hm(i,a))return function(u,d,m,g,_){let w=1/0,x=null;for(let T=g,I=g+_;T<I;T++){const R=eI(u,d,m,T);R&&R.distance<w&&(x=R,w=R.distance)}return x}(e,t,n,s0(s,c),FA(i,a));{const u=function(T,I){return I[T+7]}(s,c),d=q2[u],m=n.direction[d]>=0;let g,_;m?(g=jA(s),_=zA(s,c)):(g=zA(s,c),_=jA(s));const w=e1(g,o,n,$x)?PS(g,e,t,n):null;if(w){const T=w.point[d];if(m?T<=o[_+u]:T>=o[_+u+3])return w}const x=e1(_,o,n,$x)?PS(_,e,t,n):null;return w&&x?w.distance<=x.distance?w:x:w||x||null}}const X2=function(){let s,e;const t=[],n=new nI(()=>new p.ZzF);return function(...o){s=n.getPrimitive(),e=n.getPrimitive(),t.push(s,e);const a=i(...o);n.releasePrimitive(s),n.releasePrimitive(e),t.pop(),t.pop();const c=t.length;return c>0&&(e=t[c-1],s=t[c-2]),a};function i(o,a,c,u,d=null,m=0,g=0){function _(M){let C=2*M,L=dm,k=pm;for(;!hm(C,L);)C=2*(M=jA(M));return s0(M,k)}function w(M){let C=2*M,L=dm,k=pm;for(;!hm(C,L);)C=2*(M=zA(M,k));return s0(M,k)+FA(C,L)}let x=2*o,T=a0,I=dm,R=pm;if(hm(x,I)){const M=s0(o,R),C=FA(x,I);return ud(o,T,s),u(M,C,!1,g,m+o,s)}{const M=jA(o),C=zA(o,R);let L,k,j,H,X=M,ee=C;if(d&&(j=s,H=e,ud(X,T,j),ud(ee,T,H),L=d(j),k=d(H),k<L)){X=C,ee=M;const ue=L;L=k,k=ue,j=H}j||(j=s,ud(X,T,j));const oe=c(j,hm(2*X,I),L,g+1,m+X);let re;if(oe===2){const ue=_(X);re=u(ue,w(X)-ue,!0,g+1,m+X,j)}else re=oe&&i(X,a,c,u,d,m,g+1);if(re)return!0;H=e,ud(ee,T,H);const he=c(H,hm(2*ee,I),k,g+1,m+ee);let le;if(he===2){const ue=_(ee);le=u(ue,w(ee)-ue,!0,g+1,m+ee,H)}else le=he&&i(ee,a,c,u,d,m,g+1);return!!le}}}(),Y2=function(){const s=new cd,e=new cd,t=new p.yGw,n=new hd,i=new hd;return function o(a,c,u,d,m=null){let g=2*a,_=a0,w=dm,x=pm;if(m===null&&(u.boundingBox||u.computeBoundingBox(),n.set(u.boundingBox.min,u.boundingBox.max,d),m=n),!hm(g,w)){const T=a+8,I=x[a+6];return ud(T,_,o0),m.intersectsBox(o0)&&o(T,c,u,d,m)?!0:(ud(I,_,o0),!(!m.intersectsBox(o0)||!o(I,c,u,d,m)))}{const T=c,I=T.index,R=T.attributes.position,M=u.index,C=u.attributes.position,L=s0(a,x),k=FA(g,w);if(t.copy(d).invert(),u.boundsTree)return ud(a,_,i),i.matrix.copy(t),i.needsUpdate=!0,u.boundsTree.shapecast({intersectsBounds:H=>i.intersectsBox(H),intersectsTriangle:H=>{H.a.applyMatrix4(d),H.b.applyMatrix4(d),H.c.applyMatrix4(d),H.needsUpdate=!0;for(let X=3*L,ee=3*(k+L);X<ee;X+=3)if(dd(e,X,I,R),e.needsUpdate=!0,H.intersectsTriangle(e))return!0;return!1}});for(let j=3*L,H=k+3*L;j<H;j+=3){dd(s,j,I,R),s.a.applyMatrix4(t),s.b.applyMatrix4(t),s.c.applyMatrix4(t),s.needsUpdate=!0;for(let X=0,ee=M.count;X<ee;X+=3)if(dd(e,X,M,C),e.needsUpdate=!0,s.intersectsTriangle(e))return!0}}}}();function e1(s,e,t,n){return ud(s,e,o0),t.intersectBox(o0,n)}const RS=[];let t1,a0,dm,pm;function VA(s){t1&&RS.push(t1),t1=s,a0=new Float32Array(s),dm=new Uint16Array(s),pm=new Uint32Array(s)}function n1(){t1=null,a0=null,dm=null,pm=null,RS.length&&VA(RS.pop())}const DS=Symbol("skip tree generation"),BS=new p.ZzF,OS=new p.ZzF,l0=new p.yGw,gv=new hd,GA=new hd,HA=new p.Pa4,i1=new p.Pa4,K2=new p.Pa4,J2=new p.Pa4,Z2=new p.Pa4,iI=new p.ZzF,pd=new nI(()=>new cd);class QA{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),QA.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,i=e._roots,o=n.getIndex();let a;return a=t.cloneBuffers?{roots:i.map(c=>c.slice()),index:o.array.slice()}:{roots:i,index:o.array},a}static deserialize(e,t,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),QA.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});n={setIndex:!0,...n};const{index:i,roots:o}=e,a=new QA(t,{...n,[DS]:!0});if(a._roots=o,n.setIndex){const c=t.getIndex();if(c===null){const u=new p.TlE(e.index,1,!1);t.setIndex(u)}else c.array!==i&&(c.array.set(i),c.needsUpdate=!0)}return a}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:QT,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[DS]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[DS]||(this._roots=function(n,i){const o=function(w,x){function T(ue){ee&&ee(ue/oe)}function I(ue,ge,_e,Ee=null,Ye=0){if(!re&&Ye>=k&&(re=!0,j&&(console.warn(`MeshBVH: Max depth of ${k} reached when generating BVH. Consider increasing maxDepth.`),console.warn(w))),_e<=H||Ye>=k)return T(ge+_e),ue.offset=ge,ue.count=_e,ue;const We=function(lt,rt,kt,Pt,sn,hn){let wn=-1,Xn=0;if(hn===QT)wn=qT(rt),wn!==-1&&(Xn=(rt[wn]+rt[wn+3])/2);else if(hn===G2)wn=qT(lt),wn!==-1&&(Xn=function(zn,Gn,gt,zt){let an=0;for(let ui=Gn,Ri=Gn+gt;ui<Ri;ui++)an+=zn[6*ui+2*zt];return an/gt}(kt,Pt,sn,wn));else if(hn===H2){const zn=NA(lt);let Gn=CS*sn;const gt=6*Pt,zt=6*(Pt+sn);for(let an=0;an<3;an++){const ui=rt[an],Ri=(rt[an+3]-ui)/Rp;if(sn<Rp/4){const _i=[...um];_i.length=sn;let ni=0;for(let Bn=gt;Bn<zt;Bn+=6,ni++){const ut=_i[ni];ut.candidate=kt[Bn+2*an],ut.count=0;const{bounds:on,leftCacheBounds:kn,rightCacheBounds:Yt}=ut;for(let Zn=0;Zn<3;Zn++)Yt[Zn]=1/0,Yt[Zn+3]=-1/0,kn[Zn]=1/0,kn[Zn+3]=-1/0,on[Zn]=1/0,on[Zn+3]=-1/0;Xx(Bn,kt,on)}_i.sort(W2);let ii=sn;for(let Bn=0;Bn<ii;Bn++){const ut=_i[Bn];for(;Bn+1<ii&&_i[Bn+1].candidate===ut.candidate;)_i.splice(Bn+1,1),ii--}for(let Bn=gt;Bn<zt;Bn+=6){const ut=kt[Bn+2*an];for(let on=0;on<ii;on++){const kn=_i[on];ut>=kn.candidate?Xx(Bn,kt,kn.rightCacheBounds):(Xx(Bn,kt,kn.leftCacheBounds),kn.count++)}}for(let Bn=0;Bn<ii;Bn++){const ut=_i[Bn],on=ut.count,kn=sn-ut.count,Yt=ut.leftCacheBounds,Zn=ut.rightCacheBounds;let Nr=0;on!==0&&(Nr=NA(Yt)/zn);let $r=0;kn!==0&&($r=NA(Zn)/zn);const Gs=WT+CS*(Nr*on+$r*kn);Gs<Gn&&(wn=an,Gn=Gs,Xn=ut.candidate)}}else{for(let ii=0;ii<Rp;ii++){const Bn=um[ii];Bn.count=0,Bn.candidate=ui+Ri+ii*Ri;const ut=Bn.bounds;for(let on=0;on<3;on++)ut[on]=1/0,ut[on+3]=-1/0}for(let ii=gt;ii<zt;ii+=6){let Bn=~~((kt[ii+2*an]-ui)/Ri);Bn>=Rp&&(Bn=Rp-1);const ut=um[Bn];ut.count++,Xx(ii,kt,ut.bounds)}const _i=um[Rp-1];XT(_i.bounds,_i.rightCacheBounds);for(let ii=Rp-2;ii>=0;ii--){const Bn=um[ii],ut=um[ii+1];YT(Bn.bounds,ut.rightCacheBounds,Bn.rightCacheBounds)}let ni=0;for(let ii=0;ii<Rp-1;ii++){const Bn=um[ii],ut=Bn.count,on=Bn.bounds,kn=um[ii+1].rightCacheBounds;ut!==0&&(ni===0?XT(on,Yx):YT(on,Yx,Yx)),ni+=ut;let Yt=0,Zn=0;ni!==0&&(Yt=NA(Yx)/zn);const Nr=sn-ni;Nr!==0&&(Zn=NA(kn)/zn);const $r=WT+CS*(Yt*ni+Zn*Nr);$r<Gn&&(wn=an,Gn=$r,Xn=Bn.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${hn} used.`);return{axis:wn,pos:Xn}}(ue.boundingData,Ee,C,ge,_e,X);if(We.axis===-1)return T(ge+_e),ue.offset=ge,ue.count=_e,ue;const Et=function(lt,rt,kt,Pt,sn){let hn=kt,wn=kt+Pt-1;const Xn=sn.pos,zn=2*sn.axis;for(;;){for(;hn<=wn&&rt[6*hn+zn]<Xn;)hn++;for(;hn<=wn&&rt[6*wn+zn]>=Xn;)wn--;if(!(hn<wn))return hn;for(let Gn=0;Gn<3;Gn++){let gt=lt[3*hn+Gn];lt[3*hn+Gn]=lt[3*wn+Gn],lt[3*wn+Gn]=gt;let zt=rt[6*hn+2*Gn+0];rt[6*hn+2*Gn+0]=rt[6*wn+2*Gn+0],rt[6*wn+2*Gn+0]=zt;let an=rt[6*hn+2*Gn+1];rt[6*hn+2*Gn+1]=rt[6*wn+2*Gn+1],rt[6*wn+2*Gn+1]=an}hn++,wn--}}(L,C,ge,_e,We);if(Et===ge||Et===ge+_e)T(ge+_e),ue.offset=ge,ue.count=_e;else{ue.splitAxis=We.axis;const lt=new qx,rt=ge,kt=Et-ge;ue.left=lt,lt.boundingData=new Float32Array(6),TS(C,rt,kt,lt.boundingData,M),I(lt,rt,kt,M,Ye+1);const Pt=new qx,sn=Et,hn=_e-kt;ue.right=Pt,Pt.boundingData=new Float32Array(6),TS(C,sn,hn,Pt.boundingData,M),I(Pt,sn,hn,M,Ye+1)}return ue}(function(ue,ge){if(!ue.index){const _e=ue.attributes.position.count,Ee=ge.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Ye;Ye=_e>65535?new Uint32Array(new Ee(4*_e)):new Uint16Array(new Ee(2*_e)),ue.setIndex(new p.TlE(Ye,1));for(let We=0;We<_e;We++)Ye[We]=We}})(w,x);const R=new Float32Array(6),M=new Float32Array(6),C=function(ue,ge){const _e=ue.attributes.position,Ee=ue.index.array,Ye=Ee.length/3,We=new Float32Array(6*Ye),Et=_e.normalized,lt=_e.array,rt=_e.offset||0;let kt=3;_e.isInterleavedBufferAttribute&&(kt=_e.data.stride);const Pt=["getX","getY","getZ"];for(let sn=0;sn<Ye;sn++){const hn=3*sn,wn=6*sn;let Xn,zn,Gn;Et?(Xn=Ee[hn+0],zn=Ee[hn+1],Gn=Ee[hn+2]):(Xn=Ee[hn+0]*kt+rt,zn=Ee[hn+1]*kt+rt,Gn=Ee[hn+2]*kt+rt);for(let gt=0;gt<3;gt++){let zt,an,ui;Et?(zt=_e[Pt[gt]](Xn),an=_e[Pt[gt]](zn),ui=_e[Pt[gt]](Gn)):(zt=lt[Xn+gt],an=lt[zn+gt],ui=lt[Gn+gt]);let Ri=zt;an<Ri&&(Ri=an),ui<Ri&&(Ri=ui);let _i=zt;an>_i&&(_i=an),ui>_i&&(_i=ui);const ni=(_i-Ri)/2,ii=2*gt;We[wn+ii+0]=Ri+ni,We[wn+ii+1]=ni+(Math.abs(Ri)+ni)*Q2,Ri<ge[gt]&&(ge[gt]=Ri),_i>ge[gt+3]&&(ge[gt+3]=_i)}}return We}(w,R),L=w.index.array,k=x.maxDepth,j=x.verbose,H=x.maxLeafTris,X=x.strategy,ee=x.onProgress,oe=w.index.count/3;let re=!1;const he=[],le=function(ue){if(!ue.groups||!ue.groups.length)return[{offset:0,count:ue.index.count/3}];const ge=[],_e=new Set;for(const Ye of ue.groups)_e.add(Ye.start),_e.add(Ye.start+Ye.count);const Ee=Array.from(_e.values()).sort((Ye,We)=>Ye-We);for(let Ye=0;Ye<Ee.length-1;Ye++){const We=Ee[Ye],Et=Ee[Ye+1];ge.push({offset:We/3,count:(Et-We)/3})}return ge}(w);if(le.length===1){const ue=le[0],ge=new qx;ge.boundingData=R,function(_e,Ee,Ye,We){let Et=1/0,lt=1/0,rt=1/0,kt=-1/0,Pt=-1/0,sn=-1/0;for(let hn=6*Ee,wn=6*(Ee+Ye);hn<wn;hn+=6){const Xn=_e[hn+0];Xn<Et&&(Et=Xn),Xn>kt&&(kt=Xn);const zn=_e[hn+2];zn<lt&&(lt=zn),zn>Pt&&(Pt=zn);const Gn=_e[hn+4];Gn<rt&&(rt=Gn),Gn>sn&&(sn=Gn)}We[0]=Et,We[1]=lt,We[2]=rt,We[3]=kt,We[4]=Pt,We[5]=sn}(C,ue.offset,ue.count,M),I(ge,ue.offset,ue.count,M),he.push(ge)}else for(let ue of le){const ge=new qx;ge.boundingData=new Float32Array(6),TS(C,ue.offset,ue.count,ge.boundingData,M),I(ge,ue.offset,ue.count,M),he.push(ge)}return he}(n,i);let a,c,u;const d=[],m=i.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let w=0;w<o.length;w++){const x=o[w],T=new m(32*g(x));a=new Float32Array(T),c=new Uint32Array(T),u=new Uint16Array(T),_(0,x),d.push(T)}return d;function g(w){return w.count?1:1+g(w.left)+g(w.right)}function _(w,x){const T=w/4,I=w/2,R=!!x.count,M=x.boundingData;for(let C=0;C<6;C++)a[T+C]=M[C];if(R){const C=x.offset,L=x.count;return c[T+6]=C,u[I+14]=L,u[I+15]=MS,w+32}{const C=x.left,L=x.right,k=x.splitAxis;let j;if(j=_(w+32,C),j/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return c[T+6]=j/4,j=_(j,L),c[T+7]=k,j}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new p.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,i=t.attributes.position;let o,a,c,u,d=0;const m=this._roots;for(let _=0,w=m.length;_<w;_++)o=m[_],a=new Uint32Array(o),c=new Uint16Array(o),u=new Float32Array(o),g(0,d),d+=o.byteLength;function g(_,w,x=!1){const T=2*_;if(c[T+15]===MS){const I=a[_+6];let R=1/0,M=1/0,C=1/0,L=-1/0,k=-1/0,j=-1/0;for(let H=3*I,X=3*(I+c[T+14]);H<X;H++){const ee=n[H],oe=i.getX(ee),re=i.getY(ee),he=i.getZ(ee);oe<R&&(R=oe),oe>L&&(L=oe),re<M&&(M=re),re>k&&(k=re),he<C&&(C=he),he>j&&(j=he)}return(u[_+0]!==R||u[_+1]!==M||u[_+2]!==C||u[_+3]!==L||u[_+4]!==k||u[_+5]!==j)&&(u[_+0]=R,u[_+1]=M,u[_+2]=C,u[_+3]=L,u[_+4]=k,u[_+5]=j,!0)}{const I=_+8,R=a[_+6],M=I+w,C=R+w;let L=x,k=!1,j=!1;e?L||(k=e.has(M),j=e.has(C),L=!k&&!j):(k=!0,j=!0);const H=L||j;let X=!1;(L||k)&&(X=g(I,w,L));let ee=!1;H&&(ee=g(R,w,L));const oe=X||ee;if(oe)for(let re=0;re<3;re++){const he=I+re,le=R+re,ue=u[he],ge=u[he+3],_e=u[le],Ee=u[le+3];u[_+re]=ue<_e?ue:_e,u[_+re+3]=ge>Ee?ge:Ee}return oe}}}traverse(e,t=0){const n=this._roots[t],i=new Uint32Array(n),o=new Uint16Array(n);(function a(c,u=0){const d=2*c,m=o[d+15]===MS;if(m){const g=i[c+6],_=o[d+14];e(u,m,new Float32Array(n,4*c,6),g,_)}else{const g=c+8,_=i[c+6],w=i[c+7];e(u,m,new Float32Array(n,4*c,6),w)||(a(g,u+1),a(_,u+1))}})(0)}raycast(e,t=p.Wl3){const n=this._roots,i=this.geometry,o=[],a=t.isMaterial,c=Array.isArray(t),u=i.groups,d=a?t.side:t;for(let m=0,g=n.length;m<g;m++){const _=c?t[u[m].materialIndex].side:d,w=o.length;if(VA(n[m]),IS(0,i,_,e,o),n1(),c){const x=u[m].materialIndex;for(let T=w,I=o.length;T<I;T++)o[T].face.materialIndex=x}}return o}raycastFirst(e,t=p.Wl3){const n=this._roots,i=this.geometry,o=t.isMaterial,a=Array.isArray(t);let c=null;const u=i.groups,d=o?t.side:t;for(let m=0,g=n.length;m<g;m++){const _=a?t[u[m].materialIndex].side:d;VA(n[m]);const w=PS(0,i,_,e);n1(),w!=null&&(c==null||w.distance<c.distance)&&(c=w,a&&(w.face.materialIndex=u[m].materialIndex))}return c}intersectsGeometry(e,t){const n=this.geometry;let i=!1;for(const o of this._roots)if(VA(o),i=Y2(0,n,e,t),n1(),i)break;return i}shapecast(e,t,n){const i=this.geometry;if(e instanceof Function){if(t){const _=t;t=(w,x,T,I)=>{const R=3*x;return _(w,R,R+1,R+2,T,I)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const o=pd.getPrimitive();let{boundsTraverseOrder:a,intersectsBounds:c,intersectsRange:u,intersectsTriangle:d}=e;if(u&&d){const _=u;u=(w,x,T,I,R)=>!!_(w,x,T,I,R)||tI(w,x,i,d,T,I,o)}else u||(u=d?(_,w,x,T)=>tI(_,w,i,d,x,T,o):(_,w,x)=>x);let m=!1,g=0;for(const _ of this._roots){if(VA(_),m=X2(0,i,c,u,a,g),n1(),m)break;g+=_.byteLength}return pd.releasePrimitive(o),m}bvhcast(e,t,n){let{intersectsRanges:i,intersectsTriangles:o}=n;const a=this.geometry.index,c=this.geometry.attributes.position,u=e.geometry.index,d=e.geometry.attributes.position;l0.copy(t).invert();const m=pd.getPrimitive(),g=pd.getPrimitive();if(o){let w=function(x,T,I,R,M,C,L,k){for(let j=I,H=I+R;j<H;j++){dd(g,3*j,u,d),g.a.applyMatrix4(t),g.b.applyMatrix4(t),g.c.applyMatrix4(t),g.needsUpdate=!0;for(let X=x,ee=x+T;X<ee;X++)if(dd(m,3*X,a,c),m.needsUpdate=!0,o(m,g,X,j,M,C,L,k))return!0}return!1};if(i){const x=i;i=function(T,I,R,M,C,L,k,j){return!!x(T,I,R,M,C,L,k,j)||w(T,I,R,M,C,L,k,j)}}else i=w}e.getBoundingBox(OS),OS.applyMatrix4(t);const _=this.shapecast({intersectsBounds:w=>OS.intersectsBox(w),intersectsRange:(w,x,T,I,R,M)=>(BS.copy(M),BS.applyMatrix4(l0),e.shapecast({intersectsBounds:C=>BS.intersectsBox(C),intersectsRange:(C,L,k,j,H)=>i(w,x,C,L,I,R,j,H)}))});return pd.releasePrimitive(m),pd.releasePrimitive(g),_}intersectsBox(e,t){return gv.set(e.min,e.max,t),gv.needsUpdate=!0,this.shapecast({intersectsBounds:n=>gv.intersectsBox(n),intersectsTriangle:n=>gv.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},i={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),gv.set(e.boundingBox.min,e.boundingBox.max,t),gv.needsUpdate=!0;const c=this.geometry,u=c.attributes.position,d=c.index,m=e.attributes.position,g=e.index,_=pd.getPrimitive(),w=pd.getPrimitive();let x=i1,T=K2,I=null,R=null;i&&(I=J2,R=Z2);let M=1/0,C=null,L=null;return l0.copy(t).invert(),GA.matrix.copy(l0),this.shapecast({boundsTraverseOrder:k=>gv.distanceToBox(k),intersectsBounds:(k,j,H)=>H<M&&H<a&&(j&&(GA.min.copy(k.min),GA.max.copy(k.max),GA.needsUpdate=!0),!0),intersectsRange:(k,j)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:H=>GA.distanceToBox(H),intersectsBounds:(H,X,ee)=>ee<M&&ee<a,intersectsRange:(H,X)=>{for(let ee=3*H,oe=3*(H+X);ee<oe;ee+=3){dd(w,ee,g,m),w.a.applyMatrix4(t),w.b.applyMatrix4(t),w.c.applyMatrix4(t),w.needsUpdate=!0;for(let re=3*k,he=3*(k+j);re<he;re+=3){dd(_,re,d,u),_.needsUpdate=!0;const le=_.distanceToTriangle(w,x,I);if(le<M&&(T.copy(x),R&&R.copy(I),M=le,C=re/3,L=ee/3),le<o)return!0}}}});for(let H=0,X=g?g.count:m.count;H<X;H+=3){dd(w,H,g,m),w.a.applyMatrix4(t),w.b.applyMatrix4(t),w.c.applyMatrix4(t),w.needsUpdate=!0;for(let ee=3*k,oe=3*(k+j);ee<oe;ee+=3){dd(_,ee,d,u),_.needsUpdate=!0;const re=_.distanceToTriangle(w,x,I);if(re<M&&(T.copy(x),R&&R.copy(I),M=re,C=ee/3,L=H/3),re<o)return!0}}}}),pd.releasePrimitive(_),pd.releasePrimitive(w),M===1/0?null:(n.point?n.point.copy(T):n.point=T.clone(),n.distance=M,n.faceIndex=C,i&&(i.point?i.point.copy(R):i.point=R.clone(),i.point.applyMatrix4(l0),T.applyMatrix4(l0),i.distance=T.sub(i.point).length(),i.faceIndex=L),n)}closestPointToPoint(e,t={},n=0,i=1/0){const o=n*n,a=i*i;let c=1/0,u=null;if(this.shapecast({boundsTraverseOrder:m=>(HA.copy(e).clamp(m.min,m.max),HA.distanceToSquared(e)),intersectsBounds:(m,g,_)=>_<c&&_<a,intersectsTriangle:(m,g)=>{m.closestPointToPoint(e,HA);const _=e.distanceToSquared(HA);return _<c&&(i1.copy(HA),c=_,u=g),_<o}}),c===1/0)return null;const d=Math.sqrt(c);return t.point?t.point.copy(i1):t.point=i1.clone(),t.distance=d,t.faceIndex=u,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{ud(0,new Float32Array(t),iI),e.union(iI)}),e}}const $2=1e6*(1+1e-7);function LS(s){return~~(s*$2)}function rI(s){return`${LS(s.x)},${LS(s.y)},${LS(s.z)}`}const kS=[new p.Pa4,new p.Pa4,new p.Pa4];class eD{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,i=e.index,o=n.position;let a=i?i.count/3:o.count/3;const c=a;let u=0;this.useDrawRange&&(u=e.drawRange.start,e.drawRange.count!==1/0&&(a=~~(e.drawRange.count/3)));let d=this.data;(!d||d.length<3*c)&&(d=new Int32Array(3*c)),d.fill(-1);let m=0,g=0;for(let _=0;_<a;_++){const w=3*_+u;for(let x=0;x<3;x++){let T=w+x;i&&(T=i.getX(T)),kS[x].fromBufferAttribute(o,T)}for(let x=0;x<3;x++){const T=(x+1)%3,I=kS[x],R=kS[T],M=rI(I),C=rI(R),L=`${C}_${M}`;if(t.has(L)){const k=t.get(L);d[w+x]=k,d[k]=w+x,t.delete(L),m--,g++}else{const k=`${M}_${C}`;t.set(k,w+x),m++}}}this.matchedEdges=g,this.unmatchedEdges=m,this.data=d}}class r1 extends p.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new p.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,i=t.elements;for(let o=0;o<16;o++)if(n[o]!==i[o])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(RT())for(const n in t){const i=t[n];if(i.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");i.array=L2(i.array)}if(e.boundsTree||(e.boundsTree=new QA(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new eD(e)),!e.groupIndices){const n=e.index.count/3,i=new Uint16Array(n),o=e.groups;for(let a=0,c=o.length;a<c;a++){const{start:u,count:d}=o[a];for(let m=u/3,g=(u+d)/3;m<g;m++)i[m]=a}e.groupIndices=i}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function sI(s,e){let t=e;return Array.isArray(e)||(t=[],s.forEach(n=>{t[n.materialIndex]=e})),t}class tD{constructor(){this.triangleSplitter=new O2,this.attributeData=new k2,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new N2}evaluate(e,t,n,i=new r1){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:o,attributeData:a,attributes:c,useGroups:u,debug:d}=this,m=i.geometry,g=e.geometry.attributes;for(let R=0,M=c.length;R<M;R++){const C=c[R],L=g[C];a.initializeArray(C,L.array.constructor)}for(const R in a.attributes)c.includes(R)||a.delete(R);for(const R in m.attributes)c.includes(R)||(m.deleteAttribute(R),m.dispose());a.clear(),d.enabled&&(d.reset(),jT(d)),function(R,M,C,L,k,j){const{useGroups:H=!0}=j,{aIntersections:X,bIntersections:ee}=function(re,he){const le=new OT,ue=new OT;return LT.copy(re.matrixWorld).invert().multiply(he.matrixWorld),re.geometry.boundsTree.bvhcast(he.geometry.boundsTree,LT,{intersectsTriangles(ge,_e,Ee,Ye){if(ge.intersectsTriangle(_e,yS,!0)){if(yS.distanceSq()===0&&ge.plane.normal.dot(_e.plane.normal)<1-1e-10)return!1;le.add(Ee,Ye),ue.add(Ye,Ee),Vx&&(Vx.addEdge(yS),Vx.addIntersectingTriangles(Ee,ge,Ye,_e))}return!1}}),{aIntersections:le,bIntersections:ue}}(R,M);let oe;oe=H?0:-1,HT(R,M,X,C,!1,k,oe),GT(R,M,X,C,!1,L,k,oe),oe=H?R.geometry.groups.length||1:-1,HT(M,R,ee,C,!0,k,oe),GT(M,R,ee,C,!0,L,k,oe)}(e,t,n,o,a,{useGroups:u}),d.enabled&&jT(null);const _=u&&e.geometry.groups.length!==0?e.geometry.groups.map(R=>({...R})):[{start:0,count:1/0,materialIndex:0}],w=u&&t.geometry.groups.length!==0?t.geometry.groups.map(R=>({...R})):[{start:0,count:1/0,materialIndex:0}],x=sI(_,e.material),T=sI(w,t.material);w.forEach(R=>{R.materialIndex+=x.length}),function(R,M,C,L){let k=!1,j=-1;const H=L.groupCount,X=R.attributes,ee=L.groupAttributes[0];for(const re in ee){const he=L.getTotalLength(re,H),le=ee[re].type;let ue=X[re];if(!ue||ue.array.length<he){const _e=M.attributes[re];ue=new p.TlE(new le(he),_e.itemSize,_e.normalized),R.setAttribute(re,ue),k=!0}let ge=0;for(let _e=0;_e<H;_e++){const{array:Ee,type:Ye,length:We}=L.groupAttributes[_e][re],Et=new Ye(Ee.buffer,0,We);ue.array.set(Et,ge),ge+=Et.length}ue.needsUpdate=!0,j=he/ue.itemSize}R.setDrawRange(0,j),R.clearGroups();let oe=0;for(let re=0;re<H;re++){const he=L.getGroupArray("position",re).length/3;if(he!==0){const le=C[re];R.addGroup(oe,he,le.materialIndex),oe+=he}}if(R.index){const re=R.index.array;if(re.length<j)R.index=null,k=!0;else for(let he=0,le=re.length;he<le;he++)re[he]=he}R.boundsTree=null,k&&R.dispose()}(m,e.geometry,[..._,...w],a);const I=m.groups;if(u){const R=new Map,M=[...x,...T];let C=0;for(let L=0,k=M.length;L<k;L++)I.find(j=>j.materialIndex===L)?(R.set(L,C),C++):M[L]=null;for(let L=0,k=I.length;L<k;L++){const j=I[L];j.materialIndex=R.get(j.materialIndex)}i.material=M.filter(L=>L)}return i}evaluateHierarchy(e,t=new r1){e.updateMatrixWorld(!0);const n=(o,a)=>{const c=o.children;for(let u=0,d=c.length;u<d;u++){const m=c[u];m.isOperationGroup?n(m,a):a(m)}},i=o=>{const a=o.children;let c=!1;for(let d=0,m=a.length;d<m;d++){const g=a[d];c=i(g)||c}const u=o.isDirty();if(u&&o.markUpdated(),c&&!o.isOperationGroup){let d;return n(o,m=>{d=d?this.evaluate(d,m,m.operation):this.evaluate(o,m,m.operation)}),o._cachedGeometry=d.geometry,o._cachedMaterials=d.material,!0}return c||u};return i(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const oI={union:CT,subtract:MT,intersect:IT,difference:TT};function aI(s,e){const t=new tD;t.useGroups=!0,t.attributes=["position","normal","uv"],s.forEach(o=>{for(const a of[...t.attributes])o[0].geometry.getAttribute(a)||t.attributes.splice(t.attributes.indexOf(a),1)});let n=new r1(new p._12(.01,.01,2,2));s.forEach(([o,a])=>{if(!Object.keys(oI).includes(a))return void console.error(`Unknown operation ${a}`);o.updateMatrix(),o.updateMatrixWorld();const c=new r1;c.geometry=o.geometry,c.material=o.material,o.matrixWorld.decompose(c.position,c.quaternion,c.scale),c.updateMatrix(),c.updateMatrixWorld(),n=t.evaluate(n,c,oI[a])});const i=n;return i.userData._isCSGMesh=!0,i}let WA=class extends Cp{_buildCSGMesh(s){return aI(s)}};WA.PluginType="CSGPluginBVH",WA=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Hn("CSG Plugin (BVH)")],WA);class s1 extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,n,i,o;(n=(t=e.lastCamera)==null?void 0:t.removeControlsCtor)==null||n.call(t,this.controlsKey),(o=(i=e.camera)==null?void 0:i.setControlsCtor)==null||o.call(i,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var lI=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const nD=new p.Pa4(0,0,1),cI=new p.USm,iD=new p._fP,rD=new p._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),c0=new p._fP,sD={type:"change"};let qA=class extends V.SimpleEventDispatcher{constructor(s){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new p._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new p._fP,this._initQuaternionInvert=new p._fP,this._initQuaternionDest=new p._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=s,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(s=>{s=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(s=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",s)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new p._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const s=this.deviceOrientation;if(s){const e=s.alpha!==null?p.M8C.degToRad(s.alpha):0,t=s.beta!==null?p.M8C.degToRad(s.beta):0,n=s.gamma!==null?p.M8C.degToRad(s.gamma):0,i=this.screenOrientation?p.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,n,i),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(sD))}}dispose(){this.disconnect()}setObjectQuaternion(s,e,t,n){const i=(0,V.now)()/1e3;cI.set(e,s,-t,"YXZ"),c0.setFromEuler(cI),c0.multiply(rD),c0.multiply(iD.setFromAxisAngle(nD,-n)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(c0).invert(),this._initQuaternionDest.__init=!0),c0.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(c0,this.dampingFactor/(Math.min(1,i-this._lastTime)/(1/60))),this._lastTime=i}};lI([Ae(),cn("Damping",[0,1],.01)],qA.prototype,"dampingFactor",void 0),qA=lI([su("Device Orientation Controls")],qA);class US extends s1{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new qA(e)}}US.PluginType="DeviceOrientationControlsPlugin";var Ja=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const uI=new p.Pa4,NS=new p.$V,FS=new p.Pa4,oD={type:"change"};let Bo=class extends V.SimpleEventDispatcher{constructor(s,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new p.Pa4,this._lastTime=-1,this.object=s,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const s=this.object.quaternion;uI.set(0,0,-1).applyQuaternion(s),NS.setFromVector3(uI),this.lat=90-p.M8C.radToDeg(NS.phi),this.lon=p.M8C.radToDeg(NS.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(s){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(s.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(s){if(this.activeLook)switch(s.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(s){this.domElement===document?(this.pointerX=s.pageX-this.viewHalfX,this.pointerY=s.pageY-this.viewHalfY):(this.pointerX=s.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=s.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(s){if(this.enableKeys)switch(s.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(s){if(this.enableKeys)switch(s.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(s,e,t){return s.isVector3?FS.copy(s):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):FS.set(s,e,t),this.object.lookAt(FS),this.setOrientation(),this}update(){const s=(0,V.now)(),e=(this._lastTime<0?16:Math.min(s-this._lastTime,1e3))/1e3;if(this._lastTime=s,!this.enabled)return;if(this.heightSpeed){const u=p.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(u*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*n,this.lookVertical&&(this.lat-=this.pointerY*n*i),this.lat=Math.max(-85,Math.min(85,this.lat));let o=p.M8C.degToRad(90-this.lat);const a=p.M8C.degToRad(this.lon);this.constrainVertical&&(o=p.M8C.mapLinear(o,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;this.targetPosition.setFromSphericalCoords(1,o,a).add(c),this.object.lookAt(this.targetPosition),this.dispatchEvent(oD)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(s){this.enableKeys&&s.preventDefault()}};Ja([Ae(),Gt()],Bo.prototype,"enabled",void 0),Ja([Ae(),Gt()],Bo.prototype,"enableKeys",void 0),Ja([Ae(),jn()],Bo.prototype,"movementSpeed",void 0),Ja([Ae(),jn()],Bo.prototype,"lookSpeed",void 0),Ja([Ae(),Gt()],Bo.prototype,"lookVertical",void 0),Ja([Ae(),Gt()],Bo.prototype,"autoForward",void 0),Ja([Ae(),Gt()],Bo.prototype,"activeLook",void 0),Ja([Ae(),Gt()],Bo.prototype,"heightSpeed",void 0),Ja([Ae(),jn()],Bo.prototype,"heightCoef",void 0),Ja([Ae(),jn()],Bo.prototype,"heightMin",void 0),Ja([Ae(),jn()],Bo.prototype,"heightMax",void 0),Ja([Ae(),Gt()],Bo.prototype,"constrainVertical",void 0),Ja([Ae(),jn()],Bo.prototype,"verticalMin",void 0),Ja([Ae(),jn()],Bo.prototype,"verticalMax",void 0),Ja([Ae(),Gt()],Bo.prototype,"mouseDragOn",void 0),Bo=Ja([Hn("First Person Controls")],Bo);class jS extends s1{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new Bo(e,t)}}jS.PluginType="FirstPersonControlsPlugin";var u0=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const h0=new p.USm(0,0,0,"YXZ"),d0=new p.Pa4,aD={type:"change"},lD={type:"lock"},cD={type:"unlock"},hI=Math.PI/2;let Dp=class extends V.SimpleEventDispatcher{constructor(s,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new p.Pa4(0,0,-1),this.domElement=e,this.object=s,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(s){this.isLocked||this.autoLockOnClick&&(s.preventDefault(),this.lock())}onMouseMove(s){this.isLocked&&(this._movementX+=s.movementX||s.mozMovementX||s.webkitMovementX||0,this._movementY+=s.movementY||s.mozMovementY||s.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(lD),this.isLocked=!0):(this.dispatchEvent(cD),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(s){return s.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(s){d0.setFromMatrixColumn(this.object.matrix,0),d0.crossVectors(this.object.up,d0),this.object.position.addScaledVector(d0,s)}moveRight(s){d0.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(d0,s)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(h0.setFromQuaternion(this.object.quaternion),h0.y-=.002*this._movementX*this.pointerSpeed,h0.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,h0.x=Math.max(hI-this.maxPolarAngle,Math.min(hI-this.minPolarAngle,h0.x)),this.object.quaternion.setFromEuler(h0),this.dispatchEvent(aD))}};u0([Gt(),Ae()],Dp.prototype,"enabled",void 0),u0([jn(),Ae()],Dp.prototype,"minPolarAngle",void 0),u0([jn(),Ae()],Dp.prototype,"maxPolarAngle",void 0),u0([jn(),Ae()],Dp.prototype,"pointerSpeed",void 0),u0([Gt(),Ae()],Dp.prototype,"autoLockOnClick",void 0),Dp=u0([su("Pointer Lock Controls")],Dp);class zS extends s1{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new Dp(e,t.ownerDocument?t:t.documentElement)}}zS.PluginType="PointerLockControlsPlugin";class dI{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new p.SUY}loadModel(e){this._model=e,this.mixer=new p.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var n;const t=[];(n=this._animations)==null||n.forEach(i=>{t.push(this.playClip(i,e))}),await Promise.all(t)}async reverseAllAnimation(e){var n;const t=[];(n=this._animations)==null||n.forEach(i=>{t.push(this.playClip(i,e,1,!0))}),await Promise.all(t)}async playClip(e,t,n=1,i=!1,o=!1){if(!this.mixer)return;const a=this.mixer.clipAction(e);return this._playingAnimations.has(a)&&this.mixer.dispatchEvent({type:"canceled",action:a}),o&&(this.mixer.setTime(0),this.mixer.stopAllAction()),i?(a.paused=!1,a.timeScale=-n):(a.reset(),a.timeScale=n),a.loop=t?p.YKA:p.jAl,a.clampWhenFinished=!0,new Promise(c=>{const u=async d=>{d.action===a&&(this.mixer.removeEventListener("finished",u),this.mixer.removeEventListener("canceled",u),this._playingAnimations.delete(a),c())};this.mixer.addEventListener("finished",u),this.mixer.addEventListener("canceled",u),this._playingAnimations.add(a),a.play()})}playClipByName(e,t,n=1,i=!1){let o;this._animations.forEach(a=>{a.name===e&&(o=a)}),o&&this.playClip(o,t,n,i)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class pI extends En{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var t;await super.onAdded(e),(t=this._viewer)==null||t.addEventListener("postFrame",()=>{this.helperIdentities.forEach(n=>{var i;n.update()&&((i=this._viewer)==null||i.setDirty())})})}createHelper(e,t){var n;if(this.helperIdentities.has(e))(n=this._viewer)==null||n.console.warn("Helper with this id already exists");else{const i=new dI;i.loadModel(t),this.helperIdentities.set(e,i)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,t,n,i=1,o=!1,a=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClip(t,n,i,o,a)}async playAllAnimations(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playAllAnimations(t)}async playAllAnimationsInReverse(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).reverseAllAnimation(t)}async playAnimationByName(e,t,n,i=1,o=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClipByName(t,n,i,o)}}pI.PluginType="AnimationHelperPlugin";class XA extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,t,n)=>{(0,V.downloadBlob)(e,t)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,({state:n,progress:i})=>{this.dispatchEvent({type:"transferFile",path:t,state:n??"exporting",progress:i})}),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}XA.PluginType="FileTransferPlugin";var p0=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class fd extends En{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:p.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[lr],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=t=>{this._preFrame(t)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,t;return((t=(e=this._viewer)==null?void 0:e.getPlugin(lr))==null?void 0:t.camViews)??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var d;if(!this.enabled)return;const t=this._cameraViews;if(t.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=p.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=p.M8C.clamp(this._oldState,0,t.length-1.001);const n=Math.floor(this._oldState),i=this._overrideStartView||t[n],o=this._overrideEndView||t[n+1];let a,c=this._overrideStartView?this._overrideTime:this._oldState-n;c=yc[this.animEase](c),a=this.interpolateMode==="spherical"?this._lerpViewsSpherical(i,o,c):this._lerpViewsLinear(i,o,c);const u=(d=this._viewer)==null?void 0:d.scene.activeCamera;u&&(u.position.copy(a[0]),u.target.copy(a[1]),u.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,n){const i=new p.Pa4,o=new p.Pa4;return o.lerpVectors(e.position,t.position,n),i.lerpVectors(e.target,t.target,n),[o,i]}_lerpViewsSpherical(e,t,n){const i=e.target.clone(),o=new p.Pa4,a=new p.Pa4,c=Ru(e,e.target),u=Ru(t,t.target),d=new p.$V;return d.phi=Xc(c.phi,u.phi,n),d.theta=Xc(c.theta,u.theta,n),d.radius=p.M8C.lerp(c.radius,u.radius,n),o.copy(i).lerp(t.target,n),a.setFromSpherical(d),a.add(o),[a,o]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new Ns(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),n=this._oldState-t;let i;i=this.interpolateMode==="spherical"?this._lerpViewsSpherical(e[t],e[t+1],n):this._lerpViewsLinear(e[t],e[t+1],n),this._overrideEndView=new Ns(i[0],i[1]),this._overrideTime=0}}fd.PluginType="CameraViewControlPlugin",p0([Gt("Enabled"),(0,V.onChange)(fd.prototype._onEnabledChanged1),Ae()],fd.prototype,"enabled",void 0),p0([Ae(),Uo("Ease",Object.keys(yc).map(s=>({label:s})))],fd.prototype,"animEase",void 0),p0([Ae(),Uo("Interpolation",["spherical","linear"].map(s=>({label:s})))],fd.prototype,"interpolateMode",void 0),p0([Gt("Enable Damping"),Ae()],fd.prototype,"enableDamping",void 0),p0([cn("Damping",[.01,1],.001),Ae()],fd.prototype,"damping",void 0),p0([cn("Init Anim Time",[.01,5],.001),Ae()],fd.prototype,"initAnimationTime",void 0);class VS extends fd{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...Da(this)]},typeof e=="string"?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){var t;if(this.enabled&&!(this._cameraViews.length<=1))try{const n=this._findActiveView(),i=this._getScroll(n);this.setState(i+n),super._preFrame(e)}catch(n){return void(((t=this._viewer)==null?void 0:t.getPluginByType("Debug"))&&console.error(n))}}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],n=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],i=this.parent.getBoundingClientRect();if(!t||!n)return 0;const o=t.getBoundingClientRect(),a=n.getBoundingClientRect(),c=this.parent===document.body?0:i.top;return p.M8C.clamp((c-o.top)/Math.max(a.top-o.top,1e-4),0,1)}_findActiveView(){var e;for(let t=this._cameraViews.length-1;t>=0;t--){const n=this.parent.querySelector(this._cameraViews[t].name)??this.parent.getElementsByTagName("section")[t],i=this.parent.getBoundingClientRect();if(n){if(n.getBoundingClientRect().top<(this.parent===document.body?0:i.top))return t}else(e=this._cameraViews[t].name)!=null&&e.startsWith("#")&&console.error("section with id "+this._cameraViews[t].name+" doesn't exist!")}return 0}}VS.PluginType="ScrollableCameraViewPlugin";var GS,HS=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let fm=GS=class extends VS{generateCode(){var i;const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.width="100%",s.style.height="100%",s.style.display="flex",s.style.flexDirection="column",s.style.justifyContent="center",s.style.alignItems="center",s.style.zIndex="200";const e=document.createElement("textarea");e.rows=20,e.style.border="3px solid #27223a",e.style.borderRadius="5px",e.style.width="30%",e.style.padding="5px",e.style.zIndex="1000";const t=document.createElement("div");t.textContent="X",t.style.color="red",t.style.width="20px",t.style.height="20px",t.style.padding="2",t.style.textAlign="center",t.style.backgroundColor="white",t.style.borderRadius="100%",t.style.border="2px solid #27223a",t.style.cursor="pointer",t.addEventListener("click",()=>{var o;(o=this._viewer)==null||o.container.removeChild(s)});const n=document.createElement("div");n.textContent="Update",n.style.marginTop="10px",n.style.color="white",n.style.padding="4px 10px 4px 10px",n.style.justifyContent="center",n.style.alignItems="center",n.style.backgroundColor="green",n.style.borderRadius="10px",n.style.border="2px solid #fff",n.style.cursor="pointer",n.addEventListener("click",()=>{var c;const o=this.parent.innerHTML;this.parent.innerHTML=e.value;let a=0;for(;a<this._cameraViews.length;a++){let u;try{u=this.parent.querySelector(this._cameraViews[a].name)??this.parent.getElementsByTagName("section")[a]}catch{u=null}if(!u&&a<2){alert("you need to add 2 sections at least");break}if(!u){const d=((c=this._cameraViews[a].name)==null||c.startsWith("#"),this._cameraViews[a].name.replace(/^#/,""));e.value+=d,e.value=this._format(e.value)}}a<2?this.parent.innerHTML=o:async function(u,d){var g;u.innerHTML=d;const m=u.getElementsByTagName("script");for(let _=0;_<m.length;_++){const w=m[_],x=rR(w);let T=!1;await new Promise(I=>{x.onload=I,x.onerror=()=>{T=!0,I(void 0)}}),T||((g=w.parentNode)==null||g.replaceChild(x,w))}}(this.parent,e.value)}),s.appendChild(t),s.appendChild(e),s.appendChild(n),e.value=this._format(this.parent.innerHTML),(i=this._viewer)==null||i.container.appendChild(s)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(s=document.body,e=!1){super(s,e),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(s){var e,t,n,i,o,a;this.parent=this.wrapper,await super.onAdded(s),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(t=(e=this._viewer)==null?void 0:e.getPlugin(lr))==null||t.addEventListener("viewDelete",this.deleteView),(i=(n=this._viewer)==null?void 0:n.getPlugin(lr))==null||i.addEventListener("deserialize",this.deserialize),(a=(o=this._viewer)==null?void 0:o.getPlugin(lr))==null||a.addEventListener("viewAdd",this.addView)}deserialize(s){this._cameraViews.forEach(e=>{this._createSection(e.name)})}_addWrapper(){var s;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(s=this._viewer)==null||s.container.appendChild(this.wrapper)}_createSection(s){const e=document.createElement("section");e.style.width="100%",e.style.height="100%",e.style.opacity="50%",e.style.backgroundColor="black",e.style.zIndex="100",e.style.top="0",e.textContent=s,e.style.color="white",e.style.fontSize="100px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.id=s,this.parent.appendChild(e)}addView(s){this._cameraViews.forEach((e,t)=>{var i;let n;try{n=this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[t]}catch{n=null}if(!n){const o=`<section id="${(i=e.name)!=null&&i.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${e.name}
                    </section>`;this.parent.innerHTML+=o}})}deleteView(s){try{const e=this.parent.querySelector(s.view.name)??this.parent.getElementsByTagName("section").namedItem(s.view.name);e==null||e.remove()}catch{return}}_format(s){let e="",t="";return s.split(/>\s*</).forEach(function(n){n.match(/^\/\w/)&&(t=t.substring(1)),e+=t+"<"+n+`>\r
`,n.match(/^<?\w[^>]*[^/]$/)&&!n.startsWith("input")&&(t+="	")}),e.substring(1,e.length-3)}};HS([Ai("Show/Edit Code")],fm.prototype,"generateCode",null),HS([Gt("Canvas on top"),(0,V.onChange)(GS.prototype._togglePreview)],fm.prototype,"canvasUp",void 0),fm=GS=HS([Hn("Scrollable Camera View Preview (Dev)")],fm);var QS={d:(s,e)=>{for(var t in e)QS.o(e,t)&&!QS.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e)},fI={};QS.d(fI,{Q:()=>pD});var WS=function(s,e,t,n){return new(t||(t=Promise))(function(i,o){function a(d){try{u(n.next(d))}catch(m){o(m)}}function c(d){try{u(n.throw(d))}catch(m){o(m)}}function u(d){var m;d.done?i(d.value):(m=d.value,m instanceof t?m:new t(function(g){g(m)})).then(a,c)}u((n=n.apply(s,e||[])).next())})};const mI=Symbol("Comlink.proxy"),uD=Symbol("Comlink.endpoint"),hD=Symbol("Comlink.releaseProxy"),qS=Symbol("Comlink.thrown"),gI=s=>typeof s=="object"&&s!==null||typeof s=="function",vI=new Map([["proxy",{canHandle:s=>gI(s)&&s[mI],serialize(s){const{port1:e,port2:t}=new MessageChannel;return _I(s,e),[t,[t]]},deserialize:s=>(s.start(),AI(s))}],["throw",{canHandle:s=>gI(s)&&qS in s,serialize({value:s}){let e;return e=s instanceof Error?{isError:!0,value:{message:s.message,name:s.name,stack:s.stack}}:{isError:!1,value:s},[e,[]]},deserialize(s){throw s.isError?Object.assign(new Error(s.value.message),s.value):s.value}}]]);function _I(s,e=self){e.addEventListener("message",function t(n){if(!n||!n.data)return;const{id:i,type:o,path:a}=Object.assign({path:[]},n.data),c=(n.data.argumentList||[]).map(vv);let u;try{const d=a.slice(0,-1).reduce((g,_)=>g[_],s),m=a.reduce((g,_)=>g[_],s);switch(o){case"GET":u=m;break;case"SET":d[a.slice(-1)[0]]=vv(n.data.value),u=!0;break;case"APPLY":u=m.apply(d,c);break;case"CONSTRUCT":u=a1(new m(...c));break;case"ENDPOINT":{const{port1:g,port2:_}=new MessageChannel;_I(s,_),u=function(w,x){return wI.set(w,x),w}(g,[g])}break;case"RELEASE":u=void 0;break;default:return}}catch(d){u={value:d,[qS]:0}}Promise.resolve(u).catch(d=>({value:d,[qS]:0})).then(d=>{const[m,g]=YS(d);e.postMessage(Object.assign(Object.assign({},m),{id:i}),g),o==="RELEASE"&&(e.removeEventListener("message",t),yI(e))})}),e.start&&e.start()}function yI(s){(function(e){return e.constructor.name==="MessagePort"})(s)&&s.close()}function AI(s,e){return XS(s,[],e)}function o1(s){if(s)throw new Error("Proxy has been released and is not useable")}function XS(s,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,a){if(o1(n),a===hD)return()=>f0(s,{type:"RELEASE",path:e.map(c=>c.toString())}).then(()=>{yI(s),n=!0});if(a==="then"){if(e.length===0)return{then:()=>i};const c=f0(s,{type:"GET",path:e.map(u=>u.toString())}).then(vv);return c.then.bind(c)}return XS(s,[...e,a])},set(o,a,c){o1(n);const[u,d]=YS(c);return f0(s,{type:"SET",path:[...e,a].map(m=>m.toString()),value:u},d).then(vv)},apply(o,a,c){o1(n);const u=e[e.length-1];if(u===uD)return f0(s,{type:"ENDPOINT"}).then(vv);if(u==="bind")return XS(s,e.slice(0,-1));const[d,m]=bI(c);return f0(s,{type:"APPLY",path:e.map(g=>g.toString()),argumentList:d},m).then(vv)},construct(o,a){o1(n);const[c,u]=bI(a);return f0(s,{type:"CONSTRUCT",path:e.map(d=>d.toString()),argumentList:c},u).then(vv)}});return i}function bI(s){const e=s.map(YS);return[e.map(n=>n[0]),(t=e.map(n=>n[1]),Array.prototype.concat.apply([],t))];var t}const wI=new WeakMap;function a1(s){return Object.assign(s,{[mI]:!0})}function YS(s){for(const[e,t]of vI)if(t.canHandle(s)){const[n,i]=t.serialize(s);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:s},wI.get(s)||[]]}function vv(s){switch(s.type){case"HANDLER":return vI.get(s.name).deserialize(s.value);case"RAW":return s.value}}function f0(s,e,t){return new Promise(n=>{const i=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");s.addEventListener("message",function o(a){a.data&&a.data.id&&a.data.id===i&&(s.removeEventListener("message",o),n(a.data))}),s.start&&s.start(),s.postMessage(Object.assign({id:i},e),t)})}class dD extends class{}{init(e,t,n,i){if(!this.api){if(!i)throw new Error("workerFilePath is required");(()=>{var o,a,c;o=this,c=function*(){const u=yield fetch(i).then(g=>g.blob()),d=URL.createObjectURL(u),m=new Worker(d,{type:"module"});this.api=yield new(AI(m))(a1(()=>{e(),URL.revokeObjectURL(d)}),a1((g,_)=>g==="xatlas_web.wasm"?n:g+_),a1(t))},new((a=void 0)||(a=Promise))(function(u,d){function m(w){try{_(c.next(w))}catch(x){d(x)}}function g(w){try{_(c.throw(w))}catch(x){d(x)}}function _(w){var x;w.done?u(w.value):(x=w.value,x instanceof a?x:new a(function(T){T(x)})).then(m,g)}_((c=c.apply(o,[])).next())})})()}}}class pD extends class{constructor(e,t={resolution:2048},n={},i=!1,o=!1,a=!1){this.THREE=e,this.packOptions=t,this.chartOptions=n,this.useNormals=i,this.timeUnwrap=o,this.logProgress=a,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,t,n){return WS(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((i,o)=>{try{this.xAtlas.init(()=>{i()},e,t,n)}catch(a){o(a)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(i=>setTimeout(i,100));this._libraryLoaded=!0}})}packAtlas(e,t="uv2",n="uv"){return WS(this,void 0,void 0,function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const i=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(d=>setTimeout(d,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let o=[],a="";for(let d of e){let{uuid:m,index:g,attributes:_}=d;const w=d.userData.worldScale||1;o.push(m),g&&_.position&&_.position.itemSize===3?(a="Mesh"+o.length+" added to atlas: "+m,this.timeUnwrap&&console.time(a),yield this.xAtlas.api.addMesh(g.array,_.position.array,_.normal?_.normal.array:void 0,_.uv?_.uv.array:void 0,m,this.useNormals,i,w),this.timeUnwrap&&console.timeEnd(a)):console.warn("xatlas-three: Geometry not supported: ",d)}a="Generated atlas with "+o.length+" meshes",this.timeUnwrap&&console.time(a);let c=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(a);let u=[];for(let d of c){let m=e.find(g=>g.uuid===d.mesh);m?(d.vertex.vertices&&m.setAttribute("position",new this.THREE.BufferAttribute(d.vertex.vertices,3,!1)),d.vertex.normals&&m.setAttribute("normal",new this.THREE.BufferAttribute(d.vertex.normals,3,!0)),d.vertex.coords1&&m.setAttribute(t,new this.THREE.BufferAttribute(d.vertex.coords1,2,!1)),d.vertex.coords&&t!==n&&m.setAttribute(n,new this.THREE.BufferAttribute(d.vertex.coords,2,!1)),d.index&&m.setIndex(new this.THREE.BufferAttribute(d.index,1,!1)),u.push(m)):console.error("xatlas-three: Mesh not found: ",d.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,u})}unwrapGeometry(e,t="uv",n="uv2"){return WS(this,void 0,void 0,function*(){return this.packAtlas([e],t,n)})}}{_createXAtlas(){return new dD}}var YA,fD=fI.Q,Rr=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let gl=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};Rr([Ae()],gl.prototype,"fixWinding",void 0),Rr([Ae()],gl.prototype,"maxBoundaryLength",void 0),Rr([Ae()],gl.prototype,"maxChartArea",void 0),Rr([Ae()],gl.prototype,"maxCost",void 0),Rr([Ae()],gl.prototype,"maxIterations",void 0),Rr([Ae()],gl.prototype,"normalDeviationWeight",void 0),Rr([Ae()],gl.prototype,"normalSeamWeight",void 0),Rr([Ae()],gl.prototype,"roundnessWeight",void 0),Rr([Ae()],gl.prototype,"straightnessWeight",void 0),Rr([Ae()],gl.prototype,"textureSeamWeight",void 0),Rr([Ae()],gl.prototype,"useInputMeshUvs",void 0),gl=Rr([Hn("Chart Options"),_s("UChartOptions")],gl);let Jl=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};Rr([Ae()],Jl.prototype,"bilinear",void 0),Rr([Ae()],Jl.prototype,"blockAlign",void 0),Rr([Ae()],Jl.prototype,"bruteForce",void 0),Rr([Ae()],Jl.prototype,"createImage",void 0),Rr([Ae()],Jl.prototype,"maxChartSize",void 0),Rr([Ae()],Jl.prototype,"padding",void 0),Rr([Ae()],Jl.prototype,"resolution",void 0),Rr([Ae()],Jl.prototype,"rotateCharts",void 0),Rr([Ae()],Jl.prototype,"rotateChartsToAxis",void 0),Rr([Ae()],Jl.prototype,"texelsPerUnit",void 0),Jl=Rr([Hn("Pack Options"),_s("UPackOptions")],Jl);let iu=YA=class extends En{constructor(s=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new gl,this.packOptions=new Jl,this._loaded=!1,this._unwrapProgress=(e,t)=>{console.log("Unwrapping",e,t)},this.unwrapSelected=async()=>{var t,n,i,o,a;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Ti))==null?void 0:n.getSelectedObject();if(e)if(e.geometry){if(e.geometry.attributes.uv&&!await((i=this._viewer)==null?void 0:i.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(e.geometry)}else(o=this._viewer)==null||o.alert("Unwrap: Selected object has no geometry");else(a=this._viewer)==null||a.alert("Unwrap: No object selected")},s&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,V.timeout)(100);else this._unwrapper=new fD({BufferAttribute:p.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,YA.LIBRARY_PATH+"xatlas.wasm",YA.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(s,e="uv",t="uv"){var n;await this.loadLibrary(),await((n=this._unwrapper)==null?void 0:n.unwrapGeometry(s,e,t))}async packAtlas(s,e=!0,t="uv2",n="uv"){var o;await this.loadLibrary(),Array.isArray(s)||(s=[s]);const i=[];e?s.forEach(a=>a.traverse(c=>{c.geometry&&i.push(c.geometry)})):s.forEach(a=>{a.geometry&&i.push(a.geometry)}),await((o=this._unwrapper)==null?void 0:o.packAtlas(i,t,n))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};iu.PluginType="XAtlasPlugin",iu.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",Rr([(0,V.onChange)(YA.prototype._useNormalsChanged),Ae()],iu.prototype,"useNormals",void 0),Rr([Ae()],iu.prototype,"chartOptions",void 0),Rr([Ae()],iu.prototype,"packOptions",void 0),Rr([Ai("Unwrap Selected Geometry")],iu.prototype,"unwrapSelected",void 0),iu=YA=Rr([Hn("UV Unwrapping (xAtlas)")],iu);class KA extends En{constructor(){super(...arguments),this.dependencies=[Qt],this.enabled=!0,this.serializeWithViewer=!1,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,t)=>{let n=e.icon;return(n&&/^(\w+)\(([^)]*)\)/.exec(n)||/^#([A-Fa-f\d]+)$/.exec(n))&&(n=(0,V.makeColorSvg)(n)),n&&n.startsWith("http")&&n.startsWith("data:")||(n=this.utils.pathToIcon(this.baseUrl+t+"/"+e.prefix+(n||""))),n},getItemIcon:(e,t,n)=>{const i=e.iconFiles[t];if(i)return URL.createObjectURL(i);let o=e.icons[t];return(o&&/^(\w+)\(([^)]*)\)/.exec(o)||/^#([A-Fa-f\d]+)$/.exec(o))&&(o=(0,V.makeColorSvg)(o)),o||(o=this.utils.pathToIcon(e.items[t])),!o||o.startsWith("http")||o.startsWith("data:")||(o=this.baseUrl+n+"/"+e.prefix+o),o},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,n)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${n}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,n,i=!1){var g,_;if(!this._viewer)return;const o=this._getVariationId(e);typeof t=="number"&&(t=e.items[t]);const a=e.items.indexOf(t);if(a===-1)return void this._viewer.console.warn(`Item ${t} not found`);const c=e.itemFiles[a],u=e.selected;if(!i&&u===a)return;e.selected=a;const d=this._viewer.getManager(),m=this.utils.getItemPath(e,a,n);if(n==="objects"){let w=this._viewer.scene.findObjectsByName(o).map(M=>M.modelObject);w.length===0&&(w=[(await this._viewer.createObject3D()).modelObject],w[0].name=o),this._viewer.renderEnabled=!1;for(const M of w)[...M.children].forEach(C=>C.dispose&&this.autoDispose?C.dispose():C.removeFromParent());const x=await this._loadObject(m,c);if(!x.length)return void(m.endsWith("json")||this._viewer.console.warn(`Object ${m} not found`));let T=!1;for(const M of w){[...M.children].forEach(C=>C.dispose&&this.autoDispose?C.dispose():C.removeFromParent());for(const C of x)T?M.add(C.modelObject.clone()):M.add(C.modelObject);T=!0}const I=[],R=this.variations.materials.filter(M=>M&&typeof M.selected=="number");for(const M of R)I.push(this.applyVariation(M,M.selected,"materials",!0));await Promise.all(I),this._viewer.renderEnabled=!0}if(n==="materials"){const w=await this._loadMaterial(m,c);if(!w)return void this._viewer.console.warn(`Material ${m} not found`);w.userData.__isVariation=!0;const x=this._viewer.scene.findObjectsByName(o),T=I=>{var R,M,C;I.material&&(Array.isArray(I.material)?I.material.length!==0&&((R=e.data)==null?void 0:R.matType)!==I.material[0].typeSlug:((M=e.data)==null?void 0:M.matType)!==I.material.typeSlug)||((C=I==null?void 0:I.setMaterial)==null||C.call(I,w))};for(const I of x)(g=e.data)!=null&&g.traverse?I.traverse(T):T(I);(_=d.materials)==null||_.applyMaterial(w,o)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const n=this._getVariationId(t),i=this._viewer.scene.findObjectsByName(n);for(const o of i)[...o.children].forEach(a=>(a.dispose??a.removeFromParent)())}}async _loadMaterial(e,t){var n,i,o;return(o=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.importer)==null?void 0:o.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){var n,i,o;return(o=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.importer)==null?void 0:o.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){typeof e=="string"&&(e=JSON.parse(e)),e.baseUrl!==void 0&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t=typeof e.folder=="object"?e.folder:typeof e.folder=="string"?Ws(xe(e.folder)):Ws(e.folder));for(const n of this._ty)if(e[n])for(const i of e[n]){const o={items:i.items,prefix:i.prefix,name:i.name,title:i.title||"",icon:i.icon||"",icons:i.icons??i.items.map(()=>""),titles:i.titles??i.items.map(()=>""),itemFiles:[],iconFiles:[],data:{...i.data}};if(t)for(let a=0;a<i.items.length;a++){const c=i.items[a],u=t[n+"/"+i.prefix+c];o.itemFiles[a]=u?new File([u],c):void 0;const d=i.icons[a];if(!d)continue;const m=t[n+"/"+i.prefix+d];o.iconFiles[a]=m?new File([m],d):void 0}this.variations[n].push(o)}}async importPath(e){var t,n;if(e.endsWith(".json")){const i=await((n=(t=this._viewer)==null?void 0:t.getManager().importer)==null?void 0:n.importSinglePath(e,{processImported:!1})),o=e.split("?")[0];return this.baseUrl||(this.baseUrl=o.substring(0,o.lastIndexOf("/")+1)),this.importConfig(i)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var t;return((t=this.variations.materials.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getObjects(e){var t;return((t=this.variations.objects.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getMaterialVariations(){return this.variations.materials.map(e=>this.utils.getName(e))}getObjectVariations(){return this.variations.objects.map(e=>this.utils.getName(e))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var i;let e={objects:{},materials:{}};const t={objects:[],materials:[],type:KA.PluginType};this.baseUrl&&(t.baseUrl=this.baseUrl);let n=!1;for(const o of this._ty)for(const a of this.variations[o]){const c={...a};c.data={...c.data},delete c.itemFiles,delete c.iconFiles,t[o].push(c);const u=a.prefix.replace(/^\//,""),d=u.trimEnd().endsWith("/")?"":u.split("/").pop()||"",m=u.replace(d,"").trimEnd().replace(/\/$/,""),g={};let _=!1;for(let T=0;T<a.items.length;T++){const I=a.items[T],R=a.itemFiles[T],M=a.iconFiles[T],C=a.icons[T];R?(g[d+I]=new Uint8Array(await R.arrayBuffer()),M&&!C&&((i=this._viewer)==null||i.console.error("Icon file without icon name")),M&&C&&(g[d+C]=new Uint8Array(await M.arrayBuffer())),_=!0):M&&alert("Icon file without model/material file not supported")}if(!_)continue;n=!0;const w=m.split("/");let x=e[o];for(const T of w){x[T]||(x[T]={});const I=x[T];if(typeof I!="object")throw new Error("Invalid prefix: "+a.prefix);x=I}Object.assign(x,g)}return n||(e=void 0),{folder:e,config:t}}}KA.PluginType="VariationConfiguratorPlugin";class m0 extends KA{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,Wa.RemoveAll(m0.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])Wa.Create(m0.PluginType,this.utils.getTitle(t),5,20,0,t.items.map((n,i)=>({id:n,image:this.utils.getItemIcon(t,i,e),onClick:async o=>this.applyVariation(t,o,e,!1),tooltip:this.utils.getItemTitle(t,i)})),(n,i)=>zu(n,{placement:"bottom",content:i.tooltip}));return Wa.RebuildUi(this._viewer.container),!0}}m0.PluginType="VariationConfiguratorPlugin";class JA extends m0{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map(t=>({type:"folder",expanded:this._uiExpandedState[t.name],onExpand:()=>this._uiExpandedState[t.name]=!0,onCollapse:()=>this._uiExpandedState[t.name]=!1,label:()=>this.utils.getName(t),children:[{type:"input",placeholder:()=>this.utils.getName(t),property:[t,"name"]},{type:"input",property:[t,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(t)),property:[t,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+t.prefix),property:[t,"icon"]},{type:"folder",label:"items",children:t.items.map((n,i)=>({type:"folder",label:()=>t.items[i],children:[{type:"input",label:"File/URL",isMonitor:!t.itemFiles[i],getValue:()=>t.items[i],setValue:o=>{t.items[i]=o}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(t.items[i]),getValue:()=>t.icons[i],setValue:o=>{t.icons[i]=o}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(t.items[i]),getValue:()=>t.titles[i],setValue:o=>{t.titles[i]=o}},{type:"button",label:"Apply",value:async()=>this.applyVariation(t,i,e)},t.itemFiles[i]?[{type:"button",label:"Remove",value:()=>{t.items.splice(i,1),t.itemFiles.splice(i,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const o=await(0,V.uploadFile)(!1,!1);o.length!==0&&(t.itemFiles[i]=o[0],t.items[i]=o[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const o=t.itemFiles[i];(0,V.downloadBlob)(o,o.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var i,o;const n=await(0,V.uploadFile)(!0,!1);if(n.length!==0){for(const a of n){if(!this._extForType[e].includes(a.name.split(".").pop()??"")){await((i=this._viewer)==null?void 0:i.alert(`Invalid file: ${a.name} is not a valid ${e} file`));continue}if(t.items.includes(a.name)){await((o=this._viewer)==null?void 0:o.alert(`Already exists: Item with name ${a.name} already exists`));continue}const c=t.items.push(a.name)-1;t.icons[c]="",t.titles[c]="",t.itemFiles[c]=a}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var o,a,c,u;const n=await((o=this._viewer)==null?void 0:o.prompt("URL: Enter the url of the object/material"));if(!n)return;if(!n.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((a=this._viewer)==null?void 0:a.alert(`Invalid url: ${n} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(n.split(".").pop()??""))return void await((c=this._viewer)==null?void 0:c.alert(`Invalid url: ${n} should be of a material ending with mat`));t.items.includes(n)&&await((u=this._viewer)==null?void 0:u.alert(`Already exists: Item with url ${n} already exists`)),t.items.push(n);const i=t.items.length-1;t.icons[i]="",t.titles[i]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(t),value:async()=>{var n;await((n=this._viewer)==null?void 0:n.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(t)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(t),1),this.refreshUi())}}]})),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var n;const t=await((n=this._viewer)==null?void 0:n.prompt("Name: Enter the name of the object/material"));t&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:t+"/",name:t,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var g,_,w;const t=await(0,V.uploadFile)(!1,!0);if(t.length===0)return;const n=[],i=[],o=[],a=[];for(const x of t){if(x.name.startsWith("."))continue;const T=x.name.split(".").pop()??"";T?this._extForType[e].includes(T)?(n.push(x.webkitRelativePath.replace(/^\//,"")),i.push(x)):this._extForType.images.includes(T)?(o.push(x.webkitRelativePath.replace(/^\//,"")),a.push(x)):await((g=this._viewer)==null?void 0:g.alert(`Invalid file: ${x.name} is not a valid ${e} file`)):await((_=this._viewer)==null?void 0:_.alert(`Invalid file: ${x.name} has no extension`))}const c=(0,V.longestCommonPrefix)(n),u=this.utils.getName({prefix:c});let d=await((w=this._viewer)==null?void 0:w.prompt("Name: Enter the name of the object/material",u,!0));if(d===null)return;d=d||u;const m=n.map(x=>{const T=x.replace(c,""),I=T.split(".").pop()??"",R=T.replace("."+I,"")+".",M=o.findIndex(C=>C.replace(c,"").startsWith(R));return M<0?["",void 0]:[o[M].replace(c,""),a[M]||void 0]});this.variations[e].push({items:n.map(x=>x.replace(c,"")),icons:m.map(x=>x[0]),iconFiles:m.map(x=>x[1]),titles:n.map(()=>""),itemFiles:i,prefix:c,name:d,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,t;try{const{folder:n,config:i}=await this._exportConfiguratorState(),o=JSON.stringify(i,null,4);if(n){n["config.json"]=xe(o);const a=await yh(n),c=new Blob([a],{type:"application/zip"});(0,V.downloadBlob)(c,"configurator.zip")}else{const a=new Blob([o],{type:"application/json"});(0,V.downloadBlob)(a,"config.json")}}catch(n){return(e=this._viewer)==null||e.console.error(n),void await((t=this._viewer)==null?void 0:t.alert("Error: "+((n==null?void 0:n.message)||n)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var n,i,o;const e=await(0,V.uploadFile)(!1,!1,"application/zip,application/json");if(e.length===0)return;const t=e[0];if(t.name.endsWith(".zip")){const a=Ws(new Uint8Array(await t.arrayBuffer()));if(!a["config.json"])return void await((n=this._viewer)==null?void 0:n.alert("Invalid zip: config.json not found"));const c=JSON.parse(dt(a["config.json"]));this.importConfig(c,a)}else{if(!t.name.endsWith(".json"))return void await((i=this._viewer)==null?void 0:i.alert("Invalid file: "+t.name));{const a=JSON.parse(await t.text());this.importConfig(a)}}await((o=this._viewer)==null?void 0:o.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var t,n;const e=await((t=this._viewer)==null?void 0:t.prompt("URL: Enter the url of the json file."));e&&(await this.importPath(e),await((n=this._viewer)==null?void 0:n.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,t;(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const n=await super._loadObject(e,t);for(const i of n)(i.modelObject||i).userData.excludeFromExport=!0;return n}}JA.PluginType="VariationConfiguratorPlugin";class Bp extends En{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=e=>{const t=e.object;t!=null&&t.traverse&&t.traverse(n=>{var o,a;n.userData[Bp.PluginType]===void 0&&(n.userData[Bp.PluginType]={transforms:[]});const i={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var c;this.addTransform(n),(c=i==null?void 0:i.uiRefresh)==null||c.call(i)}},()=>{var c;return(c=n.userData[Bp.PluginType])==null?void 0:c.transforms.map((u,d)=>({type:"folder",label:`Transform ${d}`,children:[{type:"vec3",label:"Position",property:[u,"position"]},{type:"vec3",label:"Quaternion",property:[u,"quaternion"]},{type:"vec3",label:"Scale",property:[u,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(n,u)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(n,u)}}]}))}]};(a=(o=n.uiConfig)==null?void 0:o.children)==null||a.push(i)})}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e){e.userData[Bp.PluginType].transforms.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}setTransform(e,t){var n,i,o,a;e.position.copy(t.position),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale),(i=(n=e.userData).setDirty)==null||i.call(n),(a=(o=e.uiConfig)==null?void 0:o.uiRefresh)==null||a.call(o)}animateTransform(e,t,n=2e3){var T,I;const i=(T=this._viewer)==null?void 0:T.getPluginByType("PopmotionPlugin");i||((I=this._viewer)==null||I.console.error("PopmotionPlugin required for animation"));const o=typeof t=="number"?e.userData[Bp.PluginType].transforms[t]:t,a=new p.Pa4,c=new p._fP,u=new p.Pa4,d=e.position.clone(),m=e.quaternion.clone(),g=e.scale.clone(),_=o.position,w=o.quaternion,x=o.scale;return i==null?void 0:i.animate({from:0,to:1,duration:n,onUpdate:R=>{var M,C;a.lerpVectors(d,_,R),c.slerpQuaternions(m,w,R),u.lerpVectors(g,x,R),e.position.copy(a),e.quaternion.copy(c),e.scale.copy(u),(M=this._viewer)==null||M.setDirty(),(C=this._viewer)==null||C.renderer.resetShadows()},onStop:()=>{var R,M,C,L;e.position.copy(o.position),e.quaternion.copy(o.quaternion),e.scale.copy(o.scale),(M=(R=e.userData).setDirty)==null||M.call(R),(L=(C=e.uiConfig)==null?void 0:C.uiRefresh)==null||L.call(C)}})}}Bp.PluginType="TransformAnimationPlugin";var xI=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let mm=class extends En{constructor(s=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const e of this.cameras){if(!e.enabled)continue;const t=this._viewer,n=e.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:e}),t.scene.renderCamera=n,t.renderer.render(!1);const i=t.renderer.composer.readBuffer;this.dispatchEvent({type:"preBlitCamera",camera:e,readBuffer:i}),t.renderer.blit(i.texture,e.target),this.dispatchEvent({type:"postRenderCamera",camera:e})}catch(i){console.error(i),e.enabled=!1}}},this.enabled=s}async onAdded(s){await super.onAdded(s),s.addEventListener("preRender",this._preRender)}addCamera(s){if(!this._viewer)throw"Plugin not added to viewer";const e={camera:s,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(e),e}};function KS(s,e,t,n,i){const o=s.getAttribute(e),a=n.length/t;return o&&o.count===a?(o.set(n),o.needsUpdate=!0):s.setAttribute(e,new(i??p.a$l)(n,t)),o}function EI(s,e){var n,i,o;if(!s.uiConfig)return;let t=(n=s.uiConfig.children)==null?void 0:n.find(a=>{var c;return(c=a.tags)==null?void 0:c.includes("generatedGeometry")});t||(t={type:"folder",label:"Generation Params",tags:["generatedGeometry"],children:[]},(i=s.uiConfig.children)==null||i.push(t)),s.userData.__generationParamsUiType!==s.userData.generationParams.type&&(t.children=e(),s.userData.__generationParamsUiType=s.userData.generationParams.type,(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))}mm.PluginType="VirtualCamerasPlugin",xI([Gt()],mm.prototype,"enabled",void 0),mm=xI([Hn("Virtual Cameras")],mm);class g0{constructor(e){this.type=e}createUiConfig(e){const t=Da(e.userData.generationParams).filter(n=>{var i;return((i=(0,V.getOrCall)(n.property))==null?void 0:i[1])!=="type"});return t.forEach(n=>{n.onChange=()=>this.generate(e)}),t}generate(e,t={}){const n=e??new p.u9r;if(n.userData.generationParams||(n.userData.generationParams={type:this.type}),n.userData.generationParams.type=this.type,t.type)return console.error("Cannot set type parameter here, use the plugin instead"),n;const i={...this.defaultParams,...n.userData.generationParams,...t},{indices:o,vertices:a,normals:c,uvs:u,groups:d}=this._generateData(i);if(function(m,g){const _=m.index;_&&_.count===g.length?(_.set(g),_.needsUpdate=!0):m.setIndex(g)}(n,o),KS(n,"position",3,a),KS(n,"normal",3,c),KS(n,"uv",2,u),d){n.clearGroups();for(const m of d)n.addGroup(m.start,m.count,m.materialIndex)}return n.computeBoundingBox(),n.computeBoundingSphere(),Object.assign(n.userData.generationParams,i),EI(n,()=>this.createUiConfig(n)),n.dispatchEvent({type:"geometryUpdate"}),n}}class mD extends g0{constructor(){super(...arguments),this.defaultParams={radius:1,widthSegments:32,heightSegments:16,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}}_generateData(e){const{radius:t,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a}=e;let{widthSegments:c,heightSegments:u}=e;c=Math.max(3,Math.floor(c)),u=Math.max(2,Math.floor(u));const d=Math.min(o+a,Math.PI);let m=0;const g=[],_=new p.Pa4,w=new p.Pa4,x=[],T=[],I=[],R=[];for(let M=0;M<=u;M++){const C=[],L=M/u;let k=0;M===0&&o===0?k=.5/c:M===u&&d===Math.PI&&(k=-.5/c);for(let j=0;j<=c;j++){const H=j/c;_.x=-t*Math.cos(n+H*i)*Math.sin(o+L*a),_.y=t*Math.cos(o+L*a),_.z=t*Math.sin(n+H*i)*Math.sin(o+L*a),T.push(_.x,_.y,_.z),w.copy(_).normalize(),I.push(w.x,w.y,w.z),R.push(H+k,1-L),C.push(m++)}g.push(C)}for(let M=0;M<u;M++)for(let C=0;C<c;C++){const L=g[M][C+1],k=g[M][C],j=g[M+1][C],H=g[M+1][C+1];(M!==0||o>0)&&x.push(L,k,H),(M!==u-1||d<Math.PI)&&x.push(k,j,H)}return{indices:x,vertices:T,normals:I,uvs:R}}}class gD extends g0{constructor(){super(...arguments),this.defaultParams={width:1,height:1,widthSegments:2,heightSegments:2}}_generateData(e){const t=e.width/2,n=e.height/2,i=Math.floor(e.widthSegments),o=Math.floor(e.heightSegments),a=i+1,c=o+1,u=e.width/i,d=e.height/o,m=[],g=[],_=[],w=[];for(let x=0;x<c;x++){const T=x*d-n;for(let I=0;I<a;I++){const R=I*u-t;g.push(R,-T,0),_.push(0,0,1),w.push(I/i),w.push(1-x/o)}}for(let x=0;x<o;x++)for(let T=0;T<i;T++){const I=T+a*x,R=T+a*(x+1),M=T+1+a*(x+1),C=T+1+a*x;m.push(I,R,C),m.push(R,M,C)}return{indices:m,vertices:g,normals:_,uvs:w}}}class vD extends g0{constructor(){super(...arguments),this.defaultParams={radius:1,segments:32,thetaStart:0,thetaLength:2*Math.PI}}_generateData(e){const{radius:t,thetaStart:n,thetaLength:i}=e,o=Math.max(3,e.segments),a=[],c=[],u=[],d=[],m=new p.Pa4,g=new p.FM8;c.push(0,0,0),u.push(0,0,1),d.push(.5,.5);for(let _=0,w=3;_<=o;_++,w+=3){const x=n+_/o*i;m.x=t*Math.cos(x),m.y=t*Math.sin(x),c.push(m.x,m.y,m.z),u.push(0,0,1),g.x=(c[w]/t+1)/2,g.y=(c[w+1]/t+1)/2,d.push(g.x,g.y)}for(let _=1;_<=o;_++)a.push(_,_+1,0);return{indices:a,vertices:c,normals:u,uvs:d}}}class _D extends g0{constructor(){super(...arguments),this.defaultParams={radius:1,tube:.4,radialSegments:12,tubularSegments:48,arc:2*Math.PI}}_generateData(e){const{radius:t,tube:n,arc:i}=e;let{radialSegments:o,tubularSegments:a}=e;o=Math.floor(o),a=Math.floor(a);const c=[],u=[],d=[],m=[],g=new p.Pa4,_=new p.Pa4,w=new p.Pa4;for(let x=0;x<=o;x++)for(let T=0;T<=a;T++){const I=T/a*i,R=x/o*Math.PI*2;_.x=(t+n*Math.cos(R))*Math.cos(I),_.y=(t+n*Math.cos(R))*Math.sin(I),_.z=n*Math.sin(R),u.push(_.x,_.y,_.z),g.x=t*Math.cos(I),g.y=t*Math.sin(I),w.subVectors(_,g).normalize(),d.push(w.x,w.y,w.z),m.push(T/a),m.push(x/o)}for(let x=1;x<=o;x++)for(let T=1;T<=a;T++){const I=(a+1)*x+T-1,R=(a+1)*(x-1)+T-1,M=(a+1)*(x-1)+T,C=(a+1)*x+T;c.push(I,R,C),c.push(R,M,C)}return{indices:c,vertices:u,normals:d,uvs:m}}}class yD extends g0{constructor(){super(...arguments),this.defaultParams={radiusTop:1,radiusBottom:1,height:1,radialSegments:32,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI}}_generateTorso(e){const{radiusTop:t,radiusBottom:n,height:i,radialSegments:o,heightSegments:a,thetaStart:c,thetaLength:u,indexArray:d,indices:m,groups:g,vertices:_,normals:w,uvs:x,groupStart:T,halfHeight:I}=e,R=new p.Pa4,M=new p.Pa4;let C=0;const L=(n-t)/i;for(let k=0;k<=a;k++){const j=[],H=k/a,X=H*(n-t)+t;for(let ee=0;ee<=o;ee++){const oe=ee/o,re=oe*u+c,he=Math.sin(re),le=Math.cos(re);M.x=X*he,M.y=-H*i+I,M.z=X*le,_.push(M.x,M.y,M.z),R.set(he,L,le).normalize(),w.push(R.x,R.y,R.z),x.push(oe,1-H),j.push(e.index++)}d.push(j)}for(let k=0;k<o;k++)for(let j=0;j<a;j++){const H=d[j][k],X=d[j+1][k],ee=d[j+1][k+1],oe=d[j][k+1];m.push(H,X,oe),m.push(X,ee,oe),C+=6}g.push({start:T,count:C,materialIndex:0}),e.groupStart+=C}_generateCap(e,t){const{radiusTop:n,radiusBottom:i,radialSegments:o,thetaStart:a,thetaLength:c,indices:u,groups:d,vertices:m,normals:g,uvs:_,groupStart:w,halfHeight:x}=e,T=e.index,I=new p.FM8,R=new p.Pa4;let M=0;const C=t===!0?n:i,L=t===!0?1:-1;for(let j=1;j<=o;j++)m.push(0,x*L,0),g.push(0,L,0),_.push(.5,.5),e.index++;const k=e.index;for(let j=0;j<=o;j++){const H=j/o*c+a,X=Math.cos(H),ee=Math.sin(H);R.x=C*ee,R.y=x*L,R.z=C*X,m.push(R.x,R.y,R.z),g.push(0,L,0),I.x=.5*X+.5,I.y=.5*ee*L+.5,_.push(I.x,I.y),e.index++}for(let j=0;j<o;j++){const H=T+j,X=k+j;t===!0?u.push(X,X+1,H):u.push(X+1,X,H),M+=3}d.push({start:w,count:M,materialIndex:t===!0?1:2}),e.groupStart+=M}_generateData(e){let{radialSegments:t,heightSegments:n}=e;t=Math.floor(t),n=Math.floor(n);const i={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[],index:0,indexArray:[],halfHeight:e.height/2,...e,radialSegments:t,heightSegments:n};return this._generateTorso(i),e.openEnded===!1&&(e.radiusTop>0&&this._generateCap(i,!0),e.radiusBottom>0&&this._generateCap(i,!1)),i}}class AD extends g0{constructor(){super(...arguments),this.defaultParams={width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1}}_buildPlane(e,t,n,i,o,a,c,u,d,m,g,_){const{indices:w,vertices:x,normals:T,uvs:I,numberOfVertices:R,groupStart:M,groups:C}=e,L=c/m,k=u/g,j=c/2,H=u/2,X=d/2,ee=m+1,oe=g+1;let re=0,he=0;const le=new p.Pa4;for(let ue=0;ue<oe;ue++){const ge=ue*k-H;for(let _e=0;_e<ee;_e++){const Ee=_e*L-j;le[t]=Ee*o,le[n]=ge*a,le[i]=X,x.push(le.x,le.y,le.z),le[t]=0,le[n]=0,le[i]=d>0?1:-1,T.push(le.x,le.y,le.z),I.push(_e/m),I.push(1-ue/g),re+=1}}for(let ue=0;ue<g;ue++)for(let ge=0;ge<m;ge++){const _e=R+ge+ee*ue,Ee=R+ge+ee*(ue+1),Ye=R+(ge+1)+ee*(ue+1),We=R+(ge+1)+ee*ue;w.push(_e,Ee,We),w.push(Ee,Ye,We),he+=6}C.push({start:M,count:he,materialIndex:_}),e.groupStart+=he,e.numberOfVertices+=re}_generateData(e){const{width:t,height:n,depth:i}=e;let{widthSegments:o,heightSegments:a,depthSegments:c}=e;o=Math.floor(o),a=Math.floor(a),c=Math.floor(c);const u={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[]};return this._buildPlane(u,"z","y","x",-1,-1,i,n,t,c,a,0),this._buildPlane(u,"z","y","x",1,-1,i,n,-t,c,a,1),this._buildPlane(u,"x","z","y",1,1,t,i,n,o,c,2),this._buildPlane(u,"x","z","y",1,-1,t,i,-n,o,c,3),this._buildPlane(u,"x","y","z",1,-1,t,n,i,o,a,4),this._buildPlane(u,"x","y","z",-1,-1,t,n,-i,o,a,5),u}}class ZA extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.generators={plane:new gD("plane"),sphere:new mD("sphere"),box:new AD("box"),circle:new vD("circle"),torus:new _D("torus"),cylinder:new yD("cylinder")},this._sceneUpdate=e=>{var t;if(e.hierarchyChanged){const n=e.object||((t=this._viewer)==null?void 0:t.scene.modelRoot);n&&n.traverse(i=>{var a,c,u;const o=(u=(c=(a=i.geometry)==null?void 0:a.userData)==null?void 0:c.generationParams)==null?void 0:u.type;o&&EI(i.geometry,()=>{const d=this.generators[o];return d!=null&&d.createUiConfig?d.createUiConfig(i.geometry)??[]:[]})})}},this.uiConfig={type:"folder",label:"Generate Geometry",children:[()=>Object.keys(this.generators).map(e=>({type:"button",label:"Generate "+e,value:async()=>{(await this.generateObject(e)).name=e}}))]}}async generateObject(e){var i,o;const t=this.generators[e];if(!t)throw new Error("Unknown generator type: "+e);const n=await((o=(i=this._viewer)==null?void 0:i.getManager())==null?void 0:o.addImportedSingle(new p.Kj0(new p.u9r,new Hs({color:16711680})),{autoScale:!1,autoCenter:!1}));return t.generate(n.modelObject.geometry),n.name=e,n.geometry.name="Generated "+e,n.modelObject}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}}ZA.PluginType="GeometryGeneratorPlugin";var v0=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ru=class extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.prefix="",this.count=50,this.loops=1,this.color=new p.Ilk().setHSL(0,.8,.5)}colorItems(){if(!this._viewer)return;const s=this._viewer.scene.modelRoot;let e=0;const t=this.color.getHSL({h:0,s:0,l:0});s.traverse(n=>{const i=n.material&&n.material.isDiamondMaterial,o=i&&n.name.startsWith(this.prefix);if(i&&console.log("Found Diamond, name = ",name,", coloring = ",o),o){let a=n.name.replace(this.prefix,"");a=parseFloat(a)/this.count;const c=new p.Ilk().setHSL((this.loops*a+t.h)%1,t.s,t.l);n.material=n.material.userData.isColoredClone?n.material:n.material.clone(),n.material.color.set(c),n.material.boostFactors.set(1,1,1),n.material.userData.isColoredClone=!0,e++}}),console.log("total",e),this._viewer.setDirty()}};ru.PluginType="RainbowDiamondPlugin",v0([jn("Object name prefix")],ru.prototype,"prefix",void 0),v0([jn("Count")],ru.prototype,"count",void 0),v0([jn("Loops")],ru.prototype,"loops",void 0),v0([Zo("First Color")],ru.prototype,"color",void 0),v0([Ai("Color All Items")],ru.prototype,"colorItems",null),ru=v0([Hn("Rainbow Diamond Coloring")],ru);class JS extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=null,this.ringSlots=[],this.dependencies=[Qt,am],this._animating=!1,this._runningAnimations=[],this.uiConfig={type:"folder",label:"Bering Animation",children:[{label:"Play Animation",type:"button",value:()=>{this.startRingAnimation(!1)}},{label:"Record Animation",type:"button",value:async()=>{var n;const e=(n=this._viewer)==null?void 0:n.getPluginByType("CanvasRecorder");if(!e||e.isRecording())return;this.animating&&this.stopRingAnimation(!1),await(0,V.timeout)(500);const t=await e.record(async()=>{console.log("start"),await this.startRingAnimation(!1),console.log("finish")});t&&(console.log("recorded",t),(0,V.downloadBlob)(t,"animation.mp4"))}}]}}get animating(){return this._animating}set animating(e){var i,o;if(this._animating===e)return;this._animating=e;const t=(i=this._viewer)==null?void 0:i.getPlugin(_c);t&&(e?t.disable("bering"):t.enable("bering"));const n=(o=this._viewer)==null?void 0:o.getPlugin(zh);n&&(n.enabled=!e)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",t=>{var o,a,c,u,d;if(!((a=(o=t.options)==null?void 0:o.allImported)!=null&&a.length)||!t.object||!t.object.__importedViewerConfig&&!((c=t.object.modelObject)!=null&&c.__importedViewerConfig)||!((u=t.options)!=null&&u.allImported))return;let n=0;const i=(d=t.options)==null?void 0:d.allImported.filter(m=>!!(m&&m.modelObject&&m.name.endsWith("bmod"))).reverse();i.forEach(m=>{this.loadRingBMod(m,m.name,n,i.length-1),n++})})}loadRingBMod(e,t,n,i){var d,m,g;if(!t)return;if(!((d=this._viewer)==null?void 0:d.getPlugin(Qt)))throw new Error("no asset manager");this._runningAnimations&&this.stopRingAnimation(),t.endsWith(".bmod")||(t+=".bmod");const a=e==null?void 0:e.modelObject;if(!a||!e)throw new Error("no model");a.userData.__ringSlot=n,this.ringSlots[n]=e;const c=[];a.traverse(_=>{_.userData.rotationCount>1&&c.push(_)}),new Ie().expandByObjects(c,!0,!0),t.toLowerCase().includes("x3")||t.toLowerCase().includes("x4");const u=parseInt(t.split("-").pop().toLowerCase().replace("x","").replace(".bmod",""))+1;return a.userData.__ringWidth=u,a.userData.__ringTotalSlots=i,(g=(m=this._viewer)==null?void 0:m.scene)==null||g.setDirty({sceneUpdate:!0,frameFade:!1}),e}clearAllSlots(){this.ringSlots.forEach(e=>{e.modelObject.removeFromParent()}),this.ringSlots=[]}stopRingAnimation(e=!0){var t,n;if(this._runningAnimations.length!==0){for(const i of this._runningAnimations)i.stop();this._runningAnimations=[],e&&((n=(t=this._viewer)==null?void 0:t.getPlugin(_c))==null||n.startTransition(1200))}}async startRingAnimation(e=!0){if(this.animating||!this._viewer)return;this.stopRingAnimation(),this.animating=!0;let t=0;const n=[];await new Promise(i=>{var d,m,g;if(!this._viewer)return;const o=()=>{t+=1,t<n.length||i()},a=2500,c=this._viewer.getPlugin(am),u=this.ringSlots[0];if(u){const _=u.modelObject,w={left:[],right:[],rem:[]};_.traverse(I=>{const R=(I==null?void 0:I.name.trim().toLowerCase().replace(/[0-9]/g,""))||"";R.endsWith("-s")?w.left.push(I):R.endsWith("-l")?w.right.push(I):R.startsWith("testlogo")&&w.rem.push(I)});const x=[];for(const I of w.left){const R=((d=I.parent)==null?void 0:d.children)||[];x.push(...R)}for(const I of w.right){const R=((m=I.parent)==null?void 0:m.children)||[];x.push(...R)}for(const I of x)w.left.includes(I)||w.right.includes(I)||w.rem.includes(I)||w.rem.push(I);for(const I of w.rem)new Ie().expandByObject(I,!1,!0).getCenter(new p.Pa4).x<=0?w.left.push(I):w.right.push(I);for(const I of[...w.left,...w.right])I.userData.__initX=I.position.x,I.userData.__initRotX=I.rotation.x;const T=(g=this._viewer)==null?void 0:g.getPluginByType("Ground");if(w.left.length>0&&w.right.length>0){const I=M=>C=>{var L,k,j;for(const H of w[M])H.position.x=C+H.userData.__initX;(k=(L=this._viewer)==null?void 0:L.scene)==null||k.setDirty({sceneUpdate:!1,frameFade:!1}),e&&((j=T==null?void 0:T.shadowBaker)==null||j.reset())},R=M=>C=>{var L,k;for(const j of w[M])j.rotation.x=C+j.userData.__initRotX;(k=(L=this._viewer)==null?void 0:L.scene)==null||k.setDirty({sceneUpdate:!1,frameFade:!1})};n.push(c.animate({from:0,to:-.75,onUpdate:I("left"),onStop:()=>{I("left")(0),o()},onComplete:o,duration:a,ease:yc.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),n.push(c.animate({from:0,to:.75,onUpdate:I("right"),onStop:()=>{I("right")(0),o()},onComplete:o,duration:a,ease:yc.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),n.push(c.animate({from:0,to:1.5*-Math.PI,onUpdate:R("left"),onStop:()=>{R("left")(0),o()},onComplete:o,duration:1250,ease:yc.easeInOut,repeat:1,repeatDelay:2750,repeatType:"mirror"}))}}this.ringSlots.forEach(_=>{if(u===_)return;const w=_.modelObject.userData.__ringSlot,x=_.modelObject.userData.__ringTotalSlots,T=_.modelObject.userData.__ringWidth,I=_.modelObject.position.x;n.push(c.animate({from:I,to:I+.75-1.5*(1-(w+1)/(x+1+(2-T))),onUpdate:R=>{var M,C;_.modelObject.position.x=R,(C=(M=this._viewer)==null?void 0:M.scene)==null||C.setDirty({sceneUpdate:!1,frameFade:!1})},onStop:()=>{_.modelObject.position.x=I,o()},onComplete:o,duration:a,ease:yc.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"}))}),n.length>0?this._runningAnimations=n:(this.animating=!1,i())}),this.animating=!1;for(const i of this._runningAnimations)i.stop();this._runningAnimations=[],console.log("animation end")}}JS.PluginType="BeringRingAnimation";class Ku{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ie);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ie);const n=this.elements,i=e.x,o=e.y,a=e.z;return t.x=n[0]*i+n[1]*o+n[2]*a,t.y=n[3]*i+n[4]*o+n[5]*a,t.z=n[6]*i+n[7]*o+n[8]*a,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Ku);const n=this.elements,i=e.elements,o=t.elements,a=n[0],c=n[1],u=n[2],d=n[3],m=n[4],g=n[5],_=n[6],w=n[7],x=n[8],T=i[0],I=i[1],R=i[2],M=i[3],C=i[4],L=i[5],k=i[6],j=i[7],H=i[8];return o[0]=a*T+c*M+u*k,o[1]=a*I+c*C+u*j,o[2]=a*R+c*L+u*H,o[3]=d*T+m*M+g*k,o[4]=d*I+m*C+g*j,o[5]=d*R+m*L+g*H,o[6]=_*T+w*M+x*k,o[7]=_*I+w*C+x*j,o[8]=_*R+w*L+x*H,t}scale(e,t){t===void 0&&(t=new Ku);const n=this.elements,i=t.elements;for(let o=0;o!==3;o++)i[3*o+0]=e.x*n[3*o+0],i[3*o+1]=e.y*n[3*o+1],i[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new ie);const n=[];let i,o;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(o=0;o<3;o++)n[i+4*o]=this.elements[i+3*o];n[3]=e.x,n[7]=e.y,n[11]=e.z;let a=3;const c=a;let u,d;do{if(i=c-a,n[i+4*i]===0){for(o=i+1;o<c;o++)if(n[i+4*o]!==0){u=4;do d=4-u,n[d+4*i]+=n[d+4*o];while(--u);break}}if(n[i+4*i]!==0)for(o=i+1;o<c;o++){const m=n[i+4*o]/n[i+4*i];u=4;do d=4-u,n[d+4*o]=d<=i?0:n[d+4*o]-n[d+4*i]*m;while(--u)}}while(--a);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){e===void 0&&(e=new Ku);const t=bD;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let o=3;const a=o;let c,u;do{if(n=a-o,t[n+6*n]===0){for(i=n+1;i<a;i++)if(t[n+6*i]!==0){c=6;do u=6-c,t[u+6*n]+=t[u+6*i];while(--c);break}}if(t[n+6*n]!==0)for(i=n+1;i<a;i++){const d=t[n+6*i]/t[n+6*n];c=6;do u=6-c,t[u+6*i]=u<=n?0:t[u+6*i]-t[u+6*n]*d;while(--c)}}while(--o);n=2;do{i=n-1;do{const d=t[n+6*i]/t[n+6*n];c=6;do u=6-c,t[u+6*i]=t[u+6*i]-t[u+6*n]*d;while(--c)}while(i--)}while(--n);n=2;do{const d=1/t[n+6*n];c=6;do u=6-c,t[u+6*n]=t[u+6*n]*d;while(--c)}while(n--);n=2;do{i=2;do{if(u=t[3+i+6*n],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(n,i,u)}while(i--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,o=e.w,a=t+t,c=n+n,u=i+i,d=t*a,m=t*c,g=t*u,_=n*c,w=n*u,x=i*u,T=o*a,I=o*c,R=o*u,M=this.elements;return M[0]=1-(_+x),M[1]=m-R,M[2]=g+I,M[3]=m+R,M[4]=1-(d+x),M[5]=w-T,M[6]=g-I,M[7]=w+T,M[8]=1-(d+_),this}transpose(e){e===void 0&&(e=new Ku);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const bD=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ie{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new ie);const n=e.x,i=e.y,o=e.z,a=this.x,c=this.y,u=this.z;return t.x=c*o-u*i,t.y=u*n-a*o,t.z=a*i-c*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new ie(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new ie(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new Ku([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const o=1/i;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new ie);const t=this.x,n=this.y,i=this.z;let o=Math.sqrt(t*t+n*n+i*i);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=i*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,o=e.x,a=e.y,c=e.z;return Math.sqrt((o-t)*(o-t)+(a-n)*(a-n)+(c-i)*(c-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,o=e.x,a=e.y,c=e.z;return(o-t)*(o-t)+(a-n)*(a-n)+(c-i)*(c-i)}scale(e,t){t===void 0&&(t=new ie);const n=this.x,i=this.y,o=this.z;return t.x=e*n,t.y=e*i,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new ie),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new ie),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ie),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=wD,o=1/n;i.set(this.x*o,this.y*o,this.z*o);const a=xD;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,e)):(a.set(0,1,0),i.cross(a,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,o=this.y,a=this.z;n.x=i+(e.x-i)*t,n.y=o+(e.y-o)*t,n.z=a+(e.z-a)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(SI),SI.almostEquals(e,t)}clone(){return new ie(this.x,this.y,this.z)}}ie.ZERO=new ie(0,0,0),ie.UNIT_X=new ie(1,0,0),ie.UNIT_Y=new ie(0,1,0),ie.UNIT_Z=new ie(0,0,1);const wD=new ie,xD=new ie,SI=new ie;class ms{constructor(e){e===void 0&&(e={}),this.lowerBound=new ie,this.upperBound=new ie,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const o=this.lowerBound,a=this.upperBound,c=n;o.copy(e[0]),c&&c.vmult(o,o),a.copy(o);for(let u=1;u<e.length;u++){let d=e[u];c&&(c.vmult(d,CI),d=CI),d.x>a.x&&(a.x=d.x),d.x<o.x&&(o.x=d.x),d.y>a.y&&(a.y=d.y),d.y<o.y&&(o.y=d.y),d.z>a.z&&(a.z=d.z),d.z<o.z&&(o.z=d.z)}return t&&(t.vadd(o,o),t.vadd(a,a)),i&&(o.x-=i,o.y-=i,o.z-=i,a.x+=i,a.y+=i,a.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new ms().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound,a=i.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,c=i.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,u=i.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return a&&c&&u}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound;return t.x<=i.x&&n.x>=o.x&&t.y<=i.y&&n.y>=o.y&&t.z<=i.z&&n.z>=o.z}getCorners(e,t,n,i,o,a,c,u){const d=this.lowerBound,m=this.upperBound;e.copy(d),t.set(m.x,d.y,d.z),n.set(m.x,m.y,d.z),i.set(d.x,m.y,m.z),o.set(m.x,d.y,m.z),a.set(d.x,m.y,d.z),c.set(d.x,d.y,m.z),u.copy(m)}toLocalFrame(e,t){const n=MI,i=n[0],o=n[1],a=n[2],c=n[3],u=n[4],d=n[5],m=n[6],g=n[7];this.getCorners(i,o,a,c,u,d,m,g);for(let _=0;_!==8;_++){const w=n[_];e.pointToLocal(w,w)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=MI,i=n[0],o=n[1],a=n[2],c=n[3],u=n[4],d=n[5],m=n[6],g=n[7];this.getCorners(i,o,a,c,u,d,m,g);for(let _=0;_!==8;_++){const w=n[_];e.pointToWorld(w,w)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,o=1/t.y,a=1/t.z,c=(this.lowerBound.x-n.x)*i,u=(this.upperBound.x-n.x)*i,d=(this.lowerBound.y-n.y)*o,m=(this.upperBound.y-n.y)*o,g=(this.lowerBound.z-n.z)*a,_=(this.upperBound.z-n.z)*a,w=Math.max(Math.max(Math.min(c,u),Math.min(d,m)),Math.min(g,_)),x=Math.min(Math.min(Math.max(c,u),Math.max(d,m)),Math.max(g,_));return!(x<0||w>x)}}const CI=new ie,MI=[new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie];class TI{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const o=i;i=n,n=o}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:o}=t;if(o>i){const a=o;o=i,i=a}this.matrix[(i*(i+1)>>1)+o-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class II{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!(n[e]===void 0||!n[e].includes(t))}hasAnyEventListener(e){return this._listeners!==void 0&&this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const i=n[e].indexOf(t);return i!==-1&&n[e].splice(i,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){e.target=this;for(let n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}class Rs{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){e===void 0&&(e=new ie),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=ED,i=SD;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Rs);const n=this.x,i=this.y,o=this.z,a=this.w,c=e.x,u=e.y,d=e.z,m=e.w;return t.x=n*m+a*c+i*d-o*u,t.y=i*m+a*u+o*c-n*d,t.z=o*m+a*d+n*u-i*c,t.w=a*m-n*c-i*u-o*d,t}inverse(e){e===void 0&&(e=new Rs);const t=this.x,n=this.y,i=this.z,o=this.w;this.conjugate(e);const a=1/(t*t+n*n+i*i+o*o);return e.x*=a,e.y*=a,e.z*=a,e.w*=a,e}conjugate(e){return e===void 0&&(e=new Rs),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ie);const n=e.x,i=e.y,o=e.z,a=this.x,c=this.y,u=this.z,d=this.w,m=d*n+c*o-u*i,g=d*i+u*n-a*o,_=d*o+a*i-c*n,w=-a*n-c*i-u*o;return t.x=m*d+w*-a+g*-u-_*-c,t.y=g*d+w*-c+_*-a-m*-u,t.z=_*d+w*-u+m*-c-g*-a,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,i,o;t===void 0&&(t="YZX");const a=this.x,c=this.y,u=this.z,d=this.w;if(t!=="YZX")throw new Error(`Euler order ${t} not supported yet.`);{const m=a*c+u*d;if(m>.499&&(n=2*Math.atan2(a,d),i=Math.PI/2,o=0),m<-.499&&(n=-2*Math.atan2(a,d),i=-Math.PI/2,o=0),n===void 0){const g=a*a,_=c*c,w=u*u;n=Math.atan2(2*c*d-2*a*u,1-2*_-2*w),i=Math.asin(2*m),o=Math.atan2(2*a*d-2*c*u,1-2*g-2*w)}}e.y=n,e.z=i,e.x=o}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const o=Math.cos(e/2),a=Math.cos(t/2),c=Math.cos(n/2),u=Math.sin(e/2),d=Math.sin(t/2),m=Math.sin(n/2);return i==="XYZ"?(this.x=u*a*c+o*d*m,this.y=o*d*c-u*a*m,this.z=o*a*m+u*d*c,this.w=o*a*c-u*d*m):i==="YXZ"?(this.x=u*a*c+o*d*m,this.y=o*d*c-u*a*m,this.z=o*a*m-u*d*c,this.w=o*a*c+u*d*m):i==="ZXY"?(this.x=u*a*c-o*d*m,this.y=o*d*c+u*a*m,this.z=o*a*m+u*d*c,this.w=o*a*c-u*d*m):i==="ZYX"?(this.x=u*a*c-o*d*m,this.y=o*d*c+u*a*m,this.z=o*a*m-u*d*c,this.w=o*a*c+u*d*m):i==="YZX"?(this.x=u*a*c+o*d*m,this.y=o*d*c+u*a*m,this.z=o*a*m-u*d*c,this.w=o*a*c-u*d*m):i==="XZY"&&(this.x=u*a*c-o*d*m,this.y=o*d*c-u*a*m,this.z=o*a*m+u*d*c,this.w=o*a*c+u*d*m),this}clone(){return new Rs(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new Rs);const i=this.x,o=this.y,a=this.z,c=this.w;let u,d,m,g,_,w=e.x,x=e.y,T=e.z,I=e.w;return d=i*w+o*x+a*T+c*I,d<0&&(d=-d,w=-w,x=-x,T=-T,I=-I),1-d>1e-6?(u=Math.acos(d),m=Math.sin(u),g=Math.sin((1-t)*u)/m,_=Math.sin(t*u)/m):(g=1-t,_=t),n.x=g*i+_*w,n.y=g*o+_*x,n.z=g*a+_*T,n.w=g*c+_*I,n}integrate(e,t,n,i){i===void 0&&(i=new Rs);const o=e.x*n.x,a=e.y*n.y,c=e.z*n.z,u=this.x,d=this.y,m=this.z,g=this.w,_=.5*t;return i.x+=_*(o*g+a*m-c*d),i.y+=_*(a*g+c*u-o*m),i.z+=_*(c*g+o*d-a*u),i.w+=_*(-o*u-a*d-c*m),i}}const ED=new ie,SD=new ie;class Mn{constructor(e){e===void 0&&(e={}),this.id=Mn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Mn.idCounter=0,Mn.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class hr{constructor(e){e===void 0&&(e={}),this.position=new ie,this.quaternion=new Rs,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return hr.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return hr.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ie),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new ie),n.vsub(e,i),t.conjugate(PI),PI.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new ie),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new ie),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new ie),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const PI=new Rs;class _v extends Mn{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:n=[],normals:i=[],axes:o,boundingSphereRadius:a}=e;super({type:Mn.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=i,this.faceNormals.length===0&&this.computeNormals(),a?this.boundingSphereRadius=a:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=o?o.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new ie;for(let o=0;o!==e.length;o++){const a=e[o],c=a.length;for(let u=0;u!==c;u++){const d=(u+1)%c;t[a[u]].vsub(t[a[d]],i),i.normalize();let m=!1;for(let g=0;g!==n.length;g++)if(n[g].almostEquals(i)||n[g].almostEquals(i)){m=!0;break}m||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error(`Vertex ${this.faces[e][i]} not found!`);const t=this.faceNormals[e]||new ie;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let i=0;i<this.faces[e].length;i++)console.warn(`.vertices[${this.faces[e][i]}] = Vec3(${this.vertices[this.faces[e][i]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],o=this.vertices[n[1]],a=this.vertices[n[2]];_v.computeNormal(i,o,a,t)}static computeNormal(e,t,n,i){const o=new ie,a=new ie;t.vsub(e,a),n.vsub(t,o),o.cross(a,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,o,a,c,u,d){const m=new ie;let g=-1,_=-Number.MAX_VALUE;for(let x=0;x<n.faces.length;x++){m.copy(n.faceNormals[x]),o.vmult(m,m);const T=m.dot(a);T>_&&(_=T,g=x)}const w=[];for(let x=0;x<n.faces[g].length;x++){const T=n.vertices[n.faces[g][x]],I=new ie;I.copy(T),o.vmult(I,I),i.vadd(I,I),w.push(I)}g>=0&&this.clipFaceAgainstHull(a,e,t,w,c,u,d)}findSeparatingAxis(e,t,n,i,o,a,c,u){const d=new ie,m=new ie,g=new ie,_=new ie,w=new ie,x=new ie;let T=Number.MAX_VALUE;const I=this;if(I.uniqueAxes)for(let R=0;R!==I.uniqueAxes.length;R++){n.vmult(I.uniqueAxes[R],d);const M=I.testSepAxis(d,e,t,n,i,o);if(M===!1)return!1;M<T&&(T=M,a.copy(d))}else{const R=c?c.length:I.faces.length;for(let M=0;M<R;M++){const C=c?c[M]:M;d.copy(I.faceNormals[C]),n.vmult(d,d);const L=I.testSepAxis(d,e,t,n,i,o);if(L===!1)return!1;L<T&&(T=L,a.copy(d))}}if(e.uniqueAxes)for(let R=0;R!==e.uniqueAxes.length;R++){o.vmult(e.uniqueAxes[R],m);const M=I.testSepAxis(m,e,t,n,i,o);if(M===!1)return!1;M<T&&(T=M,a.copy(m))}else{const R=u?u.length:e.faces.length;for(let M=0;M<R;M++){const C=u?u[M]:M;m.copy(e.faceNormals[C]),o.vmult(m,m);const L=I.testSepAxis(m,e,t,n,i,o);if(L===!1)return!1;L<T&&(T=L,a.copy(m))}}for(let R=0;R!==I.uniqueEdges.length;R++){n.vmult(I.uniqueEdges[R],_);for(let M=0;M!==e.uniqueEdges.length;M++)if(o.vmult(e.uniqueEdges[M],w),_.cross(w,x),!x.almostZero()){x.normalize();const C=I.testSepAxis(x,e,t,n,i,o);if(C===!1)return!1;C<T&&(T=C,a.copy(x))}}return i.vsub(t,g),g.dot(a)>0&&a.negate(a),!0}testSepAxis(e,t,n,i,o,a){_v.project(this,e,n,i,ZS),_v.project(t,e,o,a,$S);const c=ZS[0],u=ZS[1],d=$S[0],m=$S[1];if(c<m||d<u)return!1;const g=c-m,_=d-u;return g<_?g:_}calculateLocalInertia(e,t){const n=new ie,i=new ie;this.computeLocalAABB(i,n);const o=n.x-i.x,a=n.y-i.y,c=n.z-i.z;t.x=1/12*e*(2*a*2*a+2*c*2*c),t.y=1/12*e*(2*o*2*o+2*c*2*c),t.z=1/12*e*(2*a*2*a+2*o*2*o)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,o,a,c){const u=new ie,d=new ie,m=new ie,g=new ie,_=new ie,w=new ie,x=new ie,T=new ie,I=this,R=i,M=[];let C=-1,L=Number.MAX_VALUE;for(let ee=0;ee<I.faces.length;ee++){u.copy(I.faceNormals[ee]),n.vmult(u,u);const oe=u.dot(e);oe<L&&(L=oe,C=ee)}if(C<0)return;const k=I.faces[C];k.connectedFaces=[];for(let ee=0;ee<I.faces.length;ee++)for(let oe=0;oe<I.faces[ee].length;oe++)k.indexOf(I.faces[ee][oe])!==-1&&ee!==C&&k.connectedFaces.indexOf(ee)===-1&&k.connectedFaces.push(ee);const j=k.length;for(let ee=0;ee<j;ee++){const oe=I.vertices[k[ee]],re=I.vertices[k[(ee+1)%j]];oe.vsub(re,d),m.copy(d),n.vmult(m,m),t.vadd(m,m),g.copy(this.faceNormals[C]),n.vmult(g,g),t.vadd(g,g),m.cross(g,_),_.negate(_),w.copy(oe),n.vmult(w,w),t.vadd(w,w);const he=k.connectedFaces[ee];x.copy(this.faceNormals[he]);const le=this.getPlaneConstantOfFace(he);T.copy(x),n.vmult(T,T);const ue=le-T.dot(t);for(this.clipFaceAgainstPlane(R,M,T,ue);R.length;)R.shift();for(;M.length;)R.push(M.shift())}x.copy(this.faceNormals[C]);const H=this.getPlaneConstantOfFace(C);T.copy(x),n.vmult(T,T);const X=H-T.dot(t);for(let ee=0;ee<R.length;ee++){let oe=T.dot(R[ee])+X;if(oe<=o&&(console.log(`clamped: depth=${oe} to minDist=${o}`),oe=o),oe<=a){const re=R[ee];if(oe<=1e-6){const he={point:re,normal:T,depth:oe};c.push(he)}}}}clipFaceAgainstPlane(e,t,n,i){let o,a;const c=e.length;if(c<2)return t;let u=e[e.length-1],d=e[0];o=n.dot(u)+i;for(let m=0;m<c;m++){if(d=e[m],a=n.dot(d)+i,o<0)if(a<0){const g=new ie;g.copy(d),t.push(g)}else{const g=new ie;u.lerp(d,o/(o-a),g),t.push(g)}else if(a<0){const g=new ie;u.lerp(d,o/(o-a),g),t.push(g),t.push(d)}u=d,o=a}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new ie);const n=this.vertices,i=this.worldVertices;for(let o=0;o!==this.vertices.length;o++)t.vmult(n[o],i[o]),e.vadd(i[o],i[o]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const o=n[i];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new ie);const n=this.faceNormals,i=this.worldFaceNormals;for(let o=0;o!==t;o++)e.vmult(n[o],i[o]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const o=this.vertices;let a,c,u,d,m,g,_=new ie;for(let w=0;w<o.length;w++){_.copy(o[w]),t.vmult(_,_),e.vadd(_,_);const x=_;(a===void 0||x.x<a)&&(a=x.x),(d===void 0||x.x>d)&&(d=x.x),(c===void 0||x.y<c)&&(c=x.y),(m===void 0||x.y>m)&&(m=x.y),(u===void 0||x.z<u)&&(u=x.z),(g===void 0||x.z>g)&&(g=x.z)}n.set(a,c,u),i.set(d,m,g)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new ie);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let o=0;o<n;o++){const a=i[o];t.vmult(a,a)}for(let o=0;o<this.faceNormals.length;o++){const a=this.faceNormals[o];t.vmult(a,a)}}if(e)for(let o=0;o<n;o++){const a=i[o];a.vadd(e,a)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,o=new ie;this.getAveragePointLocal(o);for(let a=0;a<this.faces.length;a++){let c=i[a];const u=t[n[a][0]],d=new ie;e.vsub(u,d);const m=c.dot(d),g=new ie;o.vsub(u,g);const _=c.dot(g);if(m<0&&_>0||m>0&&_<0)return!1}return-1}static project(e,t,n,i,o){const a=e.vertices.length,c=CD;let u=0,d=0;const m=MD,g=e.vertices;m.setZero(),hr.vectorToLocalFrame(n,i,t,c),hr.pointToLocalFrame(n,i,m,m);const _=m.dot(c);d=u=g[0].dot(c);for(let w=1;w<a;w++){const x=g[w].dot(c);x>u&&(u=x),x<d&&(d=x)}if(d-=_,u-=_,d>u){const w=d;d=u,u=w}o[0]=u,o[1]=d}}const ZS=[],$S=[],CD=(new ie,new ie),MD=new ie;class l1 extends Mn{constructor(e){super({type:Mn.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=ie,o=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],a=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],c=new _v({vertices:o,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:a});this.convexPolyhedronRepresentation=c,c.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new ie),l1.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),t!==void 0)for(let o=0;o!==n.length;o++)t.vmult(n[o],n[o]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,o=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let a=0;a<o.length;a++)gm.set(o[a][0],o[a][1],o[a][2]),t.vmult(gm,gm),e.vadd(gm,gm),n(gm.x,gm.y,gm.z)}calculateWorldAABB(e,t,n,i){const o=this.halfExtents;md[0].set(o.x,o.y,o.z),md[1].set(-o.x,o.y,o.z),md[2].set(-o.x,-o.y,o.z),md[3].set(-o.x,-o.y,-o.z),md[4].set(o.x,-o.y,-o.z),md[5].set(o.x,o.y,-o.z),md[6].set(-o.x,o.y,-o.z),md[7].set(o.x,-o.y,o.z);const a=md[0];t.vmult(a,a),e.vadd(a,a),i.copy(a),n.copy(a);for(let c=1;c<8;c++){const u=md[c];t.vmult(u,u),e.vadd(u,u);const d=u.x,m=u.y,g=u.z;d>i.x&&(i.x=d),m>i.y&&(i.y=m),g>i.z&&(i.z=g),d<n.x&&(n.x=d),m<n.y&&(n.y=m),g<n.z&&(n.z=g)}}}const gm=new ie,md=[new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie];class Dn extends II{constructor(e){e===void 0&&(e={}),super(),this.id=Dn.idCounter++,this.index=-1,this.world=null,this.vlambda=new ie,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse!="boolean"||e.collisionResponse,this.position=new ie,this.previousPosition=new ie,this.interpolatedPosition=new ie,this.initPosition=new ie,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new ie,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new ie,this.force=new ie;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?Dn.STATIC:Dn.DYNAMIC,typeof e.type==typeof Dn.STATIC&&(this.type=e.type),this.allowSleep=e.allowSleep===void 0||e.allowSleep,this.sleepState=Dn.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==void 0?e.sleepSpeedLimit:.1,this.sleepTimeLimit=e.sleepTimeLimit!==void 0?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new ie,this.quaternion=new Rs,this.initQuaternion=new Rs,this.previousQuaternion=new Rs,this.interpolatedQuaternion=new Rs,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new ie,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new ie,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new ie,this.invInertia=new ie,this.invInertiaWorld=new Ku,this.invMassSolve=0,this.invInertiaSolve=new ie,this.invInertiaWorldSolve=new Ku,this.fixedRotation=e.fixedRotation!==void 0&&e.fixedRotation,this.angularDamping=e.angularDamping!==void 0?e.angularDamping:.01,this.linearFactor=new ie(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new ie(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new ms,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new ie,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=Dn.AWAKE,this.wakeUpAfterNarrowphase=!1,e===Dn.SLEEPING&&this.dispatchEvent(Dn.wakeupEvent)}sleep(){this.sleepState=Dn.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===Dn.AWAKE&&n<i?(this.sleepState=Dn.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(Dn.sleepyEvent)):t===Dn.SLEEPY&&n>i?this.wakeUp():t===Dn.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Dn.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Dn.SLEEPING||this.type===Dn.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new ie),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new ie),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new ie),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new ie),this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new ie,o=new Rs;return t&&i.copy(t),n&&o.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let o=0;o!==n;o++){const a=e[o];a.updateBoundingSphereRadius();const c=t[o].length(),u=a.boundingSphereRadius;c+u>i&&(i=c+u)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,o=TD,a=ID,c=this.quaternion,u=this.aabb,d=PD;for(let m=0;m!==i;m++){const g=e[m];c.vmult(t[m],o),o.vadd(this.position,o),c.mult(n[m],a),g.calculateWorldAABB(o,a,d.lowerBound,d.upperBound),m===0?u.copy(d):u.extend(d)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const n=RD,i=DD;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new ie),this.type!==Dn.DYNAMIC)return;this.sleepState===Dn.SLEEPING&&this.wakeUp();const n=BD;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new ie),this.type!==Dn.DYNAMIC)return;const n=OD,i=LD;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===Dn.DYNAMIC&&(this.sleepState===Dn.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new ie),this.type!==Dn.DYNAMIC)return;this.sleepState===Dn.SLEEPING&&this.wakeUp();const n=t,i=kD;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const o=UD;n.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new ie),this.type!==Dn.DYNAMIC)return;const n=ND,i=FD;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=jD;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l1.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new ie;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Dn.DYNAMIC&&this.type!==Dn.KINEMATIC||this.sleepState===Dn.SLEEPING)return;const i=this.velocity,o=this.angularVelocity,a=this.position,c=this.force,u=this.torque,d=this.quaternion,m=this.invMass,g=this.invInertiaWorld,_=this.linearFactor,w=m*e;i.x+=c.x*w*_.x,i.y+=c.y*w*_.y,i.z+=c.z*w*_.z;const x=g.elements,T=this.angularFactor,I=u.x*T.x,R=u.y*T.y,M=u.z*T.z;o.x+=e*(x[0]*I+x[1]*R+x[2]*M),o.y+=e*(x[3]*I+x[4]*R+x[5]*M),o.z+=e*(x[6]*I+x[7]*R+x[8]*M),a.x+=i.x*e,a.y+=i.y*e,a.z+=i.z*e,d.integrate(this.angularVelocity,e,this.angularFactor,d),t&&(n?d.normalizeFast():d.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Dn.idCounter=0,Dn.COLLIDE_EVENT_NAME="collide",Dn.DYNAMIC=1,Dn.STATIC=2,Dn.KINEMATIC=4,Dn.AWAKE=0,Dn.SLEEPY=1,Dn.SLEEPING=2,Dn.wakeupEvent={type:"wakeup"},Dn.sleepyEvent={type:"sleepy"},Dn.sleepEvent={type:"sleep"};const TD=new ie,ID=new Rs,PD=new ms,RD=new Ku,DD=new Ku,BD=(new Ku,new ie),OD=new ie,LD=new ie,kD=new ie,UD=new ie,ND=new ie,FD=new ie,jD=new ie;class zD{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return(e.collisionFilterGroup&t.collisionFilterMask)!=0&&(t.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&Dn.STATIC)==0&&e.sleepState!==Dn.SLEEPING||(t.type&Dn.STATIC)==0&&t.sleepState!==Dn.SLEEPING)}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const o=VD;t.position.vsub(e.position,o);const a=(e.boundingRadius+t.boundingRadius)**2;o.lengthSquared()<a&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=GD,i=HD,o=QD,a=e.length;for(let c=0;c!==a;c++)i[c]=e[c],o[c]=t[c];e.length=0,t.length=0;for(let c=0;c!==a;c++){const u=i[c].id,d=o[c].id,m=u<d?`${u},${d}`:`${d},${u}`;n[m]=c,n.keys.push(m)}for(let c=0;c!==n.keys.length;c++){const u=n.keys.pop(),d=n[u];e.push(i[d]),t.push(o[d]),delete n[u]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new ie;e.position.vsub(t.position,n);const i=e.shapes[0],o=t.shapes[0];return Math.pow(i.boundingSphereRadius+o.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const VD=new ie;new ie,new Rs,new ie;const GD={keys:[]},HD=[],QD=[];new ie,new ie,new ie;class WD extends zD{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,o=i.length;let a,c;for(let u=0;u!==o;u++)for(let d=0;d!==u;d++)a=i[u],c=i[d],this.needBroadphaseCollision(a,c)&&this.intersectionTest(a,c,t,n)}aabbQuery(e,t,n){n===void 0&&(n=[]);for(let i=0;i<e.bodies.length;i++){const o=e.bodies[i];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(t)&&n.push(o)}return n}}class c1{constructor(){this.rayFromWorld=new ie,this.rayToWorld=new ie,this.hitNormalWorld=new ie,this.hitPointWorld=new ie,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,o,a,c){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=o,this.body=a,this.distance=c}}let RI,DI,BI,OI,LI,kI,UI;RI=Mn.types.SPHERE,DI=Mn.types.PLANE,BI=Mn.types.BOX,OI=Mn.types.CYLINDER,LI=Mn.types.CONVEXPOLYHEDRON,kI=Mn.types.HEIGHTFIELD,UI=Mn.types.TRIMESH;class go{get[RI](){return this._intersectSphere}get[DI](){return this._intersectPlane}get[BI](){return this._intersectBox}get[OI](){return this._intersectConvex}get[LI](){return this._intersectConvex}get[kI](){return this._intersectHeightfield}get[UI](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ie),t===void 0&&(t=new ie),this.from=e.clone(),this.to=t.clone(),this.direction=new ie,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=go.ANY,this.result=new c1,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||go.ANY,this.result=t.result||new c1,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:-1,this.checkCollisionResponse=t.checkCollisionResponse===void 0||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(NI),eC.length=0,e.broadphase.aabbQuery(e,NI,eC),this.intersectBodies(eC),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const i=qD,o=XD;for(let a=0,c=e.shapes.length;a<c;a++){const u=e.shapes[a];if((!n||u.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[a],o),e.quaternion.vmult(e.shapeOffsets[a],i),i.vadd(e.position,i),this.intersectShape(u,o,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){if(function(c,u,d){d.vsub(c,yv);const m=yv.dot(u);return u.scale(m,h1),h1.vadd(c,h1),d.distanceTo(h1)}(this.from,this.direction,n)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,o)}_intersectPlane(e,t,n,i,o){const a=this.from,c=this.to,u=this.direction,d=new ie(0,0,1);t.vmult(d,d);const m=new ie;a.vsub(n,m);const g=m.dot(d);if(c.vsub(n,m),g*m.dot(d)>0||a.distanceTo(c)<g)return;const _=d.dot(u);if(Math.abs(_)<this.precision)return;const w=new ie,x=new ie,T=new ie;a.vsub(n,w);const I=-d.dot(w)/_;u.scale(I,x),a.vadd(x,T),this.reportIntersection(d,T,o,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,o=this.from;t.x=Math.min(i.x,o.x),t.y=Math.min(i.y,o.y),t.z=Math.min(i.z,o.z),n.x=Math.max(i.x,o.x),n.y=Math.max(i.y,o.y),n.z=Math.max(i.z,o.z)}_intersectHeightfield(e,t,n,i,o){e.data,e.elementSize;const a=YD;a.from.copy(this.from),a.to.copy(this.to),hr.pointToLocalFrame(n,t,a.from,a.from),hr.pointToLocalFrame(n,t,a.to,a.to),a.updateDirection();const c=KD;let u,d,m,g;u=d=0,m=g=e.data.length-1;const _=new ms;a.getAABB(_),e.getIndexOfPosition(_.lowerBound.x,_.lowerBound.y,c,!0),u=Math.max(u,c[0]),d=Math.max(d,c[1]),e.getIndexOfPosition(_.upperBound.x,_.upperBound.y,c,!0),m=Math.min(m,c[0]+1),g=Math.min(g,c[1]+1);for(let w=u;w<m;w++)for(let x=d;x<g;x++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(w,x,_),_.overlapsRay(a)){if(e.getConvexTrianglePillar(w,x,!1),hr.pointToWorldFrame(n,t,e.pillarOffset,u1),this._intersectConvex(e.pillarConvex,t,u1,i,o,FI),this.result.shouldStop)return;e.getConvexTrianglePillar(w,x,!0),hr.pointToWorldFrame(n,t,e.pillarOffset,u1),this._intersectConvex(e.pillarConvex,t,u1,i,o,FI)}}}_intersectSphere(e,t,n,i,o){const a=this.from,c=this.to,u=e.radius,d=(c.x-a.x)**2+(c.y-a.y)**2+(c.z-a.z)**2,m=2*((c.x-a.x)*(a.x-n.x)+(c.y-a.y)*(a.y-n.y)+(c.z-a.z)*(a.z-n.z)),g=m**2-4*d*((a.x-n.x)**2+(a.y-n.y)**2+(a.z-n.z)**2-u**2),_=JD,w=ZD;if(!(g<0))if(g===0)a.lerp(c,g,_),_.vsub(n,w),w.normalize(),this.reportIntersection(w,_,o,i,-1);else{const x=(-m-Math.sqrt(g))/(2*d),T=(-m+Math.sqrt(g))/(2*d);if(x>=0&&x<=1&&(a.lerp(c,x,_),_.vsub(n,w),w.normalize(),this.reportIntersection(w,_,o,i,-1)),this.result.shouldStop)return;T>=0&&T<=1&&(a.lerp(c,T,_),_.vsub(n,w),w.normalize(),this.reportIntersection(w,_,o,i,-1))}}_intersectConvex(e,t,n,i,o,a){const c=$D,u=jI,d=a&&a.faceList||null,m=e.faces,g=e.vertices,_=e.faceNormals,w=this.direction,x=this.from,T=this.to,I=x.distanceTo(T),R=d?d.length:m.length,M=this.result;for(let C=0;!M.shouldStop&&C<R;C++){const L=d?d[C]:C,k=m[L],j=_[L],H=t,X=n;u.copy(g[k[0]]),H.vmult(u,u),u.vadd(X,u),u.vsub(x,u),H.vmult(j,c);const ee=w.dot(c);if(Math.abs(ee)<this.precision)continue;const oe=c.dot(u)/ee;if(!(oe<0)){w.scale(oe,Zl),Zl.vadd(x,Zl),Ju.copy(g[k[0]]),H.vmult(Ju,Ju),X.vadd(Ju,Ju);for(let re=1;!M.shouldStop&&re<k.length-1;re++){gd.copy(g[k[re]]),vd.copy(g[k[re+1]]),H.vmult(gd,gd),H.vmult(vd,vd),X.vadd(gd,gd),X.vadd(vd,vd);const he=Zl.distanceTo(x);!go.pointInTriangle(Zl,Ju,gd,vd)&&!go.pointInTriangle(Zl,gd,Ju,vd)||he>I||this.reportIntersection(c,Zl,o,i,L)}}}}_intersectTrimesh(e,t,n,i,o,a){const c=eB,u=oB,d=aB,m=jI,g=tB,_=nB,w=iB,x=sB,T=rB,I=e.indices;e.vertices;const R=this.from,M=this.to,C=this.direction;d.position.copy(n),d.quaternion.copy(t),hr.vectorToLocalFrame(n,t,C,g),hr.pointToLocalFrame(n,t,R,_),hr.pointToLocalFrame(n,t,M,w),w.x*=e.scale.x,w.y*=e.scale.y,w.z*=e.scale.z,_.x*=e.scale.x,_.y*=e.scale.y,_.z*=e.scale.z,w.vsub(_,g),g.normalize();const L=_.distanceSquared(w);e.tree.rayQuery(this,d,u);for(let k=0,j=u.length;!this.result.shouldStop&&k!==j;k++){const H=u[k];e.getNormal(H,c),e.getVertex(I[3*H],Ju),Ju.vsub(_,m);const X=g.dot(c),ee=c.dot(m)/X;if(ee<0)continue;g.scale(ee,Zl),Zl.vadd(_,Zl),e.getVertex(I[3*H+1],gd),e.getVertex(I[3*H+2],vd);const oe=Zl.distanceSquared(_);!go.pointInTriangle(Zl,gd,Ju,vd)&&!go.pointInTriangle(Zl,Ju,gd,vd)||oe>L||(hr.vectorToWorldFrame(t,c,T),hr.pointToWorldFrame(n,t,Zl,x),this.reportIntersection(T,x,o,i,H))}u.length=0}reportIntersection(e,t,n,i,o){const a=this.from,c=this.to,u=a.distanceTo(t),d=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(d.hitFaceIndex=o!==void 0?o:-1,this.mode){case go.ALL:this.hasHit=!0,d.set(a,c,e,t,n,i,u),d.hasHit=!0,this.callback(d);break;case go.CLOSEST:(u<d.distance||!d.hasHit)&&(this.hasHit=!0,d.hasHit=!0,d.set(a,c,e,t,n,i,u));break;case go.ANY:this.hasHit=!0,d.hasHit=!0,d.set(a,c,e,t,n,i,u),d.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,yv),n.vsub(t,$A),e.vsub(t,tC);const o=yv.dot(yv),a=yv.dot($A),c=yv.dot(tC),u=$A.dot($A),d=$A.dot(tC);let m,g;return(m=u*c-a*d)>=0&&(g=o*d-a*c)>=0&&m+g<o*u-a*a}}go.CLOSEST=1,go.ANY=2,go.ALL=4;const NI=new ms,eC=[],$A=new ie,tC=new ie,qD=new ie,XD=new Rs,Zl=new ie,Ju=new ie,gd=new ie,vd=new ie;new ie,new c1;const FI={faceList:[0]},u1=new ie,YD=new go,KD=[],JD=new ie,ZD=new ie,$D=new ie,jI=(new ie,new ie,new ie),eB=new ie,tB=new ie,nB=new ie,iB=new ie,rB=new ie,sB=new ie;new ms;const oB=[],aB=new hr,yv=new ie,h1=new ie;class zI{static defaults(e,t){e===void 0&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class d1{constructor(e,t,n){n===void 0&&(n={}),n=zI.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=d1.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}d1.idCounter=0;class VI{constructor(){this.spatial=new ie,this.rotational=new ie}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class eb{constructor(e,t,n,i){n===void 0&&(n=-1e6),i===void 0&&(i=1e6),this.id=eb.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new VI,this.jacobianElementB=new VI,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,o=e,a=n;this.a=4/(a*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(a*a*o*(1+4*i))}computeB(e,t,n){const i=this.computeGW();return-this.computeGq()*e-i*t-this.computeGiMf()*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.position,a=i.position;return e.spatial.dot(o)+t.spatial.dot(a)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.velocity,a=i.velocity,c=n.angularVelocity,u=i.angularVelocity;return e.multiplyVectors(o,c)+t.multiplyVectors(a,u)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.vlambda,a=i.vlambda,c=n.wlambda,u=i.wlambda;return e.multiplyVectors(o,c)+t.multiplyVectors(a,u)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.force,a=n.torque,c=i.force,u=i.torque,d=n.invMassSolve,m=i.invMassSolve;return o.scale(d,GI),c.scale(m,HI),n.invInertiaWorldSolve.vmult(a,QI),i.invInertiaWorldSolve.vmult(u,WI),e.multiplyVectors(GI,QI)+t.multiplyVectors(HI,WI)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.invMassSolve,a=i.invMassSolve,c=n.invInertiaWorldSolve,u=i.invInertiaWorldSolve;let d=o+a;return c.vmult(e.rotational,p1),d+=p1.dot(e.rotational),u.vmult(t.rotational,p1),d+=p1.dot(t.rotational),d}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,o=this.bj,a=lB;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),o.vlambda.addScaledVector(o.invMassSolve*e,n.spatial,o.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,a),i.wlambda.addScaledVector(e,a,i.wlambda),o.invInertiaWorldSolve.vmult(n.rotational,a),o.wlambda.addScaledVector(e,a,o.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}eb.idCounter=0;const GI=new ie,HI=new ie,QI=new ie,WI=new ie,p1=new ie,lB=new ie;class f1 extends eb{constructor(e,t,n){n===void 0&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new ie,this.rj=new ie,this.ni=new ie}computeB(e){const t=this.a,n=this.b,i=this.bi,o=this.bj,a=this.ri,c=this.rj,u=cB,d=uB,m=i.velocity,g=i.angularVelocity;i.force,i.torque;const _=o.velocity,w=o.angularVelocity;o.force,o.torque;const x=hB,T=this.jacobianElementA,I=this.jacobianElementB,R=this.ni;a.cross(R,u),c.cross(R,d),R.negate(T.spatial),u.negate(T.rotational),I.spatial.copy(R),I.rotational.copy(d),x.copy(o.position),x.vadd(c,x),x.vsub(i.position,x),x.vsub(a,x);const M=R.dot(x),C=this.restitution+1;return-M*t-(C*_.dot(R)-C*m.dot(R)+w.dot(d)-g.dot(u))*n-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=dB,t=pB,n=fB,i=mB,o=gB;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,o),this.ni.dot(o)}}const cB=new ie,uB=new ie,hB=new ie,dB=new ie,pB=new ie,fB=new ie,mB=new ie,gB=new ie;class vB extends d1{constructor(e,t,n,i,o){t===void 0&&(t=new ie),i===void 0&&(i=new ie),o===void 0&&(o=1e6),super(e,n),this.pivotA=t.clone(),this.pivotB=i.clone();const a=this.equationX=new f1(e,n),c=this.equationY=new f1(e,n),u=this.equationZ=new f1(e,n);this.equations.push(a,c,u),a.minForce=c.minForce=u.minForce=-o,a.maxForce=c.maxForce=u.maxForce=o,a.ni.set(1,0,0),c.ni.set(0,1,0),u.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,n=this.equationX,i=this.equationY,o=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),o.ri.copy(n.ri),o.rj.copy(n.rj)}}new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie;class qI extends eb{constructor(e,t,n){super(e,t,-n,n),this.ri=new ie,this.rj=new ie,this.t=new ie}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,o=_B,a=yB,c=this.t;n.cross(c,o),i.cross(c,a);const u=this.jacobianElementA,d=this.jacobianElementB;return c.negate(u.spatial),o.negate(u.rotational),d.spatial.copy(c),d.rotational.copy(a),-this.computeGW()*t-e*this.computeGiMf()}}const _B=new ie,yB=new ie;class m1{constructor(e,t,n){n=zI.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=m1.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}m1.idCounter=0;class g1{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=g1.idCounter++,this.friction=e.friction!==void 0?e.friction:-1,this.restitution=e.restitution!==void 0?e.restitution:-1}}g1.idCounter=0,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new go,new ie,new ie,new ie,new ie(1,0,0),new ie(0,1,0),new ie(0,0,1),new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie;class XI extends Mn{constructor(e){if(super({type:Mn.types.SPHERE}),this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){t===void 0&&(t=new ie);const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const o=this.radius,a=["x","y","z"];for(let c=0;c<a.length;c++){const u=a[c];n[u]=e[u]-o,i[u]=e[u]+o}}}new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie;class AB extends _v{constructor(e,t,n,i){if(e===void 0&&(e=1),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const o=i,a=[],c=[],u=[],d=[],m=[],g=Math.cos,_=Math.sin;a.push(new ie(-t*_(0),.5*-n,t*g(0))),d.push(0),a.push(new ie(-e*_(0),.5*n,e*g(0))),m.push(1);for(let x=0;x<o;x++){const T=2*Math.PI/o*(x+1),I=2*Math.PI/o*(x+.5);x<o-1?(a.push(new ie(-t*_(T),.5*-n,t*g(T))),d.push(2*x+2),a.push(new ie(-e*_(T),.5*n,e*g(T))),m.push(2*x+3),u.push([2*x,2*x+1,2*x+3,2*x+2])):u.push([2*x,2*x+1,1,0]),(o%2==1||x<o/2)&&c.push(new ie(-_(I),0,g(I)))}u.push(d),c.push(new ie(0,1,0));const w=[];for(let x=0;x<m.length;x++)w.push(m[m.length-x-1]);u.push(w),super({vertices:a,faces:u,axes:c}),this.type=Mn.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=i}}class bB extends Mn{constructor(){super({type:Mn.types.PLANE}),this.worldNormal=new ie,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new ie),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,i){Op.set(0,0,1),t.vmult(Op,Op);const o=Number.MAX_VALUE;n.set(-o,-o,-o),i.set(o,o,o),Op.x===1?i.x=e.x:Op.x===-1&&(n.x=e.x),Op.y===1?i.y=e.y:Op.y===-1&&(n.y=e.y),Op.z===1?i.z=e.z:Op.z===-1&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const Op=new ie;new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie;class _d{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new ms,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,n){n===void 0&&(n=0);const i=this.data;if(!this.aabb.contains(e))return!1;const o=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let a=!1;o.length||(this.subdivide(),a=!0);for(let c=0;c!==8;c++)if(o[c].insert(e,t,n+1))return!0;a&&(o.length=0)}return i.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,n=e.upperBound,i=this.children;i.push(new _d({aabb:new ms({lowerBound:new ie(0,0,0)})}),new _d({aabb:new ms({lowerBound:new ie(1,0,0)})}),new _d({aabb:new ms({lowerBound:new ie(1,1,0)})}),new _d({aabb:new ms({lowerBound:new ie(1,1,1)})}),new _d({aabb:new ms({lowerBound:new ie(0,1,1)})}),new _d({aabb:new ms({lowerBound:new ie(0,0,1)})}),new _d({aabb:new ms({lowerBound:new ie(1,0,1)})}),new _d({aabb:new ms({lowerBound:new ie(0,1,0)})})),n.vsub(t,Av),Av.scale(.5,Av);const o=this.root||this;for(let a=0;a!==8;a++){const c=i[a];c.root=o;const u=c.aabb.lowerBound;u.x*=Av.x,u.y*=Av.y,u.z*=Av.z,u.vadd(t,u),u.vadd(Av,c.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t}rayQuery(e,t,n){return e.getAABB(v1),v1.toLocalFrame(t,v1),this.aabbQuery(v1,n),n}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class wB extends _d{constructor(e,t){t===void 0&&(t={}),super({root:null,aabb:e}),this.maxDepth=t.maxDepth!==void 0?t.maxDepth:8}}const Av=new ie,v1=new ms;class _1 extends Mn{constructor(e,t){super({type:Mn.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new ms,this.edges=null,this.scale=new ie(1,1,1),this.tree=new wB,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const n=new ms,i=new ie,o=new ie,a=new ie,c=[i,o,a];for(let u=0;u<this.indices.length/3;u++){const d=3*u;this._getUnscaledVertex(this.indices[d],i),this._getUnscaledVertex(this.indices[d+1],o),this._getUnscaledVertex(this.indices[d+2],a),n.setFromPoints(c),e.insert(n,u)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){y1.copy(e);const n=this.scale,i=n.x,o=n.y,a=n.z,c=y1.lowerBound,u=y1.upperBound;return c.x/=i,c.y/=o,c.z/=a,u.x/=i,u.y/=o,u.z/=a,this.tree.aabbQuery(y1,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=xB,t=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,o=this.indices[i],a=this.indices[i+1],c=this.indices[i+2];this.getVertex(o,JI),this.getVertex(a,ZI),this.getVertex(c,$I),_1.computeNormal(ZI,JI,$I,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}}updateEdges(){const e={},t=(i,o)=>{e[i<o?`${i}_${o}`:`${o}_${i}`]=!0};for(let i=0;i<this.indices.length/3;i++){const o=3*i,a=this.indices[o],c=this.indices[o+1],u=this.indices[o+2];t(a,c),t(c,u),t(u,a)}const n=Object.keys(e);this.edges=new Int16Array(2*n.length);for(let i=0;i<n.length;i++){const o=n[i].split("_");this.edges[2*i]=parseInt(o[0],10),this.edges[2*i+1]=parseInt(o[1],10)}}getEdgeVertex(e,t,n){const i=this.edges[2*e+(t?1:0)];this.getVertex(i,n)}getEdgeVector(e,t){const n=EB,i=SB;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)}static computeNormal(e,t,n,i){t.vsub(e,KI),n.vsub(t,YI),YI.cross(KI,i),i.isZero()||i.normalize()}getVertex(e,t){const n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){const n=3*e,i=this.vertices;return t.set(i[n],i[n+1],i[n+2])}getWorldVertex(e,t,n,i){return this.getVertex(e,i),hr.pointToWorldFrame(t,n,i,i),i}getTriangleVertices(e,t,n,i){const o=3*e;this.getVertex(this.indices[o],t),this.getVertex(this.indices[o+1],n),this.getVertex(this.indices[o+2],i)}getNormal(e,t){const n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(e,t){this.computeLocalAABB(bv);const n=bv.upperBound.x-bv.lowerBound.x,i=bv.upperBound.y-bv.lowerBound.y,o=bv.upperBound.z-bv.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*o*2*o),1/12*e*(2*n*2*n+2*o*2*o),1/12*e*(2*i*2*i+2*n*2*n))}computeLocalAABB(e){const t=e.lowerBound,n=e.upperBound,i=this.vertices.length;this.vertices;const o=CB;this.getVertex(0,o),t.copy(o),n.copy(o);for(let a=0;a!==i;a++)this.getVertex(a,o),o.x<t.x?t.x=o.x:o.x>n.x&&(n.x=o.x),o.y<t.y?t.y=o.y:o.y>n.y&&(n.y=o.y),o.z<t.z?t.z=o.z:o.z>n.z&&(n.z=o.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,n=new ie;for(let i=0,o=t.length/3;i!==o;i++){this.getVertex(i,n);const a=n.lengthSquared();a>e&&(e=a)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const o=MB,a=TB;o.position=e,o.quaternion=t,this.aabb.toWorldFrame(o,a),n.copy(a.lowerBound),i.copy(a.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,n,i,o){e===void 0&&(e=1),t===void 0&&(t=.5),n===void 0&&(n=8),i===void 0&&(i=6),o===void 0&&(o=2*Math.PI);const a=[],c=[];for(let u=0;u<=n;u++)for(let d=0;d<=i;d++){const m=d/i*o,g=u/n*Math.PI*2,_=(e+t*Math.cos(g))*Math.cos(m),w=(e+t*Math.cos(g))*Math.sin(m),x=t*Math.sin(g);a.push(_,w,x)}for(let u=1;u<=n;u++)for(let d=1;d<=i;d++){const m=(i+1)*u+d-1,g=(i+1)*(u-1)+d-1,_=(i+1)*(u-1)+d,w=(i+1)*u+d;c.push(m,g,w),c.push(g,_,w)}return new _1(a,c)}}const xB=new ie,y1=new ms,EB=new ie,SB=new ie,YI=new ie,KI=new ie,JI=new ie,ZI=new ie,$I=new ie,bv=new ms,CB=new ie,MB=new hr,TB=new ms;class IB{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class PB extends IB{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,o=this.tolerance*this.tolerance,a=this.equations,c=a.length,u=t.bodies,d=u.length,m=e;let g,_,w,x,T,I;if(c!==0)for(let L=0;L!==d;L++)u[L].updateSolveMassProperties();const R=DB,M=BB,C=RB;R.length=c,M.length=c,C.length=c;for(let L=0;L!==c;L++){const k=a[L];C[L]=0,M[L]=k.computeB(m),R[L]=1/k.computeC()}if(c!==0){for(let j=0;j!==d;j++){const H=u[j],X=H.vlambda,ee=H.wlambda;X.set(0,0,0),ee.set(0,0,0)}for(n=0;n!==i;n++){x=0;for(let j=0;j!==c;j++){const H=a[j];g=M[j],_=R[j],I=C[j],T=H.computeGWlambda(),w=_*(g-T-H.eps*I),I+w<H.minForce?w=H.minForce-I:I+w>H.maxForce&&(w=H.maxForce-I),C[j]+=w,x+=w>0?w:-w,H.addToWlambda(w)}if(x*x<o)break}for(let j=0;j!==d;j++){const H=u[j],X=H.velocity,ee=H.angularVelocity;H.vlambda.vmul(H.linearFactor,H.vlambda),X.vadd(H.vlambda,X),H.wlambda.vmul(H.angularFactor,H.wlambda),ee.vadd(H.wlambda,ee)}let L=a.length;const k=1/m;for(;L--;)a[L].multiplier=C[L]*k}return n}}const RB=[],DB=[],BB=[];Dn.STATIC;class OB{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class LB extends OB{constructor(){super(...arguments),this.type=ie}constructObject(){return new ie}}const kB=Mn.types.SPHERE,UB=Mn.types.SPHERE|Mn.types.PLANE,NB=Mn.types.BOX|Mn.types.BOX,FB=Mn.types.SPHERE|Mn.types.BOX,jB=Mn.types.PLANE|Mn.types.BOX,zB=Mn.types.CONVEXPOLYHEDRON,VB=Mn.types.SPHERE|Mn.types.CONVEXPOLYHEDRON,GB=Mn.types.PLANE|Mn.types.CONVEXPOLYHEDRON,HB=Mn.types.BOX|Mn.types.CONVEXPOLYHEDRON,QB=Mn.types.SPHERE|Mn.types.HEIGHTFIELD,WB=Mn.types.BOX|Mn.types.HEIGHTFIELD,qB=Mn.types.CONVEXPOLYHEDRON|Mn.types.HEIGHTFIELD,XB=Mn.types.PARTICLE|Mn.types.SPHERE,YB=Mn.types.PLANE|Mn.types.PARTICLE,KB=Mn.types.BOX|Mn.types.PARTICLE,JB=Mn.types.PARTICLE|Mn.types.CONVEXPOLYHEDRON,ZB=Mn.types.CYLINDER,$B=Mn.types.SPHERE|Mn.types.CYLINDER,eO=Mn.types.PLANE|Mn.types.CYLINDER,tO=Mn.types.BOX|Mn.types.CYLINDER,nO=Mn.types.CONVEXPOLYHEDRON|Mn.types.CYLINDER,iO=Mn.types.HEIGHTFIELD|Mn.types.CYLINDER,rO=Mn.types.PARTICLE|Mn.types.CYLINDER,sO=Mn.types.SPHERE|Mn.types.TRIMESH,oO=Mn.types.PLANE|Mn.types.TRIMESH;class aO{get[kB](){return this.sphereSphere}get[UB](){return this.spherePlane}get[NB](){return this.boxBox}get[FB](){return this.sphereBox}get[jB](){return this.planeBox}get[zB](){return this.convexConvex}get[VB](){return this.sphereConvex}get[GB](){return this.planeConvex}get[HB](){return this.boxConvex}get[QB](){return this.sphereHeightfield}get[WB](){return this.boxHeightfield}get[qB](){return this.convexHeightfield}get[XB](){return this.sphereParticle}get[YB](){return this.planeParticle}get[KB](){return this.boxParticle}get[JB](){return this.convexParticle}get[ZB](){return this.convexConvex}get[$B](){return this.sphereConvex}get[eO](){return this.planeConvex}get[tO](){return this.boxConvex}get[nO](){return this.convexConvex}get[iO](){return this.heightfieldCylinder}get[rO](){return this.particleCylinder}get[sO](){return this.sphereTrimesh}get[oO](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new LB,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,o,a){let c;this.contactPointPool.length?(c=this.contactPointPool.pop(),c.bi=e,c.bj=t):c=new f1(e,t),c.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const u=this.currentContactMaterial;c.restitution=u.restitution,c.setSpookParams(u.contactEquationStiffness,u.contactEquationRelaxation,this.world.dt);const d=n.material||e.material,m=i.material||t.material;return d&&m&&d.restitution>=0&&m.restitution>=0&&(c.restitution=d.restitution*m.restitution),c.si=o||n,c.sj=a||i,c}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,o=e.si,a=e.sj,c=this.world,u=this.currentContactMaterial;let d=u.friction;const m=o.material||n.material,g=a.material||i.material;if(m&&g&&m.friction>=0&&g.friction>=0&&(d=m.friction*g.friction),d>0){const _=d*c.gravity.length();let w=n.invMass+i.invMass;w>0&&(w=1/w);const x=this.frictionEquationPool,T=x.length?x.pop():new qI(n,i,_*w),I=x.length?x.pop():new qI(n,i,_*w);return T.bi=I.bi=n,T.bj=I.bj=i,T.minForce=I.minForce=-_*w,T.maxForce=I.maxForce=_*w,T.ri.copy(e.ri),T.rj.copy(e.rj),I.ri.copy(e.ri),I.rj.copy(e.rj),e.ni.tangents(T.t,I.t),T.setSpookParams(u.frictionEquationStiffness,u.frictionEquationRelaxation,c.dt),I.setSpookParams(u.frictionEquationStiffness,u.frictionEquationRelaxation,c.dt),T.enabled=I.enabled=e.enabled,t.push(T,I),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];wv.setZero(),_0.setZero(),y0.setZero();const o=t.bi;t.bj;for(let c=0;c!==e;c++)t=this.result[this.result.length-1-c],t.bi!==o?(wv.vadd(t.ni,wv),_0.vadd(t.ri,_0),y0.vadd(t.rj,y0)):(wv.vsub(t.ni,wv),_0.vadd(t.rj,_0),y0.vadd(t.ri,y0));const a=1/e;_0.scale(a,n.ri),y0.scale(a,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),wv.normalize(),wv.tangents(n.t,i.t)}getContacts(e,t,n,i,o,a,c){this.contactPointPool=o,this.frictionEquationPool=c,this.result=i,this.frictionResult=a;const u=uO,d=hO,m=lO,g=cO;for(let _=0,w=e.length;_!==w;_++){const x=e[_],T=t[_];let I=null;x.material&&T.material&&(I=n.getContactMaterial(x.material,T.material)||null);const R=x.type&Dn.KINEMATIC&&T.type&Dn.STATIC||x.type&Dn.STATIC&&T.type&Dn.KINEMATIC||x.type&Dn.KINEMATIC&&T.type&Dn.KINEMATIC;for(let M=0;M<x.shapes.length;M++){x.quaternion.mult(x.shapeOrientations[M],u),x.quaternion.vmult(x.shapeOffsets[M],m),m.vadd(x.position,m);const C=x.shapes[M];for(let L=0;L<T.shapes.length;L++){T.quaternion.mult(T.shapeOrientations[L],d),T.quaternion.vmult(T.shapeOffsets[L],g),g.vadd(T.position,g);const k=T.shapes[L];if(!(C.collisionFilterMask&k.collisionFilterGroup&&k.collisionFilterMask&C.collisionFilterGroup)||m.distanceTo(g)>C.boundingSphereRadius+k.boundingSphereRadius)continue;let j=null;C.material&&k.material&&(j=n.getContactMaterial(C.material,k.material)||null),this.currentContactMaterial=j||I||n.defaultContactMaterial;const H=this[C.type|k.type];if(H){let X=!1;X=C.type<k.type?H.call(this,C,k,m,g,u,d,x,T,C,k,R):H.call(this,k,C,g,m,d,u,T,x,C,k,R),X&&R&&(n.shapeOverlapKeeper.set(C.id,k.id),n.bodyOverlapKeeper.set(x.id,T.id))}}}}}sphereSphere(e,t,n,i,o,a,c,u,d,m,g){if(g)return n.distanceSquared(i)<(e.radius+t.radius)**2;const _=this.createContactEquation(c,u,e,t,d,m);i.vsub(n,_.ni),_.ni.normalize(),_.ri.copy(_.ni),_.rj.copy(_.ni),_.ri.scale(e.radius,_.ri),_.rj.scale(-t.radius,_.rj),_.ri.vadd(n,_.ri),_.ri.vsub(c.position,_.ri),_.rj.vadd(i,_.rj),_.rj.vsub(u.position,_.rj),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}spherePlane(e,t,n,i,o,a,c,u,d,m,g){const _=this.createContactEquation(c,u,e,t,d,m);if(_.ni.set(0,0,1),a.vmult(_.ni,_.ni),_.ni.negate(_.ni),_.ni.normalize(),_.ni.scale(e.radius,_.ri),n.vsub(i,A1),_.ni.scale(_.ni.dot(A1),eP),A1.vsub(eP,_.rj),-A1.dot(_.ni)<=e.radius){if(g)return!0;const w=_.ri,x=_.rj;w.vadd(n,w),w.vsub(c.position,w),x.vadd(i,x),x.vsub(u.position,x),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}}boxBox(e,t,n,i,o,a,c,u,d,m,g){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,o,a,c,u,e,t,g)}sphereBox(e,t,n,i,o,a,c,u,d,m,g){const _=this.v3pool,w=UO;n.vsub(i,b1),t.getSideNormals(w,a);const x=e.radius;let T=!1;const I=FO,R=jO,M=zO;let C=null,L=0,k=0,j=0,H=null;for(let _e=0,Ee=w.length;_e!==Ee&&T===!1;_e++){const Ye=OO;Ye.copy(w[_e]);const We=Ye.length();Ye.normalize();const Et=b1.dot(Ye);if(Et<We+x&&Et>0){const lt=LO,rt=kO;lt.copy(w[(_e+1)%3]),rt.copy(w[(_e+2)%3]);const kt=lt.length(),Pt=rt.length();lt.normalize(),rt.normalize();const sn=b1.dot(lt),hn=b1.dot(rt);if(sn<kt&&sn>-kt&&hn<Pt&&hn>-Pt){const wn=Math.abs(Et-We-x);if((H===null||wn<H)&&(H=wn,k=sn,j=hn,C=We,I.copy(Ye),R.copy(lt),M.copy(rt),L++,g))return!0}}}if(L){T=!0;const _e=this.createContactEquation(c,u,e,t,d,m);I.scale(-x,_e.ri),_e.ni.copy(I),_e.ni.negate(_e.ni),I.scale(C,I),R.scale(k,R),I.vadd(R,I),M.scale(j,M),I.vadd(M,_e.rj),_e.ri.vadd(n,_e.ri),_e.ri.vsub(c.position,_e.ri),_e.rj.vadd(i,_e.rj),_e.rj.vsub(u.position,_e.rj),this.result.push(_e),this.createFrictionEquationsFromContact(_e,this.frictionResult)}let X=_.get();const ee=NO;for(let _e=0;_e!==2&&!T;_e++)for(let Ee=0;Ee!==2&&!T;Ee++)for(let Ye=0;Ye!==2&&!T;Ye++)if(X.set(0,0,0),_e?X.vadd(w[0],X):X.vsub(w[0],X),Ee?X.vadd(w[1],X):X.vsub(w[1],X),Ye?X.vadd(w[2],X):X.vsub(w[2],X),i.vadd(X,ee),ee.vsub(n,ee),ee.lengthSquared()<x*x){if(g)return!0;T=!0;const We=this.createContactEquation(c,u,e,t,d,m);We.ri.copy(ee),We.ri.normalize(),We.ni.copy(We.ri),We.ri.scale(x,We.ri),We.rj.copy(X),We.ri.vadd(n,We.ri),We.ri.vsub(c.position,We.ri),We.rj.vadd(i,We.rj),We.rj.vsub(u.position,We.rj),this.result.push(We),this.createFrictionEquationsFromContact(We,this.frictionResult)}_.release(X),X=null;const oe=_.get(),re=_.get(),he=_.get(),le=_.get(),ue=_.get(),ge=w.length;for(let _e=0;_e!==ge&&!T;_e++)for(let Ee=0;Ee!==ge&&!T;Ee++)if(_e%3!=Ee%3){w[Ee].cross(w[_e],oe),oe.normalize(),w[_e].vadd(w[Ee],re),he.copy(n),he.vsub(re,he),he.vsub(i,he);const Ye=he.dot(oe);oe.scale(Ye,le);let We=0;for(;We===_e%3||We===Ee%3;)We++;ue.copy(n),ue.vsub(le,ue),ue.vsub(re,ue),ue.vsub(i,ue);const Et=Math.abs(Ye),lt=ue.length();if(Et<w[We].length()&&lt<x){if(g)return!0;T=!0;const rt=this.createContactEquation(c,u,e,t,d,m);re.vadd(le,rt.rj),rt.rj.copy(rt.rj),ue.negate(rt.ni),rt.ni.normalize(),rt.ri.copy(rt.rj),rt.ri.vadd(i,rt.ri),rt.ri.vsub(n,rt.ri),rt.ri.normalize(),rt.ri.scale(x,rt.ri),rt.ri.vadd(n,rt.ri),rt.ri.vsub(c.position,rt.ri),rt.rj.vadd(i,rt.rj),rt.rj.vsub(u.position,rt.rj),this.result.push(rt),this.createFrictionEquationsFromContact(rt,this.frictionResult)}}_.release(oe,re,he,le,ue)}planeBox(e,t,n,i,o,a,c,u,d,m,g){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,o,a,c,u,e,t,g)}convexConvex(e,t,n,i,o,a,c,u,d,m,g,_,w){const x=nL;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,o,i,a,x,_,w)){const T=[],I=iL;e.clipAgainstHull(n,o,t,i,a,x,-100,100,T);let R=0;for(let M=0;M!==T.length;M++){if(g)return!0;const C=this.createContactEquation(c,u,e,t,d,m),L=C.ri,k=C.rj;x.negate(C.ni),T[M].normal.negate(I),I.scale(T[M].depth,I),T[M].point.vadd(I,L),k.copy(T[M].point),L.vsub(n,L),k.vsub(i,k),L.vadd(n,L),L.vsub(c.position,L),k.vadd(i,k),k.vsub(u.position,k),this.result.push(C),R++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(C,this.frictionResult)}this.enableFrictionReduction&&R&&this.createFrictionFromAverage(R)}}sphereConvex(e,t,n,i,o,a,c,u,d,m,g){const _=this.v3pool;n.vsub(i,VO);const w=t.faceNormals,x=t.faces,T=t.vertices,I=e.radius;let R=!1;for(let M=0;M!==T.length;M++){const C=T[M],L=WO;a.vmult(C,L),i.vadd(L,L);const k=QO;if(L.vsub(n,k),k.lengthSquared()<I*I){if(g)return!0;R=!0;const j=this.createContactEquation(c,u,e,t,d,m);return j.ri.copy(k),j.ri.normalize(),j.ni.copy(j.ri),j.ri.scale(I,j.ri),L.vsub(i,j.rj),j.ri.vadd(n,j.ri),j.ri.vsub(c.position,j.ri),j.rj.vadd(i,j.rj),j.rj.vsub(u.position,j.rj),this.result.push(j),void this.createFrictionEquationsFromContact(j,this.frictionResult)}}for(let M=0,C=x.length;M!==C&&R===!1;M++){const L=w[M],k=x[M],j=qO;a.vmult(L,j);const H=XO;a.vmult(T[k[0]],H),H.vadd(i,H);const X=YO;j.scale(-I,X),n.vadd(X,X);const ee=KO;X.vsub(H,ee);const oe=ee.dot(j),re=JO;if(n.vsub(H,re),oe<0&&re.dot(j)>0){const he=[];for(let le=0,ue=k.length;le!==ue;le++){const ge=_.get();a.vmult(T[k[le]],ge),i.vadd(ge,ge),he.push(ge)}if(BO(he,j,n)){if(g)return!0;R=!0;const le=this.createContactEquation(c,u,e,t,d,m);j.scale(-I,le.ri),j.negate(le.ni);const ue=_.get();j.scale(-oe,ue);const ge=_.get();j.scale(-I,ge),n.vsub(i,le.rj),le.rj.vadd(ge,le.rj),le.rj.vadd(ue,le.rj),le.rj.vadd(i,le.rj),le.rj.vsub(u.position,le.rj),le.ri.vadd(n,le.ri),le.ri.vsub(c.position,le.ri),_.release(ue),_.release(ge),this.result.push(le),this.createFrictionEquationsFromContact(le,this.frictionResult);for(let _e=0,Ee=he.length;_e!==Ee;_e++)_.release(he[_e]);return}for(let le=0;le!==k.length;le++){const ue=_.get(),ge=_.get();a.vmult(T[k[(le+1)%k.length]],ue),a.vmult(T[k[(le+2)%k.length]],ge),i.vadd(ue,ue),i.vadd(ge,ge);const _e=GO;ge.vsub(ue,_e);const Ee=HO;_e.unit(Ee);const Ye=_.get(),We=_.get();n.vsub(ue,We);const Et=We.dot(Ee);Ee.scale(Et,Ye),Ye.vadd(ue,Ye);const lt=_.get();if(Ye.vsub(n,lt),Et>0&&Et*Et<_e.lengthSquared()&&lt.lengthSquared()<I*I){if(g)return!0;const rt=this.createContactEquation(c,u,e,t,d,m);Ye.vsub(i,rt.rj),Ye.vsub(n,rt.ni),rt.ni.normalize(),rt.ni.scale(I,rt.ri),rt.rj.vadd(i,rt.rj),rt.rj.vsub(u.position,rt.rj),rt.ri.vadd(n,rt.ri),rt.ri.vsub(c.position,rt.ri),this.result.push(rt),this.createFrictionEquationsFromContact(rt,this.frictionResult);for(let kt=0,Pt=he.length;kt!==Pt;kt++)_.release(he[kt]);return _.release(ue),_.release(ge),_.release(Ye),_.release(lt),void _.release(We)}_.release(ue),_.release(ge),_.release(Ye),_.release(lt),_.release(We)}for(let le=0,ue=he.length;le!==ue;le++)_.release(he[le])}}}planeConvex(e,t,n,i,o,a,c,u,d,m,g){const _=ZO,w=$O;w.set(0,0,1),o.vmult(w,w);let x=0;const T=eL;for(let I=0;I!==t.vertices.length;I++)if(_.copy(t.vertices[I]),a.vmult(_,_),i.vadd(_,_),_.vsub(n,T),w.dot(T)<=0){if(g)return!0;const R=this.createContactEquation(c,u,e,t,d,m),M=tL;w.scale(w.dot(T),M),_.vsub(M,M),M.vsub(n,R.ri),R.ni.copy(w),_.vsub(i,R.rj),R.ri.vadd(n,R.ri),R.ri.vsub(c.position,R.ri),R.rj.vadd(i,R.rj),R.rj.vsub(u.position,R.rj),this.result.push(R),x++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(R,this.frictionResult)}this.enableFrictionReduction&&x&&this.createFrictionFromAverage(x)}boxConvex(e,t,n,i,o,a,c,u,d,m,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,o,a,c,u,e,t,g)}sphereHeightfield(e,t,n,i,o,a,c,u,d,m,g){const _=t.data,w=e.radius,x=t.elementSize,T=mL,I=fL;hr.pointToLocalFrame(i,a,n,I);let R=Math.floor((I.x-w)/x)-1,M=Math.ceil((I.x+w)/x)+1,C=Math.floor((I.y-w)/x)-1,L=Math.ceil((I.y+w)/x)+1;if(M<0||L<0||R>_.length||C>_[0].length)return;R<0&&(R=0),M<0&&(M=0),C<0&&(C=0),L<0&&(L=0),R>=_.length&&(R=_.length-1),M>=_.length&&(M=_.length-1),L>=_[0].length&&(L=_[0].length-1),C>=_[0].length&&(C=_[0].length-1);const k=[];t.getRectMinMax(R,C,M,L,k);const j=k[0],H=k[1];if(I.z-w>H||I.z+w<j)return;const X=this.result;for(let ee=R;ee<M;ee++)for(let oe=C;oe<L;oe++){const re=X.length;let he=!1;if(t.getConvexTrianglePillar(ee,oe,!1),hr.pointToWorldFrame(i,a,t.pillarOffset,T),n.distanceTo(T)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(he=this.sphereConvex(e,t.pillarConvex,n,T,o,a,c,u,e,t,g)),g&&he||(t.getConvexTrianglePillar(ee,oe,!0),hr.pointToWorldFrame(i,a,t.pillarOffset,T),n.distanceTo(T)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(he=this.sphereConvex(e,t.pillarConvex,n,T,o,a,c,u,e,t,g)),g&&he))return!0;if(X.length-re>2)return}}boxHeightfield(e,t,n,i,o,a,c,u,d,m,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,o,a,c,u,e,t,g)}convexHeightfield(e,t,n,i,o,a,c,u,d,m,g){const _=t.data,w=t.elementSize,x=e.boundingSphereRadius,T=dL,I=pL,R=hL;hr.pointToLocalFrame(i,a,n,R);let M=Math.floor((R.x-x)/w)-1,C=Math.ceil((R.x+x)/w)+1,L=Math.floor((R.y-x)/w)-1,k=Math.ceil((R.y+x)/w)+1;if(C<0||k<0||M>_.length||L>_[0].length)return;M<0&&(M=0),C<0&&(C=0),L<0&&(L=0),k<0&&(k=0),M>=_.length&&(M=_.length-1),C>=_.length&&(C=_.length-1),k>=_[0].length&&(k=_[0].length-1),L>=_[0].length&&(L=_[0].length-1);const j=[];t.getRectMinMax(M,L,C,k,j);const H=j[0],X=j[1];if(!(R.z-x>X||R.z+x<H))for(let ee=M;ee<C;ee++)for(let oe=L;oe<k;oe++){let re=!1;if(t.getConvexTrianglePillar(ee,oe,!1),hr.pointToWorldFrame(i,a,t.pillarOffset,T),n.distanceTo(T)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(re=this.convexConvex(e,t.pillarConvex,n,T,o,a,c,u,null,null,g,I,null)),g&&re||(t.getConvexTrianglePillar(ee,oe,!0),hr.pointToWorldFrame(i,a,t.pillarOffset,T),n.distanceTo(T)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(re=this.convexConvex(e,t.pillarConvex,n,T,o,a,c,u,null,null,g,I,null)),g&&re))return!0}}sphereParticle(e,t,n,i,o,a,c,u,d,m,g){const _=aL;if(_.set(0,0,1),i.vsub(n,_),_.lengthSquared()<=e.radius*e.radius){if(g)return!0;const w=this.createContactEquation(u,c,t,e,d,m);_.normalize(),w.rj.copy(_),w.rj.scale(e.radius,w.rj),w.ni.copy(_),w.ni.negate(w.ni),w.ri.set(0,0,0),this.result.push(w),this.createFrictionEquationsFromContact(w,this.frictionResult)}}planeParticle(e,t,n,i,o,a,c,u,d,m,g){const _=rL;_.set(0,0,1),c.quaternion.vmult(_,_);const w=sL;if(i.vsub(c.position,w),_.dot(w)<=0){if(g)return!0;const x=this.createContactEquation(u,c,t,e,d,m);x.ni.copy(_),x.ni.negate(x.ni),x.ri.set(0,0,0);const T=oL;_.scale(_.dot(i),T),i.vsub(T,T),x.rj.copy(T),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}}boxParticle(e,t,n,i,o,a,c,u,d,m,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,o,a,c,u,e,t,g)}convexParticle(e,t,n,i,o,a,c,u,d,m,g){let _=-1;const w=cL,x=uL;let T=null;const I=lL;if(I.copy(i),I.vsub(n,I),o.conjugate(tP),tP.vmult(I,I),e.pointIsInside(I)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,o),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(o);for(let R=0,M=e.faces.length;R!==M;R++){const C=[e.worldVertices[e.faces[R][0]]],L=e.worldFaceNormals[R];i.vsub(C[0],nP);const k=-L.dot(nP);if(T===null||Math.abs(k)<Math.abs(T)){if(g)return!0;T=k,_=R,w.copy(L)}}if(_!==-1){const R=this.createContactEquation(u,c,t,e,d,m);w.scale(T,x),x.vadd(i,x),x.vsub(n,x),R.rj.copy(x),w.negate(R.ni),R.ri.set(0,0,0);const M=R.ri,C=R.rj;M.vadd(i,M),M.vsub(u.position,M),C.vadd(n,C),C.vsub(c.position,C),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,o,a,c,u,d,m,g){return this.convexHeightfield(t,e,i,n,a,o,u,c,d,m,g)}particleCylinder(e,t,n,i,o,a,c,u,d,m,g){return this.convexParticle(t,e,i,n,a,o,u,c,d,m,g)}sphereTrimesh(e,t,n,i,o,a,c,u,d,m,g){const _=yO,w=AO,x=bO,T=wO,I=xO,R=EO,M=TO,C=_O,L=gO,k=IO;hr.pointToLocalFrame(i,a,n,I);const j=e.radius;M.lowerBound.set(I.x-j,I.y-j,I.z-j),M.upperBound.set(I.x+j,I.y+j,I.z+j),t.getTrianglesInAABB(M,k);const H=vO,X=e.radius*e.radius;for(let le=0;le<k.length;le++)for(let ue=0;ue<3;ue++)if(t.getVertex(t.indices[3*k[le]+ue],H),H.vsub(I,L),L.lengthSquared()<=X){if(C.copy(H),hr.pointToWorldFrame(i,a,C,H),H.vsub(n,L),g)return!0;let ge=this.createContactEquation(c,u,e,t,d,m);ge.ni.copy(L),ge.ni.normalize(),ge.ri.copy(ge.ni),ge.ri.scale(e.radius,ge.ri),ge.ri.vadd(n,ge.ri),ge.ri.vsub(c.position,ge.ri),ge.rj.copy(H),ge.rj.vsub(u.position,ge.rj),this.result.push(ge),this.createFrictionEquationsFromContact(ge,this.frictionResult)}for(let le=0;le<k.length;le++)for(let ue=0;ue<3;ue++){t.getVertex(t.indices[3*k[le]+ue],_),t.getVertex(t.indices[3*k[le]+(ue+1)%3],w),w.vsub(_,x),I.vsub(w,R);const ge=R.dot(x);I.vsub(_,R);let _e=R.dot(x);if(_e>0&&ge<0&&(I.vsub(_,R),T.copy(x),T.normalize(),_e=R.dot(T),T.scale(_e,R),R.vadd(_,R),R.distanceTo(I)<e.radius)){if(g)return!0;const Ee=this.createContactEquation(c,u,e,t,d,m);R.vsub(I,Ee.ni),Ee.ni.normalize(),Ee.ni.scale(e.radius,Ee.ri),Ee.ri.vadd(n,Ee.ri),Ee.ri.vsub(c.position,Ee.ri),hr.pointToWorldFrame(i,a,R,R),R.vsub(u.position,Ee.rj),hr.vectorToWorldFrame(a,Ee.ni,Ee.ni),hr.vectorToWorldFrame(a,Ee.ri,Ee.ri),this.result.push(Ee),this.createFrictionEquationsFromContact(Ee,this.frictionResult)}}const ee=SO,oe=CO,re=MO,he=mO;for(let le=0,ue=k.length;le!==ue;le++){t.getTriangleVertices(k[le],ee,oe,re),t.getNormal(k[le],he),I.vsub(ee,R);let ge=R.dot(he);if(he.scale(ge,R),I.vsub(R,R),ge=R.distanceTo(I),go.pointInTriangle(R,ee,oe,re)&&ge<e.radius){if(g)return!0;let _e=this.createContactEquation(c,u,e,t,d,m);R.vsub(I,_e.ni),_e.ni.normalize(),_e.ni.scale(e.radius,_e.ri),_e.ri.vadd(n,_e.ri),_e.ri.vsub(c.position,_e.ri),hr.pointToWorldFrame(i,a,R,R),R.vsub(u.position,_e.rj),hr.vectorToWorldFrame(a,_e.ni,_e.ni),hr.vectorToWorldFrame(a,_e.ri,_e.ri),this.result.push(_e),this.createFrictionEquationsFromContact(_e,this.frictionResult)}}k.length=0}planeTrimesh(e,t,n,i,o,a,c,u,d,m,g){const _=new ie,w=dO;w.set(0,0,1),o.vmult(w,w);for(let x=0;x<t.vertices.length/3;x++){t.getVertex(x,_);const T=new ie;T.copy(_),hr.pointToWorldFrame(i,a,T,_);const I=pO;if(_.vsub(n,I),w.dot(I)<=0){if(g)return!0;const R=this.createContactEquation(c,u,e,t,d,m);R.ni.copy(w);const M=fO;w.scale(I.dot(w),M),_.vsub(M,M),R.ri.copy(M),R.ri.vsub(c.position,R.ri),R.rj.copy(_),R.rj.vsub(u.position,R.rj),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}}}}const wv=new ie,_0=new ie,y0=new ie,lO=new ie,cO=new ie,uO=new Rs,hO=new Rs,dO=new ie,pO=new ie,fO=new ie,mO=new ie,gO=new ie;new ie;const vO=new ie,_O=new ie,yO=new ie,AO=new ie,bO=new ie,wO=new ie,xO=new ie,EO=new ie,SO=new ie,CO=new ie,MO=new ie,TO=new ms,IO=[],A1=new ie,eP=new ie,PO=new ie,RO=new ie,DO=new ie;function BO(s,e,t){let n=null;const i=s.length;for(let o=0;o!==i;o++){const a=s[o],c=PO;s[(o+1)%i].vsub(a,c);const u=RO;c.cross(e,u);const d=DO;t.vsub(a,d);const m=u.dot(d);if(!(n===null||m>0&&n===!0||m<=0&&n===!1))return!1;n===null&&(n=m>0)}return!0}const b1=new ie,OO=new ie,LO=new ie,kO=new ie,UO=[new ie,new ie,new ie,new ie,new ie,new ie],NO=new ie,FO=new ie,jO=new ie,zO=new ie,VO=new ie,GO=new ie,HO=new ie,QO=new ie,WO=new ie,qO=new ie,XO=new ie,YO=new ie,KO=new ie,JO=new ie;new ie,new ie;const ZO=new ie,$O=new ie,eL=new ie,tL=new ie,nL=new ie,iL=new ie,rL=new ie,sL=new ie,oL=new ie,aL=new ie,tP=new Rs,lL=new ie;new ie;const cL=new ie,nP=new ie,uL=new ie,hL=new ie,dL=new ie,pL=[0],fL=new ie,mL=new ie;class iP{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let o=0;for(;n>i[o];)o++;if(n!==i[o]){for(let a=i.length-1;a>=o;a--)i[a+1]=i[a];i[o]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,o=n.length,a=i.length;let c=0;for(let u=0;u<o;u++){let d=!1;const m=n[u];for(;m>i[c];)c++;d=m===i[c],d||rP(e,m)}c=0;for(let u=0;u<a;u++){let d=!1;const m=i[u];for(;m>n[c];)c++;d=n[c]===m,d||rP(t,m)}}}function rP(s,e){s.push((4294901760&e)>>16,65535&e)}const nC=(s,e)=>s<e?`${s}-${e}`:`${e}-${s}`;class gL{constructor(){this.data={keys:[]}}get(e,t){const n=nC(e,t);return this.data[n]}set(e,t,n){const i=nC(e,t);this.get(e,t)||this.data.keys.push(i),this.data[i]=n}delete(e,t){const n=nC(e,t),i=this.data.keys.indexOf(n);i!==-1&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;)delete e[t.pop()]}}class vL extends II{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new ie,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new WD,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new PB,this.constraints=[],this.narrowphase=new aO(this),this.collisionMatrix=new TI,this.collisionMatrixPrevious=new TI,this.bodyOverlapKeeper=new iP,this.shapeOverlapKeeper=new iP,this.contactmaterials=[],this.contactMaterialTable=new gL,this.defaultMaterial=new g1("default"),this.defaultContactMaterial=new m1(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof c1?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,i){return n===void 0&&(n={}),n.mode=go.ALL,n.from=e,n.to=t,n.callback=i,iC.intersectWorld(this,n)}raycastAny(e,t,n,i){return n===void 0&&(n={}),n.mode=go.ANY,n.from=e,n.to=t,n.result=i,iC.intersectWorld(this,n)}raycastClosest(e,t,n,i){return n===void 0&&(n={}),n.mode=go.CLOSEST,n.from=e,n.to=t,n.result=i,iC.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof Dn&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(i!==-1){n.splice(i,1);for(let o=0;o!==n.length;o++)n[o].index=o;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let o=0;o<i.length;o++){const a=i[o];if(a.id===e)return a}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const n=Oo.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(e,i,t)}else this.step(e,void 0,t);this.lastCallTime=n}step(e,t,n){if(n===void 0&&(n=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=Oo.now();let o=0;for(;this.accumulator>=e&&o<n&&(this.internalStep(e),this.accumulator-=e,o++,!(Oo.now()-i>1e3*e)););this.accumulator=this.accumulator%e;const a=this.accumulator/e;for(let c=0;c!==this.bodies.length;c++){const u=this.bodies[c];u.previousPosition.lerp(u.position,a,u.interpolatedPosition),u.previousQuaternion.slerp(u.quaternion,a,u.interpolatedQuaternion),u.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=wL,i=xL,o=this.bodies.length,a=this.bodies,c=this.solver,u=this.gravity,d=this.doProfiling,m=this.profile,g=Dn.DYNAMIC;let _=-1/0;const w=this.constraints,x=bL;u.length();const T=u.x,I=u.y,R=u.z;let M=0;for(d&&(_=Oo.now()),M=0;M!==o;M++){const he=a[M];if(he.type===g){const le=he.force,ue=he.mass;le.x+=ue*T,le.y+=ue*I,le.z+=ue*R}}for(let he=0,le=this.subsystems.length;he!==le;he++)this.subsystems[he].update();d&&(_=Oo.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),d&&(m.broadphase=Oo.now()-_);let C=w.length;for(M=0;M!==C;M++){const he=w[M];if(!he.collideConnected)for(let le=n.length-1;le>=0;le-=1)(he.bodyA===n[le]&&he.bodyB===i[le]||he.bodyB===n[le]&&he.bodyA===i[le])&&(n.splice(le,1),i.splice(le,1))}this.collisionMatrixTick(),d&&(_=Oo.now());const L=AL,k=t.length;for(M=0;M!==k;M++)L.push(t[M]);t.length=0;const j=this.frictionEquations.length;for(M=0;M!==j;M++)x.push(this.frictionEquations[M]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,L,this.frictionEquations,x),d&&(m.narrowphase=Oo.now()-_),d&&(_=Oo.now()),M=0;M<this.frictionEquations.length;M++)c.addEquation(this.frictionEquations[M]);const H=t.length;for(let he=0;he!==H;he++){const le=t[he],ue=le.bi,ge=le.bj,_e=le.si,Ee=le.sj;let Ye;Ye=ue.material&&ge.material&&this.getContactMaterial(ue.material,ge.material)||this.defaultContactMaterial,Ye.friction,ue.material&&ge.material&&(ue.material.friction>=0&&ge.material.friction>=0&&(ue.material.friction,ge.material.friction),ue.material.restitution>=0&&ge.material.restitution>=0&&(le.restitution=ue.material.restitution*ge.material.restitution)),c.addEquation(le),ue.allowSleep&&ue.type===Dn.DYNAMIC&&ue.sleepState===Dn.SLEEPING&&ge.sleepState===Dn.AWAKE&&ge.type!==Dn.STATIC&&ge.velocity.lengthSquared()+ge.angularVelocity.lengthSquared()>=2*ge.sleepSpeedLimit**2&&(ue.wakeUpAfterNarrowphase=!0),ge.allowSleep&&ge.type===Dn.DYNAMIC&&ge.sleepState===Dn.SLEEPING&&ue.sleepState===Dn.AWAKE&&ue.type!==Dn.STATIC&&ue.velocity.lengthSquared()+ue.angularVelocity.lengthSquared()>=2*ue.sleepSpeedLimit**2&&(ge.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(ue,ge,!0),this.collisionMatrixPrevious.get(ue,ge)||(tb.body=ge,tb.contact=le,ue.dispatchEvent(tb),tb.body=ue,ge.dispatchEvent(tb)),this.bodyOverlapKeeper.set(ue.id,ge.id),this.shapeOverlapKeeper.set(_e.id,Ee.id)}for(this.emitContactEvents(),d&&(m.makeContactConstraints=Oo.now()-_,_=Oo.now()),M=0;M!==o;M++){const he=a[M];he.wakeUpAfterNarrowphase&&(he.wakeUp(),he.wakeUpAfterNarrowphase=!1)}for(C=w.length,M=0;M!==C;M++){const he=w[M];he.update();for(let le=0,ue=he.equations.length;le!==ue;le++){const ge=he.equations[le];c.addEquation(ge)}}c.solve(e,this),d&&(m.solve=Oo.now()-_),c.removeAllEquations();const X=Math.pow;for(M=0;M!==o;M++){const he=a[M];if(he.type&g){const le=X(1-he.linearDamping,e),ue=he.velocity;ue.scale(le,ue);const ge=he.angularVelocity;if(ge){const _e=X(1-he.angularDamping,e);ge.scale(_e,ge)}}}this.dispatchEvent(yL),d&&(_=Oo.now());const ee=this.stepnumber%(this.quatNormalizeSkip+1)==0,oe=this.quatNormalizeFast;for(M=0;M!==o;M++)a[M].integrate(e,ee,oe);this.clearForces(),this.broadphase.dirty=!0,d&&(m.integrate=Oo.now()-_),this.stepnumber+=1,this.dispatchEvent(_L);let re=!0;if(this.allowSleep)for(re=!1,M=0;M!==o;M++){const he=a[M];he.sleepTick(this.time),he.sleepState!==Dn.SLEEPING&&(re=!0)}this.hasActiveBodies=re}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Lp,kp),e){for(let o=0,a=Lp.length;o<a;o+=2)nb.bodyA=this.getBodyById(Lp[o]),nb.bodyB=this.getBodyById(Lp[o+1]),this.dispatchEvent(nb);nb.bodyA=nb.bodyB=null}if(t){for(let o=0,a=kp.length;o<a;o+=2)ib.bodyA=this.getBodyById(kp[o]),ib.bodyB=this.getBodyById(kp[o+1]),this.dispatchEvent(ib);ib.bodyA=ib.bodyB=null}Lp.length=kp.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(Lp,kp),n){for(let o=0,a=Lp.length;o<a;o+=2){const c=this.getShapeById(Lp[o]),u=this.getShapeById(Lp[o+1]);Up.shapeA=c,Up.shapeB=u,c&&(Up.bodyA=c.body),u&&(Up.bodyB=u.body),this.dispatchEvent(Up)}Up.bodyA=Up.bodyB=Up.shapeA=Up.shapeB=null}if(i){for(let o=0,a=kp.length;o<a;o+=2){const c=this.getShapeById(kp[o]),u=this.getShapeById(kp[o+1]);Np.shapeA=c,Np.shapeB=u,c&&(Np.bodyA=c.body),u&&(Np.bodyB=u.body),this.dispatchEvent(Np)}Np.bodyA=Np.bodyB=Np.shapeA=Np.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const i=e[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new ms;const iC=new go,Oo=globalThis.performance||{};if(!Oo.now){let s=Date.now();Oo.timing&&Oo.timing.navigationStart&&(s=Oo.timing.navigationStart),Oo.now=()=>Date.now()-s}new ie;const _L={type:"postStep"},yL={type:"preStep"},tb={type:Dn.COLLIDE_EVENT_NAME,body:null,contact:null},AL=[],bL=[],wL=[],xL=[],Lp=[],kp=[],nb={type:"beginContact",bodyA:null,bodyB:null},ib={type:"endContact",bodyA:null,bodyB:null},Up={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Np={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var EL=function(){var s,e,t,n,i=0,o=new p.Pa4;function a(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new m,this.unassigned=new m,this.vertices=[]}function c(){this.normal=new p.Pa4,this.midpoint=new p.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=i,this.edge=null}function u(g,_){this.vertex=g,this.prev=null,this.next=null,this.twin=null,this.face=_}function d(g,_){this.point=g,this.index=_,this.prev=null,this.next=null,this.face=null}function m(){this.head=null,this.tail=null}return Object.assign(a.prototype,{toJSON:function(){const g=this.faces.map(I=>I.toArray()),_=Array.from(new Set(g.flat())).sort(),w=[];for(let I=0;I<_.length;I++)w.push(this.vertices[_[I]].point.x,this.vertices[_[I]].point.y,this.vertices[_[I]].point.z);const x=new Map;for(let I=0;I<_.length;I++)x.set(_[I],I);const T=[];for(let I=0;I<g.length;I++)T.push([x.get(g[I][0]),x.get(g[I][1]),x.get(g[I][2])]);return[w,T]},setFromPoints:function(g){Array.isArray(g)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),g.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var _=0,w=g.length;_<w;_++)this.vertices.push(new d(g[_],_));return this.compute(),this},setFromObject:function(g){var _=[];return g.updateMatrixWorld(!0),g.traverse(function(w){var x,T,I,R=w.geometry;if(R!==void 0&&(R.isGeometry&&(R=R.toBufferGeometry?R.toBufferGeometry():new BufferGeometry().fromGeometry(R)),R.isBufferGeometry)){var M=R.attributes.position;if(M!==void 0)for(x=0,T=M.count;x<T;x++)(I=new p.Pa4).fromBufferAttribute(M,x).applyMatrix4(w.matrixWorld),_.push(I)}}),this.setFromPoints(_)},containsPoint:function(g){for(var _=this.faces,w=0,x=_.length;w<x;w++)if(_[w].distanceToPoint(g)>this.tolerance)return!1;return!0},intersectRay:function(g,_){for(var w=this.faces,x=-1/0,T=1/0,I=0,R=w.length;I<R;I++){var M=w[I],C=M.distanceToPoint(g.origin),L=M.normal.dot(g.direction);if(C>0&&L>=0)return null;var k=L!==0?-C/L:0;if(!(k<=0)&&(L>0?T=Math.min(k,T):x=Math.max(k,x),x>T))return null}return x!==-1/0?g.at(x,_):g.at(T,_),_},intersectsRay:function(g){return this.intersectRay(g,o)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(g,_){return g.face=_,_.outside===null?this.assigned.append(g):this.assigned.insertBefore(_.outside,g),_.outside=g,this},removeVertexFromFace:function(g,_){return g===_.outside&&(g.next!==null&&g.next.face===_?_.outside=g.next:_.outside=null),this.assigned.remove(g),this},removeAllVerticesFromFace:function(g){if(g.outside!==null){for(var _=g.outside,w=g.outside;w.next!==null&&w.next.face===g;)w=w.next;return this.assigned.removeSubList(_,w),_.prev=w.next=null,g.outside=null,_}},deleteFaceVertices:function(g,_){var w=this.removeAllVerticesFromFace(g);if(w!==void 0)if(_===void 0)this.unassigned.appendChain(w);else{var x=w;do{var T=x.next;_.distanceToPoint(x.point)>this.tolerance?this.addVertexToFace(x,_):this.unassigned.append(x),x=T}while(x!==null)}return this},resolveUnassignedPoints:function(g){if(this.unassigned.isEmpty()===!1){var _=this.unassigned.first();do{for(var w=_.next,x=this.tolerance,T=null,I=0;I<g.length;I++){var R=g[I];if(R.mark===i){var M=R.distanceToPoint(_.point);if(M>x&&(x=M,T=R),x>1e3*this.tolerance)break}}T!==null&&this.addVertexToFace(_,T),_=w}while(_!==null)}return this},computeExtremes:function(){var g,_,w,x=new p.Pa4,T=new p.Pa4,I=[],R=[];for(g=0;g<3;g++)I[g]=R[g]=this.vertices[0];for(x.copy(this.vertices[0].point),T.copy(this.vertices[0].point),g=0,_=this.vertices.length;g<_;g++){var M=this.vertices[g],C=M.point;for(w=0;w<3;w++)C.getComponent(w)<x.getComponent(w)&&(x.setComponent(w,C.getComponent(w)),I[w]=M);for(w=0;w<3;w++)C.getComponent(w)>T.getComponent(w)&&(T.setComponent(w,C.getComponent(w)),R[w]=M)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(x.x),Math.abs(T.x))+Math.max(Math.abs(x.y),Math.abs(T.y))+Math.max(Math.abs(x.z),Math.abs(T.z))),{min:I,max:R}},computeInitialHull:function(){s===void 0&&(s=new p.Zzh,e=new p.JOQ,t=new p.Pa4);var g,_,w,x,T,I,R,M,C,L=this.vertices,k=this.computeExtremes(),j=k.min,H=k.max,X=0,ee=0;for(I=0;I<3;I++)(C=H[I].point.getComponent(I)-j[I].point.getComponent(I))>X&&(X=C,ee=I);for(_=j[ee],w=H[ee],X=0,s.set(_.point,w.point),I=0,R=this.vertices.length;I<R;I++)(g=L[I])!==_&&g!==w&&(s.closestPointToPoint(g.point,!0,t),(C=t.distanceToSquared(g.point))>X&&(X=C,x=g));for(X=-1,e.setFromCoplanarPoints(_.point,w.point,x.point),I=0,R=this.vertices.length;I<R;I++)(g=L[I])!==_&&g!==w&&g!==x&&(C=Math.abs(e.distanceToPoint(g.point)))>X&&(X=C,T=g);var oe=[];if(e.distanceToPoint(T.point)<0)for(oe.push(c.create(_,w,x),c.create(T,w,_),c.create(T,x,w),c.create(T,_,x)),I=0;I<3;I++)M=(I+1)%3,oe[I+1].getEdge(2).setTwin(oe[0].getEdge(M)),oe[I+1].getEdge(1).setTwin(oe[M+1].getEdge(0));else for(oe.push(c.create(_,x,w),c.create(T,_,w),c.create(T,w,x),c.create(T,x,_)),I=0;I<3;I++)M=(I+1)%3,oe[I+1].getEdge(2).setTwin(oe[0].getEdge((3-I)%3)),oe[I+1].getEdge(0).setTwin(oe[M+1].getEdge(1));for(I=0;I<4;I++)this.faces.push(oe[I]);for(I=0,R=L.length;I<R;I++)if((g=L[I])!==_&&g!==w&&g!==x&&g!==T){X=this.tolerance;var re=null;for(M=0;M<4;M++)(C=this.faces[M].distanceToPoint(g.point))>X&&(X=C,re=this.faces[M]);re!==null&&this.addVertexToFace(g,re)}return this},reindexFaces:function(){for(var g=[],_=0;_<this.faces.length;_++){var w=this.faces[_];w.mark===i&&g.push(w)}return this.faces=g,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var g,_=0,w=this.assigned.first().face,x=w.outside;do{var T=w.distanceToPoint(x.point);T>_&&(_=T,g=x),x=x.next}while(x!==null&&x.face===w);return g}},computeHorizon:function(g,_,w,x){var T;this.deleteFaceVertices(w),w.mark=1,T=_===null?_=w.getEdge(0):_.next;do{var I=T.twin,R=I.face;R.mark===i&&(R.distanceToPoint(g)>this.tolerance?this.computeHorizon(g,I,R,x):x.push(T)),T=T.next}while(T!==_);return this},addAdjoiningFace:function(g,_){var w=c.create(g,_.tail(),_.head());return this.faces.push(w),w.getEdge(-1).setTwin(_.twin),w.getEdge(0)},addNewFaces:function(g,_){this.newFaces=[];for(var w=null,x=null,T=0;T<_.length;T++){var I=_[T],R=this.addAdjoiningFace(g,I);w===null?w=R:R.next.setTwin(x),this.newFaces.push(R.face),x=R}return w.next.setTwin(x),this},addVertexToHull:function(g){var _=[];return this.unassigned.clear(),this.removeVertexFromFace(g,g.face),this.computeHorizon(g.point,null,g.face,_),this.addNewFaces(g,_),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var g;for(this.computeInitialHull();(g=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(g);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(c,{create:function(g,_,w){var x=new c,T=new u(g,x),I=new u(_,x),R=new u(w,x);return T.next=R.prev=I,I.next=T.prev=R,R.next=I.prev=T,x.edge=T,x.compute()}}),Object.assign(c.prototype,{toArray:function(){const g=[];let _=this.edge;do g.push(_.head().index),_=_.next;while(_!==this.edge);return g},getEdge:function(g){for(var _=this.edge;g>0;)_=_.next,g--;for(;g<0;)_=_.prev,g++;return _},compute:function(){n===void 0&&(n=new p.CJI);var g=this.edge.tail(),_=this.edge.head(),w=this.edge.next.head();return n.set(g.point,_.point,w.point),n.getNormal(this.normal),n.getMidpoint(this.midpoint),this.area=n.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(g){return this.normal.dot(g)-this.constant}}),Object.assign(u.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var g=this.head(),_=this.tail();return _!==null?_.point.distanceTo(g.point):-1},lengthSquared:function(){var g=this.head(),_=this.tail();return _!==null?_.point.distanceToSquared(g.point):-1},setTwin:function(g){return this.twin=g,g.twin=this,this}}),Object.assign(m.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(g,_){return _.prev=g.prev,_.next=g,_.prev===null?this.head=_:_.prev.next=_,g.prev=_,this},insertAfter:function(g,_){return _.prev=g,_.next=g.next,_.next===null?this.tail=_:_.next.prev=_,g.next=_,this},append:function(g){return this.head===null?this.head=g:this.tail.next=g,g.prev=this.tail,g.next=null,this.tail=g,this},appendChain:function(g){for(this.head===null?this.head=g:this.tail.next=g,g.prev=this.tail;g.next!==null;)g=g.next;return this.tail=g,this},remove:function(g){return g.prev===null?this.head=g.next:g.prev.next=g.next,g.next===null?this.tail=g.prev:g.next.prev=g.prev,this},removeSubList:function(g,_){return g.prev===null?this.head=_.next:g.prev.next=_.next,_.next===null?this.tail=g.prev:_.next.prev=g.prev,this},isEmpty:function(){return this.head===null}}),a}();const SL=new p.Pa4,w1=new p.Pa4,CL=new p._fP;function x1(s){const e=function(i){const o=[];return i.traverse(function(a){a.isMesh&&o.push(a)}),o}(s);if(e.length===0)return null;if(e.length===1)return sP(e[0]);let t;const n=[];for(;t=e.pop();)n.push(ML(sP(t)));return function(i){let o=0;for(let u=0;u<i.length;u++){const d=i[u].attributes.position;d&&d.itemSize===3&&(o+=d.count)}const a=new Float32Array(3*o);let c=0;for(let u=0;u<i.length;u++){const d=i[u].attributes.position;if(d&&d.itemSize===3)for(let m=0;m<d.count;m++)a[c++]=d.getX(m),a[c++]=d.getY(m),a[c++]=d.getZ(m)}return new p.u9r().setAttribute("position",new p.TlE(a,3))}(n)}function sP(s){let e=s.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),s.updateMatrixWorld(),s.matrixWorld.decompose(SL,CL,w1),e.scale(w1.x,w1.y,w1.z),e}function oP(s){const e=s.attributes.position,t=new Float32Array(3*e.count);for(let n=0;n<e.count;n++)t[3*n]=e.getX(n),t[3*n+1]=e.getY(n),t[3*n+2]=e.getZ(n);return t}function E1(s,e){switch(e){case"x":return s.x;case"y":return s.y;case"z":return s.z}throw new Error(`Unexpected component ${e}`)}function ML(s,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=s.getIndex(),i=s.getAttribute("position"),o=n?n.count:i.count;let a=0;const c=[],u=[],d=Math.log10(1/e),m=Math.pow(10,d);for(let w=0;w<o;w++){const x=n?n.getX(w):w;let T="";T+=~~(i.getX(x)*m)+",",T+=~~(i.getY(x)*m)+",",T+=~~(i.getZ(x)*m)+",",T in t?c.push(t[T]):(u.push(i.getX(x)),u.push(i.getY(x)),u.push(i.getZ(x)),t[T]=a,c.push(a),a++)}const g=new p.TlE(new Float32Array(u),i.itemSize,i.normalized),_=new p.u9r;return _.setAttribute("position",g),_.setIndex(c),_}const aP=Math.PI/2;var Vs;(function(s){s.BOX="Box",s.CYLINDER="Cylinder",s.SPHERE="Sphere",s.HULL="ConvexPolyhedron",s.MESH="Trimesh"})(Vs||(Vs={}));const TL=function(s,e={}){const t=function(u,d={}){let m;if(d.type===Vs.BOX)return cP(u);if(d.type===Vs.CYLINDER)return function(g,_){const w=["x","y","z"],x=_.cylinderAxis||"y",T=w.splice(w.indexOf(x),1)&&w,I=new p.ZzF().setFromObject(g);if(!isFinite(I.min.lengthSq()))return null;const R=I.max[x]-I.min[x],M=.5*Math.max(E1(I.max,T[0])-E1(I.min,T[0]),E1(I.max,T[1])-E1(I.min,T[1])),C=x==="y"?aP:0,L=x==="z"?aP:0;return{type:Vs.CYLINDER,params:{radiusTop:M,radiusBottom:M,height:R,segments:12},orientation:new Rs().setFromEuler(C,L,0,"XYZ").normalize()}}(u,d);if(d.type===Vs.SPHERE)return function(g,_){if(_.sphereRadius)return{type:Vs.SPHERE,params:{radius:_.sphereRadius}};const w=x1(g);return w?(w.computeBoundingSphere(),{type:Vs.SPHERE,params:{radius:w.boundingSphere.radius}}):null}(u,d);if(d.type===Vs.HULL)return function(g){const _=x1(g);if(!_)return null;const w=1e-4;for(let I=0;I<_.attributes.position.count;I++)_.attributes.position.setXYZ(I,_.attributes.position.getX(I)+(Math.random()-.5)*w,_.attributes.position.getY(I)+(Math.random()-.5)*w,_.attributes.position.getZ(I)+(Math.random()-.5)*w);const[x,T]=new EL().setFromObject(new p.Kj0(_)).toJSON();return{type:Vs.HULL,params:{vertices:new Float32Array(x),faces:T}}}(u);if(d.type===Vs.MESH)return m=x1(u),m?function(g){const _=oP(g);if(!_.length)return null;const w=new Uint32Array(_.length);for(let x=0;x<_.length;x++)w[x]=x;return{type:Vs.MESH,params:{vertices:_,indices:w}}}(m):null;if(d.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${d.type}".`);if(m=x1(u),!m)return null;switch(m.type){case"BoxGeometry":case"BoxBufferGeometry":return lP(m);case"CylinderGeometry":case"CylinderBufferGeometry":return function(g){const _=g.parameters;return{type:Vs.CYLINDER,params:{radiusTop:_.radiusTop,radiusBottom:_.radiusBottom,height:_.height,segments:_.radialSegments},orientation:new Rs().setFromEuler(p.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(m);case"PlaneGeometry":case"PlaneBufferGeometry":return function(g){g.computeBoundingBox();const _=g.boundingBox;return{type:Vs.BOX,params:{x:(_.max.x-_.min.x)/2||.1,y:(_.max.y-_.min.y)/2||.1,z:(_.max.z-_.min.z)/2||.1}}}(m);case"SphereGeometry":case"SphereBufferGeometry":return function(g){return{type:Vs.SPHERE,params:{radius:g.parameters.radius}}}(m);case"TubeGeometry":case"BufferGeometry":return cP(u);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',m.type),lP(m)}}(s,e);if(!t)return null;const{type:n,params:i,offset:o,orientation:a}=t;let c;return c=n===Vs.BOX?function(u){const{x:d,y:m,z:g}=u;return new l1(new ie(d,m,g))}(i):n===Vs.CYLINDER?function(u){const{radiusTop:d,radiusBottom:m,height:g,segments:_}=u,w=new AB(d,m,g,_);return w.radiusTop=m,w.radiusBottom=m,w.height=g,w.numSegments=_,w}(i):n===Vs.SPHERE?function(u){return new XI(u.radius)}(i):n===Vs.HULL?function(u){const{faces:d,vertices:m}=u,g=[];for(let _=0;_<m.length;_+=3)g.push(new ie(m[_],m[_+1],m[_+2]));return new _v({faces:d,vertices:g})}(i):function(u){const{vertices:d,indices:m}=u;return new _1(d,m)}(i),{shape:c,offset:o,orientation:a}};function lP(s){if(!oP(s).length)return null;s.computeBoundingBox();const e=s.boundingBox;return{type:Vs.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function cP(s){const e=s.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const t=new p.ZzF().setFromObject(e);if(!isFinite(t.min.lengthSq()))return null;const n=t.translate(e.position.negate()).getCenter(new p.Pa4);return{type:Vs.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2},offset:n.lengthSq()?new ie(n.x,n.y,n.z):void 0}}var S1,C1=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let yd=S1=class extends En{constructor(s=!1){super(),this._world=new vL,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var i;(i=this._viewer)==null||i.scene.modelRoot.children.forEach(o=>{this.makeBody(o)})},this._bodyMeshMap=new Map,this._movementPlane=new p.Kj0(new p._12(100,100),new p.vBJ({color:65280,side:p.ehD})),this.enabled=s,this._world.gravity.set(0,-9.81,0);const e=new bB,t=new Dn({mass:0,position:new ie(0,-2,0)});t.addShape(e),t.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=t,this._world.addBody(t);const n=new XI(.1);this._jointBody=new Dn({mass:0}),this._jointBody.addShape(n),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(s){await super.onAdded(s);const e=new p.Pa4,t=new p.Pa4,n=new p.Pa4,i=new p._fP,o=new p._fP,a=new p.yGw,c=new p.yGw;let u=!1,d=!1;function m(g){const _=s.canvas.getBoundingClientRect(),w=new p.FM8;return w.x=(g.clientX-_.x)/_.width*2-1,w.y=-(g.clientY-_.y)/_.height*2+1,w}s.addEventListener("preFrame",()=>{const g=s.getPlugin(xa),_=s.getPlugin(_c);if(!this.enabled){if(!(this.nextSteps>0))return g&&u&&(g.enableRefreshTransform=!0,u=!1),_&&d&&(_.enable(S1.PluginType),d=!1),void(this._dirty=!1);this.enabled=!0}if(g&&g.enableRefreshTransform&&!u&&(g.enableRefreshTransform=!1,u=!0),_&&!d&&_.disable(S1.PluginType),this.nextSteps>0)for(let x=0;x<this.stepPhysics.stepCount;x++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let w=!1;for(const x of this._world.bodies){if(x.mass===0)continue;const T=this._bodyMeshMap.get(x);if(T&&(T.updateMatrixWorld(),T.getWorldPosition(t),T.getWorldQuaternion(o),T.getWorldScale(n),t.manhattanDistanceTo(e.copy(x.position))>0&&(w=!0),o.angleTo(i.copy(x.quaternion))>0&&(w=!0),w)){if(a.compose(e,i,n),!T.parent)throw new Error("no parent");c.copy(T.parent.matrixWorld).invert(),c.multiply(a),c.decompose(e,i,n),T.position.copy(e),T.quaternion.copy(i)}}this._dirty=w,s.setDirty(),s.renderer.resetShadows(),g==null||g.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),s.scene.addEventListener("update",g=>{this._bodyMeshMap.forEach((_,w)=>{w.velocity.set(0,0,0),w.angularVelocity.set(0,0,0)})}),s.scene.addEventListener("addSceneObject",g=>{var w;const _=(w=g.object)==null?void 0:w.modelObject;_&&_.traverse(x=>{const T=x.uiConfig;T&&Array.isArray(T.children)&&(T.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(x)},{type:"number",label:"Mass",hidden:()=>!x._physicsBody,getValue:()=>{var I;return((I=x._physicsBody)==null?void 0:I.mass)??0},setValue:I=>{x._physicsBody&&(x._physicsBody.mass=I)}}]}),x.userData.physicsMass!==void 0&&this.makeBody(x))})}),s.canvas.addEventListener("pointerdown",g=>{if(!this.enabled||!g.isPrimary)return;s.getPlugin(Ti)&&(s.getPlugin(Ti).enabled=!1);const _=m(g),w=new p.iMs;w.setFromCamera(_,s.scene.activeCamera.cameraObject);const x=w.intersectObjects([...this._bodyMeshMap.values()],!0);if(!x.length)return;let T,I=null,R=x[0];for(const L of x){for(I=L.object,R=L;!(I==null||I.visible&&I.material);)I=I.parent;if(I)break}if(!I)return;for(;I.parent&&!T;){for(const[L,k]of this._bodyMeshMap.entries())if(k===I){L.mass>0&&(T=L);break}I=I.parent}if(!T)return;s.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(R.point),this._movementPlane.lookAt(s.scene.activeCamera.cameraObject.getWorldPosition(new p.Pa4));const M=new ie().copy(R.point).vsub(T.position),C=T.quaternion.inverse().vmult(M);this._jointBody.position.copy(R.point),this._jointConstraint=new vB(T,C,this._jointBody,new ie(0,0,0)),this._world.addConstraint(this._jointConstraint)}),s.canvas.addEventListener("pointermove",g=>{if(!this.enabled||!g.isPrimary||!this._jointConstraint)return;const _=m(g),w=new p.iMs;w.setFromCamera(_,s.scene.activeCamera.cameraObject);const x=w.intersectObject(this._movementPlane);if(!x.length)return;const T=x[0];this._jointBody.position.copy(T.point),this._jointConstraint.update()}),s.canvas.addEventListener("pointerup",g=>{this.enabled&&g.isPrimary&&(s.getPlugin(Ti)&&(s.getPlugin(Ti).enabled=!0),s.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(s){if(s.isLight||s._physicsBody)return;const e=[];let t=0;if(s.updateMatrixWorld(),s.traverse(u=>{const d=u;if(!d.isMesh)return;if(d._physicsShape)return void e.push(d._physicsShape);if(t+=d.userData.physicsMass??1,d.addEventListener("objectUpdate",()=>{d.userData.physicsMass===0&&(this._ground.position.y=d.position.y,this._bodyMeshMap.forEach((g,_)=>{_.velocity.set(0,0,0),_.angularVelocity.set(0,0,0),_.force.set(0,0,0),_.torque.set(0,0,0)}))}),d.userData.physicsMass===0)return;const m=TL(d,{type:Vs.HULL});m?(e.push([m.shape,d]),d._physicsShape=m.shape):console.warn("Failed to convert mesh to cannon shape",d)}),!e.length)return;const n=new Dn({mass:t,angularVelocity:new ie(0,0,0),velocity:new ie(0,0,0)}),i=new p.Pa4,o=new p._fP,a=new p.Pa4,c=new p.yGw;for(const[u,d]of e)d!==s?(d.updateMatrixWorld(),c.copy(s.matrixWorld).invert(),c.multiply(d.matrixWorld),c.decompose(i,o,a),n.addShape(u,new ie(...i.toArray()),new Rs(...o.toArray()))):n.addShape(u);n.position.set(...s.getWorldPosition(i).toArray()),n.quaternion.set(...s.getWorldQuaternion(o).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0),s.addEventListener("objectUpdate",()=>{n.position.set(...s.getWorldPosition(i).toArray()),n.quaternion.set(...s.getWorldQuaternion(o).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0)}),this._world.addBody(n),this._bodyMeshMap.set(n,s),s._physicsBody=n,s.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};yd.PluginType="CannonPhysics",C1([Gt("Enabled",s=>({onChange:()=>{}})),Ae()],yd.prototype,"enabled",void 0),C1([Sr()],yd.prototype,"stepPhysics",void 0),C1([Ai("Make Root Bodies")],yd.prototype,"makeRootBodies",void 0),yd=S1=C1([Hn("Physics (dev)")],yd);var IL=__webpackgi_require__(819),PL=__webpackgi_require__(665);const RL=(s,e,t)=>{var a,c;const n=s.controller_,i=(c=(a=n.parent)==null?void 0:a.children)==null?void 0:c.indexOf(n);return!(((u,d)=>d.controller_.rackController.rack===u.controller_.parent)(s,e)&&i===t||(e.add(s,t),0))},uP=(s,e,t,n)=>{var g;let i=e.uiRef;i!=null&&i.controller_.viewProps.get("disposed")&&(i=void 0);const o=i==null?void 0:i.expanded;if(!i){const _=s.addFolder({title:""});i=_,i.on("fold",w=>{var T,I,R;let x=_.expanded;(0,V.safeSetProperty)(e,"expanded",x,!0),x=(0,V.getOrCall)(e.expanded)??x,x!==_.expanded&&(_.expanded=x),(T=e.uiRefresh)==null||T.call(e,"postFrame",!0,10),x?(I=e.onExpand)==null||I.call(e,e):(R=e.onCollapse)==null||R.call(e,e)})}if(!i)return i;i.expanded=(0,V.getOrCall)(e.expanded)??o??!1;const a=(e.children??[]).map(_=>_&&(0,V.getOrCall)(_)).flat(2).filter(_=>_);let c=0;for(const _ of a){if(Array.isArray(_)||typeof _!="object"){console.error("child is not an object",_);continue}let w=_.uiRef;w&&w.controller_.viewProps.get("disposed")&&(_.uiRef=void 0,_.uiRefresh=void 0),w=_.uiRef,w||(t.appendUiObject({uiConfig:_},i),w=_.uiRef),w&&RL(w,i,c++)&&t.appendUiObject({uiConfig:_},i)}let u=i.children;for(;u.length>c;){const _=u[u.length-1];i.remove(_),_.dispose(),u=i.children}i.controller_.props.set("title",(0,V.getOrCall)(e.label)??"");const d=i.controller_.view.containerElement,m=(0,V.getOrCall)(e.domChildren,[]);if((m==null?void 0:m.length)!==void 0){const _=[];for(let w=0;w<d.children.length;w++){const x=d.children[w];(g=x.dataset)!=null&&g.tpCustomDOM&&_.push(x)}for(const w of _)d.removeChild(w);for(const w of m)w.parentElement!==d&&(d.appendChild(w),w.dataset.tpCustomDOM="true");i.controller_.foldable.cleanUpTransition()}return i},DL=(s,e,t,n)=>{const[i,o]=e.property??[void 0,void 0],a=(0,V.getOrCall)(e.label)??o;let c=e.uiRef;return c!=null&&c.controller_.viewProps.get("disposed")&&(c=void 0),c||(c=s.addButton({title:""}),c.on("click",async()=>{const u=[];e.prompt&&u.push(await t.prompt(...e.prompt));let d=i&&o?i[o]:void 0,m=i;if(d||(d=e.value,m=e),typeof d=="function"){const g=()=>{t.removeEventListener("postFrame",g),d.call(m??e,...u)};t.addEventListener("postFrame",g)}else console.warn("Invalid action type for button")})),c&&(c.title=(a??"click me")+""),c},BL=(s,e,t,n)=>{const i=Object.fromEntries(((0,V.getOrCall)(e.children)??[]).map(o=>(0,V.getOrCall)(o)).flat(2).filter(o=>o).map(o=>{const a=(0,V.getOrCall)(o.label);return[a,o.value??a]}));return Zu(s,e,t,{options:i,...n??{}})},OL=(s,e,t,n)=>{const i=(0,V.getOrCall)(e.bounds),o=((i==null?void 0:i.length)??0)>=2?i[1]:1,a=((i==null?void 0:i.length)??0)>=1?i[0]:0,c=e.stepSize||void 0;return Zu(s,e,t,{min:a,max:o,step:c,...n??{}})},M1=(s,e,t,n)=>{const i=(0,V.getOrCall)(e.bounds);if(!i||i.length<1)return Zu(s,e,t,{...n??{}});const o=(i.length??0)>=2?i[1]:1,a=(i.length??0)>=1?i[0]:0,c={min:a,max:o,step:e.stepSize??(o-a)/100},u={x:c,y:c};e.type!=="vec3"&&e.type!=="vec4"||(u.z=c),e.type==="vec4"&&(u.w=c);const d=e.property;if(e.value===void 0&&d&&d[0]&&typeof d[0]=="object"&&d[0][d[1]]&&Array.isArray(d[0][d[1]])){const[m,g]=d,_=m[g],w=_.length,x=new(w===2?p.FM8:w===3?p.Pa4:p.Ltg)().fromArray(_);e.value=x,e.property=void 0,e.onChange=[()=>{m[g]=x.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(T=>T),e.label===void 0&&(e.label=g)}return Zu(s,e,t,{...u,...n??{}})},LL=(s,e,t,n)=>{var o;const i=e.property;if(e.value===void 0&&i&&typeof i[0]=="object"&&((o=i[0][i[1]])!=null&&o.isColor)){const[a,c]=i,u=p.KI_;Object.defineProperty(e,"value",{get:()=>{const d=a[c];return d?new p.Ilk(d).getHex(u):0},set:d=>{const m=a[c],g=new p.Ilk().setHex(d,u);m.isColor?m.copy(g):typeof m=="number"?a[c]=g.getHex():typeof m=="string"&&(a[c]="#"+g.getHexString()),typeof(a==null?void 0:a.setDirty)=="function"&&a.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(d=>d),e.label===void 0&&(e.label=c+"")}return(n=n??{}).view="color",(0,V.getOrCall)(e.inlinePicker)&&(n.picker="inline"),Zu(s,e,t,n)},Zu=(s,e,t,n)=>{var c;let i=(0,V.getOrCall)(e.property);if((e.getValue||e.setValue)&&i&&console.error("specify either property or value, or getValue and setValue",e),i)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if((Object.hasOwn?Object.hasOwn(e,"value"):e.hasOwnProperty("value"))||e.value!==void 0||!e.getValue&&!e.setValue||(Object.defineProperty(e,"value",{get:()=>{var u;return(u=e.getValue)==null?void 0:u.call(e)},set:u=>{var d;return(d=e.setValue)==null?void 0:d.call(e,u)}}),i=[e,"value"]),i||e.value===void 0||(i=[e,"value"]),!i)return void console.error("cannot determine property",e);n=n??{};const o={label:(0,V.getOrCall)(e.label)??i[1],...n};let a=e.uiRef;if(a!=null&&a.controller_.viewProps.get("disposed")&&(a=void 0),!a&&typeof i[0]=="object"&&i[0]){const[u,d]=i;try{a=e.isMonitor?s.addMonitor(u,d,o):s.addInput(u,d,o).on("change",m=>{[e.onChange].flat().forEach(g=>typeof g=="function"&&(g==null?void 0:g(m))),typeof(u==null?void 0:u.setDirty)=="function"&&u.setDirty(m)})}catch(m){if(!m.message.startsWith("No matching controller for"))throw m;a=void 0}}if(a){for(const[u,d]of Object.entries(o)){const m=a.controller_.props.value(u);m!==void 0&&m.rawValue!==d&&a.controller_.props.set(u,d)}e.type==="slider"&&(o.min!==void 0&&a.controller_.valueController.sliderController.props.set("minValue",o.min),o.max!==void 0&&a.controller_.valueController.sliderController.props.set("maxValue",o.max)),(c=a==null?void 0:a.controller_.valueController.view.inputElement)==null||c.setAttribute("placeholder",(0,V.getOrCall)(e.placeholder)??""),a.refresh()}return a};class hP extends V.SimpleEventDispatcher{constructor(e=!1,t=!1,n=!1,i=!0,o=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:uP,folder:uP,input:Zu,number:Zu,slider:OL,dropdown:BL,checkbox:Zu,color:LL,vec:M1,vec2:M1,vec3:M1,vec4:M1,button:DL,monitor:(c,u,d,m)=>(u.isMonitor=!0,Zu(c,u,d,m)),dummy:(c,u,d,m)=>Zu(c,u,d,m)},this.alert=async c=>alert(c),this.confirm=async c=>confirm(c),this.prompt=async(c,u,d=!0)=>prompt(c,u),this._expand=e,this._limitedOptions=n;const a=this._createUiContainer();o.appendChild(a),this._pane=new PL.Pane({title:"Configuration",container:a}),this._pane.expanded=this._expand,i&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],n=[],i=(0,V.now)(),o=i-this._lastModeTime[e];t.forEach(a=>{a[2]>.001?(a[2]-=o,n.push(a)):this._refreshUiObject(a[0],a[1],a[2])}),this._refreshQueue[e]=n,this._lastModeTime[e]=i}addToRefreshQueue(e,t){var c;const n=(c=t[0])==null?void 0:c.uiConfig,i=n==null?void 0:n.uuid,o=this._refreshQueue[e],a=o.find(u=>u[3]===i);a?a[2]=Math.max(a[2],t[2]):o.push([...t,i]),this._refreshQueue[e]=o}dispose(){var e;(e=this._pane)==null||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var i,o;const{uiConfig:n}=e??{};if(n&&(!this._limitedOptions||n.limitedUi)&&(t=t??this._pane,n.type)){n.uuid||(n.uuid=ns()),n.uiRef&&n.uiRefType!==n.type&&this.removeUiConfig(n);const a=(o=(i=this._typeGenerators)[n.type])==null?void 0:o.call(i,t,n,this);a&&(a.hidden=(0,V.getOrCall)(n.hidden)??!1,a.disabled=(0,V.getOrCall)(n.disabled)??!1),n.uiRef=a,n.uiRefType=a?n.type:void 0,n.uiRefresh=(c="postFrame",u=!1,d=0)=>this._uiObjectRefresh(c,(e==null?void 0:e.uiConfig)??n,t,u,d),a==null||a.controller_.viewProps.handleDispose(()=>{n.uiRef=void 0,n.uiRefType=void 0,n.uiRefresh=void 0})}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var t,n;e&&e.uiRef&&((n=(t=e.uiRef).dispose)==null||n.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,i,o){(i?T1(t,n):[{uiConfig:t,parentFolder:n}]).forEach(a=>{const c=[{uiConfig:a.uiConfig},a.parentFolder,o];e==="immediate"?this._refreshUiObject(...c):this.addToRefreshQueue(e,c)})}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,V.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,V.createStyles)(V.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function T1(s,e,t){return t=t??[],s&&s.uiRef&&(t.push({uiConfig:s,parentFolder:e}),[...s.children||[]].forEach(n=>{typeof n!="function"&&n&&(Array.isArray(n)?n.forEach(i=>t=T1(i,s.uiRef,t)):t=T1(n,s.uiRef,t))})),t}var I1=__webpackgi_require__(898),rb={};I1.Z&&I1.Z.locals&&(rb.locals=I1.Z.locals);var rC,sC=0,xv={};xv.styleTagTransform=tm(),xv.setAttributes=$f(),xv.insert=function(s,e){(e.target||document.head).appendChild(s)},xv.domAPI=Zf(),xv.insertStyleElement=em(),rb.use=function(s){return xv.options=s||{},sC++||(rC=Jf()(I1.Z,xv)),rb},rb.unuse=function(){sC>0&&!--sC&&(rC(),rC=null)};var kL=rb;class A0 extends hP{constructor(e=!1,t=!1,n=!1,i=document.body,o){super(e,t,n,!1),this.dependencies=[Qt],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=a=>{this.dispatchEvent(a),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async a=>this._viewer?this._viewer.alert(a):super.alert(a),this.confirm=async a=>this._viewer?this._viewer.confirm(a):super.confirm(a),this.prompt=async(a,c,u=!0)=>this._viewer?this._viewer.prompt(a,c,u):super.prompt(a,c,u),this._pane.registerPlugin(IL),kL.use({target:i}),this.colorMode=o??(localStorage?localStorage.getItem("tpTheme"):"blue")??"blue"}async onAdded(e){this._viewer=e,this._typeGenerators.image=(t=>(n,i,o,a)=>{let c=i.property||i.__property;const u="placeholder";if(i.value===void 0&&(i.getValue||i.setValue)&&(Object.defineProperty(i,"_value",{get:()=>{var d;return(d=i.getValue)==null?void 0:d.call(i)},set:d=>{var m;return(m=i.setValue)==null?void 0:m.call(i,d)}}),c=[i,"_value"]),(!(Object.hasOwn?Object.hasOwn(i,"value"):i.hasOwnProperty("value"))||i.value===void 0)&&c&&typeof c[0]=="object"){const[d,m]=c,g=(0,V.makeTextSvg)("Render Target"),_=(0,V.makeTextSvg)("Data Texture"),w=(0,V.makeTextSvg)("CUBE Texture"),x=(0,V.makeTextSvg)("Compressed Texture"),T={},I={};Object.defineProperty(i,"value",{get:()=>{let R,M=d[m];if(M!=null&&M.get&&(M=M.get()),!M)return u;if(M.isCompressedTexture&&M.image&&!M.image.tp_src&&(M.image.tp_src=x),M.isTexture?(M.image&&!M.image.tp_src&&(M.image instanceof ImageBitmap||M.image instanceof HTMLImageElement||M.image instanceof HTMLVideoElement)?M.image.tp_src=(0,V.imageBitmapToBase64)(M.image,160):M.image&&M.isRenderTargetTexture&&!M.image.tp_src?M.__target&&(M.tp_src=t.renderer.renderTargetToDataUrl(M.__target,void 0,void 0,Array.isArray(M.__target.texture)?M.__target.texture.indexOf(M):void 0)):M.image&&!M.image.tp_src&&(M.image.tp_src=ar(M,160,!1).toDataURL("image/png",90)),!M.isRenderTargetTexture||M.image.tp_src||M.tp_src||(M.image.tp_src=g),M.isDataTexture&&M.image&&!M.image.tp_src&&(M.image.tp_src=_),M.image&&(R=M.image.tp_src_uuid,R=R?T[R]:void 0,R||(R=M.image.tp_src||M.image.src)),M.tp_src&&(R=M.tp_src)):typeof M=="string"?R=M:M.domainMin?(R=M.texture,M.texture.image&&!M.texture.image.tp_src&&(M.texture.image.tp_src=w),M.texture.image&&(R=M.texture.image.tp_src_uuid,R=R?T[R]:void 0,R||(R=M.texture.image.tp_src||M.texture.image.src))):M&&console.error("unknown value",M),R||(R=u),M.image&&!M.image.tp_src_uuid){const C=ns();M.image.tp_src_uuid=C,I[R]=C}return typeof R=="string"&&(R=T[R]??R),R},set:R=>{var k,j,H,X,ee,oe,re,he,le;const M=d[m],C=ue=>{d[m]=ue,ue!=null&&ue.isTexture&&(ue.flipY=ue.isDataTexture?ue.flipY:(M==null?void 0:M.flipY)??!0)};if(typeof R=="string")return void(typeof M=="string"&&C(R));if(!R)return void(i.value=u);if(R.isPlaceholder)return void(M&&(C(typeof M=="string"?"":null),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty()));let L=R.tp_src_uuid;if(L||(L=R.src??R.tp_src,L=I[L]??L,delete I[L],R.tp_src_uuid=L),L&&(T[L]=R),typeof M!="string"){if(!((M==null?void 0:M.image)===R||((k=M==null?void 0:M.image)==null?void 0:k.src)===R.src||((j=M==null?void 0:M.image)==null?void 0:j.tp_src)===R.tp_src&&R.tp_src!=null||((H=M==null?void 0:M.image)==null?void 0:H.tp_src)===R.src&&R.src!=null||((X=M==null?void 0:M.image)==null?void 0:X.src)===R.tp_src&&R.tp_src!=null))if(R instanceof File){const ue=t==null?void 0:t.getPlugin(Qt);if(!ue)throw"Viewer or AssetManagerPlugin not found";(ee=ue.importer)==null||ee.importSingle({file:R,path:R.src}).then(ge=>{var _e,Ee,Ye,We;if(ge){ge.isDataTexture&&(ge.needsUpdate=!0);const Et=(Ye=(Ee=(_e=R.src)==null?void 0:_e.split("?"))==null?void 0:Ee[0])==null?void 0:Ye.split(".").pop();ge.userData&&(ge.userData.mimeType||(ge.userData.mimeType="image/"+(["jpg","jpeg"].includes(Et)?"jpeg":"png"))),C(ge),[i.onChange].flat().forEach(lt=>typeof lt=="function"&&(lt==null?void 0:lt())),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty(),(We=i.uiRefresh)==null||We.call(i,"postFrame",!1)}})}else{const ue=new p.xEZ(R);ue.assetType="texture",ue.needsUpdate=!0;const ge=(he=(re=(oe=R.src)==null?void 0:oe.split("?"))==null?void 0:re[0])==null?void 0:he.split(".").pop();ue.userData.mimeType||(ue.userData.mimeType="image/"+(["jpg","jpeg"].includes(ge)?"jpeg":"png"));const _e=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(m);ue.colorSpace=_e?p.GUF:p.KI_,ue.wrapS=p.rpg,ue.wrapT=p.rpg,C(ue),[i.onChange].flat().forEach(Ee=>typeof Ee=="function"&&(Ee==null?void 0:Ee())),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty(),(le=i.uiRefresh)==null||le.call(i,"postFrame",!1)}}else C(L)}}),i.__property=i.property,i.property=void 0,i.label===void 0&&(i.label=m)}return(a=a??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],a.imageFit===void 0&&(a.imageFit="contain"),a.clickCallback===void 0&&(a.clickCallback=(d,m)=>{var I;const g=d==null?void 0:d.target,_=g==null?void 0:g.getBoundingClientRect();if(!_)return void m.click();const w=i.uiRef.controller_.valueController.value.rawValue,x=w===u||w!=null&&w.isPlaceholder?{}:{"remove image":()=>{var L;i.uiRef.controller_.valueController.value.setRawValue("");const[R,M]=i.property||i.__property||[i,"value"],C=typeof R[M]=="string";R[M]=C?"":null,[i.onChange].flat().forEach(k=>typeof k=="function"&&(k==null?void 0:k())),typeof(R==null?void 0:R.setDirty)=="function"&&R.setDirty(),(L=i.uiRefresh)==null||L.call(i,"postFrame",!1),Ks.Remove()},"download image":async()=>{Ks.Remove();const[R,M]=i.property||i.__property||[i,"value"],C=R[M];if(!C)return;const L=(C==null?void 0:C.image)??i.uiRef.controller_.valueController.value.rawValue;let k=C.__rootBlob?C.__rootBlob.objectUrl||URL.createObjectURL(C.__rootBlob):C.userData.rootPath||(L==null?void 0:L.src);L&&(L instanceof ImageBitmap||L instanceof HTMLImageElement||L instanceof HTMLVideoElement)&&!k&&(k=(0,V.imageBitmapToBase64)(L));let j=C.__rootBlob?C.__rootBlob.name||"image."+(C.__rootBlob.ext||"png"):null;if(!k&&C.isRenderTargetTexture){const X=C.__target;if(C.type===p.ywz)k=t.renderer.renderTargetToDataUrl(X,"image/png",90,Array.isArray(C.__target.texture)?C.__target.texture.indexOf(C):void 0),j="renderTarget.png";else{const ee=new Kw().parse(t.renderer.rendererObject,X,{textureIndex:Array.isArray(C.__target.texture)?C.__target.texture.indexOf(C):void 0}),oe=new Blob([ee],{type:"image/x-exr"});if(!oe)return void console.error("cannot export render target",L,R[M],R,M,i);j="renderTarget.exr",k=URL.createObjectURL(oe)}}if(!k&&C.isDataTexture){const X=new Kw().parse(void 0,C),ee=new Blob([X],{type:"image/x-exr"});if(!ee)return void console.error("cannot export data texture",L,R[M],R,M,i);j="dataTexture.exr",k=URL.createObjectURL(ee)}if(!k)return void console.error("cannot export image",L,R[M],R,M,i);const H=document.createElement("a");document.body.appendChild(H),H.style.display="none",H.href=k,H.download=j||(k.startsWith("data:")?"image.png":k.split("/").pop()??"image.png"),H.target="_blank",H.click(),document.body.removeChild(H)}},T=Ks.Create({...x,"set/replace image":()=>{m.click(),Ks.Remove()},"from url":async()=>{var k,j;let R="";if(R=await o.prompt("Load texture: Enter Image/Texture URL",R,!0),!R||!R.startsWith("http")&&!R.startsWith("data:image"))return R!==null&&await o.alert("Loading Image: Invalid URL"),void Ks.Remove();R=R.trim();const[M,C]=i.property||i.__property||[i,"value"],L=M[C];if(typeof L=="string")M[C]=R,[i.onChange].flat().forEach(H=>typeof H=="function"&&(H==null?void 0:H())),typeof(M==null?void 0:M.setDirty)=="function"&&M.setDirty(),(k=i.uiRefresh)==null||k.call(i,"postFrame",!1);else{const H=t==null?void 0:t.getPlugin(Qt);if(!H)throw"Viewer or AssetManagerPlugin not found";(j=H.importer)==null||j.importSinglePath(R).then(X=>{var ee;if(X){X.isDataTexture?X.needsUpdate=!0:X&&(L==null?void 0:L.flipY)!==void 0&&(X.flipY=L.flipY);const oe=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(C);X.colorSpace=oe?p.GUF:p.KI_,M[C]=X,[i.onChange].flat().forEach(re=>typeof re=="function"&&(re==null?void 0:re())),typeof(M==null?void 0:M.setDirty)=="function"&&M.setDirty(),(ee=i.uiRefresh)==null||ee.call(i,"postFrame",!1)}else console.warn("Failed to load texture",R)})}Ks.Remove()},cancel:()=>{Ks.Remove()}},2,_.height+8);(I=g.parentElement)==null||I.appendChild(T),_.y>.7*document.body.clientHeight&&(T.style.top="auto",T.style.bottom=_.height+8+"px")}),a.view="input-image",Zu(n,i,o,a)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var i;const t=(i=this._viewer)==null?void 0:i.getPlugin(e);if(!t)return void console.warn("plugin not found:",e);this._plugins.push(t),t.uiConfig&&(t.uiConfig.limitedUi=!0),t.uiConfig&&t.uiConfig.hidden===void 0&&(t.uiConfig.hidden=!1),this._appendUiObject(t);const n=t.uiConfig;if(n!=null&&n.uiRef&&t.toJSON){const o=typeof t.toJSON=="function"?t.toJSON():null;t.resetDefaults=async()=>{var u,d;await((u=t.fromJSON)==null?void 0:u.call(t,o)),(d=n.uiRefresh)==null||d.call(n,"postFrame",!0)};const a=n.uiRef.controller_.view.element,c=(0,V.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});c.onclick=u=>{const d={};typeof t.toJSON=="function"&&(d["download preset"]=async()=>{var _,w;const g=(w=(_=this._viewer)==null?void 0:_.getPlugin(Qt))==null?void 0:w.exportPluginPreset(t);await(0,V.downloadBlob)(new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),"preset."+t.constructor.PluginType+".json"),Ks.Remove()}),typeof t.fromJSON=="function"&&(d["upload preset"]=async()=>{var T,I,R;Ks.Remove();const g=await(0,V.uploadFile)(!1,!1);if(g.length===0)return;const _=g[0],w=await _.text(),x=JSON.parse(w);await((I=(T=this._viewer)==null?void 0:T.getPlugin(Qt))==null?void 0:I.importPluginPreset(x,t)),(R=n.uiRefresh)==null||R.call(n,"postFrame",!0)},o&&(d["reset defaults"]=async()=>{var g;Ks.Remove(),await((g=t.resetDefaults)==null?void 0:g.call(t))}));const m=Ks.Create(d,a.clientWidth-120,12);a.append(m),u.preventDefault()},a.appendChild(c)}return n}setupPlugins(...e){e.forEach(t=>this.setupPluginUi(t))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var n;const t=e.uiConfig;t&&((0,V.getOrCall)(t.hidden)!==!0?(n=t.uiRefresh)==null||n.call(t,"postFrame",!0):t.uiRef&&(t.uiRef.hidden=!0))})}_colorModeChanged(){document.body.classList.remove("tpTheme-black","tpTheme-white","tpTheme-blue"),document.body.classList.add("tpTheme-"+this.colorMode),localStorage&&localStorage.setItem("tpTheme",this.colorMode)}}A0.PluginType="TweakpaneUi",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([(0,V.onChange)(A0.prototype._colorModeChanged)],A0.prototype,"colorMode",void 0);class sb extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.scene.backgroundIntensity)??1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0},{type:"checkbox",label:"Fixed Env Direction",property:[this,"sceneEnvironmentFixedDirection"]},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.renderer.useLegacyLights)??!0},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.scene.backgroundColor)==null?void 0:n.getHex(p.KI_);return e!==void 0&&(this._savedBg=!0),e||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new p.Ilk),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var t;const e=(t=this._viewer)==null?void 0:t.scene.background;return e&&(e.isTexture||e.assetType==="texture")?e:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get sceneEnvironment(){var e;return((e=this._viewer)==null?void 0:e.scene.environment)||null}set sceneEnvironment(e){this._viewer&&(this._viewer.scene.environment=e)}get sceneEnvironmentRotation(){var e,t;return((t=(e=this._viewer)==null?void 0:e.scene.environment)==null?void 0:t.rotation)??0}set sceneEnvironmentRotation(e){var n,i;const t=(n=this._viewer)==null?void 0:n.scene.environment;t&&(t.rotation=e,(i=this._viewer)==null||i.scene.setDirty())}get sceneEnvironmentIntensity(){var e;return((e=this._viewer)==null?void 0:e.scene.envMapIntensity)??1}set sceneEnvironmentIntensity(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.envMapIntensity=e)}get sceneEnvironmentFixedDirection(){var e;return((e=this._viewer)==null?void 0:e.scene.fixedEnvMapDirection)??!1}set sceneEnvironmentFixedDirection(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.fixedEnvMapDirection=e)}get envmapBg(){var e,t,n;return((e=this._viewer)==null?void 0:e.scene.background)==="environment"||((t=this._viewer)==null?void 0:t.scene.background)===((n=this._viewer)==null?void 0:n.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const t=this._viewer.scene.background;t&&t!==this._viewer.scene.environment&&t!=="environment"&&(this.lastBgVal=t),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}),e.scene.addEventListener("environmentChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)})}}sb.PluginType="SimpleBackgroundEnvUiPlugin1";class ob extends En{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene",children:[],onExpand:()=>{var e,t;(t=(e=this._uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)==null||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig):this._uiConfig}_sceneUpdate(){}}ob.PluginType="SimpleUi";var UL=__webpackgi_require__(1),NL=__webpackgi_require__.n(UL)();class ab extends En{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,V.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(t,n)=>(t.push({text:n.name||"unnamed",id:n.uuid,children:n.children.reduce(this._buildData,[])}),t),this._findVisible=(t,n)=>(n.visible&&(n.children.length<1?t.push(n.uuid):t.push(...n.children.reduce(this._findVisible,[]))),t),this._setVisible=t=>{var n;(n=this._viewer)==null||n.doOnce("postFrame",()=>{var a,c,u;const i=(a=this._viewer)==null?void 0:a.scene.modelRoot;if(!i||t==null)return;const o=new Set;i.traverse(d=>{d!==i&&(d.visible=t.includes(d.uuid),d.visible&&d.traverseAncestors(m=>o.add(m)))}),o.forEach(d=>d.visible=!0),(u=(c=this._viewer)==null?void 0:c.scene)==null||u.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=e,this.reset=this.reset.bind(this),(0,V.createStyles)(V.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: var(--tp-container-foreground-color, hsl(230, 7%, 75%));
  margin-top: 0;
}
.treejs .treejs-switcher:before {
    border-top: 6px solid var(--tp-container-foreground-color, hsl(230, 7%, 75%)) !important;
}
        `)}reset(e){var a;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const t=(a=this._viewer)==null?void 0:a.scene.modelRoot;if(!t)return;const n=t.children.reduce(this._buildData,[]),i=t.children.reduce(this._findVisible,[]);let o=!1;return new Promise((c,u)=>{this.treeView=new NL(this.hierarchyDiv,{closeDepth:1,data:n,loaded:function(){this.values=i,c()},onChange:()=>{o?(0,V.timeout)(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):o=!0},onItemLabelClick:d=>{var g;const m=(g=this._viewer)==null?void 0:g.scene.modelRoot.modelObject.getObjectByProperty("uuid",d);m&&t.visible&&m.dispatchEvent({type:"select",value:m,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}ab.PluginType="HierarchyUiPlugin";class lb extends En{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new ji;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const e=new Ud;e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const e=new fu;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const e=new yo;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,e.lookAt(0,0,0),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Qt],this._sceneUpdate=e=>{var n,i,o;if(!e.hierarchyChanged)return;const t=[];(n=this._viewer)==null||n.traverseSceneObjects(a=>{if(!a.lightObject)return;const c=a.uiConfig;c&&!t.includes(c)&&t.push(c)}),[...this.uiConfig.children].forEach(a=>{(a==null?void 0:a.type)==="button"||t.includes(a)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(a),1)}),t.forEach(a=>{this.uiConfig.children.includes(a)||this.uiConfig.children.push(a)}),(o=(i=this.uiConfig).uiRefresh)==null||o.call(i,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}lb.PluginType="SimpleLightsUi";class cb extends En{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var n;if(!this._viewer)return;const e=this._viewer.createCamera(new p.cPb(45,1,.5,20));this._viewer.scene.modelRoot.add(e.cameraObject),e.setCameraOptions({controlsMode:"orbit"}),e.position.set(2,2,2),e.target.set(0,0,0),e.positionUpdated(!0),e.cameraObject.lookAt(0,0,0),e.setDirty();const t=this._viewer.getPluginByType("VirtualCamerasPlugin");if(t){const i=t.addCamera(e),o=(n=this._viewer)==null?void 0:n.getPluginByType("debug");o&&o.addTexture("camera frame",()=>i.target.texture,[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[Qt],this._sceneUpdate=e=>{var n,i,o;if(!e.hierarchyChanged)return;const t=[];(n=this._viewer)==null||n.traverseSceneObjects(a=>{if(!a.cameraObject)return;const c=a.uiConfig;c&&!t.includes(c)&&t.push(c)}),[...this.uiConfig.children].forEach(a=>{(a==null?void 0:a.type)==="button"||t.includes(a)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(a),1)}),t.forEach(a=>{this.uiConfig.children.includes(a)||this.uiConfig.children.push(a)}),(o=(i=this.uiConfig).uiRefresh)==null||o.call(i,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}cb.PluginType="SimpleSceneCamerasUi";var Fp,b0=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Rc=Fp=class extends En{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(s=!0){if(!this._viewer)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const e={width:Math.floor(this.width),height:Math.floor(this.height)},t=this._viewer.container.getBoundingClientRect(),n={width:Math.floor(t.width),height:Math.floor(t.height)};let i=1;if(e.width>n.width){const o=e.width;e.width=n.width;const a=e.width/o;if(e.height=Math.floor(e.height*a),i/=a,i>Fp.MaxCanvasScale)return this.width=n.width*Fp.MaxCanvasScale,console.log("loop",this.width,n.width,i),void this._sizeChanged()}if(e.height>n.height){const o=e.height;e.height=n.height;const a=e.height/o;if(e.width=Math.floor(e.width*a),i/=a,i>Fp.MaxCanvasScale)return this.height=n.height*Fp.MaxCanvasScale,console.log("loop",this.width,n.width,this.height,n.height,i),void this._sizeChanged()}(e.width>=n.width||e.width<1)&&delete e.width,(e.height>=n.height||e.height<1)&&delete e.height,this._viewer.setSize(e),this._setScale(i),s&&(this.scale=i),this._refresh()}_setScale(s){this._viewer&&(this._viewer.renderer.displayCanvasScaling=s)}_scaleChanged(){if(!this._viewer)return;const s=this.scale;if(Math.abs(s-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const e=this.width/this.height,t=this._viewer.container.getBoundingClientRect(),n=Math.floor(t.width*s),i=Math.floor(n/e);this.width=n,this.height=i,this._sizeChanged(!1)}async onAdded(s){await super.onAdded(s);const e=s.canvas.clientWidth,t=s.canvas.clientHeight,n=s.renderer.displayCanvasScaling;this.width=e,this.height=t,this.scale=n,s.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",()=>this._sizeChanged(!0)),this._refresh()}async onRemove(s){return s.renderer.removeEventListener("resize",this._refresh),super.onRemove(s)}_refresh(){var s,e;(e=(s=this.uiConfig)==null?void 0:s.uiRefresh)==null||e.call(s,"postFrame",!0)}fromJSON(s,e){if(!s.mode)if(s.width||s.height){const t=this._viewer.container.getBoundingClientRect();s.width||(s.width=t.width),s.height||(s.height=t.height),s.scale&&(s.width*=s.scale,s.height*=s.scale,delete s.scale),s.width=Math.round(s.width),s.height=Math.round(s.height),s.mode="custom"}else s.mode="full";return super.fromJSON(s,e)}toJSON(s){const e=super.toJSON(s);return e.mode==="full"&&(delete e.width,delete e.height),e.mode==="custom"&&delete e.scale,e}};Rc.PluginType="RendererParamsUiPlugin",Rc.MaxCanvasScale=5,b0([Ae("version")],Rc.prototype,"_serializeVersion",void 0),b0([Ae(),Uo("Mode",["full","custom"].map(s=>({label:s}))),(0,V.onChange2)(Fp.prototype._sizeChanged)],Rc.prototype,"mode",void 0),b0([Ae(),cn("Width",void 0,1,s=>({onChange:()=>s._sizeChanged(),hidden:()=>s.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=s._viewer)==null?void 0:e.container.getBoundingClientRect().width)||1024)+2))]}}))],Rc.prototype,"width",void 0),b0([Ae(),cn("Height",void 0,1,s=>({onChange:()=>s._sizeChanged(),hidden:()=>s.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=s._viewer)==null?void 0:e.container.getBoundingClientRect().height)||1024)+2))]}}))],Rc.prototype,"height",void 0),b0([Ae(),(0,V.onChange)(Fp.prototype._scaleChanged),cn("Scale",[.25,Fp.MaxCanvasScale],.001,s=>({disabled:()=>s.mode==="custom"}))],Rc.prototype,"scale",void 0),Rc=Fp=b0([Hn("Renderer")],Rc);class ub extends En{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var n;const t=super.toJSON(e);return t.activeCamera=(n=this._viewer)==null?void 0:n.scene.activeCamera.toJSON(),t}fromJSON(e,t){var n;return e.activeCamera&&((n=this._viewer)==null||n.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)==null?void 0:e.scene.activeCamera.uiConfig)||{}}}ub.PluginType="CameraUiPlugin";var FL={create:s=>{let e="button"+(s.type?" "+s.type:""),t=vi.createDiv(e,s.text);return t.addEventListener("click",s.onClick),t}};let vl={createElement:(s,e,t,n)=>{let i=document.createElement(s);if(e&&(i.className=e),t&&(i.innerHTML=t),n)for(let o in n)i.setAttribute(o,n[o]);return i},createDiv:(s,e,t)=>vl.createElement("div",s,e,t),createDomTree:s=>{if(!s||!s.hasOwnProperty("dom"))return s;let e=s.dom;if(s.children)for(let t in s.children)s.children[t]&&e.appendChild(vl.createDomTree(s.children[t]));return e},removeElement:s=>{s!=null&&s.parentNode.removeChild(s)},appendToBody:s=>{document.body.appendChild(s)},makeIconHTML:s=>{let e="";return s=="ok"&&(e="#tick"),s=="error"&&(e="#cancel"),s=="info"&&(e="#info-button"),s=="caution"&&(e="#danger"),s=="min"&&(e="#line"),s=="close"&&(e="#close"),`<svg class="icon ${s}"><use xlink:href="${e}" /></svg>`},makeNftContent:s=>{let e=null;if(s.type){let t=null;t=typeof s.content=="string"?vl.createDiv("inner-content",s.content):vl.createDomTree({dom:vl.createDiv("inner-content"),children:[s.content]}),e=s.type=="text"?vl.createDomTree({dom:vl.createDiv("content text"),children:[t]}):vl.createDomTree({dom:vl.createDiv("content"),children:[vl.createDiv("state",vl.makeIconHTML(s.type)),t]})}else typeof s.content=="string"&&(e=vl.createDiv("content",s.content));return e},standardizeButtons:(s,e)=>{let t=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||t.push({key:27,text:"Cancel",onClick:s.close.bind(s,"cancel")}),t.push({key:13,text:"OK",type:"main",onClick:s.close.bind(s,"ok")}),t;t=e.buttons,t.constructor!==Array&&(t=[t]);for(let n in t)!t[n].onClick&&(t[n].onClick=s.close.bind(s,t[n].id));return t},makeButtons:s=>{let e=[];if(s)for(let t in s)e.push(FL.create({text:s[t].text?s[t].text:"OK",type:s[t].normal?null:"main",onClick:s[t].onClick}));return vl.createDomTree({dom:vl.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:s=>{let e=t=>{for(let n in s)if(s[n].key===t.keyCode)return void s[n].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:s=>{window.removeEventListener("keydown",s)}};var vi=vl,eo=__webpackgi_require__(476),Ia={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let $u={};$u.overlay_in=[new eo.Frame(Ia["wwise-overlay-in-1"],0),new eo.Frame(Ia["wwise-overlay-in-2"],400)],$u.overlay_out=[new eo.Frame(Ia["wwise-overlay-out-1"],300)],$u.pop_in=[new eo.Frame(Ia["wwise-pop-in-1"],0),new eo.Frame(Ia["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new eo.Frame(Ia["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new eo.Frame(Ia["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],$u.pop_out=[new eo.Frame(Ia["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],$u.flip_in=[new eo.Frame(Ia["wwise-flip-in-1"],0),new eo.Frame(Ia["wwise-flip-in-2"],500)],$u.flip_out=[new eo.Frame(Ia["wwise-flip-out-1"],400)],$u.min_in=[new eo.Frame(Ia["wwise-min-in-1"],0),new eo.Frame(Ia["wwise-min-in-2"],350)],$u.min_out=[new eo.Frame(Ia["wwise-min-out-1"],400)];let dP=["top","bottom","left","right"];for(let s in dP){let e=dP[s];$u[e+"_in"]=[new eo.Frame(Ia["wwise-"+e+"-in-1"],0),new eo.Frame(Ia["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],$u[e+"_out"]=[new eo.Frame(Ia["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var P1=$u;let jL={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class oC{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let i=e.getElementsByClassName("content")[0];return i&&(i=i.innerHTML),vi.removeElement(e),t.title=n,t.content=i,new oC(t)}constructor(e){this.options=JSON.parse(JSON.stringify(jL));for(let u in e)e[u]!=null&&(this.options[u]=e[u]);let t=this.options.position;if(t.indexOf(" ")==-1&&(t=="left"||t=="right"?t+=" center":t=t=="top"||t=="bottom"?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let u=document.getElementsByClassName("wwise-overlay");u.length?(this.overlay=u[0],this.hasOverlay=!0):(this.overlay=vi.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let u=[];this.options.topbar.showMin&&(u.push(vi.createDiv(null,vi.makeIconHTML("min"))),u[u.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(u.push(vi.createDiv(null,vi.makeIconHTML("close"))),u[u.length-1].addEventListener("click",this.close.bind(this,void 0)));let d=null;d=typeof this.options.title=="string"?vi.createDiv("title",this.options.title):vi.createDomTree({dom:vi.createDiv("title"),children:[this.options.title]}),this.topbar=vi.createDomTree({dom:vi.createDiv("topbar"),children:[{dom:vi.createDiv("control"),children:u.map(m=>({dom:m}))},{dom:d},{dom:vi.createDiv("clear")}]})}else n+=" no-topbar";typeof this.options.content=="string"?this.content=vi.createDomTree({dom:vi.createDiv(n,this.options.content)}):this.content=vi.createDomTree({dom:vi.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=vi.createDomTree({dom:vi.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let i=vi.createDiv("wwise-wrapper");this.options.zIndex&&(i.style.zIndex=this.options.zIndex),this.wrapper=vi.createDomTree({dom:i,children:[this.window]}),this.dom=vi.createDomTree({dom:vi.createDiv(),children:[this.wrapper]});let o=this.options.position.split(" "),a=-50,c=-50;if(o[0]=="left"?(a=0,this.wrapper.classList.add("left")):o[0]=="right"?(a=-100,this.wrapper.classList.add("right")):o[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=o[0],o[1]=="top"?(c=0,this.wrapper.classList.add("top")):o[1]=="bottom"?(c=-100,this.wrapper.classList.add("bottom")):o[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${a}%, ${c}%)`,this.options.style)for(let u in this.options.style)this.window.style[u]=this.options.style[u];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(n=>{this.promiseResolve=n}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new eo.Queue(this.wrapper,P1[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&n.push(new eo.Queue(this.overlay,P1.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new eo.Queue(this.wrapper,P1[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&n.push(new eo.Queue(this.overlay,P1.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(vi.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),vi.appendToBody(this.dom)}removeDoms(){vi.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(vi.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),i=this.options.draggable,o=parseFloat(n.left),a=parseFloat(n.top);if(n.left.indexOf("%")!=-1){o=n.left,o=o.substr(0,o.length-1),o=parseInt(o);let c=window,u=document,d=u.documentElement,m=u.getElementsByTagName("body")[0];o=o*(c.innerWidth||d.clientWidth||m.clientWidth)/100}if(n.top.indexOf("%")!=-1){a=n.top,a=a.substr(0,a.length-1),a=parseInt(a);let c=window,u=document,d=u.documentElement,m=u.getElementsByTagName("body")[0];a=a*(c.innerHeight||d.clientHeight||m.clientHeight)/100}i!=1&&i!="horizontal"||(this.wrapper.style.left=o+t.x+"px"),i!=1&&i!="vertical"||(this.wrapper.style.top=a+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&t.nodeName!="HTML"||(this.inDragging=!1)}}var zL=oC,aC=class{constructor(s){let e=this.options=s;!e.type&&(e.type="ok");let t={topbar:!1};t.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),t.overlay=!0,t.keepOverlay=e.keepOverlay,t.clickOverlayToClose=!1,t.animation=e.animation,t.zIndex=e.zIndex,this.wwise=new zL(t)}constructContent(s){let e=vi.createDiv("modal"),t=vi.createDomTree({dom:vi.createDiv("main "+s.type),children:[vi.createDiv(null,vi.makeIconHTML(s.type)),vi.createDiv("title",s.title),vi.createDiv("text",s.text)]});this.buttonArr=vi.standardizeButtons(this,s);let n=vi.makeButtons(this.buttonArr),i=null;s.content&&(i=typeof s.content=="string"?vi.createDiv(null,s.content):s.content);let o=null;return n.innerHTML&&(o=vi.createDomTree({dom:vi.createDiv("operation "+s.type),children:[n]})),i||o||t.classList.add("no-op"),vi.createDomTree({dom:e,children:[t,i,o]})}open(){if(this.wwise.opened)return;let s=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=vi.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),s}close(s){if(this.wwise.opened)return this.value=s,vi.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let VL={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},GL={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var R1=__webpackgi_require__(513),hb={};R1.Z&&R1.Z.locals&&(hb.locals=R1.Z.locals);var lC,cC=0,Ev={};Ev.styleTagTransform=tm(),Ev.setAttributes=$f(),Ev.insert=function(s,e){(e.target||document.head).appendChild(s)},Ev.domAPI=Zf(),Ev.insertStyleElement=em(),hb.use=function(s){return Ev.options=s||{},cC++||(lC=Jf()(R1.Z,Ev)),hb},hb.unuse=function(){cC>0&&!--cC&&(lC(),lC=null)};var HL=hb;class uC extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},vi.appendToBody=t=>{t.style.zIndex="100",e.container.appendChild(t)},vi.makeIconHTML=t=>"",HL.use({target:e.container}),e.alert=async t=>{const n=t==null?void 0:t.split(":")[0],i=new aC({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n+":","").replace(/(\r?\n)/gm,"<br>"))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return i.open(),i.getPromise()},e.confirm=async t=>{const n=t==null?void 0:t.split(":")[0],i=new aC({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return i.open(),await i.getPromise()==="yes"},e.prompt=async(t,n,i=!0)=>{const o=t==null?void 0:t.split(":")[0],a=new class{constructor(c){this.options=JSON.parse(JSON.stringify(VL));for(let g in c)c[g]!=null&&(this.options[g]=c[g]);let u=this.options,d=JSON.parse(JSON.stringify(GL));for(let g in d)u.hasOwnProperty(g)&&(d[g]=u[g]);let m=[];u.showCancel&&m.push({key:27,text:u.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),m.push({key:13,text:u.okText,onClick:this.handleOk.bind(this)}),d.buttons=m,this.input=vi.createElement("input","input",null,{placeholder:u.placeholder}),this.error=vi.createDiv("error"),d.content=vi.createDomTree({dom:vi.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new aC(d)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},c=>{this.error.innerText=c}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let c=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((u,d)=>{this.promiseResolve=u,this.promiseReject=d}),c}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:o??"&ndsp;",placeholder:n??"",showCancel:i,animation:"overlay",text:(t==null?void 0:t.replace(o||"","").replace(":",""))||""});return a.open(),await a.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}uC.PluginType="WindowiseDialogPlugin";var D1=__webpackgi_require__(729),db={};D1.Z&&D1.Z.locals&&(db.locals=D1.Z.locals);var hC,dC=0,Sv={};Sv.styleTagTransform=tm(),Sv.setAttributes=$f(),Sv.insert=function(s,e){(e.target||document.head).appendChild(s)},Sv.domAPI=Zf(),Sv.insertStyleElement=em(),db.use=function(s){return Sv.options=s||{},dC++||(hC=Jf()(D1.Z,Sv)),db},db.unuse=function(){dC>0&&!--dC&&(hC(),hC=null)};var QL=db;function pP(){QL.use(),IC.use()}async function fP(s,e=void 0,t=[]){var T,I;zu.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>s.container});const n=(0,V.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),i=(0,V.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,V.getUrlQueryParam)("logo-img")&&(i.style.backgroundImage=`url(${(0,V.getUrlQueryParam)("logo-img")})`),i.onclick=()=>{window.open((0,V.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const o=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;s.container.appendChild(i),zu(i,{placement:"right",content:"Powered by WebGi SDK"});const a=(0,V.createDiv)({innerHTML:o,id:"fsToggle",classList:["round-button"],addToBody:!1});a.dataset.tippyContent="Full-Screen",(T=s.getPlugin(Jr))==null||T.addEventListener("enter",()=>{a.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,a.dataset.tippyContent="Exit Full-Screen"}),(I=s.getPlugin(Jr))==null||I.addEventListener("exit",()=>{a.innerHTML=o,a.dataset.tippyContent="Full-Screen"}),a.onclick=()=>{var R;(R=s.getPlugin(Jr))==null||R.toggle(s.container)},s.container.appendChild(a),zu(a,{placement:"left"});const c=(0,V.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});s.container.appendChild(c);const u=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var M;if(!await s.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const R=w.map(C=>s.getPlugin(C));for(const C of R)await((M=C==null?void 0:C.resetDefaults)==null?void 0:M.call(C))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await s.confirm("Clear scene: Are you sure you want to clear the scene?")&&s.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var R;await s.fitToView((R=s.getPlugin(Ti))==null?void 0:R.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{s.getPlugin(lr)&&(s.getPlugin(lr).viewLooping=!s.getPlugin(lr).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var R;(R=s.getPlugin(sr))==null||R.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const R=s.scene.activeCamera.controls;R&&R.autoRotate!==void 0&&(R.autoRotate=!R.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const R=s.getPlugin(Ul);R?await R.downloadSnapshot():s.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const R=s.getPlugin(nm);R?await(R==null?void 0:R.downloadSceneGlb()):s.console.error("AssetExporterPlugin not added")}}];for(const R of u){const M=(0,V.createDiv)({innerHTML:R.icon,id:R.id,classList:["button-bar-button","util-button"],addToBody:!1});M.dataset.tippyContent=R.tooltip,M.onclick=()=>{R.toggle&&M.classList.toggle("button-bar-selected-box"),R.onclick()},c.appendChild(M)}AE(zu(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const d=s.getPlugin(Ti),m=s.getPlugin(ps);for(const[R,M]of Object.entries(e??{})){const C=t.find(L=>L.title===R);C?C.plugins.push(...M):t.push({title:R,plugins:[...M]})}let g=t[2],_=[];const w=t.reduce((R,M)=>R.concat(M.plugins),[]);function x(R){var M;g=R,d&&(d.enabled=!0),m&&(["Viewer"].includes(g.title)?m.enable("modesUi"):m.disable("modesUi")),_=[];for(const C of w){const L=s.getPlugin(C);if(!(L!=null&&L.uiConfig))continue;const k=R.plugins.includes(C);(0,V.safeSetProperty)(L.uiConfig,"hidden",!k,!0),k&&_.push(L)}for(const C of t)(M=C.div)==null||M.classList[g!==C?"remove":"add"]("mode-button-selected","button-bar-selected");s.getPlugin(A0).refreshPluginsEnabled()}for(const R of t){const M=(0,V.createDiv)({innerHTML:R.title,classList:["mode-button","button-bar-button"]});M.onclick=()=>{x(R)},R.div=M,n.appendChild(M)}x(t[0]),d==null||d.addEventListener("selectedObjectChanged",()=>{d!=null&&d.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(g.title)&&x(t.find(R=>R.plugins.includes(Ti)))})}class pC extends En{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Color Scheme",type:"dropdown",children:["black","white","blue"].map(e=>({label:e})),getValue:()=>{var e,t;return(t=(e=this._viewer)==null?void 0:e.getPluginByType("TweakpaneUi"))==null?void 0:t.colorMode},setValue:e=>{var n;const t=(n=this._viewer)==null?void 0:n.getPluginByType("TweakpaneUi");t&&(t.colorMode=e)}}),()=>({label:"Shadow type",type:"dropdown",children:[["Basic",p._MY],["PCF",p._iA],["PCFSoft",p.ntZ],["VSM",p.dwk]].map(e=>({label:e[0],value:e[1]})),getValue:()=>{var e;return(e=this._viewer)==null?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var t;(t=this._viewer)==null||t.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var e;return{label:((e=this._viewer)!=null&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("rgbm",(n=this._viewer)!=null&&n.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("msaa",(n=this._viewer)!=null&&n.isAntialiased?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("depthPrepass",(n=this._viewer)!=null&&n.useGBufferDepth?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("debug",(n=this._viewer)!=null&&n.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Qt))==null?void 0:n.storage;if(e instanceof Storage)e.clear();else if(e instanceof Cache){const i=await e.keys();await Promise.all(i.map(async o=>e.delete(o)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var t;const e=new Set;(t=this._viewer)==null||t.scene.modelRoot.traverse(n=>n.geometry&&e.add(n.geometry)),e.forEach(n=>bd(n))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var t;const e=new Set;(t=this._viewer)==null||t.scene.modelRoot.traverse(n=>n.geometry&&e.add(n.geometry)),e.forEach(n=>{const i=new p.Pa4;n.center(i),i.negate(),n.userData.__appliedMeshes.forEach(o=>{o.updateMatrix(),o.position.copy(i).applyMatrix4(o.matrix),o.setDirty&&o.setDirty()})})}}]}}}pC.PluginType="ExtrasUiPlugin1";class fC extends p.Tme{constructor(e){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=Ba("Widget",this),this.object=e,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(e),this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(e){var t,n;return this.object&&this.detach(),this.object=e,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((n=(t=this.object.uiConfig)==null?void 0:t.children)==null||n.push(this.uiConfig)),this.visible=!0),this}detach(){var e,t,n,i;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const o=(t=(e=this.object.uiConfig)==null?void 0:e.children)==null?void 0:t.indexOf(this.uiConfig);o!==void 0&&o>=0&&((i=(n=this.object.uiConfig)==null?void 0:n.children)==null||i.splice(o,1))}this.object=void 0,this.visible=!1}return this}}(function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Gt()],fC.prototype,"visible",void 0);class mC extends fC{constructor(e){super(e),this.light=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}var gC=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class jp extends mC{constructor(e,t,n){super(e),this.lineWidth=5,this.size=.5,this._v1=new p.Pa4,this._v2=new p.Pa4,this._v3=new p.Pa4,this.color=n,t!==void 0&&(this.size=t);let i=new mA;this.material=new Su({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new LE(i,this.material),this.add(this.lightPlane),i=new mA,i.setPositions([0,0,0,0,0,1]),this.targetLine=new LE(i,this.material),this.add(this.targetLine),this.update(),this.traverse(o=>{o.userData.__keepShadowDef=!0,o.castShadow=!1,o.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(e){return e.isDirectionalLight}static Create(e){return new jp(e)}}gC([(0,V.onChange)(jp.prototype.update)],jp.prototype,"material",void 0),gC([(0,V.onChange)(jp.prototype.update),cn(void 0,[.1,20],.01)],jp.prototype,"lineWidth",void 0),gC([(0,V.onChange)(jp.prototype.update),cn(void 0,[.01,10],.01)],jp.prototype,"size",void 0);var vC=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class zp extends mC{constructor(e,t,n){super(e),this.lineWidth=5,this.size=.5,this.color=n,t!==void 0&&(this.size=t);const i=new z0(new p.xo$(.5,4,2));this.material=new Su({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new V0(i,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(o=>{o.userData.__keepShadowDef=!0,o.castShadow=!1,o.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){this.light&&this.lightSphere&&(this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(e){return e.isPointLight}static Create(e){return new zp(e)}}vC([(0,V.onChange)(zp.prototype.update)],zp.prototype,"material",void 0),vC([(0,V.onChange)(zp.prototype.update),cn(void 0,[.1,20],.01)],zp.prototype,"lineWidth",void 0),vC([(0,V.onChange)(zp.prototype.update),cn(void 0,[.01,10],.01)],zp.prototype,"size",void 0);var mP=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Cv extends mC{constructor(e,t,n){super(e),this.lineWidth=5,this._v1=new p.Pa4,this.color=n;let i=new Kd;const o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,c=1,u=32;a<u;a++,c++){const d=a/u*Math.PI*2,m=c/u*Math.PI*2;o.push(Math.cos(d),Math.sin(d),1,Math.cos(m),Math.sin(m),1)}i.setPositions(o),this.material=new Su({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new qw(i,this.material),this.add(this.cone),i=new mA,i.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(a=>{a.userData.__keepShadowDef=!0,a.castShadow=!1,a.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(e){return e.isSpotLight}static Create(e){return new Cv(e)}}mP([(0,V.onChange)(Cv.prototype.update)],Cv.prototype,"material",void 0),mP([(0,V.onChange)(Cv.prototype.update),cn(void 0,[.1,20],.01)],Cv.prototype,"lineWidth",void 0);class WL extends fC{constructor(e){super(e),this.camera=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}class _C extends WL{constructor(e){super(e),this._vector=new p.Pa4,this._camera=new p.V1s;const t=new Kd,n=new Su({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:i,colors:o,pointMap:a}=function(){const _=[],w=[],x={};function T(R,M){I(R),I(M)}function I(R){_.push(0,0,0),w.push(0,0,0),x[R]===void 0&&(x[R]=[]),x[R].push(_.length/3-1)}return T("n1","n2"),T("n2","n4"),T("n4","n3"),T("n3","n1"),T("f1","f2"),T("f2","f4"),T("f4","f3"),T("f3","f1"),T("n1","f1"),T("n2","f2"),T("n3","f3"),T("n4","f4"),T("p","n1"),T("p","n2"),T("p","n3"),T("p","n4"),T("u1","u2"),T("u2","u3"),T("u3","u1"),T("c","t"),T("p","c"),T("cn1","cn2"),T("cn3","cn4"),T("cf1","cf2"),T("cf3","cf4"),{vertices:_,colors:w,pointMap:x}}();t.setPositions(i),t.setColors(o),this.line=new qw(t,n),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=a,this.update();const c=new p.Ilk(16755200),u=new p.Ilk(16711680),d=new p.Ilk(43775),m=new p.Ilk(16777215),g=new p.Ilk(3355443);this.setColors(c,u,d,m,g)}setColors(e,t,n,i,o){const a=this.line.geometry,c=a.getAttribute("instanceColorStart"),u=a.getAttribute("instanceColorEnd");function d(m,g){c.setXYZ(m/2,g.r,g.g,g.b),u.setXYZ(m/2,g.r,g.g,g.b)}d(0,e),d(2,e),d(4,e),d(6,e),d(8,e),d(10,e),d(12,e),d(14,e),d(16,e),d(18,e),d(20,e),d(22,e),d(24,t),d(26,t),d(28,t),d(30,t),d(32,n),d(34,n),d(36,n),d(38,i),d(40,o),d(42,o),d(44,o),d(46,o),d(48,o),c.needsUpdate=!0,u.needsUpdate=!0}update(){if(!this.camera)return;const e=this.line.geometry,t=this.pointMap,{_camera:n,_vector:i}=this;n.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),to("c",t,e,n,0,0,-1,i),to("t",t,e,n,0,0,1,i),to("n1",t,e,n,-1,-1,-1,i),to("n2",t,e,n,1,-1,-1,i),to("n3",t,e,n,-1,1,-1,i),to("n4",t,e,n,1,1,-1,i),to("f1",t,e,n,-1,-1,1,i),to("f2",t,e,n,1,-1,1,i),to("f3",t,e,n,-1,1,1,i),to("f4",t,e,n,1,1,1,i),to("u1",t,e,n,.7,1.1,-1,i),to("u2",t,e,n,-.7,1.1,-1,i),to("u3",t,e,n,0,2,-1,i),to("cf1",t,e,n,-1,0,1,i),to("cf2",t,e,n,1,0,1,i),to("cf3",t,e,n,0,-1,1,i),to("cf4",t,e,n,0,1,1,i),to("cn1",t,e,n,-1,0,-1,i),to("cn2",t,e,n,1,0,-1,i),to("cn3",t,e,n,0,-1,-1,i),to("cn4",t,e,n,0,1,-1,i),e.getAttribute("instanceStart").needsUpdate=!0,e.getAttribute("instanceEnd").needsUpdate=!0,e.computeBoundingBox(),e.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(e){return e.isCamera}static Create(e){return new _C(e)}}function to(s,e,t,n,i,o,a,c){c.set(i,o,a).unproject(n);const u=e[s];if(u!==void 0){const d=t.getAttribute("instanceStart"),m=t.getAttribute("instanceEnd");for(let g=0,_=u.length;g<_;g++){const w=Math.floor(u[g]/2);(u[g]%2==0?d:m).setXYZ(w,c.x,c.y,c.z)}}}class Mv extends En{setDirty(){var e,t;(e=this.widgets)==null||e.forEach(n=>n.visible=this.enabled),(t=this._viewer)==null||t.setDirty()}constructor(e=!0){super(),this.enabled=!0,this.helpers=[jp,Cv,zp,_C],this.toJSON=null,this._addSceneObject=t=>{const n=t.object;this._createWidgets(n==null?void 0:n.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"enabled"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]},this.enabled=e}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(t=>t.dispose&&t.dispose()),this.widgets=[],super.onRemove(e)}refresh(){var e;this._createWidgets((e=this._viewer)==null?void 0:e.scene.modelRoot)}_createWidgets(e){e==null||e.traverse(t=>{const n=this.widgets.find(i=>i.object===t);if(n)return void(n.update&&n.update());this.helpers.filter(i=>i.Check(t)).forEach(i=>{var a;const o=i.Create(t);o.visible=this.enabled,this.widgets.push(o),(a=this._viewer)==null||a.scene.addWidget(o)})})}}Mv.PluginType="WidgetsPlugin",function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([(0,V.onChange)(Mv.prototype.setDirty)],Mv.prototype,"enabled",void 0);var qL=_n({defaultModifiers:[we,de,Ut,Lt]}),XL=__webpackgi_require__(388),YL=__webpackgi_require__.n(XL);function KL(s){const e=[];s.traverse(i=>{i.geometry&&e.push(i)});const t={},n={};e.forEach(i=>{if(!t[i.geometry.uuid]){const c=i.geometry.toJSON().data,u=c?YL()({a:c.attributes||{},b:c.index||[]}):"";t[i.geometry.uuid]=u}const o=t[i.geometry.uuid],a=n[o]??(n[o]=[]);a.includes(i)||a.push(i)}),Object.values(n).forEach(i=>{if(i.length<2)return;const o=i[0].geometry;i.forEach((a,c)=>{c<1||(a.geometry.dispose(),a.geometry=o)})})}const Vp=new p.Pa4,Tv=new p.Pa4,B1=new p.Pa4,yC=new p.Pa4,O1=new p.Pa4,w0=new p.Pa4;let AC=1;const JL=new p.Pa4(0,1,0);class ZL extends _m{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new p.Pa4(0,0,0);const n=this.update;this.update=()=>this._update(n)}_update(e){this.target.add(this.targetOffset),Vp.copy(this.object.position).sub(this.target),AC=Vp.length(),w0.copy(this.target);const t=e();return w0.sub(this.target),Vp.copy(this.object.position).sub(this.target),AC/=Vp.length(),this.target.add(w0),this.object.position.copy(this.target).add(Vp),Vp.normalize(),Tv.crossVectors(JL,Vp).normalize(),B1.crossVectors(Vp,Tv).normalize(),yC.crossVectors(Tv,B1).normalize().negate(),Tv.length()>.1&&this.object.up.crossVectors(Vp.clone().normalize(),Tv),this.enablePan&&(O1.set(0,0,0).addScaledVector(Tv,w0.x).addScaledVector(B1,w0.y).addScaledVector(yC,w0.z),this.targetOffset.add(O1),this.targetOffset.multiplyScalar(1/AC)),O1.set(0,0,0).addScaledVector(Tv,-this.targetOffset.x).addScaledVector(B1,-this.targetOffset.y).addScaledVector(yC,-this.targetOffset.z),this.object.lookAt(O1.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class L1 extends V.SimpleEventDispatcher{_setOptions(e){var t;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=L1.GetSupportedMimeTypes([],["h264"],!0)??L1.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!((t=this._options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=i=>{var o;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const a=new Blob(this._currentRecording,{type:this._options.mimeType});(o=this._recordingCallback)==null||o.call(this,a)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=i=>{var o;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((o=this._recorder)==null||o.pause())},this._onresume=i=>{if(!this.stepMode)return;const o=()=>{var c;this._state==="recording"&&((c=this._recorder)==null||c.pause())},a=Math.min(this._resumeSyncTime-(0,V.now)(),0)+1e3/this._options.frameRate;a>0?(0,V.timeout)(a).then(o):o()},this._onpause=i=>{},this._ondataavailable=i=>{i.data&&i.data.size>0&&this._currentRecording.push(i.data)},this._onerror=i=>{this._state="error",this._console.error(i),this.dispatchEvent({type:"error",error:i}),this._recorder=void 0},this._canvas=e;const n=t==null?void 0:t.mimeType;this._options={mimeType:n||"auto",frameRate:30,stepMode:!1},this._setOptions(t||this._options)}isRecording(){return this._state==="recording"}start(){var t,n,i;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const e={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(t=e.mimeType)==null?void 0:t.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const o=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),a=(n=o.getVideoTracks())==null?void 0:n[0];this._track=a,this._recorder=new window.MediaRecorder(o,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(i=this._recorder)==null||i.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async o=>{const a=await(o==null?void 0:o.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=a,this._state="recording",this._onstart({})}).catch(o=>{this._onerror({detail:o})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,V.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([i,o])=>await(await fetch(o)).blob())),n=[];for(let i=0;i<e.length;i++){const o=await this._imgDirectory.getFileHandle(e[i][0],{create:!0});n.push((0,V.writeFile)(o,t[i]))}await Promise.all(n)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter(c=>!e||e.length<1||e.includes(c)),o=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(c=>!t||t.length<1||t.includes(c)),a=[];return i.forEach(c=>{const u=`video/${c}`;o.forEach(d=>{[`${u};codecs=${d}`,`${u};codecs:${d}`,`${u};codecs=${d.toUpperCase()}`,`${u};codecs:${d.toUpperCase()}`,`${u}`].forEach(m=>{MediaRecorder.isTypeSupported(m)&&a.push(m)})})}),n?a.length>0?a[0]:void 0:a}}class $L extends G0{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new p.cJO(1,0))}}function bC(s,e){const t=Array.from((s.access??"").split(".")),n=t.pop();let i=s.targetObject??e;if(!n||n.length===0)return{key:void 0,tar:i};if(i=(0,V.deepAccessObject)(t,i),i&&!(n in i))throw console.error("invalid key",n,i,e,s),"";return{key:n,tar:i}}function wC(s,e,t,n){const{key:i,tar:o}=bC(s,e);return i&&o?__(o,i,()=>{var a;t&&((a=s.updater)!=null&&a.length)&&s.updater.forEach(c=>t[c]()),n==null||n()}):a=>console.warn("Unable to set ",a,i,o,s,e)}async function k1(s,e,t){const{key:n,tar:i}=bC(e,s),o=e.animSet?[gP(i,e.animSet,t,e.animSetParallel??!1)]:[];if(n&&i){const a=e.updater??[],c=async()=>wg(i,n,{...e,onUpdate:u=>{var d;(d=e.onUpdate)==null||d.call(e,u),a.forEach(m=>{var g;return(g=t[m])==null?void 0:g.call(t)})}});e.delay?o.push((0,V.timeout)(e.delay).then(c)):o.push(c())}else(e.duration||e.delay)&&o.push((0,V.timeout)((e.delay??0)+(e.duration??0)));return o.length===1?o[0]:Promise.all(o)}async function gP(s,e,t,n=!1){if(n)return Promise.all(e.map(async i=>k1(s,i,t)));for(const i of e)await k1(s,i,t)}function vP(s,e,t,n){var a,c;if(!s)return;e||(e=[]);const i=n??{},o=s;for(let u=0,d=e.length;u<d;u++){const m=e[u];if(m.uiRef){const _=(o==null?void 0:o.indexOf(m.uiRef))??-1;_!==u&&(_>=0&&(o==null||o.splice(_,1)),o==null||o.splice(u,0,m.uiRef))}else{m.uiRef={type:"folder",label:m.name??"Animation "+u,children:[]};const _=[{type:"button",label:"animate",value:()=>{k1(t,m,i).then(()=>{var w;return console.log(((w=m.uiRef)==null?void 0:w.label)+" finished")})}}];m.access!==void 0&&_.push({type:"input",property:[m,"access"]}),m.from!==void 0&&_.push({type:m.uiObjectType??"input",property:[m,"from"],onChange:()=>{var w;wC(m,t)(m.from),(w=m.updater)==null||w.forEach(x=>x in i&&i[x]())}}),m.to!==void 0&&_.push({type:m.uiObjectType??"input",property:[m,"to"],onChange:()=>{var w;wC(m,t)(m.to),(w=m.updater)==null||w.forEach(x=>x in i&&i[x]())}}),m.duration!==void 0&&_.push({type:"input",property:[m,"duration"]}),m.animSet&&(m.animSetParallel||(m.animSetParallel=!1),_.push({type:"input",label:"run parallel",property:[m,"animSetParallel"]})),m.animSet&&_.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(a=m.uiRef.children)==null||a.push(..._),o==null||o.splice(u,0,m.uiRef)}const g=(c=m.uiRef.children)==null?void 0:c.map(_=>(0,V.getOrCall)(_)).flat(2).find(_=>_==null?void 0:_.animSetContainer);m.animSet&&g&&vP(g.children,m.animSet,m.targetObject??t,n)}}const xC=new TextEncoder,ek={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},tk=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class nk{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:n,service:i,region:o,cache:a,retries:c,initRetryMs:u}){if(e==null)throw new TypeError("accessKeyId is a required option");if(t==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=n,this.service=i,this.region=o,this.cache=a||new Map,this.retries=c??10,this.initRetryMs=u||50}async sign(e,t){if(e instanceof Request){const{method:o,url:a,headers:c,body:u}=e;(t=Object.assign({method:o,url:a,headers:c},t)).body==null&&c.has("Content-Type")&&(t.body=u!=null&&c.has("X-Amz-Content-Sha256")?u:await e.clone().arrayBuffer()),e=a}const n=new ik(Object.assign({url:e},t,this,t&&t.aws)),i=Object.assign({},t,await n.sign());delete i.aws;try{return new Request(i.url.toString(),i)}catch(o){if(o instanceof TypeError)return new Request(i.url.toString(),Object.assign({duplex:"half"},i));throw o}}async fetch(e,t){for(let n=0;n<=this.retries;n++){const i=fetch(await this.sign(e,t));if(n===this.retries)return i;const o=await i;if(o.status<500&&o.status!==429)return o;await new Promise(a=>setTimeout(a,Math.random()*this.initRetryMs*Math.pow(2,n)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class ik{constructor({method:e,url:t,headers:n,body:i,accessKeyId:o,secretAccessKey:a,sessionToken:c,service:u,region:d,cache:m,datetime:g,signQuery:_,appendSessionToken:w,allHeaders:x,singleEncode:T}){if(t==null)throw new TypeError("url is a required option");if(o==null)throw new TypeError("accessKeyId is a required option");if(a==null)throw new TypeError("secretAccessKey is a required option");let I,R;this.method=e||(i?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(n||{}),this.body=i,this.accessKeyId=o,this.secretAccessKey=a,this.sessionToken=c,u&&d||([I,R]=function(L,k){const{hostname:j,pathname:H}=L;if(j.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(j.endsWith(".backblazeb2.com")){const re=j.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return re!=null?["s3",re[1]]:["",""]}const X=j.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[ee,oe]=(X||["",""]).slice(1,3);if(oe==="us-gov")oe="us-gov-west-1";else if(oe==="s3"||oe==="s3-accelerate")oe="us-east-1",ee="s3";else if(ee==="iot")ee=j.startsWith("iot.")?"execute-api":j.startsWith("data.jobs.iot.")?"iot-jobs-data":H==="/mqtt"?"iotdevicegateway":"iotdata";else if(ee==="autoscaling"){const re=(k.get("X-Amz-Target")||"").split(".")[0];re==="AnyScaleFrontendService"?ee="application-autoscaling":re==="AnyScaleScalingPlannerFrontendService"&&(ee="autoscaling-plans")}else oe==null&&ee.startsWith("s3-")?(oe=ee.slice(3).replace(/^fips-|^external-1/,""),ee="s3"):ee.endsWith("-fips")?ee=ee.slice(0,-5):oe&&/-\d$/.test(ee)&&!/-\d$/.test(oe)&&([ee,oe]=[oe,ee]);return[ek[ee]||ee,oe]}(this.url,this.headers)),this.service=u||I||"",this.region=d||R||"us-east-1",this.cache=m||new Map,this.datetime=g||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=_,this.appendSessionToken=w||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const M=this.signQuery?this.url.searchParams:this.headers;if(M.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&M.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(L=>x||!tk.has(L)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(L=>L+":"+(L==="host"?this.url.host:(this.headers.get(L)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||M.has("X-Amz-Expires")||M.set("X-Amz-Expires","86400"),M.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),M.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),M.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");T||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=yP(this.encodedPath);const C=new Set;this.encodedSearch=[...this.url.searchParams].filter(([L])=>{if(!L)return!1;if(this.service==="s3"){if(C.has(L))return!1;C.add(L)}return!0}).map(L=>L.map(k=>yP(encodeURIComponent(k)))).sort(([L,k],[j,H])=>L<j?-1:L>j?1:k<H?-1:k>H?1:0).map(L=>L.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join();let n=this.cache.get(t);if(!n){const i=await pb("AWS4"+this.secretAccessKey,e),o=await pb(i,this.region),a=await pb(o,this.service);n=await pb(a,"aws4_request"),this.cache.set(t,n)}return EC(await pb(n,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,EC(await _P(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=EC(await _P(this.body||""))}return e}}async function pb(s,e){const t=await crypto.subtle.importKey("raw",typeof s=="string"?xC.encode(s):s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",t,xC.encode(e))}async function _P(s){return crypto.subtle.digest("SHA-256",typeof s=="string"?xC.encode(s):s)}function EC(s){return Array.prototype.map.call(new Uint8Array(s),e=>("0"+e.toString(16)).slice(-2)).join("")}function yP(s){return s.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var fb,Iv=function(s,e,t,n){var i,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(i=s[c])&&(a=(o<3?i(a):o>3?i(e,t,a):i(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let _l=fb=class extends En{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[XA],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new nk({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var s,e;(e=(s=this.uiConfig)==null?void 0:s.uiRefresh)==null||e.call(s,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(s){return this.serializeSettings?super.toJSON(s):{type:this.constructor.PluginType}}async onAdded(s){await super.onAdded(s);const e=s.getPlugin(XA);e.actions.exportFile=async(t,n,i)=>{if(!this._connected)return void await e.defaultActions.exportFile(t,n);const o=(0,V.pathJoin)([this.endpointURL,this.pathPrefix,n]),a=await this._fetch(o,{method:"PUT",body:t},i);if(!a.ok)return s.console.error("Error uploading file",a),void await e.defaultActions.exportFile(t,n);this.dispatchEvent({type:"fileUpload",name:n,blob:t,response:a,path:o}),s.console.log("File uploaded",a)}}async _fetch(s,e,t){if(!this._client)throw new Error("Not connected");for(let n=0;n<=this._client.retries;n++){let i=await this._client.sign(s,e);fb.USE_PROXY&&i.url&&!i.url.includes(fb.PROXY_URL)&&(i=new Request(fb.PROXY_URL.replace("{path}",i.url),{headers:i.headers,method:i.method,body:i.body,duplex:"half"}));const o=fetch(i);if(n===this._client.retries)return o;const a=await o;if(a.status<500&&a.status!==429)return a;await(0,V.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,n))}throw new Error("An unknown error occurred, ensure retries is not negative")}};_l.PluginType="AWSClientPlugin1",_l.USE_PROXY=!1,_l.PROXY_URL="https://r2-s3-api.repalash.workers.dev/{path}",Iv([Ae(),jn("Access Key ID",s=>({disabled:()=>!s.enabled||s._connected}))],_l.prototype,"accessKeyId",void 0),Iv([Ae(),jn("Access Key Secret",s=>({disabled:()=>!s.enabled||s._connected}))],_l.prototype,"accessKeySecret",void 0),Iv([Ae(),jn("Endpoint URL",s=>({disabled:()=>!s.enabled||s._connected}))],_l.prototype,"endpointURL",void 0),Iv([Ae(),jn("Path Prefix",s=>({disabled:()=>!s.enabled}))],_l.prototype,"pathPrefix",void 0),Iv([Ae(),Gt("Remember",s=>({disabled:()=>!s.enabled||s._connected}))],_l.prototype,"serializeSettings",void 0),Iv([Ai(void 0,s=>({label:()=>s._connected?"Disconnect":"Connect"}))],_l.prototype,"toggleConnection",void 0),_l=fb=Iv([Hn("S3 Connection")],_l);const rk={Background:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(s=>({path:s}))}).assets,Environment:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(s=>({path:s}))}).assets,GemEnvironment:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(s=>({path:s}))}).assets,GemEnvironment2:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(s=>({path:s}))}).assets,GemEnvironment3:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(s=>({path:s}))}).assets,Ground:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(s=>({path:s}))}).assets,CameraViews:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(s=>({path:s}))}).assets,MaterialConfiguration:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(s=>({path:s}))}).assets,MaterialLibraries:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(s=>({path:s}))}).assets};function AP(s,e){return e?s*(1e3/e):0}function sk(s){var e,t=s.from,n=t===void 0?0:t,i=s.velocity,o=i===void 0?0:i,a=s.min,c=s.max,u=s.power,d=u===void 0?.8:u,m=s.timeConstant,g=m===void 0?750:m,_=s.bounceStiffness,w=_===void 0?500:_,x=s.bounceDamping,T=x===void 0?10:x,I=s.restDelta,R=I===void 0?1:I,M=s.modifyTarget,C=s.driver,L=s.onUpdate,k=s.onComplete,j=s.onStop;function H(_e){return a!==void 0&&_e<a||c!==void 0&&_e>c}function X(_e){return a===void 0?c:c===void 0||Math.abs(a-_e)<Math.abs(c-_e)?a:c}function ee(_e){e==null||e.stop(),e=Nh(Ir(Ir({},_e),{driver:C,onUpdate:function(Ee){var Ye;L==null||L(Ee),(Ye=_e.onUpdate)===null||Ye===void 0||Ye.call(_e,Ee)},onComplete:k,onStop:j}))}function oe(_e){ee(Ir({type:"spring",stiffness:w,damping:T,restDelta:R},_e))}if(H(n))oe({from:n,velocity:o,to:X(n)});else{var re=d*o+n;M!==void 0&&(re=M(re));var he,le,ue=X(re),ge=ue===a?-1:1;ee({type:"decay",from:n,velocity:o,timeConstant:g,power:d,restDelta:R,modifyTarget:M,onUpdate:H(re)?function(_e){he=le,le=_e,o=AP(_e-he,Ag().delta),(ge===1&&_e>ue||ge===-1&&_e<ue)&&oe({from:_e,to:ue,velocity:o})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var bP=function(s){return 180*s/Math.PI},ok=function(s,e){return e===void 0&&(e=fg),bP(Math.atan2(e.y-s.y,e.x-s.x))},ak=function(s,e){var t=!0;return e===void 0&&(e=s,t=!1),function(n){return t?n-s+e:(s=n,t=!0,e)}},lk=function(s){return s},SC=function(s){return s===void 0&&(s=lk),function(e,t,n){var i=t-n,o=-(0-e+1)*(0-s(Math.abs(i)));return i<=0?t+o:t-o}},ck=SC(),uk=SC(Math.sqrt),wP=function(s){return s*Math.PI/180},U1=function(s){return s.hasOwnProperty("x")&&s.hasOwnProperty("y")},CC=function(s){return U1(s)&&s.hasOwnProperty("z")},N1=function(s,e){return Math.abs(s-e)};function hk(s,e){if(Oh(s)&&Oh(e))return N1(s,e);if(U1(s)&&U1(e)){var t=N1(s.x,e.x),n=N1(s.y,e.y),i=CC(s)&&CC(e)?N1(s.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(n,2)+Math.pow(i,2))}}var dk=function(s,e,t){return e=wP(e),{x:t*Math.cos(e)+s.x,y:t*Math.sin(e)+s.y}},xP=function(s,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(s*e)/e},EP=function(s,e,t,n){return n===void 0&&(n=0),xP(s+t*(e-s)/Math.max(n,t))},pk=function(s){s===void 0&&(s=50);var e=0,t=0;return function(n){var i=Ag().timestamp,o=i!==t?i-t:0,a=o?EP(e,n,o,s):e;return t=i,e=a,a}},fk=function(s){if(typeof s=="number")return function(n){return Math.round(n/s)*s};var e=0,t=s.length;return function(n){var i=Math.abs(s[0]-n);for(e=1;e<t;e++){var o=s[e],a=Math.abs(o-n);if(a===0)return o;if(a>i)return s[e-1];if(e===t-1)return o;i=a}}};function mk(s,e){return s/(1e3/e)}var gk=function(s,e,t){var n=e-s;return((t-s)%n+n)%n+s},SP=function(s,e){return 1-3*e+3*s},CP=function(s,e){return 3*e-6*s},MP=function(s){return 3*s},F1=function(s,e,t){return((SP(e,t)*s+CP(e,t))*s+MP(e))*s},TP=function(s,e,t){return 3*SP(e,t)*s*s+2*CP(e,t)*s+MP(e)},vk=1e-7,_k=10,yk=8,Ak=.001,j1=11,z1=1/(j1-1);function bk(s,e,t,n){if(s===e&&t===n)return r_;for(var i=new Float32Array(j1),o=0;o<j1;++o)i[o]=F1(o*z1,s,t);return function(a){return a===0||a===1?a:F1(function(c){for(var u=0,d=1,m=j1-1;d!==m&&i[d]<=c;++d)u+=z1;--d;var g=u+(c-i[d])/(i[d+1]-i[d])*z1,_=TP(g,s,t);return _>=Ak?function(w,x,T,I){for(var R=0;R<yk;++R){var M=TP(x,T,I);if(M===0)return x;x-=(F1(x,T,I)-w)/M}return x}(c,g,s,t):_===0?g:function(w,x,T,I,R){var M,C,L=0;do(M=F1(C=x+(T-x)/2,I,R)-w)>0?T=C:x=C;while(Math.abs(M)>vk&&++L<_k);return C}(c,u,u+z1,s,t)}(a),e,n)}}var wk=function(s,e){return e===void 0&&(e="end"),function(t){var n=(t=e==="end"?Math.min(t,.999):Math.max(t,.001))*s,i=e==="end"?Math.floor(n):Math.ceil(n);return Xs(0,1,i/s)}};class xk extends ol{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[Rc,ub,Yd,gc,ps]},{title:"Picking",plugins:[ab,Ti,br,qo,iu,Mv]},{title:"Scene",plugins:[sb,xa,ob,lb,cb,Th,Lr,Pc,ZA]},{title:"Anti-aliasing",plugins:[oo,zh,hp]},{title:"Post Processing",plugins:[Um,RA,Ys,Nm,Qm,Bu,Zm,Qc,za,Eu,Km,qs]},{title:"Export",plugins:[nm,Ul,qu,_l]},{title:"Animations",plugins:[sr,lr,ya,fm,yd]},{title:"Modifiers",plugins:[Xu,Xl,Yl,nu,LA,WA,Ho]},{title:"Configurators",plugins:[Jh,Vu,bc,JA]},{title:"Plugins",plugins:[va,Jr,Go,_c,jl,Va,Ha,Fl,Mh,ba,wr,ad,Hu]},{title:"Extras",plugins:[pC,sm,mm,ru,JS]}],pP()}async setupUi(e,t){await fP(this,e,t??this.defaultModes),this._editorInitialized=!0}}async function IP(s,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!1,importPopup:o=!0,caching:a=!0}){s.enabled=!1,e&&await s.addPlugin(Uu),s.getPlugin(Qt)||await s.addPlugin(Qt,void 0,void 0,{storage:a&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await s.addPlugin(nm),await s.addPlugin(sS),await s.addPlugin(XA),o&&await s.addPlugin(wr),await s.addPlugin(uC),await s.addPlugin(mm,!1),await s.addPlugin(kE),await s.addPlugin(am),await s.addPlugin(gc),await s.addPlugin(yd),await s.addPlugin(Bp),await s.addPlugin(Ti,H0,!1,!0),await jw(s,{ground:t,bloom:n,depthTonemap:i}),await s.addPlugin(RA),await s.addPlugin(nu,!1),await s.addPlugin(US),await s.addPlugin(jS),await s.addPlugin(zS),await s.addPlugin(ad,!1),await s.addPlugin(new Xu(!1)),await s.addPlugin(Xl),await s.addPlugin(Yl),(await s.addPlugin(Vu)).enableEditContextMenus=!0,await s.addPlugin(JA),await s.addPlugin(qo),await s.addPlugin(qu),await s.addPlugin(Ul),await s.addPlugin(ab),await s.addPlugin(ob),await s.addPlugin(lb),await s.addPlugin(cb),await s.addPlugin(Rc),await s.addPlugin(ub),await s.addPlugin(sb),await s.addPlugin(Mv,!1),await s.addPlugin(ZA),await s.addPlugin(iu),await s.addPlugin(fm,s.container,!1),await s.addPlugin(_l),await s.addPlugin(ru);const c=await s.addPlugin(new A0(!(0,V.mobileAndTabletCheck)()));return s.renderer.refreshPipeline(),s.scene.addEventListener("textureAdded",u=>{u.texture&&s.scene.setEnvironment(u.texture)}),c.setupPluginUi(Jr),c.setupPluginUi(Rc),c.setupPluginUi(ub),c.setupPluginUi(wr),c.setupPluginUi(gc),c.setupPluginUi(sb),c.setupPluginUi(nm),c.setupPluginUi(sr),c.setupPluginUi(Th),c.setupPluginUi(Jh),c.setupPluginUi(Vu),c.setupPluginUi(yd),c.setupPluginUi(ab),c.setupPluginUi(qo),c.setupPluginUi(br),c.setupPluginUi(Ti),t&&s.getPlugin(xa)&&c.setupPluginUi(xa),t&&s.getPlugin(Pc)&&c.setupPluginUi(Pc),c.setupPluginUi(Zm),c.setupPluginUi(lr),c.setupPluginUi(qu),c.setupPluginUi(Um),c.setupPluginUi(RA),c.setupPluginUi(Nm),c.setupPluginUi(Qm),c.setupPluginUi(Ys),c.setupPluginUi(Bu),c.setupPluginUi(Eu),c.setupPluginUi(Qc),c.setupPluginUi(Mh),c.setupPluginUi(Fl),c.setupPluginUi(ob),c.setupPluginUi(Xu),c.setupPluginUi(Xl),c.setupPluginUi(oo),c.setupPluginUi(lb),c.setupPluginUi(cb),c.setupPluginUi(Va),c.setupPluginUi(Ha),c.setupPluginUi(ba),n&&c.setupPluginUi(za),c.setupPluginUi(Ul),c.setupPluginUi(va),c.setupPluginUi(zh),c.setupPluginUi(Lr),c.setupPluginUi(Km),c.setupPluginUi(qs),c.setupPluginUi(Yl),c.setupPluginUi(_c),c.setupPluginUi(hp),c.setupPluginUi(Yd),c.setupPluginUi(bc),c.setupPluginUi(Go),c.setupPluginUi(nu),c.setupPluginUi(ya),c.setupPluginUi(ad),c.setupPluginUi(_l),c.setupPluginUi(fm),c.setupPluginUi(iu),c.setupPluginUi(JA),c.setupPluginUi(Ho),c.setupPluginUi(Mv),c.setupPluginUi(Hu),c.setupPluginUi(mm),c.setupPluginUi(ZA),c.setupPluginUi(ps),c.setupPluginUi(ru),s.enabled=!0,s}async function Ek(s,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!1,importPopup:o=!0,caching:a=!0}){const c=new ol(s);return await IP(c,{debug:e,ground:t,bloom:n,depthTonemap:i,importPopup:o,caching:a}),c}async function Sk(s,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!0,importPopup:o=!1,enableDrop:a=!1,caching:c=!0}={}){const u=new ol(s);return e&&await u.addPlugin(Uu),u.getPlugin(Qt)||u.addPluginSync(Qt,void 0,void 0,{storage:c&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await u.addPlugin(fA,!0),await jw(u,{ground:t,bloom:n,depthTonemap:i,enableDrop:a,importPopup:o}),u}})();__webpackgi_exports__.MWW;__webpackgi_exports__.LY2;__webpackgi_exports__.GYo;__webpackgi_exports__.GPz;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.Mp4;__webpackgi_exports__.QvI;__webpackgi_exports__.PrA;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.bBp;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;__webpackgi_exports__.SwW;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.w7U;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.L7J;__webpackgi_exports__.yEv;__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.MMq;__webpackgi_exports__.qKx;__webpackgi_exports__.Hmi;__webpackgi_exports__.X4S;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.Z_g;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__.N_j;__webpackgi_exports__.hNv;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.c0Q;__webpackgi_exports__.re0;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.ntt;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.n94;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.N1Y;__webpackgi_exports__.itK;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.eBg;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.hFL;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.izP;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.Dzq;__webpackgi_exports__.zCA;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.NKC;__webpackgi_exports__.jrv;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.SJj;__webpackgi_exports__.cF0;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;__webpackgi_exports__.s5b;__webpackgi_exports__.BHZ;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.hZr;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__.lth;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.OPJ;__webpackgi_exports__.PpQ;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.LYt;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.w_R;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.L1_;__webpackgi_exports__.blk;__webpackgi_exports__.YRm;__webpackgi_exports__.ejS;__webpackgi_exports__.wUb;__webpackgi_exports__.zOz;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.NHT;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;var __webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.ZqF;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.CRe;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.RPs;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.tfP;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__.rCq;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.oxT;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.mjX;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.eqi;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__.B2H;__webpackgi_exports__._Pm;__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.ZTh;__webpackgi_exports__.HdW;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.G_r;__webpackgi_exports__.N3F;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.fpq;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.lGU;__webpackgi_exports__.vuL;__webpackgi_exports__.KI_;__webpackgi_exports__.iLN;__webpackgi_exports__.X6w;__webpackgi_exports__.rz_;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.Rnn;__webpackgi_exports__.TyN;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.Jxm;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.Y4W;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.Mck;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.zG7;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.ub3;__webpackgi_exports__.OV;__webpackgi_exports__.G_n;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.CHp;__webpackgi_exports__.dwk;__webpackgi_exports__.t0w;__webpackgi_exports__.M7$;__webpackgi_exports__.ML4;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.IFZ;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.v27;__webpackgi_exports__.Uk6;__webpackgi_exports__.H7Z;__webpackgi_exports__._sL;__webpackgi_exports__.czO;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.zC5;var __webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve;__webpackgi_exports__.b5G;__webpackgi_exports__.UeO;__webpackgi_exports__.qCx;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.EER;__webpackgi_exports__.y4l;__webpackgi_exports__.P39;__webpackgi_exports__.HI1;__webpackgi_exports__.ZYi;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.sMc;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.YQ8;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.RGi;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.Wz1;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.CN8;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.uqj;__webpackgi_exports__.Z9P;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.J4G;__webpackgi_exports__.Zj8;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Nv0;__webpackgi_exports__.tCp;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.H$s;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.f1L;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.a95;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.JFD;__webpackgi_exports__.gw2;__webpackgi_exports__.rfc;__webpackgi_exports__.wo6;__webpackgi_exports__.V4T;__webpackgi_exports__.H4P;__webpackgi_exports__.NLp;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.hiB;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.zlD;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.NN$;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.GGm;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.P1O;__webpackgi_exports__.iib;__webpackgi_exports__.qf5;__webpackgi_exports__.n4s;__webpackgi_exports__.fr;__webpackgi_exports__.Z9s;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.i8W;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__.N4A;__webpackgi_exports__.hjq;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.Kd3;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.pJq;__webpackgi_exports__.YPW;__webpackgi_exports__._tY;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.Rgz;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.Sy1;__webpackgi_exports__.Vs_;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.doP;__webpackgi_exports__.$jA;__webpackgi_exports__.T99;__webpackgi_exports__.LJS;__webpackgi_exports__.VsW;__webpackgi_exports__.LZE;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.VsX;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.BFq;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.NSm;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;const styles="";async function setupViewer(){const St=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("demo-canvas")});await __webpackgi_exports__addBasePlugins(St),await St.addPlugin(__webpackgi_exports__MaterialConfiguratorPlugin);const V=St.getPlugin(__webpackgi_exports__AssetManagerPlugin);St.renderer.refreshPipeline(),await V.addFromPath("https://s3.amazonaws.com/viewer1.1/Trial1.glb",{autoScale:!1,autoScaleRadius:1,autoCenter:!0})}setupViewer();
